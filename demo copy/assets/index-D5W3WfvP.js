const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./NotesAndScreenshotsStep-Cw0raGbu.js","./charts-BPa70Nrz.js","./vendor_react-Dazix4UH.js","./utils-CXH6lFM8.js","./pdf-DQpr2XkM.js","./V3LeverageMarginSection-CiPTlafK.js","./V3FuturesParamsSection-C1MXMILK.js"])))=>i.map(i=>d[i]);
import{r as g,j as e,R as V,a as ps,m as Ks,L as Aa,A as dn,b as Cs,C as As,c as ns,X as ls,Y as bt,T as Jt,d as Ut,e as Ns,f as Kt,g as sl,B as rl,h as Ir,i as Oo,k as La,P as ol,l as nl}from"./charts-BPa70Nrz.js";import{a as $a,g as za}from"./vendor_react-Dazix4UH.js";import{D as ks,s as oo,i as Ia,b as no,a as Vs,c as Bs,d as Oa,f as st,l as dt,e as un,g as mn}from"./utils-CXH6lFM8.js";import{a as rs}from"./pdf-DQpr2XkM.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();var pr={},xn;function qa(){if(xn)return pr;xn=1;var t=$a();return pr.createRoot=t.createRoot,pr.hydrateRoot=t.hydrateRoot,pr}var Ua=qa();const Wa=za(Ua),kr={ES:12.5,NQ:5,YM:5,RTY:5,CL:10,GC:10,SI:25,ZB:31.25,ZN:15.625,ZF:7.8125,EURUSD:10,GBPUSD:10,USDJPY:10,USDCHF:10,AUDUSD:10,USDCAD:10,BTCUSD:1,ETHUSD:.1,ADAUSD:1e-4,DEFAULT:1},lo=[{id:"light",name:"Clair",isDark:!1,colors:{bg:"#fafafa",surface:"#e5e5e5",text:"#1a1a1a",textMuted:"#666666",textSecondary:"#404040",accent:"#3b82f6",accentHover:"#2563eb",success:"#00cc6a",danger:"#cc3333",warning:"#7a5c00",info:"#084a5c",border:"#e0e0e0",borderHover:"#d0d0d0",card:"#ffffff"}},{id:"dark",name:"Sombre",isDark:!0,colors:{bg:"#0f172a",surface:"#1e293b",text:"#f1f5f9",textMuted:"#94a3b8",textSecondary:"#cbd5e1",accent:"#0ea5e9",accentHover:"#0284c7",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",info:"#3b82f6",border:"#334155",borderHover:"#475569",card:"#283345"}},{id:"ultra-dark",name:"Ultra Sombre",isDark:!0,colors:{bg:"#050505",surface:"#0f0f0f",text:"#d5d5d5",textMuted:"#757575",textSecondary:"#a5a5a5",accent:"#0f5c4a",accentHover:"#0a4436",success:"#00cc6a",danger:"#cc3333",warning:"#7a5c00",info:"#084a5c",border:"#1f1f1f",borderHover:"#2f2f2f",card:"#151515"}}],ll=g.createContext(void 0),_a=({children:t})=>{const[s,r]=g.useState("dark"),[l,n]=g.useState([]);g.useEffect(()=>{try{const u=localStorage.getItem("simple-theme-id");u&&r(u);const m=localStorage.getItem("simple-custom-themes");m&&n(JSON.parse(m))}catch(u){console.warn("Erreur chargement thÃ¨mes:",u)}},[]),g.useEffect(()=>{localStorage.setItem("simple-theme-id",s)},[s]),g.useEffect(()=>{localStorage.setItem("simple-custom-themes",JSON.stringify(l))},[l]);const o=[...lo,...l],a=o.find(u=>u.id===s)||lo[1];g.useEffect(()=>{const u=document.documentElement;u.classList.remove("dark","light","ultra-dark"),u.removeAttribute("data-theme"),u.style.setProperty("--theme-bg",a.colors.bg),u.style.setProperty("--theme-surface",a.colors.surface),u.style.setProperty("--theme-text",a.colors.text),u.style.setProperty("--theme-text-muted",a.colors.textMuted),u.style.setProperty("--theme-text-secondary",a.colors.textSecondary),u.style.setProperty("--theme-accent",a.colors.accent),u.style.setProperty("--theme-accent-hover",a.colors.accentHover),u.style.setProperty("--theme-success",a.colors.success),u.style.setProperty("--theme-danger",a.colors.danger),u.style.setProperty("--theme-warning",a.colors.warning),u.style.setProperty("--theme-info",a.colors.info),u.style.setProperty("--theme-border",a.colors.border),u.style.setProperty("--theme-border-hover",a.colors.borderHover),u.style.setProperty("--theme-card",a.colors.card),u.classList.add(a.id),u.setAttribute("data-theme",a.id)},[a]);const i=u=>{o.find(m=>m.id===u)&&r(u)},c=u=>{const m={...u,id:`custom-${Date.now()}`};n(p=>[...p,m]),r(m.id)},d=u=>{lo.find(m=>m.id===u)||(n(m=>m.filter(p=>p.id!==u)),s===u&&r("dark"))};return e.jsx(ll.Provider,{value:{currentTheme:a,themes:o,setTheme:i,createTheme:c,deleteTheme:d},children:t})},Q=()=>{const t=g.useContext(ll);if(!t)throw new Error("useSimpleTheme must be used within SimpleThemeProvider");return t},Js=[{code:"fr",name:"FranÃ§ais",flag:"ðŸ‡«ðŸ‡·",locale:"fr-FR"},{code:"en",name:"English",flag:"ðŸ‡¬ðŸ‡§",locale:"en-US"}],fn={fr:{appTitle:"MetrixSight",newTrade:"Nouveau Trade",overview:"Vue d'Ensemble",statistics:"Statistiques",charts:"Graphiques",tradesList:"Liste des Trades",filters:"Filtres",settings:"ParamÃ¨tres",addTrade:"Ajouter un Trade",editTrade:"Modifier le Trade",date:"Date",time:"Heure",symbol:"Symbole",direction:"Direction",long:"Long",short:"Short",entryPrice:"Prix d'EntrÃ©e",exitPrice:"Prix de Sortie",quantity:"QuantitÃ©",strategy:"StratÃ©gie",market:"MarchÃ©",timeframe:"Timeframe",timeframe_tick:"Timeframe/Tick",notes:"Notes",save:"Sauvegarder",cancel:"Annuler",totalTrades:"Total Trades",winRate:"Taux de RÃ©ussite",profitFactor:"Profit Factor",totalPnL:"P&L Total",currentCapital:"Capital Actuel",initialCapital:"Capital Initial",averageWin:"Gain Moyen",averageLoss:"Perte Moyenne",largestWin:"Plus Gros Gain",largestLoss:"Plus Grosse Perte",maxDrawdown:"Drawdown Max",pnlChart:"Graphique P&L",equityChart:"Courbe d'Ã‰quitÃ©",distributionChart:"Distribution",performanceChart:"Performance",noTrades:"Aucun trade enregistrÃ©",confirmDelete:"ÃŠtes-vous sÃ»r de vouloir supprimer ce trade ?",confirmClearData:"ÃŠtes-vous sÃ»r de vouloir effacer toutes les donnÃ©es ? Cette action est irrÃ©versible.",success:"SuccÃ¨s",error:"Erreur",selectProfileFirst:"Veuillez sÃ©lectionner un profil avant d'ajouter un trade",importSuccess:"{count} trades importÃ©s avec succÃ¨s !",profile:"Profil",capital:"Capital",desktop:"Desktop",demo:"Demo",importExport:"Import/Export",loadDemoData:"Charger des donnÃ©es de dÃ©monstration",exportData:"Exporter les donnÃ©es",noProfileSelected:"Aucun profil sÃ©lectionnÃ©",createSelectProfile:"CrÃ©ez ou sÃ©lectionnez un profil de trading pour commencer",createFirstProfile:"CrÃ©er mon premier profil",testWithDemoData:"Tester avec des donnÃ©es de dÃ©monstration",or:"ou",recentTrades:"Trades RÃ©cents",startRecordingTrades:"Commencez Ã  enregistrer vos trades pour suivre vos performances",addFirstTrade:"Ajouter votre premier trade",loadTestData:"Charger des donnÃ©es de test",recents:"RÃ©cents",symboles_existants:"Symboles existants",rechercher_un_symbole:"Rechercher un symbole...",aucun_symbole_trouve:"Aucun symbole trouvÃ©",alt_s_pour_ouvrir_entree_pour_selectionner_esc_pour_fermer:"Alt+S pour ouvrir â€¢ EntrÃ©e pour sÃ©lectionner â€¢ Esc pour fermer",statut:"Statut",ouvert:"Ouvert",ferme:"FermÃ©",marche:"MarchÃ©",optionnel:"optionnel",demoData:"DonnÃ©es de DÃ©monstration",futures:"Futures",forex:"Forex",crypto:"Crypto",stocks:"Actions",indices:"Indices",commodities:"MatiÃ¨res premiÃ¨res",bullish:"HaussiÃ¨re",bearish:"BaissiÃ¨re",sideways:"LatÃ©rale",sessionEU:"Session EU",sessionUS:"Session US",sessionAsia:"Session Asie",premarket:"PrÃ©-marchÃ©",open:"Ouvert",closed:"FermÃ©",globalPerformance:"Performance Globale",consistency:"Consistance",timing:"Timing",riskReward:"Risk/Reward",score:"Score",tradingDays:"Jours tradÃ©s",bestDay:"Meilleur jour",worstDay:"Pire jour",averageDuration:"DurÃ©e moyenne",tradesPerDay:"Trades/jour",ratio:"Ratio",days7:"7 jours",days30:"30 jours",days90:"90 jours",all:"Tout",summary:"RÃ©sumÃ©",trends:"Tendances",patterns:"Patterns",insights:"Insights",noData:"Pas assez de donnÃ©es",addMoreTrades:"Ajoutez plus de trades fermÃ©s pour voir votre vue d'ensemble",unknownError:"Erreur inconnue"},en:{appTitle:"MetrixSight",newTrade:"New Trade",overview:"Overview",statistics:"Statistics",charts:"Charts",tradesList:"Trades List",filters:"Filters",settings:"Settings",addTrade:"Add Trade",editTrade:"Edit Trade",date:"Date",time:"Time",symbol:"Symbol",direction:"Direction",long:"Long",short:"Short",entryPrice:"Entry Price",exitPrice:"Exit Price",quantity:"Quantity",strategy:"Strategy",market:"Market",timeframe:"Timeframe",timeframe_tick:"Timeframe/Tick",notes:"Notes",save:"Save",cancel:"Cancel",totalTrades:"Total Trades",winRate:"Win Rate",profitFactor:"Profit Factor",totalPnL:"Total P&L",currentCapital:"Current Capital",initialCapital:"Initial Capital",averageWin:"Average Win",averageLoss:"Average Loss",largestWin:"Largest Win",largestLoss:"Largest Loss",maxDrawdown:"Max Drawdown",pnlChart:"P&L Chart",equityChart:"Equity Curve",distributionChart:"Distribution",performanceChart:"Performance",noTrades:"No trades recorded",confirmDelete:"Are you sure you want to delete this trade?",confirmClearData:"Are you sure you want to clear all data? This action is irreversible.",success:"Success",error:"Error",selectProfileFirst:"Please select a profile before adding a trade",importSuccess:"{count} trades imported successfully!",profile:"Profile",capital:"Capital",desktop:"Desktop",demo:"Demo",importExport:"Import/Export",loadDemoData:"Load demo data",exportData:"Export data",noProfileSelected:"No profile selected",createSelectProfile:"Create or select a trading profile to get started",createFirstProfile:"Create my first profile",testWithDemoData:"Test with demo data",or:"or",recentTrades:"Recent Trades",startRecordingTrades:"Start recording your trades to track your performance",addFirstTrade:"Add your first trade",loadTestData:"Load test data",demoData:"Demo Data",futures:"Futures",forex:"Forex",crypto:"Crypto",stocks:"Stocks",indices:"Indices",commodities:"Commodities",bullish:"Bullish",bearish:"Bearish",sideways:"Sideways",sessionEU:"EU Session",sessionUS:"US Session",sessionAsia:"Asia Session",premarket:"Pre-market",open:"Open",closed:"Closed",globalPerformance:"Global Performance",consistency:"Consistency",timing:"Timing",riskReward:"Risk/Reward",score:"Score",tradingDays:"Trading days",bestDay:"Best day",worstDay:"Worst day",averageDuration:"Average duration",tradesPerDay:"Trades/day",ratio:"Ratio",days7:"7 days",days30:"30 days",days90:"90 days",all:"All",summary:"Summary",trends:"Trends",patterns:"Patterns",insights:"Insights",noData:"Not enough data",addMoreTrades:"Add more closed trades to see your overview",unknownError:"Unknown error",recents:"Recent",symboles_existants:"Existing Symbols",rechercher_un_symbole:"Search for a symbol...",aucun_symbole_trouve:"No symbol found",alt_s_pour_ouvrir_entree_pour_selectionner_esc_pour_fermer:"Alt+S to open â€¢ Enter to select â€¢ Esc to close",statut:"Status",ouvert:"Open",ferme:"Closed",marche:"Market",optionnel:"optional"}},al=g.createContext(void 0),Va=({children:t})=>{const[s,r]=g.useState(()=>{const d=localStorage.getItem("trading-journal-language");return d&&Js.find(u=>u.code===d)?d:"fr"});g.useEffect(()=>{localStorage.setItem("trading-journal-language",s),document.documentElement.lang=s;const d={fr:"MetrixSight",en:"MetrixSight"};document.title=d[s],window.dispatchEvent(new CustomEvent("languageChanged",{detail:s}))},[s]);const l=d=>{r(d)},n=(d,u)=>{const p=Js.find(f=>f.code===s)?.locale||"fr-FR",x=u||(s==="fr"?"EUR":"USD");return new Intl.NumberFormat(p,{style:"currency",currency:x,minimumFractionDigits:0,maximumFractionDigits:2}).format(d)},o=d=>{const m=Js.find(x=>x.code===s)?.locale||"fr-FR";return(typeof d=="string"?new Date(d):d).toLocaleDateString(m,{year:"numeric",month:"short",day:"numeric"})},a=(d,u=2)=>{const p=Js.find(x=>x.code===s)?.locale||"fr-FR";return new Intl.NumberFormat(p,{minimumFractionDigits:u,maximumFractionDigits:u}).format(d)},i=d=>`${d>=0?"+":""}${d.toFixed(2)}%`,c={currentLanguage:s,changeLanguage:l,t:fn[s]||fn.fr,formatCurrency:n,formatDate:o,formatNumber:a,formatPercentage:i};return e.jsx(al.Provider,{value:c,children:t})},Z=()=>{const t=g.useContext(al);if(!t)throw new Error("useLanguage must be used within a LanguageProvider");return t};var Ba={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Ha=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ga=(t,s)=>{const r=g.forwardRef(({color:l="currentColor",size:n=24,strokeWidth:o=2,absoluteStrokeWidth:a,children:i,...c},d)=>g.createElement("svg",{ref:d,...Ba,width:n,height:n,stroke:l,strokeWidth:a?Number(o)*24/Number(n):o,className:`lucide lucide-${Ha(t)}`,...c},[...s.map(([u,m])=>g.createElement(u,m)),...(Array.isArray(i)?i:[i])||[]]));return r.displayName=`${t}`,r};var le=Ga;const Mt=le("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),Ja=le("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Xt=le("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),ao=le("ArrowDownWideNarrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]]),cl=le("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),il=le("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),dl=le("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),co=le("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]),Ys=le("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),Ps=le("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),Ka=le("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]),_e=le("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),os=le("BarChart",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]),io=le("BookMarked",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}],["polyline",{points:"10 2 10 10 13 7 16 10 16 2",key:"13o6vz"}]]),Ya=le("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]),qo=le("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),yt=le("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),ul=le("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),Or=le("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),qt=le("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),$e=le("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),as=le("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Is=le("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),it=le("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),lr=le("ChevronsDown",[["path",{d:"m7 6 5 5 5-5",key:"1lc07p"}],["path",{d:"m7 13 5 5 5-5",key:"1d48rs"}]]),ar=le("ChevronsUp",[["path",{d:"m17 11-5-5-5 5",key:"e8nh98"}],["path",{d:"m17 18-5-5-5 5",key:"2avn1x"}]]),ze=le("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),tr=le("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),Ge=le("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),cr=le("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),sr=le("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]),Xa=le("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),De=le("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Se=le("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Uo=le("FileImage",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["circle",{cx:"10",cy:"13",r:"2",key:"6v46hv"}],["path",{d:"m20 17-1.09-1.09a2 2 0 0 0-2.82 0L10 22",key:"17vly1"}]]),ml=le("FileSpreadsheet",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M14 17h2",key:"10kma7"}]]),ws=le("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),cs=le("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),Qa=le("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]),Wo=le("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z",key:"nb9nel"}]]),xl=le("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),fl=le("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Fs=le("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),pl=le("Keyboard",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",ry:"2",key:"15u882"}],["path",{d:"M6 8h.001",key:"1ej0i3"}],["path",{d:"M10 8h.001",key:"1x2st2"}],["path",{d:"M14 8h.001",key:"1vkmyp"}],["path",{d:"M18 8h.001",key:"kfsenl"}],["path",{d:"M8 12h.001",key:"1sjpby"}],["path",{d:"M12 12h.001",key:"al75ts"}],["path",{d:"M16 12h.001",key:"931bgk"}],["path",{d:"M7 16h10",key:"wp8him"}]]),hl=le("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),qr=le("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]),pn=le("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Za=le("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]),gl=le("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),ec=le("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),_o=le("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),tc=le("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),Vo=le("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),yl=le("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),is=le("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]),bl=le("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]),sc=le("PinOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["line",{x1:"12",x2:"12",y1:"17",y2:"22",key:"1jrz49"}],["path",{d:"M9 9v1.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V17h12",key:"13x2n8"}],["path",{d:"M15 9.34V6h1a2 2 0 0 0 0-4H7.89",key:"reo3ki"}]]),rc=le("Pin",[["line",{x1:"12",x2:"12",y1:"17",y2:"22",key:"1jrz49"}],["path",{d:"M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z",key:"13yl11"}]]),Je=le("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),So=le("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]),oc=le("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z",key:"wqdwcb"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17V7",key:"pyj7ub"}]]),nc=le("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]),hn=le("Ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]),Rt=le("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),vt=le("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),ms=le("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),lc=le("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),Bo=le("Sliders",[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]]),ac=le("StarOff",[["path",{d:"M8.34 8.34 2 9.27l5 4.87L5.82 21 12 17.77 18.18 21l-.59-3.43",key:"16m0ql"}],["path",{d:"M18.42 12.76 22 9.27l-6.91-1L12 2l-1.44 2.91",key:"1vt8nq"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),ot=le("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),cc=le("StickyNote",[["path",{d:"M15.5 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z",key:"1wis1t"}],["path",{d:"M15 3v6h6",key:"edgan2"}]]),ic=le("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]),ds=le("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]),Te=le("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),dc=le("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]),uc=le("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]),mc=le("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),Qt=le("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),$t=le("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),Ae=le("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),gn=le("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),wr=le("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Ho=le("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),xc=le("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]),fc=le("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Ne=le("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),ir=le("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),yn=[{id:"scalp-orderflow",name:"Order Flow Scalping",description:"Scalping basÃ© sur l'analyse du flux d'ordres",category:"scalping",isDefault:!0,timeframes:["5s","10s","15s","30s"],markets:["futures"],riskLevel:"high",complexity:"advanced",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"scalp-momentum",name:"Momentum Scalping",description:"Scalping sur les mouvements de momentum",category:"scalping",isDefault:!0,timeframes:["15s","30s","1m"],markets:["futures","forex"],riskLevel:"high",complexity:"intermediate",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"scalp-range",name:"Range Scalping",description:"Scalping dans les zones de range",category:"scalping",isDefault:!0,timeframes:["1m","5m"],markets:["futures","forex"],riskLevel:"medium",complexity:"beginner",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"scalp-news",name:"News Scalping",description:"Scalping sur les annonces Ã©conomiques",category:"scalping",isDefault:!0,timeframes:["5s","10s","15s"],markets:["forex","indices"],riskLevel:"high",complexity:"advanced",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"scalp-breakout",name:"Breakout Scalping",description:"Scalping sur les cassures de niveaux clÃ©s",category:"scalping",isDefault:!0,timeframes:["5s","10s","15s","30s"],markets:["futures","forex"],riskLevel:"high",complexity:"intermediate",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"day-breakout",name:"Breakout Trading",description:"Trading des cassures de niveaux clÃ©s",category:"daytrading",isDefault:!0,timeframes:["5m","15m","30m"],markets:["futures","stocks","indices"],riskLevel:"medium",complexity:"intermediate",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"day-pullback",name:"Pullback Trading",description:"Trading des retours sur tendance",category:"daytrading",isDefault:!0,timeframes:["15m","30m","1h"],markets:["stocks","indices","commodities"],riskLevel:"medium",complexity:"intermediate",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"day-reversal",name:"Reversal Trading",description:"Trading des retournements de tendance",category:"daytrading",isDefault:!0,timeframes:["30m","1h","4h"],markets:["futures","forex","crypto"],riskLevel:"high",complexity:"advanced",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"day-mean-reversion",name:"Mean Reversion",description:"Trading du retour Ã  la moyenne",category:"daytrading",isDefault:!0,timeframes:["15m","30m","1h"],markets:["stocks","indices"],riskLevel:"medium",complexity:"intermediate",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"day-gap-trading",name:"Gap Trading",description:"Trading des gaps d'ouverture",category:"daytrading",isDefault:!0,timeframes:["5m","15m","30m"],markets:["stocks","indices"],riskLevel:"medium",complexity:"beginner",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"swing-trend-following",name:"Trend Following",description:"Suivi de tendance long terme",category:"swingtrading",isDefault:!0,timeframes:["4h","1d","1w"],markets:["stocks","commodities","crypto"],riskLevel:"low",complexity:"beginner",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"swing-support-resistance",name:"Support/Resistance",description:"Trading sur les niveaux de support et rÃ©sistance",category:"swingtrading",isDefault:!0,timeframes:["1h","4h","1d"],markets:["stocks","indices","commodities"],riskLevel:"medium",complexity:"intermediate",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"swing-earnings",name:"Earnings Play",description:"Trading autour des publications de rÃ©sultats",category:"swingtrading",isDefault:!0,timeframes:["1d","1w"],markets:["stocks"],riskLevel:"high",complexity:"advanced",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"swing-sector-rotation",name:"Sector Rotation",description:"Trading de rotation sectorielle",category:"swingtrading",isDefault:!0,timeframes:["1d","1w","1M"],markets:["stocks","indices"],riskLevel:"medium",complexity:"advanced",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"custom-arbitrage",name:"Arbitrage",description:"Arbitrage entre diffÃ©rents marchÃ©s ou instruments",category:"custom",isDefault:!0,timeframes:["1m","5m","15m"],markets:["futures","forex","crypto"],riskLevel:"low",complexity:"advanced",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"custom-pairs-trading",name:"Pairs Trading",description:"Trading de paires corrÃ©lÃ©es",category:"custom",isDefault:!0,timeframes:["15m","1h","4h"],markets:["stocks","forex"],riskLevel:"medium",complexity:"advanced",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"custom-algo-trading",name:"Algorithmic Trading",description:"Trading algorithmique automatisÃ©",category:"custom",isDefault:!0,timeframes:["1m","5m","15m","1h"],markets:["futures","forex","crypto"],riskLevel:"medium",complexity:"advanced",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}],Ur=[{id:"scalping",name:"Scalping",description:"StratÃ©gies ultra-courtes (secondes Ã  minutes)",icon:"âš¡",color:"#ef4444",defaultTimeframes:["5s","10s","15s","30s","1m","5m"],defaultMarkets:["futures","forex"]},{id:"daytrading",name:"Day Trading",description:"StratÃ©gies intraday (minutes Ã  heures)",icon:"ðŸ“ˆ",color:"#3b82f6",defaultTimeframes:["5m","15m","30m","1h","4h"],defaultMarkets:["futures","stocks","indices","forex"]},{id:"swingtrading",name:"Swing Trading",description:"StratÃ©gies moyen terme (jours Ã  semaines)",icon:"ðŸŒŠ",color:"#10b981",defaultTimeframes:["4h","1d","1w","1M"],defaultMarkets:["stocks","commodities","crypto","indices"]},{id:"custom",name:"PersonnalisÃ©",description:"StratÃ©gies sur mesure et hybrides",icon:"âš™ï¸",color:"#8b5cf6",defaultTimeframes:["1m","5m","15m","30m","1h","4h","1d"],defaultMarkets:["futures","forex","stocks","crypto","indices","commodities"]}],Wr=[{id:"low",name:"Faible",color:"#10b981",description:"Risque limitÃ©, gains modÃ©rÃ©s"},{id:"medium",name:"Moyen",color:"#f59e0b",description:"Ã‰quilibre risque/rendement"},{id:"high",name:"Ã‰levÃ©",color:"#ef4444",description:"Risque Ã©levÃ©, gains potentiels importants"}],vl=[{id:"beginner",name:"DÃ©butant",color:"#10b981",description:"Facile Ã  comprendre et appliquer"},{id:"intermediate",name:"IntermÃ©diaire",color:"#f59e0b",description:"NÃ©cessite une expÃ©rience modÃ©rÃ©e"},{id:"advanced",name:"AvancÃ©",color:"#ef4444",description:"Requiert une expertise approfondie"}];function us(t,s){const[r,l]=g.useState(()=>{try{const o=window.localStorage.getItem(t);return o?JSON.parse(o):s}catch(o){return console.error(`Error reading localStorage key "${t}":`,o),s}});return[r,o=>{try{const a=o instanceof Function?o(r):o;l(a);const i=JSON.stringify(a);window.localStorage.setItem(t,i)}catch(a){a instanceof DOMException&&(a.name==="QuotaExceededError"||a.name==="NS_ERROR_DOM_QUOTA_REACHED")?alert(`Stockage local plein ! Votre navigateur a atteint sa limite de stockage.

Pour continuer Ã  ajouter des trades :
1. Exportez vos donnÃ©es actuelles pour les sauvegarder
2. Supprimez d'anciens trades pour libÃ©rer de l'espace
3. Utilisez la fonction d'export/import pour gÃ©rer vos donnÃ©es

Votre trade actuel n'a pas Ã©tÃ© sauvegardÃ©.`):(console.error(`Error setting localStorage key "${t}":`,a),alert(`Une erreur est survenue lors de la sauvegarde des donnÃ©es: ${a instanceof Error?a.message:"Erreur inconnue"}`))}}]}const Go=()=>{const[t,s]=us("trading-journal-strategy-presets",[]),[r,l]=us("trading-journal-favorite-strategies",[]),n=[...yn,...t].map(h=>({...h,isFavorite:r.includes(h.id)}));return{allPresets:n,customPresets:t,defaultPresets:yn,createPreset:h=>{const b={...h,id:`custom-${Date.now()}`,isDefault:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return s(j=>[...j,b]),b},updatePreset:(h,b)=>{s(j=>j.map(y=>y.id===h?{...y,...b,updatedAt:new Date().toISOString()}:y))},deletePreset:h=>{s(b=>b.filter(j=>j.id!==h))},getPresetsByCategory:h=>h?n.filter(b=>b.category===h):n,searchPresets:h=>{const b=h.toLowerCase();return n.filter(j=>j.name.toLowerCase().includes(b)||j.description?.toLowerCase().includes(b))},getPresetById:h=>n.find(b=>b.id===h),getPresetByName:h=>n.find(b=>b.name.toLowerCase()===h.toLowerCase()),getMostUsedStrategies:h=>{const b=new Map;return h.forEach(j=>{j.strategy&&b.set(j.strategy,(b.get(j.strategy)||0)+1)}),Array.from(b.entries()).sort((j,y)=>y[1]-j[1]).slice(0,5).map(([j,y])=>({name:j,count:y}))},toggleFavorite:h=>{r.includes(h)?l(b=>b.filter(j=>j!==h)):l(b=>[...b,h])},getFavoritePresets:()=>n.filter(h=>h.isFavorite),getStrategyStats:(h,b)=>{const j=b.filter(k=>k.strategy===h&&k.status==="closed");if(j.length===0)return null;const y=j.filter(k=>k.pnl&&k.pnl>0),N=j.filter(k=>k.pnl&&k.pnl<0),w=j.reduce((k,C)=>k+(C.pnl||0),0),S=w/j.length;return{totalTrades:j.length,winningTrades:y.length,losingTrades:N.length,winRate:j.length>0?y.length/j.length:0,totalPnl:w,averagePnl:S,bestTrade:j.reduce((k,C)=>!k||(C.pnl||0)>(k.pnl||0)?C:k,null),worstTrade:j.reduce((k,C)=>!k||(C.pnl||0)<(k.pnl||0)?C:k,null),recentTrades:j.sort((k,C)=>new Date(C.date).getTime()-new Date(k.date).getTime()).slice(0,5)}}}},pc=({onSelect:t,onClose:s,currentValue:r})=>{const[l,n]=g.useState(""),[o,a]=g.useState("all"),[i,c]=g.useState(!1),{getMostUsedStrategies:d,searchPresets:u,allPresets:m,getPresetsByCategory:p,createPreset:x}=Go(),f=g.useMemo(()=>l.trim()?u(l):o==="all"?m:p(o),[l,o,u,m,p]),v=d([]),h=[{id:"all",name:"Toutes",icon:"â­",count:m.length},{id:"scalping",name:"Scalping",icon:"âš¡",count:m.filter(y=>y.category==="scalping").length},{id:"daytrading",name:"Day Trading",icon:"ðŸ“ˆ",count:m.filter(y=>y.category==="daytrading").length},{id:"swingtrading",name:"Swing Trading",icon:"ðŸŒŠ",count:m.filter(y=>y.category==="swingtrading").length},{id:"custom",name:"PersonnalisÃ©",icon:"âš™ï¸",count:m.filter(y=>y.category==="custom").length}],b=y=>{t(y)},j=()=>{l.trim()&&c(!0)};return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]",children:[e.jsxs("div",{className:"theme-surface rounded-lg shadow-xl max-w-5xl w-full h-[85vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b theme-border flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold theme-text",children:"SÃ©lectionner une StratÃ©gie"}),e.jsxs("p",{className:"text-sm theme-text-muted mt-1",children:["Choisissez parmi ",m.length," stratÃ©gies ou crÃ©ez la vÃ´tre"]})]}),e.jsx("button",{onClick:s,className:"theme-text-muted hover:theme-text transition-colors p-2 hover:theme-surface rounded-lg",children:e.jsx(Ne,{size:24})})]}),e.jsx("div",{className:"p-6 border-b theme-border flex-shrink-0",children:e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(vt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 theme-text-muted",size:20}),e.jsx("input",{type:"text",value:l,onChange:y=>n(y.target.value),placeholder:"Rechercher une stratÃ©gie...",className:"w-full pl-10 pr-4 py-3 border theme-border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},autoFocus:!0})]}),l.trim()&&!m.find(y=>y.name.toLowerCase()===l.toLowerCase())&&e.jsxs("button",{onClick:j,className:"flex items-center space-x-2 px-4 py-3 theme-text rounded-lg transition-colors whitespace-nowrap",style:{backgroundColor:"var(--theme-accent)"},onMouseEnter:y=>{y.currentTarget.style.backgroundColor="var(--theme-accent-hover)"},onMouseLeave:y=>{y.currentTarget.style.backgroundColor="var(--theme-accent)"},children:[e.jsx(Je,{size:16}),e.jsxs("span",{children:['Ajouter "',l.slice(0,15),l.length>15?"...":"",'"']})]})]})}),e.jsx("div",{className:"px-6 py-4 border-b theme-border flex-shrink-0",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:h.map(y=>e.jsxs("button",{onClick:()=>a(y.id),className:`flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-colors ${o===y.id?"theme-text shadow-md":"theme-surface theme-text hover:theme-surface"}`,style:{backgroundColor:o===y.id?"var(--theme-accent)":void 0},children:[e.jsx("span",{className:"mr-2",children:y.icon}),y.name,e.jsx("span",{className:"ml-2 px-2 py-0.5 theme-surface rounded-full text-xs",children:y.count})]},y.id))})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[!l&&v.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-lg font-semibold theme-text mb-4 flex items-center",children:[e.jsx(ot,{size:20,className:"mr-2 text-yellow-500"}),"StratÃ©gies les plus utilisÃ©es"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:v.slice(0,6).map((y,N)=>e.jsxs("button",{onClick:()=>b(y.name),className:`p-4 text-left rounded-lg border-2 transition-all hover:shadow-md ${r===y.name?"shadow-md":"theme-border hover:theme-surface"}`,style:{borderColor:r===y.name?"var(--theme-accent)":void 0,backgroundColor:r===y.name?"var(--theme-accent)10":void 0},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold theme-text",children:y.name}),e.jsxs("div",{className:"flex items-center space-x-1 text-yellow-500",children:[e.jsx(ot,{size:14}),e.jsx("span",{className:"text-xs font-medium",children:y.count})]})]}),e.jsxs("div",{className:"text-xs theme-text-muted",children:["UtilisÃ©e ",y.count," fois"]})]},N))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold theme-text",children:l?`RÃ©sultats pour "${l}"`:"Toutes les stratÃ©gies"}),e.jsxs("span",{className:"text-sm theme-text-muted theme-surface px-3 py-1 rounded-full",children:[f.length," stratÃ©gie",f.length>1?"s":""]})]}),f.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"theme-text-muted mb-4",children:e.jsx(vt,{size:48,className:"mx-auto"})}),e.jsx("h4",{className:"text-lg font-medium theme-text mb-2",children:l?"Aucune stratÃ©gie trouvÃ©e":"Aucune stratÃ©gie disponible"}),e.jsx("p",{className:"theme-text-muted mb-6",children:l?`Aucune stratÃ©gie ne correspond Ã  "${l}"`:"Il n\\'y a pas de stratÃ©gies dans cette catÃ©gorie"}),l&&e.jsxs("button",{onClick:j,className:"inline-flex items-center space-x-2 px-6 py-3 theme-text rounded-lg transition-colors",style:{backgroundColor:"var(--theme-accent)"},onMouseEnter:y=>{y.currentTarget.style.backgroundColor="var(--theme-accent-hover)"},onMouseLeave:y=>{y.currentTarget.style.backgroundColor="var(--theme-accent)"},children:[e.jsx(Je,{size:16}),e.jsxs("span",{children:['CrÃ©er la stratÃ©gie "',l,'"']})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.map((y,N)=>{const w=Ur.find(k=>k.id===y.category),S=Wr.find(k=>k.id===y.riskLevel);return vl.find(k=>k.id===y.complexity),e.jsxs("button",{onClick:()=>b(y.name),className:`p-4 text-left rounded-lg border-2 transition-all hover:shadow-md ${r===y.name?"shadow-md":"theme-border hover:border-blue-300 hover:theme-surface"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:w?.icon||"ðŸ“Š"}),e.jsx("div",{className:"font-semibold theme-text",children:y.name})]}),y.isDefault&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full",style:{backgroundColor:"var(--theme-accent)20",color:"var(--theme-accent)"},children:"DÃ©faut"})]}),y.description&&e.jsx("p",{className:"text-sm theme-text-muted mb-3 line-clamp-2",children:y.description}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[w&&e.jsx("span",{className:"px-2 py-1 text-xs rounded-full font-medium",style:{backgroundColor:`${w.color}15`,color:w.color,border:`1px solid ${w.color}30`},children:w.name}),S&&e.jsx("span",{className:"px-2 py-1 text-xs rounded-full font-medium",style:{backgroundColor:`${S.color}15`,color:S.color,border:`1px solid ${S.color}30`},children:S.name}),y.timeframes&&y.timeframes.length>0&&e.jsxs("div",{className:"flex items-center space-x-1 theme-surface px-2 py-1 rounded-full",children:[e.jsx(ze,{size:10,className:"theme-text-muted"}),e.jsxs("span",{className:"text-xs theme-text-muted",children:[y.timeframes.slice(0,2).join(", "),y.timeframes.length>2&&` +${y.timeframes.length-2}`]})]})]})]},N)})})]})]}),e.jsxs("div",{className:"flex justify-between items-center p-6 border-t theme-border theme-surface flex-shrink-0",children:[e.jsx("div",{className:"text-sm theme-text-muted",children:"ðŸ’¡ Tapez le nom d'une nouvelle stratÃ©gie pour la crÃ©er rapidement"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 theme-text theme-surface border theme-border rounded-lg hover:theme-surface transition-colors",children:"Fermer"}),l.trim()&&!m.find(y=>y.name.toLowerCase()===l.toLowerCase())&&e.jsxs("button",{onClick:j,className:"flex items-center space-x-2 px-4 py-2 theme-text rounded-lg transition-colors",style:{backgroundColor:"var(--theme-accent)"},onMouseEnter:y=>{y.currentTarget.style.backgroundColor="var(--theme-accent-hover)"},onMouseLeave:y=>{y.currentTarget.style.backgroundColor="var(--theme-accent)"},children:[e.jsx(Je,{size:16}),e.jsxs("span",{children:['CrÃ©er "',l.slice(0,20),l.length>20?"...":"",'"']})]})]})]})]}),i&&e.jsx(hc,{initialName:l,onSave:y=>{const N=x(y);b(N.name),c(!1)},onCancel:()=>c(!1)})]})},hc=({initialName:t,onSave:s,onCancel:r})=>{const[l,n]=g.useState({name:t,description:"",category:"custom",riskLevel:"medium",complexity:"intermediate",timeframes:[],markets:[]}),o=a=>{a.preventDefault(),s(l)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-[70]",children:e.jsxs("div",{className:"theme-surface rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b theme-border",children:[e.jsx("h3",{className:"text-lg font-semibold theme-text",children:"CrÃ©er une Nouvelle StratÃ©gie"}),e.jsx("button",{onClick:r,className:"theme-text-muted hover:theme-text transition-colors",children:e.jsx(Ne,{size:20})})]}),e.jsxs("form",{onSubmit:o,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:"Nom de la stratÃ©gie *"}),e.jsx("input",{type:"text",value:l.name,onChange:a=>n(i=>({...i,name:a.target.value})),className:"w-full px-3 py-2 border theme-border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},placeholder:"Ma stratÃ©gie personnalisÃ©e",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:"Description (optionnel)"}),e.jsx("textarea",{value:l.description,onChange:a=>n(i=>({...i,description:a.target.value})),rows:3,className:"w-full px-3 py-2 border theme-border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},placeholder:"Description de votre stratÃ©gie..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:"CatÃ©gorie"}),e.jsx("select",{value:l.category,onChange:a=>n(i=>({...i,category:a.target.value})),className:"w-full px-3 py-2 border theme-border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},children:Ur.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:"Niveau de risque"}),e.jsx("select",{value:l.riskLevel,onChange:a=>n(i=>({...i,riskLevel:a.target.value})),className:"w-full px-3 py-2 border theme-border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},children:Wr.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t theme-border",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 theme-text theme-surface rounded-lg hover:theme-surface transition-colors",children:"Annuler"}),e.jsxs("button",{type:"submit",className:"flex items-center space-x-2 px-4 py-2 theme-text rounded-lg transition-colors",style:{backgroundColor:"var(--theme-accent)"},onMouseEnter:a=>{a.currentTarget.style.backgroundColor="var(--theme-accent-hover)"},onMouseLeave:a=>{a.currentTarget.style.backgroundColor="var(--theme-accent)"},children:[e.jsx(qt,{size:16}),e.jsx("span",{children:"CrÃ©er et Utiliser"})]})]})]})]})})},gc=({activeTab:t,onTabChange:s})=>{const{currentLanguage:r}=Z(),{currentTheme:l}=Q(),n=[{id:"basic",label:r==="fr"?"Informations de base":"Basic Information",icon:Fs},{id:"market",label:r==="fr"?"MarchÃ© & Trading":"Market & Trading",icon:Ka},{id:"performance",label:"Performance",icon:Mt},{id:"notes",label:"Notes & Screenshots",icon:ws},{id:"advanced",label:r==="fr"?"RÃ©sumÃ© & Frais":"Summary & Fees",icon:Ge}];return e.jsx("div",{className:"flex border-b overflow-x-auto",style:{borderColor:l.colors.border},children:n.map(o=>{const a=o.icon,i=t===o.id;return e.jsxs("button",{onClick:()=>s(o.id),className:`flex items-center px-6 py-3 transition-colors ${i?"border-b-2":"border-b-2 border-transparent"}`,style:{color:i?l.colors.accent:l.colors.textSecondary,borderBottomColor:i?l.colors.accent:"transparent",backgroundColor:i?`${l.colors.accent}10`:"transparent"},children:[e.jsx(a,{size:18,className:"mr-2"}),e.jsx("span",{className:"font-medium",children:o.label})]},o.id)})})},yc=({formData:t,onChange:s,errors:r,symbols:l})=>{const{currentLanguage:n,t:o}=Z(),{currentTheme:a}=Q(),[i,c]=g.useState(null),[d,u]=g.useState(!1),[m,p]=g.useState(""),x=g.useRef(null),f=g.useRef(null),v=t.time?t.time.split(":").map(Number):[0,0,0],[h=0,b=0,j=0]=v,y=(T,D,F)=>{const $=T.toString().padStart(2,"0"),U=D.toString().padStart(2,"0"),B=F.toString().padStart(2,"0");s("time",`${$}:${U}:${B}`)};g.useEffect(()=>{const T=D=>{x.current&&!x.current.contains(D.target)&&c(null),f.current&&!f.current.contains(D.target)&&u(!1)};return document.addEventListener("mousedown",T),()=>{document.removeEventListener("mousedown",T)}},[]);const N=T=>{const D=T.target.value;if(D===""){y(0,b,j);return}const F=parseInt(D);!isNaN(F)&&F>=0&&F<=23&&y(F,b,j)},w=T=>{const D=T.target.value;if(D===""){y(h,0,j);return}const F=parseInt(D);!isNaN(F)&&F>=0&&F<=59&&y(h,F,j)},S=T=>{const D=T.target.value;if(D===""){y(h,b,0);return}const F=parseInt(D);!isNaN(F)&&F>=0&&F<=59&&y(h,b,F)},k=T=>{s("symbol",T),u(!1)},C=m?l.filter(T=>T.toLowerCase().includes(m.toLowerCase())):l,P=["ES","NQ","YM","RTY","CL","GC","EURUSD"],R=()=>l.length>0?l.slice(0,5):P.slice(0,5),M=T=>T==null?"":String(T);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(yt,{size:16,className:"mr-2"}),"Date"]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:t.date,onChange:T=>s("date",T.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.date?a.colors.danger:a.colors.border,color:a.colors.text},required:!0}),r.date&&e.jsx("p",{className:"text-xs mt-1",style:{color:a.colors.danger},children:r.date})]})]}),e.jsxs("div",{ref:x,children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ze,{size:16,className:"mr-2"}),n==="fr"?"Heure":"Time"]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:h.toString().padStart(2,"0"),onChange:N,onClick:()=>c(i==="hours"?null:"hours"),className:"w-full px-3 py-2 border rounded-md text-center focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.time?a.colors.danger:a.colors.border,color:a.colors.text}}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:a.colors.textMuted},children:n==="fr"?"Heures":"Hours"}),i==="hours"&&e.jsx("div",{className:"absolute z-10 mt-1 w-full theme-surface border theme-border rounded-md shadow-lg",style:{backgroundColor:a.colors.card,borderColor:a.colors.border,left:"0",maxHeight:"200px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Array.from({length:24},(T,D)=>e.jsx("button",{type:"button",onClick:()=>{y(D,b,j),c(null)},className:"px-2 py-2 text-sm rounded text-center transition-colors w-full",style:{backgroundColor:h===D?`${a.colors.accent}20`:a.colors.surface,color:h===D?a.colors.accent:a.colors.text,border:`1px solid ${h===D?a.colors.accent:"transparent"}`},children:D.toString().padStart(2,"0")},D))})})})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:b.toString().padStart(2,"0"),onChange:w,onClick:()=>c(i==="minutes"?null:"minutes"),className:"w-full px-3 py-2 border rounded-md text-center focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.time?a.colors.danger:a.colors.border,color:a.colors.text}}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:a.colors.textMuted},children:"Minutes"}),i==="minutes"&&e.jsx("div",{className:"absolute z-10 mt-1 w-full theme-surface border theme-border rounded-md shadow-lg",style:{backgroundColor:a.colors.card,borderColor:a.colors.border,left:"0",maxHeight:"200px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Array.from({length:60},(T,D)=>e.jsx("button",{type:"button",onClick:()=>{y(h,D,j),c(null)},className:"px-2 py-2 text-sm rounded text-center transition-colors w-full",style:{backgroundColor:b===D?`${a.colors.accent}20`:a.colors.surface,color:b===D?a.colors.accent:a.colors.text,border:`1px solid ${b===D?a.colors.accent:"transparent"}`},children:D.toString().padStart(2,"0")},D))})})})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:j.toString().padStart(2,"0"),onChange:S,onClick:()=>c(i==="seconds"?null:"seconds"),className:"w-full px-3 py-2 border rounded-md text-center focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.time?a.colors.danger:a.colors.border,color:a.colors.text}}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:a.colors.textMuted},children:n==="fr"?"Secondes":"Seconds"}),i==="seconds"&&e.jsx("div",{className:"absolute z-10 mt-1 w-full theme-surface border theme-border rounded-md shadow-lg",style:{backgroundColor:a.colors.card,borderColor:a.colors.border,left:"0",maxHeight:"200px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Array.from({length:60},(T,D)=>e.jsx("button",{type:"button",onClick:()=>{y(h,b,D),c(null)},className:"px-2 py-2 text-sm rounded text-center transition-colors w-full",style:{backgroundColor:j===D?`${a.colors.accent}20`:a.colors.surface,color:j===D?a.colors.accent:a.colors.text,border:`1px solid ${j===D?a.colors.accent:"transparent"}`},children:D.toString().padStart(2,"0")},D))})})})]})]}),r.time&&e.jsx("p",{className:"text-xs mt-1",style:{color:a.colors.danger},children:r.time})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(_e,{size:16,className:"mr-2"}),n==="fr"?"MarchÃ©":"Market"]})}),e.jsxs("select",{value:t.market,onChange:T=>s("market",T.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.market?a.colors.danger:a.colors.border,color:a.colors.text},required:!0,children:[e.jsx("option",{value:"futures",children:"Futures"}),e.jsx("option",{value:"forex",children:"Forex"}),e.jsx("option",{value:"crypto",children:"Crypto"}),e.jsx("option",{value:"stocks",children:n==="fr"?"Actions":"Stocks"}),e.jsx("option",{value:"indices",children:"Indices"}),e.jsx("option",{value:"commodities",children:n==="fr"?"MatiÃ¨res premiÃ¨res":"Commodities"})]}),r.market&&e.jsx("p",{className:"text-xs mt-1",style:{color:a.colors.danger},children:r.market})]}),e.jsxs("div",{ref:f,children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:n==="fr"?"Symbole":"Symbol"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"text",value:t.symbol,onChange:T=>{s("symbol",T.target.value.toUpperCase()),p(T.target.value)},onClick:()=>u(!0),className:"w-full px-3 py-2 border rounded-l-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.symbol?a.colors.danger:a.colors.border,color:a.colors.text},placeholder:"Ex: ES, NQ, EURUSD",required:!0}),e.jsx("button",{type:"button",onClick:()=>u(!d),className:"px-3 py-2 border-t border-r border-b rounded-r-md",style:{backgroundColor:a.colors.surface,borderColor:r.symbol?a.colors.danger:a.colors.border,color:a.colors.text},children:e.jsx($e,{size:16,className:`transition-transform ${d?"rotate-180":""}`})})]}),d&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md shadow-lg overflow-hidden",style:{backgroundColor:a.colors.card,borderColor:a.colors.border,border:`1px solid ${a.colors.border}`},children:e.jsx("div",{className:"max-h-60 overflow-y-auto",children:e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-xs font-semibold mb-2 px-2 py-1 rounded",style:{backgroundColor:a.colors.surface,color:a.colors.textMuted},children:n==="fr"?"Symboles existants":"Existing symbols"}),C.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-1",children:C.map(T=>e.jsx("button",{type:"button",onClick:()=>k(T),className:"px-3 py-2 text-sm rounded text-left transition-colors",style:{backgroundColor:t.symbol===T?a.colors.accent+"30":a.colors.surface,color:t.symbol===T?a.colors.accent:a.colors.text,border:`1px solid ${t.symbol===T?a.colors.accent:"transparent"}`},children:T},T))}):e.jsx("div",{className:"grid grid-cols-1 gap-1",children:P.map(T=>e.jsx("button",{type:"button",onClick:()=>k(T),className:"px-3 py-2 text-sm rounded text-left transition-colors",style:{backgroundColor:t.symbol===T?a.colors.accent+"30":a.colors.surface,color:t.symbol===T?a.colors.accent:a.colors.text,border:`1px solid ${t.symbol===T?a.colors.accent:"transparent"}`},children:T},T))})]})})}),r.symbol&&e.jsx("p",{className:"text-xs mt-1",style:{color:a.colors.danger},children:r.symbol})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:R().map(T=>e.jsx("button",{type:"button",onClick:()=>s("symbol",T),className:"px-2 py-1 text-xs rounded transition-colors",style:{backgroundColor:t.symbol===T?a.colors.accent:a.colors.surface,color:t.symbol===T?"#ffffff":a.colors.text,border:`1px solid ${t.symbol===T?a.colors.accent:a.colors.border}`},children:T},T))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:"Direction"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>s("side","long"),className:`flex items-center justify-center px-4 py-2 rounded-lg transition-colors ${t.side==="long"?"shadow-md":""}`,style:{backgroundColor:t.side==="long"?a.colors.success+"20":a.colors.surface,color:t.side==="long"?a.colors.success:a.colors.text,borderWidth:1,borderStyle:"solid",borderColor:t.side==="long"?a.colors.success:a.colors.border},children:[e.jsx(Ys,{size:16,className:"mr-2"}),e.jsx("span",{children:"Long"})]}),e.jsxs("button",{type:"button",onClick:()=>s("side","short"),className:`flex items-center justify-center px-4 py-2 rounded-lg transition-colors ${t.side==="short"?"shadow-md":""}`,style:{backgroundColor:t.side==="short"?a.colors.danger+"20":a.colors.surface,color:t.side==="short"?a.colors.danger:a.colors.text,borderWidth:1,borderStyle:"solid",borderColor:t.side==="short"?a.colors.danger:a.colors.border},children:[e.jsx(cl,{size:16,className:"mr-2"}),e.jsx("span",{children:"Short"})]})]}),r.side&&e.jsx("p",{className:"text-xs mt-1",style:{color:a.colors.danger},children:r.side})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:n==="fr"?"Prix d'EntrÃ©e":"Entry Price"}),e.jsx("span",{className:"text-xs",style:{color:a.colors.textMuted},children:n==="fr"?"(Optionnel)":"(Optional)"})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:M(t.entryPrice),onChange:T=>{s("entryPrice",T.target.value)},className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.entryPrice?a.colors.danger:a.colors.border,color:a.colors.text},placeholder:"0"}),r.entryPrice&&e.jsx("p",{className:"text-xs mt-1",style:{color:a.colors.danger},children:r.entryPrice})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:n==="fr"?"Prix de Sortie":"Exit Price"}),e.jsx("span",{className:"text-xs",style:{color:a.colors.textMuted},children:n==="fr"?"(Optionnel)":"(Optional)"})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:M(t.exitPrice),onChange:T=>{s("exitPrice",T.target.value)},className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.exitPrice?a.colors.danger:a.colors.border,color:a.colors.text},placeholder:"0"}),r.exitPrice&&e.jsx("p",{className:"text-xs mt-1",style:{color:a.colors.danger},children:r.exitPrice})]})]})]})]})},bc=["Breakout Trading","Scalping","Momentum","Reversal Trading","Range Trading","Trend Following","Support/Resistance","Mean Reversion","Gap Trading","News Trading","Order Flow","Pullback Trading"],vc=["Cassure","Rebond","Divergence","Support/RÃ©sistance","Tendance","Range","Momentum","Retournement","Double Top","Double Bottom","Triple Top","Triple Bottom","Head & Shoulders","Inverse H&S","Bull Flag","Bear Flag","Triangle Ascendant","Triangle Descendant","Triangle SymÃ©trique","Wedge","Faux Breakout","Pullback"],jc={seconds:[{value:"5s",label:"5s"},{value:"10s",label:"10s"},{value:"15s",label:"15s"},{value:"30s",label:"30s"},{value:"45s",label:"45s"}],minutes:[{value:"1m",label:"1m"},{value:"2m",label:"2m"},{value:"3m",label:"3m"},{value:"5m",label:"5m"},{value:"10m",label:"10m"},{value:"15m",label:"15m"},{value:"20m",label:"20m"},{value:"30m",label:"30m"},{value:"45m",label:"45m"}],hours:[{value:"1h",label:"1h"},{value:"2h",label:"2h"},{value:"3h",label:"3h"},{value:"4h",label:"4h"},{value:"8h",label:"8h"},{value:"12h",label:"12h"}],days:[{value:"1d",label:"1d"},{value:"2d",label:"2d"},{value:"3d",label:"3d"}],weeks:[{value:"1w",label:"1w"}]},Nc=["1m","5m","15m","30m","1h","4h"],kc=({currentLanguage:t,currentTheme:s,value:r,errors:l,showDropdown:n,setShowDropdown:o,customTimeframe:a,setCustomTimeframe:i,categorizedTimeframes:c,onSelect:d,onSubmitCustom:u})=>e.jsx("div",{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex space-x-2",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx("button",{type:"button",onClick:()=>o(!n),className:"w-full px-3 py-2 border rounded-md text-left focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:s.colors.surface,borderColor:l.timeframe?s.colors.danger:s.colors.border,color:r?s.colors.text:s.colors.textMuted},children:r||(t==="fr"?"SÃ©lectionner...":"Select...")}),n&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md shadow-lg overflow-hidden",style:{backgroundColor:s.colors.card,borderColor:s.colors.border,border:`1px solid ${s.colors.border}`},children:e.jsx("div",{className:"max-h-60 overflow-y-auto",children:e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"flex space-x-1 mb-2",children:[e.jsx("input",{type:"text",value:a,onChange:m=>i(m.target.value),placeholder:"Ex: 5m, 1h, 4h, 1d, 1w",className:"flex-1 px-2 py-1 text-sm border rounded",style:{backgroundColor:s.colors.surface,borderColor:s.colors.border,color:s.colors.text},onKeyDown:m=>{m.key==="Enter"&&u()}}),e.jsx("button",{type:"button",onClick:u,className:"px-2 py-1 text-sm rounded",style:{backgroundColor:s.colors.accent,color:"#ffffff"},children:"OK"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs font-semibold mb-1 px-2 py-1 rounded",style:{backgroundColor:s.colors.surface,color:s.colors.textMuted},children:t==="fr"?"Secondes":"Seconds"}),e.jsx("div",{className:"grid grid-cols-5 gap-1",children:c.seconds.map(m=>e.jsx("button",{type:"button",onClick:()=>d(m.value),className:"px-2 py-1 text-sm rounded text-center transition-colors",style:{backgroundColor:r===m.value?s.colors.accent+"30":s.colors.surface,color:r===m.value?s.colors.accent:s.colors.text,border:`1px solid ${r===m.value?s.colors.accent:"transparent"}`},children:m.label},m.value))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs font-semibold mb-1 px-2 py-1 rounded",style:{backgroundColor:s.colors.surface,color:s.colors.textMuted},children:"Minutes"}),e.jsx("div",{className:"grid grid-cols-5 gap-1",children:c.minutes.map(m=>e.jsx("button",{type:"button",onClick:()=>d(m.value),className:"px-2 py-1 text-sm rounded text-center transition-colors",style:{backgroundColor:r===m.value?s.colors.accent+"30":s.colors.surface,color:r===m.value?s.colors.accent:s.colors.text,border:`1px solid ${r===m.value?s.colors.accent:"transparent"}`},children:m.label},m.value))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs font-semibold mb-1 px-2 py-1 rounded",style:{backgroundColor:s.colors.surface,color:s.colors.textMuted},children:t==="fr"?"Heures":"Hours"}),e.jsx("div",{className:"grid grid-cols-5 gap-1",children:c.hours.map(m=>e.jsx("button",{type:"button",onClick:()=>d(m.value),className:"px-2 py-1 text-sm rounded text-center transition-colors",style:{backgroundColor:r===m.value?s.colors.accent+"30":s.colors.surface,color:r===m.value?s.colors.accent:s.colors.text,border:`1px solid ${r===m.value?s.colors.accent:"transparent"}`},children:m.label},m.value))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold mb-1 px-2 py-1 rounded",style:{backgroundColor:s.colors.surface,color:s.colors.textMuted},children:t==="fr"?"Jours":"Days"}),e.jsx("div",{className:"grid grid-cols-3 gap-1",children:c.days.map(m=>e.jsx("button",{type:"button",onClick:()=>d(m.value),className:"px-2 py-1 text-sm rounded text-center transition-colors",style:{backgroundColor:r===m.value?s.colors.accent+"30":s.colors.surface,color:r===m.value?s.colors.accent:s.colors.text,border:`1px solid ${r===m.value?s.colors.accent:"transparent"}`},children:m.label},m.value))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold mb-1 px-2 py-1 rounded",style:{backgroundColor:s.colors.surface,color:s.colors.textMuted},children:t==="fr"?"Semaines":"Weeks"}),e.jsx("div",{className:"grid grid-cols-3 gap-1",children:c.weeks.map(m=>e.jsx("button",{type:"button",onClick:()=>d(m.value),className:"px-2 py-1 text-sm rounded text-center transition-colors",style:{backgroundColor:r===m.value?s.colors.accent+"30":s.colors.surface,color:r===m.value?s.colors.accent:s.colors.text,border:`1px solid ${r===m.value?s.colors.accent:"transparent"}`},children:m.label},m.value))})]})]})]})})})]})}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Nc.map(m=>e.jsx("button",{type:"button",onClick:()=>d(m),className:"px-2 py-1 text-xs rounded transition-colors",style:{backgroundColor:r===m?s.colors.accent:s.colors.surface,color:r===m?"#ffffff":s.colors.text,border:`1px solid ${r===m?s.colors.accent:s.colors.border}`},children:m},m))}),l.timeframe&&e.jsx("p",{className:"text-xs mt-1",style:{color:s.colors.danger},children:l.timeframe})]})}),wc=({currentLanguage:t,currentTheme:s,value:r,errors:l,showDropdown:n,setShowDropdown:o,strategies:a,onInputChange:i,onSelect:c,onOpenStrategyModal:d})=>e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsxs("button",{type:"button",onClick:()=>o(!n),className:"w-full flex items-center justify-between px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:s.colors.surface,borderColor:l.strategy?s.colors.danger:s.colors.border,color:r?s.colors.text:s.colors.textMuted},children:[e.jsx("span",{children:r||(t==="fr"?"SÃ©lectionner une stratÃ©gie...":"Select a strategy...")}),e.jsx($e,{size:16,className:`transition-transform ${n?"rotate-180":""}`})]}),n&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md shadow-lg overflow-hidden",style:{backgroundColor:s.colors.card,borderColor:s.colors.border,border:`1px solid ${s.colors.border}`},children:e.jsx("div",{className:"max-h-60 overflow-y-auto",children:e.jsxs("div",{className:"p-2",children:[e.jsx("input",{type:"text",value:r||"",onChange:u=>i(u.target.value),placeholder:t==="fr"?"Rechercher ou saisir...":"Search or type...",className:"w-full px-3 py-2 mb-2 border rounded-md",style:{backgroundColor:s.colors.surface,borderColor:s.colors.border,color:s.colors.text}}),e.jsx("div",{className:"grid grid-cols-1 gap-1",children:a.map(u=>e.jsx("button",{type:"button",onClick:()=>c(u),className:"px-3 py-2 text-sm rounded text-left transition-colors",style:{backgroundColor:r===u?s.colors.accent+"30":s.colors.surface,color:r===u?s.colors.accent:s.colors.text,border:`1px solid ${r===u?s.colors.accent:"transparent"}`},children:u},u))})]})})})]}),e.jsx("button",{type:"button",onClick:d,className:"px-3 py-2 rounded-md transition-colors",style:{backgroundColor:s.colors.accent,color:"#ffffff"},children:t==="fr"?"Choisir":"Choose"})]}),l.strategy&&e.jsx("p",{className:"text-xs mt-1",style:{color:s.colors.danger},children:l.strategy})]}),Sc=({currentLanguage:t,currentTheme:s,value:r,errors:l,showDropdown:n,setShowDropdown:o,searchText:a,setSearchText:i,options:c,quickOptions:d,onSelect:u})=>e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>o(!n),className:"w-full flex items-center justify-between px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:s.colors.surface,borderColor:l.setup?s.colors.danger:s.colors.border,color:r?s.colors.text:s.colors.textMuted},children:[e.jsx("span",{children:r||(t==="fr"?"SÃ©lectionner un setup...":"Select a setup...")}),e.jsx($e,{size:16,className:`transition-transform ${n?"rotate-180":""}`})]}),n&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md shadow-lg overflow-hidden",style:{backgroundColor:s.colors.card,borderColor:s.colors.border,border:`1px solid ${s.colors.border}`},children:e.jsx("div",{className:"max-h-60 overflow-y-auto",children:e.jsxs("div",{className:"p-2",children:[e.jsx("input",{type:"text",value:a,onChange:m=>i(m.target.value),placeholder:t==="fr"?"Rechercher ou saisir...":"Search or type...",className:"w-full px-3 py-2 mb-2 border rounded-md",style:{backgroundColor:s.colors.surface,borderColor:s.colors.border,color:s.colors.text}}),e.jsx("div",{className:"grid grid-cols-1 gap-1",children:c.map(m=>e.jsx("button",{type:"button",onClick:()=>u(m),className:"px-3 py-2 text-sm rounded text-left transition-colors",style:{backgroundColor:r===m?s.colors.accent+"30":s.colors.surface,color:r===m?s.colors.accent:s.colors.text,border:`1px solid ${r===m?s.colors.accent:"transparent"}`},children:m},m))})]})})}),l.setup&&e.jsx("p",{className:"text-xs mt-1",style:{color:s.colors.danger},children:l.setup}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:d.map(m=>e.jsx("button",{type:"button",onClick:()=>u(m),className:"px-2 py-1 text-xs rounded transition-colors",style:{backgroundColor:r===m?s.colors.accent:s.colors.surface,color:r===m?"#ffffff":s.colors.text,border:`1px solid ${r===m?s.colors.accent:s.colors.border}`},children:m},m))})]}),Cc=({currentLanguage:t,currentTheme:s,value:r,errors:l,showDropdown:n,setShowDropdown:o,newTag:a,setNewTag:i,previousTags:c,onAddTag:d,onAddFromDropdown:u,onRemoveTag:m})=>{const p=x=>{x.key==="Enter"&&(x.preventDefault(),d())};return e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:r.map(x=>e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 rounded-full",style:{backgroundColor:s.colors.accent+"20",borderColor:s.colors.accent,border:`1px solid ${s.colors.accent}40`},children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.text},children:x}),e.jsx("button",{type:"button",onClick:()=>m(x),className:"rounded-full p-0.5 hover:bg-opacity-80 transition-colors",style:{backgroundColor:s.colors.accent+"30"},children:e.jsx(Ne,{size:12,style:{color:s.colors.text}})})]},x))}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"text",value:a,onChange:x=>i(x.target.value),onKeyDown:p,placeholder:t==="fr"?"Ajouter un tag et appuyer sur EntrÃ©e":"Add a tag and press Enter",className:"w-full px-3 py-2 border rounded-l-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:s.colors.surface,borderColor:l.tags?s.colors.danger:s.colors.border,color:s.colors.text}}),e.jsx("button",{type:"button",onClick:()=>o(!n),className:"px-3 py-2 border-t border-r border-b rounded-r-md",style:{backgroundColor:s.colors.surface,borderColor:l.tags?s.colors.danger:s.colors.border,color:s.colors.text},children:e.jsx($e,{size:16,className:`transition-transform ${n?"rotate-180":""}`})})]}),n&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md shadow-lg overflow-hidden",style:{backgroundColor:s.colors.card,borderColor:s.colors.border,border:`1px solid ${s.colors.border}`},children:e.jsx("div",{className:"max-h-60 overflow-y-auto",children:e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-xs font-semibold mb-2 px-2 py-1 rounded",style:{backgroundColor:s.colors.surface,color:s.colors.textMuted},children:t==="fr"?"Tags existants":"Existing tags"}),e.jsx("div",{className:"grid grid-cols-1 gap-1",children:c.map(x=>e.jsx("button",{type:"button",onClick:()=>u(x),className:"px-3 py-2 text-sm rounded text-left transition-colors",style:{backgroundColor:r.includes(x)?s.colors.accent+"30":s.colors.surface,color:r.includes(x)?s.colors.accent:s.colors.text,border:`1px solid ${r.includes(x)?s.colors.accent:"transparent"}`},children:x},x))})]})})})]}),e.jsx("button",{type:"button",onClick:d,className:"px-3 py-2 rounded-md transition-colors",style:{backgroundColor:s.colors.accent,color:"#ffffff"},children:e.jsx(Je,{size:16})})]}),l.tags&&e.jsx("p",{className:"text-xs mt-1",style:{color:s.colors.danger},children:l.tags})]})},Pc=t=>{const[s,r]=g.useState(!1),[l,n]=g.useState(!1),[o,a]=g.useState(!1),[i,c]=g.useState(!1);return g.useEffect(()=>{const d=u=>{const{timeframeRef:m,strategyRef:p,setupRef:x,tagsRef:f}=t;m?.current&&!m.current.contains(u.target)&&r(!1),p?.current&&!p.current.contains(u.target)&&n(!1),x?.current&&!x.current.contains(u.target)&&a(!1),f?.current&&!f.current.contains(u.target)&&c(!1)};return document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[t]),{showTimeframeDropdown:s,setShowTimeframeDropdown:r,showStrategyDropdown:l,setShowStrategyDropdown:n,showSetupDropdown:o,setShowSetupDropdown:a,showTagsDropdown:i,setShowTagsDropdown:c}},Mc=(t=[])=>{const[s,r]=g.useState(t);return{previousSetups:s,setPreviousSetups:r,addSetupToPrevious:o=>{o&&!s.includes(o)&&r(a=>[o,...a])},getQuickSelectSetups:()=>{const o=[],a=new Set;for(const i of s)!a.has(i)&&o.length<5&&(a.add(i),o.push(i));return o}}},Rc=(t=[])=>{const[s,r]=g.useState(t);return{previousTags:s,setPreviousTags:r,addTagsToPrevious:a=>{const i=a.filter(c=>!s.includes(c));i.length>0&&r(c=>[...i,...c])},addSingleTagToPrevious:a=>{a&&!s.includes(a)&&r(i=>[a,...i])},getQuickSelectTags:()=>s.slice(0,5)}},Tc=({formData:t,onChange:s,errors:r,onOpenStrategyModal:l})=>{const{currentLanguage:n,t:o}=Z(),{currentTheme:a}=Q(),[i,c]=g.useState(""),[d,u]=g.useState(""),[m,p]=g.useState(""),x=g.useRef(null),f=g.useRef(null),v=g.useRef(null),h=g.useRef(null),{showTimeframeDropdown:b,setShowTimeframeDropdown:j,showStrategyDropdown:y,setShowStrategyDropdown:N,showSetupDropdown:w,setShowSetupDropdown:S,showTagsDropdown:k,setShowTagsDropdown:C}=Pc({timeframeRef:x,strategyRef:f,setupRef:v,tagsRef:h}),{previousSetups:P,setPreviousSetups:R,addSetupToPrevious:M,getQuickSelectSetups:T}=Mc(["Cassure","Rebond","Divergence","Support/RÃ©sistance","Tendance","Range","Momentum","Retournement"]),{previousTags:D,addTagsToPrevious:F,addSingleTagToPrevious:$}=Rc(["important","Ã  revoir","rÃ©ussi","Ã©chec","scalping","day trading","swing","momentum"]),U=A=>{s("timeframe",A),j(!1)},B=A=>{s("strategy",A),N(!1)},O=A=>{s("setup",A),S(!1),P.includes(A)||R(_=>[A,..._])},z=()=>{i&&(s("timeframe",i),c(""),j(!1))},q=()=>{if(m.trim()){const A=[...t.tags];if(!A.includes(m.trim())){const _=[...A,m.trim()];s("tags",_),$(m.trim())}p("")}},E=A=>{const _=[...t.tags];if(!_.includes(A)){const J=[..._,A];s("tags",J)}C(!1)},I=A=>{const _=t.tags.filter(J=>J!==A);s("tags",_)},L=(()=>{const A=[...vc];return P.forEach(_=>{A.includes(_)||A.push(_)}),d?A.filter(_=>_.toLowerCase().includes(d.toLowerCase())):A})();return g.useEffect(()=>{t.setup&&M(t.setup),t.tags&&t.tags.length>0&&F(t.tags)},[t.setup,t.tags]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{ref:x,children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ae,{size:16,className:"mr-2"}),"Timeframe"]}),e.jsx("span",{className:"text-xs",style:{color:a.colors.textMuted},children:n==="fr"?"(Optionnel pour les trades en ticks)":"(Optional for tick trading)"})]})}),e.jsx(kc,{currentLanguage:n,currentTheme:a,value:t.timeframe,errors:r,showDropdown:b,setShowDropdown:j,customTimeframe:i,setCustomTimeframe:c,categorizedTimeframes:jc,onSelect:U,onSubmitCustom:z})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:n==="fr"?"Tendance":"Trend"}),e.jsxs("select",{value:t.trend,onChange:A=>s("trend",A.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.trend?a.colors.danger:a.colors.border,color:a.colors.text},required:!0,children:[e.jsx("option",{value:"bullish",children:n==="fr"?"HaussiÃ¨re":"Bullish"}),e.jsx("option",{value:"bearish",children:n==="fr"?"BaissiÃ¨re":"Bearish"}),e.jsx("option",{value:"sideways",children:n==="fr"?"LatÃ©rale":"Sideways"})]}),r.trend&&e.jsx("p",{className:"text-xs mt-1",style:{color:a.colors.danger},children:r.trend})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:n==="fr"?"Statut":"Status"}),e.jsxs("select",{value:t.status,onChange:A=>s("status",A.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.status?a.colors.danger:a.colors.border,color:a.colors.text},required:!0,children:[e.jsx("option",{value:"closed",children:n==="fr"?"FermÃ©":"Closed"}),e.jsx("option",{value:"open",children:n==="fr"?"Ouvert":"Open"})]}),r.status&&e.jsx("p",{className:"text-xs mt-1",style:{color:a.colors.danger},children:r.status})]})]}),e.jsxs("div",{ref:f,children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{size:16,className:"mr-2"}),n==="fr"?"StratÃ©gie":"Strategy"]})}),e.jsx(wc,{currentLanguage:n,currentTheme:a,value:t.strategy,errors:r,showDropdown:y,setShowDropdown:N,strategies:bc,onInputChange:A=>s("strategy",A),onSelect:B,onOpenStrategyModal:l})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{ref:v,children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:"Setup"}),e.jsx(Sc,{currentLanguage:n,currentTheme:a,value:t.setup,errors:r,showDropdown:w,setShowDropdown:S,searchText:d,setSearchText:A=>{u(A),s("setup",A)},options:L,quickOptions:T(),onSelect:O})]}),e.jsxs("div",{ref:h,children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ds,{size:16,className:"mr-2"}),"Tags"]})}),e.jsx(Cc,{currentLanguage:n,currentTheme:a,value:t.tags,errors:r,showDropdown:k,setShowDropdown:C,newTag:m,setNewTag:p,previousTags:D,onAddTag:q,onAddFromDropdown:E,onRemoveTag:I})]})]})]})},Dc=({formData:t,onChange:s,errors:r,settings:l})=>{const{currentLanguage:n}=Z(),{currentTheme:o}=Q(),[a,i]=g.useState(null),[c,d]=g.useState("percentage"),[u,m]=g.useState("auto"),[p,x]=g.useState(0),[f,v]=g.useState(0),[h,b]=g.useState(0),[j,y]=g.useState(0),[N,w]=g.useState("");V.useEffect(()=>{if(t.duration!==void 0&&t.duration!==""){const E=Number(t.duration);if(!isNaN(E)){const I=Math.floor(E/86400),H=Math.floor(E%86400/3600),L=Math.floor(E%3600/60),A=E%60;x(I),v(H),b(L),y(A)}}t.tradeResult&&w(t.tradeResult)},[]);const S=E=>l.initialCapital*E/100,k=E=>E/l.initialCapital*100,C=()=>{const E=typeof t.ticksGained=="number"?t.ticksGained:parseFloat(String(t.ticksGained).replace(",","."))||0,I=typeof t.tickValue=="number"?t.tickValue:parseFloat(String(t.tickValue).replace(",","."))||0,H=typeof t.quantity=="number"?t.quantity:parseFloat(String(t.quantity).replace(",","."))||0;return E*I*H},P=()=>C()/l.initialCapital*100;g.useEffect(()=>{if(t.ticksGained!==void 0&&t.ticksGained!==""&&t.tickValue!==void 0&&t.tickValue!==""&&t.quantity!==void 0&&t.quantity!==""){const E=C(),I=P();s("pnlPercentage",Math.round(I*100)/100),s("pnl",Math.round(E*100)/100)}},[t.ticksGained,t.tickValue,t.quantity]);const R=E=>{w(E),s("tradeResult",E)},M=E=>{if(!E)return"0s";const I=Math.floor(E/86400),H=Math.floor(E%86400/3600),L=Math.floor(E%3600/60),A=E%60;let _="";return I>0&&(_+=`${I}j `),(H>0||I>0)&&(_+=`${H}h `),(L>0||H>0||I>0)&&(_+=`${L}m `),(A>0||!I&&!H&&!L)&&(_+=`${A}s`),_.trim()},T=(E,I,H,L)=>{const A=E*86400+I*3600+H*60+L;s("duration",A>0?A:void 0)},D=(E,I)=>{const H=parseInt(I)||0;E==="days"?(x(H),T(H,f,h,j)):E==="hours"?(v(H),T(p,H,h,j)):E==="minutes"?(b(H),T(p,f,H,j)):E==="seconds"&&(y(H),T(p,f,h,H))},F=E=>E==null?"":String(E),$=()=>t.pnlPercentage===void 0||t.pnlPercentage===""?0:parseFloat(String(t.pnlPercentage).replace(",","."))||0,U=$()>0,B=$()<0,O=()=>{d(c==="percentage"?"currency":"percentage")},z=u==="auto"||u==="ticks",q=u==="auto"||u==="lots";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm font-medium",style:{color:o.colors.textSecondary},children:n==="fr"?"RÃ©sultat:":"Result:"}),e.jsxs("div",{className:"flex space-x-1 p-1 rounded-lg",style:{backgroundColor:o.colors.surface},children:[e.jsxs("button",{type:"button",onClick:()=>R("tp"),className:"flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors",style:{backgroundColor:"transparent",color:N==="tp"?o.colors.success:o.colors.textSecondary},children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-1",style:{backgroundColor:N==="tp"?"var(--theme-success)":"var(--theme-surface)"}}),"TP"]}),e.jsxs("button",{type:"button",onClick:()=>R("sl"),className:"flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors",style:{backgroundColor:"transparent",color:N==="sl"?o.colors.danger:o.colors.textSecondary},children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-1",style:{backgroundColor:N==="sl"?"var(--theme-danger)":"var(--theme-surface)"}}),"SL"]}),e.jsxs("button",{type:"button",onClick:()=>R("be"),className:"flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors",style:{backgroundColor:"transparent",color:N==="be"?o.colors.warning:o.colors.textSecondary},children:[e.jsx("div",{className:`w-3 h-3 rounded-full mr-1 ${N==="be"?"bg-yellow-500 dark:bg-yellow-400":"theme-surface"}`}),"BE"]}),e.jsx("button",{type:"button",onClick:()=>R(""),className:"flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors",style:{backgroundColor:"transparent",color:N===""?o.colors.text:o.colors.textSecondary,border:N===""?`1px solid ${o.colors.border}`:"none"},children:n==="fr"?"Aucun":"None"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>{const E=document.getElementById("display-mode-dropdown");E&&E.classList.toggle("hidden")},className:"flex items-center space-x-2 px-3 py-2 rounded-lg text-sm transition-colors",style:{backgroundColor:o.colors.surface,color:o.colors.text,border:`1px solid ${o.colors.border}`},children:[e.jsx(ms,{size:16,className:"mr-2"}),e.jsx("span",{children:n==="fr"?"DonnÃ©es de performance":"Performance data"}),e.jsx($e,{size:14})]}),e.jsx("div",{id:"display-mode-dropdown",className:"absolute right-0 mt-1 w-48 rounded-md shadow-lg hidden z-10",style:{backgroundColor:o.colors.card,border:`1px solid ${o.colors.border}`},children:e.jsx("div",{className:"py-1",children:[{value:"auto",label:n==="fr"?"Automatique (tout afficher)":"Automatic (show all)"},{value:"ticks",label:n==="fr"?"Ticks uniquement":"Ticks only"},{value:"lots",label:n==="fr"?"Lots uniquement":"Lots only"},{value:"none",label:n==="fr"?"Aucun":"None"}].map(E=>e.jsx("button",{type:"button",onClick:()=>{m(E.value);const I=document.getElementById("display-mode-dropdown");I&&I.classList.add("hidden")},className:"block w-full text-left px-4 py-2 text-sm transition-colors",style:{backgroundColor:u===E.value?`${o.colors.accent}20`:"transparent",color:u===E.value?o.colors.accent:o.colors.text},children:E.label},E.value))})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:o.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[c==="percentage"?e.jsx(is,{size:16,className:"mr-2"}):e.jsx(sr,{size:16,className:"mr-2"}),"P&L"]}),e.jsx("button",{type:"button",onClick:O,className:"flex items-center text-xs px-2 py-1 rounded transition-colors",style:{backgroundColor:o.colors.accent+"20",color:o.colors.accent},children:c==="percentage"?e.jsxs(e.Fragment,{children:[e.jsx(sr,{size:12,className:"mr-1"}),e.jsx("span",{children:"Mode â‚¬"}),e.jsx(uc,{size:16,className:"ml-1"})]}):e.jsxs(e.Fragment,{children:[e.jsx(is,{size:12,className:"mr-1"}),e.jsx("span",{children:"Mode %"}),e.jsx(mc,{size:16,className:"ml-1"})]})})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:F(c==="percentage"?t.pnlPercentage:t.pnl),onChange:E=>{if(c==="percentage"){s("pnlPercentage",E.target.value);const I=parseFloat(String(E.target.value).replace(",","."));if(!isNaN(I)){const H=S(I);s("pnl",H)}}else{s("pnl",E.target.value);const I=parseFloat(String(E.target.value).replace(",","."));if(!isNaN(I)){const H=k(I);s("pnlPercentage",H)}}},className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.pnlPercentage?o.colors.danger:o.colors.border,color:U?o.colors.success:B?o.colors.danger:o.colors.text},placeholder:"0",required:!0}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{style:{color:o.colors.textMuted},children:c==="percentage"?"%":l.currency})}),r.pnlPercentage&&e.jsx("p",{className:"text-xs mt-1",style:{color:o.colors.danger},children:r.pnlPercentage})]}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("p",{className:"text-xs",style:{color:U?o.colors.success:B?o.colors.danger:o.colors.textMuted},children:c==="percentage"?t.pnlPercentage!==void 0&&t.pnlPercentage!==""&&e.jsx("span",{children:new Intl.NumberFormat(n==="fr"?"fr-FR":"en-US",{style:"currency",currency:l.currency,minimumFractionDigits:0,maximumFractionDigits:0}).format(S(parseFloat(String(t.pnlPercentage).replace(",","."))||0))}):t.pnl!==void 0&&t.pnl!==""&&e.jsx("span",{children:`${k(parseFloat(String(t.pnl).replace(",","."))||0)>=0?"+":""}${k(parseFloat(String(t.pnl).replace(",","."))||0).toFixed(2)}%`})}),e.jsxs("div",{className:"ml-2 cursor-help",onMouseEnter:()=>i("pnl"),onMouseLeave:()=>i(null),children:[e.jsx(Fs,{size:14,style:{color:o.colors.textMuted}}),a==="pnl"&&e.jsx("div",{className:"absolute z-10 p-2 rounded-md shadow-lg max-w-xs",style:{backgroundColor:o.colors.card,border:`1px solid ${o.colors.border}`,color:o.colors.text},children:e.jsx("p",{className:"text-xs",children:n==="fr"?"Pourcentage de gain/perte par rapport au capital initial. Le montant en devise est calculÃ© automatiquement.":"Percentage of gain/loss relative to initial capital. The amount in currency is calculated automatically."})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:o.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(_e,{size:16,className:"mr-2"}),n==="fr"?"Ratio Risk/Reward":"Risk/Reward Ratio"]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:F(t.riskReward),onChange:E=>{s("riskReward",E.target.value)},className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.riskReward?o.colors.danger:o.colors.border,color:o.colors.text},placeholder:"0"}),r.riskReward&&e.jsx("p",{className:"text-xs mt-1",style:{color:o.colors.danger},children:r.riskReward})]}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("p",{className:"text-xs",style:{color:o.colors.textMuted},children:n==="fr"?"Ratio entre le gain potentiel et la perte potentielle":"Ratio between potential gain and potential loss"}),e.jsxs("div",{className:"ml-2 cursor-help",onMouseEnter:()=>i("rr"),onMouseLeave:()=>i(null),children:[e.jsx(Fs,{size:14,style:{color:o.colors.textMuted}}),a==="rr"&&e.jsx("div",{className:"absolute z-10 p-2 rounded-md shadow-lg max-w-xs",style:{backgroundColor:o.colors.card,border:`1px solid ${o.colors.border}`,color:o.colors.text},children:e.jsx("p",{className:"text-xs",children:n==="fr"?"Ex: Un ratio de 2 signifie que vous risquez 1 pour gagner 2. Un ratio nÃ©gatif indique un trade avec un risque plus Ã©levÃ© que le gain potentiel.":"Ex: A ratio of 2 means you risk 1 to gain 2. A negative ratio indicates a trade with higher risk than potential gain."})})]})]})]})]}),q&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:o.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(_e,{size:16,className:"mr-2"}),n==="fr"?"Nombre de lots (Forex/CFD)":"Number of lots (Forex/CFD)"]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:F(t.numberOfLots),onChange:E=>{s("numberOfLots",E.target.value)},className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.numberOfLots?o.colors.danger:o.colors.border,color:o.colors.text},placeholder:"0"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{style:{color:o.colors.textMuted},children:"lots"})}),r.numberOfLots&&e.jsx("p",{className:"text-xs mt-1",style:{color:o.colors.danger},children:r.numberOfLots})]}),e.jsx("div",{className:"flex items-center mt-1",children:e.jsx("p",{className:"text-xs",style:{color:o.colors.textMuted},children:n==="fr"?"Information sur le nombre de lots pour Forex/CFD":"Information about number of lots for Forex/CFD"})})]}),z&&e.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:o.colors.surface+"30",borderColor:o.colors.border},children:[e.jsx("h3",{className:"text-sm font-medium mb-3",style:{color:o.colors.text},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{size:16,className:"mr-2"}),n==="fr"?"SystÃ¨me de Ticks (Scalping)":"Tick System (Scalping)"]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:o.colors.textSecondary},children:n==="fr"?"Ticks gagnÃ©s/perdus":"Ticks gained/lost"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:F(t.ticksGained),onChange:E=>{s("ticksGained",E.target.value)},className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.ticksGained?o.colors.danger:o.colors.border,color:parseFloat(String(t.ticksGained).replace(",","."))>0?o.colors.success:parseFloat(String(t.ticksGained).replace(",","."))<0?o.colors.danger:o.colors.text},placeholder:"0"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{style:{color:o.colors.textMuted},children:"ticks"})}),r.ticksGained&&e.jsx("p",{className:"text-xs mt-1",style:{color:o.colors.danger},children:r.ticksGained})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:o.colors.textSecondary},children:n==="fr"?"Valeur par tick":"Value per tick"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:F(t.tickValue),onChange:E=>{s("tickValue",E.target.value)},className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.tickValue?o.colors.danger:o.colors.border,color:o.colors.text},placeholder:"0"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsxs("span",{style:{color:o.colors.textMuted},children:[l.currency,"/tick"]})}),r.tickValue&&e.jsx("p",{className:"text-xs mt-1",style:{color:o.colors.danger},children:r.tickValue})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",style:{color:o.colors.textSecondary},children:[e.jsx("span",{children:n==="fr"?"Nombre de contrats":"Number of contracts"}),e.jsx("span",{className:"ml-2 text-xs",style:{color:o.colors.textMuted},children:n==="fr"?"(Optionnel)":"(Optional)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:F(t.quantity),onChange:E=>{s("quantity",E.target.value)},className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.quantity?o.colors.danger:o.colors.border,color:o.colors.text},placeholder:"0"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{style:{color:o.colors.textMuted},children:n==="fr"?"contrats":"contracts"})}),r.quantity&&e.jsx("p",{className:"text-xs mt-1",style:{color:o.colors.danger},children:r.quantity})]})]})]}),t.ticksGained!==void 0&&t.ticksGained!==""&&t.tickValue!==void 0&&t.tickValue!==""&&t.quantity!==void 0&&t.quantity!==""&&e.jsxs("div",{className:"mt-3 p-3 rounded-lg",style:{backgroundColor:o.colors.surface},children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm",style:{color:o.colors.textSecondary},children:[n==="fr"?"Valeur totale des ticks":"Total ticks value",":"]}),e.jsx("span",{className:"font-bold",style:{color:parseFloat(String(t.ticksGained).replace(",","."))>=0?o.colors.success:o.colors.danger},children:new Intl.NumberFormat(n==="fr"?"fr-FR":"en-US",{style:"currency",currency:l.currency,minimumFractionDigits:0,maximumFractionDigits:0}).format(C())})]}),e.jsx("div",{className:"text-xs mt-1",style:{color:o.colors.textMuted},children:n==="fr"?`Calcul: ${t.ticksGained} ticks Ã— ${t.tickValue} ${l.currency} Ã— ${t.quantity||0} contrat${parseFloat(String(t.quantity||0).replace(",","."))>1?"s":""}`:`Calculation: ${t.ticksGained} ticks Ã— ${t.tickValue} ${l.currency} Ã— ${t.quantity||0} contract${parseFloat(String(t.quantity||0).replace(",","."))>1?"s":""}`})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:o.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ze,{size:16,className:"mr-2"}),n==="fr"?"DurÃ©e":"Duration"]})}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{children:[e.jsx("input",{type:"number",min:"0",value:p||"",onChange:E=>D("days",E.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.duration?o.colors.danger:o.colors.border,color:o.colors.text},placeholder:"0"}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:o.colors.textMuted},children:n==="fr"?"Jours":"Days"})]}),e.jsxs("div",{children:[e.jsx("input",{type:"number",min:"0",max:"23",value:f||"",onChange:E=>D("hours",E.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.duration?o.colors.danger:o.colors.border,color:o.colors.text},placeholder:"0"}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:o.colors.textMuted},children:n==="fr"?"Heures":"Hours"})]}),e.jsxs("div",{children:[e.jsx("input",{type:"number",min:"0",max:"59",value:h||"",onChange:E=>D("minutes",E.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.duration?o.colors.danger:o.colors.border,color:o.colors.text},placeholder:"0"}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:o.colors.textMuted},children:"Minutes"})]}),e.jsxs("div",{children:[e.jsx("input",{type:"number",min:"0",max:"59",value:j||"",onChange:E=>D("seconds",E.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.duration?o.colors.danger:o.colors.border,color:o.colors.text},placeholder:"0"}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:o.colors.textMuted},children:n==="fr"?"Secondes":"Seconds"})]})]}),r.duration&&e.jsx("p",{className:"text-xs mt-1",style:{color:o.colors.danger},children:r.duration}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("p",{className:"text-xs",style:{color:o.colors.textMuted},children:typeof t.duration=="number"&&t.duration>0&&e.jsx("span",{children:M(t.duration)})}),e.jsxs("div",{className:"ml-2 cursor-help",onMouseEnter:()=>i("duration"),onMouseLeave:()=>i(null),children:[e.jsx(Fs,{size:14,style:{color:o.colors.textMuted}}),a==="duration"&&e.jsx("div",{className:"absolute z-10 p-2 rounded-md shadow-lg max-w-xs",style:{backgroundColor:o.colors.card,border:`1px solid ${o.colors.border}`,color:o.colors.text},children:e.jsx("p",{className:"text-xs",children:n==="fr"?"DurÃ©e totale du trade, du moment de l'entrÃ©e jusqu'Ã  la sortie.":"Total duration of the trade, from entry to exit."})})]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:o.colors.surface+"50"},children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(Ae,{size:18,style:{color:o.colors.accent},className:"mr-2"}),e.jsx("h3",{className:"text-sm font-medium",style:{color:o.colors.text},children:n==="fr"?"Informations de Performance":"Performance Information"})]}),e.jsxs("div",{className:"text-xs space-y-2",style:{color:o.colors.textSecondary},children:[e.jsx("p",{children:n==="fr"?"â€¢ Le P&L peut Ãªtre saisi en pourcentage ou en euros selon le mode choisi.":"â€¢ P&L can be entered as percentage or euros depending on the selected mode."}),e.jsx("p",{children:n==="fr"?"â€¢ Pour le scalping, renseignez les ticks gagnÃ©s, la valeur par tick et le nombre de contrats.":"â€¢ For scalping, enter the ticks gained, value per tick, and number of contracts."}),e.jsx("p",{children:n==="fr"?"â€¢ Pour le Forex/CFD, utilisez le champ nombre de lots (distinct des contrats).":"â€¢ For Forex/CFD, use the number of lots field (separate from contracts)."}),e.jsx("p",{children:n==="fr"?"â€¢ La durÃ©e peut Ãªtre exprimÃ©e en jours, heures, minutes et secondes.":"â€¢ Duration can be expressed in days, hours, minutes and seconds."}),e.jsx("p",{children:n==="fr"?"â€¢ Le ratio Risk/Reward reprÃ©sente le rapport entre gain potentiel et perte potentielle.":"â€¢ Risk/Reward ratio represents the relationship between potential gain and potential loss."}),e.jsx("p",{children:n==="fr"?"â€¢ Indiquez si le trade a atteint son Take Profit (TP), son Stop Loss (SL) ou son Break Even (BE).":"â€¢ Indicate if the trade reached its Take Profit (TP), Stop Loss (SL) or Break Even (BE)."})]})]})]})},Fc=({screenshots:t,onScreenshotsChange:s})=>{const r=g.useRef(null),[l,n]=g.useState(!1),{currentLanguage:o}=Z(),{currentTheme:a}=Q(),i=t.map(f=>typeof f=="string"?{url:f,caption:""}:f),c=f=>{f&&Array.from(f).forEach(v=>{if(v.type.startsWith("image/")){const h=new FileReader;h.onload=b=>{const j=b.target?.result;j&&s([...i,{url:j,caption:""}])},h.readAsDataURL(v)}})},d=f=>{f.preventDefault(),n(!1),c(f.dataTransfer.files)},u=f=>{f.preventDefault(),n(!0)},m=f=>{f.preventDefault(),n(!1)},p=f=>{const v=[...i];v.splice(f,1),s(v)},x=(f,v)=>{const h=[...i];h[f].caption=v,s(h)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium theme-text-muted",children:o==="fr"?"Screenshots du Trade":"Trade Screenshots"}),e.jsx("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${l?"border-blue-600 bg-blue-600/10":"theme-border hover:border-blue-300"}`,onDrop:d,onDragOver:u,onDragLeave:m,style:{borderColor:l?a.colors.accent:a.colors.border,backgroundColor:l?`${a.colors.accent}10`:"transparent"},children:e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx(ul,{className:"w-8 h-8",style:{color:a.colors.textMuted}}),e.jsxs("div",{className:"text-sm",style:{color:a.colors.textSecondary},children:[e.jsx("button",{type:"button",onClick:()=>r.current?.click(),className:"font-medium",style:{color:a.colors.accent},children:o==="fr"?"Cliquez pour ajouter":"Click to add"})," ",o==="fr"?"ou glissez-dÃ©posez vos screenshots":"or drag and drop your screenshots"]}),e.jsxs("div",{className:"text-xs",style:{color:a.colors.textMuted},children:["PNG, JPG, GIF ",o==="fr"?"jusqu'Ã ":"up to"," 10MB"]})]})}),e.jsx("input",{ref:r,type:"file",multiple:!0,accept:"image/*",onChange:f=>c(f.target.files),className:"hidden"}),i.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:i.map((f,v)=>e.jsxs("div",{className:"relative group border rounded-lg p-2",style:{borderColor:a.colors.border},children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:f.url,alt:`Screenshot ${v+1}`,className:"w-full h-48 object-cover rounded-lg",style:{borderColor:a.colors.border}}),e.jsx("button",{type:"button",onClick:()=>p(v),className:"absolute top-2 right-2 p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",style:{backgroundColor:a.colors.danger,color:"#ffffff"},children:e.jsx(Ne,{size:14})}),e.jsx("div",{className:"absolute bottom-2 left-2 px-2 py-1 rounded text-xs font-medium",style:{backgroundColor:"rgba(0,0,0,0.6)",color:"#ffffff"},children:v+1})]}),e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"text",value:f.caption,onChange:h=>x(v,h.target.value),placeholder:o==="fr"?"LÃ©gende du screenshot...":"Screenshot caption...",className:"w-full px-3 py-2 text-sm border rounded-md",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text}})})]},v))})]})},Ec=({formData:t,onChange:s,errors:r})=>{const{currentLanguage:l}=Z(),{currentTheme:n}=Q();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:n.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ws,{size:16,className:"mr-2"}),"Notes"]})}),e.jsx("textarea",{value:t.notes||"",onChange:o=>s("notes",o.target.value),rows:6,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:n.colors.surface,borderColor:r.notes?n.colors.danger:n.colors.border,color:n.colors.text},placeholder:l==="fr"?"Notes sur le trade, observations, leÃ§ons apprises...":"Notes about the trade, observations, lessons learned..."}),r.notes&&e.jsx("p",{className:"text-xs mt-1",style:{color:n.colors.danger},children:r.notes}),e.jsx("p",{className:"text-xs mt-1",style:{color:n.colors.textMuted},children:l==="fr"?"Documentez vos observations, les raisons de votre entrÃ©e/sortie, et les leÃ§ons apprises":"Document your observations, reasons for entry/exit, and lessons learned"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:n.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ul,{size:16,className:"mr-2"}),l==="fr"?"Screenshots du Trade":"Trade Screenshots"]})}),e.jsx(Fc,{screenshots:t.screenshots||[],onScreenshotsChange:o=>s("screenshots",o)}),e.jsx("p",{className:"text-xs mt-2",style:{color:n.colors.textMuted},children:l==="fr"?"Ajoutez des captures d'Ã©cran de votre setup, entrÃ©e, sortie ou analyse technique":"Add screenshots of your setup, entry, exit or technical analysis"})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:n.colors.surface+"50"},children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(ws,{size:18,style:{color:n.colors.accent},className:"mr-2"}),e.jsx("h3",{className:"text-sm font-medium",style:{color:n.colors.text},children:l==="fr"?"Pourquoi documenter vos trades ?":"Why document your trades?"})]}),e.jsxs("div",{className:"text-xs space-y-2",style:{color:n.colors.textSecondary},children:[e.jsx("p",{children:l==="fr"?"â€¢ Les notes dÃ©taillÃ©es vous aident Ã  identifier vos forces et faiblesses.":"â€¢ Detailed notes help you identify your strengths and weaknesses."}),e.jsx("p",{children:l==="fr"?"â€¢ Les screenshots sont essentiels pour revoir vos setups et votre analyse technique.":"â€¢ Screenshots are essential for reviewing your setups and technical analysis."}),e.jsx("p",{children:l==="fr"?"â€¢ Un journal bien documentÃ© est la clÃ© pour amÃ©liorer votre trading Ã  long terme.":"â€¢ A well-documented journal is key to improving your trading in the long run."})]})]})]})},Ac=({formData:t,onChange:s,errors:r})=>{const{currentLanguage:l}=Z(),{currentTheme:n}=Q(),[o,a]=g.useState({grossPnl:0,totalFees:0,netPnl:0}),i=m=>{if(m==null||m==="")return 0;if(typeof m=="number")return m;const p=String(m).replace(",","."),x=parseFloat(p);return isNaN(x)?0:x},c=(m,p)=>{const x={...t.fees||{}};x[m]=p;const f=["commission","spread","swapOvernight","exchangeFees","regulatoryFees","otherFees"];x.total=f.reduce((v,h)=>{const b=i(x[h]);return v+b},0),s("fees",x)},d=m=>m==null?"":String(m);g.useEffect(()=>{const m=i(t.pnl),p=t.fees?.total||0,x=m+p;a({grossPnl:m,totalFees:p,netPnl:x})},[t.pnl,t.fees]);const u=m=>new Intl.NumberFormat(l==="fr"?"fr-FR":"en-US",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}).format(m);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:n.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ge,{size:16,className:"mr-2"}),l==="fr"?"Frais et Commissions":"Fees and Commissions"]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",style:{color:n.colors.textMuted},children:"Commission"}),e.jsx("input",{type:"text",value:d(t.fees?.commission),onChange:m=>c("commission",m.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:n.colors.surface,borderColor:r.notes?n.colors.danger:n.colors.border,color:n.colors.text},placeholder:"-2.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",style:{color:n.colors.textMuted},children:"Spread"}),e.jsx("input",{type:"text",value:d(t.fees?.spread),onChange:m=>c("spread",m.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:n.colors.surface,borderColor:r.notes?n.colors.danger:n.colors.border,color:n.colors.text},placeholder:"-1.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",style:{color:n.colors.textMuted},children:l==="fr"?"Swap Overnight":"Overnight Swap"}),e.jsx("input",{type:"text",value:d(t.fees?.swapOvernight),onChange:m=>c("swapOvernight",m.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:n.colors.surface,borderColor:r.notes?n.colors.danger:n.colors.border,color:n.colors.text},placeholder:"-0.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",style:{color:n.colors.textMuted},children:l==="fr"?"Frais d'Ã‰change":"Exchange Fees"}),e.jsx("input",{type:"text",value:d(t.fees?.exchangeFees),onChange:m=>c("exchangeFees",m.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:n.colors.surface,borderColor:r.notes?n.colors.danger:n.colors.border,color:n.colors.text},placeholder:"-1.2"})]})]}),e.jsx("div",{className:"mt-4 p-3 rounded-lg",style:{backgroundColor:n.colors.surface},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",style:{color:n.colors.text},children:l==="fr"?"Total des frais":"Total fees"}),e.jsxs("span",{className:"font-bold",style:{color:n.colors.warning},children:[(t.fees?.total||0)>=0?"+":"",u(t.fees?.total||0)]})]})})]}),e.jsxs("div",{className:"mt-8 p-4 rounded-lg border",style:{backgroundColor:n.colors.surface+"30",borderColor:n.colors.border,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(qo,{size:20,className:"mr-2",style:{color:n.colors.accent}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:n.colors.text},children:l==="fr"?"RÃ©sumÃ© P&L":"P&L Summary"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ae,{size:16,className:"mr-2",style:{color:o.grossPnl>=0?n.colors.success:n.colors.danger}}),e.jsx("span",{style:{color:n.colors.textSecondary},children:l==="fr"?"P&L Brut (avant frais)":"Gross P&L (before fees)"})]}),e.jsxs("span",{className:"font-bold",style:{color:o.grossPnl>=0?n.colors.success:n.colors.danger},children:[o.grossPnl>=0?"+":"",u(o.grossPnl)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ge,{size:16,className:"mr-2",style:{color:n.colors.warning}}),e.jsx("span",{style:{color:n.colors.textSecondary},children:l==="fr"?"Frais Totaux":"Total Fees"})]}),e.jsxs("span",{className:"font-bold",style:{color:n.colors.warning},children:[o.totalFees>=0?"+":"",u(o.totalFees)]})]}),e.jsx("div",{className:"border-t my-2",style:{borderColor:n.colors.border}}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx($t,{size:16,className:"mr-2",style:{color:o.netPnl>=0?n.colors.success:n.colors.danger}}),e.jsx("span",{className:"font-medium",style:{color:n.colors.text},children:l==="fr"?"P&L Net (aprÃ¨s frais)":"Net P&L (after fees)"})]}),e.jsxs("span",{className:"text-lg font-bold",style:{color:o.netPnl>=0?n.colors.success:n.colors.danger},children:[o.netPnl>=0?"+":"",u(o.netPnl)]})]})]})]})]})},Lc=({presets:t,onSavePreset:s,onLoadPreset:r,onDeletePreset:l,onToggleFavorite:n,currentFormData:o})=>{const{currentLanguage:a}=Z(),{currentTheme:i}=Q(),[c,d]=g.useState(!1),[u,m]=g.useState(!1),[p,x]=g.useState(""),[f,v]=g.useState(!1),[h,b]=g.useState(""),[j,y]=g.useState("all"),[N,w]=g.useState(""),S=g.useRef(null),k=g.useRef(null);g.useEffect(()=>{const D=F=>{S.current&&!S.current.contains(F.target)&&(d(!1),m(!1),b(""))};return c&&document.addEventListener("mousedown",D),()=>{document.removeEventListener("mousedown",D)}},[c]),g.useEffect(()=>{u&&k.current&&k.current.focus()},[u]);const C=()=>{if(!p.trim()){b(a==="fr"?"Veuillez entrer un nom":"Please enter a name");return}if(t.some(D=>D.name.toLowerCase()===p.trim().toLowerCase())){b(a==="fr"?"Ce nom existe dÃ©jÃ ":"This name already exists");return}s(p.trim(),f),x(""),v(!1),m(!1),b("")},P=D=>{D.key==="Enter"?(D.preventDefault(),C()):D.key==="Escape"&&(m(!1),b(""))},M=[...t.filter(D=>{const F=j==="all"||j==="favorites"&&D.isFavorite,$=!N||D.name.toLowerCase().includes(N.toLowerCase());return F&&$})].sort((D,F)=>D.isFavorite&&!F.isFavorite?-1:!D.isFavorite&&F.isFavorite?1:new Date(F.createdAt).getTime()-new Date(D.createdAt).getTime()),T=()=>{if(!o)return null;const D=[];return o.symbol&&D.push(o.symbol),o.side&&D.push(o.side==="long"?"ðŸ“ˆ Long":"ðŸ“‰ Short"),o.strategy&&D.push(o.strategy),o.timeframe&&D.push(o.timeframe),D.length>0?D.join(" â€¢ "):null};return e.jsxs("div",{className:"relative",ref:S,children:[e.jsxs("button",{type:"button",onClick:()=>d(!c),className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:i.colors.surface,color:i.colors.text,border:`1px solid ${i.colors.border}`},children:[e.jsx(io,{size:16}),e.jsx("span",{children:"Presets"}),t.length>0&&e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 text-xs font-medium rounded-full",style:{backgroundColor:i.colors.accent+"30",color:i.colors.accent},children:t.length}),e.jsx($e,{size:16,className:`transition-transform ${c?"rotate-180":""}`})]}),c&&e.jsxs("div",{className:"absolute z-50 mt-2 w-80 rounded-lg shadow-lg overflow-hidden",style:{backgroundColor:i.colors.card,border:`1px solid ${i.colors.border}`,right:0},children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b",style:{borderColor:i.colors.border},children:[e.jsxs("div",{className:"flex space-x-1 p-1 rounded-lg",style:{backgroundColor:i.colors.surface},children:[e.jsxs("button",{onClick:()=>y("all"),className:`flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors ${j==="all"?"shadow-sm":""}`,style:{backgroundColor:j==="all"?i.colors.card:"transparent",color:j==="all"?i.colors.accent:i.colors.textSecondary},children:[e.jsx(io,{size:12,className:"mr-1"}),a==="fr"?"Tous":"All"]}),e.jsxs("button",{onClick:()=>y("favorites"),className:`flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors ${j==="favorites"?"shadow-sm":""}`,style:{backgroundColor:j==="favorites"?i.colors.card:"transparent",color:j==="favorites"?i.colors.accent:i.colors.textSecondary},children:[e.jsx(ot,{size:12,className:"mr-1"}),a==="fr"?"Favoris":"Favorites"]})]}),e.jsx("button",{onClick:()=>{m(!0),d(!0)},className:"p-1 rounded-full transition-colors",style:{backgroundColor:i.colors.accent+"20",color:i.colors.accent},title:a==="fr"?"Enregistrer un nouveau preset":"Save a new preset",children:e.jsx(Je,{size:16})})]}),t.length>5&&e.jsx("div",{className:"p-3 border-b",style:{borderColor:i.colors.border},children:e.jsx("input",{type:"text",value:N,onChange:D=>w(D.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:i.colors.surface,borderColor:i.colors.border,color:i.colors.text},placeholder:a==="fr"?"Rechercher un preset...":"Search presets..."})}),u&&e.jsxs("div",{className:"p-3 border-b",style:{borderColor:i.colors.border},children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:i.colors.textSecondary},children:a==="fr"?"Nom du preset":"Preset name"}),e.jsx("input",{ref:k,type:"text",value:p,onChange:D=>{x(D.target.value),b("")},onKeyDown:P,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:i.colors.surface,borderColor:h?i.colors.danger:i.colors.border,color:i.colors.text},placeholder:a==="fr"?"Ex: Scalping ES":"Ex: ES Scalping"}),h&&e.jsx("p",{className:"text-xs mt-1",style:{color:i.colors.danger},children:h})]}),T()&&e.jsxs("div",{className:"mb-2 p-2 rounded-md text-xs",style:{backgroundColor:i.colors.surface,color:i.colors.textSecondary},children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(ds,{size:12,className:"mr-1"}),e.jsx("span",{className:"font-medium",children:a==="fr"?"Contenu Ã  sauvegarder:":"Content to save:"})]}),T()]}),e.jsx("div",{className:"flex items-center mb-3",children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:()=>v(!f),className:"sr-only"}),e.jsx("div",{className:`w-4 h-4 mr-2 flex items-center justify-center rounded border ${f?"border-transparent":""}`,style:{backgroundColor:f?i.colors.warning:"transparent",borderColor:f?"transparent":i.colors.border},children:f&&e.jsx(qt,{size:12,color:"#ffffff"})}),e.jsx("span",{className:"text-xs",style:{color:i.colors.textSecondary},children:a==="fr"?"Ajouter aux favoris":"Add to favorites"})]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{type:"button",onClick:()=>{m(!1),b("")},className:"flex-1 flex items-center justify-center space-x-1 px-3 py-2 rounded-md transition-colors",style:{backgroundColor:i.colors.surface,color:i.colors.text,border:`1px solid ${i.colors.border}`},children:[e.jsx(Ne,{size:14}),e.jsx("span",{children:a==="fr"?"Annuler":"Cancel"})]}),e.jsxs("button",{type:"button",onClick:C,className:"flex-1 flex items-center justify-center space-x-1 px-3 py-2 rounded-md transition-colors",style:{backgroundColor:i.colors.accent,color:"#ffffff"},children:[e.jsx(Rt,{size:14}),e.jsx("span",{children:a==="fr"?"Enregistrer":"Save"})]})]})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto",children:M.length===0?e.jsx("div",{className:"p-4 text-center",children:N?e.jsx(e.Fragment,{children:e.jsx("p",{className:"text-sm",style:{color:i.colors.textMuted},children:a==="fr"?`Aucun rÃ©sultat pour "${N}"`:`No results for "${N}"`})}):j==="favorites"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center mb-2",children:e.jsx(ot,{size:24,style:{color:i.colors.textMuted}})}),e.jsx("p",{className:"text-sm",style:{color:i.colors.textMuted},children:a==="fr"?"Aucun preset favori":"No favorite presets"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center mb-2",children:e.jsx(io,{size:24,style:{color:i.colors.textMuted}})}),e.jsx("p",{className:"text-sm",style:{color:i.colors.textMuted},children:a==="fr"?"Aucun preset enregistrÃ©":"No saved presets"}),e.jsx("p",{className:"text-xs mt-1",style:{color:i.colors.textMuted},children:a==="fr"?"Enregistrez vos paramÃ¨tres frÃ©quents":"Save your frequent settings"})]})}):e.jsx("div",{className:"py-1",children:M.map(D=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 hover:theme-surface transition-colors",style:{borderBottom:`1px solid ${i.colors.border}20`},children:[e.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[D.isFavorite&&e.jsx(ot,{size:16,className:"mr-2 flex-shrink-0",style:{color:i.colors.warning},fill:i.colors.warning}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium truncate",style:{color:i.colors.text},children:D.name}),e.jsxs("div",{className:"flex items-center text-xs",style:{color:i.colors.textMuted},children:[e.jsx(ze,{size:10,className:"mr-1"}),new Date(D.createdAt).toLocaleDateString(a==="fr"?"fr-FR":"en-US")]})]})]}),e.jsxs("div",{className:"flex items-center space-x-1 ml-2",children:[e.jsx("button",{onClick:()=>r(D.id),className:"p-2 rounded-md transition-colors",style:{backgroundColor:i.colors.accent+"20",color:i.colors.accent},title:a==="fr"?"Appliquer ce preset":"Apply this preset",children:e.jsx(cr,{size:16})}),n&&e.jsx("button",{onClick:()=>n(D.id),className:"p-2 rounded-md transition-colors",style:{backgroundColor:i.colors.warning+"20",color:i.colors.warning},title:a==="fr"?D.isFavorite?"Retirer des favoris":"Ajouter aux favoris":D.isFavorite?"Remove from favorites":"Add to favorites",children:e.jsx(ot,{size:16,fill:D.isFavorite?i.colors.warning:"none"})}),e.jsx("button",{onClick:()=>{window.confirm(a==="fr"?`ÃŠtes-vous sÃ»r de vouloir supprimer le preset "${D.name}" ?`:`Are you sure you want to delete the preset "${D.name}"?`)&&l(D.id)},className:"p-2 rounded-md transition-colors",style:{backgroundColor:i.colors.danger+"20",color:i.colors.danger},title:a==="fr"?"Supprimer ce preset":"Delete this preset",children:e.jsx(Qt,{size:16})})]})]},D.id))})}),e.jsx("div",{className:"p-3 border-t text-xs",style:{borderColor:i.colors.border,backgroundColor:i.colors.surface+"50",color:i.colors.textMuted},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Xt,{size:12,className:"mr-1"}),e.jsx("span",{children:a==="fr"?"Les presets incluent tous les champs du formulaire":"Presets include all form fields"})]})})]})]})},jl=()=>{const[t,s]=us("trading-journal-presets",[]);return{presets:t,addPreset:(i,c,d=!1)=>{const u={id:`preset-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,name:i,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),formData:c,isFavorite:d};return s(m=>[...m,u]),u},deletePreset:i=>{s(c=>c.filter(d=>d.id!==i))},getPreset:i=>t.find(c=>c.id===i),toggleFavorite:i=>{s(c=>c.map(d=>d.id===i?{...d,isFavorite:!d.isFavorite,updatedAt:new Date().toISOString()}:d))},updatePreset:(i,c)=>{s(d=>d.map(u=>u.id===i?{...u,...c,updatedAt:new Date().toISOString()}:u))}}},$c=({trade:t,onSubmit:s,onClose:r,settings:l,existingSymbols:n,existingTrades:o})=>{const{currentTheme:a}=Q(),{currentLanguage:i}=Z(),[c,d]=g.useState("basic"),[u,m]=g.useState(!1),[p,x]=g.useState({}),f=g.useRef(null),[v,h]=g.useState(null),{presets:b,addPreset:j,deletePreset:y,getPreset:N,toggleFavorite:w}=jl(),[S,k]=g.useState({date:new Date().toISOString().split("T")[0],time:new Date().toTimeString().slice(0,8),symbol:"",side:"long",entryPrice:void 0,exitPrice:void 0,quantity:0,quantityUnit:"contracts",numberOfLots:void 0,pnlPercentage:void 0,pnl:void 0,ticksGained:void 0,tickValue:void 0,status:"closed",strategy:"",timeframe:"",market:"futures",trend:"bullish",setup:"",notes:"",tags:[],riskReward:void 0,tradeResult:"",fees:{commission:void 0,spread:void 0,swapOvernight:void 0,exchangeFees:void 0,regulatoryFees:void 0,otherFees:void 0,total:0},duration:void 0,screenshots:[]});g.useEffect(()=>{k(t?{...t,fees:t.fees||{commission:t.commission||void 0,spread:void 0,swapOvernight:void 0,exchangeFees:void 0,regulatoryFees:void 0,otherFees:void 0,total:t.commission||0},tags:t.tags||[],tradeResult:t.tradeResult||""}:$=>({...$,fees:{commission:void 0,spread:void 0,swapOvernight:void 0,exchangeFees:void 0,regulatoryFees:void 0,otherFees:void 0,total:0}}))},[t]),g.useEffect(()=>{if(S.symbol&&!S.tickValue){const $=S.symbol.toString().toUpperCase(),U=kr[$]||kr.DEFAULT;k(B=>({...B,tickValue:U}))}},[S.symbol]);const C=($,U=!0)=>{if($==null||$==="")return;if(typeof $=="number")return $;const B=String($).replace(",","."),O=parseFloat(B);if(!isNaN(O)&&!(!U&&O===0))return O},P=($,U)=>{k(B=>({...B,[$]:U})),p[$]&&x(B=>{const O={...B};return delete O[$],O}),v&&h(null)},R=()=>{const $={};S.date||($.date=i==="fr"?"La date est requise":"Date is required"),S.symbol||($.symbol=i==="fr"?"Le symbole est requis":"Symbol is required"),S.side||($.side=i==="fr"?"La direction est requise":"Direction is required");const U=C(S.entryPrice);U!==void 0&&U<0&&($.entryPrice=i==="fr"?"Le prix d'entrÃ©e doit Ãªtre un nombre positif":"Entry price must be a positive number");const B=C(S.exitPrice);B!==void 0&&B<0&&($.exitPrice=i==="fr"?"Le prix de sortie doit Ãªtre un nombre positif":"Exit price must be a positive number"),S.strategy||($.strategy=i==="fr"?"La stratÃ©gie est requise":"Strategy is required"),S.market||($.market=i==="fr"?"Le marchÃ© est requis":"Market is required"),S.status||($.status=i==="fr"?"Le statut est requis":"Status is required");const O=C(S.duration);O!==void 0&&O<0&&($.duration=i==="fr"?"La durÃ©e ne peut pas Ãªtre nÃ©gative":"Duration cannot be negative");const z=C(S.numberOfLots);return z!==void 0&&z<=0&&($.numberOfLots=i==="fr"?"Le nombre de lots doit Ãªtre supÃ©rieur Ã  0":"Number of lots must be greater than 0"),x($),Object.keys($).length===0},M=$=>{if($.preventDefault(),R()){const U={...S};if(["entryPrice","exitPrice","quantity","pnlPercentage","pnl","ticksGained","tickValue","riskReward","duration","numberOfLots"].forEach(O=>{if(O in U){const z=U[O];U[O]=C(z)}}),U.fees){const O={...U.fees};Object.keys(O).forEach(z=>{if(z!=="total"&&O[z]!==void 0){const q=O[z];O[z]=C(q,!0)}}),O.total=Object.keys(O).filter(z=>z!=="total").reduce((z,q)=>{const E=O[q];return z+(typeof E=="number"?E:0)},0),U.fees=O}s(U)}else p.date||p.symbol||p.side||p.entryPrice||p.market?d("basic"):p.strategy||p.timeframe||p.status?d("market"):p.pnlPercentage||p.ticksGained||p.tickValue||p.duration||p.riskReward?d("performance"):p.notes?d("notes"):d("advanced")},T=$=>{k(U=>({...U,strategy:$})),m(!1)},D=($,U=!1)=>{j($,S,U)},F=$=>{const U=N($);U&&(k(B=>({...B,...U.formData})),h(U.name),setTimeout(()=>{h(null)},3e3))};return g.useEffect(()=>{const $=U=>{if((U.ctrlKey||U.metaKey)&&U.key==="Enter"){U.preventDefault();const B=document.getElementById("trade-form");B&&B.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}};return window.addEventListener("keydown",$),()=>{window.removeEventListener("keydown",$)}},[]),e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:[e.jsxs("div",{className:"theme-surface rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col",style:{backgroundColor:a.colors.card,color:a.colors.text},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",style:{borderColor:a.colors.border},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h2",{className:"text-xl font-semibold",style:{color:a.colors.text},children:t?i==="fr"?"Modifier le Trade":"Edit Trade":i==="fr"?"Ajouter un Trade":"Add Trade"}),e.jsxs("div",{className:"px-3 py-1 rounded-lg text-xs font-medium",style:{backgroundColor:a.colors.surface,color:a.colors.textSecondary},children:["Ctrl+Enter ",i==="fr"?"pour sauvegarder":"to save"]}),v&&e.jsxs("div",{className:"px-3 py-1 rounded-lg text-xs font-medium flex items-center",style:{backgroundColor:a.colors.success+"20",color:a.colors.success},children:[e.jsx(qt,{size:12,className:"mr-1"}),i==="fr"?`Preset "${v}" appliquÃ©`:`Preset "${v}" applied`]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Lc,{presets:b,onSavePreset:D,onLoadPreset:F,onDeletePreset:y,onToggleFavorite:w,currentFormData:S}),e.jsx("button",{onClick:r,className:"theme-text-muted hover:theme-text transition-colors",children:e.jsx(Ne,{size:24})})]})]}),e.jsx(gc,{activeTab:c,onTabChange:d}),e.jsxs("form",{id:"trade-form",ref:f,onSubmit:M,className:"flex-1 overflow-y-auto p-6",children:[c==="basic"&&e.jsx(yc,{formData:S,onChange:P,errors:p,symbols:n}),c==="market"&&e.jsx(Tc,{formData:S,onChange:P,errors:p,onOpenStrategyModal:()=>m(!0)}),c==="performance"&&e.jsx(Dc,{formData:S,onChange:P,errors:p,settings:l}),c==="notes"&&e.jsx(Ec,{formData:S,onChange:P,errors:p}),c==="advanced"&&e.jsx(Ac,{formData:S,onChange:P,errors:p})]}),e.jsx("div",{className:"flex justify-end items-center p-6 border-t",style:{borderColor:a.colors.border},children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:a.colors.surface,color:a.colors.text,border:`1px solid ${a.colors.border}`},children:i==="fr"?"Annuler":"Cancel"}),e.jsxs("button",{type:"submit",form:"trade-form",className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:a.colors.accent,color:"#ffffff"},children:[e.jsx(Rt,{size:16}),e.jsx("span",{children:i==="fr"?"Sauvegarder":"Save"})]})]})})]}),u&&e.jsx(pc,{onSelect:T,onClose:()=>m(!1),currentValue:S.strategy||""})]})};function zc(){try{if(typeof window>"u"||!("localStorage"in window))return!1;const t="__storage_test__";return window.localStorage.setItem(t,"1"),window.localStorage.removeItem(t),!0}catch{return!1}}const Nl=zc(),Sr=new Map;function Ic(t){return Nl?window.localStorage.getItem(t):Sr.has(t)?Sr.get(t):null}function uo(t,s){if(Nl){s===null?window.localStorage.removeItem(t):window.localStorage.setItem(t,s);return}s===null?Sr.delete(t):Sr.set(t,s)}const ht={getString(t){try{return Ic(t)}catch{return null}},setString(t,s){try{uo(t,s)}catch{}},getBoolean(t){const s=this.getString(t);return s===null?null:s==="true"||s==="1"?!0:s==="false"||s==="0"?!1:null},setBoolean(t,s){this.setString(t,s?"true":"false")},getJSON(t){const s=this.getString(t);if(s===null)return null;try{return JSON.parse(s)}catch{return null}},setJSON(t,s){try{const r=JSON.stringify(s);uo(t,r)}catch{}},remove(t){uo(t,null)}},Oc=(t,s)=>{const[r,l]=g.useState("instrument-context"),[n,o]=g.useState([]),[a,i]=g.useState({}),[c,d]=g.useState(()=>ht.getBoolean("quickMode")??!1),[u,m]=g.useState("percentage"),[p,x]=g.useState(!1),f={hiddenFields:[],createdAt:new Date().toISOString()},v=()=>ht.getJSON("fieldConfig")??f,h=L=>{ht.setJSON("fieldConfig",L)},[b,j]=g.useState(v()),y=L=>!b.hiddenFields.includes(L),N=["date","market","symbol","side"],w=L=>!!(N.includes(L)||M.status==="closed"&&["exitPrice","exitDate","exitTime"].includes(L)||L==="pnl"&&u==="absolute"||L==="pnlPercentage"&&u==="percentage"),S=L=>w(L),k=L=>w(L),C=L=>{const A={hiddenFields:Array.from(new Set(L)),createdAt:new Date().toISOString()};j(A),h(A)},P=L=>{if(w(L))return;const A={...b};A.hiddenFields.includes(L)?A.hiddenFields=A.hiddenFields.filter(_=>_!==L):A.hiddenFields.push(L),A.createdAt=new Date().toISOString(),j(A),h(A)},R=()=>{j(f),h(f)},[M,T]=g.useState({date:"",time:"",symbol:"",side:void 0,entryDate:"",entryTime:"",entryPrice:void 0,exitDate:"",exitTime:"",exitPrice:void 0,quantity:void 0,quantityUnit:"contracts",numberOfLots:void 0,pnlPercentage:void 0,pnl:void 0,ticksGained:void 0,tickValue:void 0,tickSize:void 0,stopPrice:void 0,takeProfitPrice:void 0,riskRewardRatio:void 0,marginPerContract:void 0,leverage:void 0,marginRate:void 0,marginUsedOverride:void 0,status:void 0,strategy:"",timeframe:"",market:void 0,trend:void 0,setup:"",notes:"",tags:[],riskReward:void 0,tradeResult:"",fees:{commission:void 0,spread:void 0,swapOvernight:void 0,exchangeFees:void 0,regulatoryFees:void 0,otherFees:void 0,total:0},duration:void 0,screenshots:[]});g.useEffect(()=>{if(!t){const L=ht.getString("defaultPreset");if(L)try{const A=ht.getJSON("presets");if(A){const _=A.find(J=>J.id===L);_&&_.formData&&T(J=>({...J,..._.formData}))}}catch(A){console.error("Erreur lors du chargement du preset par dÃ©faut:",A)}}},[t]),g.useEffect(()=>{T(t?{...t,fees:t.fees||{commission:t.commission||void 0,spread:void 0,swapOvernight:void 0,exchangeFees:void 0,regulatoryFees:void 0,otherFees:void 0,total:t.commission||0},tags:t.tags||[],tradeResult:t.tradeResult||""}:L=>({...L,fees:{commission:void 0,spread:void 0,swapOvernight:void 0,exchangeFees:void 0,regulatoryFees:void 0,otherFees:void 0,total:0}}))},[t]);const D=(L,A)=>{T(_=>({..._,[L]:A})),a[L]&&i(_=>{const J={..._};return delete J[L],J})},F=(L,A)=>L?A==="percentage"?(s?.initialCapital||1e4)*L/100:L:0,$=()=>{const L=!c;d(L),ht.setBoolean("quickMode",L),L&&T(A=>({...A,entryPrice:void 0,exitPrice:void 0,pnlPercentage:void 0,pnl:void 0}))},U=()=>{const L={};return M.symbol||(L.symbol="Le symbole est requis"),M.market||(L.market="Le marchÃ© est requis"),M.side||(L.side="La direction est requise"),M.date||(L.date="La date de rÃ©fÃ©rence est requise"),M.quantity||(L.quantity="La quantitÃ© est requise"),u==="percentage"&&!M.pnlPercentage&&(L.pnlPercentage="Le pourcentage de gain/perte est requis"),u==="absolute"&&!M.pnl&&(L.pnl="Le montant de gain/perte est requis"),L};return g.useEffect(()=>{M.date&&!M.entryDate&&T(L=>({...L,entryDate:M.date}))},[M.date]),g.useEffect(()=>{M.time&&!M.entryTime&&T(L=>({...L,entryTime:M.time}))},[M.time]),g.useEffect(()=>{M.time&&!M.exitTime&&T(L=>({...L,exitTime:M.time}))},[M.time]),g.useEffect(()=>{if(M.pnlPercentage!==void 0&&s?.initialCapital){const L=s.initialCapital*M.pnlPercentage/100;T(A=>({...A,pnl:L}))}},[M.pnlPercentage,s?.initialCapital]),g.useEffect(()=>{if(M.ticksGained!==void 0&&M.tickValue!==void 0&&s?.initialCapital){const L=M.ticksGained*M.tickValue,A=L/s.initialCapital*100;M.pnlPercentage===void 0&&T(_=>({..._,pnl:L,pnlPercentage:A}))}},[M.ticksGained,M.tickValue,s?.initialCapital]),g.useEffect(()=>{if(M.symbol&&!M.tickValue){const L=kr[M.symbol.toUpperCase()]||kr.DEFAULT;T(A=>({...A,tickValue:L}))}},[M.symbol]),{currentStep:r,formData:M,errors:a,handleChange:D,goToNextStep:()=>{const L=["instrument-context","position-entry","position-exit","risk-reward","notes-screenshots"],A=L.indexOf(r);if(A<L.length-1){const _=L[A+1];if(_==="position-exit"&&M.status==="open"){const J=A+2;J<L.length&&l(L[J])}else l(_);n.includes(r)||o([...n,r])}},goToPreviousStep:()=>{const L=["instrument-context","position-entry","position-exit","risk-reward","notes-screenshots"],A=L.indexOf(r);if(A>0){const _=L[A-1];if(_==="position-exit"&&M.status==="open"){const J=A-2;J>=0&&l(L[J])}else l(_)}},goToStep:L=>{l(L)},isStepCompleted:L=>n.includes(L),calculateProgress:()=>{const L=["instrument-context","position-entry","position-exit","risk-reward","notes-screenshots"],A=M.status==="open"?L.length-1:L.length,_=L.indexOf(r);return Math.round(_/Math.max(A-1,1)*100)},setErrors:i,getMissingFieldsForROI:()=>{const L=[];return M.entryPrice||L.push("Prix d'entrÃ©e"),M.quantity||L.push("Taille"),M.market==="futures"&&!M.tickValue&&L.push("Multiplicateur/Valeur par tick"),L},validateStep:L=>{const A={};if(c)return!M.symbol&&y("symbol")&&(A.symbol="Le symbole est requis"),!M.market&&y("market")&&(A.market="Le marchÃ© est requis"),!M.side&&y("side")&&(A.side="La direction est requise"),!M.date&&y("date")&&(A.date="La date de rÃ©fÃ©rence est requise"),!M.quantity&&y("quantity")&&(A.quantity="La quantitÃ© est requise"),u==="percentage"&&!M.pnlPercentage&&y("pnlPercentage")&&(A.pnlPercentage="Le pourcentage de gain/perte est requis"),u==="absolute"&&!M.pnl&&y("pnl")&&(A.pnl="Le montant de gain/perte est requis"),A;switch(L){case"instrument-context":!M.symbol&&y("symbol")&&(A.symbol="Le symbole est requis"),!M.market&&y("market")&&(A.market="Le marchÃ© est requis"),!M.side&&y("side")&&(A.side="La direction est requise"),!M.date&&y("date")&&(A.date="La date de rÃ©fÃ©rence est requise"),!M.timeframe&&y("timeframe")&&(A.timeframe="Le timeframe est requis");break;case"position-entry":(ht.getString("pnlEntryMode")||"detailed")==="detailed"&&!M.entryPrice&&y("entryPrice")&&(A.entryPrice="Le prix d'entrÃ©e est requis pour le ROI"),!M.quantity&&y("quantity")&&(A.quantity="La taille est requise pour le ROI"),M.market==="futures"&&!M.tickValue&&y("tickValue")&&(A.tickValue="Le multiplicateur est requis pour les futures");break;case"position-exit":if(M.status==="closed"){!M.exitDate&&y("exitDate")&&(A.exitDate="La date de sortie est requise"),!M.exitTime&&y("exitTime")&&(A.exitTime="L'heure de sortie est requise");const J=ht.getString("pnlEntryMode")||"detailed";J==="detailed"?!M.exitPrice&&y("exitPrice")&&(A.exitPrice="Le prix de sortie est requis"):!M.pnl&&!M.pnlPercentage&&(y("pnl")||y("pnlPercentage"))&&(A.pnl="Le P&L (montant ou pourcentage) est requis"),J==="detailed"||(u==="percentage"&&!M.pnlPercentage&&y("pnlPercentage")&&(A.pnlPercentage="Le pourcentage de gain/perte est requis"),u==="absolute"&&!M.pnl&&y("pnl")&&(A.pnl="Le montant de gain/perte est requis"))}break}return A},isQuickMode:c,pnlInputMode:u,setPnlInputMode:m,toggleQuickMode:$,calculatePnL:F,validateQuickMode:U,isEditMode:p,setIsEditMode:x,fieldConfig:b,shouldShowField:y,toggleFieldVisibility:P,resetFieldConfig:R,isObligatoryField:S,isObligatoryFieldDynamic:k,applyFieldConfig:C}},qc=({currentStep:t,completedSteps:s,onStepClick:r,disabledSteps:l=[],formData:n})=>{const{currentTheme:o}=Q(),{currentLanguage:a,t:i}=Z(),c=[{id:"instrument-context",label:i.instrument___contexte||"Instrument & Contexte"},{id:"position-entry",label:i.position__entr_e_||"Position (EntrÃ©e)"},{id:"position-exit",label:i.sortie___frais||"Sortie & Frais"},{id:"risk-reward",label:i.setup___risque||"Setup & Risque"},{id:"notes-screenshots",label:i.notes___screenshots||"Notes & Screenshots"}];return e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-3 dark:bg-gray-700",style:{backgroundColor:o.colors.border+"40"},children:e.jsx("div",{className:"h-3 rounded-full transition-all duration-500 ease-in-out",style:{width:`${(c.findIndex(d=>d.id===t)+1)/c.length*100}%`,backgroundColor:o.colors.accent,boxShadow:"0 0 8px rgba(0, 0, 0, 0.1)"}})})}),e.jsx("div",{className:"flex flex-wrap items-center mt-2",style:{gap:"16px"},children:c.map((d,u)=>{const m=s.includes(d.id),p=t===d.id,x=l.includes(d.id);return e.jsxs("div",{className:"relative flex items-center",children:[e.jsxs("button",{onClick:()=>!x&&r(d.id),disabled:x,className:`flex items-center px-4 py-2.5 text-base font-medium transition-all duration-200 ${p?"shadow-md":m?"hover:opacity-100":"hover:opacity-90"} ${x?"cursor-not-allowed opacity-40":"cursor-pointer"}`,style:{backgroundColor:p?`${o.colors.accent}20`:"transparent",color:p?"#ffffff":m?o.colors.accent:o.colors.textSecondary,border:`2px solid ${p?o.colors.accent:m?o.colors.accent+"40":o.colors.border}`,clipPath:"polygon(8px 0, 100% 0, calc(100% - 8px) 100%, 0 100%)",position:"relative"},children:[e.jsx("div",{className:"mr-2.5",children:m?e.jsx(Or,{size:18}):e.jsx("div",{className:"w-4 h-4 rounded-full border-2",style:{borderColor:o.colors.border,backgroundColor:o.colors.surface}})}),e.jsx("span",{children:d.label})]}),u<c.length-1&&e.jsx("div",{className:"flex items-center justify-center",style:{width:"20px",height:"28px",color:p?o.colors.accent:m?o.colors.accent+"40":o.colors.border,fontSize:"36px",fontWeight:"bold"},children:"â†’"})]},d.id)})})]})},Uc=({progress:t,size:s=20,strokeWidth:r=2,onClick:l,className:n=""})=>{const{currentTheme:o}=Q(),a=(s-r)/2,i=a*2*Math.PI,c=i,d=i-t/100*i,m=(p=>p===0?"#6B7280":p<80?"#F59E0B":p<100?"#16A34A":"#10B981")(t);return e.jsxs("div",{className:`relative cursor-pointer ${n}`,onClick:l,style:{width:s,height:s},children:[e.jsxs("svg",{width:s,height:s,className:"transform -rotate-90",children:[e.jsx("circle",{cx:s/2,cy:s/2,r:a,stroke:"#E5E7EB",strokeWidth:r,fill:"transparent"}),e.jsx("circle",{cx:s/2,cy:s/2,r:a,stroke:m,strokeWidth:r,fill:"transparent",strokeDasharray:c,strokeDashoffset:d,strokeLinecap:"round",className:"transition-all duration-300"})]}),t===100&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{color:"#10B981"},children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})})})]})},Wc=({formData:t,settings:s,theme:r,language:l,computed:n,pnlValues:o,formatCurrency:a})=>e.jsxs("div",{className:"space-y-0.5",children:[t.exitDate&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:r.colors.textSecondary},children:l==="fr"?"Sortie":"Exit"}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-xs font-medium",style:{color:r.colors.text},children:[new Date(t.exitDate).toLocaleDateString(l==="fr"?"fr-FR":"en-US"),t.exitTime&&e.jsx("span",{className:"text-xs ml-1",style:{color:r.colors.textMuted},children:t.exitTime.substring(0,5)})]})})]}),t.exitPrice&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:r.colors.textSecondary},children:l==="fr"?"Prix":"Price"}),e.jsx("span",{className:"text-xs font-bold",style:{color:r.colors.text},children:t.exitPrice})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-1 gap-y-0.5",children:[(t.pnl!==void 0||o.pnlBrut!==null)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:r.colors.textSecondary},children:l==="fr"?"P&L Brut":"Gross P&L"}),e.jsx("span",{className:"text-xs font-bold text-right",style:{color:(t.pnl||o.pnlBrut||0)>0?r.colors.success:(t.pnl||o.pnlBrut||0)<0?r.colors.danger:r.colors.text},children:a(t.pnl||o.pnlBrut||0)})]}),n.totalFees!==0&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-xs flex items-center",style:{color:r.colors.textSecondary},children:[e.jsx(Ge,{size:10,style:{color:r.colors.textMuted},className:"mr-0.5"}),l==="fr"?"Frais":"Fees"]}),e.jsx("span",{className:"text-xs font-medium text-right",style:{color:r.colors.warning},children:a(n.totalFees)})]}),(t.pnl!==void 0||o.pnlNet!==null)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:r.colors.textSecondary},children:l==="fr"?"P&L Net":"Net P&L"}),(()=>{const i=t.pnl!==void 0?t.pnl+n.totalFees:n.netPnL,c=i>0?r.colors.success:i<0?r.colors.danger:r.colors.text;return e.jsx("span",{className:"text-xs font-bold text-right",style:{color:c},children:a(i)})})()]}),(t.pnl!==void 0||o.pnlNet!==null)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:r.colors.textSecondary},children:l==="fr"?"ROI brut (position)":"Gross ROI (position)"}),e.jsx("span",{className:"text-xs font-bold text-right",style:{color:(t.pnl!==void 0?t.pnl:o.pnlBrut||0)>0?r.colors.success:(t.pnl!==void 0?t.pnl:o.pnlBrut||0)<0?r.colors.danger:r.colors.text},children:`${n.roiGrossPercentage>0?"+":""}${n.roiGrossPercentage.toFixed(2)}%`}),e.jsx("span",{className:"text-xs",style:{color:r.colors.textSecondary},children:l==="fr"?"ROI net":"Net ROI"}),e.jsx("span",{className:"text-xs font-bold text-right",style:{color:(t.pnl!==void 0?t.pnl:o.pnlBrut||0)>0?r.colors.success:(t.pnl!==void 0?t.pnl:o.pnlBrut||0)<0?r.colors.danger:r.colors.text},children:`${n.roiPercentage>0?"+":""}${n.roiPercentage.toFixed(2)}%`}),e.jsx("span",{className:"text-xs",style:{color:r.colors.textSecondary},children:l==="fr"?"% sur capital initial":"% on initial capital"}),e.jsx("span",{className:"text-xs font-bold text-right",style:{color:(t.pnl!==void 0?t.pnl:o.pnlBrut||0)>0?r.colors.success:(t.pnl!==void 0?t.pnl:o.pnlBrut||0)<0?r.colors.danger:r.colors.text},children:`${n.initialCapitalPercentage>0?"+":""}${n.initialCapitalPercentage.toFixed(2)}%`}),e.jsx("span",{className:"text-xs",style:{color:r.colors.textSecondary},children:l==="fr"?"% sur capital actuel":"% on current capital"}),e.jsx("span",{className:"text-xs font-bold text-right",style:{color:(t.pnl!==void 0?t.pnl:o.pnlBrut||0)>0?r.colors.success:(t.pnl!==void 0?t.pnl:o.pnlBrut||0)<0?r.colors.danger:r.colors.text},children:`${n.currentCapitalPercentage>0?"+":""}${n.currentCapitalPercentage.toFixed(2)}%`})]}),t.duration!==void 0&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-xs flex items-center",style:{color:r.colors.textSecondary},children:[e.jsx(ze,{size:10,style:{color:r.colors.textMuted},className:"mr-0.5"}),l==="fr"?"DurÃ©e":"Duration"]}),e.jsxs("span",{className:"text-xs font-medium text-right",style:{color:r.colors.text},children:[t.duration,"s"]})]})]})]}),_c=({formData:t,theme:s,language:r})=>e.jsxs("div",{className:"space-y-1",children:[t.tradeResult&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:r==="fr"?"RÃ©sultat":"Result"}),e.jsx("span",{className:"px-1.5 py-0.5 text-xs font-medium rounded",style:{backgroundColor:t.tradeResult==="tp"?`${s.colors.success}20`:t.tradeResult==="sl"?`${s.colors.danger}20`:`${s.colors.warning}20`,color:t.tradeResult==="tp"?s.colors.success:t.tradeResult==="sl"?s.colors.danger:s.colors.warning},children:t.tradeResult})]}),(t.riskRewardRatio||t.riskReward)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:"R:R"}),e.jsxs("span",{className:"text-xs font-bold",style:{color:s.colors.accent},children:[t.riskRewardRatio??t.riskReward,":1"]})]}),t.trend&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:r==="fr"?"Tendance":"Trend"}),e.jsx("span",{className:"text-xs font-medium",style:{color:s.colors.text},children:t.trend})]}),t.setup&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:"Setup"}),e.jsx("span",{className:"text-xs font-medium",style:{color:s.colors.text},children:t.setup})]}),t.strategy&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:r==="fr"?"StratÃ©gie":"Strategy"}),e.jsx("span",{className:"text-xs font-medium",style:{color:s.colors.text},children:t.strategy})]})]}),Vc=({formData:t,theme:s,language:r})=>e.jsxs("div",{className:"space-y-0.5",children:[t.side&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:"Direction"}),e.jsx("span",{className:"px-1 py-0 text-xs font-medium rounded",style:{backgroundColor:t.side==="long"?`${s.colors.success}20`:`${s.colors.danger}20`,color:t.side==="long"?s.colors.success:s.colors.danger},children:t.side==="long"?"LONG":"SHORT"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-1 gap-y-0.5",children:[t.market&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:r==="fr"?"MarchÃ©":"Market"}),e.jsx("span",{className:"text-xs font-medium text-right",style:{color:s.colors.text},children:t.market.charAt(0).toUpperCase()+t.market.slice(1)})]}),t.symbol&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:r==="fr"?"Symbole":"Symbol"}),e.jsx("span",{className:"text-xs font-bold text-right",style:{color:s.colors.text},children:t.symbol})]}),t.date&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:"Date"}),e.jsx("span",{className:"text-xs font-medium text-right",style:{color:s.colors.text},children:new Date(t.date).toLocaleDateString(r==="fr"?"fr-FR":"en-US")})]}),t.timeframe&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:"Timeframe"}),e.jsx("span",{className:"text-xs font-medium text-right",style:{color:s.colors.text},children:t.timeframe})]})]})]});function at(t,s=0){const r=typeof t=="string"||typeof t=="number"?Number(t):NaN;return Number.isFinite(r)?r:s}function Bc(t,s){const r=at(t.entryPrice),l=at(t.exitPrice),n=at(t.quantity),o=at(t.tickSize),a=at(t.tickValue),i=t.side==="long"?1:t.side==="short"?-1:0,c=t.market==="futures"&&o>0?a/o:1;let d=0;r>0&&l>0&&n>0&&i!==0&&(t.market==="futures"?d=(l-r)*c*n*i:d=(l-r)*n*i);const u=t.fees||{},m=at(u.commission),p=at(u.spread)+at(u.spread_slippage),x=at(u.swapOvernight)+at(u.swap_overnight),f=at(u.exchangeFees),v=at(u.regulatoryFees),h=at(u.otherFees)+at(u.other),b=m+p+x+f+v+h,j=d+b,y=r>0&&n>0?r*n:0,N=y>0?j/y*100:0,w=y>0?d/y*100:0,S=at(s.initialCapital,0),k=at(s.currentCapital,S),C=S>0?j/S*100:0,P=k>0?j/k*100:0;return{grossPnL:d,totalFees:b,netPnL:j,roiPercentage:N,roiGrossPercentage:w,initialCapitalPercentage:C,currentCapitalPercentage:P}}const Jo=({formData:t,settings:s,missingFields:r,onProgressClick:l,currentStep:n="instrument-context",onOpenModal:o,disableRingClick:a=!1,headerClickable:i=!1})=>{const{currentTheme:c}=Q(),{currentLanguage:d}=Z(),[u,m]=g.useState(!1),p=R=>R===void 0?"-":new Intl.NumberFormat(d==="fr"?"fr-FR":"en-US",{style:"currency",currency:s.currency}).format(R),f=(()=>{const M=["instrument-context","position-entry","position-exit","risk-reward","notes-screenshots"].indexOf(n);return{instrument:!0,position:M>=1,exit:M>=2,performance:M>=2,setup:M>=3,notes:M>=4}})(),h=(()=>{let R=[];switch(n){case"instrument-context":R=["status","side","market","symbol","timeframe","date"];break;case"position-entry":R=["entryDate","entryTime","entryPrice","quantity"];break;case"position-exit":R=["exitDate","exitTime","exitPrice","pnl"];break;case"risk-reward":R=["strategy","setup","trend","tradeResult"];break;case"notes-screenshots":R=["notes"];break;default:R=["status","side","market","symbol","timeframe","date"]}const M=R.filter(F=>{const $=t[F];return $!=null&&$!==""}).length,T=R.length,D=M/T*100;return{done:M,total:T,percent:D}})(),b=typeof window<"u"&&localStorage.getItem("summary-debug")==="1",y=(()=>{let R=[],M={};switch(n){case"instrument-context":R=["status","side","market","symbol","timeframe","date"],M={status:d==="fr"?"Statut":"Status",side:"Direction",market:d==="fr"?"MarchÃ©":"Market",symbol:d==="fr"?"Symbole":"Symbol",timeframe:"Timeframe",date:"Date"};break;case"position-entry":R=["entryDate","entryTime","entryPrice","quantity"],M={entryDate:d==="fr"?"Date d'entrÃ©e":"Entry Date",entryTime:d==="fr"?"Heure d'entrÃ©e":"Entry Time",entryPrice:d==="fr"?"Prix d'entrÃ©e":"Entry Price",quantity:d==="fr"?"QuantitÃ©":"Quantity"};break;case"position-exit":R=["exitDate","exitTime","exitPrice","pnl"],M={exitDate:d==="fr"?"Date de sortie":"Exit Date",exitTime:d==="fr"?"Heure de sortie":"Exit Time",exitPrice:d==="fr"?"Prix de sortie":"Exit Price",pnl:"P&L"};break;case"risk-reward":R=["strategy","setup","trend","tradeResult"],M={strategy:d==="fr"?"StratÃ©gie":"Strategy",setup:"Setup",trend:d==="fr"?"Tendance":"Trend",tradeResult:d==="fr"?"RÃ©sultat":"Result"};break;case"notes-screenshots":R=["notes"],M={notes:"Notes"};break;default:R=["status","side","market","symbol","timeframe","date"],M={status:d==="fr"?"Statut":"Status",side:"Direction",market:d==="fr"?"MarchÃ©":"Market",symbol:d==="fr"?"Symbole":"Symbol",timeframe:"Timeframe",date:"Date"}}return R.filter(T=>{const D=t[T];return D==null||D===""}).map(T=>M[T])})(),w=(()=>{const R=parseFloat(t.entryPrice?.toString()||"0"),M=parseFloat(t.exitPrice?.toString()||"0"),T=parseFloat(t.quantity?.toString()||"0"),D=parseFloat(t.tickSize?.toString()||"0"),F=parseFloat(t.tickValue?.toString()||"0"),$=t.side==="long"?1:-1,U=t.market==="futures"&&D>0?F/D:1;let B=null;R>0&&M>0&&T>0&&(t.market==="futures"?B=(M-R)*U*T*$:B=(M-R)*T*$);const O=t.fees||{},z=parseFloat(O.commission?.toString()||"0"),q=parseFloat(O.spread?.toString()||"0"),E=parseFloat(O.swapOvernight?.toString()||"0"),I=parseFloat(O.exchangeFees?.toString()||"0"),H=parseFloat(O.regulatoryFees?.toString()||"0"),L=parseFloat(O.otherFees?.toString()||"0"),A=z+q+E+I+H+L;let _=null;B!==null&&(_=B+A);let J=null;if(_!==null){const re=s.currentCapital||s.initialCapital||1e4;J=re>0?_/re*100:0}return{pnlBrut:B,totalFees:A,pnlNet:_,pnlPercentage:J}})(),S=g.useMemo(()=>Bc(t,s),[t,s]),k=()=>{a||(l&&l(),m(!0),setTimeout(()=>m(!1),3e3))},C=({title:R,icon:M})=>e.jsxs("div",{className:"flex items-center justify-between py-1 px-1.5 rounded border border-dashed opacity-50",style:{borderColor:c.colors.border+"50"},children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(M,{size:10,style:{color:c.colors.textMuted}}),e.jsx("span",{className:"text-xs font-medium",style:{color:c.colors.textMuted},children:R})]}),e.jsx("span",{className:"text-xs",children:"ðŸ”’"})]}),P=({title:R,icon:M,children:T})=>e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{className:"flex items-center space-x-1 mb-1 py-0.5",children:[e.jsx(M,{size:10,style:{color:c.colors.accent}}),e.jsx("span",{className:"text-xs font-bold",style:{color:c.colors.text},children:R}),e.jsx("span",{className:"text-xs",children:"âœ…"})]}),T]});return e.jsxs("div",{className:"h-full",children:[e.jsxs("div",{className:`flex items-center justify-between py-2 px-3 border-b mb-2 ${i?"cursor-pointer":""}`,style:{borderColor:c.colors.border,background:`linear-gradient(180deg, ${c.colors.surface}50 0%, transparent 100%)`},onClick:i&&o?()=>o():void 0,children:[e.jsx("h3",{className:"font-bold text-sm",style:{color:c.colors.text},children:d==="fr"?"RÃ©sumÃ© du Trade":"Trade Summary"}),e.jsxs("div",{className:"flex items-center space-x-2 relative",onClick:R=>{i&&R.stopPropagation()},children:[e.jsxs("span",{className:"text-sm",style:{color:c.colors.textMuted},children:[h.done,"/",h.total]}),e.jsxs("div",{className:"relative",children:[e.jsx(Uc,{progress:h.percent,size:24,strokeWidth:2.5,onClick:k}),u&&y.length>0&&e.jsxs("div",{className:"absolute z-50 px-3 py-2 rounded shadow-lg border text-sm max-w-xs",style:{backgroundColor:c.colors.card,borderColor:c.colors.border,color:c.colors.text,top:"100%",right:"0",transform:"translateX(0)",marginTop:"8px",maxWidth:"220px",wordWrap:"break-word"},children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Ja,{size:14,style:{color:c.colors.warning,marginTop:"2px"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium text-sm",children:d==="fr"?"Champs manquants":"Missing fields"}),e.jsx("div",{className:"text-sm mt-1",style:{color:c.colors.textMuted},children:y.join(", ")})]})]}),e.jsx("div",{className:"absolute w-2 h-2 transform rotate-45 -top-1 right-4",style:{backgroundColor:c.colors.card}})]})]}),h.percent<100&&e.jsxs("span",{className:"text-xs",style:{color:c.colors.text},children:[Math.round(h.percent),"%"]})]})]}),e.jsxs("div",{className:"px-1.5 space-y-1",children:[e.jsx(P,{title:d==="fr"?"Instrument & Contexte":"Instrument & Context",icon:_e,children:e.jsx(Vc,{formData:t,theme:c,language:d})}),f.position?e.jsx(P,{title:d==="fr"?"Position (EntrÃ©e)":"Position (Entry)",icon:Ae,children:e.jsxs("div",{className:"space-y-0.5",children:[t.entryDate&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:c.colors.textSecondary},children:d==="fr"?"EntrÃ©e":"Entry"}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-xs font-medium",style:{color:c.colors.text},children:[new Date(t.entryDate).toLocaleDateString(d==="fr"?"fr-FR":"en-US"),t.entryTime&&e.jsx("span",{className:"text-xs ml-1",style:{color:c.colors.textMuted},children:t.entryTime.substring(0,5)})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-1 gap-y-0.5",children:[t.entryPrice&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:c.colors.textSecondary},children:d==="fr"?"Prix":"Price"}),e.jsx("span",{className:"text-xs font-bold text-right",style:{color:c.colors.text},children:t.entryPrice})]}),t.quantity&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:c.colors.textSecondary},children:d==="fr"?"Taille":"Size"}),e.jsxs("span",{className:"text-xs font-medium text-right",style:{color:c.colors.text},children:[t.quantity," ",t.quantityUnit||"contrats"]})]}),t.stopPrice&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:c.colors.textSecondary},children:"Stop"}),e.jsx("span",{className:"text-xs font-medium text-right",style:{color:c.colors.danger},children:t.stopPrice})]}),t.takeProfitPrice&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:c.colors.textSecondary},children:"TP"}),e.jsx("span",{className:"text-xs font-medium text-right",style:{color:c.colors.success},children:t.takeProfitPrice})]})]})]})}):e.jsx(C,{title:d==="fr"?"Position (EntrÃ©e)":"Position (Entry)",icon:Ae}),f.exit?e.jsxs(P,{title:d==="fr"?"Sortie & Frais":"Exit & Fees",icon:Te,children:[e.jsx(Wc,{formData:t,settings:s,theme:c,language:d,computed:S,pnlValues:w,formatCurrency:p}),b&&e.jsx("div",{className:"mt-1 p-1.5 rounded border",style:{backgroundColor:c.colors.surface,borderColor:c.colors.border},children:e.jsxs("div",{className:"text-xs",style:{color:c.colors.textMuted},children:["netPnL: ",S.netPnL.toFixed(2)," | ROI: ",S.roiPercentage.toFixed(2),"% | %init: ",S.initialCapitalPercentage.toFixed(2),"% | %current: ",S.currentCapitalPercentage.toFixed(2),"%"]})})]}):e.jsx(C,{title:d==="fr"?"Sortie & Frais":"Exit & Fees",icon:Te}),f.setup?e.jsx(P,{title:d==="fr"?"Setup & Risque":"Setup & Risk",icon:_e,children:e.jsx(_c,{formData:t,theme:c,language:d})}):e.jsx(C,{title:d==="fr"?"Setup & Risque":"Setup & Risk",icon:_e}),f.notes?e.jsx(P,{title:"Notes",icon:ws,children:e.jsx("div",{className:"space-y-1",children:t.notes&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium",style:{color:c.colors.textSecondary},children:"Notes"}),e.jsx("div",{className:"text-xs p-1.5 rounded max-h-16 overflow-y-auto",style:{backgroundColor:c.colors.surface,color:c.colors.text},children:t.notes})]})})}):e.jsx(C,{title:"Notes",icon:ws})]})]})},Hc=({searchQuery:t,onSearchChange:s,showCustom:r,onToggleCustom:l,customValue:n,onCustomValueChange:o,customType:a,onCustomTypeChange:i,onCustomSubmit:c,theme:d,currentLanguage:u})=>{const m=g.useRef(null),p={seconds:u==="fr"?"Secondes":"Seconds",minutes:"Minutes",hours:u==="fr"?"Heures":"Hours",days:u==="fr"?"Jours":"Days",weeks:u==="fr"?"Semaines":"Weeks",months:u==="fr"?"Mois":"Months",ticks:"Ticks"},x={seconds:60,minutes:60,hours:24,days:7,weeks:3,months:12,ticks:1e4};return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(vt,{size:16,className:"absolute left-2 top-1/2 transform -translate-y-1/2",style:{color:d.colors.textMuted}}),e.jsx("input",{ref:m,type:"text",value:t,onChange:f=>s(f.target.value),placeholder:u==="fr"?"Rechercher / saisir (ex: 5m, 1h, 2d, 1mo, 1000tick)":"Search / type (ex: 5m, 1h, 2d, 1mo, 1000tick)",className:"w-full pl-8 pr-3 py-1.5 border rounded-lg focus:outline-none focus:ring-2 transition-colors text-sm",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.text}})]}),e.jsxs("button",{onClick:l,className:`px-3 py-1.5 rounded-lg border transition-colors text-sm ${r?"bg-blue-500 text-white":""}`,style:{backgroundColor:r?d.colors.accent:d.colors.card,borderColor:d.colors.border,color:r?"#ffffff":d.colors.text},children:[e.jsx(Je,{size:14,className:"inline mr-1"}),"Custom"]})]}),r&&e.jsx("div",{className:"mt-1 p-2 rounded-lg",style:{backgroundColor:d.colors.surface},children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("select",{value:a,onChange:f=>i(f.target.value),className:"px-2 py-1 border rounded-lg focus:outline-none focus:ring-2 text-sm",style:{backgroundColor:d.colors.card,borderColor:d.colors.border,color:d.colors.text},children:Object.entries(p).map(([f,v])=>e.jsx("option",{value:f,children:v},f))}),e.jsx("input",{type:"number",value:n,onChange:f=>o(f.target.value),placeholder:"5",min:"1",max:x[a],className:"px-2 py-1 border rounded-lg focus:outline-none focus:ring-2 w-16 text-sm",style:{backgroundColor:d.colors.card,borderColor:d.colors.border,color:d.colors.text}}),e.jsx("button",{onClick:c,className:"px-3 py-1 rounded-lg text-white transition-colors text-sm",style:{backgroundColor:d.colors.accent},children:u==="fr"?"Ajouter":"Add"})]}),e.jsx("div",{className:"text-xs",style:{color:d.colors.textMuted},children:u==="fr"?`Exemple: 5 ${p[a]} (max: ${x[a]})`:`Example: 5 ${p[a]} (max: ${x[a]})`})]})})]})},Gc=[{id:"intraday",label:"Intraday",icon:"âš¡"},{id:"daily",label:"Jours+",icon:"ðŸ“…"},{id:"ticks",label:"Ticks (AvancÃ©)",icon:"ðŸŽ¯"}],Jc=({activeCategory:t,onCategoryChange:s,theme:r,currentLanguage:l})=>e.jsx("div",{className:"flex space-x-1",children:Gc.map(n=>e.jsxs("button",{onClick:()=>s(n.id),className:`flex-1 flex items-center justify-center px-3 py-2 font-medium transition-all duration-200 ${t===n.id?"shadow-md":"hover:shadow-sm"}`,style:{backgroundColor:(t===n.id,"transparent"),color:t===n.id?r.colors.accent:r.colors.text,border:`2px solid ${t===n.id?r.colors.accent:r.colors.border}`,clipPath:"polygon(8px 0, 100% 0, calc(100% - 8px) 100%, 0 100%)"},children:[e.jsx("span",{className:"mr-1.5 text-xs",children:n.icon}),e.jsx("span",{className:"text-xs font-semibold",children:n.label})]},n.id))}),Co=({option:t,isCustom:s,isSelected:r,isFavorite:l,onSelect:n,onToggleFavorite:o,onDeleteCustom:a,theme:i})=>e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:()=>n(t.value),className:`px-3 py-1.5 text-sm rounded-md border transition-all duration-200 hover:shadow-sm ${r?"ring-2":""} ${s?"border-dashed":""}`,style:{backgroundColor:r?i.colors.accent:i.colors.card,borderColor:r||s?i.colors.accent:i.colors.border,color:r?"#ffffff":i.colors.text},title:s?"Timeframe personnalisÃ©":"",children:[t.label,s&&e.jsx("span",{className:"ml-1 text-xs",children:"â˜…"})]}),e.jsx("button",{onClick:c=>o(t.value,c),className:"absolute -top-1 -right-1 p-1 rounded-full bg-yellow-500 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:bg-yellow-600",title:l?"Retirer des favoris":"Ajouter aux favoris",children:e.jsx(ot,{size:12,fill:l?"#ffffff":"none",style:{color:"#ffffff"}})}),s&&a&&e.jsx("button",{onClick:c=>a(t.value,c),className:"absolute -top-1 -left-1 p-1 rounded-full bg-red-500 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:bg-red-600",title:"Supprimer ce timeframe personnalisÃ©",children:e.jsx(Qt,{size:12})})]}),Ht=({title:t,options:s,customTimeframes:r,favorites:l,currentValue:n,onSelect:o,onToggleFavorite:a,onDeleteCustom:i,theme:c,currentLanguage:d})=>e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs font-semibold mb-2",style:{color:c.colors.textMuted},children:t}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.map(u=>{const m=r.some(f=>f.value===u.value),p=n===u.value,x=l.includes(u.value);return e.jsx(Co,{option:u,isCustom:m,isSelected:p,isFavorite:x,onSelect:o,onToggleFavorite:a,onDeleteCustom:i,theme:c},u.value)})})]}),Kc=({favorites:t,recent:s,allOptions:r,customTimeframes:l,currentValue:n,onSelect:o,onToggleFavorite:a,onDeleteCustom:i,theme:c,currentLanguage:d})=>{const u=p=>r.find(x=>x.value===p),m=["1m","5m","15m","1h","4h","1d"];return e.jsxs("div",{className:"flex items-center gap-4",children:[s.length>0?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"ðŸ•’"}),e.jsxs("span",{className:"text-xs font-medium",style:{color:c.colors.textMuted},children:[d==="fr"?"RÃ©cents":"Recent",":"]}),e.jsx("div",{className:"flex gap-1",children:s.slice(0,4).reverse().map(p=>{const x=u(p);if(!x)return null;const f=l.some(b=>b.value===p),v=n===p,h=t.includes(p);return e.jsx(Co,{option:x,isCustom:f,isSelected:v,isFavorite:h,onSelect:o,onToggleFavorite:a,onDeleteCustom:i,theme:c},p)})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"âš¡"}),e.jsxs("span",{className:"text-xs font-medium",style:{color:c.colors.textMuted},children:[d==="fr"?"Populaires":"Popular",":"]}),e.jsx("div",{className:"flex gap-1",children:m.slice(0,4).map(p=>{const x=u(p);if(!x)return null;const f=n===p;return e.jsx("button",{onClick:()=>o(p),className:`px-2 py-1 text-xs rounded transition-all duration-200 ${f?"shadow-md transform scale-105":"hover:shadow-sm"}`,style:{backgroundColor:f?c.colors.accent:c.colors.surface,color:f?"#ffffff":c.colors.text,border:`1px solid ${f?"transparent":c.colors.border}`},children:x.label},p)})})]}),t.length>0?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"â­"}),e.jsxs("span",{className:"text-xs font-medium",style:{color:c.colors.textMuted},children:[d==="fr"?"Favoris":"Favorites",":"]}),e.jsx("div",{className:"flex gap-1",children:t.slice(0,4).map(p=>{const x=u(p);if(!x)return null;const f=l.some(b=>b.value===p),v=n===p;return e.jsx(Co,{option:x,isCustom:f,isSelected:v,isFavorite:!0,onSelect:o,onToggleFavorite:a,onDeleteCustom:i,theme:c},p)})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"â­"}),e.jsxs("span",{className:"text-xs font-medium",style:{color:c.colors.textMuted},children:[d==="fr"?"Populaires":"Popular",":"]}),e.jsx("div",{className:"flex gap-1",children:m.slice(4,6).map(p=>{const x=u(p);if(!x)return null;const f=n===p;return e.jsx("button",{onClick:()=>o(p),className:`px-2 py-1 text-xs rounded transition-all duration-200 ${f?"shadow-md transform scale-105":"hover:shadow-sm"}`,style:{backgroundColor:f?c.colors.accent:c.colors.surface,color:f?"#ffffff":c.colors.text,border:`1px solid ${f?"transparent":c.colors.border}`},children:x.label},p)})})]})]})},bn=[{value:"1s",label:"1s",category:"seconds"},{value:"5s",label:"5s",category:"seconds"},{value:"10s",label:"10s",category:"seconds"},{value:"15s",label:"15s",category:"seconds"},{value:"30s",label:"30s",category:"seconds"},{value:"45s",label:"45s",category:"seconds"},{value:"1m",label:"1m",category:"minutes"},{value:"2m",label:"2m",category:"minutes"},{value:"3m",label:"3m",category:"minutes"},{value:"5m",label:"5m",category:"minutes"},{value:"10m",label:"10m",category:"minutes"},{value:"15m",label:"15m",category:"minutes"},{value:"30m",label:"30m",category:"minutes"},{value:"45m",label:"45m",category:"minutes"},{value:"50m",label:"50m",category:"minutes"},{value:"1h",label:"1h",category:"hours"},{value:"2h",label:"2h",category:"hours"},{value:"4h",label:"4h",category:"hours"},{value:"6h",label:"6h",category:"hours"},{value:"8h",label:"8h",category:"hours"},{value:"12h",label:"12h",category:"hours"},{value:"1d",label:"1d",category:"days"},{value:"2d",label:"2d",category:"days"},{value:"3d",label:"3d",category:"days"},{value:"4d",label:"4d",category:"days"},{value:"5d",label:"5d",category:"days"},{value:"1w",label:"1w",category:"weeks"},{value:"2w",label:"2w",category:"weeks"},{value:"1mo",label:"1M",category:"months"},{value:"3mo",label:"3M",category:"months"},{value:"6mo",label:"6M",category:"months"},{value:"1y",label:"1A",category:"months"},{value:"1t",label:"1t",category:"ticks-micro"},{value:"5t",label:"5t",category:"ticks-micro"},{value:"10t",label:"10t",category:"ticks-micro"},{value:"25t",label:"25t",category:"ticks-micro"},{value:"50t",label:"50t",category:"ticks-micro"},{value:"100t",label:"100t",category:"ticks-day"},{value:"250t",label:"250t",category:"ticks-day"},{value:"500t",label:"500t",category:"ticks-day"},{value:"750t",label:"750t",category:"ticks-day"},{value:"1kt",label:"1k",category:"ticks-k"},{value:"2kt",label:"2k",category:"ticks-k"},{value:"3kt",label:"3k",category:"ticks-k"},{value:"5kt",label:"5k",category:"ticks-k"},{value:"10kt",label:"10k",category:"ticks-k"},{value:"89t",label:"89t",category:"ticks-fibo"},{value:"144t",label:"144t",category:"ticks-fibo"},{value:"233t",label:"233t",category:"ticks-fibo"},{value:"377t",label:"377t",category:"ticks-fibo"},{value:"610t",label:"610t",category:"ticks-fibo"}],_r=({isOpen:t,onClose:s,onSelect:r,currentValue:l,position:n})=>{const{currentTheme:o}=Q(),{currentLanguage:a}=Z(),[i,c]=g.useState(""),[d,u]=g.useState("intraday"),[m,p]=g.useState(()=>{try{return JSON.parse(localStorage.getItem("timeframe-favorites")||"[]")}catch{return[]}}),[x,f]=g.useState(()=>{try{return JSON.parse(localStorage.getItem("timeframe-recent")||"[]")}catch{return[]}}),[v,h]=g.useState(()=>{try{return JSON.parse(localStorage.getItem("timeframe-custom")||"[]")}catch{return[]}}),[b,j]=g.useState(""),[y,N]=g.useState("minutes"),[w,S]=g.useState(!1),[k,C]=g.useState(!1),[P,R]=g.useState(!1),M=g.useRef(null);g.useEffect(()=>{try{const O=JSON.parse(localStorage.getItem("timeframe-favorites")||"[]"),z=JSON.parse(localStorage.getItem("timeframe-recent")||"[]"),q=JSON.parse(localStorage.getItem("timeframe-custom")||"[]");p(O),f(z),h(q)}catch(O){console.warn("Erreur lors du chargement des timeframes depuis localStorage:",O),localStorage.removeItem("timeframe-favorites"),localStorage.removeItem("timeframe-recent"),localStorage.removeItem("timeframe-custom"),p([]),f([]),h([])}},[]),g.useEffect(()=>{const O=z=>{z.key==="Escape"&&s()};if(t)return document.addEventListener("keydown",O),()=>document.removeEventListener("keydown",O)},[t,s]);const T=g.useMemo(()=>{const O=new Set(bn.map(I=>I.value)),z=v.filter(I=>!O.has(I.value)),q=[...bn,...z],E=I=>{const H=I.match(/^(\d+)([smhdwmo]|t)$/);if(!H)return 0;const L=parseInt(H[1]),A=H[2];return L*({s:1,m:60,h:3600,d:86400,w:604800,mo:2592e3,t:.001}[A]||0)};return q.sort((I,H)=>{const L=["seconds","minutes","hours","days","weeks","months","ticks","ticks-micro","ticks-day","ticks-k","ticks-fibo"],A=se=>se.startsWith("ticks-")?"ticks":se,_=A(I.category),J=A(H.category),re=L.indexOf(_),de=L.indexOf(J);if(re!==de)return re-de;if(_==="ticks"){const se=["ticks-micro","ticks-day","ticks-k","ticks-fibo","ticks"],ke=se.indexOf(I.category),be=se.indexOf(H.category);if(ke!==be)return ke-be}return E(I.value)-E(H.value)})},[v]),D=T.filter(O=>{const z=i===""||O.label.toLowerCase().includes(i.toLowerCase())||O.value.toLowerCase().includes(i.toLowerCase());return i!==""?z:d==="intraday"?z&&(O.category==="seconds"||O.category==="minutes"||O.category==="hours"):d==="daily"?z&&(O.category==="days"||O.category==="weeks"||O.category==="months"):d==="ticks"?z&&(O.category==="ticks"||O.category==="ticks-micro"||O.category==="ticks-day"||O.category==="ticks-k"||O.category==="ticks-fibo"):!1}),F=O=>{r(O);const z=[O,...x.filter(q=>q!==O)].slice(0,4);f(z),localStorage.setItem("timeframe-recent",JSON.stringify(z)),s()},$=(O,z)=>{z.stopPropagation();const q=m.includes(O)?m.filter(E=>E!==O):[...m,O];p(q),localStorage.setItem("timeframe-favorites",JSON.stringify(q))},U=(O,z)=>{z.stopPropagation();const q=v.filter(E=>E.value!==O);h(q),localStorage.setItem("timeframe-custom",JSON.stringify(q))},B=()=>{if(b.trim()){const O=parseInt(b);if(!isNaN(O)&&O>0){const q={seconds:60,minutes:60,hours:24,days:7,weeks:3,months:12,ticks:1e4}[y]||999;if(O>q){const A={seconds:"secondes",minutes:"minutes",hours:"heures",days:"jours",weeks:"semaines",months:"mois",ticks:"ticks"}[y]||y;alert(`Valeur maximale autorisÃ©e pour ${A}: ${q}`);return}const I=`${O}${{seconds:"s",minutes:"m",hours:"h",days:"d",weeks:"w",months:"mo",ticks:"t"}[y]}`;if(!v.find(L=>L.value===I)){let L=y;y==="ticks"&&(O<=100?L="ticks-micro":O<=1e3?L="ticks-day":O<=1e4?L="ticks-k":L="ticks-fibo");const A={value:I,label:I,category:L},_=[...v,A];h(_),localStorage.setItem("timeframe-custom",JSON.stringify(_))}F(I)}}S(!1),j("")};return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:s}),e.jsxs("div",{ref:M,className:"relative w-full max-w-5xl h-[600px] rounded-xl shadow-2xl overflow-hidden flex flex-col",style:{backgroundColor:o.colors.surface,border:`1px solid ${o.colors.border}`},children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{size:16,style:{color:o.colors.accent}}),e.jsx("h3",{className:"text-lg font-bold",style:{color:o.colors.text},children:"Timeframe/Tick"})]}),e.jsx("button",{onClick:s,className:"p-1.5 rounded-lg hover:bg-opacity-20 hover:bg-black transition-colors",style:{color:o.colors.textMuted},children:e.jsx(Ne,{size:16})})]}),e.jsx("div",{className:"px-6 py-2",children:e.jsx(Hc,{searchQuery:i,onSearchChange:c,showCustom:w,onToggleCustom:()=>S(!w),customValue:b,onCustomValueChange:j,customType:y,onCustomTypeChange:O=>N(O),onCustomSubmit:B,theme:o,currentLanguage:a})}),e.jsx("div",{className:"px-6 py-2 border-b",style:{borderColor:o.colors.border},children:e.jsx(Jc,{activeCategory:d,onCategoryChange:u,theme:o,currentLanguage:a})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{className:"h-full p-2",children:i.trim()?e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"text-sm font-medium mb-3",style:{color:o.colors.textMuted},children:a==="fr"?"RÃ©sultats de recherche":"Search Results"}),e.jsx("div",{className:"flex-1 flex flex-wrap gap-2 content-start",children:D.map(O=>{const z=v.some(E=>E.value===O.value),q=l===O.value;return m.includes(O.value),e.jsx("div",{className:"relative group",children:e.jsxs("button",{onClick:()=>F(O.value),className:`px-3 py-1.5 text-sm rounded-md border transition-all duration-200 hover:shadow-sm ${q?"ring-2":""} ${z?"border-dashed":""}`,style:{backgroundColor:q?o.colors.accent:o.colors.card,borderColor:q||z?o.colors.accent:o.colors.border,color:q?"#ffffff":o.colors.text},title:z?"Timeframe personnalisÃ©":"",children:[O.label,z&&e.jsx("span",{className:"ml-1 text-xs",children:"â˜…"})]})},O.value)})})]}):e.jsxs("div",{className:"h-full flex flex-col space-y-4",children:[d==="intraday"&&e.jsxs("div",{className:"flex-1 grid grid-cols-1 gap-4",children:[e.jsx(Ht,{title:a==="fr"?"Secondes":"Seconds",options:D.filter(O=>O.category==="seconds"),customTimeframes:v,favorites:m,currentValue:l,onSelect:F,onToggleFavorite:$,onDeleteCustom:U,theme:o,currentLanguage:a}),e.jsx(Ht,{title:"Minutes",options:D.filter(O=>O.category==="minutes"),customTimeframes:v,favorites:m,currentValue:l,onSelect:F,onToggleFavorite:$,onDeleteCustom:U,theme:o,currentLanguage:a}),e.jsx(Ht,{title:a==="fr"?"Heures":"Hours",options:D.filter(O=>O.category==="hours"),customTimeframes:v,favorites:m,currentValue:l,onSelect:F,onToggleFavorite:$,onDeleteCustom:U,theme:o,currentLanguage:a})]}),d==="daily"&&e.jsxs("div",{className:"flex-1 grid grid-cols-1 gap-4",children:[e.jsx(Ht,{title:a==="fr"?"Jours":"Days",options:D.filter(O=>O.category==="days"),customTimeframes:v,favorites:m,currentValue:l,onSelect:F,onToggleFavorite:$,onDeleteCustom:U,theme:o,currentLanguage:a}),e.jsx(Ht,{title:a==="fr"?"Semaines":"Weeks",options:D.filter(O=>O.category==="weeks"),customTimeframes:v,favorites:m,currentValue:l,onSelect:F,onToggleFavorite:$,onDeleteCustom:U,theme:o,currentLanguage:a}),e.jsx(Ht,{title:a==="fr"?"Mois":"Months",options:D.filter(O=>O.category==="months"),customTimeframes:v,favorites:m,currentValue:l,onSelect:F,onToggleFavorite:$,onDeleteCustom:U,theme:o,currentLanguage:a})]}),d==="ticks"&&e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(Ht,{title:"Micro",options:D.filter(O=>O.category==="ticks-micro"),customTimeframes:v,favorites:m,currentValue:l,onSelect:F,onToggleFavorite:$,onDeleteCustom:U,theme:o,currentLanguage:a}),e.jsx(Ht,{title:"Day",options:D.filter(O=>O.category==="ticks-day"),customTimeframes:v,favorites:m,currentValue:l,onSelect:F,onToggleFavorite:$,onDeleteCustom:U,theme:o,currentLanguage:a}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>C(!k),className:"flex items-center gap-2 mb-2 text-xs font-semibold hover:opacity-80 transition-opacity",style:{color:o.colors.textMuted},children:[e.jsx("span",{className:`transform transition-transform ${k?"rotate-90":""}`,children:"â–¶"}),"xK"]}),k&&e.jsx("div",{className:"ml-4",children:e.jsx(Ht,{title:"",options:D.filter(O=>O.category==="ticks-k"),customTimeframes:v,favorites:m,currentValue:l,onSelect:F,onToggleFavorite:$,onDeleteCustom:U,theme:o,currentLanguage:a})})]}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>R(!P),className:"flex items-center gap-2 mb-2 text-xs font-semibold hover:opacity-80 transition-opacity",style:{color:o.colors.textMuted},children:[e.jsx("span",{className:`transform transition-transform ${P?"rotate-90":""}`,children:"â–¶"}),"Fibo"]}),P&&e.jsx("div",{className:"ml-4",children:e.jsx(Ht,{title:"",options:D.filter(O=>O.category==="ticks-fibo"),customTimeframes:v,favorites:m,currentValue:l,onSelect:F,onToggleFavorite:$,onDeleteCustom:U,theme:o,currentLanguage:a})})]})]})]})})}),e.jsx("div",{className:"px-6 py-2 border-t",style:{borderColor:o.colors.border},children:e.jsx(Kc,{favorites:m,recent:x,allOptions:T,customTimeframes:v,currentValue:l,onSelect:F,onToggleFavorite:$,onDeleteCustom:U,theme:o,currentLanguage:a})})]})]}):null},Yc=({currentDate:t,months:s,currentTheme:r,isCompact:l,isCompactView:n,headerMargin:o,buttonPadding:a,textSize:i,onPrev:c,onNext:d,onToggleView:u})=>e.jsxs("div",{className:`flex items-center justify-between ${o}`,children:[!n&&e.jsx("button",{onClick:c,className:`${l?"p-1":"p-1.5"} rounded-md transition-colors`,style:{color:r.colors.textMuted,backgroundColor:"transparent"},onMouseEnter:m=>{m.currentTarget.style.backgroundColor=r.colors.surface},onMouseLeave:m=>{m.currentTarget.style.backgroundColor="transparent"},children:e.jsx(as,{size:l?14:16})}),e.jsxs("button",{onClick:u,className:`${a} rounded-md transition-colors flex items-center space-x-1 flex-1 justify-center`,style:{backgroundColor:r.colors.surface,color:r.colors.text},onMouseEnter:m=>{m.currentTarget.style.backgroundColor=r.colors.border+"40"},onMouseLeave:m=>{m.currentTarget.style.backgroundColor=r.colors.surface},children:[e.jsxs("span",{className:`font-medium ${i}`,children:[s[t.getMonth()]," ",t.getFullYear()]}),e.jsx($e,{size:l?12:14,className:`transition-transform ${n?"rotate-180":""}`})]}),!n&&e.jsx("button",{onClick:d,className:`${l?"p-1":"p-1.5"} rounded-md transition-colors`,style:{color:r.colors.textMuted,backgroundColor:"transparent"},onMouseEnter:m=>{m.currentTarget.style.backgroundColor=r.colors.surface},onMouseLeave:m=>{m.currentTarget.style.backgroundColor="transparent"},children:e.jsx(Is,{size:l?14:16})})]}),Xc=({currentDate:t,months:s,currentTheme:r,currentLanguage:l,onSelectMonth:n,onSelectYear:o})=>{const a=g.useRef(null),i=g.useRef(null);return g.useEffect(()=>{if(a.current){const c=a.current.children[t.getMonth()];c&&c.scrollIntoView({block:"center",behavior:"smooth"})}if(i.current){const c=t.getFullYear(),u=Array.from({length:10},(p,x)=>c-5+x).indexOf(c),m=i.current.children[u];m&&m.scrollIntoView({block:"center",behavior:"smooth"})}},[t]),e.jsx("div",{className:"mb-3 p-2 rounded-lg",style:{backgroundColor:r.colors.surface},children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium mb-2 text-center",style:{color:r.colors.textSecondary},children:l==="fr"?"Mois":"Month"}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",ref:a,children:s.map((c,d)=>e.jsx("button",{onClick:()=>n(d),className:`w-full px-2 py-1 text-xs rounded transition-colors ${d===t.getMonth()?"bg-blue-500 text-white":"hover:bg-gray-100"}`,style:{backgroundColor:d===t.getMonth()?r.colors.accent:"transparent",color:d===t.getMonth()?"#ffffff":r.colors.text},children:c},d))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium mb-2 text-center",style:{color:r.colors.textSecondary},children:l==="fr"?"AnnÃ©e":"Year"}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",ref:i,children:Array.from({length:10},(c,d)=>t.getFullYear()-5+d).map(c=>e.jsx("button",{onClick:()=>o(c),className:"w-full px-2 py-1 text-xs rounded transition-colors",style:{backgroundColor:c===t.getFullYear()?r.colors.accent:"transparent",color:c===t.getFullYear()?"#ffffff":r.colors.text},onMouseEnter:d=>{c!==t.getFullYear()&&(d.currentTarget.style.backgroundColor=r.colors.surface)},onMouseLeave:d=>{c!==t.getFullYear()&&(d.currentTarget.style.backgroundColor="transparent")},children:c},c))})]})]})})},Qc=({currentDate:t,months:s,currentTheme:r,currentLanguage:l,onSelectMonth:n,onSelectYear:o})=>e.jsx("div",{className:"mb-3 p-2 rounded-lg",style:{backgroundColor:r.colors.surface},children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium mb-1",style:{color:r.colors.textSecondary},children:l==="fr"?"Mois":"Month"}),e.jsx("div",{className:"grid grid-cols-3 gap-1",children:s.map((a,i)=>e.jsx("button",{onClick:()=>n(i),className:"px-1.5 py-0.5 text-xs rounded transition-colors",style:{backgroundColor:i===t.getMonth()?r.colors.accent:"transparent",color:i===t.getMonth()?"#ffffff":r.colors.text},onMouseEnter:c=>{i!==t.getMonth()&&(c.currentTarget.style.backgroundColor=r.colors.surface)},onMouseLeave:c=>{i!==t.getMonth()&&(c.currentTarget.style.backgroundColor="transparent")},children:a},i))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium mb-1",style:{color:r.colors.textSecondary},children:l==="fr"?"AnnÃ©e":"Year"}),e.jsx("div",{className:"space-y-0.5 max-h-24 overflow-y-auto",children:Array.from({length:8},(a,i)=>t.getFullYear()-3+i).map(a=>e.jsx("button",{onClick:()=>o(a),className:`w-full px-1.5 py-0.5 text-xs rounded transition-colors ${a===t.getFullYear()?"bg-blue-500 text-white":"hover:bg-gray-100"}`,style:{backgroundColor:a===t.getFullYear()?r.colors.accent:"transparent",color:a===t.getFullYear()?"#ffffff":r.colors.text},children:a},a))})]})]})}),Zc=({weekDays:t,currentTheme:s,isCompact:r})=>e.jsx("div",{className:`grid grid-cols-7 ${r?"mb-0.5":"mb-1"}`,children:t.map((l,n)=>e.jsx("div",{className:`text-center text-xs font-medium ${r?"py-0.5":"py-1"}`,style:{color:n>=5?"#ef4444":s.colors.textMuted},children:l},n))}),ei=({days:t,currentTheme:s,isCompact:r,daySize:l,dayGap:n,selectedDate:o,onDayClick:a,onMount:i})=>e.jsx("div",{className:`grid grid-cols-7 ${n}`,ref:c=>{c&&!o&&i&&i()},children:t.map((c,d)=>e.jsx("button",{onClick:()=>a(c),"data-day":c.date.getDate(),className:`${l} text-xs rounded transition-colors ${c.isSelected?"bg-blue-500 text-white":c.isCurrentMonth?"hover:bg-gray-100":"opacity-30"}`,style:{backgroundColor:c.isSelected?s.colors.accent:"transparent",color:c.isSelected?"#ffffff":c.isToday&&!c.isSelected?s.colors.accent:d%7>=5&&c.isCurrentMonth?"#ef4444":c.isCurrentMonth?s.colors.text:s.colors.textMuted},disabled:!c.isCurrentMonth,children:c.date.getDate()},d))}),ti=({currentTheme:t,currentLanguage:s,isCompact:r,buttonPadding:l,onToday:n,onClear:o})=>e.jsx("div",{className:`${r?"mt-2 pt-1.5":"mt-3 pt-2"} border-t`,style:{borderColor:t.colors.border},children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:n,className:`${l} text-xs rounded-md transition-colors hover:bg-gray-100`,style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},children:s==="fr"?"Aujourd'hui":"Today"}),e.jsx("button",{onClick:o,className:`${l} text-xs rounded-md transition-colors hover:bg-gray-100`,style:{backgroundColor:t.colors.surface,color:t.colors.text},children:s==="fr"?"Effacer":"Clear"})]})}),gs=({value:t,onChange:s,placeholder:r="jj/mm/aaaa",disabled:l=!1,className:n="",id:o,name:a,title:i,size:c="normal",style:d={}})=>{const{currentTheme:u}=Q(),{currentLanguage:m}=Z(),[p,x]=g.useState(!1),[f,v]=g.useState(new Date),[h,b]=g.useState(null),[j,y]=g.useState(!1),[N,w]=g.useState(!1),[S,k]=g.useState(""),[C,P]=g.useState("left"),R=g.useRef(null),M=g.useRef(null);g.useEffect(()=>{if(t){const ee=new Date(t);isNaN(ee.getTime())||(b(ee),v(ee),k(T(ee)))}else b(null),v(new Date),k("")},[t]),g.useEffect(()=>{const ee=oe=>{R.current&&!R.current.contains(oe.target)&&(x(!1),y(!1))};if(p)return document.addEventListener("mousedown",ee),()=>document.removeEventListener("mousedown",ee)},[p]);const T=ee=>ee.toLocaleDateString(m==="fr"?"fr-FR":"en-US",{day:"2-digit",month:"2-digit",year:"numeric"}),D=ee=>{const oe=ee.getFullYear(),ve=String(ee.getMonth()+1).padStart(2,"0"),Y=String(ee.getDate()).padStart(2,"0");return`${oe}-${ve}-${Y}`},F=()=>m==="fr"?["lun.","mar.","mer.","jeu.","ven.","sam.","dim."]:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],$=()=>m==="fr"?["janv.","fÃ©vr.","mars","avr.","mai","juin","juil.","aoÃ»t","sept.","oct.","nov.","dÃ©c."]:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],U=ee=>{const oe=ee.getFullYear(),ve=ee.getMonth(),Y=[],fe=(new Date(oe,ve,1).getDay()+6)%7,je=new Date(oe,ve,1-fe);for(let X=0;X<42;X++){const ae=new Date(je);ae.setDate(je.getDate()+X);const ge=ae.getMonth()===ve,Ce=h?ae.toDateString()===h.toDateString():!1,Be=ae.toDateString()===new Date().toDateString();Y.push({date:ae,isCurrentMonth:ge,isSelected:Ce,isToday:Be})}return Y},B=()=>{const ee=new Date;f.getMonth()===ee.getMonth()&&f.getFullYear()===ee.getFullYear()&&setTimeout(()=>{const oe=document.querySelector(`[data-day="${ee.getDate()}"]`);oe&&oe.scrollIntoView({block:"center",behavior:"smooth"})},100)},O=()=>{v(new Date(f.getFullYear(),f.getMonth()-1,1))},z=()=>{v(new Date(f.getFullYear(),f.getMonth()+1,1))},q=ee=>{if(ee.isCurrentMonth){const oe=new Date(ee.date);b(oe),k(T(oe)),s(D(oe)),x(!1)}},E=ee=>{v(new Date(f.getFullYear(),ee,1)),y(!1)},I=ee=>{v(new Date(ee,f.getMonth(),1)),y(!1),w(!1)},H=()=>{w(!N),y(!1)},L=()=>{if(!p){if(M.current){const ee=M.current.getBoundingClientRect(),oe=window.innerWidth,ve=c==="compact"?260:280;ee.left+ve>oe?P("right"):P("left")}h||v(new Date)}x(!p)};g.useEffect(()=>{if(N){const ee=setTimeout(()=>{w(!1)},1e4);return()=>clearTimeout(ee)}},[N]);const A=()=>{b(null),k(""),s(""),x(!1)},_=()=>{const ee=new Date;b(ee),v(ee),k(T(ee)),s(D(ee)),x(!1)},J=ee=>{const oe=ee.replace(/[^\d]/g,"");if(oe.length>8)return;if(!oe){b(null),s(""),k("");return}let ve="";const Y=m==="en";if(oe.length<=2?ve=oe:oe.length<=4?Y?ve=`${oe.slice(0,2)}/${oe.slice(2)}`:ve=`${oe.slice(0,2)}/${oe.slice(2)}`:Y?ve=`${oe.slice(0,2)}/${oe.slice(2,4)}/${oe.slice(4)}`:ve=`${oe.slice(0,2)}/${oe.slice(2,4)}/${oe.slice(4)}`,k(ve),oe.length>=6){let me,fe,je;if(Y?(fe=parseInt(oe.slice(0,2)),me=parseInt(oe.slice(2,4)),je=oe.length>=8?parseInt(oe.slice(4,8)):new Date().getFullYear()):(me=parseInt(oe.slice(0,2)),fe=parseInt(oe.slice(2,4)),je=oe.length>=8?parseInt(oe.slice(4,8)):new Date().getFullYear()),me>=1&&me<=31&&fe>=1&&fe<=12&&je>=1900&&je<=2100){const X=new Date(je,fe-1,me);if(!isNaN(X.getTime())&&X.getDate()===me&&X.getMonth()===fe-1&&X.getFullYear()===je){b(X),v(X);const ae=D(X);console.log("ðŸ—“ï¸ CustomDatePicker onChange triggered:",ae),s(ae),k(T(X));return}}}},re=ee=>{if(ee.key==="Enter"){const oe=ee.target;J(oe.value)}else ee.key==="Escape"&&x(!1)},de=()=>{const ee=M.current?.value||"";if(console.log("ðŸ” onBlur triggered, currentValue:",ee),ee&&ee.includes("/")){console.log("ðŸ” Trying to validate date:",ee);const oe=ee.split("/");if(oe.length===3){const ve=parseInt(oe[0]),Y=parseInt(oe[1]),me=parseInt(oe[2]);if(ve>=1&&ve<=31&&Y>=1&&Y<=12&&me>=1900&&me<=2100){const fe=new Date(me,Y-1,ve);if(!isNaN(fe.getTime())&&fe.getDate()===ve&&fe.getMonth()===Y-1&&fe.getFullYear()===me){console.log("ðŸ—“ï¸ Valid date found, triggering onChange:",D(fe)),b(fe),v(fe),s(D(fe)),k(T(fe));return}}}}};g.useEffect(()=>{const ee=oe=>{if(p)switch(oe.key){case"Escape":x(!1),y(!1);break;case"ArrowLeft":oe.preventDefault(),O();break;case"ArrowRight":oe.preventDefault(),z();break;case"Enter":oe.preventDefault(),j&&y(!1);break}};return document.addEventListener("keydown",ee),()=>document.removeEventListener("keydown",ee)},[p,j,f]);const se=U(f),ke=F(),be=$(),he=c==="compact",te=he?"p-2":"p-3",W=he?"mb-2":"mb-3",K=he?"w-6 h-6":"w-7 h-7",ue=he?"gap-0":"gap-0.5",ye=he?"px-2 py-1":"px-3 py-1.5",Fe=he?"text-xs":"text-sm";return e.jsxs("div",{className:"relative",ref:R,children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:M,id:o,name:a,type:"text",defaultValue:S||(h?T(h):""),placeholder:r,disabled:l,onClick:()=>!l&&L(),onChange:ee=>{const oe=ee.target;console.log("ðŸ” onChange triggered, value:",oe.value),k(oe.value)},onKeyDown:ee=>re(ee),onBlur:()=>de(),className:`w-full pr-20 pl-4 py-2 text-base border rounded-lg focus:outline-none transition-all ${n}`,style:{backgroundColor:u.colors.surface,borderColor:u.colors.border,color:u.colors.text,WebkitAppearance:"none",MozAppearance:"textfield",...d},title:i,autoComplete:"off","data-lpignore":"true",inputMode:"text"}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center space-x-1",children:[h&&e.jsx("button",{type:"button",onClick:ee=>{ee.stopPropagation(),A()},className:"p-1 rounded-md transition-colors cursor-pointer",style:{color:u.colors.textMuted,backgroundColor:"transparent"},onMouseEnter:ee=>{ee.currentTarget.style.backgroundColor=u.colors.surface},onMouseLeave:ee=>{ee.currentTarget.style.backgroundColor="transparent"},title:"Effacer",children:e.jsx(Ne,{size:14})}),e.jsxs("button",{type:"button",onClick:()=>!l&&x(!p),className:"p-1 rounded-md transition-colors cursor-pointer",style:{color:u.colors.accent,backgroundColor:"transparent"},onMouseEnter:ee=>{ee.currentTarget.style.backgroundColor=u.colors.surface},onMouseLeave:ee=>{ee.currentTarget.style.backgroundColor="transparent"},title:"Ouvrir le calendrier",children:[e.jsx(yt,{size:16}),e.jsx($e,{size:12})]})]})]}),p&&e.jsxs("div",{className:`absolute z-50 mt-1 ${te} rounded-lg shadow-2xl border ${C==="right"?"right-0":"left-0"}`,style:{backgroundColor:u.colors.card,borderColor:u.colors.border,color:u.colors.text,...he?{minWidth:"240px",maxWidth:"260px"}:{minWidth:"260px",maxWidth:"280px"}},children:[e.jsx(Yc,{currentDate:f,months:be,currentTheme:u,isCompact:he,isCompactView:N,headerMargin:W,buttonPadding:ye,textSize:Fe,onPrev:O,onNext:z,onToggleView:H}),N&&e.jsx(Xc,{currentDate:f,months:be,currentTheme:u,currentLanguage:m,onSelectMonth:E,onSelectYear:I}),j&&!N&&e.jsx(Qc,{currentDate:f,months:be,currentTheme:u,currentLanguage:m,onSelectMonth:E,onSelectYear:I}),!N&&e.jsxs(e.Fragment,{children:[e.jsx(Zc,{weekDays:ke,currentTheme:u,isCompact:he}),e.jsx(ei,{days:se,currentTheme:u,isCompact:he,daySize:K,dayGap:ue,selectedDate:h,onDayClick:q,onMount:B})]}),e.jsx(ti,{currentTheme:u,currentLanguage:m,isCompact:he,buttonPadding:ye,onToday:_,onClear:A})]})]})},si=/^[A-Z]{1,3}[FGHJKMNQUVXZ]\d{1,2}$/,ri=/^[A-Z]{6}$/,oi=/(USDT|PERP|USDC|BUSD)$/i,ni=/^\^/,li=/\//,ai=new Set(["ES","NQ","YM","RTY","CL","GC","SI","NG","ZB","ZN","ZF","ZT","ZC","ZS","ZW","KC","SB","CC","CT","LB","OJ","PA","PL","HG","HO","RB","TY","FV","TU","ED","FF","GE","JY","AD","CD","BP","SF","EC","MP","DX","VX","EMD","NKD"]),ci=new Set(["MES","MNQ","MYM","M2K","MCL","MGC","MSI","MNG"]),ii=new Set(["SPX","NDX","RUT","DJI","VIX","IXIC","GSPC","SPY","QQQ","IWM","DIA","VXX","UVXY","TVIX","SVXY","XIV","VXXB","VXZ","VIXY"]),di=new Set(["EURUSD","GBPUSD","USDJPY","AUDUSD","USDCAD","USDCHF","NZDUSD","EURGBP","EURJPY","GBPJPY","AUDJPY","CADJPY","CHFJPY","NZDJPY","EURAUD","EURCAD","EURCHF","EURNZD","GBPAUD","GBPCAD","GBPCHF","GBPNZD","AUDCAD","AUDCHF","AUDNZD","CADCHF","CADNZD","CHFNZD"]),ui=new Set(["AAPL","TSLA","MSFT","GOOGL","AMZN","META","NVDA","NFLX","AMD","INTC","ORCL","CRM","ADBE","PYPL","UBER","LYFT","SNAP","TWTR","SQ","ROKU","ZM","PTON","PELOTON","SPOT","SHOP","OKTA","SNOW","PLTR","COIN","RBLX","GOOG","FB","DIS","JPM","JNJ","V","PG","UNH","HD","MA","BAC","XOM","T","PFE","KO","WMT","ABBV","BRK","BRK.B","RIVN"]),mi=new Set(["BTC","ETH","ADA","SOL","MATIC","AVAX","DOT","LINK","UNI","AAVE","SUSHI","COMP","MKR","YFI","SNX","CRV","1INCH","BAL","LRC","ZRX","BITCOIN","ETHEREUM","CARDANO","POLYGON","AVALANCHE","POLKADOT"]),xi=["BINANCE:","COINBASE:","KRAKEN:","BITFINEX:","BITTREX:","HUOBI:","OKEX:","BYBIT:","FTX:","KUCOIN:","GATE:","MEXC:"],fi={".r":"",".R":"",".X":"","-PERP":"","-PERPETUAL":""};function pi(t){let s=t.trim().toUpperCase();for(const r of xi)if(s.startsWith(r)){s=s.substring(r.length);break}for(const[r,l]of Object.entries(fi))s.endsWith(r)&&(s=s.substring(0,s.length-r.length)+l);return s.includes(".")&&!s.includes("BRK")?s=s.replace(/\./g,""):s=s.replace(/[\/\-\s]/g,""),s}function kl(t){const s=t,r=pi(t);return ai.has(r)||ci.has(r)?{market:"futures",confidence:3,rule:"dict:futures",originalSymbol:s,normalizedSymbol:r}:ii.has(r)?{market:"indices",confidence:3,rule:"dict:indices",originalSymbol:s,normalizedSymbol:r}:di.has(r)?{market:"forex",confidence:3,rule:"dict:forex",originalSymbol:s,normalizedSymbol:r}:ui.has(r)?{market:"stocks",confidence:3,rule:"dict:stocks",originalSymbol:s,normalizedSymbol:r}:mi.has(r)?{market:"crypto",confidence:3,rule:"dict:crypto",originalSymbol:s,normalizedSymbol:r}:si.test(r)?{market:"futures",confidence:2,rule:"regex:futContract",originalSymbol:s,normalizedSymbol:r}:ri.test(r)?{market:"forex",confidence:2,rule:"regex:fx6",originalSymbol:s,normalizedSymbol:r}:oi.test(r)?{market:"crypto",confidence:2,rule:"regex:cryptoPair",originalSymbol:s,normalizedSymbol:r}:li.test(s)?{market:"forex",confidence:2,rule:"slash:fx",originalSymbol:s,normalizedSymbol:r}:ni.test(s)||r==="SPX"||r==="NDX"?{market:"indices",confidence:2,rule:"prefix:index",originalSymbol:s,normalizedSymbol:r}:{market:"unknown",confidence:1,rule:"fallback",originalSymbol:s,normalizedSymbol:r}}function hi(t,s="fr"){return{fr:{futures:"Future (CME)",forex:"Forex",stocks:"Action",indices:"Indice",crypto:"Crypto",commodities:"MatiÃ¨re premiÃ¨re",unknown:"Symbole"},en:{futures:"Future (CME)",forex:"Forex",stocks:"Stock",indices:"Index",crypto:"Crypto",commodities:"Commodity",unknown:"Symbol"}}[s][t]}const wl="market-detection-overrides",gi=100;function Sl(){try{const t=localStorage.getItem(wl);if(!t)return new Map;const s=JSON.parse(t),r=new Map,l=Date.now()-720*60*60*1e3;for(const[n,o]of Object.entries(s)){const a=o;a&&typeof a.timestamp=="number"&&a.timestamp>l&&r.set(n,a)}return r}catch(t){return console.warn("Erreur lors du chargement des overrides:",t),new Map}}function yi(t){try{const s=Array.from(t.entries()).sort((l,n)=>n[1].timestamp-l[1].timestamp).slice(0,gi),r=Object.fromEntries(s);localStorage.setItem(wl,JSON.stringify(r))}catch(s){console.warn("Erreur lors de la sauvegarde des overrides:",s)}}function Cl(t,s){return!s||t.market==="unknown"?!1:t.market!==s}function bi(t){return Sl().get(t)||null}function Pl(t,s,r,l=!1){if(!l)return;const n=Sl();n.set(t,{symbol:t,market:s,timestamp:Date.now(),reason:r}),yi(n)}function Ml(t,s,r){const l=bi(t);return l?l.market:s.market}function Rl(t,s,r,l="fr"){const n={fr:{futures:"future (CME)",forex:"forex",stocks:"action",indices:"indice",crypto:"crypto",commodities:"matiÃ¨re premiÃ¨re"},en:{futures:"future (CME)",forex:"forex",stocks:"stock",indices:"index",crypto:"crypto",commodities:"commodity"}},o={fr:{futures:"Futures",forex:"Forex",stocks:"Actions",indices:"Indices",crypto:"Crypto",commodities:"MatiÃ¨res premiÃ¨res"},en:{futures:"Futures",forex:"Forex",stocks:"Stocks",indices:"Indices",crypto:"Crypto",commodities:"Commodities"}},a=s.market==="unknown"?"forex":s.market,i=n[l][a],c=o[l][a],d=s.confidence===3?l==="fr"?"(haute confiance)":"(high confidence)":s.confidence===2?l==="fr"?"(confiance moyenne)":"(medium confidence)":l==="fr"?"(faible confiance)":"(low confidence)";return l==="fr"?`${t} est dÃ©tectÃ© comme ${i} ${d}.

Raison: ${s.rule}

Basculer le marchÃ© vers ${c} ?`:`${t} is detected as ${i} ${d}.

Reason: ${s.rule}

Switch market to ${c}?`}const Tl=(t,s)=>{if(!s||!s.trim())return t;const r=s.toLowerCase().trim();return t.filter(l=>{const n=l.toLowerCase();return n===r||n.startsWith(r)||n.includes(r)?!0:r.split(/[\s\-_]+/).every(a=>n.includes(a))})},Ko=({suggestions:t,favoriteSymbols:s,customSymbols:r,theme:l,onSelect:n,onToggleFavorite:o,onRemoveCustom:a})=>!t||t.length===0?null:e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 rounded-lg shadow-lg z-20 max-h-48 overflow-y-auto border",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border},children:t.map((i,c)=>{const d=s.includes(i),u=r.includes(i);return e.jsxs("button",{onClick:()=>n(i),className:"w-full px-4 py-2 text-left hover:bg-opacity-10 border-b last:border-b-0 transition-colors flex items-center justify-between",style:{borderColor:l.colors.border,color:l.colors.text},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d&&e.jsx("span",{className:"text-yellow-400 text-sm",children:"â­"}),u&&e.jsx("span",{className:"text-green-400 text-xs",children:"+"}),e.jsx("span",{className:"font-medium",children:i})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[u&&e.jsx("button",{onClick:m=>{m.stopPropagation(),a(i)},className:"p-1 rounded-full hover:bg-red-500 hover:bg-opacity-20 transition-colors",title:"Supprimer ce symbole personnalisÃ©",children:e.jsx("span",{className:"text-red-400 text-xs",children:"âœ•"})}),e.jsx("button",{onClick:m=>{m.stopPropagation(),o(i)},className:"p-1 rounded-full hover:bg-yellow-500 hover:bg-opacity-20 transition-colors",title:d?"Retirer des favoris":"Ajouter aux favoris",children:e.jsx("span",{className:"text-yellow-400 text-xs",children:d?"â­":"â˜†"})})]})]},`${i}-${c}`)})}),Vr=({isOpen:t,onClose:s,theme:r,t1:l,symbolSearch:n,onChangeSearch:o,onAddCustomSymbol:a,favoriteSymbols:i,filteredFavorites:c,filteredMarketSymbols:d,filteredCustomSymbols:u,currentSelectedSymbol:m,marketLabel:p,onSelectSymbol:x,onToggleFavorite:f,onRemoveCustomSymbol:v,draggedItem:h,dragOverIndex:b,onDragStart:j,onDragOver:y,onDragLeave:N,onDrop:w,onDragEnd:S})=>t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{pointerEvents:"auto"},children:e.jsxs("div",{className:"w-[720px] max-w-4xl rounded-xl shadow-2xl overflow-hidden",style:{backgroundColor:r.colors.card||r.colors.surface,border:`1px solid ${r.colors.border}`,pointerEvents:"auto"},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",style:{borderColor:r.colors.border,backgroundColor:(r.colors.surface||"")+"50"},children:[e.jsx("h3",{className:"font-bold text-lg",style:{color:r.colors.text},children:l("symboles_existants")||"Symboles existants"}),e.jsx("button",{onClick:s,className:"p-1 rounded-full hover:bg-gray-100 transition-colors",style:{color:r.colors.text},children:"âœ•"})]}),e.jsx("div",{className:"p-4 border-b",style:{borderColor:r.colors.border},children:e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("input",{type:"text",value:n,onChange:k=>o(k.target.value),placeholder:l("rechercher_un_symbole")||"Rechercher un symbole... (ex: EUR, BTC, AAPL)",className:"w-full pl-10 pr-12 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:r.colors.surface,borderColor:r.colors.border,color:r.colors.text},autoFocus:!0}),n.trim()&&e.jsx("button",{onClick:()=>{a(n),o("")},className:"absolute right-3 top-1/2 transform -translate-y-1/2 px-3 py-1.5 rounded-full transition-all duration-200 hover:scale-105 active:scale-95 shadow-sm",style:{backgroundColor:r.colors.accent,color:"#ffffff"},title:`Ajouter "${n.trim()}" aux symboles personnalisÃ©s`,children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-sm font-semibold",children:"+"}),e.jsx("span",{className:"text-xs font-medium",children:"Ajouter"})]})})]})}),e.jsx("div",{className:"max-h-80 overflow-y-auto p-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-3 h-full",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-yellow-400 mr-2",children:"â­"}),e.jsx("h4",{className:"text-sm font-semibold",children:"Favoris"})]}),e.jsx("span",{className:"text-xs text-gray-400",title:"Glisser-dÃ©poser pour rÃ©organiser",children:"â‹®â‹®"})]}),e.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto",children:c.length>0?c.map((k,C)=>e.jsx("div",{draggable:!0,onDragStart:P=>j(P,k),onDragOver:P=>y(P,C),onDragLeave:N,onDrop:P=>w(P,C),onDragEnd:S,className:`w-full transition-all duration-200 ${h===k?"opacity-50 scale-95":""} ${b===C?"transform translate-y-1":""}`,children:e.jsx("button",{onClick:()=>x(k),className:`w-full px-2 py-2 text-sm rounded-lg border transition-all duration-200 hover:shadow-sm cursor-move ${m===k?"border-0 shadow-md":""} ${b===C?"border-yellow-400 border-2":""}`,style:{backgroundColor:m===k?r.colors.accent:r.colors.surface,borderColor:m===k?"transparent":b===C?"#fbbf24":r.colors.border,color:m===k?"#ffffff":r.colors.text},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-yellow-400 text-sm",children:"â­"}),e.jsx("span",{className:"font-medium text-xs",children:k}),e.jsx("span",{className:"text-gray-400 text-xs ml-1",children:"â‹®â‹®"})]}),e.jsx("button",{onClick:P=>{P.stopPropagation(),f(k)},className:"p-1 rounded-full hover:bg-red-500 hover:bg-opacity-20 transition-colors",title:"Retirer des favoris",children:e.jsx("span",{className:"text-red-400 text-sm",children:"âœ•"})})]})})},`fav-${k}`)):e.jsx("div",{className:"text-center py-4 text-xs",children:n.trim()?"Aucun favori trouvÃ©":"Aucun favori"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"text-blue-400 mr-2",children:"ðŸ“Š"}),e.jsx("h4",{className:"text-sm font-semibold",children:p})]}),e.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto",children:d.length>0?d.map(k=>e.jsx("button",{onClick:()=>x(k),className:`w-full px-2 py-2 text-sm rounded-lg border transition-all duration-200 hover:shadow-sm ${m===k?"border-0 shadow-md":""}`,style:{backgroundColor:m===k?r.colors.accent:r.colors.surface,borderColor:m===k?"transparent":r.colors.border,color:m===k?"#ffffff":r.colors.text},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-xs",children:k}),e.jsx("button",{onClick:C=>{C.stopPropagation(),f(k)},className:"p-1 rounded-full hover:bg-yellow-500 hover:bg-opacity-20 transition-colors",title:"Ajouter aux favoris",children:e.jsx("span",{className:"text-yellow-400 text-sm",children:"â˜†"})})]})},`market-${k}`)):e.jsx("div",{className:"text-center py-4 text-xs",children:n.trim()?"Aucun symbole trouvÃ©":"Aucun symbole"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"text-green-400 mr-2",children:"âž•"}),e.jsx("h4",{className:"text-sm font-semibold",children:"PersonnalisÃ©s"})]}),e.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto",children:u.length>0?u.map(k=>{const C=i.includes(k);return e.jsx("button",{onClick:()=>x(k),className:`w-full px-2 py-2 text-sm rounded-lg border transition-all duration-200 hover:shadow-sm ${m===k?"border-0 shadow-md":""}`,style:{backgroundColor:m===k?r.colors.accent:r.colors.surface,borderColor:m===k?"transparent":r.colors.border,color:m===k?"#ffffff":r.colors.text},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[C&&e.jsx("span",{className:"text-yellow-400 text-sm",children:"â­"}),e.jsx("span",{className:"font-medium text-xs",children:k})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:P=>{P.stopPropagation(),v(k)},className:"p-1 rounded-full hover:bg-red-500 hover:bg-opacity-20 transition-colors",title:"Supprimer ce symbole personnalisÃ©",children:e.jsx("span",{className:"text-red-400 text-sm",children:"âœ•"})}),e.jsx("button",{onClick:P=>{P.stopPropagation(),f(k)},className:"p-1 rounded-full hover:bg-yellow-500 hover:bg-opacity-20 transition-colors",title:C?"Retirer des favoris":"Ajouter aux favoris",children:e.jsx("span",{className:"text-yellow-400 text-sm",children:C?"â­":"â˜†"})})]})]})},`custom-${k}`)}):e.jsx("div",{className:"text-center py-4 text-xs",children:n.trim()?"Aucun symbole personnalisÃ© trouvÃ©":"Aucun symbole personnalisÃ©"})})]})]})}),e.jsx("div",{className:"px-4 py-3 text-xs text-center border-t",style:{borderColor:r.colors.border,backgroundColor:(r.colors.surface||"")+"30",color:r.colors.textMuted},children:l("alt_s_pour_ouvrir_entree_pour_selectionner_esc_pour_fermer")||"Alt+S pour ouvrir â€¢ EntrÃ©e pour sÃ©lectionner â€¢ Esc pour fermer"})]})}):null,vi=({theme:t,formData:s,onChange:r,errors:l,settings:n,translate:o,isEditMode:a=!1,fieldConfig:i,shouldShowField:c,toggleFieldVisibility:d,isObligatoryField:u,currentLanguage:m="fr"})=>{const p=[{value:"futures",label:o("futures","Futures")},{value:"forex",label:o("forex","Forex")},{value:"stocks",label:o("stocks","Actions")},{value:"indices",label:o("indices","Indices")},{value:"crypto",label:o("crypto","Crypto")},{value:"commodities",label:o("commodities","MatiÃ¨res PremiÃ¨res")}];return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:t.colors.text},children:[o("profil","Profil")," *"]}),e.jsx("div",{className:"px-3 py-2 border rounded-lg shadow-sm",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text},children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-base",children:o("profil_principal","Profil Principal")}),e.jsxs("span",{className:"text-sm mt-1",style:{color:t.colors.textMuted},children:[n.initialCapital.toLocaleString(o("fr_fr","fr-FR"))," ",n.currency]})]})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:t.colors.text},children:[o("statut","Statut")," *"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>r("status","open"),className:`flex-1 flex items-center justify-center px-2 py-1 text-sm rounded-lg border-2 transition-all duration-200 ${s.status==="open"?"border-0 shadow-md transform scale-105":"hover:shadow-sm"}`,style:{backgroundColor:s.status==="open"?t.colors.accent:t.colors.surface,color:s.status==="open"?"#ffffff":t.colors.text,borderColor:s.status==="open"?"transparent":t.colors.border},children:e.jsx("span",{className:"font-medium",children:o("ouvert","Ouvert")})}),e.jsx("button",{onClick:()=>r("status","closed"),className:`flex-1 flex items-center justify-center px-2 py-1 text-sm rounded-lg border-2 transition-all duration-200 ${s.status==="closed"?"border-0 shadow-md transform scale-105":"hover:shadow-sm"}`,style:{backgroundColor:s.status==="closed"?t.colors.accent:t.colors.surface,color:s.status==="closed"?"#ffffff":t.colors.text,borderColor:s.status==="closed"?"transparent":t.colors.border},children:e.jsx("span",{className:"font-medium",children:o("ferme","FermÃ©")})})]}),l.status&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:t.colors.danger},children:l.status})]}),c&&c("side")&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"block text-sm font-semibold",style:{color:t.colors.text},children:[o("direction","Direction")," *"]}),a&&!u?.("side")&&e.jsx("button",{type:"button",onClick:()=>d&&d("side"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:i?.hiddenFields?.includes("side")?"Afficher":"Masquer",style:{color:i?.hiddenFields?.includes("side")?t.colors.accent:t.colors.textMuted},children:i?.hiddenFields?.includes("side")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),a&&u?.("side")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:m==="fr"?"Champ obligatoire":"Required field",children:m==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>r("side","long"),className:`flex-1 flex items-center justify-center px-2 py-1 text-sm rounded-lg border-2 transition-all duration-200 ${s.side==="long"?"shadow-md transform scale-105":"hover:shadow-sm"}`,style:{backgroundColor:s.side==="long"?`${t.colors.success}40`:t.colors.surface,color:s.side==="long"?"#ffffff":t.colors.text,borderColor:s.side==="long"?t.colors.success:t.colors.border},children:e.jsx("span",{className:"font-medium",children:o("long","Long")})}),e.jsx("button",{onClick:()=>r("side","short"),className:`flex-1 flex items-center justify-center px-2 py-1 text-sm rounded-lg border-2 transition-all duration-200 ${s.side==="short"?"shadow-md transform scale-105":"hover:shadow-sm"}`,style:{backgroundColor:s.side==="short"?`${t.colors.danger}40`:t.colors.surface,color:s.side==="short"?"#ffffff":t.colors.text,borderColor:s.side==="short"?t.colors.danger:t.colors.border},children:e.jsx("span",{className:"font-medium",children:o("short","Short")})})]}),l.side&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:t.colors.danger},children:l.side})]}),c&&c("market")&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"block text-sm font-semibold",style:{color:t.colors.text},children:[o("marche","MarchÃ©")," *"]}),a&&!u?.("market")&&e.jsx("button",{type:"button",onClick:()=>d&&d("market"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:i?.hiddenFields?.includes("market")?"Afficher":"Masquer",style:{color:i?.hiddenFields?.includes("market")?t.colors.accent:t.colors.textMuted},children:i?.hiddenFields?.includes("market")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),a&&u?.("market")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:m==="fr"?"Champ obligatoire":"Required field",children:m==="fr"?"Obligatoire":"Required"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:p.map(x=>e.jsx("button",{onClick:()=>r("market",x.value),className:`w-full h-8 px-2 py-1 text-sm rounded-lg border-2 transition-all duration-200 text-center flex items-center justify-center ${s.market===x.value?"border-0 shadow-md transform scale-105":"hover:shadow-sm"}`,style:{backgroundColor:s.market===x.value?t.colors.accent:t.colors.surface,color:s.market===x.value?"#ffffff":t.colors.text,borderColor:s.market===x.value?"transparent":t.colors.border},children:e.jsx("span",{className:"font-medium",children:x.label})},x.value))}),l.market&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:t.colors.danger},children:l.market})]})]})},Dl=({theme:t,formData:s,onChange:r,t1:l,currentLanguage:n,setTimeframeOverlay:o,setTimeframeButtonRef:a,isEditMode:i=!1,fieldConfig:c,shouldShowField:d,toggleFieldVisibility:u,isObligatoryField:m})=>d&&d("timeframe")?e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("label",{className:"block text-sm font-semibold",style:{color:t.colors.text},children:[l("timeframe_tick")," ",e.jsx("span",{className:"text-xs ml-1",style:{color:t.colors.textMuted},children:l("optionnel")})]}),i&&!m?.("timeframe")&&e.jsx("button",{type:"button",onClick:()=>u&&u("timeframe"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:c?.hiddenFields?.includes("timeframe")?"Afficher":"Masquer",style:{color:c?.hiddenFields?.includes("timeframe")?t.colors.accent:t.colors.textMuted},children:c?.hiddenFields?.includes("timeframe")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),i&&m?.("timeframe")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:n==="fr"?"Champ obligatoire":"Required field",children:n==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:s.timeframe||"",onChange:p=>r("timeframe",p.target.value),placeholder:"Choisir timeframe (1m, 5m, 1h...) ou tick (50t, 100t...)",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors shadow-sm",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}}),s.timeframe&&e.jsx("button",{onClick:()=>r("timeframe",""),className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1 rounded-full hover:bg-opacity-10 hover:bg-black",style:{color:t.colors.textMuted},"aria-label":"Clear timeframe",children:"Ã—"})]}),e.jsx("button",{ref:a,onClick:()=>o(!0),className:"px-3 py-2 border rounded-lg transition-all duration-200 hover:shadow-sm",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text},title:n==="fr"?"Choisir dans la liste":"Choose from list",children:e.jsx($e,{size:16})})]}),e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:["1m","5m","15m","1h","4h","1d"].map(p=>e.jsx("button",{onClick:()=>r("timeframe",p),className:`px-4 py-2 text-sm rounded-full border transition-all duration-200 ${s.timeframe===p?"border-0 shadow-sm":"hover:shadow-sm"}`,style:{backgroundColor:s.timeframe===p?t.colors.accent:t.colors.surface,color:s.timeframe===p?"#ffffff":t.colors.text,borderColor:s.timeframe===p?"transparent":t.colors.border},children:p},p))})})]}):null,ji=({formData:t,onChange:s,errors:r,settings:l,existingSymbols:n=[],isEditMode:o=!1,fieldConfig:a,shouldShowField:i,toggleFieldVisibility:c,isObligatoryField:d})=>{const{currentTheme:u}=Q(),{currentLanguage:m,t:p}=Z(),x=(X,ae)=>p[X]||ae,f=X=>x(X,X),[v,h]=g.useState(!1),[b,j]=g.useState(null),[y,N]=g.useState(!1),[w,S]=g.useState(!1),[k,C]=g.useState(""),[P,R]=g.useState(0),[M,T]=g.useState(null),D=n.slice(0,5),F={futures:["ES","NQ","YM","CL","GC","SI","ZB","ZN","NG","HO","RB","PL","PA","HG"],forex:["EURUSD","GBPUSD","USDJPY","AUDUSD","EURGBP","EURJPY","GBPJPY","USDCAD","NZDUSD","USDCHF"],crypto:["BTCUSD","ETHUSD","ADAUSD","SOLUSD","BTCUSDT","ETHUSDT","ADAUSDT","SOLUSDT","DOTUSD","LINKUSD"],stocks:["AAPL","MSFT","GOOGL","TSLA","AMZN","NVDA","META","NFLX","AMD","INTC"],indices:["SPX","NDX","DJI","RUT","VIX","SPY","QQQ","IWM","VXX"],commodities:["CL","GC","SI","NG","HO","RB","PL","PA","HG","ZC","ZS","ZW"]},[$,U]=g.useState(()=>JSON.parse(localStorage.getItem("favorite-symbols")||"[]")),[B,O]=g.useState(()=>JSON.parse(localStorage.getItem(`custom-symbols-${t.market}`)||"[]")),[z,q]=g.useState(null),[E,I]=g.useState(null),[H,L]=g.useState(!0);g.useEffect(()=>{const X=JSON.parse(localStorage.getItem(`custom-symbols-${t.market}`)||"[]");O(X)},[t.market]);const A=t.market?F[t.market]||[]:[],_=A.filter(X=>!$.includes(X)&&!B.includes(X)),J=X=>{if(!t.market||!X.trim())return;const ae=JSON.parse(localStorage.getItem(`custom-symbols-${t.market}`)||"[]"),ge=X.trim().toUpperCase();if(!ae.includes(ge)&&!A.includes(ge)){const Ce=[...ae,ge];localStorage.setItem(`custom-symbols-${t.market}`,JSON.stringify(Ce)),O(Ce)}},re=X=>{if(!t.market)return;const ge=JSON.parse(localStorage.getItem(`custom-symbols-${t.market}`)||"[]").filter(Ce=>Ce!==X);localStorage.setItem(`custom-symbols-${t.market}`,JSON.stringify(ge)),O(ge)},de=Tl,se=de(n,k),be=(X=>{if(!X.trim())return[];if(w)return[];if(!H)return[];const ae=X.toUpperCase(),ge=[...$,..._,...B];if(ge.includes(ae))return[];X.toLowerCase().trim();const Ce=[...new Set(ge)];return de(Ce,X).slice(0,5)})(t.symbol||""),he=de($,k),te=de(_,k),W=de(B,k),K=(X,ae)=>{const ge=Ml(X,ae,t.market);if(Cl(ae,t.market)){const Ke=Rl(X,ae,t.market,m),Nt=window.confirm(Ke+`

`+x("m_moriser_ce_choix_pour_ce_symbole__","MÃ©moriser ce choix pour ce symbole ?"));window.confirm(Ke)&&(s("market",ge),Nt&&Pl(X,ge,ae.rule,!0))}s("symbol",X);const Ce=JSON.parse(localStorage.getItem("symbol-recent")||"[]"),Be=[X,...Ce.filter(Ke=>Ke!==X)].slice(0,10);localStorage.setItem("symbol-recent",JSON.stringify(Be)),S(!1),C(""),R(0)},ue=g.useCallback(X=>{const ae=kl(X);K(X,ae),L(!1)},[K]),ye=X=>{const ae=JSON.parse(localStorage.getItem("favorite-symbols")||"[]"),ge=ae.includes(X);let Ce;ge?Ce=ae.filter(Be=>Be!==X):Ce=[...ae,X],localStorage.setItem("favorite-symbols",JSON.stringify(Ce)),U(Ce)},Fe=(X,ae)=>{q(ae),X.dataTransfer.effectAllowed="move",X.dataTransfer.setData("text/plain",ae)},ee=(X,ae)=>{X.preventDefault(),X.dataTransfer.dropEffect="move",I(ae)},oe=()=>{I(null)},ve=(X,ae)=>{if(X.preventDefault(),!z)return;const ge=$.indexOf(z);if(ge===-1||ge===ae){q(null),I(null);return}const Ce=[...$],[Be]=Ce.splice(ge,1);Ce.splice(ae,0,Be),localStorage.setItem("favorite-symbols",JSON.stringify(Ce)),U(Ce),q(null),I(null)},Y=()=>{q(null),I(null)};g.useEffect(()=>{const X=ae=>{if(ae.altKey&&ae.key==="t"&&(ae.preventDefault(),h(!0)),ae.altKey&&ae.key==="d"){ae.preventDefault();const ge=document.getElementById("trade-date-input");ge&&ge.focus()}if(ae.altKey&&ae.key==="s"&&(ae.preventDefault(),S(!0)),ae.key==="t"&&!ae.altKey&&!ae.ctrlKey&&document.activeElement?.id==="trade-date-input"&&(ae.preventDefault(),me()),ae.key==="Escape"&&(h(!1),S(!1),je(!1)),ae.key==="Enter"&&w&&se.length>0){ae.preventDefault();const ge=se[P];ge&&ue(ge)}if(w&&(ae.key==="ArrowDown"||ae.key==="ArrowUp"||ae.key==="ArrowLeft"||ae.key==="ArrowRight")){ae.preventDefault();const ge=2;Math.ceil(se.length/ge),ae.key==="ArrowDown"?R(Ce=>Math.min(Ce+ge,se.length-1)):ae.key==="ArrowUp"?R(Ce=>Math.max(Ce-ge,0)):ae.key==="ArrowRight"?R(Ce=>Math.min(Ce+1,se.length-1)):ae.key==="ArrowLeft"&&R(Ce=>Math.max(Ce-1,0))}};return document.addEventListener("keydown",X),()=>document.removeEventListener("keydown",X)},[s,w,se,P,ue]);const me=()=>{s("date",new Date().toISOString().split("T")[0])},[fe,je]=g.useState(!1);return g.useEffect(()=>{t.date&&y&&(s("entryDate",t.date),s("exitDate",t.date))},[t.date,y,s]),x("futures","Futures"),x("forex","Forex"),x("stocks","Actions"),x("indices","Indices"),x("crypto","Crypto"),x("commodities","MatiÃ¨res PremiÃ¨res"),e.jsxs("div",{className:"h-full flex flex-col animate-fadeIn",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-2 gap-10",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(vi,{theme:u,formData:t,onChange:s,errors:r,settings:l,translate:x,isEditMode:o,fieldConfig:a,shouldShowField:i,toggleFieldVisibility:c,isObligatoryField:d,currentLanguage:m}),i&&i("symbol")&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"block text-sm font-semibold",style:{color:u.colors.textSecondary},children:[x("symbole","Symbole")," *"]}),o&&!d?.("symbol")&&e.jsx("button",{type:"button",onClick:()=>c&&c("symbol"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:a?.hiddenFields?.includes("symbol")?"Afficher":"Masquer",style:{color:a?.hiddenFields?.includes("symbol")?u.colors.warning:u.colors.textMuted},children:a?.hiddenFields?.includes("symbol")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),o&&d?.("symbol")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:u.colors.accent+"20",color:u.colors.accent,border:`1px solid ${u.colors.accent}40`},title:m==="fr"?"Champ obligatoire":"Required field",children:m==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex space-x-2 relative",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:t.symbol||"",onChange:X=>{s("symbol",X.target.value.toUpperCase()),L(!0)},placeholder:x("ex__es__eurusd__aapl___","Ex: EURUSD, AAPL..."),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors shadow-sm",style:{backgroundColor:u.colors.surface,borderColor:r.symbol?u.colors.danger:u.colors.border,color:u.colors.text}}),e.jsx(Ko,{suggestions:be,favoriteSymbols:$,customSymbols:B,theme:u,onSelect:ue,onToggleFavorite:ye,onRemoveCustom:re})]}),e.jsx("button",{ref:T,type:"button",onClick:()=>S(!0),className:"px-3 py-2 border rounded-lg transition-all duration-200 hover:shadow-sm flex items-center",style:{backgroundColor:u.colors.surface,borderColor:u.colors.border,color:u.colors.text},title:x("alt_s_pour_ouvrir","Alt+S pour ouvrir"),children:e.jsx(qr,{size:16})})]}),D.length>0&&t.symbol!==D[0]&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-2",style:{color:u.colors.textMuted},children:f("recents")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:D.map(X=>e.jsx("button",{onClick:()=>s("symbol",X),className:"px-3 py-1 text-xs rounded-full border transition-all duration-200 hover:shadow-sm",style:{backgroundColor:t.symbol===X?u.colors.accent:u.colors.surface,borderColor:u.colors.border,color:t.symbol===X?"#ffffff":u.colors.text},children:X},X))})]})]}),r.symbol&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:u.colors.danger},children:r.symbol})]})]}),e.jsxs("div",{className:"flex flex-col ml-8 h-full",children:[e.jsx(Dl,{theme:u,formData:t,onChange:s,t1:f,currentLanguage:m,setTimeframeOverlay:h,setTimeframeButtonRef:j,isEditMode:o,fieldConfig:a,shouldShowField:i,toggleFieldVisibility:c,isObligatoryField:d}),i&&i("date")&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("label",{className:"block text-sm font-semibold",style:{color:u.colors.textSecondary},children:[f("date")," *"]}),o&&!d?.("date")&&e.jsx("button",{type:"button",onClick:()=>c&&c("date"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:a?.hiddenFields?.includes("date")?"Afficher":"Masquer",style:{color:a?.hiddenFields?.includes("date")?u.colors.warning:u.colors.textMuted},children:a?.hiddenFields?.includes("date")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),o&&d?.("date")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:u.colors.accent+"20",color:u.colors.accent,border:`1px solid ${u.colors.accent}40`},title:m==="fr"?"Champ obligatoire":"Required field",children:m==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx("div",{className:"relative flex-1",children:e.jsx(gs,{id:"trade-date-input",value:t.date||"",onChange:X=>s("date",X),placeholder:m==="fr"?"jj/mm/aaaa":"mm/dd/yyyy",title:x("alt_d_pour_focus_t_pour_aujourd_hui","Alt+D pour focus, T pour aujourd'hui"),className:"w-full",size:"compact"})})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:X=>N(X.target.checked),className:"rounded"}),e.jsx("span",{className:"text-sm",style:{color:u.colors.text},children:m==="fr"?"PrÃ©remplir l'entrÃ©e/sortie":"Prefill entry/exit"})]}),e.jsx("span",{className:"text-xs",style:{color:u.colors.textMuted},children:"Fuseau : Europe/Paris"})]})]})]})]})]}),e.jsx(_r,{isOpen:v,onClose:()=>h(!1),onSelect:X=>s("timeframe",X),currentValue:t.timeframe}),e.jsx(Vr,{isOpen:w,onClose:()=>S(!1),theme:u,t1:f,symbolSearch:k,onChangeSearch:C,onAddCustomSymbol:J,favoriteSymbols:$,filteredFavorites:he,filteredMarketSymbols:te,filteredCustomSymbols:W,currentSelectedSymbol:t.symbol,marketLabel:`Symboles (${(t.market||"").charAt(0).toUpperCase()}${(t.market||"").slice(1)})`,onSelectSymbol:ue,onToggleFavorite:ye,onRemoveCustomSymbol:re,draggedItem:z,dragOverIndex:E,onDragStart:Fe,onDragOver:ee,onDragLeave:oe,onDrop:ve,onDragEnd:Y})]})},Fl=(t,s)=>{const r=t?t.split(":").map(Number):[0,0,0],[l=0,n=0,o=0]=r,a=(u,m,p)=>{const x=u.toString().padStart(2,"0"),f=m.toString().padStart(2,"0"),v=p.toString().padStart(2,"0");s("entryTime",`${x}:${f}:${v}`)};return{hours:l,minutes:n,seconds:o,updateTime:a,handleHoursChange:u=>{const m=parseInt(u.target.value)||0,p=Math.max(0,Math.min(23,m));a(p,n,o)},handleMinutesChange:u=>{const m=parseInt(u.target.value)||0,p=Math.max(0,Math.min(59,m));a(l,p,o)},handleSecondsChange:u=>{const m=parseInt(u.target.value)||0,p=Math.max(0,Math.min(59,m));a(l,n,p)}}},Ni=t=>g.useMemo(()=>{const s=parseFloat(t.entryPrice?.toString()||"0"),r=parseFloat(t.quantity?.toString()||"0"),l=parseFloat(t.tickSize?.toString()||"0"),n=parseFloat(t.tickValue?.toString()||"0"),o=parseFloat(t.stopPrice?.toString()||"0"),a=parseFloat(t.marginPerContract?.toString()||"0"),i=parseFloat(t.leverage?.toString()||"0"),c=parseFloat(t.marginRate?.toString()||"0"),d=parseFloat(t.marginUsedOverride?.toString()||"0"),u=t.market==="futures"&&l>0?n/l:1,m=t.market==="futures"?s*u*r:s*r;let p=null;t.market==="futures"?p=a>0?a*r:null:d>0?p=d:i>0?p=m/i:c>0&&(p=m*(c/100));const x=o>0?Math.abs(s-o)*u*r:null,f=o>0?Math.abs(s-o):null,v=f&&l>0&&t.market==="futures"?Math.round(f/l):null,h=o>0&&(t.side==="long"&&o>=s||t.side==="short"&&o<=s);return{valuePerPoint:u,notional:m,margeUtilisee:p,risque:x,distancePoints:f,distanceTicks:v,isStopWrongSide:h}},[t.entryPrice,t.quantity,t.tickSize,t.tickValue,t.stopPrice,t.marginPerContract,t.leverage,t.marginRate,t.marginUsedOverride,t.market,t.side]),ki=t=>{const s=g.useMemo(()=>{if(t.market!=="futures"||!t.tickSize)return!1;const l=parseFloat(t.entryPrice?.toString()||"0"),n=parseFloat(t.tickSize?.toString()||"0");return l%n!==0},[t.entryPrice,t.tickSize,t.market]),r=g.useMemo(()=>{if(t.market!=="futures"||!t.tickSize||!t.stopPrice)return!1;const l=parseFloat(t.stopPrice?.toString()||"0"),n=parseFloat(t.tickSize?.toString()||"0");return l%n!==0},[t.stopPrice,t.tickSize,t.market]);return{isPriceOutOfTick:s,isStopOutOfTick:r}},vn={NQ:{tickSize:.25,tickValue:12.5},MNQ:{tickSize:.25,tickValue:1.25},ES:{tickSize:.25,tickValue:12.5},MES:{tickSize:.25,tickValue:1.25},YM:{tickSize:1,tickValue:5},RTY:{tickSize:.1,tickValue:5}},wi=({show:t,isStopWrongSide:s})=>{const{currentTheme:r}=Q(),{currentLanguage:l}=Z();return t?e.jsxs("div",{className:"mb-4 p-3 rounded-lg border-l-4",style:{backgroundColor:r.colors.warning+"10",borderLeftColor:r.colors.warning},children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Xt,{size:16,style:{color:r.colors.warning}}),e.jsx("span",{className:"font-medium",style:{color:r.colors.warning},children:s?l==="fr"?"Stop au mauvais cÃ´tÃ©":"Stop on wrong side":l==="fr"?"Prix hors tick":"Price out of tick"})]}),e.jsx("p",{className:"text-sm mt-1",style:{color:r.colors.textMuted},children:s?l==="fr"?"Le stop doit Ãªtre en dessous/au-dessus du prix d'entrÃ©e selon le sens.":"Stop must be below/above entry price depending on side.":l==="fr"?"Le prix d'entrÃ©e ou le stop ne respecte pas la taille de tick du marchÃ©.":"Entry price or stop does not respect the market tick size."})]}):null},El=({formData:t,onChange:s,errors:r,hideEntryDateLabel:l,hideEntryTimeLabel:n})=>{const{currentTheme:o}=Q(),{currentLanguage:a}=Z(),[i,c]=g.useState(null),{hours:d,minutes:u,seconds:m,updateTime:p,handleHoursChange:x,handleMinutesChange:f,handleSecondsChange:v}=Fl(t.entryTime,s);return g.useEffect(()=>{const h=b=>{b.target.closest(".time-dropdown-container")||c(null)};return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[]),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[!l&&e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:o.colors.textSecondary},children:[a==="fr"?"Date d'entrÃ©e":"Entry Date"," *"]}),e.jsx("div",{className:"relative",children:e.jsx(gs,{id:"entry-date-input",name:"entryDate",value:t.entryDate||"",onChange:h=>s("entryDate",h),placeholder:a==="fr"?"jj/mm/aaaa":"mm/dd/yyyy",title:a==="fr"?"Alt+D pour focus, T pour aujourd'hui":"Alt+D for focus, T for today",className:"w-full",size:"compact"})}),r.entryDate&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:o.colors.danger},children:r.entryDate})]}),e.jsxs("div",{children:[!n&&e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:o.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ze,{size:16,className:"mr-2"}),a==="fr"?"Heure d'entrÃ©e":"Entry Time"]})}),e.jsxs("div",{className:"time-dropdown-container flex space-x-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:d.toString().padStart(2,"0"),onChange:x,onClick:()=>c(i==="hours"?null:"hours"),className:"w-full px-3 py-2 border rounded-lg text-center focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:o.colors.surface,borderColor:r.entryTime?o.colors.danger:o.colors.border,color:o.colors.text},name:"entryTime"}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:o.colors.textMuted},children:a==="fr"?"Heures":"Hours"}),i==="hours"&&e.jsx("div",{className:"absolute z-10 mt-1 w-full theme-surface border theme-border rounded-md shadow-lg",style:{backgroundColor:o.colors.card,borderColor:o.colors.border,left:"0",maxHeight:"200px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Array.from({length:24},(h,b)=>e.jsx("button",{type:"button",onClick:()=>{p(b,u,m),c(null)},className:"px-2 py-2 text-sm rounded text-center transition-colors w-full",style:{backgroundColor:d===b?`${o.colors.accent}20`:o.colors.surface,color:d===b?o.colors.accent:o.colors.text,border:`1px solid ${d===b?o.colors.accent:"transparent"}`},children:b.toString().padStart(2,"0")},b))})})})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:u.toString().padStart(2,"0"),onChange:f,onClick:()=>c(i==="minutes"?null:"minutes"),className:"w-full px-3 py-2 border rounded-lg text-center focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:o.colors.surface,borderColor:r.entryTime?o.colors.danger:o.colors.border,color:o.colors.text},name:"entryTime"}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:o.colors.textMuted},children:"Minutes"}),i==="minutes"&&e.jsx("div",{className:"absolute z-10 mt-1 w-full theme-surface border theme-border rounded-md shadow-lg",style:{backgroundColor:o.colors.card,borderColor:o.colors.border,left:"0",maxHeight:"200px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Array.from({length:60},(h,b)=>e.jsx("button",{type:"button",onClick:()=>{p(d,b,m),c(null)},className:"px-2 py-2 text-sm rounded text-center transition-colors w-full",style:{backgroundColor:u===b?`${o.colors.accent}20`:o.colors.surface,color:u===b?o.colors.accent:o.colors.text,border:`1px solid ${u===b?o.colors.accent:"transparent"}`},children:b.toString().padStart(2,"0")},b))})})})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:m.toString().padStart(2,"0"),onChange:v,onClick:()=>c(i==="seconds"?null:"seconds"),className:"w-full px-3 py-2 border rounded-lg text-center focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:o.colors.surface,borderColor:r.entryTime?o.colors.danger:o.colors.border,color:o.colors.text},name:"entryTime"}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:o.colors.textMuted},children:a==="fr"?"Secondes":"Seconds"}),i==="seconds"&&e.jsx("div",{className:"absolute z-10 mt-1 w-full theme-surface border theme-border rounded-md shadow-lg",style:{backgroundColor:o.colors.card,borderColor:o.colors.border,left:"0",maxHeight:"200px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Array.from({length:60},(h,b)=>e.jsx("button",{type:"button",onClick:()=>{p(d,u,b),c(null)},className:"px-2 py-2 text-sm rounded text-center transition-colors w-full",style:{backgroundColor:m===b?`${o.colors.accent}20`:o.colors.surface,color:m===b?o.colors.accent:o.colors.text,border:`1px solid ${m===b?o.colors.accent:"transparent"}`},children:b.toString().padStart(2,"0")},b))})})})]})]}),r.entryTime&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:o.colors.danger},children:r.entryTime})]})]})})},Si=({inputValues:t,lockedFields:s,setLockedFields:r,onChange:l,handleNumericChange:n,handleNumericBlur:o,valuePerPoint:a})=>{const{currentTheme:i}=Q(),{currentLanguage:c}=Z(),d=m=>{const p=vn[m];p&&(l("tickSize",p.tickSize),l("tickValue",p.tickValue))},u=m=>{r(p=>({...p,[m]:!1}))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-md font-semibold",style:{color:i.colors.text},children:c==="fr"?"ParamÃ¨tres Futures":"Futures Parameters"}),e.jsx("div",{className:"flex space-x-2",children:Object.keys(vn).map(m=>e.jsx("button",{onClick:()=>d(m),className:"px-2 py-1 text-xs rounded border transition-colors",style:{backgroundColor:i.colors.surface,borderColor:i.colors.border,color:i.colors.text},children:m},m))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:i.colors.textSecondary},children:["Tick Size"," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t.tickSize,onChange:m=>n("tickSize",m.target.value),onBlur:()=>o("tickSize"),placeholder:"Ex: 0.25",disabled:s.tickSize,className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all durÃ©e-200",style:{backgroundColor:s.tickSize?i.colors.surface+"80":i.colors.surface,borderColor:i.colors.border,color:i.colors.text}}),e.jsx("button",{type:"button",onClick:()=>u("tickSize"),className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:s.tickSize?e.jsx(pn,{size:14}):e.jsx(gn,{size:14})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:i.colors.textSecondary},children:[c==="fr"?"Valeur par Tick":"Tick Value"," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t.tickValue,onChange:m=>n("tickValue",m.target.value),onBlur:()=>o("tickValue"),placeholder:"Ex: 12.50",disabled:s.tickValue,className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all durÃ©e-200",style:{backgroundColor:s.tickValue?i.colors.surface+"80":i.colors.surface,borderColor:i.colors.border,color:i.colors.text}}),e.jsx("button",{type:"button",onClick:()=>u("tickValue"),className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:s.tickValue?e.jsx(pn,{size:14}):e.jsx(gn,{size:14})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-3",style:{color:i.colors.textSecondary},children:c==="fr"?"Valeur par Point":"Value per Point"}),e.jsx("input",{type:"text",value:a.toFixed(2),readOnly:!0,className:"w-full px-3 py-2 border rounded-lg shadow-sm",style:{backgroundColor:i.colors.surface+"60",borderColor:i.colors.border,color:i.colors.textMuted}})]})]})},Ci=({inputValues:t,handleNumericChange:s,handleNumericBlur:r,handleKeyDown:l,isEditMode:n=!1,fieldConfig:o,shouldShowField:a,toggleFieldVisibility:i,isObligatoryField:c,currentLanguage:d,currentTheme:u})=>{const{currentTheme:m}=Q(),{currentLanguage:p}=Z(),x=u||m,f=d||p;return e.jsxs("div",{className:"space-y-4",children:[a&&a("leverage")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-semibold",style:{color:x.colors.textSecondary},children:f==="fr"?"Effet de levier":"Leverage"}),n&&!c?.("leverage")&&e.jsx("button",{type:"button",onClick:()=>i&&i("leverage"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("leverage")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("leverage")?x.colors.accent:x.colors.textMuted},children:o?.hiddenFields?.includes("leverage")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),n&&c?.("leverage")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:x.colors.accent+"20",color:x.colors.accent,border:`1px solid ${x.colors.accent}40`},title:f==="fr"?"Champ obligatoire":"Required field",children:f==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t.leverage,onChange:v=>s("leverage",v.target.value),onBlur:()=>r("leverage"),onKeyDown:l,placeholder:"Ex: 10",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:x.colors.surface,borderColor:x.colors.border,color:x.colors.text}}),e.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-sm",style:{color:x.colors.textMuted},children:"x"})]})]}),a&&a("marginRate")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-semibold",style:{color:x.colors.textSecondary},children:f==="fr"?"Taux de marge (%)":"Margin Rate (%)"}),n&&!c?.("marginRate")&&e.jsx("button",{type:"button",onClick:()=>i&&i("marginRate"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("marginRate")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("marginRate")?x.colors.accent:x.colors.textMuted},children:o?.hiddenFields?.includes("marginRate")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),n&&c?.("marginRate")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:x.colors.accent+"20",color:x.colors.accent,border:`1px solid ${x.colors.accent}40`},title:f==="fr"?"Champ obligatoire":"Required field",children:f==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t.marginRate,onChange:v=>s("marginRate",v.target.value),onBlur:()=>r("marginRate"),onKeyDown:l,placeholder:"Ex: 5",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:x.colors.surface,borderColor:x.colors.border,color:x.colors.text}}),e.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-sm",style:{color:x.colors.textMuted},children:"%"})]})]}),a&&a("marginUsedOverride")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-semibold",style:{color:x.colors.textSecondary},children:f==="fr"?"Marge utilisÃ©e (override)":"Margin Used (Override)"}),n&&!c?.("marginUsedOverride")&&e.jsx("button",{type:"button",onClick:()=>i&&i("marginUsedOverride"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("marginUsedOverride")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("marginUsedOverride")?x.colors.accent:x.colors.textMuted},children:o?.hiddenFields?.includes("marginUsedOverride")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),n&&c?.("marginUsedOverride")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:x.colors.accent+"20",color:x.colors.accent,border:`1px solid ${x.colors.accent}40`},title:f==="fr"?"Champ obligatoire":"Required field",children:f==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t.marginUsedOverride,onChange:v=>s("marginUsedOverride",v.target.value),onBlur:()=>r("marginUsedOverride"),onKeyDown:l,placeholder:"Ex: 500.00",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:x.colors.surface,borderColor:x.colors.border,color:x.colors.text}}),e.jsx(Ge,{size:16,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:x.colors.textMuted}})]}),e.jsx("p",{className:"text-xs mt-1",style:{color:x.colors.textMuted},children:f==="fr"?"Optionnel: remplace le calcul automatique":"Optional: overrides automatic calculation"})]})]})},Pi=({formData:t,onChange:s,errors:r,settings:l,isEditMode:n=!1,fieldConfig:o,shouldShowField:a,toggleFieldVisibility:i,isObligatoryField:c})=>{const{currentTheme:d}=Q(),{currentLanguage:u}=Z(),[m,p]=g.useState({entryPrice:t.entryPrice?.toString()||"",quantity:t.quantity?.toString()||"",tickSize:t.tickSize?.toString()||"",tickValue:t.tickValue?.toString()||"",stopPrice:t.stopPrice?.toString()||"",takeProfitPrice:t.takeProfitPrice?.toString()||"",marginPerContract:t.marginPerContract?.toString()||"",leverage:t.leverage?.toString()||"",marginRate:t.marginRate?.toString()||"",marginUsedOverride:t.marginUsedOverride?.toString()||""}),[x,f]=g.useState({tickSize:!1,tickValue:!1}),[v,h]=g.useState(null);Fl(t.entryTime,s);const b=Ni(t),{isPriceOutOfTick:j,isStopOutOfTick:y}=ki(t),N=(C,P)=>{const R=P.replace(",",".");p(T=>({...T,[C]:R}));const M=parseFloat(R);isNaN(M)||s(C,M)},w=C=>{const P=parseFloat(m[C]);if(!isNaN(P))s(C,P);else{const R=t[C];p(M=>({...M,[C]:R?.toString()||""}))}},S=C=>{const P=["Backspace","Delete","Tab","Escape","Enter","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"],R=/[0-9]/.test(C.key),M=C.key==="."||C.key===",",T=P.includes(C.key);!R&&!M&&!T&&C.preventDefault()},k=()=>{switch(t.market){case"futures":return u==="fr"?"Contrats":"Contracts";case"stocks":return u==="fr"?"Actions":"Shares";case"crypto":return u==="fr"?"UnitÃ©s":"Units";case"forex":return"Lots";default:return u==="fr"?"UnitÃ©s":"Units"}};return e.jsxs("div",{className:"h-full flex flex-col animate-fadeIn",children:[e.jsx(wi,{show:j||y||b.isStopWrongSide,isStopWrongSide:!!b.isStopWrongSide}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-2 gap-10",children:[e.jsxs("div",{className:"flex flex-col space-y-6",children:[e.jsx(El,{formData:t,onChange:s,errors:r}),a&&a("entryPrice")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"block text-sm font-semibold",style:{color:d.colors.textSecondary},children:[u==="fr"?"Prix d'entrÃ©e":"Entry Price",(localStorage.getItem("trade-modal-pnl-input-mode")||"detailed")==="detailed"?" *":" (optionnel)"]}),n&&!c?.("entryPrice")&&e.jsx("button",{type:"button",onClick:()=>i&&i("entryPrice"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("entryPrice")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("entryPrice")?d.colors.warning:d.colors.textMuted},children:o?.hiddenFields?.includes("entryPrice")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),n&&c?.("entryPrice")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:d.colors.accent+"20",color:d.colors.accent,border:`1px solid ${d.colors.accent}40`},title:u==="fr"?"Champ obligatoire":"Required field",children:u==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:m.entryPrice,onChange:C=>N("entryPrice",C.target.value),onBlur:()=>w("entryPrice"),onKeyDown:S,placeholder:"Ex: 4250.50",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:d.colors.surface,borderColor:r.entryPrice?d.colors.danger:d.colors.border,color:d.colors.text},name:"entryPrice"}),e.jsx(Ge,{size:16,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:d.colors.textMuted}})]}),r.entryPrice&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:d.colors.danger},children:r.entryPrice}),(localStorage.getItem("trade-modal-pnl-input-mode")||"detailed")==="direct"&&e.jsx("p",{className:"mt-2 text-xs",style:{color:d.colors.textMuted},children:u==="fr"?"Optionnel en mode P&L direct - calculÃ© automatiquement si possible":"Optional in direct P&L mode - calculated automatically if possible"})]}),a&&a("quantity")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"block text-sm font-semibold",style:{color:d.colors.textSecondary},children:[u==="fr"?"Taille":"Size"," *"]}),n&&!c?.("quantity")&&e.jsx("button",{type:"button",onClick:()=>i&&i("quantity"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("quantity")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("quantity")?d.colors.warning:d.colors.textMuted},children:o?.hiddenFields?.includes("quantity")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),n&&c?.("quantity")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:d.colors.accent+"20",color:d.colors.accent,border:`1px solid ${d.colors.accent}40`},title:u==="fr"?"Champ obligatoire":"Required field",children:u==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",value:m.quantity,onChange:C=>N("quantity",C.target.value),onBlur:()=>w("quantity"),onKeyDown:S,placeholder:"Ex: 1",className:"w-full px-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:d.colors.surface,borderColor:r.quantity?d.colors.danger:d.colors.border,color:d.colors.text}}),r.quantity&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:d.colors.danger},children:r.quantity})]}),e.jsx("div",{children:e.jsx("div",{className:"w-full px-3 py-2 border rounded-lg shadow-sm flex items-center justify-center",style:{backgroundColor:d.colors.surface+"60",borderColor:d.colors.border,color:d.colors.textMuted},children:k()})})]})]}),t.market==="futures"&&e.jsx(Si,{inputValues:{tickSize:m.tickSize,tickValue:m.tickValue},lockedFields:x,setLockedFields:f,onChange:s,handleNumericChange:N,handleNumericBlur:w,valuePerPoint:b.valuePerPoint})]}),e.jsxs("div",{className:"flex flex-col space-y-6",children:[a&&(a("stopPrice")||a("takeProfitPrice"))&&e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a&&a("stopPrice")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-semibold",style:{color:d.colors.textSecondary},children:u==="fr"?"Stop prÃ©vu":"Planned Stop"}),n&&!c?.("stopPrice")&&e.jsx("button",{type:"button",onClick:()=>i&&i("stopPrice"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("stopPrice")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("stopPrice")?d.colors.warning:d.colors.textMuted},children:o?.hiddenFields?.includes("stopPrice")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),n&&c?.("stopPrice")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:d.colors.accent+"20",color:d.colors.accent,border:`1px solid ${d.colors.accent}40`},title:u==="fr"?"Champ obligatoire":"Required field",children:u==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:m.stopPrice,onChange:C=>N("stopPrice",C.target.value),onBlur:()=>w("stopPrice"),placeholder:"Ex: 4200.00",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.text}}),e.jsx(Te,{size:16,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:d.colors.textMuted}})]})]}),a&&a("takeProfitPrice")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-semibold",style:{color:d.colors.textSecondary},children:u==="fr"?"Take Profit prÃ©vu":"Planned Take Profit"}),n&&!c?.("takeProfitPrice")&&e.jsx("button",{type:"button",onClick:()=>i&&i("takeProfitPrice"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("takeProfitPrice")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("takeProfitPrice")?d.colors.warning:d.colors.textMuted},children:o?.hiddenFields?.includes("takeProfitPrice")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),n&&c?.("takeProfitPrice")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:d.colors.accent+"20",color:d.colors.accent,border:`1px solid ${d.colors.accent}40`},title:u==="fr"?"Champ obligatoire":"Required field",children:u==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:m.takeProfitPrice,onChange:C=>N("takeProfitPrice",C.target.value),onBlur:()=>w("takeProfitPrice"),placeholder:"Ex: 4300.00",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.text}}),e.jsx(Ae,{size:16,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:d.colors.textMuted}})]})]})]})}),t.market==="futures"?a&&a("marginPerContract")?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-semibold",style:{color:d.colors.textSecondary},children:u==="fr"?"Marge par contrat":"Margin per Contract"}),n&&!c?.("marginPerContract")&&e.jsx("button",{type:"button",onClick:()=>i&&i("marginPerContract"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("marginPerContract")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("marginPerContract")?d.colors.warning:d.colors.textMuted},children:o?.hiddenFields?.includes("marginPerContract")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),n&&c?.("marginPerContract")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:d.colors.accent+"20",color:d.colors.accent,border:`1px solid ${d.colors.accent}40`},title:u==="fr"?"Champ obligatoire":"Required field",children:u==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:m.marginPerContract,onChange:C=>N("marginPerContract",C.target.value),onBlur:()=>w("marginPerContract"),onKeyDown:S,placeholder:"Ex: 1000.00",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.text}}),e.jsx(Ge,{size:16,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:d.colors.textMuted}})]})]}):null:a&&(a("leverage")||a("marginRate")||a("marginUsedOverride"))?e.jsx(Ci,{inputValues:{leverage:m.leverage,marginRate:m.marginRate,marginUsedOverride:m.marginUsedOverride},handleNumericChange:N,handleNumericBlur:w,handleKeyDown:S,isEditMode:n,fieldConfig:o,shouldShowField:a,toggleFieldVisibility:i,isObligatoryField:c,currentLanguage:u,currentTheme:d}):null]})]})]})},Mi=({show:t,currentTheme:s,currentLanguage:r})=>t?e.jsxs("div",{className:"mb-4 p-3 rounded-lg border-l-4",style:{backgroundColor:s.colors.warning+"10",borderLeftColor:s.colors.warning},children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Xt,{size:16,style:{color:s.colors.warning}}),e.jsx("span",{className:"font-medium",style:{color:s.colors.warning},children:r==="fr"?"Prix de sortie hors tick":"Exit price out of tick"})]}),e.jsx("p",{className:"text-sm mt-1",style:{color:s.colors.textMuted},children:r==="fr"?"Le prix de sortie ne respecte pas la taille de tick du marchÃ©.":"Exit price does not respect the market tick size."})]}):null,Yo=({currentTheme:t,currentLanguage:s,errors:r,hours:l,minutes:n,seconds:o,active:a,setActive:i,updateTime:c,hideExitTimeLabel:d})=>e.jsxs("div",{children:[!d&&e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:t.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ze,{size:16,className:"mr-2"}),s==="fr"?"Heure de sortie":"Exit Time"]})}),e.jsxs("div",{className:"time-dropdown-container flex space-x-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:l.toString().padStart(2,"0"),onChange:u=>c(Math.max(0,Math.min(23,parseInt(u.target.value)||0)),n,o),onClick:()=>i(a==="hours"?null:"hours"),className:"w-full px-3 py-2 border rounded-lg text-center focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:t.colors.surface,borderColor:r.exitTime?t.colors.danger:t.colors.border,color:t.colors.text}}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:t.colors.textMuted},children:s==="fr"?"Heures":"Hours"}),a==="hours"&&e.jsx("div",{className:"absolute z-10 mt-1 w-full theme-surface border theme-border rounded-md shadow-lg",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,left:"0",maxHeight:"200px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Array.from({length:24},(u,m)=>e.jsx("button",{type:"button",onClick:()=>{c(m,n,o),i(null)},className:"px-2 py-2 text-sm rounded text-center transition-colors w-full",style:{backgroundColor:l===m?`${t.colors.accent}20`:t.colors.surface,color:l===m?t.colors.accent:t.colors.text,border:`1px solid ${l===m?t.colors.accent:"transparent"}`},children:m.toString().padStart(2,"0")},m))})})})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:n.toString().padStart(2,"0"),onChange:u=>c(l,Math.max(0,Math.min(59,parseInt(u.target.value)||0)),o),onClick:()=>i(a==="minutes"?null:"minutes"),className:"w-full px-3 py-2 border rounded-lg text-center focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:t.colors.surface,borderColor:r.exitTime?t.colors.danger:t.colors.border,color:t.colors.text}}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:t.colors.textMuted},children:"Minutes"}),a==="minutes"&&e.jsx("div",{className:"absolute z-10 mt-1 w-full theme-surface border theme-border rounded-md shadow-lg",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,left:"0",maxHeight:"200px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Array.from({length:60},(u,m)=>e.jsx("button",{type:"button",onClick:()=>{c(l,m,o),i(null)},className:"px-2 py-2 text-sm rounded text-center transition-colors w-full",style:{backgroundColor:n===m?`${t.colors.accent}20`:t.colors.surface,color:n===m?t.colors.accent:t.colors.text,border:`1px solid ${n===m?t.colors.accent:"transparent"}`},children:m.toString().padStart(2,"0")},m))})})})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:o.toString().padStart(2,"0"),onChange:u=>c(l,n,Math.max(0,Math.min(59,parseInt(u.target.value)||0))),onClick:()=>i(a==="seconds"?null:"seconds"),className:"w-full px-3 py-2 border rounded-lg text-center focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:t.colors.surface,borderColor:r.exitTime?t.colors.danger:t.colors.border,color:t.colors.text}}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:t.colors.textMuted},children:s==="fr"?"Secondes":"Seconds"}),a==="seconds"&&e.jsx("div",{className:"absolute z-10 mt-1 w-full theme-surface border theme-border rounded-md shadow-lg",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,left:"0",maxHeight:"200px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Array.from({length:60},(u,m)=>e.jsx("button",{type:"button",onClick:()=>{c(l,n,m),i(null)},className:"px-2 py-2 text-sm rounded text-center transition-colors w-full",style:{backgroundColor:o===m?`${t.colors.accent}20`:t.colors.surface,color:o===m?t.colors.accent:t.colors.text,border:`1px solid ${o===m?t.colors.accent:"transparent"}`},children:m.toString().padStart(2,"0")},m))})})})]})]}),r.exitTime&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:t.colors.danger},children:r.exitTime})]}),Al=({currentTheme:t,currentLanguage:s,pnlBrut:r,totalFees:l,pnlNet:n,accountPercentage:o,formatCurrency:a})=>e.jsxs("div",{className:"p-6 rounded-lg border",style:{backgroundColor:t.colors.card,borderColor:t.colors.border},children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(qo,{size:20,className:"mr-2",style:{color:t.colors.accent}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:t.colors.text},children:s==="fr"?"RÃ©sumÃ© P&L":"P&L Summary"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ae,{size:16,className:"mr-2",style:{color:r&&r>=0?t.colors.success:t.colors.danger}}),e.jsx("span",{style:{color:t.colors.textSecondary},children:s==="fr"?"P&L Brut (avant frais)":"Gross P&L (before fees)"})]}),e.jsx("span",{className:"font-bold",style:{color:r&&r>=0?t.colors.success:t.colors.danger},children:r!==null?(r>=0?"+":"")+a(r):"--"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ge,{size:16,className:"mr-2",style:{color:t.colors.warning}}),e.jsx("span",{style:{color:t.colors.textSecondary},children:s==="fr"?"Frais Totaux":"Total Fees"})]}),e.jsxs("span",{className:"font-bold",style:{color:t.colors.warning},children:[l>=0?"+":"",a(l)]})]}),e.jsx("div",{className:"border-t my-2",style:{borderColor:t.colors.border}}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx($t,{size:16,className:"mr-2",style:{color:n&&n>=0?t.colors.success:t.colors.danger}}),e.jsx("span",{className:"font-medium",style:{color:t.colors.text},children:s==="fr"?"P&L Net (aprÃ¨s frais)":"Net P&L (after fees)"})]}),e.jsx("span",{className:"text-lg font-bold",style:{color:n&&n>=0?t.colors.success:t.colors.danger},children:n!==null?(n>=0?"+":"")+a(n):"--"})]}),o!==null&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(is,{size:16,className:"mr-2",style:{color:t.colors.accent}}),e.jsx("span",{style:{color:t.colors.textSecondary},children:s==="fr"?"Pourcentage du compte":"Account Percentage"})]}),e.jsxs("span",{className:"font-bold",style:{color:o>=0?t.colors.success:t.colors.danger},children:[o>=0?"+":"",o.toFixed(2),"%"]})]})]})]}),Ri=({currentTheme:t,currentLanguage:s,errors:r,values:l,onChange:n,isEditMode:o=!1,fieldConfig:a,shouldShowField:i,toggleFieldVisibility:c,isObligatoryField:d})=>{const u=m=>m==null?"":String(m);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(oc,{size:20,style:{color:t.colors.accent}}),e.jsx("h3",{className:"text-lg font-semibold",style:{color:t.colors.text},children:s==="fr"?"Frais (optionnels)":"Fees (optional)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i&&i("commission")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",style:{color:t.colors.textSecondary},children:"Commission"}),o&&!d?.("commission")&&e.jsx("button",{type:"button",onClick:()=>c&&c("commission"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:a?.hiddenFields?.includes("commission")?"Afficher":"Masquer",style:{color:a?.hiddenFields?.includes("commission")?t.colors.warning:t.colors.textMuted},children:a?.hiddenFields?.includes("commission")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),o&&d?.("commission")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:u(l.commission),onChange:m=>n("fees.commission",m.target.value),placeholder:"-2.5",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}}),e.jsx(Ge,{size:14,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:t.colors.textMuted}})]})]}),i&&i("spread_slippage")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",style:{color:t.colors.textSecondary},children:"Spread/Slippage"}),o&&!d?.("spread_slippage")&&e.jsx("button",{type:"button",onClick:()=>c&&c("spread_slippage"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:a?.hiddenFields?.includes("spread_slippage")?"Afficher":"Masquer",style:{color:a?.hiddenFields?.includes("spread_slippage")?t.colors.warning:t.colors.textMuted},children:a?.hiddenFields?.includes("spread_slippage")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),o&&d?.("spread_slippage")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:u(l.spread_slippage),onChange:m=>n("fees.spread_slippage",m.target.value),placeholder:"-1.2",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}}),e.jsx(Ge,{size:14,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:t.colors.textMuted}})]})]}),i&&i("swap_overnight")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",style:{color:t.colors.textSecondary},children:"Swap/Overnight"}),o&&!d?.("swap_overnight")&&e.jsx("button",{type:"button",onClick:()=>c&&c("swap_overnight"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:a?.hiddenFields?.includes("swap_overnight")?"Afficher":"Masquer",style:{color:a?.hiddenFields?.includes("swap_overnight")?t.colors.warning:t.colors.textMuted},children:a?.hiddenFields?.includes("swap_overnight")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),o&&d?.("swap_overnight")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:u(l.swap_overnight),onChange:m=>n("fees.swap_overnight",m.target.value),placeholder:"-0.5",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}}),e.jsx(Ge,{size:14,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:t.colors.textMuted}})]})]}),i&&i("other")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",style:{color:t.colors.textSecondary},children:s==="fr"?"Autres frais":"Other fees"}),o&&!d?.("other")&&e.jsx("button",{type:"button",onClick:()=>c&&c("other"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:a?.hiddenFields?.includes("other")?"Afficher":"Masquer",style:{color:a?.hiddenFields?.includes("other")?t.colors.warning:t.colors.textMuted},children:a?.hiddenFields?.includes("other")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),o&&d?.("other")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:u(l.other),onChange:m=>n("fees.other",m.target.value),placeholder:"-0.25",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all durÃ©e-200",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}}),e.jsx(Ge,{size:14,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:t.colors.textMuted}})]})]})]})]})},Ll=({mode:t,onModeChange:s,disabled:r=!1})=>{const{currentTheme:l}=Q(),{currentLanguage:n}=Z();return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",style:{color:l.colors.textSecondary},children:n==="fr"?"Saisie :":"Input:"}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsxs("button",{onClick:()=>s("percentage"),disabled:r,className:`flex items-center space-x-1 px-3 py-1 text-sm rounded-lg border-2 transition-all duration-200 ${t==="percentage"?"border-0 shadow-md transform scale-105":"hover:shadow-sm"} ${r?"opacity-50 cursor-not-allowed":""}`,style:{backgroundColor:t==="percentage"?l.colors.accent:l.colors.surface,color:t==="percentage"?"#ffffff":l.colors.text,borderColor:t==="percentage"?"transparent":l.colors.border},children:[e.jsx(is,{size:14}),e.jsx("span",{children:"%"})]}),e.jsxs("button",{onClick:()=>s("absolute"),disabled:r,className:`flex items-center space-x-1 px-3 py-1 text-sm rounded-lg border-2 transition-all duration-200 ${t==="absolute"?"border-0 shadow-md transform scale-105":"hover:shadow-sm"} ${r?"opacity-50 cursor-not-allowed":""}`,style:{backgroundColor:t==="absolute"?l.colors.accent:l.colors.surface,color:t==="absolute"?"#ffffff":l.colors.text,borderColor:t==="absolute"?"transparent":l.colors.border},children:[e.jsx(sr,{size:14}),e.jsx("span",{children:"P&L"})]})]})]})},Ti=({formData:t,onChange:s,errors:r,settings:l,isEditMode:n=!1,fieldConfig:o,shouldShowField:a,toggleFieldVisibility:i,isObligatoryField:c})=>{const{currentTheme:d}=Q(),{currentLanguage:u}=Z(),m=localStorage.getItem("trade-modal-pnl-input-mode")||"detailed",[p,x]=g.useState("percentage"),[f,v]=g.useState({exitPrice:t.exitPrice?.toString()||"",commission:t.fees?.commission!==void 0?t.fees.commission.toString():"",spreadSlippage:t.fees?.spread_slippage!==void 0?t.fees.spread_slippage.toString():"",swapOvernight:t.fees?.swap_overnight!==void 0?t.fees.swap_overnight.toString():"",other:t.fees?.other!==void 0?t.fees.other.toString():""}),[h,b]=g.useState(null),j=t.exitTime?t.exitTime.split(":").map(Number):[0,0,0],[y=0,N=0,w=0]=j,S=(E,I,H)=>{const L=E.toString().padStart(2,"0"),A=I.toString().padStart(2,"0"),_=H.toString().padStart(2,"0");s("exitTime",`${L}:${A}:${_}`)};g.useEffect(()=>{const E=I=>{I.target.closest(".time-dropdown-container")||b(null)};return document.addEventListener("mousedown",E),()=>document.removeEventListener("mousedown",E)},[]);const k=(E,I)=>{const H=I.replace(",",".");if(v(L=>({...L,[E]:H})),E.startsWith("fees.")){const L=E.split(".")[1],A={...t.fees||{}};A[L]=H,s("fees",A)}else s(E,H)},C=E=>{if(E==null||E==="")return 0;if(typeof E=="number")return E;const I=String(E).replace(",","."),H=parseFloat(I);return isNaN(H)?0:H},P=E=>{},R=E=>{},M=g.useMemo(()=>{const E=parseFloat(t.entryPrice?.toString()||"0"),I=parseFloat(t.exitPrice?.toString()||"0"),H=parseFloat(t.quantity?.toString()||"0"),L=parseFloat(t.tickSize?.toString()||"0"),A=parseFloat(t.tickValue?.toString()||"0"),_=t.side==="long"?1:-1,J=t.market==="futures"&&L>0?A/L:1;let re=null;if(t.entryDate&&t.entryTime&&t.exitDate&&t.exitTime){const oe=new Date(`${t.entryDate}T${t.entryTime}`),Y=new Date(`${t.exitDate}T${t.exitTime}`).getTime()-oe.getTime();if(Y>0){const me=Math.floor(Y/36e5),fe=Math.floor(Y%(1e3*60*60)/(1e3*60)),je=Math.floor(Y%(1e3*60)/1e3);re={hours:me,minutes:fe,seconds:je}}}let de=null;E>0&&I>0&&H>0&&(t.market==="futures"?de=(I-E)*J*H*_:de=(I-E)*H*_);const se=t.fees||{},ke=C(se.commission),be=C(se.spread_slippage),he=C(se.swap_overnight),te=C(se.other),W=ke+be+he+te;let K=null;de!==null&&(K=de+W);let ue=null;K!==null&&l?.equity&&l.equity>0&&(ue=K/l.equity*100);let ye=null,Fe=null;t.market==="futures"&&E>0&&I>0&&(ye=(I-E)*_,L>0&&(Fe=ye/L));const ee=t.market==="futures"&&L>0&&I>0&&Math.abs(I%L)>1e-9;return{duration:re,pnlBrut:de,totalFees:W,pnlNet:K,accountPercentage:ue,movePoints:ye,moveTicks:Fe,isExitPriceOutOfTick:ee}},[t.entryDate,t.entryTime,t.exitDate,t.exitTime,t.entryPrice,t.exitPrice,t.quantity,t.tickSize,t.tickValue,t.market,t.side,t.fees,l?.equity]),{duration:T,pnlBrut:D,totalFees:F,pnlNet:$,accountPercentage:U,movePoints:B,moveTicks:O,isExitPriceOutOfTick:z}=M,q=E=>new Intl.NumberFormat(u==="fr"?"fr-FR":"en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(E);return t.status!=="closed"?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center",children:[e.jsx(ze,{size:48,style:{color:d.colors.textMuted},className:"mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:d.colors.text},children:u==="fr"?"Trade en cours":"Trade in progress"}),e.jsx("p",{className:"text-sm",style:{color:d.colors.textMuted},children:u==="fr"?"Cette Ã©tape n'est disponible que pour les trades fermÃ©s.":"This step is only available for closed trades."})]}):e.jsxs("div",{className:"h-full flex flex-col animate-fadeIn",children:[e.jsx(Mi,{show:!!M.isExitPriceOutOfTick,currentTheme:d,currentLanguage:u}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-2 gap-10",children:[e.jsxs("div",{className:"flex flex-col space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:d.colors.textSecondary},children:[u==="fr"?"Date de sortie":"Exit Date"," *"]}),e.jsx("div",{className:"relative",children:e.jsx(gs,{id:"exit-date-input",name:"exitDate",value:t.exitDate||"",onChange:E=>s("exitDate",E),placeholder:u==="fr"?"jj/mm/aaaa":"mm/dd/yyyy",title:u==="fr"?"Alt+D pour focus, T pour aujourd'hui":"Alt+D for focus, T for today",className:"w-full",size:"compact"})}),r.exitDate&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:d.colors.danger},children:r.exitDate})]}),e.jsx(Yo,{currentTheme:d,currentLanguage:u,errors:r,hours:y,minutes:N,seconds:w,active:h,setActive:b,updateTime:S})]})}),m==="detailed"?e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:d.colors.textSecondary},children:[u==="fr"?"Prix de sortie":"Exit Price"," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:f.exitPrice,onChange:E=>k("exitPrice",E.target.value),onBlur:()=>P(),onKeyDown:R,placeholder:"Ex: 4250.50",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:d.colors.surface,borderColor:r.exitPrice?d.colors.danger:d.colors.border,color:d.colors.text},name:"exitPrice"}),e.jsx(Ge,{size:16,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:d.colors.textMuted}})]}),r.exitPrice&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:d.colors.danger},children:r.exitPrice})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"block text-sm font-semibold",style:{color:d.colors.textSecondary},children:["P&L"," *"]}),e.jsx(Ll,{mode:p,onModeChange:x})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:p==="percentage"?t.pnlPercentage?.toString()||"":t.pnl?.toString()||"",onChange:E=>{const I=parseFloat(E.target.value)||0;s(p==="percentage"?"pnlPercentage":"pnl",I)},placeholder:p==="percentage"?"Ex: 2.5":"Ex: 250",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:d.colors.surface,borderColor:r.pnl?d.colors.danger:d.colors.border,color:d.colors.text},name:p==="percentage"?"pnlPercentage":"pnl"}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:p==="percentage"?e.jsx(is,{size:16,style:{color:d.colors.textMuted}}):e.jsx(sr,{size:16,style:{color:d.colors.textMuted}})})]}),e.jsx("p",{className:"text-xs",style:{color:d.colors.textMuted},children:u==="fr"?"Prix d'entrÃ©e et sortie optionnels - calculÃ©s automatiquement si possible":"Entry and exit prices optional - calculated automatically if possible"})]}),a&&(a("commission")||a("spread_slippage")||a("swap_overnight")||a("other"))&&e.jsx(Ri,{currentTheme:d,currentLanguage:u,errors:r,values:{commission:t.fees?.commission,spread_slippage:t.fees?.spread_slippage,swap_overnight:t.fees?.swap_overnight,other:t.fees?.other},onChange:(E,I)=>k(E,I),isEditMode:n,fieldConfig:o,shouldShowField:a,toggleFieldVisibility:i,isObligatoryField:c})]}),e.jsx("div",{className:"flex flex-col space-y-6",children:e.jsx(Al,{currentTheme:d,currentLanguage:u,pnlBrut:D,totalFees:F,pnlNet:$,accountPercentage:U,formatCurrency:q})})]})]})},Di=["Cassure","Rebond","Divergence","Support/RÃ©sistance","Tendance","Range","Momentum","Retournement","Double Top","Double Bottom","Triple Top","Triple Bottom","Head & Shoulders","Inverse H&S","Bull Flag","Bear Flag","Triangle Ascendant","Triangle Descendant","Triangle SymÃ©trique","Wedge","Faux Breakout","Pullback"],Fi=["Breakout Trading","Scalping","Momentum","Reversal Trading","Range Trading","Trend Following","Support/Resistance","Mean Reversion","Gap Trading","News Trading","Order Flow","Pullback Trading"];function Ei(t,s){const r=[...Di];return s.forEach(l=>{r.includes(l)||r.push(l)}),t?r.filter(l=>l.toLowerCase().includes(t.toLowerCase())):r}function Ai(t,s=5){const r=[],l=new Set;for(const n of t)!l.has(n)&&r.length<s&&(l.add(n),r.push(n));return r}function Li(t,s){const r=[...Fi];return s.forEach(l=>{r.includes(l)||r.push(l)}),t?r.filter(l=>l.toLowerCase().includes(t.toLowerCase())):r}const Po=({currentTheme:t,currentLanguage:s,value:r,onChange:l,isEditMode:n=!1,fieldConfig:o,toggleFieldVisibility:a,isObligatoryField:i,hideLabel:c})=>{const d=[{key:"tp",label:"TP",color:"success"},{key:"be",label:"BE",color:"warning"},{key:"sl",label:"SL",color:"danger"}];return e.jsxs("div",{children:[(!c||n)&&e.jsxs("div",{className:`flex items-center justify-between ${c?"mb-1":"mb-3"}`,children:[!c&&e.jsx("label",{className:"block text-sm font-semibold",style:{color:t.colors.textSecondary},children:s==="fr"?"RÃ©sultat du trade":"Trade Result"}),n&&!i?.("tradeResult")&&e.jsx("button",{type:"button",onClick:()=>a&&a("tradeResult"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("tradeResult")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("tradeResult")?t.colors.warning:t.colors.textMuted},children:o?.hiddenFields?.includes("tradeResult")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),n&&i?.("tradeResult")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"})]}),e.jsx("div",{className:"flex items-center space-x-4",children:d.map(u=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-1 rounded transition-all duration-200 hover:bg-opacity-10",onClick:()=>l(r===u.key?"":u.key),style:{backgroundColor:r===u.key?`${t.colors[u.color]}10`:"transparent"},children:[e.jsx("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all duration-200 hover:scale-110",style:{backgroundColor:r===u.key?t.colors[u.color]:t.colors.surface,borderColor:r===u.key?t.colors[u.color]:t.colors.border},children:r===u.key&&e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.colors.surface}})}),e.jsx("span",{className:"text-sm font-medium",style:{color:t.colors.text},children:u.label})]},u.key))})]})},$l=({currentTheme:t,currentLanguage:s,value:r,onChange:l,isEditMode:n=!1,fieldConfig:o,toggleFieldVisibility:a,isObligatoryField:i,hideLabel:c})=>e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center justify-between ${c?"mb-1":"mb-3"}`,children:[!c&&e.jsx("label",{className:"block text-sm font-semibold",style:{color:t.colors.textSecondary},children:s==="fr"?"Ratio R:R":"R:R Ratio"}),n&&!i?.("riskReward")&&e.jsx("button",{type:"button",onClick:()=>a&&a("riskReward"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("riskReward")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("riskReward")?t.colors.warning:t.colors.textMuted},children:o?.hiddenFields?.includes("riskReward")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),n&&i?.("riskReward")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:r?.toString()||"",onChange:d=>l(d.target.value),placeholder:"Ex: 2.5",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}}),e.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-sm font-medium",style:{color:t.colors.textMuted},children:":1"})]}),e.jsx("p",{className:"text-xs mt-1",style:{color:t.colors.textMuted},children:s==="fr"?"CalculÃ© automatiquement si SL et TP sont renseignÃ©s dans les Ã©tapes prÃ©cÃ©dentes":"Auto-calculated if SL and TP are filled in previous steps"})]}),Mo=({currentTheme:t,currentLanguage:s,value:r,onChange:l,isEditMode:n=!1,fieldConfig:o,toggleFieldVisibility:a,isObligatoryField:i,hideLabel:c})=>{const d=[{value:"bullish",label:s==="fr"?"Haussier":"Bullish",icon:Ae,color:"success"},{value:"bearish",label:s==="fr"?"Baissier":"Bearish",icon:$t,color:"danger"},{value:"range",label:"Range",icon:gl,color:"warning"}];return e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center justify-between ${c?"mb-1":"mb-3"}`,children:[!c&&e.jsx("label",{className:"block text-sm font-semibold",style:{color:t.colors.textSecondary},children:s==="fr"?"Tendance":"Trend"}),n&&!i?.("trend")&&e.jsx("button",{type:"button",onClick:()=>a&&a("trend"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("trend")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("trend")?t.colors.warning:t.colors.textMuted},children:o?.hiddenFields?.includes("trend")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),n&&i?.("trend")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:d.map(u=>{const m=u.icon,p=r===u.value;return e.jsxs("button",{type:"button",onClick:()=>l(u.value),className:`w-full p-2 rounded-lg border-2 transition-all duration-200 flex flex-col items-center space-y-1 ${p?"ring-2":""}`,style:{backgroundColor:p?`${t.colors[u.color]}20`:t.colors.surface,borderColor:p?t.colors[u.color]:t.colors.border,color:p?t.colors[u.color]:t.colors.text,boxShadow:p?`0 0 0 2px ${t.colors[u.color]}`:"none"},children:[e.jsx(m,{size:16}),e.jsx("span",{className:"text-xs font-medium",children:u.label})]},u.value)})})]})},Ro=({currentTheme:t,currentLanguage:s,value:r,onChange:l,onSelect:n,filteredStrategies:o,previousStrategies:a,favoriteNames:i,error:c,showDropdown:d,setShowDropdown:u,onOpenModal:m,isEditMode:p=!1,fieldConfig:x,toggleFieldVisibility:f,isObligatoryField:v,hideLabel:h})=>e.jsxs("div",{children:[(!h||p)&&e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[!h&&e.jsx("label",{className:"block text-sm font-semibold",style:{color:t.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{size:16,className:"mr-2"}),s==="fr"?"StratÃ©gie":"Strategy"]})}),p&&!v?.("strategy")&&e.jsx("button",{type:"button",onClick:()=>f&&f("strategy"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:x?.hiddenFields?.includes("strategy")?"Afficher":"Masquer",style:{color:x?.hiddenFields?.includes("strategy")?t.colors.warning:t.colors.textMuted},children:x?.hiddenFields?.includes("strategy")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),p&&v?.("strategy")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",value:r||"",onChange:b=>{l(b.target.value),d||u(!0)},onFocus:()=>u(!0),placeholder:"Ex: Scalping, Momentum...",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors shadow-sm",style:{backgroundColor:t.colors.surface,borderColor:c?t.colors.danger:t.colors.border,color:t.colors.text}}),d&&e.jsx("div",{className:"absolute z-10 mt-1 left-0 right-0 rounded-lg shadow-lg overflow-hidden",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,border:`1px solid ${t.colors.border}`,maxHeight:"150px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsxs("div",{className:"grid grid-cols-1 gap-0.5",children:[o.slice(0,8).map(b=>e.jsx("button",{type:"button",onClick:()=>n(b),className:"px-2 py-1 text-xs rounded-lg text-left transition-colors",style:{backgroundColor:r===b?t.colors.accent+"30":t.colors.surface,color:r===b?t.colors.accent:t.colors.text,border:`1px solid ${r===b?t.colors.accent:"transparent"}`},children:b},b)),o.length>8&&e.jsx("button",{type:"button",onClick:m,className:"px-2 py-1 text-xs text-center italic",style:{color:t.colors.textMuted},children:s==="fr"?`+ ${o.length-8} autres...`:`+ ${o.length-8} more...`})]})})})]}),e.jsx("button",{type:"button",onClick:m,className:"px-3 py-2 border rounded-lg transition-all duration-200 hover:shadow-sm flex items-center",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text},title:s==="fr"?"Choisir une stratÃ©gie":"Choose a strategy",children:e.jsx(qr,{size:16})})]}),a.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-2",style:{color:t.colors.textMuted},children:s==="fr"?"RÃ©centes":"Recent"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.slice(0,5).map(b=>e.jsx("button",{onClick:()=>n(b),className:"px-3 py-1 text-xs rounded-lg border transition-all duration-200 hover:shadow-sm",style:{backgroundColor:r===b?t.colors.accent:t.colors.surface,borderColor:t.colors.border,color:r===b?"#ffffff":t.colors.text},children:b},b))})]}),i.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs mb-2",style:{color:t.colors.textMuted},children:s==="fr"?"Favoris":"Favorites"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(b=>e.jsx("button",{onClick:()=>n(b),className:"px-3 py-1 text-xs rounded-lg border transition-all duration-200 hover:shadow-sm",style:{backgroundColor:r===b?t.colors.accent:t.colors.surface,borderColor:t.colors.border,color:r===b?"#ffffff":t.colors.text},children:b},b))})]}),c&&e.jsx("p",{className:"text-xs mt-1",style:{color:t.colors.danger},children:c})]})]}),To=({currentTheme:t,currentLanguage:s,value:r,onChange:l,search:n,setSearch:o,filteredSetups:a,quickSetups:i,error:c,showDropdown:d,setShowDropdown:u,isEditMode:m=!1,fieldConfig:p,toggleFieldVisibility:x,isObligatoryField:f,hideLabel:v})=>e.jsxs("div",{children:[(!v||m)&&e.jsxs("div",{className:`flex items-center justify-between ${v?"mb-1":"mb-3"}`,children:[!v&&e.jsx("label",{className:"block text-sm font-semibold",style:{color:t.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{size:16,className:"mr-2"}),"Setup"]})}),m&&!f?.("setup")&&e.jsx("button",{type:"button",onClick:()=>x&&x("setup"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:p?.hiddenFields?.includes("setup")?"Afficher":"Masquer",style:{color:p?.hiddenFields?.includes("setup")?t.colors.warning:t.colors.textMuted},children:p?.hiddenFields?.includes("setup")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),m&&f?.("setup")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>u(!d),className:"w-full flex items-center justify-between px-3 py-2 border rounded-md focus:outline-none transition-colors",style:{backgroundColor:t.colors.surface,borderColor:c?t.colors.danger:t.colors.border,color:r?t.colors.text:t.colors.textMuted,boxShadow:"none"},children:[e.jsx("span",{children:r||(s==="fr"?"SÃ©lectionner un setup...":"Select a setup...")}),e.jsx($e,{size:16,className:`transition-transform ${d?"rotate-180":""}`})]}),d&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md shadow-lg overflow-hidden",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,border:`1px solid ${t.colors.border}`},children:e.jsx("div",{className:"max-h-60 overflow-y-auto",children:e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("input",{type:"text",value:n,onChange:h=>{o(h.target.value),l(h.target.value)},placeholder:s==="fr"?"Rechercher ou saisir...":"Search or type...",className:"w-full px-3 py-2 pl-9 border rounded-md",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}}),e.jsx(vt,{size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2",style:{color:t.colors.textMuted}})]}),e.jsx("div",{className:"grid grid-cols-1 gap-1",children:a.map(h=>e.jsx("button",{type:"button",onClick:()=>{l(h),u(!1)},className:"px-3 py-2 text-sm rounded text-left transition-colors",style:{backgroundColor:r===h?t.colors.accent+"30":t.colors.surface,color:r===h?t.colors.accent:t.colors.text,border:`1px solid ${r===h?t.colors.accent:"transparent"}`},children:h},h))})]})})}),c&&e.jsx("p",{className:"text-xs mt-1",style:{color:t.colors.danger},children:c})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:i.slice(0,5).map(h=>e.jsx("button",{type:"button",onClick:()=>l(h),className:"px-2 py-1 text-xs rounded-lg transition-colors",style:{backgroundColor:r===h?t.colors.accent:t.colors.surface,color:r===h?"#ffffff":t.colors.text,border:`1px solid ${r===h?t.colors.accent:t.colors.border}`},children:h},h))})]}),$i=({currentTheme:t,currentLanguage:s,value:r,error:l,newTag:n,setNewTag:o,onAdd:a,onRemove:i,showDropdown:c,setShowDropdown:d,previousTags:u,existingTrades:m,onSelectFromDropdown:p,onKeyDown:x,onCleanupUnusedTags:f,onOpenManagementModal:v,isEditMode:h=!1,fieldConfig:b,toggleFieldVisibility:j,isObligatoryField:y})=>{const[N,w]=g.useState(""),S=g.useMemo(()=>N.trim()?u.filter(R=>R.toLowerCase().includes(N.toLowerCase())):u,[u,N]),k=g.useMemo(()=>{const R=new Set;return m.forEach(M=>{M.tags&&Array.isArray(M.tags)&&M.tags.forEach(T=>R.add(T))}),u.filter(M=>!R.has(M))},[u,m]),C=R=>{p(R),w("")},P=R=>{const M=R.target.value;w(M),o(M),M.trim()&&d(!0)};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-semibold",style:{color:t.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ds,{size:16,className:"mr-2"}),"Tags"]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[h&&!y?.("tags")&&e.jsx("button",{type:"button",onClick:()=>j&&j("tags"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:b?.hiddenFields?.includes("tags")?"Afficher":"Masquer",style:{color:b?.hiddenFields?.includes("tags")?t.colors.warning:t.colors.textMuted},children:b?.hiddenFields?.includes("tags")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),h&&y?.("tags")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"}),v&&e.jsxs("button",{type:"button",onClick:v,className:"px-3 py-1.5 rounded-md flex items-center space-x-2 text-sm transition-colors hover:opacity-80",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,border:`1px solid ${t.colors.border}`,color:t.colors.text},title:s==="fr"?"GÃ©rer les tags":"Manage tags",children:[e.jsx(ms,{size:14}),e.jsx("span",{children:s==="fr"?"GÃ©rer":"Manage"})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:r.map(R=>e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 rounded-full",style:{backgroundColor:t.colors.accent+"20",borderColor:t.colors.accent,border:`1px solid ${t.colors.accent}40`},children:[e.jsx("span",{className:"text-sm",style:{color:t.colors.text},children:R}),e.jsx("button",{type:"button",onClick:()=>i(R),className:"rounded-full p-0.5 hover:bg-opacity-80 transition-colors",style:{backgroundColor:t.colors.accent+"30"},children:e.jsx(Ne,{size:12,style:{color:t.colors.text}})})]},R))}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(vt,{size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2",style:{color:t.colors.textMuted}}),e.jsx("input",{type:"text",value:n,onChange:P,onKeyDown:x,placeholder:s==="fr"?"Rechercher ou ajouter un tag...":"Search or add a tag...",className:"w-full pl-10 pr-3 py-2 border rounded-l-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:t.colors.surface,borderColor:l?t.colors.danger:t.colors.border,color:t.colors.text}})]}),e.jsx("button",{type:"button",onClick:()=>d(!c),className:"px-3 py-2 border-t border-r border-b rounded-r-md",style:{backgroundColor:t.colors.surface,borderColor:l?t.colors.danger:t.colors.border,color:t.colors.text},children:e.jsx($e,{size:16,className:`transition-transform ${c?"rotate-180":""}`})})]}),c&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md shadow-lg overflow-hidden",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,border:`1px solid ${t.colors.border}`},children:e.jsx("div",{className:"max-h-60 overflow-y-auto",children:e.jsx("div",{className:"p-2",children:N.trim()?e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold mb-2 px-2 py-1 rounded",style:{backgroundColor:t.colors.surface,color:t.colors.textMuted},children:s==="fr"?"RÃ©sultats de recherche":"Search results"}),e.jsx("div",{className:"grid grid-cols-1 gap-1",children:S.length>0?S.map(R=>{const M=m.reduce((T,D)=>T+(D.tags?.filter(F=>F===R).length||0),0);return e.jsxs("button",{type:"button",onClick:()=>C(R),className:"px-3 py-2 text-sm rounded text-left transition-colors flex items-center justify-between",style:{backgroundColor:r.includes(R)?t.colors.accent+"30":t.colors.surface,color:r.includes(R)?t.colors.accent:t.colors.text,border:`1px solid ${r.includes(R)?t.colors.accent:"transparent"}`},children:[e.jsx("span",{children:R}),M>0&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent},children:M})]},R)}):e.jsx("div",{className:"px-3 py-2 text-sm text-center",style:{color:t.colors.textMuted},children:s==="fr"?"Aucun tag trouvÃ©":"No tags found"})})]}):e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold mb-2 px-2 py-1 rounded",style:{backgroundColor:t.colors.surface,color:t.colors.textMuted},children:s==="fr"?"Tags existants":"Existing tags"}),e.jsx("div",{className:"grid grid-cols-1 gap-1",children:u.map(R=>{const M=m.reduce((T,D)=>T+(D.tags?.filter(F=>F===R).length||0),0);return e.jsxs("button",{type:"button",onClick:()=>C(R),className:"px-3 py-2 text-sm rounded text-left transition-colors flex items-center justify-between",style:{backgroundColor:r.includes(R)?t.colors.accent+"30":t.colors.surface,color:r.includes(R)?t.colors.accent:t.colors.text,border:`1px solid ${r.includes(R)?t.colors.accent:"transparent"}`},children:[e.jsx("span",{children:R}),M>0&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent},children:M})]},R)})})]})})})})]}),e.jsx("button",{type:"button",onClick:a,className:"px-3 py-2 rounded-md transition-colors",style:{backgroundColor:t.colors.accent,color:"#ffffff"},children:"+"})]}),k.length>0&&f&&e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-md",style:{backgroundColor:t.colors.surface+"50",border:`1px solid ${t.colors.border}`},children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Qt,{size:14,style:{color:t.colors.textMuted}}),e.jsx("span",{className:"text-sm",style:{color:t.colors.textMuted},children:s==="fr"?`${k.length} tag(s) non utilisÃ©(s)`:`${k.length} unused tag(s)`})]}),e.jsx("button",{type:"button",onClick:f,className:"px-2 py-1 text-xs rounded transition-colors hover:opacity-80",style:{backgroundColor:t.colors.danger+"20",color:t.colors.danger},children:s==="fr"?"Nettoyer":"Clean up"})]})]})]})},zi=({isOpen:t,onClose:s,currentTheme:r,currentLanguage:l,allTags:n,existingTrades:o,onDeleteTag:a,onRenameTag:i,onCleanupUnusedTags:c})=>{const[d,u]=g.useState(""),[m,p]=g.useState(null),[x,f]=g.useState(""),v=g.useMemo(()=>{const k=new Map;return n.forEach(C=>{let P=0,R=null;o.forEach(M=>{if(M.tags&&M.tags.includes(C)){P++;const T=new Date(M.date||M.entryDate);(!R||T>R)&&(R=T)}}),k.set(C,{count:P,lastUsed:R})}),k},[n,o]),h=g.useMemo(()=>d.trim()?n.filter(k=>k.toLowerCase().includes(d.toLowerCase())):n,[n,d]),b=g.useMemo(()=>[...h].sort((k,C)=>{const P=v.get(k)||{count:0};return(v.get(C)||{count:0}).count-P.count}),[h,v]),j=g.useMemo(()=>n.filter(k=>{const C=v.get(k);return!C||C.count===0}),[n,v]),y=k=>{p(k),f(k)},N=()=>{m&&x.trim()&&x!==m&&i(m,x.trim()),p(null),f("")},w=()=>{p(null),f("")},S=k=>{if(!k)return l==="fr"?"Jamais":"Never";const P=Math.floor((new Date().getTime()-k.getTime())/(1e3*60*60*24));return P===0?l==="fr"?"Aujourd'hui":"Today":P===1?l==="fr"?"Hier":"Yesterday":P<7?l==="fr"?`Il y a ${P} jours`:`${P} days ago`:P<30?l==="fr"?`Il y a ${Math.floor(P/7)} semaines`:`${Math.floor(P/7)} weeks ago`:l==="fr"?`Il y a ${Math.floor(P/30)} mois`:`${Math.floor(P/30)} months ago`};return t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},children:e.jsxs("div",{className:"w-full max-w-3xl max-h-[90vh] rounded-lg shadow-2xl flex flex-col",style:{backgroundColor:r.colors.card},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",style:{borderColor:r.colors.border},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ds,{size:24,style:{color:r.colors.accent}}),e.jsx("h2",{className:"text-2xl font-bold",style:{color:r.colors.text},children:l==="fr"?"Gestion des Tags":"Tags Management"})]}),e.jsx("button",{onClick:s,className:"p-2 rounded-full hover:bg-opacity-10 transition-colors",style:{backgroundColor:r.colors.textMuted+"10"},children:e.jsx(Ne,{size:24,style:{color:r.colors.textMuted}})})]}),e.jsxs("div",{className:"p-6 border-b grid grid-cols-3 gap-4",style:{borderColor:r.colors.border},children:[e.jsxs("div",{className:"text-center p-4 rounded-lg",style:{backgroundColor:r.colors.surface},children:[e.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:r.colors.accent},children:n.length}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"Tags totaux":"Total tags"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg",style:{backgroundColor:r.colors.surface},children:[e.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:r.colors.success},children:n.length-j.length}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"Tags utilisÃ©s":"Used tags"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg",style:{backgroundColor:r.colors.surface},children:[e.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:r.colors.danger},children:j.length}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"Tags inutilisÃ©s":"Unused tags"})]})]}),e.jsxs("div",{className:"p-6 border-b space-y-4",style:{borderColor:r.colors.border},children:[e.jsxs("div",{className:"relative",children:[e.jsx(vt,{size:18,className:"absolute left-3 top-1/2 transform -translate-y-1/2",style:{color:r.colors.textMuted}}),e.jsx("input",{type:"text",value:d,onChange:k=>u(k.target.value),placeholder:l==="fr"?"Rechercher un tag...":"Search for a tag...",className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:r.colors.surface,borderColor:r.colors.border,color:r.colors.text}})]}),j.length>0&&e.jsxs("button",{onClick:c,className:"w-full px-4 py-2 rounded-lg flex items-center justify-center space-x-2 transition-colors hover:opacity-80",style:{backgroundColor:r.colors.danger+"20",color:r.colors.danger},children:[e.jsx(Qt,{size:16}),e.jsx("span",{children:l==="fr"?`Nettoyer ${j.length} tag(s) inutilisÃ©(s)`:`Clean up ${j.length} unused tag(s)`})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:b.length===0?e.jsxs("div",{className:"text-center py-12",style:{color:r.colors.textMuted},children:[e.jsx(ds,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:l==="fr"?"Aucun tag trouvÃ©":"No tags found"})]}):e.jsx("div",{className:"space-y-2",children:b.map(k=>{const C=v.get(k)||{count:0,lastUsed:null},P=m===k;return e.jsx("div",{className:"p-4 rounded-lg border transition-colors",style:{backgroundColor:C.count===0?r.colors.danger+"10":r.colors.surface,borderColor:C.count===0?r.colors.danger+"40":r.colors.border},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:P?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:x,onChange:R=>f(R.target.value),onKeyDown:R=>{R.key==="Enter"&&N(),R.key==="Escape"&&w()},className:"px-3 py-1 border rounded focus:outline-none focus:ring-2",style:{backgroundColor:r.colors.card,borderColor:r.colors.border,color:r.colors.text},autoFocus:!0}),e.jsx("button",{onClick:N,className:"px-3 py-1 rounded text-sm transition-colors",style:{backgroundColor:r.colors.success,color:"#ffffff"},children:l==="fr"?"Sauver":"Save"}),e.jsx("button",{onClick:w,className:"px-3 py-1 rounded text-sm transition-colors",style:{backgroundColor:r.colors.textMuted+"20",color:r.colors.textMuted},children:l==="fr"?"Annuler":"Cancel"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-lg font-semibold",style:{color:r.colors.text},children:k}),e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium",style:{backgroundColor:C.count>0?r.colors.accent+"20":r.colors.danger+"20",color:C.count>0?r.colors.accent:r.colors.danger},children:C.count===0?l==="fr"?"InutilisÃ©":"Unused":`${C.count} trade(s)`})]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm",style:{color:r.colors.textMuted},children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ae,{size:14}),e.jsxs("span",{children:[C.count," ",l==="fr"?"utilisations":"uses"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(yt,{size:14}),e.jsx("span",{children:S(C.lastUsed)})]})]})]})}),!P&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>y(k),className:"p-2 rounded hover:bg-opacity-10 transition-colors",style:{backgroundColor:r.colors.accent+"10"},title:l==="fr"?"Renommer":"Rename",children:e.jsx(yl,{size:16,style:{color:r.colors.accent}})}),e.jsx("button",{onClick:()=>a(k),className:"p-2 rounded hover:bg-opacity-10 transition-colors",style:{backgroundColor:r.colors.danger+"10"},title:l==="fr"?"Supprimer":"Delete",children:e.jsx(Qt,{size:16,style:{color:r.colors.danger}})})]})]})},k)})})}),e.jsx("div",{className:"p-6 border-t flex justify-end",style:{borderColor:r.colors.border},children:e.jsx("button",{onClick:s,className:"px-6 py-2 rounded-lg transition-colors",style:{backgroundColor:r.colors.accent,color:"#ffffff"},children:l==="fr"?"Fermer":"Close"})})]})}):null},Ii=({formData:t,onChange:s,errors:r,settings:l,existingTrades:n=[],onOpenStrategyModal:o,isEditMode:a=!1,fieldConfig:i,shouldShowField:c,toggleFieldVisibility:d,isObligatoryField:u})=>{const{currentTheme:m}=Q(),{currentLanguage:p}=Z(),{getFavoritePresets:x}=Go(),[f,v]=g.useState(!1),[h,b]=g.useState(""),[j,y]=g.useState(["Retest","Confluence","Squeeze","Expansion","Consolidation"]),N=g.useRef(null),[w,S]=g.useState(!1),[k,C]=g.useState(""),[P,R]=g.useState(["Swing Trading","Position Trading","Arbitrage","Hedging","Grid Trading"]),M=g.useRef(null),[T,D]=g.useState(""),[F,$]=g.useState(!1),[U,B]=g.useState([]),[O,z]=g.useState(!1),q=g.useRef(null),I=Ei(h,j),H=()=>Ai(j,5),A=Li(k,P),_=te=>{s("strategy",te);const W=[te,...P.filter(K=>K!==te)].slice(0,5);R(W);try{localStorage.setItem("strategy-recent",JSON.stringify(W))}catch(K){console.error("Failed to save recent strategies to localStorage",K)}};g.useEffect(()=>{try{const te=localStorage.getItem("strategy-recent");if(te){const W=JSON.parse(te);Array.isArray(W)&&W.length>0&&R(W)}}catch(te){console.error("Failed to load recent strategies from localStorage",te)}},[]);const J=()=>{if(T.trim()&&!t.tags?.includes(T.trim())){const te=t.tags||[];if(s("tags",[...te,T.trim()]),D(""),!U.includes(T.trim())){const W=[T.trim(),...U].slice(0,10);B(W);try{localStorage.setItem("tags-recent",JSON.stringify(W))}catch(K){console.error("Failed to save recent tags to localStorage",K)}}}},re=te=>{const W=t.tags||[];s("tags",W.filter(K=>K!==te))},de=te=>{const W=t.tags||[];W.includes(te)||s("tags",[...W,te]),$(!1)},se=te=>{te.key==="Enter"&&(te.preventDefault(),J())},ke=()=>{const te=new Set;n.forEach(K=>{K.tags&&Array.isArray(K.tags)&&K.tags.forEach(ue=>te.add(ue))});const W=U.filter(K=>te.has(K));B(W);try{localStorage.setItem("tags-recent",JSON.stringify(W))}catch(K){console.error("Failed to save cleaned tags to localStorage",K)}},be=te=>{const W=U.filter(ue=>ue!==te);B(W);const K=t.tags||[];K.includes(te)&&s("tags",K.filter(ue=>ue!==te));try{localStorage.setItem("tags-recent",JSON.stringify(W))}catch(ue){console.error("Failed to save tags to localStorage",ue)}},he=(te,W)=>{if(te===W||!W.trim())return;const K=U.map(ye=>ye===te?W.trim():ye);B(K);const ue=t.tags||[];ue.includes(te)&&s("tags",ue.map(ye=>ye===te?W.trim():ye));try{localStorage.setItem("tags-recent",JSON.stringify(K))}catch(ye){console.error("Failed to save tags to localStorage",ye)}};return g.useEffect(()=>{const te=W=>{N.current&&!N.current.contains(W.target)&&v(!1),M.current&&!M.current.contains(W.target)&&S(!1),q.current&&!q.current.contains(W.target)&&$(!1)};return document.addEventListener("mousedown",te),()=>{document.removeEventListener("mousedown",te)}},[]),g.useEffect(()=>{const te=new Set;n.length>0&&n.forEach(K=>{K.tags&&Array.isArray(K.tags)&&K.tags.forEach(ue=>te.add(ue))});try{const K=localStorage.getItem("tags-recent");if(K){const ue=JSON.parse(K);Array.isArray(ue)&&ue.length>0&&ue.forEach(ye=>te.add(ye))}}catch(K){console.error("Failed to load recent tags from localStorage",K)}const W=Array.from(te);if(n.length>0){const K=W.reduce((ue,ye)=>{const Fe=n.reduce((ee,oe)=>ee+(oe.tags?.filter(ve=>ve===ye).length||0),0);return ue[ye]=Fe,ue},{});W.sort((ue,ye)=>K[ye]-K[ue])}B(W)},[n]),g.useEffect(()=>{if(t.entryPrice&&t.exitPrice){const te=Number(t.entryPrice),W=Number(t.exitPrice);if(te&&W){const ue=Math.abs(W-te)/te;t.riskReward!==ue&&s("riskReward",ue.toFixed(2))}}},[t.entryPrice,t.exitPrice,t.riskReward,s]),e.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-2 gap-10",children:[e.jsxs("div",{className:"flex flex-col space-y-6",children:[c&&c("tradeResult")&&e.jsx(Po,{currentTheme:m,currentLanguage:p,value:t.tradeResult,onChange:te=>s("tradeResult",te),isEditMode:a,fieldConfig:i,toggleFieldVisibility:d,isObligatoryField:u}),c&&c("riskReward")&&e.jsx($l,{currentTheme:m,currentLanguage:p,value:t.riskReward,onChange:te=>s("riskReward",te),isEditMode:a,fieldConfig:i,toggleFieldVisibility:d,isObligatoryField:u}),c&&c("trend")&&e.jsx(Mo,{currentTheme:m,currentLanguage:p,value:t.trend,onChange:te=>s("trend",te),isEditMode:a,fieldConfig:i,toggleFieldVisibility:d,isObligatoryField:u}),c&&c("strategy")&&e.jsx("div",{ref:M,children:e.jsx(Ro,{currentTheme:m,currentLanguage:p,value:t.strategy,onChange:te=>{s("strategy",te),C(te)},onSelect:te=>_(te),filteredStrategies:A,previousStrategies:P,favoriteNames:x().slice(0,5).map(te=>te.name),error:r.strategy,showDropdown:w,setShowDropdown:S,onOpenModal:o,isEditMode:a,fieldConfig:i,toggleFieldVisibility:d,isObligatoryField:u})})]}),e.jsxs("div",{className:"flex flex-col",children:[c&&c("setup")&&e.jsx("div",{ref:N,className:"mb-6",children:e.jsx(To,{currentTheme:m,currentLanguage:p,value:t.setup,onChange:te=>s("setup",te),search:h,setSearch:b,filteredSetups:I,quickSetups:H(),error:r.setup,showDropdown:f,setShowDropdown:v,isEditMode:a,fieldConfig:i,toggleFieldVisibility:d,isObligatoryField:u})}),c&&c("tags")&&e.jsx("div",{ref:q,className:"mt-20",children:e.jsx($i,{currentTheme:m,currentLanguage:p,value:t.tags||[],error:r.tags,newTag:T,setNewTag:D,onAdd:J,onRemove:re,showDropdown:F,setShowDropdown:$,previousTags:U,existingTrades:n,onSelectFromDropdown:de,onKeyDown:se,onCleanupUnusedTags:ke,onOpenManagementModal:()=>z(!0),isEditMode:a,fieldConfig:i,toggleFieldVisibility:d,isObligatoryField:u})})]}),e.jsx(zi,{isOpen:O,onClose:()=>z(!1),currentTheme:m,currentLanguage:p,allTags:U,existingTrades:n,onDeleteTag:be,onRenameTag:he,onCleanupUnusedTags:()=>{ke(),z(!1)}})]})},Oi=({screenshots:t,imageNames:s,currentImageIndex:r,setCurrentImageIndex:l,comparisonMode:n,setComparisonMode:o,selectedImages:a,toggleImageSelection:i,hideHUD:c,setHideHUD:d,getScreenshotUrl:u,goToPrevImage:m,goToNextImage:p,currentLanguage:x,currentTheme:f,setLightboxOpen:v,getComparisonLayout:h,handleComparisonDragStart:b,handleComparisonDragOver:j,handleComparisonDragLeave:y,handleComparisonDrop:N,draggedImageIndex:w,dragOverIndex:S})=>e.jsxs("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-95 flex items-center justify-center",children:[e.jsxs("div",{className:"absolute top-4 left-4 right-4 flex items-center justify-between z-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h3",{className:"text-white text-lg font-medium",children:s[r]||`Screenshot ${r+1}`}),e.jsxs("span",{className:"text-white/70 text-sm",children:[r+1," / ",t.length]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!n&&t.length>1&&e.jsx("button",{onClick:()=>{const k=[];for(let C=0;C<Math.min(4,t.length);C++)k.push((r+C)%t.length);a&&a.length,o(!0)},className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",title:x==="fr"?"Mode comparaison":"Comparison mode",children:e.jsx(_e,{size:20,className:"text-white"})}),n&&e.jsx("button",{onClick:()=>o(!1),className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",title:x==="fr"?"Vue simple":"Single view",children:e.jsx(Uo,{size:20,className:"text-white"})}),e.jsx("button",{onClick:()=>d(!c),className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",title:x==="fr"?c?"Afficher les contrÃ´les":"Masquer les contrÃ´les":c?"Show controls":"Hide controls",children:c?e.jsx(De,{size:20,className:"text-white"}):e.jsx(Se,{size:20,className:"text-white"})}),e.jsx("button",{onClick:()=>{v(!1),o(!1)},className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:e.jsx(Ne,{size:20,className:"text-white"})})]})]}),!n&&t.length>1&&e.jsx("button",{onClick:m,className:"absolute left-4 top-1/2 transform -translate-y-1/2 p-3 bg-white/20 hover:bg-white/30 rounded-full transition-colors z-10",children:e.jsx(il,{size:24,className:"text-white"})}),!n&&t.length>1&&e.jsx("button",{onClick:p,className:"absolute right-4 top-1/2 transform -translate-y-1/2 p-3 bg-white/20 hover:bg-white/30 rounded-full transition-colors z-10",children:e.jsx(dl,{size:24,className:"text-white"})}),e.jsx("div",{className:`w-full h-full flex flex-col ${c?"p-2":"p-6"}`,children:n&&a.length>=2?e.jsxs(e.Fragment,{children:[!c&&e.jsxs("div",{className:"text-white text-center mb-2 flex-shrink-0",children:[e.jsx("h3",{className:"text-base font-medium",children:x==="fr"?`Comparaison de ${a.length} images`:`Comparing ${a.length} images`}),e.jsx("p",{className:"text-xs opacity-60 mt-1",children:x==="fr"?"Glissez-dÃ©posez pour rÃ©organiser â€¢ Cliquez pour vue simple":"Drag & drop to reorder â€¢ Click for single view"})]}),e.jsx("div",{className:"flex-1 min-h-0 w-full max-w-none",children:(()=>{const k=h(a.length),C=(P,R="",M="")=>{const T=w===P,D=S===P;return e.jsxs("div",{className:`
                        flex flex-col min-h-0 ${R} 
                        ${T?"opacity-50 scale-95":""}
                        ${D?"ring-2 ring-blue-400 ring-opacity-70":""}
                        transition-all duration-200
                      `,draggable:!0,onDragStart:F=>b(F,P),onDragOver:F=>j(F,P),onDragLeave:y,onDrop:F=>N(F,P),children:[e.jsxs("div",{className:"text-white text-center mb-2 text-sm font-medium flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-xs opacity-60",children:"::"}),s[P]||`Screenshot ${P+1}`,e.jsx("span",{className:"text-xs opacity-60",children:"::"})]}),e.jsx("div",{className:`
                        flex-1 flex items-center justify-center min-h-0 bg-black/20 rounded-lg p-2 ${M}
                        ${D?"bg-blue-900/30":""}
                        transition-colors duration-200
                      `,children:e.jsx("img",{src:u(t[P]),alt:s[P]||`Screenshot ${P+1}`,className:"max-w-full max-h-full object-contain rounded shadow-xl cursor-move hover:scale-105 transition-transform duration-200",onClick:()=>{l(P),o(!1)}})})]},P)};return k.type==="three-asymmetric"?e.jsx("div",{className:"grid grid-cols-3 gap-3 h-full",children:a.map(P=>C(P,"","h-full"))}):k.type==="four-asymmetric"?e.jsx("div",{className:"grid grid-cols-2 gap-3 h-full",children:a.map(P=>C(P,"","h-full"))}):k.type==="five-asymmetric"?e.jsxs("div",{className:"w-full h-full flex flex-col gap-2",children:[e.jsxs("div",{className:"h-1/2 w-full flex gap-2",children:[e.jsx("div",{className:"flex-1",children:C(a[0],"","h-full")}),e.jsx("div",{className:"flex-1",children:C(a[1],"","h-full")}),e.jsx("div",{className:"flex-1",children:C(a[2],"","h-full")})]}),e.jsxs("div",{className:"h-1/2 w-full flex gap-2 px-72",children:[e.jsx("div",{className:"flex-1",children:C(a[3],"","h-full")}),e.jsx("div",{className:"flex-1",children:C(a[4],"","h-full")})]})]}):e.jsx("div",{className:`grid ${k.gridClass} gap-3 h-full`,children:a.map(P=>C(P,"","h-full"))})})()})]}):e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx("img",{src:u(t[r]),alt:s[r]||`Screenshot ${r+1}`,className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl"})})}),t.length>1&&!c&&e.jsx("div",{className:"absolute bottom-2 left-4 right-4 flex justify-center",children:e.jsxs("div",{className:"flex gap-1 p-1.5 bg-black/60 rounded-lg max-w-2xl overflow-x-auto",children:[n&&e.jsx("div",{className:"text-white text-xs px-1.5 py-0.5 bg-white/10 rounded mr-1 flex items-center",children:x==="fr"?`Clic +/- (${a.length}/6 max)`:`Click +/- (${a.length}/6 max)`}),t.map((k,C)=>{const P=n&&a.includes(C),R=C===r,M=!n||P||a.length<6;return e.jsxs("button",{onClick:()=>{if(n){if(!a.includes(C)&&a.length>=6)return;i(C)}else l(C)},className:`
                    relative flex-shrink-0 w-12 h-12 rounded overflow-hidden border-2 transition-all duration-200
                    ${n?P?"border-blue-500 ring-2 ring-blue-400 ring-opacity-50":M?"border-white/30 hover:border-blue-400":"border-red-400/50 opacity-50 cursor-not-allowed":R?"border-white":"border-white/30 hover:border-white/60"}
                    ${n&&M?"hover:scale-105":""}
                  `,title:n?P?x==="fr"?"Retirer de la comparaison":"Remove from comparison":M?x==="fr"?"Ajouter Ã  la comparaison":"Add to comparison":x==="fr"?"Limite de 6 images atteinte":"Limit of 6 images reached":s[C]||`Screenshot ${C+1}`,children:[e.jsx("img",{src:u(k),alt:`Screenshot ${C+1}`,className:"w-full h-full object-cover"}),n&&P&&e.jsx("div",{className:"absolute top-0.5 right-0.5 w-3 h-3 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(qt,{size:8,className:"text-white"})}),n&&P&&e.jsx("div",{className:"absolute bottom-0.5 left-0.5 w-3 h-3 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:a.indexOf(C)+1})]},C)})]})})]}),qi=({currentTheme:t,currentLanguage:s,screenshots:r,imageNames:l,selectedImages:n,isDragOver:o,isUploading:a,fileInputRef:i,handleFileInputChange:c,handleDropZoneClick:d,handleDragOver:u,handleDragLeave:m,handleDrop:p,getScreenshotUrl:x,openLightbox:f,toggleImageSelection:v,removeScreenshot:h,editingNameIndex:b,editingNameValue:j,setEditingNameIndex:y,setEditingNameValue:N,updateImageName:w,startEditing:S,isDraggingImage:k,galleryDraggedIndex:C,galleryDragOverIndex:P,handleImageMouseDown:R,handleImageDragStart:M,handleImageDragOver:T,handleImageDragLeave:D,handleImageDrop:F,handleImageDragEnd:$,enterComparisonMode:U,clearSelection:B})=>r.length===0?e.jsxs("div",{onClick:d,onDragOver:u,onDragLeave:m,onDrop:p,className:`
          border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-all duration-200
          ${o?"border-blue-400 bg-blue-50 dark:bg-blue-900/20":""}
          ${a?"opacity-50 pointer-events-none":""}
        `,style:{borderColor:o?t.colors.accent:t.colors.border,backgroundColor:o?`${t.colors.accent}10`:"transparent",minHeight:"200px"},children:[e.jsx("input",{ref:i,type:"file",accept:"image/*",multiple:!0,onChange:c,className:"hidden"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(wr,{size:48,className:"mx-auto",style:{color:t.colors.textMuted}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium mb-1",style:{color:t.colors.text},children:o?s==="fr"?"DÃ©posez vos images ici":"Drop your images here":s==="fr"?"Ajoutez vos screenshots":"Add your screenshots"}),e.jsx("p",{className:"text-sm",style:{color:t.colors.textMuted},children:s==="fr"?"Cliquez ou glissez-dÃ©posez des images":"Click or drag & drop images"})]}),e.jsx("p",{className:"text-xs",style:{color:t.colors.textMuted},children:s==="fr"?"PNG, JPG, WebP (max 5MB chacun)":"PNG, JPG, WebP (max 5MB each)"})]})]}):e.jsxs("div",{onDragOver:k?void 0:u,onDragLeave:k?void 0:m,onDrop:k?void 0:p,className:`
        relative rounded-lg transition-all duration-200
        ${o&&!k?"bg-blue-50 dark:bg-blue-900/20":""}
        ${a?"opacity-50 pointer-events-none":""}
      `,style:{backgroundColor:o&&!k?`${t.colors.accent}15`:"transparent"},children:[e.jsx("input",{ref:i,type:"file",accept:"image/*",multiple:!0,onChange:c,className:"hidden"}),o&&!k&&e.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center bg-black bg-opacity-50 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(wr,{size:32,className:"mx-auto mb-2 text-white"}),e.jsx("p",{className:"text-white font-medium",children:s==="fr"?"DÃ©posez pour ajouter":"Drop to add"})]})}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("p",{className:"text-sm font-medium",style:{color:t.colors.text},children:["Screenshots"," (",r.length,")"]}),r.length>1&&e.jsx("span",{className:"text-xs px-2 py-1 rounded-full transition-all duration-200",style:{backgroundColor:k?t.colors.accent+"20":t.colors.textMuted+"20",color:k?t.colors.accent:t.colors.textMuted},children:k?s==="fr"?"ðŸ”„ Mode rÃ©organisation":"ðŸ”„ Reorder mode":s==="fr"?"Clic long pour rÃ©organiser":"Long press to reorder"}),n.length>0&&e.jsxs("span",{className:"text-xs px-2 py-1 rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent},children:[n.length,"/6 ",s==="fr"?"sÃ©lectionnÃ©e(s)":"selected"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[n.length>=2&&e.jsxs("button",{onClick:U,className:"flex items-center gap-1 px-3 py-1.5 text-xs rounded-lg transition-all duration-200 hover:scale-105",style:{backgroundColor:t.colors.success,color:"#ffffff"},children:[e.jsx(_e,{size:14}),s==="fr"?"Comparer":"Compare"]}),n.length>0&&e.jsxs("button",{onClick:B,className:"flex items-center gap-1 px-3 py-1.5 text-xs rounded-lg transition-all duration-200 hover:scale-105",style:{backgroundColor:t.colors.textMuted,color:"#ffffff"},children:[e.jsx(Ne,{size:14}),s==="fr"?"Annuler":"Cancel"]}),e.jsxs("button",{onClick:d,className:"flex items-center gap-1 px-3 py-1.5 text-xs rounded-lg transition-all duration-200 hover:scale-105",style:{backgroundColor:t.colors.accent,color:"#ffffff"},children:[e.jsx(Je,{size:14}),s==="fr"?"Ajouter":"Add"]})]})]}),e.jsx("div",{className:"gap-3",style:{display:"grid",gridTemplateColumns:r.length===1?"1fr":r.length===2?"repeat(2, 1fr)":"repeat(auto-fit, minmax(180px, 1fr))"},children:r.map((O,z)=>{const q=n.includes(z),E=l[z]||`Screenshot ${z+1}`,I=C===z,H=P===z;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{draggable:!0,onMouseDown:()=>R(z),onDragStart:L=>M(L,z),onDragOver:L=>T(L,z),onDragLeave:D,onDrop:L=>F(L,z),onDragEnd:$,className:`
                  relative group rounded-lg overflow-hidden border cursor-pointer 
                  transition-all duration-300 ease-out
                  hover:scale-[1.02] hover:shadow-lg
                  ${r.length===1?"aspect-video":"aspect-square"}
                  ${q?"ring-2 ring-offset-2":""}
                  ${I?"opacity-50 scale-95":""}
                  ${H&&k?"ring-2 ring-blue-400 ring-opacity-70":""}
                `,style:{borderColor:q?t.colors.accent:t.colors.border,transform:"translateZ(0)",...q&&{boxShadow:`0 0 0 2px ${t.colors.accent}40, 0 0 0 4px ${t.colors.accent}`},...H&&k&&{backgroundColor:`${t.colors.accent}15`}},onClick:()=>{k||f(z)},children:[e.jsx("img",{src:x(O),alt:E,className:"w-full h-full object-cover transition-transform duration-300 ease-out"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300 ease-out flex items-center justify-center",children:e.jsx("div",{className:"transform translate-y-2 group-hover:translate-y-0 transition-transform duration-300 ease-out",children:e.jsx(Uo,{size:r.length===1?32:24,className:"text-white drop-shadow-lg"})})}),e.jsx("button",{onClick:L=>{L.stopPropagation(),v(z)},className:`
                    absolute top-2 left-2 w-6 h-6 rounded-full border-2 flex items-center justify-center
                    transition-all duration-300
                    ${q?"bg-blue-500 border-blue-500":"bg-black/50 border-white/50 hover:bg-black/70"}
                  `,children:q&&e.jsx(qt,{size:12,className:"text-white"})}),e.jsxs("div",{className:"absolute top-2 right-10 px-2 py-1 bg-black/50 text-white text-xs rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[z+1,"/",r.length]}),e.jsx("button",{onClick:L=>{L.stopPropagation(),h(z)},className:"absolute top-2 right-2 p-1.5 rounded-full bg-red-500/90 text-white opacity-0 group-hover:opacity-100 transition-all duration-300 hover:scale-110 hover:bg-red-600 shadow-lg",children:e.jsx(Ne,{size:12})})]}),e.jsx("div",{className:"px-1",children:b===z?e.jsx("input",{type:"text",value:j,onChange:L=>N(L.target.value),onBlur:()=>{w(z,j),y(null),N("")},onKeyDown:L=>{L.key==="Enter"&&(w(z,j),y(null),N("")),L.key==="Escape"&&(y(null),N(""))},className:"w-full text-xs px-2 py-1 rounded border",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text},autoFocus:!0}):e.jsx("button",{onClick:()=>{S?S(z,l[z]||`Screenshot ${z+1}`):y(z),N(l[z]||`Screenshot ${z+1}`)},className:"w-full text-left text-xs px-2 py-1 rounded hover:bg-opacity-50 transition-colors truncate",style:{color:t.colors.textMuted,backgroundColor:"transparent"},title:s==="fr"?"Cliquer pour renommer":"Click to rename",children:l[z]||`Screenshot ${z+1}`})})]},z)})})]}),Ui=({currentTheme:t,currentLanguage:s,marginTop:r="95px",intensity:l,emotion:n,planRespected:o,getEmotionDisplay:a,setIsEmotionModalOpen:i,handleEmotionClear:c,handleIntensityChange:d,handlePlanRespectedChange:u})=>e.jsx("div",{className:"border-t pt-3",style:{borderColor:t.colors.border+"40",marginTop:r},children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 mb-3 text-sm font-medium",style:{color:t.colors.text},children:[e.jsx(xl,{size:16}),s==="fr"?"Ã‰tat Ã©motionnel":"Emotional State"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>i(!0),className:"flex-1 p-3 rounded-lg border text-left font-medium transition-all duration-200 hover:scale-105 flex items-center justify-between",style:{borderColor:t.colors.border,backgroundColor:t.colors.surface,color:t.colors.text},children:[e.jsx("span",{className:"flex items-center gap-2",children:(()=>{const m=a();return m?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:m.emoji}),e.jsx("span",{children:m.label})]}):e.jsx("span",{style:{color:t.colors.textMuted},children:s==="fr"?"SÃ©lectionner un Ã©tat":"Select state"})})()}),e.jsx(Je,{size:16})]}),n&&e.jsx("button",{onClick:c,className:"p-3 rounded-lg border transition-all duration-200 hover:scale-105 flex items-center justify-center",style:{borderColor:t.colors.border,backgroundColor:t.colors.surface,color:t.colors.textMuted},title:s==="fr"?"Effacer":"Clear",children:e.jsx(Ne,{size:16})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 mb-3 text-sm font-medium",style:{color:t.colors.text},children:[e.jsx(ot,{size:16}),s==="fr"?"IntensitÃ© Ã©motionnelle":"Emotional Intensity"]}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(m=>e.jsx("button",{onClick:()=>d(m),className:`p-2 rounded-lg transition-all duration-200 ${l>=m?"text-yellow-500":"text-gray-300 hover:text-yellow-400"}`,style:{backgroundColor:l>=m?`${t.colors.warning}20`:"transparent"},children:e.jsx(ot,{size:20,fill:l>=m?"currentColor":"none"})},m))}),e.jsxs("p",{className:"text-xs mt-1",style:{color:t.colors.textMuted},children:[l===0&&(s==="fr"?"SÃ©lectionnez une intensitÃ©":"Select intensity"),l===1&&(s==="fr"?"TrÃ¨s calme":"Very calm"),l===2&&(s==="fr"?"Calme":"Calm"),l===3&&(s==="fr"?"ModÃ©rÃ©":"Moderate"),l===4&&"Intense",l===5&&(s==="fr"?"TrÃ¨s intense":"Very intense")]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 mb-3 text-sm font-medium",style:{color:t.colors.text},children:[e.jsx(Or,{size:16}),s==="fr"?"Ai-je respectÃ© mon plan ?":"Did I follow my plan?"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>u(!0),className:"flex-1 p-3 rounded-lg border-2 font-medium transition-all duration-200 hover:scale-105",style:{borderColor:o===!0?t.colors.success:t.colors.border,backgroundColor:o===!0?`${t.colors.success}20`:t.colors.surface,color:o===!0?t.colors.success:t.colors.text},children:["âœ… ",s==="fr"?"Oui":"Yes"]}),e.jsxs("button",{onClick:()=>u(!1),className:"flex-1 p-3 rounded-lg border-2 font-medium transition-all duration-200 hover:scale-105",style:{borderColor:o===!1?t.colors.danger:t.colors.border,backgroundColor:o===!1?`${t.colors.danger}20`:t.colors.surface,color:o===!1?t.colors.danger:t.colors.text},children:["âŒ ",s==="fr"?"Non":"No"]})]})]})]})}),Wi=({open:t,onClose:s,currentTheme:r,currentLanguage:l,emotionalStates:n,handleEmotionChange:o,handleRemoveCustomState:a,customEmotion:i,setCustomEmotion:c,customEmoji:d,setCustomEmoji:u,showCustomInput:m,setShowCustomInput:p,showEmojiMenu:x,setShowEmojiMenu:f,emojiMenuRef:v,handleEmojiSelect:h,handleCustomEmotionAdd:b,handleAddToPredefined:j})=>t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:s}),e.jsx("div",{className:"relative w-full max-w-md rounded-lg shadow-lg",style:{backgroundColor:r.colors.card,borderColor:r.colors.border},children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:r.colors.text},children:l==="fr"?"Ã‰tat Ã©motionnel":"Emotional State"}),e.jsx("button",{onClick:s,className:"p-1 rounded-lg hover:bg-opacity-10 transition-colors",style:{color:r.colors.textMuted},children:e.jsx(Ne,{size:20})})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("p",{className:"text-sm font-medium",style:{color:r.colors.text},children:l==="fr"?"Ã‰tats prÃ©dÃ©finis":"Predefined states"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:n.map(y=>{const N=y.value.startsWith("custom_");return e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:()=>o(y.value),className:"w-full p-3 rounded-lg border text-left font-medium transition-all duration-200 hover:scale-105 flex items-center gap-2",style:{borderColor:r.colors.border,backgroundColor:r.colors.surface,color:r.colors.text},children:[e.jsx("span",{children:y.emoji}),e.jsx("span",{className:"flex-1",children:y.label})]}),N&&e.jsx("button",{onClick:()=>a(y.value),className:"absolute -top-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:scale-110",style:{backgroundColor:r.colors.danger,color:r.colors.surface},title:l==="fr"?"Supprimer cet Ã©tat":"Remove this state",children:e.jsx(Ne,{size:12})})]},y.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",style:{color:r.colors.text},children:l==="fr"?"Ã‰tat personnalisÃ©":"Custom state"}),m?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:r.colors.text},children:"Emoji"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:d||"ðŸ¤”"}),e.jsx("span",{className:"text-sm",style:{color:r.colors.textMuted},children:d||(l==="fr"?"SÃ©lectionner un emoji":"Select emoji")})]}),e.jsxs("div",{className:"relative",ref:v,children:[e.jsx("button",{onClick:()=>f(!x),className:"p-2 rounded-lg border transition-all duration-200 hover:scale-105",style:{backgroundColor:r.colors.surface,borderColor:r.colors.border,color:r.colors.text},title:l==="fr"?"Choisir un emoji":"Choose emoji",children:e.jsx(Je,{size:16})}),x&&e.jsx("div",{className:"absolute top-10 right-0 z-50 p-3 rounded-lg shadow-lg border max-h-48 overflow-y-auto",style:{backgroundColor:r.colors.card,borderColor:r.colors.border,minWidth:"200px"},children:e.jsx("div",{className:"flex flex-wrap gap-2",children:["ðŸ˜„","ðŸ˜°","ðŸ˜«","ðŸ˜Œ","ðŸ˜´","ðŸ¤”","ðŸ˜Š","ðŸ˜¢","ðŸ˜¡","ðŸ˜±","ðŸ˜","ðŸ˜Ž","ðŸ¤—","ðŸ˜¤","ðŸ˜‡","ðŸ¥º","ðŸ¤¯","ðŸ˜µ","ðŸ¤¢","ðŸ¤®","ðŸ˜ˆ","ðŸ‘»","ðŸ¤–","ðŸ’€","ðŸ‘½"].map(y=>e.jsx("button",{onClick:()=>h(y),className:"w-8 h-8 flex items-center justify-center rounded-lg text-xl transition-all hover:scale-110",children:y},y))})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:r.colors.text},children:l==="fr"?"Nom de l'Ã©tat":"State name"}),e.jsx("input",{type:"text",value:i,onChange:y=>c(y.target.value),placeholder:l==="fr"?"Nom de votre Ã©tat...":"Name your state...",className:"w-full p-3 rounded-lg border",style:{borderColor:r.colors.border,backgroundColor:r.colors.surface,color:r.colors.text},onKeyPress:y=>y.key==="Enter"&&b()})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,disabled:!i.trim(),className:"flex-1 p-2 rounded-lg font-medium transition-all duration-200 disabled:opacity-50",style:{backgroundColor:r.colors.accent,color:r.colors.surface},children:l==="fr"?"Utiliser":"Use"}),e.jsxs("button",{onClick:j,disabled:!i.trim(),className:"p-2 rounded-lg border font-medium transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",style:{borderColor:r.colors.accent,backgroundColor:r.colors.accent+"10",color:r.colors.accent},title:l==="fr"?"Ajouter aux Ã©tats prÃ©dÃ©finis":"Add to predefined states",children:[e.jsx(Je,{size:14}),l==="fr"?"Sauvegarder":"Save"]}),e.jsx("button",{onClick:()=>{p(!1),c(""),u("")},className:"flex-1 p-2 rounded-lg border font-medium transition-all duration-200",style:{borderColor:r.colors.border,backgroundColor:r.colors.surface,color:r.colors.text},children:l==="fr"?"Annuler":"Cancel"})]})]}):e.jsxs("button",{onClick:()=>p(!0),className:"w-full p-3 rounded-lg border-2 border-dashed transition-all duration-200 hover:scale-105 flex items-center justify-center gap-2",style:{borderColor:r.colors.accent,color:r.colors.accent},children:[e.jsx(Je,{size:16}),l==="fr"?"Ajouter un Ã©tat personnalisÃ©":"Add custom state"]})]})]})})]}):null,_i=({currentTheme:t,currentLanguage:s,notes:r,onNotesChange:l,mentalSummary:n,onMentalSummaryChange:o,errors:a})=>e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 mb-2 text-sm font-medium",style:{color:t.colors.text},children:[e.jsx(cc,{size:16}),s==="fr"?"Note contextuelle":"Contextual Note"]}),e.jsx("textarea",{value:r,onChange:i=>l(i.target.value),placeholder:s==="fr"?"DÃ©crivez le contexte de votre trade, l'analyse technique, le setup...":"Describe your trade context, technical analysis, setup...",className:"w-full p-3 rounded-lg border resize-none",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text,minHeight:"120px"},rows:5}),a.notes&&e.jsx("p",{className:"text-sm mt-1",style:{color:t.colors.danger},children:a.notes})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 mb-2 text-sm font-medium",style:{color:t.colors.text},children:[e.jsx(Ya,{size:16}),s==="fr"?"RÃ©sumÃ© mental":"Mental Summary"]}),e.jsx("textarea",{value:n,onChange:i=>o(i.target.value),placeholder:s==="fr"?"Insights clÃ©s, points d'attention, leÃ§ons apprises...":"Key insights, points to watch, lessons learned...",className:"w-full p-3 rounded-lg border resize-none",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text,minHeight:"80px"},rows:3})]})]}),Vi=t=>{const[s,r]=g.useState(null),[l,n]=g.useState("");return{editingNameIndex:s,editingNameValue:l,setEditingNameIndex:r,setEditingNameValue:n,startEditing:(c,d)=>{r(c),n(d)},commitEditing:c=>{t(c,l),r(null),n("")},cancelEditing:()=>{r(null),n("")}}},Bi=t=>{const[s,r]=g.useState(null),[l,n]=g.useState(null),[o,a]=g.useState(null),[i,c]=g.useState(!1),d=h=>a(Date.now()),u=(h,b)=>{const j=Date.now();if(!o||j-o<300){h.preventDefault();return}c(!0),r(b),h.dataTransfer.effectAllowed="move"},m=(h,b)=>{i&&(h.preventDefault(),h.stopPropagation(),n(b))},p=h=>{i&&n(null)},x=(h,b)=>{if(i){if(h.preventDefault(),h.stopPropagation(),s===null||s===b){v();return}t(s,b),v()}},f=()=>v(),v=()=>{r(null),n(null),c(!1),a(null)};return{galleryDraggedIndex:s,galleryDragOverIndex:l,dragStartTime:o,isDraggingImage:i,handleImageMouseDown:d,handleImageDragStart:u,handleImageDragOver:m,handleImageDragLeave:p,handleImageDrop:x,handleImageDragEnd:f}},Hi=(t,s)=>{const[r,l]=g.useState(!1),[n,o]=g.useState(!1),a=g.useRef(null),i=g.useCallback(async x=>{if(x.length===0)return;o(!0);const f=[];for(let h=0;h<x.length;h++){const b=x[h];if(b.type.startsWith("image/")&&!(b.size>5*1024*1024))try{const j=await new Promise((y,N)=>{const w=new FileReader;w.onload=()=>y(w.result),w.onerror=N,w.readAsDataURL(b)});f.push(j)}catch{}}const v=t.screenshots||[];s("screenshots",[...v,...f]),o(!1)},[t.screenshots,s]);return{isDragOver:r,isUploading:n,fileInputRef:a,handleFileUpload:i,handleFileInputChange:x=>{const f=x.target.files;f&&i(f)},handleDropZoneClick:()=>{a.current?.click()},handleDragOver:x=>{x.preventDefault(),l(!0)},handleDragLeave:x=>{x.preventDefault(),l(!1)},handleDrop:x=>{x.preventDefault(),l(!1);const f=x.dataTransfer.files;f&&i(f)}}},Gi=()=>{const[t,s]=g.useState([]),[r,l]=g.useState(!1);return{selectedImages:t,setSelectedImages:s,comparisonMode:r,setComparisonMode:l,toggleImageSelection:i=>{s(c=>{if(c.includes(i)){if(r&&c.length<=2)return c;const d=c.filter(u=>u!==i);return r&&d.length<2&&l(!1),d}return c.length<6?[...c,i]:c})},enterComparisonMode:()=>{t.length>=2&&l(!0)},clearSelection:()=>s([])}},Ji=({formData:t,onChange:s,errors:r,settings:l,existingSymbols:n,isEditMode:o=!1,fieldConfig:a,shouldShowField:i,toggleFieldVisibility:c,isObligatoryField:d})=>{const{currentTheme:u}=Q(),{currentLanguage:m,t:p}=Z(),x=(ne,Re)=>s(ne,Re),{isDragOver:f,isUploading:v,fileInputRef:h,handleFileInputChange:b,handleDropZoneClick:j,handleDragOver:y,handleDragLeave:N,handleDrop:w}=Hi(t,x),[S,k]=g.useState(!1),[C,P]=g.useState(0),{selectedImages:R,setSelectedImages:M,comparisonMode:T,setComparisonMode:D,toggleImageSelection:F,clearSelection:$}=Gi(),U=()=>{R.length>=2&&(D(!0),P(R[0]),k(!0))},[B,O]=g.useState([]),{editingNameIndex:z,editingNameValue:q,setEditingNameIndex:E,setEditingNameValue:I,startEditing:H,commitEditing:L}=Vi((ne,Re)=>{const Ve=[...B];Ve[ne]=Re,O(Ve)}),[A,_]=g.useState(null),[J,re]=g.useState(null),[de,se]=g.useState(!1),{galleryDraggedIndex:ke,galleryDragOverIndex:be,isDraggingImage:he,handleImageMouseDown:te,handleImageDragStart:W,handleImageDragOver:K,handleImageDragLeave:ue,handleImageDrop:ye,handleImageDragEnd:Fe}=Bi((ne,Re)=>{const Qe=[...t.screenshots||[]],pt=[...B];[Qe[ne],Qe[Re]]=[Qe[Re],Qe[ne]],[pt[ne],pt[Re]]=[pt[Re],pt[ne]],s("screenshots",Qe),O(pt),M(_s=>_s.map(ro=>ro===ne?Re:ro===Re?ne:ro))}),[ee,oe]=g.useState(!1),[ve,Y]=g.useState(""),[me,fe]=g.useState(!1),[je,X]=g.useState(!1),[ae,ge]=g.useState(""),Ce=g.useRef(null);V.useEffect(()=>{const ne=Re=>{Ce.current&&!Ce.current.contains(Re.target)&&X(!1)};return document.addEventListener("mousedown",ne),()=>{document.removeEventListener("mousedown",ne)}},[]);const Be=ne=>{s("notes",ne)},Ke=ne=>{const Re=t.tags||[];if(Re.find(Qe=>Qe.startsWith("mental:"))){const Qe=Re.map(pt=>pt.startsWith("mental:")?`mental:${ne}`:pt);s("tags",Qe)}else s("tags",[...Re,`mental:${ne}`])},Nt=ne=>{s("emotionIntensity",ne)},nt=ne=>{s("emotion",ne),oe(!1)},zt=()=>{ve.trim()&&(nt(`custom:${ae||"ðŸ¤”"}:${ve.trim()}`),Y(""),ge(""),fe(!1))},It=()=>{if(ve.trim()){const ne=ae||"ðŸ¤”",Re={value:`custom_${Date.now()}`,emoji:ne,label:ve.trim()},Ve=JSON.parse(localStorage.getItem("customEmotionalStates")||"[]");Ve.push(Re),localStorage.setItem("customEmotionalStates",JSON.stringify(Ve)),Oe(Ve),nt(`custom:${ne}:${ve.trim()}`),Y(""),ge(""),fe(!1)}},Vt=()=>{s("emotion","")},St=ne=>{const Ve=JSON.parse(localStorage.getItem("customEmotionalStates")||"[]").filter(Qe=>Qe.value!==ne);localStorage.setItem("customEmotionalStates",JSON.stringify(Ve)),Oe(Ve)},Bt=ne=>{ge(ne),X(!1)},es=ne=>{s("planRespected",ne)},Ot=()=>{const ne=t.tags?.find(Re=>Re.startsWith("mental:"));return ne?ne.replace("mental:",""):""},Ue=()=>{if(typeof t.emotionIntensity=="number")return t.emotionIntensity;const ne=t.tags?.find(Re=>Re.startsWith("intensity:"));return ne?parseInt(ne.replace("intensity:","")):0},ie=()=>{if(t.emotion)return t.emotion;const ne=t.tags?.find(Re=>Re.startsWith("emotion:"));return ne?ne.replace("emotion:",""):""},ce=()=>{const ne=ie();if(ne.startsWith("custom:")){const Ve=ne.split(":"),Qe=Ve[1]||"ðŸ¤”",pt=Ve[2]||ne.replace("custom:","");return{emoji:Qe,label:pt,isCustom:!0}}const Re=Pe.find(Ve=>Ve.value===ne);return Re?{...Re,isCustom:Re.value.startsWith("custom_")}:null},pe=()=>{if(typeof t.planRespected<"u")return t.planRespected;const ne=t.tags?.find(Re=>Re.startsWith("plan:"));return ne?ne.replace("plan:","")==="true":null},Ee=ne=>{const Ve=(t.screenshots||[]).filter((pt,_s)=>_s!==ne),Qe=B.filter((pt,_s)=>_s!==ne);s("screenshots",Ve),O(Qe)},qe=(ne,Re)=>L(ne),We=ne=>{P(ne),k(!0)},Tt=()=>{P(ne=>(ne+1)%kt.length)},He=()=>{P(ne=>(ne-1+kt.length)%kt.length)},ft=ne=>ne===1?{type:"single",gridClass:"grid-cols-1"}:ne===2?{type:"two",gridClass:"grid-cols-1 lg:grid-cols-2"}:ne===3?{type:"three-asymmetric",gridClass:""}:ne===4?{type:"four-asymmetric",gridClass:""}:ne===5?{type:"five-asymmetric",gridClass:""}:{type:"regular",gridClass:"grid-cols-2 md:grid-cols-3 lg:grid-cols-3"},tt=(ne,Re)=>{_(Re),ne.dataTransfer.effectAllowed="move"},lt=(ne,Re)=>{ne.preventDefault(),ne.dataTransfer.dropEffect="move",re(Re)},Dt=()=>{re(null)},Ft=(ne,Re)=>{if(ne.preventDefault(),A===null||A===Re){_(null),re(null);return}const Ve=[...R],Qe=Ve.indexOf(A),pt=Ve.indexOf(Re);[Ve[Qe],Ve[pt]]=[Ve[pt],Ve[Qe]],M(Ve),_(null),re(null)},Ct=ne=>typeof ne=="string"?ne:ne.url,kt=t.screenshots||[],ys=Ot(),eo=Ue(),to=ie(),so=pe(),G=[{value:"euphoria",label:"Euphorie",emoji:"ðŸ˜„"},{value:"fomo",label:"FOMO",emoji:"ðŸ˜°"},{value:"stress",label:"Stress",emoji:"ðŸ˜«"},{value:"calm",label:"Calme",emoji:"ðŸ˜Œ"},{value:"fatigue",label:"Fatigue",emoji:"ðŸ˜´"}],[xe,Oe]=g.useState(()=>{try{return JSON.parse(localStorage.getItem("customEmotionalStates")||"[]")}catch{return[]}}),Pe=[...G,...xe];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6",children:[i&&i("notes")&&e.jsx(_i,{currentTheme:u,currentLanguage:m,notes:t.notes||"",onNotesChange:Be,mentalSummary:ys,onMentalSummaryChange:Ke,errors:r}),i&&i("screenshots")&&e.jsxs("div",{className:"lg:col-span-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",style:{color:u.colors.text},children:[e.jsx(Uo,{size:16}),"Screenshots"]}),o&&!d?.("screenshots")&&e.jsx("button",{type:"button",onClick:()=>c&&c("screenshots"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:a?.hiddenFields?.includes("screenshots")?"Afficher":"Masquer",style:{color:a?.hiddenFields?.includes("screenshots")?u.colors.warning:u.colors.textMuted},children:a?.hiddenFields?.includes("screenshots")?e.jsx(Se,{size:16}):e.jsx(De,{size:16})}),o&&d?.("screenshots")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:u.colors.accent+"20",color:u.colors.accent,border:`1px solid ${u.colors.accent}40`},title:m==="fr"?"Champ obligatoire":"Required field",children:m==="fr"?"Obligatoire":"Required"})]}),e.jsx(qi,{currentTheme:u,currentLanguage:m,screenshots:kt,imageNames:B,selectedImages:R,isDragOver:f,isUploading:v,fileInputRef:h,handleFileInputChange:b,handleDropZoneClick:j,handleDragOver:y,handleDragLeave:N,handleDrop:w,getScreenshotUrl:Ct,openLightbox:We,toggleImageSelection:F,removeScreenshot:Ee,editingNameIndex:z,editingNameValue:q,setEditingNameIndex:E,setEditingNameValue:I,updateImageName:qe,startEditing:H,isDraggingImage:he,galleryDraggedIndex:ke,galleryDragOverIndex:be,handleImageMouseDown:te,handleImageDragStart:W,handleImageDragOver:K,handleImageDragLeave:ue,handleImageDrop:ye,handleImageDragEnd:Fe,enterComparisonMode:U,clearSelection:$})]})]}),ee&&e.jsx(Wi,{open:ee,onClose:()=>oe(!1),currentTheme:u,currentLanguage:m,emotionalStates:Pe,handleEmotionChange:nt,handleRemoveCustomState:St,customEmotion:ve,setCustomEmotion:Y,customEmoji:ae,setCustomEmoji:ge,showCustomInput:me,setShowCustomInput:fe,showEmojiMenu:je,setShowEmojiMenu:X,emojiMenuRef:Ce,handleEmojiSelect:Bt,handleCustomEmotionAdd:zt,handleAddToPredefined:It}),i&&(i("emotion")||i("intensity")||i("planRespected"))&&e.jsx(Ui,{currentTheme:u,currentLanguage:m,intensity:eo,emotion:to,planRespected:so,getEmotionDisplay:ce,setIsEmotionModalOpen:oe,handleEmotionClear:Vt,handleIntensityChange:Nt,handlePlanRespectedChange:es}),S&&kt.length>0&&e.jsx(Oi,{screenshots:kt,imageNames:B,currentImageIndex:C,setCurrentImageIndex:P,comparisonMode:T,setComparisonMode:D,selectedImages:R,toggleImageSelection:F,hideHUD:de,setHideHUD:se,getScreenshotUrl:Ct,goToPrevImage:He,goToNextImage:Tt,currentLanguage:m,currentTheme:u,setLightboxOpen:k,getComparisonLayout:ft,handleComparisonDragStart:tt,handleComparisonDragOver:lt,handleComparisonDragLeave:Dt,handleComparisonDrop:Ft,draggedImageIndex:A,dragOverIndex:J})]})},Ki=({formData:t,onChange:s,settings:r})=>{const{currentTheme:l}=Q(),{currentLanguage:n}=Z();return t.market!=="futures"?null:e.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:l.colors.surface+"50",borderColor:l.colors.border},children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(Te,{size:14,style:{color:l.colors.textMuted}}),e.jsx("span",{className:"text-sm font-medium",style:{color:l.colors.textSecondary},children:n==="fr"?"Mode Ticks (Optionnel)":"Ticks Mode (Optional)"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",style:{color:l.colors.textMuted},children:"Ticks"}),e.jsx("input",{type:"number",step:"0.25",value:t.ticksGained||"",onChange:o=>{const a=o.target.value;if(a==="")s("ticksGained",void 0);else{const i=parseFloat(a);isNaN(i)||s("ticksGained",i)}},placeholder:"Ex: 12.5",className:"w-full px-2 py-1 text-sm border rounded focus:outline-none focus:ring-1 transition-colors",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",style:{color:l.colors.textMuted},children:n==="fr"?"Valeur/Tick":"Value/Tick"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",value:t.tickValue||"",onChange:o=>{const a=o.target.value;if(a==="")s("tickValue",void 0);else{const i=parseFloat(a);isNaN(i)||s("tickValue",i)}},placeholder:"Ex: 12.5",className:"w-full px-2 py-1 pr-8 text-sm border rounded focus:outline-none focus:ring-1 transition-colors",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text}}),e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs",style:{color:l.colors.textMuted},children:r?.currency||"EUR"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",style:{color:l.colors.textMuted},children:n==="fr"?"Contrats engagÃ©s":"Contracts engaged"}),e.jsx("input",{type:"number",step:"1",min:"1",value:t.contracts||"",onChange:o=>{const a=o.target.value;if(a==="")s("contracts",void 0);else{const i=parseInt(a,10);isNaN(i)||s("contracts",i)}},placeholder:"1",className:"w-full px-2 py-1 text-sm border rounded focus:outline-none focus:ring-1 transition-colors",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text}})]})]}),t.ticksGained!==void 0&&t.tickValue!==void 0&&e.jsx("div",{className:"mt-3 text-xs p-2 rounded border",style:{backgroundColor:l.colors.accent+"10",borderColor:l.colors.accent+"30",color:l.colors.accent},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:n==="fr"?"CalculÃ©:":"Calculated:"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium",children:new Intl.NumberFormat(n==="fr"?"fr-FR":"en-US",{style:"currency",currency:r?.currency||"EUR"}).format(t.ticksGained*t.tickValue*(t.contracts||1))}),e.jsxs("div",{className:"text-xs opacity-75",children:[(t.ticksGained*t.tickValue*(t.contracts||1)/(r?.initialCapital||1e4)*100).toFixed(2),"%"]})]})]})})]})},Yi=({formData:t,onChange:s,settings:r,t1:l,currentLanguage:n,setTimeframeOverlay:o,setTimeframeButtonRef:a})=>{const{currentTheme:i}=Q();return e.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:i.colors.surface,borderColor:i.colors.border},children:[e.jsx("h4",{className:"font-medium mb-3",style:{color:i.colors.text},children:n==="fr"?"Informations ComplÃ©mentaires":"Additional Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.colors.textSecondary},children:l("date")}),e.jsx(gs,{id:"quick-mode-date-input",value:t.date||"",onChange:c=>s("date",c),placeholder:n==="fr"?"jj/mm/aaaa":"mm/dd/yyyy",className:"w-full",size:"compact"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.colors.textSecondary},children:l("heure")}),e.jsx("input",{type:"time",value:t.time||"",onChange:c=>s("time",c.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors shadow-sm",style:{backgroundColor:i.colors.surface,borderColor:i.colors.border,color:i.colors.text}})]})]}),e.jsx("div",{children:e.jsx(Dl,{theme:i,formData:t,onChange:s,t1:l,currentLanguage:n,setTimeframeOverlay:o,setTimeframeButtonRef:a})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",style:{color:i.colors.textSecondary},children:[n==="fr"?"StratÃ©gie":"Strategy"," ",e.jsxs("span",{className:"text-xs",children:["(",n==="fr"?"optionnel":"optional",")"]})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsx("input",{type:"text",value:t.strategy||"",onChange:c=>s("strategy",c.target.value),placeholder:"Ex: Scalping, Swing...",className:"flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors shadow-sm",style:{backgroundColor:i.colors.surface,borderColor:i.colors.border,color:i.colors.text}})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",style:{color:i.colors.textSecondary},children:["Notes"," ",e.jsxs("span",{className:"text-xs",children:["(",n==="fr"?"optionnel":"optional",")"]})]}),e.jsx("textarea",{value:t.notes||"",onChange:c=>s("notes",c.target.value),placeholder:n==="fr"?"Observations, points clÃ©s...":"Observations, key points...",rows:3,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors shadow-sm resize-none",style:{backgroundColor:i.colors.surface,borderColor:i.colors.border,color:i.colors.text}})]})]})]})},Xi=({formData:t,onChange:s,errors:r,settings:l,existingSymbols:n=[],pnlInputMode:o,setPnlInputMode:a,calculatePnL:i,onOpenStrategyModal:c})=>{const{currentTheme:d}=Q(),{currentLanguage:u,t:m}=Z(),p=(Y,me)=>m[Y]||me,x=Y=>p(Y,Y),[f,v]=g.useState(!1),[h,b]=g.useState(!1),[j,y]=g.useState(null),[N,w]=g.useState(!1),[S,k]=g.useState(""),[C,P]=g.useState(!0),[R,M]=g.useState(()=>JSON.parse(localStorage.getItem("favorite-symbols")||"[]")),[T,D]=g.useState(()=>JSON.parse(localStorage.getItem(`custom-symbols-${t.market}`)||"[]")),[F,$]=g.useState(null),[U,B]=g.useState(null),[O,z]=g.useState(0),q=n.slice(0,5),E={futures:["ES","NQ","YM","CL","GC","SI","ZB","ZN","NG","HO","RB","PL","PA","HG"],forex:["EURUSD","GBPUSD","USDJPY","AUDUSD","EURGBP","EURJPY","GBPJPY","USDCAD","NZDUSD","USDCHF"],crypto:["BTCUSD","ETHUSD","ADAUSD","SOLUSD","BTCUSDT","ETHUSDT","ADAUSDT","SOLUSDT","DOTUSD","LINKUSD"],stocks:["AAPL","MSFT","GOOGL","TSLA","AMZN","NVDA","META","NFLX","AMD","INTC"],indices:["SPX","NDX","DJI","RUT","VIX","SPY","QQQ","IWM","VXX"],commodities:["CL","GC","SI","NG","HO","RB","PL","PA","HG","ZC","ZS","ZW"],unknown:[]};g.useEffect(()=>{const Y=JSON.parse(localStorage.getItem(`custom-symbols-${t.market}`)||"[]");D(Y)},[t.market]);const I=t.market?E[t.market]||[]:[],H=I.filter(Y=>!R.includes(Y)&&!T.includes(Y)),L=Tl,_=(Y=>{if(!Y.trim())return[];if(N)return[];if(!C)return[];const me=Y.toUpperCase(),fe=[...R,...H,...T];if(fe.includes(me))return[];const je=[...new Set(fe)];return L(je,Y).slice(0,5)})(t.symbol||""),J=L(n,S),re=L(R,S),de=L(H,S),se=L(T,S),ke=t.market?`${p("symboles","Symboles")} (${hi(t.market,u)})`:p("symboles","Symboles"),be=Y=>{if(!t.market||!Y.trim())return;const me=JSON.parse(localStorage.getItem(`custom-symbols-${t.market}`)||"[]"),fe=Y.trim().toUpperCase();if(!me.includes(fe)&&!I.includes(fe)){const je=[...me,fe];localStorage.setItem(`custom-symbols-${t.market}`,JSON.stringify(je)),D(je)}},he=Y=>{if(!t.market)return;const fe=JSON.parse(localStorage.getItem(`custom-symbols-${t.market}`)||"[]").filter(je=>je!==Y);localStorage.setItem(`custom-symbols-${t.market}`,JSON.stringify(fe)),D(fe)},te=Y=>{const me=JSON.parse(localStorage.getItem("favorite-symbols")||"[]"),je=me.includes(Y)?me.filter(X=>X!==Y):[...me,Y];localStorage.setItem("favorite-symbols",JSON.stringify(je)),M(je)},W=(Y,me)=>{$(me),Y.dataTransfer.effectAllowed="move",Y.dataTransfer.setData("text/plain",me)},K=(Y,me)=>{Y.preventDefault(),Y.dataTransfer.dropEffect="move",B(me)},ue=()=>{B(null)},ye=(Y,me)=>{if(Y.preventDefault(),!F)return;const fe=R.indexOf(F);if(fe===-1||fe===me){$(null),B(null);return}const je=[...R],[X]=je.splice(fe,1);je.splice(me,0,X),localStorage.setItem("favorite-symbols",JSON.stringify(je)),M(je),$(null),B(null)},Fe=()=>{$(null),B(null)};g.useEffect(()=>{const Y=me=>{if(me.altKey&&me.key.toLowerCase()==="s"){me.preventDefault(),w(!0);return}if(me.key==="Escape"){w(!1);return}if(N){if(me.key==="Enter"&&J.length>0){me.preventDefault();const fe=J[O];fe&&oe(fe);return}if(["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(me.key)){me.preventDefault();const fe=2,je=J.length;if(je===0)return;z(X=>me.key==="ArrowDown"?Math.min(X+fe,je-1):me.key==="ArrowUp"?Math.max(X-fe,0):me.key==="ArrowRight"?Math.min(X+1,je-1):me.key==="ArrowLeft"?Math.max(X-1,0):X)}}};return document.addEventListener("keydown",Y),()=>document.removeEventListener("keydown",Y)},[N,J,O]);const ee=(Y,me)=>{const fe=Ml(Y,me,t.market);if(Cl(me,t.market)){const ae=Rl(Y,me,t.market,u),ge=window.confirm(ae+`

`+p("m_moriser_ce_choix_pour_ce_symbole__","MÃ©moriser ce choix pour ce symbole ?"));window.confirm(ae)&&(s("market",fe),ge&&Pl(Y,fe,me.rule,!0))}s("symbol",Y);const je=JSON.parse(localStorage.getItem("symbol-recent")||"[]"),X=[Y,...je.filter(ae=>ae!==Y)].slice(0,10);localStorage.setItem("symbol-recent",JSON.stringify(X)),w(!1),k(""),P(!1),z(0)},oe=g.useCallback(Y=>{const me=kl(Y);ee(Y,me)},[]),ve=Y=>{if(Y===void 0){s("pnlPercentage",void 0),s("pnl",void 0);return}if(o==="percentage"){s("pnlPercentage",Y);const me=i(Y,"percentage");s("pnl",me)}else if(s("pnl",Y),t.entryPrice&&t.quantity){const me=t.entryPrice*t.quantity,fe=Y/me*100;s("pnlPercentage",fe)}};return e.jsxs("div",{className:"h-full flex flex-col animate-fadeIn",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:d.colors.textSecondary},children:[p("marche","MarchÃ©")," *"]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-6 gap-2",children:[{id:"futures",label:p("futures","Futures")},{id:"stocks",label:p("stocks","Actions")},{id:"forex",label:p("forex","Forex")},{id:"crypto",label:p("crypto","Crypto")},{id:"indices",label:p("indices","Indices")},{id:"commodities",label:p("commodities","MatiÃ¨res PremiÃ¨res")}].map(Y=>e.jsx("button",{type:"button",onClick:()=>s("market",Y.id),className:`px-2 py-2 rounded-lg border-2 text-xs font-medium transition-all text-center leading-tight ${t.market===Y.id?"shadow-md":"hover:shadow-sm"}`,style:{backgroundColor:t.market===Y.id?d.colors.accent:d.colors.surface,color:t.market===Y.id?"#ffffff":d.colors.text,borderColor:t.market===Y.id?d.colors.accent:d.colors.border,minHeight:"40px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{className:"break-words hyphens-auto",children:Y.label})},Y.id))}),r.market&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:d.colors.danger},children:r.market})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:d.colors.textSecondary},children:[p("symbole","Symbole")," *"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex space-x-2 relative",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:t.symbol||"",onChange:Y=>{s("symbol",Y.target.value.toUpperCase()),P(!0)},placeholder:p("ex__es__eurusd__aapl___","Ex: EURUSD, AAPL..."),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors shadow-sm",style:{backgroundColor:d.colors.surface,borderColor:r.symbol?d.colors.danger:d.colors.border,color:d.colors.text}}),e.jsx(Ko,{suggestions:_,favoriteSymbols:R,customSymbols:T,theme:d,onSelect:oe,onToggleFavorite:te,onRemoveCustom:he})]}),e.jsx("button",{type:"button",onClick:()=>{w(!0),k("")},className:"px-3 py-2 border rounded-lg transition-all duration-200 hover:shadow-sm flex items-center",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.text},title:p("alt_s_pour_ouvrir","Alt+S pour ouvrir"),children:e.jsx(qr,{size:16})})]}),q.length>0&&t.symbol!==q[0]&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-2",style:{color:d.colors.textMuted},children:x("recents")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:q.map(Y=>e.jsx("button",{type:"button",onClick:()=>oe(Y),className:"px-3 py-1 text-xs rounded-full border transition-all duration-200 hover:shadow-sm",style:{backgroundColor:t.symbol===Y?d.colors.accent:d.colors.surface,borderColor:d.colors.border,color:t.symbol===Y?"#ffffff":d.colors.text},children:Y},Y))})]})]}),r.symbol&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:d.colors.danger},children:r.symbol})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:d.colors.textSecondary},children:[p("direction","Direction")," *"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>s("side","long"),className:`px-3 py-2 rounded-lg border-2 text-sm font-medium transition-all ${t.side==="long"?"shadow-md":"hover:shadow-sm"}`,style:{backgroundColor:t.side==="long"?d.colors.success:d.colors.surface,color:t.side==="long"?"#ffffff":d.colors.text,borderColor:t.side==="long"?d.colors.success:d.colors.border},children:p("long","Long")}),e.jsx("button",{type:"button",onClick:()=>s("side","short"),className:`px-3 py-2 rounded-lg border-2 text-sm font-medium transition-all ${t.side==="short"?"shadow-md":"hover:shadow-sm"}`,style:{backgroundColor:t.side==="short"?d.colors.danger:d.colors.surface,color:t.side==="short"?"#ffffff":d.colors.text,borderColor:t.side==="short"?d.colors.danger:d.colors.border},children:p("short","Short")})]}),r.side&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:d.colors.danger},children:r.side})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"block text-sm font-semibold",style:{color:d.colors.textSecondary},children:[u==="fr"?"Gain/Perte":"Gain/Loss"," *"]}),e.jsx(Ll,{mode:o,onModeChange:a,disabled:!1})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",value:o==="percentage"?t.pnlPercentage||"":t.pnl||"",onChange:Y=>{const me=Y.target.value;if(me==="")ve(void 0);else{const fe=parseFloat(me);isNaN(fe)||ve(fe)}},placeholder:o==="percentage"?u==="fr"?"Ex: 2.5 (pour +2.5%)":"Ex: 2.5 (for +2.5%)":u==="fr"?"Ex: 150 (pour +150â‚¬)":"Ex: 150 (for +150â‚¬)",className:"w-full px-3 py-2 pr-24 border rounded-lg focus:outline-none focus:ring-2 transition-colors shadow-sm",style:{backgroundColor:d.colors.surface,borderColor:r.pnl||r.pnlPercentage?d.colors.danger:d.colors.border,color:d.colors.text}}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center gap-2 text-sm font-medium",style:{color:d.colors.textMuted},children:[(o==="percentage"?t.pnlPercentage:t.pnl)!==void 0&&(o==="percentage"?t.pnlPercentage:t.pnl)!==0&&((o==="percentage"?t.pnlPercentage:t.pnl)>0?e.jsx(Ae,{size:16,style:{color:d.colors.success}}):e.jsx($t,{size:16,style:{color:d.colors.danger}})),e.jsx("span",{children:o==="percentage"?"%":l?.currency||"EUR"})]})]}),(r.pnl||r.pnlPercentage)&&e.jsx("p",{className:"text-sm font-medium",style:{color:d.colors.danger},children:r.pnl||r.pnlPercentage}),o==="percentage"&&t.pnlPercentage!==void 0&&e.jsx("div",{className:"text-xs p-3 rounded-lg border",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.textMuted},children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(is,{size:12}),e.jsx("span",{children:u==="fr"?`AperÃ§u: ${t.pnlPercentage>0?"+":""}${t.pnlPercentage}% = ${new Intl.NumberFormat("fr-FR",{style:"currency",currency:l?.currency||"EUR"}).format((l?.initialCapital||1e4)*t.pnlPercentage/100)}`:`Preview: ${t.pnlPercentage>0?"+":""}${t.pnlPercentage}% = ${new Intl.NumberFormat("en-US",{style:"currency",currency:l?.currency||"EUR"}).format((l?.initialCapital||1e4)*t.pnlPercentage/100)}`})]})})]})]}),e.jsx(Ki,{formData:t,onChange:s,settings:l})]}),e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx("div",{children:e.jsx("button",{type:"button",onClick:()=>v(Y=>!Y),className:"text-sm px-3 py-2 rounded-lg border transition-colors",style:{backgroundColor:d.colors.surface,color:d.colors.text,borderColor:d.colors.border},children:f?u==="fr"?"- dÃ©tails":"- details":u==="fr"?"+ dÃ©tails":"+ details"})}),f&&e.jsx(Yi,{formData:t,onChange:s,settings:l,t1:x,currentLanguage:u,setTimeframeOverlay:b,setTimeframeButtonRef:y}),f&&t.market!=="futures"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:d.colors.textSecondary},children:[p("quantite","QuantitÃ©")," *"]}),e.jsx("input",{type:"number",step:"0.01",value:t.quantity||"",onChange:Y=>s("quantity",parseFloat(Y.target.value)||void 0),placeholder:p("ex__1__10___","Ex: 1, 10..."),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors shadow-sm",style:{backgroundColor:d.colors.surface,borderColor:r.quantity?d.colors.danger:d.colors.border,color:d.colors.text}}),r.quantity&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:d.colors.danger},children:r.quantity})]})]})]}),e.jsx(Vr,{isOpen:N,onClose:()=>w(!1),theme:d,t1:x,symbolSearch:S,onChangeSearch:k,onAddCustomSymbol:be,favoriteSymbols:R,filteredFavorites:re,filteredMarketSymbols:de,filteredCustomSymbols:se,currentSelectedSymbol:t.symbol,marketLabel:ke,onSelectSymbol:oe,onToggleFavorite:te,onRemoveCustomSymbol:he,draggedItem:F,dragOverIndex:U,onDragStart:W,onDragOver:K,onDragLeave:ue,onDrop:ye,onDragEnd:Fe}),e.jsx(_r,{isOpen:h,onClose:()=>b(!1),onSelect:Y=>s("timeframe",Y),currentValue:t.timeframe})]})},Qi=({currentStep:t,isQuickMode:s,formData:r,onChange:l,errors:n,settings:o,existingSymbols:a,existingTrades:i,pnlInputMode:c,setPnlInputMode:d,calculatePnL:u,onOpenStrategyModal:m,theme:p,language:x,isEditMode:f,fieldConfig:v,shouldShowField:h,toggleFieldVisibility:b,isObligatoryField:j})=>{if(s)return e.jsx(Xi,{formData:r,onChange:l,errors:n,settings:o,existingSymbols:a,pnlInputMode:c,setPnlInputMode:d,calculatePnL:u,onOpenStrategyModal:m});switch(t){case"instrument-context":return e.jsx(ji,{formData:r,onChange:l,errors:n,settings:o,existingSymbols:a,isEditMode:f,fieldConfig:v,shouldShowField:h,toggleFieldVisibility:b,isObligatoryField:j});case"position-entry":return e.jsx(Pi,{formData:r,onChange:l,errors:n,settings:o,existingSymbols:a,isEditMode:f,fieldConfig:v,shouldShowField:h,toggleFieldVisibility:b,isObligatoryField:j});case"position-exit":return e.jsx(Ti,{formData:r,onChange:l,errors:n,settings:o,existingSymbols:a,isEditMode:f,fieldConfig:v,shouldShowField:h,toggleFieldVisibility:b,isObligatoryField:j});case"risk-reward":return e.jsx(Ii,{formData:r,onChange:l,errors:n,settings:o,existingSymbols:a,existingTrades:i,onOpenStrategyModal:m,isEditMode:f,fieldConfig:v,shouldShowField:h,toggleFieldVisibility:b,isObligatoryField:j});case"notes-screenshots":return e.jsx(Ji,{formData:r,onChange:l,errors:n,settings:o,existingSymbols:a,isEditMode:f,fieldConfig:v,shouldShowField:h,toggleFieldVisibility:b,isObligatoryField:j});default:return e.jsx("div",{className:"p-6 text-center",style:{color:p.colors.textMuted},children:x==="fr"?"Ã‰tape en cours de dÃ©veloppement":"Step under development"})}},Zi=({isQuickMode:t,onToggle:s})=>{const{currentTheme:r}=Q(),{currentLanguage:l}=Z();return e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("button",{onClick:s,className:`flex items-center space-x-2 px-3 py-2 rounded-lg border-2 transition-all duration-200 hover:shadow-sm ${t?"border-0 shadow-md transform scale-105":"hover:shadow-sm"}`,style:{backgroundColor:t?r.colors.accent:r.colors.surface,color:t?"#ffffff":r.colors.text,borderColor:t?"transparent":r.colors.border},children:[e.jsx(ir,{size:16,style:{color:t?"#ffffff":r.colors.textMuted}}),e.jsx("span",{className:"text-sm font-medium",children:l==="fr"?"Mode Rapide":"Quick Mode"})]})})},ed=({isOpen:t,name:s,onNameChange:r,onCancel:l,onSubmit:n,theme:o,language:a})=>t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-[90]",children:e.jsxs("div",{className:"rounded-lg shadow-xl max-w-md w-full",style:{backgroundColor:o.colors.card},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",style:{borderColor:o.colors.border},children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:o.colors.text},children:a==="fr"?"CrÃ©er une stratÃ©gie":"Create a strategy"}),e.jsx("button",{onClick:l,className:"p-2 rounded-lg hover:theme-surface",title:a==="fr"?"Fermer":"Close",children:e.jsx(Ne,{size:18})})]}),e.jsxs("form",{onSubmit:i=>{i.preventDefault(),n()},className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:o.colors.text},children:a==="fr"?"Nom de la stratÃ©gie *":"Strategy Name *"}),e.jsx("input",{type:"text",value:s,onChange:i=>r(i.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent",style:{backgroundColor:o.colors.surface,borderColor:o.colors.border,color:o.colors.text},autoFocus:!0})]}),e.jsx("div",{children:e.jsx("p",{className:"text-sm",style:{color:o.colors.textMuted},children:a==="fr"?"Vous allez crÃ©er une nouvelle stratÃ©gie personnalisÃ©e et pourrez immÃ©diatement la configurer (timeframes, symboles, etc.).":"You are about to create a new custom strategy and will be able to configure it immediately (timeframes, symbols, etc.)."})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",style:{borderColor:o.colors.border},children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 rounded-lg hover:bg-opacity-80 transition-colors",style:{backgroundColor:o.colors.surface,color:o.colors.text},children:a==="fr"?"Annuler":"Cancel"}),e.jsxs("button",{type:"submit",className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:o.colors.accent,color:"#ffffff"},children:[e.jsx(Je,{size:16}),e.jsx("span",{children:a==="fr"?"CrÃ©er et Configurer":"Create and Configure"})]})]})]})]})}):null,td=({isOpen:t,preset:s,stats:r,theme:l,language:n,onClose:o,onOpenHistory:a})=>!t||!s?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-[90]",children:e.jsxs("div",{className:"rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",style:{backgroundColor:l.colors.card},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b sticky top-0 bg-inherit",style:{borderColor:l.colors.border},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-2xl",children:s.emoji||"ðŸ“Š"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:l.colors.text},children:s.name}),e.jsx("p",{className:"text-sm",style:{color:l.colors.textMuted},children:s.description||(n==="fr"?"Aucune description":"No description")})]})]}),e.jsx("button",{onClick:o,className:"p-2 rounded-full transition-colors hover:bg-opacity-10",style:{color:l.colors.textMuted,backgroundColor:`${l.colors.textMuted}10`},children:e.jsx(Ne,{size:20})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{backgroundColor:l.colors.surface},children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(_e,{size:20,style:{color:l.colors.accent}})}),e.jsx("div",{className:"text-2xl font-bold mb-1",style:{color:l.colors.text},children:r?.totalTrades||0}),e.jsx("div",{className:"text-xs",style:{color:l.colors.textMuted},children:"Trades"})]}),e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{backgroundColor:l.colors.surface},children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(Ae,{size:20,style:{color:"#10b981"}})}),e.jsx("div",{className:"text-2xl font-bold mb-1",style:{color:l.colors.text},children:r?`${r.winRate.toFixed(1)}%`:"0%"}),e.jsx("div",{className:"text-xs",style:{color:l.colors.textMuted},children:"Win Rate"})]}),e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{backgroundColor:l.colors.surface},children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(ot,{size:20,style:{color:"#f59e0b"}})}),e.jsx("div",{className:"text-2xl font-bold mb-1",style:{color:r&&r.totalPnL>=0?"#10b981":"#ef4444"},children:r?`${r.totalPnL>=0?"+":""}${r.totalPnL.toFixed(2)}â‚¬`:"0â‚¬"}),e.jsx("div",{className:"text-xs",style:{color:l.colors.textMuted},children:n==="fr"?"P&L Total":"Total P&L"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",style:{borderColor:l.colors.border},children:[e.jsx("button",{onClick:o,className:"px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:l.colors.surface,color:l.colors.text,border:`1px solid ${l.colors.border}`},children:n==="fr"?"Fermer":"Close"}),r&&r.totalTrades>0?e.jsxs("button",{onClick:a,className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors hover:opacity-90",style:{backgroundColor:l.colors.accent,color:"#ffffff"},children:[e.jsx(cs,{size:16}),e.jsx("span",{children:n==="fr"?"Voir l'historique des trades":"View Trade History"})]}):e.jsxs("div",{className:"flex items-center space-x-2 px-4 py-2 rounded-lg",style:{backgroundColor:l.colors.surface,color:l.colors.textMuted,border:`1px solid ${l.colors.border}`},children:[e.jsx(cs,{size:16}),e.jsx("span",{className:"text-sm",children:n==="fr"?"Aucun trade avec cette stratÃ©gie":"No trades with this strategy"})]})]})]})]})}),sd=({preset:t,onSave:s,onCancel:r,currentTheme:l,currentLanguage:n,onSelect:o})=>{const[a,i]=g.useState({name:t.name,description:t.description||"",category:t.category,riskLevel:t.riskLevel||"medium",complexity:t.complexity||"intermediate",timeframes:t.timeframes||[],markets:t.markets||[],emoji:t.emoji||"âš™ï¸",preferredSymbols:t.preferredSymbols||[]}),[c,d]=g.useState(t.timeframes||[]),[u,m]=g.useState(""),[p,x]=g.useState(""),[f,v]=g.useState(!1);g.useEffect(()=>{i(j=>({...j,timeframes:c}))},[c]),g.useEffect(()=>{const j=y=>{if(f){const N=y.target,w=document.querySelector("[data-emoji-menu]");w&&!w.contains(N)&&v(!1)}};return f&&document.addEventListener("mousedown",j),()=>{document.removeEventListener("mousedown",j)}},[f]);const h=j=>{j.preventDefault(),s(a)},b=()=>{const j=u.trim().toUpperCase();j&&!a.preferredSymbols.includes(j)&&(i(y=>({...y,preferredSymbols:[...y.preferredSymbols,j]})),m(""))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-[80]",onClick:j=>j.stopPropagation(),children:e.jsxs("div",{className:"rounded-lg shadow-xl max-w-md w-full max-h-[90vh] flex flex-col",style:{backgroundColor:l.colors.card},onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b flex-shrink-0",style:{borderColor:l.colors.border},children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:l.colors.text},children:n==="fr"?"Modifier la StratÃ©gie":"Edit Strategy"}),e.jsx("button",{onClick:r,className:"transition-colors",style:{color:l.colors.textMuted},children:e.jsx(Ne,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("form",{onSubmit:h,className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:l.colors.text},children:n==="fr"?"Nom de la stratÃ©gie *":"Strategy Name *"}),e.jsx("input",{type:"text",value:a.name,onChange:j=>i(y=>({...y,name:j.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},placeholder:n==="fr"?"Ma stratÃ©gie personnalisÃ©e":"My custom strategy",required:!0,disabled:t.isDefault})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:l.colors.text},children:n==="fr"?"Description (optionnel)":"Description (optional)"}),e.jsx("textarea",{value:a.description,onChange:j=>i(y=>({...y,description:j.target.value})),rows:3,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},placeholder:n==="fr"?"Description de votre stratÃ©gie...":"Description of your strategy..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:l.colors.text},children:n==="fr"?"CatÃ©gorie":"Category"}),e.jsx("select",{value:a.category,onChange:j=>i(y=>({...y,category:j.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},disabled:t.isDefault,children:Ur.map(j=>e.jsx("option",{value:j.id,children:j.name},j.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:l.colors.text},children:n==="fr"?"Niveau de risque":"Risk Level"}),e.jsx("select",{value:a.riskLevel,onChange:j=>i(y=>({...y,riskLevel:j.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},children:Wr.map(j=>e.jsx("option",{value:j.id,children:j.name},j.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:l.colors.text},children:n==="fr"?"Emoji personnalisÃ©":"Custom Emoji"}),e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"text",value:a.emoji,onChange:j=>i(y=>({...y,emoji:j.target.value})),className:"w-16 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent text-center text-xl",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},maxLength:4}),e.jsx("div",{className:"ml-3 flex-1 flex items-center",children:e.jsxs("div",{className:"flex flex-wrap gap-2 relative",children:[["ðŸ“ˆ","ðŸ“‰","ðŸ“Š","ðŸ’¹","âš¡","ðŸ”","ðŸŽ¯","ðŸ”„","âš™ï¸","ðŸŒŠ","ðŸ””","ðŸ’°"].map(j=>e.jsx("button",{onClick:y=>{y.stopPropagation(),y.preventDefault(),i(N=>({...N,emoji:j})),v(!1)},className:`w-8 h-8 flex items-center justify-center rounded-lg text-xl transition-all ${a.emoji===j?"ring-2":""}`,style:{backgroundColor:a.emoji===j?`${l.colors.accent}20`:l.colors.surface,borderColor:a.emoji===j?l.colors.accent:l.colors.border},children:j},j)),e.jsx("button",{onClick:j=>{j.stopPropagation(),j.preventDefault(),v(!f)},className:"w-8 h-8 flex items-center justify-center rounded-lg text-sm font-bold transition-all hover:scale-110",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},title:n==="fr"?"Plus d'emojis":"More emojis",children:"+"}),f&&e.jsx("div",{"data-emoji-menu":!0,className:"absolute top-10 left-0 z-50 p-3 rounded-lg shadow-lg border max-h-48 overflow-y-auto",style:{backgroundColor:l.colors.card,borderColor:l.colors.border,minWidth:"200px"},children:e.jsx("div",{className:"flex flex-wrap gap-2",children:["ðŸš€","ðŸ’Ž","ðŸ”¥","â­","ðŸ’ª","ðŸŽ²","ðŸ†","ðŸŒŸ","ðŸ’¡","âš”ï¸","ðŸŽ¨","ðŸŽ­","ðŸŽ¸","ðŸŽ¹","ðŸŽº","ðŸŽ»","ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰","ðŸ…","ðŸŽ–ï¸"].map(j=>e.jsx("button",{onClick:y=>{y.stopPropagation(),y.preventDefault(),i(N=>({...N,emoji:j})),v(!1)},className:`w-8 h-8 flex items-center justify-center rounded-lg text-xl transition-all hover:scale-110 ${a.emoji===j?"ring-2":""}`,style:{backgroundColor:a.emoji===j?`${l.colors.accent}20`:l.colors.surface,borderColor:a.emoji===j?l.colors.accent:l.colors.border},children:j},j))})})]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:l.colors.text},children:"Timeframes"}),e.jsxs("div",{className:"border rounded-lg p-3",style:{borderColor:l.colors.border,backgroundColor:l.colors.surface},children:[e.jsx("div",{className:"mb-1 text-xs",style:{color:l.colors.textMuted},children:n==="fr"?"SÃ©lectionnez ou ajoutez des timeframes adaptÃ©s Ã  cette stratÃ©gie":"Select or add timeframes suitable for this strategy"}),e.jsxs("div",{className:"flex mb-3",children:[e.jsx("input",{type:"text",value:p,onChange:j=>x(j.target.value),className:"flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent text-sm",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},placeholder:n==="fr"?"Ajouter un timeframe (ex: 2h, 50t, 1w)...":"Add timeframe (ex: 2h, 50t, 1w)..."}),e.jsx("button",{type:"button",onClick:()=>{p.trim()&&!c.includes(p.trim())&&(d(j=>[...j,p.trim()]),x(""))},className:"ml-2 px-3 py-2 rounded-lg transition-colors",style:{backgroundColor:l.colors.accent,color:"#ffffff"},disabled:!p.trim()||c.includes(p.trim()),children:e.jsx(Je,{size:16})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:["5s","15s","30s","1m","5m","15m","30m","1h","4h","1d","1w"].map(j=>e.jsx("button",{type:"button",onClick:()=>{c.includes(j)?d(y=>y.filter(N=>N!==j)):d(y=>[...y,j])},className:"px-2 py-1 rounded-lg text-xs font-medium transition-colors",style:{backgroundColor:c.includes(j)?l.colors.accent:l.colors.surface,color:c.includes(j)?"#ffffff":l.colors.text,border:`1px solid ${c.includes(j)?l.colors.accent:l.colors.border}`},children:j},j))}),c.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",style:{color:l.colors.textMuted},children:n==="fr"?"Timeframes sÃ©lectionnÃ©s :":"Selected timeframes:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(j=>e.jsxs("div",{className:"flex items-center px-2 py-1 rounded-lg text-xs",style:{backgroundColor:l.colors.accent+"20",border:`1px solid ${l.colors.accent}`},children:[e.jsx("span",{style:{color:l.colors.text},children:j}),e.jsx("button",{type:"button",onClick:()=>{d(y=>y.filter(N=>N!==j))},className:"ml-1 p-0.5 rounded-full",style:{color:l.colors.textMuted},children:e.jsx(Ne,{size:12})})]},j))})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:l.colors.text},children:n==="fr"?"Symboles prÃ©fÃ©rÃ©s":"Preferred Symbols"}),e.jsxs("div",{className:"border rounded-lg p-3",style:{borderColor:l.colors.border,backgroundColor:l.colors.surface},children:[e.jsxs("div",{className:"flex mb-1",children:[e.jsx("input",{type:"text",value:u,onChange:j=>m(j.target.value),onKeyPress:j=>{j.key==="Enter"&&(j.preventDefault(),b())},className:"flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent text-sm",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},placeholder:n==="fr"?"Ajouter un symbole...":"Add a symbol..."}),e.jsx("button",{type:"button",onClick:b,className:"ml-2 px-3 py-2 rounded-lg transition-colors",style:{backgroundColor:l.colors.accent,color:"#ffffff"},disabled:!u.trim(),children:e.jsx(Je,{size:16})})]}),a.preferredSymbols.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:a.preferredSymbols.map(j=>e.jsxs("div",{className:"flex items-center px-2 py-1 rounded-lg text-xs",style:{backgroundColor:l.colors.surface,border:`1px solid ${l.colors.border}`},children:[j,e.jsx("button",{type:"button",onClick:()=>{i(y=>({...y,preferredSymbols:y.preferredSymbols.filter(N=>N!==j)}))},className:"ml-1 p-0.5 rounded-full",style:{color:l.colors.textMuted},children:e.jsx(Ne,{size:12})})]},j))}):e.jsx("div",{className:"text-xs italic",style:{color:l.colors.textMuted},children:n==="fr"?"Aucun symbole ajoutÃ©":"No symbols added"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",style:{borderColor:l.colors.border},children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 rounded-lg hover:bg-opacity-80 transition-colors",style:{backgroundColor:l.colors.surface,color:l.colors.text},children:n==="fr"?"Annuler":"Cancel"}),e.jsxs("button",{type:"submit",className:"flex items-center px-5 py-2.5 rounded-lg transition-colors font-medium text-base",style:{backgroundColor:l.colors.accent,color:"#ffffff"},children:[e.jsx(Rt,{size:18,className:"mr-1"}),n==="fr"?"Enregistrer":"Save"]})]})]})})]})})},rd=({isOpen:t,preset:s,theme:r,language:l,onSave:n,onCancel:o,onSelect:a})=>!t||!s?null:e.jsx(sd,{preset:s,onSave:n,onCancel:o,onSelect:a,currentTheme:r,currentLanguage:l}),od=({theme:t,language:s,searchQuery:r,canCreate:l,onCreate:n,onClose:o})=>e.jsxs("div",{className:"flex justify-between items-center p-6 border-t flex-shrink-0",style:{borderColor:t.colors.border,backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"text-sm",style:{color:t.colors.textMuted},children:["ðŸ’¡ ",s==="fr"?"Tapez le nom d'une nouvelle stratÃ©gie pour la crÃ©er rapidement":"Type a new strategy name to create it quickly"]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 border rounded-lg hover:bg-opacity-80 transition-colors",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text},children:s==="fr"?"Fermer":"Close"}),l&&e.jsxs("button",{onClick:n,className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:t.colors.accent,color:"#ffffff"},children:[e.jsx(Je,{size:16}),e.jsx("span",{children:s==="fr"?`CrÃ©er "${r.slice(0,20)}${r.length>20?"...":""}"`:`Create "${r.slice(0,20)}${r.length>20?"...":""}"`})]})]})]}),nd=({isOpen:t,theme:s,language:r,name:l,onCancel:n,onConfirm:o})=>t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-[95]",children:e.jsxs("div",{className:"rounded-lg shadow-xl w-full max-w-sm",style:{backgroundColor:s.colors.card},children:[e.jsx("div",{className:"px-5 py-4 border-b",style:{borderColor:s.colors.border},children:e.jsx("h3",{className:"text-base font-semibold",style:{color:s.colors.text},children:r==="fr"?"Supprimer la stratÃ©gie ?":"Delete strategy?"})}),e.jsx("div",{className:"px-5 py-4",style:{color:s.colors.text},children:r==="fr"?`Voulez-vous vraiment supprimer "${l}" ?`:`Do you really want to delete "${l}"?`}),e.jsxs("div",{className:"px-5 py-4 border-t flex justify-end gap-2",style:{borderColor:s.colors.border},children:[e.jsx("button",{onClick:n,className:"px-3 py-1.5 rounded border",style:{backgroundColor:s.colors.surface,color:s.colors.text,borderColor:s.colors.border},children:r==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:o,className:"px-3 py-1.5 rounded",style:{backgroundColor:s.colors.danger,color:"#fff"},children:r==="fr"?"Supprimer":"Delete"})]})]})}):null,ld=({createPreset:t,updatePreset:s,deletePreset:r,toggleFavorite:l,setShowCreateForm:n})=>{const[o,a]=g.useState(!1),[i,c]=g.useState(null),[d,u]=g.useState(null),m=g.useCallback(j=>{c(j),a(!0)},[]),p=g.useCallback(()=>{a(!1),c(null)},[]),x=g.useCallback(j=>{const y=t({name:j,description:"",category:"custom",riskLevel:"medium",complexity:"intermediate",timeframes:[],markets:[],emoji:"âš™ï¸",preferredSymbols:[],isFavorite:!1});c(y),n(!1),a(!0)},[t,n]),f=g.useCallback(j=>{d===j.id?(r(j.id),u(null)):(u(j.id),setTimeout(()=>{u(y=>y===j.id?null:y)},3e3))},[d,r]),v=g.useCallback(()=>u(null),[]),h=g.useCallback(j=>{r(j.id),u(null)},[r]),b=g.useCallback(j=>{l(j)},[l]);return{showEditForm:o,editingPreset:i,openEdit:m,closeEdit:p,createAndEdit:x,deleteConfirmId:d,handleDelete:f,resetDeleteConfirm:v,forceDelete:h,onToggleFavorite:b}};ks.set({precision:40,rounding:ks.ROUND_HALF_UP});function Me(t){if(typeof t!="string")throw new Error(`toDecimal: expected string, got ${typeof t}`);if(t.trim()==="")throw new Error("toDecimal: empty string is not a valid decimal");try{const s=new ks(t);if(!s.isFinite())throw new Error(`toDecimal: "${t}" is not a finite number`);return s}catch(s){throw s instanceof Error?new Error(`toDecimal: invalid decimal string "${t}": ${s.message}`):new Error(`toDecimal: invalid decimal string "${t}"`)}}function Pt(t,s){return Hr(t,s,"dAdd"),t.add(s)}function Br(t,s){return Hr(t,s,"dSub"),t.sub(s)}function ut(t,s){return Hr(t,s,"dMul"),t.mul(s)}function vs(t,s){if(Hr(t,s,"dDiv"),s.isZero())throw new Error("dDiv: division by zero is not allowed");return t.div(s)}function ad(t,s){if(!(t instanceof ks))throw new Error(`dRound: expected Decimal, got ${typeof t}`);if(typeof s!="number"||s<0||!Number.isInteger(s))throw new Error(`dRound: decimals must be a non-negative integer, got ${s}`);return t.toDecimalPlaces(s,ks.ROUND_HALF_UP)}function Hr(t,s,r){if(!(t instanceof ks))throw new Error(`${r}: first argument must be a Decimal, got ${typeof t}`);if(!(s instanceof ks))throw new Error(`${r}: second argument must be a Decimal, got ${typeof s}`);if(!t.isFinite())throw new Error(`${r}: first argument is not finite`);if(!s.isFinite())throw new Error(`${r}: second argument is not finite`)}function ss(t){return Me(t===void 0?"0":String(t))}function cd(t){const s=ss(t.commission),r=ss(t.exchange),l=ss(t.spread),n=ss(t.swap);return Pt(Pt(s,r),Pt(l,n))}function id(t,s){return Pt(t,s)}function dd(t,s){const{base:r,decimals:l=2}=s;if(r.isZero())return Me("0");const n=ut(vs(t,r),Me("100"));return ad(n,l)}function Cr(t,s,r="equity",l=2){const n=ss(t.pnl??0),o=cd({commission:t.fees?.commission??t.commission??0,exchange:t.fees?.exchangeFees??0,spread:t.fees?.spread??0,swap:t.fees?.swapOvernight??0}),a=id(n,o);let i;if(r==="equity")i=ss(s.initialCapital);else{const d=ss(t.entryPrice??0),u=ss(t.quantity??0),m=ut(d,u);i=m.isZero()?ss(s.initialCapital):m.abs()}const c=dd(a,{base:i,decimals:l});return{gross:n,totalFees:o,net:a,percent:c}}const ud=(t,s)=>{if(t.pnlPercentage!==void 0&&t.pnlPercentage!==0)return{pnl:s.initialCapital*t.pnlPercentage/100,pnlPercentage:t.pnlPercentage};if(!t.exitPrice||t.exitPrice===0)return{pnl:0,pnlPercentage:0};let r;t.side==="long"?r=(t.exitPrice-t.entryPrice)*t.quantity:r=(t.entryPrice-t.exitPrice)*t.quantity;const l=r,n=l/s.initialCapital*100;return{pnl:l,pnlPercentage:n}};function md(t){const s=new Date(t);return["january","february","march","april","may","june","july","august","september","october","november","december"][s.getMonth()]}function jn(t){if(!t)return-1;const s=parseInt(t.split(":")[0]);return isNaN(s)?-1:s}function xd(t){const s=new Date(t);return["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][s.getDay()]}function fd(t){return t>=0&&t<8?"asia":t>=8&&t<14?"eu":t>=14&&t<16?"overlap":t>=16&&t<21?"us":t>=21&&t<24?"close":"asia"}const pd=(t,s)=>t.filter(r=>{if(s.dateRange?.start&&s.dateRange?.end){const l=new Date(r.date),n=new Date(s.dateRange.start),o=new Date(s.dateRange.end);if(l<n||l>o)return!1}if(s.timeRange?.start&&s.timeRange?.end&&r.time){const l=r.time,n=s.timeRange.start,o=s.timeRange.end;if(n<=o){if(l<n||l>o)return!1}else if(l<n&&l>o)return!1}if(s.weekdays&&s.weekdays.length>0){const l=xd(r.date);if(!s.weekdays.includes(l))return!1}if(s.months&&s.months.length>0){const l=md(r.date);if(!s.months.includes(l))return!1}if(s.hours&&s.hours.length>0){const l=jn(r.time);if(l===-1||!s.hours.includes(l))return!1}if(s.sessions&&s.sessions.length>0&&r.time){const l=jn(r.time);if(l===-1)return!1;const n=fd(l);if(!s.sessions.includes(n))return!1}if(s.pnlRange){let l;s.pnlUnit==="percent"?l=r.pnlPercentage||0:l=r.pnl||0;const n=s.pnlRange.min!==void 0?s.pnlRange.min:-1/0,o=s.pnlRange.max!==void 0?s.pnlRange.max:1/0;if(l<n||l>o)return!1}if(s.durationRange&&r.duration!==void 0){const l=s.durationUnit||"minutes",{toSecondsInterval:n}=require("../utils/durationValidation"),{minSeconds:o,maxSeconds:a}=n(s.durationRange.min,s.durationRange.max,l);if(o!==void 0&&r.duration<o||a!==void 0&&r.duration>a)return!1}if(s.ticksRange&&r.ticksGained!==void 0){const l=s.ticksRange.min!==void 0?s.ticksRange.min:-1/0,n=s.ticksRange.max!==void 0?s.ticksRange.max:1/0;if(r.ticksGained<l||r.ticksGained>n)return!1}if(s.feesRange){const l=r.fees?.total||r.commission||0,n=s.feesRange.min!==void 0?s.feesRange.min:-1/0,o=s.feesRange.max!==void 0?s.feesRange.max:1/0;if(l<n||l>o)return!1}if(s.lotsRange&&r.numberOfLots!==void 0){const l=s.lotsRange.min!==void 0?s.lotsRange.min:0,n=s.lotsRange.max!==void 0?s.lotsRange.max:1/0;if(r.numberOfLots<l||r.numberOfLots>n)return!1}if(s.tradeResult){const{takeProfit:l,stopLoss:n,breakEven:o}=s.tradeResult;if(l&&r.tradeResult!=="tp"||n&&r.tradeResult!=="sl"||o&&r.tradeResult!=="be")return!1}if(s.market){if(Array.isArray(s.market)){if(s.market.length>0&&!s.market.includes(r.market))return!1}else if(s.market!=="all"&&r.market!==s.market)return!1}if(s.trend&&s.trend.length>0&&!s.trend.includes(r.trend))return!1;if(s.strategy){if(Array.isArray(s.strategy)){if(s.strategy.length>0&&!s.strategy.includes(r.strategy))return!1}else if(s.strategy!=="all"&&r.strategy!==s.strategy)return!1}if(s.status){if(Array.isArray(s.status)){if(s.status.length>0&&!s.status.includes(r.status))return!1}else if(s.status!=="all"&&r.status!==s.status)return!1}if(s.side){if(Array.isArray(s.side)){if(s.side.length>0&&!s.side.includes(r.side))return!1}else if(s.side!=="all"&&r.side!==s.side)return!1}if(s.symbol){if(Array.isArray(s.symbol)){if(s.symbol.length>0&&!s.symbol.some(l=>r.symbol.toLowerCase().indexOf(l.toLowerCase())!==-1))return!1}else if(r.symbol.toLowerCase().indexOf(s.symbol.toLowerCase())===-1)return!1}return!(s.tags&&s.tags.length>0&&!s.tags.some(n=>r.tags.some(o=>o.toLowerCase().includes(n.toLowerCase()))))}),zl=t=>{let s=0;return t.dateRange?.start&&t.dateRange?.end&&s++,t.timeRange?.start&&t.timeRange?.end&&s++,t.sessions&&t.sessions.length>0&&s++,t.months&&t.months.length>0&&s++,t.weekdays&&t.weekdays.length>0&&s++,t.hours&&t.hours.length>0&&s++,t.symbol&&s++,t.strategy&&s++,t.trend&&t.trend.length>0&&s++,t.side&&s++,t.status&&s++,t.market&&t.market!=="all"&&s++,(t.pnlRange?.min!==void 0||t.pnlRange?.max!==void 0)&&s++,(t.durationRange?.min!==void 0||t.durationRange?.max!==void 0)&&s++,(t.tradeResult?.takeProfit||t.tradeResult?.stopLoss||t.tradeResult?.breakEven)&&s++,(t.feesRange?.min!==void 0||t.feesRange?.max!==void 0)&&s++,(t.contractsRange?.min!==void 0||t.contractsRange?.max!==void 0)&&s++,(t.lotsRange?.min!==void 0||t.lotsRange?.max!==void 0)&&s++,(t.ticksRange?.min!==void 0||t.ticksRange?.max!==void 0)&&s++,t.tags&&t.tags.length>0&&s++,s},Il=(t,s)=>{const r=[];if(t.dateRange?.start&&t.dateRange?.end){const l=new Date(t.dateRange.start).toLocaleDateString("fr-FR"),n=new Date(t.dateRange.end).toLocaleDateString("fr-FR");r.push({category:"time",section:"dateRange",value:`${l} â†’ ${n}`,description:"Plage de dates"})}if(t.timeRange?.start&&t.timeRange?.end&&r.push({category:"time",section:"timeRange",value:`${t.timeRange.start} â†’ ${t.timeRange.end}`,description:"Plage horaire"}),t.sessions&&t.sessions.length>0){const l={asia:"Session Asie",eu:"Session EU",overlap:"Overlap EU-US",us:"Session US",close:"Session Fermeture"},n=t.sessions.map(o=>l[o]||o).join(", ");r.push({category:"time",section:"sessions",value:n,description:"Sessions de trading"})}if(t.months&&t.months.length>0){const l={january:"Janvier",february:"FÃ©vrier",march:"Mars",april:"Avril",may:"Mai",june:"Juin",july:"Juillet",august:"AoÃ»t",september:"Septembre",october:"Octobre",november:"Novembre",december:"DÃ©cembre"},n=t.months.map(o=>l[o]||o).join(", ");r.push({category:"time",section:"months",value:n,description:"Mois"})}if(t.weekdays&&t.weekdays.length>0){const l={monday:"Lundi",tuesday:"Mardi",wednesday:"Mercredi",thursday:"Jeudi",friday:"Vendredi",saturday:"Samedi",sunday:"Dimanche"},n=t.weekdays.map(o=>l[o]||o).join(", ");r.push({category:"time",section:"weekdays",value:n,description:"Jours de la semaine"})}if(t.hours&&t.hours.length>0){const l=t.hours.map(n=>`${n}h`).join(", ");r.push({category:"time",section:"hours",value:l,description:"Heures"})}if(t.symbol){const l=Array.isArray(t.symbol)?t.symbol.join(", "):t.symbol;r.push({category:"market",section:"symbol",value:l,description:"Symbole"})}if(t.strategy){const l=Array.isArray(t.strategy)?t.strategy.join(", "):t.strategy;r.push({category:"market",section:"strategy",value:l,description:s&&s.strategy||"StratÃ©gie"})}if(t.trend&&t.trend.length>0){const l={bullish:"HaussiÃ¨re",bearish:"BaissiÃ¨re",sideways:"LatÃ©rale"},n=t.trend.map(o=>l[o]||o).join(", ");r.push({category:"market",section:"trend",value:n,description:"Tendance"})}if(t.side){const l={long:"Long",short:"Short"},n=Array.isArray(t.side)?t.side.map(o=>l[o]||o).join(", "):l[t.side]||t.side;r.push({category:"market",section:"side",value:n,description:"Direction"})}if(t.status){const l={open:"Ouvert",closed:"FermÃ©"},n=Array.isArray(t.status)?t.status.map(o=>l[o]||o).join(", "):l[t.status]||t.status;r.push({category:"market",section:"status",value:n,description:"Statut"})}if(t.market&&(Array.isArray(t.market)?t.market.length>0:t.market!=="all")){const l={forex:"Forex",futures:"Futures",crypto:"Crypto",stocks:"Actions",indices:"Indices",commodities:"MatiÃ¨res PremiÃ¨res"},n=Array.isArray(t.market)?t.market.map(o=>l[o]||o).join(", "):l[t.market]||t.market;r.push({category:"market",section:"market",value:n,description:"Type de marchÃ©"})}if(t.pnlRange?.min!==void 0||t.pnlRange?.max!==void 0){let l="";t.pnlRange.min!==void 0&&t.pnlRange.max!==void 0?l=`${t.pnlRange.min}â‚¬ â†’ ${t.pnlRange.max}â‚¬`:t.pnlRange.min!==void 0?l=`> ${t.pnlRange.min}â‚¬`:t.pnlRange.max!==void 0&&(l=`< ${t.pnlRange.max}â‚¬`),r.push({category:"performance",section:"pnlRange",value:l,description:`P&L (${t.pnlUnit==="percent"?"%":"â‚¬"})`})}if(t.durationRange?.min!==void 0||t.durationRange?.max!==void 0){let l="";t.durationRange.min!==void 0&&t.durationRange.max!==void 0?l=`${t.durationRange.min} â†’ ${t.durationRange.max} ${t.durationUnit||"minutes"}`:t.durationRange.min!==void 0?l=`> ${t.durationRange.min} ${t.durationUnit||"minutes"}`:t.durationRange.max!==void 0&&(l=`< ${t.durationRange.max} ${t.durationUnit||"minutes"}`),r.push({category:"performance",section:"durationRange",value:l,description:"DurÃ©e"})}if(t.tradeResult?.takeProfit||t.tradeResult?.stopLoss||t.tradeResult?.breakEven){const l=[];t.tradeResult.takeProfit&&l.push("TP"),t.tradeResult.stopLoss&&l.push("SL"),t.tradeResult.breakEven&&l.push("BE"),r.push({category:"performance",section:"tradeResult",value:l.join(", "),description:"RÃ©sultat du trade"})}if(t.feesRange?.min!==void 0||t.feesRange?.max!==void 0){let l="";t.feesRange.min!==void 0&&t.feesRange.max!==void 0?l=`${t.feesRange.min}â‚¬ â†’ ${t.feesRange.max}â‚¬`:t.feesRange.min!==void 0?l=`> ${t.feesRange.min}â‚¬`:t.feesRange.max!==void 0&&(l=`< ${t.feesRange.max}â‚¬`),r.push({category:"performance",section:"feesRange",value:l,description:"Frais"})}if(t.contractsRange?.min!==void 0||t.contractsRange?.max!==void 0){let l="";t.contractsRange.min!==void 0&&t.contractsRange.max!==void 0?l=`${t.contractsRange.min} â†’ ${t.contractsRange.max}`:t.contractsRange.min!==void 0?l=`> ${t.contractsRange.min}`:t.contractsRange.max!==void 0&&(l=`< ${t.contractsRange.max}`),r.push({category:"exposition",section:"contractsRange",value:l,description:"Contrats engagÃ©s"})}if(t.lotsRange?.min!==void 0||t.lotsRange?.max!==void 0){let l="";t.lotsRange.min!==void 0&&t.lotsRange.max!==void 0?l=`${t.lotsRange.min} â†’ ${t.lotsRange.max}`:t.lotsRange.min!==void 0?l=`> ${t.lotsRange.min}`:t.lotsRange.max!==void 0&&(l=`< ${t.lotsRange.max}`),r.push({category:"exposition",section:"lotsRange",value:l,description:"Lots"})}if(t.ticksRange?.min!==void 0||t.ticksRange?.max!==void 0){let l="";t.ticksRange.min!==void 0&&t.ticksRange.max!==void 0?l=`${t.ticksRange.min} â†’ ${t.ticksRange.max}`:t.ticksRange.min!==void 0?l=`> ${t.ticksRange.min}`:t.ticksRange.max!==void 0&&(l=`< ${t.ticksRange.max}`),r.push({category:"exposition",section:"ticksRange",value:l,description:"Ticks"})}return t.tags&&t.tags.length>0&&r.push({category:"tags",section:"tags",value:t.tags.join(", "),description:"Tags"}),r},Ol=ud,Xo=(t,s)=>{const r=t.filter(G=>G.status==="closed").map(G=>{if(G.pnl!==void 0&&G.pnlPercentage!==void 0)return G;const{pnl:xe,pnlPercentage:Oe}=Ol(G,s);return{...G,pnl:xe,pnlPercentage:Oe}}).filter(G=>G.pnl!==void 0&&G.pnlPercentage!==void 0);if(r.length===0)return{totalTrades:0,winningTrades:0,losingTrades:0,winRate:0,totalPnL:0,totalPnLPercentage:0,averageWin:0,averageLoss:0,averageWinPercentage:0,averageLossPercentage:0,profitFactor:0,largestWin:0,largestLoss:0,largestWinPercentage:0,largestLossPercentage:0,averageRiskReward:0,currentCapital:s.initialCapital,initialCapital:s.initialCapital,totalReturn:0,averageDuration:0,shortestTrade:0,longestTrade:0,averageWinDuration:0,averageLossDuration:0,totalTicks:0,averageTicksPerTrade:0,averageWinTicks:0,averageLossTicks:0,bestTickCapture:0,worstTickCapture:0,tickEfficiency:0,totalFees:0,averageFeesPerTrade:0,feesAsPercentageOfPnL:0,totalCommissions:0,totalSpreads:0,totalSwapFees:0,feesImpactOnProfitability:0,totalLots:0,averageLotsPerTrade:0,maxLotsInSingleTrade:0,averageLotsWinningTrades:0,averageLotsLosingTrades:0,maxDrawdown:0,maxDrawdownPercentage:0,tradesPerDay:0,sharpeRatio:0,monthlyReturn:0,consistencyScore:0,calmarRatio:0,recoveryFactor:0,expectancy:0,expectancyPercentage:0,averageTradesPerMonth:0,bestMonth:0,worstMonth:0,consecutiveWins:0,consecutiveLosses:0,maxConsecutiveWins:0,maxConsecutiveLosses:0,tpCount:0,slCount:0,beCount:0,tpWinRate:0,slWinRate:0,beWinRate:0};const l=G=>Cr(G,s,"equity",2).net.toNumber(),n=G=>Cr(G,s,"equity",2).percent.toNumber(),o=r.map(G=>({...G,netPnL:l(G),netPnLPercentage:n(G)})),a=o.filter(G=>G.netPnL>0),i=o.filter(G=>G.netPnL<0),c=o.reduce((G,xe)=>G+xe.netPnL,0),d=o.reduce((G,xe)=>G+xe.netPnLPercentage,0),u=a.reduce((G,xe)=>G+xe.netPnL,0),m=Math.abs(i.reduce((G,xe)=>G+xe.netPnL,0)),p=a.reduce((G,xe)=>G+xe.netPnLPercentage,0);Math.abs(i.reduce((G,xe)=>G+xe.netPnLPercentage,0));const x=a.length>0?u/a.length:0,f=i.length>0?i.reduce((G,xe)=>G+xe.netPnL,0)/i.length:0,v=a.length>0?p/a.length:0,h=i.length>0?i.reduce((G,xe)=>G+xe.netPnLPercentage,0)/i.length:0,b=m>0?u/m:u>0?1/0:0,j=a.length>0?Math.max(...a.map(G=>G.netPnL)):0,y=i.length>0?Math.min(...i.map(G=>G.netPnL)):0,N=a.length>0?Math.max(...a.map(G=>G.netPnLPercentage)):0,w=i.length>0?Math.min(...i.map(G=>G.netPnLPercentage)):0,S=r.filter(G=>G.riskReward&&G.riskReward>0),k=S.length>0?S.reduce((G,xe)=>G+(xe.riskReward||0),0)/S.length:0,C=s.initialCapital+c,P=s.initialCapital!==0?c/s.initialCapital*100:0,R=r.filter(G=>G.duration&&G.duration>0);let M=0,T=0,D=0,F=0,$=0;if(R.length>0){const G=R.map(Pe=>Pe.duration);M=G.reduce((Pe,ne)=>Pe+ne,0)/G.length,T=Math.min(...G),D=Math.max(...G);const xe=a.filter(Pe=>Pe.duration&&Pe.duration>0);xe.length>0&&(F=xe.reduce((Pe,ne)=>Pe+(ne.duration||0),0)/xe.length);const Oe=i.filter(Pe=>Pe.duration&&Pe.duration>0);Oe.length>0&&($=Oe.reduce((Pe,ne)=>Pe+(ne.duration||0),0)/Oe.length)}const U=r.filter(G=>G.ticksGained!==void 0&&G.ticksGained!==0);let B=0,O=0,z=0,q=0,E=0,I=0,H=0;if(U.length>0){B=U.reduce((Pe,ne)=>Pe+(ne.ticksGained||0),0),O=B/U.length;const G=a.filter(Pe=>Pe.ticksGained!==void 0&&Pe.ticksGained>0);G.length>0&&(z=G.reduce((Pe,ne)=>Pe+(ne.ticksGained||0),0)/G.length,E=Math.max(...G.map(Pe=>Pe.ticksGained||0)));const xe=i.filter(Pe=>Pe.ticksGained!==void 0&&Pe.ticksGained<0);xe.length>0&&(q=xe.reduce((Pe,ne)=>Pe+(ne.ticksGained||0),0)/xe.length,I=Math.min(...xe.map(Pe=>Pe.ticksGained||0))),H=U.filter(Pe=>(Pe.ticksGained||0)>0).length/U.length*100}const L=r.reduce((G,xe)=>G+(xe.fees?.total||xe.commission||0),0),A=r.length>0?L/r.length:0,_=c-L,J=_!==0?Math.abs(L/_*100):0,re=r.reduce((G,xe)=>G+(xe.fees?.commission||xe.commission||0),0),de=r.reduce((G,xe)=>G+(xe.fees?.spread||0),0),se=r.reduce((G,xe)=>G+(xe.fees?.swapOvernight||0),0),ke=Math.abs(L/s.initialCapital*100),be=r.filter(G=>G.numberOfLots&&G.numberOfLots>0);let he=0,te=0,W=0,K=0,ue=0;if(be.length>0){he=be.reduce((Oe,Pe)=>Oe+(Pe.numberOfLots||0),0),te=he/be.length,W=Math.max(...be.map(Oe=>Oe.numberOfLots||0));const G=a.filter(Oe=>Oe.numberOfLots&&Oe.numberOfLots>0);G.length>0&&(K=G.reduce((Oe,Pe)=>Oe+(Pe.numberOfLots||0),0)/G.length);const xe=i.filter(Oe=>Oe.numberOfLots&&Oe.numberOfLots>0);xe.length>0&&(ue=xe.reduce((Oe,Pe)=>Oe+(Pe.numberOfLots||0),0)/xe.length)}let ye=0,Fe=0,ee=s.initialCapital,oe=s.initialCapital;const ve=[...r].sort((G,xe)=>new Date(G.date+" "+(G.time||"00:00")).getTime()-new Date(xe.date+" "+(xe.time||"00:00")).getTime());ve.forEach(G=>{const xe=l(G);oe+=xe,oe>ee&&(ee=oe);const Oe=ee-oe,Pe=Oe/ee*100;Oe>ye&&(ye=Oe,Fe=Pe)}),ye=-Math.abs(ye),Fe=-Math.abs(Fe);const Y=new Set(r.map(G=>G.date)).size,me=Y>0?r.length/Y:0,fe=o.map(G=>G.netPnLPercentage),je=fe.reduce((G,xe)=>G+xe,0)/fe.length,X=fe.reduce((G,xe)=>G+Math.pow(xe-je,2),0)/fe.length,ae=Math.sqrt(X),ge=ae>0?je/ae*Math.sqrt(252):0,Ce=new Set(r.map(G=>{const xe=new Date(G.date);return`${xe.getFullYear()}-${xe.getMonth()}`})).size,Be=Ce>0?c/s.initialCapital*100/Ce:0,Ke=new Map;r.forEach(G=>{const xe=G.date;l(G),Ke.set(xe,(Ke.get(xe)||0)+n(G))});const Nt=Array.from(Ke.values()),nt=Nt.filter(G=>G>0).length,zt=Nt.length>0?nt/Nt.length*100:0,It=Math.abs(Fe)>0?d/Math.abs(Fe):0,Vt=Math.abs(ye)>0?c/Math.abs(ye):0,St=a.length/r.length*100,Bt=St/100*x+(100-St)/100*f,es=St/100*v+(100-St)/100*h,Ot=new Set(r.map(G=>{const xe=new Date(G.date);return`${xe.getFullYear()}-${xe.getMonth()}`})).size,Ue=Ot>0?r.length/Ot:0,ie=new Map;r.forEach(G=>{const xe=new Date(G.date),Oe=`${xe.getFullYear()}-${xe.getMonth()}`;l(G),ie.set(Oe,(ie.get(Oe)||0)+n(G))});const ce=Array.from(ie.values()),pe=ce.length>0?Math.max(...ce):0,Ee=ce.length>0?Math.min(...ce):0;let qe=0,We=0,Tt=0,He=0,ft=0,tt=0;ve.forEach(G=>{const xe=l(G);xe>0?(ft++,tt=0,Tt=Math.max(Tt,ft)):xe<0&&(tt++,ft=0,He=Math.max(He,tt))}),qe=ft,We=tt;const lt=r.filter(G=>G.tradeResult==="tp"),Dt=r.filter(G=>G.tradeResult==="sl"),Ft=r.filter(G=>G.tradeResult==="be"),Ct=lt.length,kt=Dt.length,ys=Ft.length,eo=lt.length>0?lt.filter(G=>(G.pnl||0)>0).length/lt.length*100:0,to=Dt.length>0?Dt.filter(G=>(G.pnl||0)>0).length/Dt.length*100:0,so=Ft.length>0?Ft.filter(G=>(G.pnl||0)>0).length/Ft.length*100:0;return{totalTrades:r.length,winningTrades:a.length,losingTrades:i.length,winRate:a.length/r.length*100,totalPnL:c,totalPnLPercentage:d,averageWin:x,averageLoss:f,averageWinPercentage:v,averageLossPercentage:h,profitFactor:b,largestWin:j,largestLoss:y,largestWinPercentage:N,largestLossPercentage:w,averageRiskReward:k,currentCapital:C,initialCapital:s.initialCapital,totalReturn:P,averageDuration:M,shortestTrade:T,longestTrade:D,averageWinDuration:F,averageLossDuration:$,totalTicks:B,averageTicksPerTrade:O,averageWinTicks:z,averageLossTicks:q,bestTickCapture:E,worstTickCapture:I,tickEfficiency:H,totalFees:L,averageFeesPerTrade:A,feesAsPercentageOfPnL:J,totalCommissions:re,totalSpreads:de,totalSwapFees:se,feesImpactOnProfitability:ke,totalLots:he,averageLotsPerTrade:te,maxLotsInSingleTrade:W,averageLotsWinningTrades:K,averageLotsLosingTrades:ue,maxDrawdown:ye,maxDrawdownPercentage:Fe,tradesPerDay:me,sharpeRatio:ge,monthlyReturn:Be,consistencyScore:zt,calmarRatio:It,recoveryFactor:Vt,expectancy:Bt,expectancyPercentage:es,averageTradesPerMonth:Ue,bestMonth:pe,worstMonth:Ee,consecutiveWins:qe,consecutiveLosses:We,maxConsecutiveWins:Tt,maxConsecutiveLosses:He,tpCount:Ct,slCount:kt,beCount:ys,tpWinRate:eo,slWinRate:to,beWinRate:so}},hd=pd,Nn=Object.freeze(Object.defineProperty({__proto__:null,calculatePnL:Ol,calculateTradeStats:Xo,countActiveFilters:zl,filterTrades:hd,getActiveFiltersList:Il},Symbol.toStringTag,{value:"Module"})),gd=t=>{const s=new Set(t.map(r=>r.strategy).filter(Boolean));return Array.from(s).map(r=>({id:`trade-${r}`,name:r,description:`StratÃ©gie utilisÃ©e dans ${t.filter(l=>l.strategy===r).length} trade(s)`,category:"custom",riskLevel:"medium",complexity:"intermediate",isDefault:!1,isFavorite:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),emoji:"ðŸ“Š",timeframes:[],preferredSymbols:[]}))},yd=({searchQuery:t,selectedCategory:s,hideDefaultStrategies:r,allAvailableStrategies:l,favoritePresets:n})=>{let o;if(t.trim()){const a=t.toLowerCase();o=l.filter(i=>i.name.toLowerCase().includes(a)||(i.description?.toLowerCase().includes(a)??!1))}else s==="all"?o=l:s==="favorites"?o=n:s==="custom"?o=l.filter(a=>a.category==="custom"&&!a.isDefault&&!String(a.id).startsWith("trade-")):o=l.filter(a=>a.category===s);return r&&(o=o.filter(a=>!a.isDefault)),o},bd=({allAvailableStrategies:t,favoritePresets:s,hideDefaultStrategies:r,language:l})=>{const n=r?t.filter(a=>!a.isDefault):t,o=r?s.filter(a=>!a.isDefault):s;return[{id:"all",name:l==="fr"?"Toutes":"All",icon:"ðŸ“‹",count:n.length},{id:"favorites",name:l==="fr"?"Favoris":"Favorites",icon:"â­",count:o.length},{id:"scalping",name:"Scalping",icon:"âš¡",count:n.filter(a=>a.category==="scalping").length},{id:"daytrading",name:"Day Trading",icon:"ðŸ“ˆ",count:n.filter(a=>a.category==="daytrading").length},{id:"swingtrading",name:"Swing Trading",icon:"ðŸŒŠ",count:n.filter(a=>a.category==="swingtrading").length},{id:"custom",name:l==="fr"?"PersonnalisÃ©":"Custom",icon:"âš™ï¸",count:n.filter(a=>a.category==="custom"&&!a.isDefault&&!String(a.id).startsWith("trade-")).length}]},vd=({allPresets:t,favoritePresets:s,allAvailableStrategies:r,initialHideDefault:l,language:n})=>{const[o,a]=g.useState(""),[i,c]=g.useState("all"),[d,u]=g.useState(l),m=g.useMemo(()=>yd({searchQuery:o,selectedCategory:i,hideDefaultStrategies:d,allAvailableStrategies:r,favoritePresets:s}),[o,i,d,r,s]),p=g.useMemo(()=>bd({allAvailableStrategies:r,favoritePresets:s,hideDefaultStrategies:d,language:n}),[r,s,d,n]);return{searchQuery:o,setSearchQuery:a,selectedCategory:i,setSelectedCategory:c,hideDefaultStrategies:d,setHideDefaultStrategies:u,filteredStrategies:m,categories:p}},jd=({title:t,countBadge:s,onClose:r,onCreate:l,hideDefault:n,onToggleHideDefault:o,language:a,theme:i})=>e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",style:{borderColor:i?.colors.border||"var(--theme-border)"},children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:i?.colors.text||"var(--theme-text)"},children:t}),o&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{type:"button",onClick:o,className:"relative inline-flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2",style:{"--tw-ring-color":i?.colors.accent||"#3b82f6"},children:[e.jsx("span",{className:"sr-only",children:a==="fr"?"Masquer les stratÃ©gies par dÃ©faut":"Hide default strategies"}),e.jsx("div",{className:"relative inline-flex h-5 w-9 items-center rounded-full transition-colors duration-200 ease-in-out",style:{backgroundColor:n?i?.colors.accent||"#3b82f6":i?.colors.border||"#d1d5db"},children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white shadow transition duration-200 ease-in-out ${n?"translate-x-4":"translate-x-0.5"}`})})]}),e.jsx("span",{className:"text-xs font-medium",style:{color:i?.colors.text||"var(--theme-text)"},children:a==="fr"?"Masquer les stratÃ©gies par dÃ©faut":"Hide default strategies"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-sm px-3 py-1 rounded-full",style:{backgroundColor:i?.colors.surface||"var(--theme-surface)",color:i?.colors.textMuted||"var(--theme-text-muted)",border:`1px solid ${i?.colors.border||"var(--theme-border)"}`},children:s}),l&&e.jsx("button",{onClick:l,className:"px-3 py-2 rounded-lg transition-colors",style:{backgroundColor:i?.colors.accent||"var(--theme-accent)",color:"#ffffff"},children:e.jsx(Je,{size:16})}),e.jsx("button",{onClick:r,className:"p-2 rounded-full transition-colors",style:{backgroundColor:i?.colors.surface||"var(--theme-surface)",color:i?.colors.textMuted||"var(--theme-text-muted)",border:`1px solid ${i?.colors.border||"var(--theme-border)"}`},children:e.jsx(Ne,{size:20})})]})]}),Nd=({value:t,onChange:s,placeholder:r})=>e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t,onChange:l=>s(l.target.value),className:"w-full pl-10 pr-8 py-3 text-sm border rounded-lg focus:outline-none focus:ring-2",placeholder:r}),e.jsx(vt,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 theme-text-muted"}),t&&e.jsx("button",{onClick:()=>s(""),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 rounded",children:e.jsx(Ne,{size:16})})]}),kd=({value:t,onChange:s,onCreate:r,canCreate:l,theme:n,language:o})=>e.jsx("div",{className:"px-6 py-3 border-b flex-shrink-0",style:{borderColor:n.colors.border},children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Nd,{value:t,onChange:s,placeholder:o==="fr"?"CrÃ©er ou rechercher une stratÃ©gie...":"Create or search for a strategy..."})}),l&&e.jsxs("button",{onClick:r,className:"flex items-center space-x-1 px-3 py-2 text-sm rounded-lg transition-colors whitespace-nowrap",style:{backgroundColor:n.colors.accent,color:"#ffffff"},children:[e.jsx(Je,{size:14}),e.jsx("span",{children:o==="fr"?`Ajouter "${t.slice(0,10)}${t.length>10?"...":""}"`:`Add "${t.slice(0,10)}${t.length>10?"...":""}"`})]})]})}),wd=({categories:t,selectedCategory:s,onSelectCategory:r,theme:l,language:n})=>e.jsx("div",{className:"px-6 py-2 border-b flex-shrink-0",style:{borderColor:l.colors.border},children:e.jsx("div",{className:"flex flex-wrap gap-1.5 justify-between",children:e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.map(o=>e.jsxs("button",{onClick:()=>r(o.id),className:"flex items-center px-3 py-1 rounded-lg text-xs font-medium transition-colors",style:{backgroundColor:s===o.id?l.colors.accent:l.colors.surface,color:s===o.id?"#ffffff":l.colors.text,boxShadow:s===o.id?"var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)":"none"},children:[e.jsx("span",{className:"mr-1",children:o.icon}),o.name,e.jsx("span",{className:"ml-1.5 px-1.5 py-0.5 rounded-full text-xs",style:{backgroundColor:s===o.id?"rgba(255, 255, 255, 0.2)":l.colors.surface,color:s===o.id?"#ffffff":l.colors.textMuted},children:o.count})]},o.id))})})}),Do=({preset:t,isActive:s,onSelect:r,onToggleFavorite:l,theme:n,language:o,onEdit:a,onDelete:i,onDetails:c,isDeleteConfirm:d,availableTrades:u=[],tradingSettings:m,gridIndex:p=0})=>{const x=Ur.find(w=>w.id===t.category),f=Wr.find(w=>w.id===t.riskLevel),v=vl.find(w=>w.id===t.complexity),h=u.filter(w=>w.strategy===t.name&&w.status==="closed"),b=h.length>0?{totalTrades:h.length,winRate:Math.round(h.filter(w=>(w.pnl||0)>0).length/h.length*100),totalPnL:h.reduce((w,S)=>w+(S.pnl||0),0),totalPnLPercentage:h.reduce((w,S)=>w+(S.pnlPercentage||0),0)}:null,j={hasStats:!!b,stats:b,timeframes:t.timeframes||[],preferredSymbols:t.preferredSymbols||[],category:x?.name||"",riskLevel:f?.name||"",complexity:v?.name||""},N=(p+1)%3===0?{position:"left",className:"absolute top-1/2 right-full transform -translate-y-1/2 mr-2",arrowClass:"absolute top-1/2 right-0 transform -translate-y-1/2 translate-x-1 w-0 h-0 border-t-4 border-b-4 border-l-4 border-transparent",arrowStyle:{borderLeftColor:n.colors.card}}:{position:"right",className:"absolute top-1/2 left-full transform -translate-y-1/2 ml-2",arrowClass:"absolute top-1/2 left-0 transform -translate-y-1/2 -translate-x-1 w-0 h-0 border-t-4 border-b-4 border-r-4 border-transparent",arrowStyle:{borderRightColor:n.colors.card}};return e.jsxs("div",{className:"h-36 p-3 text-left rounded-lg border transition-all hover:shadow-md relative flex flex-col group",style:{borderColor:s?n.colors.accent:n.colors.border,backgroundColor:s?`${n.colors.accent}10`:n.colors.surface,color:n.colors.text},title:"",children:[e.jsx("div",{className:`${N.className} opacity-0 group-hover:opacity-100 transition-all duration-300 pointer-events-none z-50 w-64`,style:{filter:"drop-shadow(0 8px 20px rgba(0, 0, 0, 0.12))"},children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:N.arrowClass,style:N.arrowStyle}),e.jsxs("div",{className:"rounded-xl shadow-xl border-2 overflow-hidden",style:{backgroundColor:n.colors.card,borderColor:n.colors.border,borderWidth:"2px"},children:[e.jsx("div",{className:"px-3 py-2 border-b-2",style:{backgroundColor:n.colors.surface+"50",borderColor:n.colors.border+"60"},children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:t.emoji||x?.icon||"ðŸ“Š"}),e.jsx("div",{className:"font-semibold text-xs truncate",style:{color:n.colors.text},children:t.name})]})}),e.jsxs("div",{className:"px-3 py-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-1 h-3 rounded-full",style:{backgroundColor:n.colors.accent}}),e.jsx("h4",{className:"font-medium text-xs",style:{color:n.colors.text},children:"Performance"})]}),j.hasStats&&j.stats?e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-bold",style:{color:n.colors.text},children:j.stats.totalTrades}),e.jsx("div",{className:"text-[10px]",style:{color:n.colors.textMuted},children:"Trades"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-sm font-bold",style:{color:n.colors.accent},children:[j.stats.winRate,"%"]}),e.jsx("div",{className:"text-[10px]",style:{color:n.colors.textMuted},children:"Win"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-sm font-bold",style:{color:j.stats.totalPnL>=0?"#10b981":"#ef4444"},children:[j.stats.totalPnL>=0?"+":"",j.stats.totalPnL.toFixed(1)]}),e.jsx("div",{className:"text-[10px]",style:{color:n.colors.textMuted},children:"P&L"})]})]}):e.jsx("div",{className:"text-center py-2",children:e.jsx("div",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"Aucun trade":"No trades"})})]}),(j.timeframes.length>0||j.preferredSymbols.length>0)&&e.jsxs("div",{className:"px-3 pb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-1 h-3 rounded-full",style:{backgroundColor:n.colors.accent}}),e.jsx("h4",{className:"font-medium text-xs",style:{color:n.colors.text},children:o==="fr"?"DÃ©tails":"Details"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[j.timeframes.slice(0,2).map((w,S)=>e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px]",style:{backgroundColor:n.colors.surface+"80",color:n.colors.text},children:w},S)),j.timeframes.length>2&&e.jsxs("span",{className:"px-1.5 py-0.5 rounded text-[10px]",style:{backgroundColor:n.colors.surface+"80",color:n.colors.textMuted},children:["+",j.timeframes.length-2]}),j.preferredSymbols.slice(0,2).map((w,S)=>e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px]",style:{backgroundColor:n.colors.surface+"80",color:n.colors.text},children:w},S)),j.preferredSymbols.length>2&&e.jsxs("span",{className:"px-1.5 py-0.5 rounded text-[10px]",style:{backgroundColor:n.colors.surface+"80",color:n.colors.textMuted},children:["+",j.preferredSymbols.length-2]})]})]})]})]})}),e.jsx("button",{onClick:w=>{w.stopPropagation(),w.preventDefault(),l()},className:"absolute top-2 right-2 p-1 rounded-full transition-colors z-10",style:{backgroundColor:t.isFavorite?`${n.colors.accent}20`:"transparent",color:t.isFavorite?"#ff4757":n.colors.textMuted},title:o==="fr"?"Ajouter aux favoris":"Add to favorites",children:e.jsx(xl,{size:16,fill:t.isFavorite?"#ff4757":"none"})}),e.jsx("div",{className:"relative group pr-8 flex-shrink-0 h-10",children:e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx("span",{className:"text-base",children:t.emoji||x?.icon||"ðŸ“Š"}),e.jsx("div",{className:"font-medium text-sm truncate",children:t.name})]})}),e.jsxs("div",{onClick:r,className:"flex-1 overflow-hidden cursor-pointer",children:[t.description&&e.jsx("p",{className:"text-xs mb-2 line-clamp-2",style:{color:n.colors.textMuted},children:t.description}),e.jsxs("div",{className:"flex items-center flex-wrap gap-1.5",children:[x&&e.jsx("span",{className:"px-1.5 py-0.5 text-xs rounded-full font-medium",style:{backgroundColor:`${x.color}15`,color:x.color,border:`1px solid ${x.color}30`},children:x.name}),f&&e.jsx("span",{className:"px-1.5 py-0.5 text-xs rounded-full font-medium",style:{backgroundColor:`${f.color}15`,color:f.color,border:`1px solid ${f.color}30`},children:f.name}),t.timeframes&&t.timeframes.length>0&&e.jsxs("div",{className:"flex items-center space-x-1 px-1.5 py-0.5 rounded-full",style:{backgroundColor:n.colors.surface},children:[e.jsx(ze,{size:10,style:{color:n.colors.textMuted}}),e.jsxs("span",{className:"text-xs",style:{color:n.colors.textMuted},children:[t.timeframes.slice(0,2).join(", "),t.timeframes.length>2&&` +${t.timeframes.length-2}`]})]}),t.preferredSymbols&&t.preferredSymbols.length>0&&e.jsxs("div",{className:"flex items-center space-x-1 px-1.5 py-0.5 rounded-full",style:{backgroundColor:n.colors.surface},children:[e.jsx(Ae,{size:10,style:{color:n.colors.textMuted}}),e.jsxs("span",{className:"text-xs",style:{color:n.colors.textMuted},children:[t.preferredSymbols.slice(0,3).join(", "),t.preferredSymbols.length>3&&` +${t.preferredSymbols.length-3}`]})]})]})]}),e.jsxs("div",{className:"flex-shrink-0 h-8 flex items-center justify-between border-t pt-2",style:{borderColor:n.colors.border+"40"},children:[e.jsx("div",{className:"h-5 flex items-center",children:t.isDefault&&e.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium rounded-full border",style:{backgroundColor:n.colors.accent,color:"#ffffff",borderColor:n.colors.accent},children:o==="fr"?"Par dÃ©faut":"Default"})}),e.jsxs("div",{className:"flex items-center space-x-1",children:[c&&e.jsx("button",{onClick:c,className:"p-1 text-xs rounded hover:theme-surface",title:o==="fr"?"DÃ©tails":"Details",children:e.jsx(Fs,{size:14})}),a&&e.jsx("button",{onClick:a,className:"p-1 text-xs rounded hover:theme-surface",title:o==="fr"?"Modifier":"Edit",children:e.jsx(yl,{size:14})}),i&&e.jsxs("button",{onClick:i,className:"p-1 text-xs rounded hover:theme-surface relative",title:o==="fr"?d?"Confirmer":"Supprimer":d?"Confirm":"Delete",children:[e.jsx(Qt,{size:14}),d&&e.jsx("span",{className:"absolute -top-6 right-0 text-[10px] px-1.5 py-0.5 rounded",style:{backgroundColor:"#ef4444",color:"#fff"},children:o==="fr"?"Confirmer":"Confirm"})]})]})]})]})},Sd=({mostUsed:t,isCollapsed:s,onToggle:r,onSelect:l,currentValue:n,theme:o,language:a,availableTrades:i=[],tradingSettings:c,allStrategies:d=[]})=>t.length===0?null:e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:r,className:"w-full flex items-center justify-between p-3 rounded-lg transition-colors hover:bg-opacity-10",style:{backgroundColor:s?"transparent":`${o.colors.surface}50`,color:o.colors.text},children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center",style:{color:o.colors.text},children:[e.jsx(ot,{size:20,className:"mr-2",style:{color:"#FFC107"}}),a==="fr"?"StratÃ©gies utilisÃ©es":"Used Strategies",e.jsx("span",{className:"ml-2 px-2 py-1 text-xs rounded-full",style:{backgroundColor:o.colors.accent,color:"#ffffff"},children:t.length})]}),s?e.jsx(Is,{size:20,style:{color:o.colors.textMuted}}):e.jsx($e,{size:20,style:{color:o.colors.textMuted}})]}),!s&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mt-4",children:t.slice(0,6).map((u,m)=>{const p=d.find(x=>x.name===u.name||x.name.toLowerCase()===u.name.toLowerCase()||x.name.toLowerCase().trim()===u.name.toLowerCase().trim());if(!p){const x=u.name.toLowerCase().includes("scalping")||u.name.toLowerCase().includes("trading")||u.name.toLowerCase().includes("momentum")||u.name.toLowerCase().includes("range")||u.name.toLowerCase().includes("news")||u.name.toLowerCase().includes("swing")||u.name.toLowerCase().includes("breakout"),f={id:`orphan-${u.name.toLowerCase().replace(/\s+/g,"-")}`,name:u.name,description:a==="fr"?`StratÃ©gie utilisÃ©e ${u.count} fois`:`Strategy used ${u.count} times`,category:x?"scalping":"custom",isDefault:x,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),emoji:"ðŸ“Š"};return e.jsx(Do,{preset:f,isActive:n===u.name,onSelect:()=>l(u.name),onToggleFavorite:()=>{},theme:o,language:a,availableTrades:i,tradingSettings:c,gridIndex:m},m)}return e.jsx(Do,{preset:p,isActive:n===u.name,onSelect:()=>l(u.name),onToggleFavorite:()=>{},theme:o,language:a,availableTrades:i,tradingSettings:c,gridIndex:m},m)})})]}),Cd=({title:t,countLabel:s,theme:r})=>e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:r.colors.text},children:t}),e.jsx("span",{className:"text-sm px-3 py-1 rounded-full",style:{backgroundColor:r.colors.surface,color:r.colors.textMuted},children:s})]}),Pd=({strategies:t,currentValue:s,theme:r,language:l,onSelect:n,onToggleFavorite:o,onEdit:a,onDelete:i,onDetails:c,deleteConfirmId:d,availableTrades:u=[],tradingSettings:m})=>e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:t.map((p,x)=>e.jsx(Do,{preset:p,isActive:s===p.name,onSelect:()=>n(p.name),onToggleFavorite:()=>o(p.id),theme:r,language:l,onEdit:a?()=>a(p):void 0,onDelete:i?()=>i(p):void 0,onDetails:c?()=>c(p):void 0,isDeleteConfirm:d===p.id,availableTrades:u,tradingSettings:m,gridIndex:x},`${p.id}-${x}`))}),Md=({searchQuery:t,filteredStrategies:s,currentValue:r,theme:l,language:n,hasMostUsed:o,onCreate:a,canCreate:i,onSelect:c,onToggleFavorite:d,onEdit:u,onDelete:m,onDetails:p,deleteConfirmId:x,availableTrades:f,tradingSettings:v})=>{const h=t?n==="fr"?`RÃ©sultats pour "${t}"`:`Results for "${t}"`:o?n==="fr"?"Autres stratÃ©gies":"Other Strategies":n==="fr"?"Toutes les stratÃ©gies":"All Strategies",b=`${s.length} ${n==="fr"?`stratÃ©gie${s.length>1?"s":""}`:`strateg${s.length>1?"ies":"y"}`}`;return e.jsxs("div",{children:[e.jsx(Cd,{title:h,countLabel:b,theme:l}),s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mb-4",children:e.jsx(vt,{size:48,className:"mx-auto",style:{color:l.colors.textMuted}})}),e.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:l.colors.text},children:t?n==="fr"?"Aucune stratÃ©gie trouvÃ©e":"No strategies found":n==="fr"?"Aucune stratÃ©gie disponible":"No strategies available"}),e.jsx("p",{className:"mb-6",style:{color:l.colors.textMuted},children:t?n==="fr"?`Aucune stratÃ©gie ne correspond Ã  "${t}"`:`No strategies match "${t}"`:n==="fr"?"Il n'y a pas de stratÃ©gies dans cette catÃ©gorie":"There are no strategies in this category"}),t&&i&&e.jsxs("button",{onClick:a,className:"inline-flex items-center space-x-2 px-6 py-3 rounded-lg transition-colors",style:{backgroundColor:l.colors.accent,color:"#ffffff"},children:[e.jsx(vt,{size:16}),e.jsx("span",{children:n==="fr"?`CrÃ©er la stratÃ©gie "${t}"`:`Create strategy "${t}"`})]})]}):e.jsx(Pd,{strategies:s,currentValue:r,theme:l,language:n,onSelect:c,onToggleFavorite:d,onEdit:u,onDelete:m,onDetails:p,deleteConfirmId:x,availableTrades:f,tradingSettings:v})]})},Rd=t=>{try{const s=new CustomEvent("open-filters-for-strategy",{detail:{strategy:t}});window.dispatchEvent(s)}catch{}},Fo=({onSelect:t,onClose:s,currentValue:r,availableTrades:l=[],tradingSettings:n={initialCapital:1e4,riskPerTrade:1,currency:"EUR"}})=>{const{currentTheme:o}=Q(),{currentLanguage:a}=Z(),[i,c]=g.useState(!1),[d,u]=us("trading-journal-hide-default-strategies",!1),[m,p]=g.useState(!1),[x,f]=g.useState(null),[v,h]=us("trading-journal-most-used-collapsed",!1),[b,j]=g.useState(""),{getMostUsedStrategies:y,allPresets:N,createPreset:w,updatePreset:S,deletePreset:k,toggleFavorite:C,getFavoritePresets:P}=Go(),R=g.useMemo(()=>gd(l),[l]),M=g.useMemo(()=>{const W=new Set(N.map(ue=>ue.name.toLowerCase())),K=R.filter(ue=>!W.has(ue.name.toLowerCase()));return[...N,...K]},[N,R]),T=y(l),D=g.useMemo(()=>P(),[P,N]),F=g.useMemo(()=>{if(!x||l.length===0)return null;const W=l.filter(ue=>ue.strategy===x.name&&ue.status==="closed");if(W.length===0)return{totalTrades:0,winRate:0,totalPnL:0,totalPnLPercentage:0};const K=Xo(W,n);return{totalTrades:K.totalTrades,winRate:K.winRate,totalPnL:K.totalPnL,totalPnLPercentage:K.totalPnLPercentage}},[x,l,n]),{searchQuery:$,setSearchQuery:U,selectedCategory:B,setSelectedCategory:O,hideDefaultStrategies:z,setHideDefaultStrategies:q,filteredStrategies:E,categories:I}=vd({allPresets:N,favoritePresets:D,allAvailableStrategies:M,initialHideDefault:!!d,language:a==="fr"?"fr":"en"});g.useEffect(()=>{u(z)},[z,u]);const H=W=>{t(W),s()},L=W=>{f(W),p(!0)},{showEditForm:A,editingPreset:_,openEdit:J,closeEdit:re,deleteConfirmId:de,handleDelete:se,resetDeleteConfirm:ke,forceDelete:be}=ld({createPreset:W=>w(W),updatePreset:S,deletePreset:k,toggleFavorite:C,setShowCreateForm:c}),he=W=>{C(W)};g.useEffect(()=>{ke()},[$,B]);const te=()=>{$.trim()&&(j($),c(!0))};return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50",children:[e.jsxs("div",{className:"rounded-lg shadow-xl max-w-5xl w-full h-[85vh] flex flex-col",style:{backgroundColor:o.colors.card,color:o.colors.text},children:[e.jsx(jd,{title:a==="fr"?"SÃ©lectionner une StratÃ©gie":"Select a Strategy",countBadge:a==="fr"?`(${z?M.filter(W=>!W.isDefault).length:M.length} stratÃ©gies disponibles)`:`(${z?M.filter(W=>!W.isDefault).length:M.length} strategies available)`,onClose:s,hideDefault:z,onToggleHideDefault:()=>q(!z),language:a==="fr"?"fr":"en",theme:o}),e.jsx(kd,{value:$,onChange:U,onCreate:te,canCreate:!!($.trim()&&!M.find(W=>W.name.toLowerCase()===$.toLowerCase())),theme:o,language:a==="fr"?"fr":"en"}),e.jsx(wd,{categories:I,selectedCategory:B,onSelectCategory:O,theme:o,language:a==="fr"?"fr":"en"}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[!$&&T.length>0&&e.jsx(Sd,{mostUsed:T,isCollapsed:v,onToggle:()=>h(!v),onSelect:H,currentValue:r,theme:o,language:a==="fr"?"fr":"en",availableTrades:l,tradingSettings:n,allStrategies:N}),e.jsx(Md,{searchQuery:$,filteredStrategies:E,currentValue:r,theme:o,language:a==="fr"?"fr":"en",hasMostUsed:T.length>0,onCreate:te,canCreate:!!($.trim()&&!M.find(W=>W.name.toLowerCase()===$.toLowerCase())),onSelect:H,onToggleFavorite:he,onEdit:J,onDelete:W=>se(W),onDetails:L,deleteConfirmId:de,availableTrades:l,tradingSettings:n})]}),e.jsx(od,{theme:o,language:a==="fr"?"fr":"en",searchQuery:$,canCreate:!!($.trim()&&!M.find(W=>W.name.toLowerCase()===$.toLowerCase())),onCreate:te,onClose:s})]}),i&&e.jsx(ed,{isOpen:i,name:b,onNameChange:j,onCancel:()=>c(!1),onSubmit:()=>{if(!b.trim()||M.find(K=>K.name.toLowerCase()===b.toLowerCase()))return;const W=w({name:b,description:"",category:"custom",riskLevel:"medium",complexity:"intermediate",timeframes:[],markets:[],emoji:"âš™ï¸",preferredSymbols:[]});c(!1),J(W)},theme:o,language:a==="fr"?"fr":"en"}),e.jsx(rd,{isOpen:!!(A&&_),preset:_,theme:o,language:a,onSave:W=>{_&&(_.isDefault?w({name:W.name||_.name,description:W.description||_.description||"",category:W.category||_.category,riskLevel:W.riskLevel||_.riskLevel||"medium",complexity:W.complexity||_.complexity||"intermediate",timeframes:W.timeframes||_.timeframes||[],markets:W.markets||_.markets||[],emoji:W.emoji||_.emoji||"âš™ï¸",preferredSymbols:W.preferredSymbols||_.preferredSymbols||[]}):S(_.id,W),re())},onCancel:()=>{re()},onSelect:W=>{H(W),re()}}),e.jsx(nd,{isOpen:!!de,theme:o,language:a==="fr"?"fr":"en",name:E.find(W=>W.id===de)?.name||"",onCancel:ke,onConfirm:()=>{const W=E.find(K=>K.id===de);W&&be(W)}}),e.jsx(td,{isOpen:!!(m&&x),preset:x,stats:F,theme:o,language:a==="fr"?"fr":"en",onClose:()=>p(!1),onOpenHistory:()=>{x&&(Rd(x.name),p(!1),s())}})]})},Td=({initialName:t,onSave:s,onClose:r,existingNames:l})=>{const{currentTheme:n}=Q(),{currentLanguage:o}=Z(),[a,i]=g.useState(t),[c,d]=g.useState(!1),[u,m]=g.useState(""),[p,x]=g.useState(!1),f=g.useRef(null);g.useEffect(()=>{f.current&&(f.current.focus(),f.current.select())},[]),g.useEffect(()=>{if(!a.trim()){m(o==="fr"?"Le nom est requis":"Name is required");return}if(a.trim().length<2){m(o==="fr"?"Le nom doit faire au moins 2 caractÃ¨res":"Name must be at least 2 characters");return}if(a.trim().length>50){m(o==="fr"?"Le nom ne peut pas dÃ©passer 50 caractÃ¨res":"Name cannot exceed 50 characters");return}if(l.some(j=>j.toLowerCase()===a.trim().toLowerCase())){m(o==="fr"?"Ce nom existe dÃ©jÃ ":"This name already exists");return}m("")},[a,l,o]);const v=async()=>{u||!a.trim()||(x(!0),setTimeout(()=>{s(a.trim(),c),x(!1)},300))},h=j=>{j.key==="Enter"&&!u&&a.trim()?(j.preventDefault(),v()):j.key==="Escape"&&(j.preventDefault(),r())},b=j=>{j.target===j.currentTarget&&r()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",onClick:b,children:e.jsxs("div",{className:"w-full max-w-md rounded-xl shadow-2xl overflow-hidden animate-fadeIn",style:{backgroundColor:n.colors.card,border:`1px solid ${n.colors.border}`},onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",style:{borderColor:n.colors.border,background:`linear-gradient(135deg, ${n.colors.surface} 0%, ${n.colors.card} 100%)`},children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Rt,{size:20,className:"mr-3",style:{color:n.colors.accent}}),e.jsx("h3",{className:"font-bold text-lg",style:{color:n.colors.text},children:o==="fr"?"Nouveau Preset":"New Preset"})]}),e.jsx("button",{onClick:r,className:"p-2 rounded-full hover:bg-opacity-10 hover:bg-black transition-colors",style:{color:n.colors.textMuted},children:e.jsx(Ne,{size:18})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:n.colors.textSecondary},children:[o==="fr"?"Nom du preset":"Preset name"," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:f,type:"text",value:a,onChange:j=>i(j.target.value),onKeyDown:h,placeholder:"Ex: Scalping ES 5min",className:"w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:n.colors.surface,borderColor:u?n.colors.danger:n.colors.border,color:n.colors.text},maxLength:50}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-xs",style:{color:n.colors.textMuted},children:[a.length,"/50"]})]}),u&&e.jsxs("div",{className:"flex items-center mt-2 text-sm",style:{color:n.colors.danger},children:[e.jsx(Xt,{size:14,className:"mr-2"}),u]}),!u&&a.trim()&&a.trim().length>=2&&e.jsxs("div",{className:"flex items-center mt-2 text-sm",style:{color:n.colors.success},children:[e.jsx(qt,{size:14,className:"mr-2"}),o==="fr"?"Nom valide":"Valid name"]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:j=>d(j.target.checked),className:"sr-only"}),e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-all duration-200 ${c?"border-0":""}`,style:{backgroundColor:c?n.colors.accent:"transparent",borderColor:c?n.colors.accent:n.colors.border},children:c&&e.jsx(qt,{size:12,color:"#ffffff"})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ot,{size:16,className:"mr-2",style:{color:"#F59E0B"}}),e.jsx("span",{className:"font-medium",style:{color:n.colors.text},children:o==="fr"?"Ajouter aux favoris":"Add to favorites"})]}),e.jsx("p",{className:"text-sm mt-1",style:{color:n.colors.textMuted},children:o==="fr"?"AccÃ¨s rapide dans le dropdown":"Quick access in dropdown"})]})]})})]}),e.jsxs("div",{className:"flex justify-between items-center px-6 py-4 border-t",style:{borderColor:n.colors.border,backgroundColor:n.colors.surface+"30"},children:[e.jsx("div",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"EntrÃ©e pour sauvegarder â€¢ Ã‰chap pour annuler":"Enter to save â€¢ Esc to cancel"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 rounded-lg transition-all duration-200 hover:shadow-sm",style:{backgroundColor:n.colors.surface,color:n.colors.text,border:`1px solid ${n.colors.border}`},children:o==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:v,disabled:!!u||!a.trim()||p,className:`flex items-center px-4 py-2 rounded-lg transition-all duration-200 ${u||!a.trim()?"opacity-50 cursor-not-allowed":"hover:shadow-md"}`,style:{backgroundColor:n.colors.accent,color:"#ffffff"},children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),o==="fr"?"Sauvegarde...":"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Rt,{size:16,className:"mr-2"}),o==="fr"?"CrÃ©er":"Create"]})})]})]})]})})};function Dd(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];return g.useMemo(()=>l=>{s.forEach(n=>n(l))},s)}const Gr=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Os(t){const s=Object.prototype.toString.call(t);return s==="[object Window]"||s==="[object global]"}function Qo(t){return"nodeType"in t}function jt(t){var s,r;return t?Os(t)?t:Qo(t)&&(s=(r=t.ownerDocument)==null?void 0:r.defaultView)!=null?s:window:window}function Zo(t){const{Document:s}=jt(t);return t instanceof s}function dr(t){return Os(t)?!1:t instanceof jt(t).HTMLElement}function ql(t){return t instanceof jt(t).SVGElement}function qs(t){return t?Os(t)?t.document:Qo(t)?Zo(t)?t:dr(t)||ql(t)?t.ownerDocument:document:document:document}const Wt=Gr?g.useLayoutEffect:g.useEffect;function Jr(t){const s=g.useRef(t);return Wt(()=>{s.current=t}),g.useCallback(function(){for(var r=arguments.length,l=new Array(r),n=0;n<r;n++)l[n]=arguments[n];return s.current==null?void 0:s.current(...l)},[])}function Fd(){const t=g.useRef(null),s=g.useCallback((l,n)=>{t.current=setInterval(l,n)},[]),r=g.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[s,r]}function rr(t,s){s===void 0&&(s=[t]);const r=g.useRef(t);return Wt(()=>{r.current!==t&&(r.current=t)},s),r}function ur(t,s){const r=g.useRef();return g.useMemo(()=>{const l=t(r.current);return r.current=l,l},[...s])}function Pr(t){const s=Jr(t),r=g.useRef(null),l=g.useCallback(n=>{n!==r.current&&s?.(n,r.current),r.current=n},[]);return[r,l]}function Mr(t){const s=g.useRef();return g.useEffect(()=>{s.current=t},[t]),s.current}let mo={};function mr(t,s){return g.useMemo(()=>{if(s)return s;const r=mo[t]==null?0:mo[t]+1;return mo[t]=r,t+"-"+r},[t,s])}function Ul(t){return function(s){for(var r=arguments.length,l=new Array(r>1?r-1:0),n=1;n<r;n++)l[n-1]=arguments[n];return l.reduce((o,a)=>{const i=Object.entries(a);for(const[c,d]of i){const u=o[c];u!=null&&(o[c]=u+t*d)}return o},{...s})}}const Es=Ul(1),Rr=Ul(-1);function Ed(t){return"clientX"in t&&"clientY"in t}function Kr(t){if(!t)return!1;const{KeyboardEvent:s}=jt(t.target);return s&&t instanceof s}function Ad(t){if(!t)return!1;const{TouchEvent:s}=jt(t.target);return s&&t instanceof s}function Tr(t){if(Ad(t)){if(t.touches&&t.touches.length){const{clientX:s,clientY:r}=t.touches[0];return{x:s,y:r}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:s,clientY:r}=t.changedTouches[0];return{x:s,y:r}}}return Ed(t)?{x:t.clientX,y:t.clientY}:null}const Zt=Object.freeze({Translate:{toString(t){if(!t)return;const{x:s,y:r}=t;return"translate3d("+(s?Math.round(s):0)+"px, "+(r?Math.round(r):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;const{scaleX:s,scaleY:r}=t;return"scaleX("+s+") scaleY("+r+")"}},Transform:{toString(t){if(t)return[Zt.Translate.toString(t),Zt.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:s,duration:r,easing:l}=t;return s+" "+r+"ms "+l}}}),kn="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Ld(t){return t.matches(kn)?t:t.querySelector(kn)}const $d={display:"none"};function zd(t){let{id:s,value:r}=t;return V.createElement("div",{id:s,style:$d},r)}function Id(t){let{id:s,announcement:r,ariaLiveType:l="assertive"}=t;const n={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return V.createElement("div",{id:s,style:n,role:"status","aria-live":l,"aria-atomic":!0},r)}function Od(){const[t,s]=g.useState("");return{announce:g.useCallback(l=>{l!=null&&s(l)},[]),announcement:t}}const Wl=g.createContext(null);function qd(t){const s=g.useContext(Wl);g.useEffect(()=>{if(!s)throw new Error("useDndMonitor must be used within a children of <DndContext>");return s(t)},[t,s])}function Ud(){const[t]=g.useState(()=>new Set),s=g.useCallback(l=>(t.add(l),()=>t.delete(l)),[t]);return[g.useCallback(l=>{let{type:n,event:o}=l;t.forEach(a=>{var i;return(i=a[n])==null?void 0:i.call(a,o)})},[t]),s]}const Wd={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},_d={onDragStart(t){let{active:s}=t;return"Picked up draggable item "+s.id+"."},onDragOver(t){let{active:s,over:r}=t;return r?"Draggable item "+s.id+" was moved over droppable area "+r.id+".":"Draggable item "+s.id+" is no longer over a droppable area."},onDragEnd(t){let{active:s,over:r}=t;return r?"Draggable item "+s.id+" was dropped over droppable area "+r.id:"Draggable item "+s.id+" was dropped."},onDragCancel(t){let{active:s}=t;return"Dragging was cancelled. Draggable item "+s.id+" was dropped."}};function Vd(t){let{announcements:s=_d,container:r,hiddenTextDescribedById:l,screenReaderInstructions:n=Wd}=t;const{announce:o,announcement:a}=Od(),i=mr("DndLiveRegion"),[c,d]=g.useState(!1);if(g.useEffect(()=>{d(!0)},[]),qd(g.useMemo(()=>({onDragStart(m){let{active:p}=m;o(s.onDragStart({active:p}))},onDragMove(m){let{active:p,over:x}=m;s.onDragMove&&o(s.onDragMove({active:p,over:x}))},onDragOver(m){let{active:p,over:x}=m;o(s.onDragOver({active:p,over:x}))},onDragEnd(m){let{active:p,over:x}=m;o(s.onDragEnd({active:p,over:x}))},onDragCancel(m){let{active:p,over:x}=m;o(s.onDragCancel({active:p,over:x}))}}),[o,s])),!c)return null;const u=V.createElement(V.Fragment,null,V.createElement(zd,{id:l,value:n.draggable}),V.createElement(Id,{id:i,announcement:a}));return r?ps.createPortal(u,r):u}var Xe;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(Xe||(Xe={}));function Dr(){}function or(t,s){return g.useMemo(()=>({sensor:t,options:s??{}}),[t,s])}function en(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];return g.useMemo(()=>[...s].filter(l=>l!=null),[...s])}const _t=Object.freeze({x:0,y:0});function Bd(t,s){return Math.sqrt(Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2))}function Hd(t,s){const r=Tr(t);if(!r)return"0 0";const l={x:(r.x-s.left)/s.width*100,y:(r.y-s.top)/s.height*100};return l.x+"% "+l.y+"%"}function Gd(t,s){let{data:{value:r}}=t,{data:{value:l}}=s;return r-l}function Jd(t,s){let{data:{value:r}}=t,{data:{value:l}}=s;return l-r}function Kd(t,s){if(!t||t.length===0)return null;const[r]=t;return r[s]}function wn(t,s,r){return s===void 0&&(s=t.left),r===void 0&&(r=t.top),{x:s+t.width*.5,y:r+t.height*.5}}const Fr=t=>{let{collisionRect:s,droppableRects:r,droppableContainers:l}=t;const n=wn(s,s.left,s.top),o=[];for(const a of l){const{id:i}=a,c=r.get(i);if(c){const d=Bd(wn(c),n);o.push({id:i,data:{droppableContainer:a,value:d}})}}return o.sort(Gd)};function Yd(t,s){const r=Math.max(s.top,t.top),l=Math.max(s.left,t.left),n=Math.min(s.left+s.width,t.left+t.width),o=Math.min(s.top+s.height,t.top+t.height),a=n-l,i=o-r;if(l<n&&r<o){const c=s.width*s.height,d=t.width*t.height,u=a*i,m=u/(c+d-u);return Number(m.toFixed(4))}return 0}const Xd=t=>{let{collisionRect:s,droppableRects:r,droppableContainers:l}=t;const n=[];for(const o of l){const{id:a}=o,i=r.get(a);if(i){const c=Yd(i,s);c>0&&n.push({id:a,data:{droppableContainer:o,value:c}})}}return n.sort(Jd)};function Qd(t,s,r){return{...t,scaleX:s&&r?s.width/r.width:1,scaleY:s&&r?s.height/r.height:1}}function _l(t,s){return t&&s?{x:t.left-s.left,y:t.top-s.top}:_t}function Zd(t){return function(r){for(var l=arguments.length,n=new Array(l>1?l-1:0),o=1;o<l;o++)n[o-1]=arguments[o];return n.reduce((a,i)=>({...a,top:a.top+t*i.y,bottom:a.bottom+t*i.y,left:a.left+t*i.x,right:a.right+t*i.x}),{...r})}}const eu=Zd(1);function Vl(t){if(t.startsWith("matrix3d(")){const s=t.slice(9,-1).split(/, /);return{x:+s[12],y:+s[13],scaleX:+s[0],scaleY:+s[5]}}else if(t.startsWith("matrix(")){const s=t.slice(7,-1).split(/, /);return{x:+s[4],y:+s[5],scaleX:+s[0],scaleY:+s[3]}}return null}function tu(t,s,r){const l=Vl(s);if(!l)return t;const{scaleX:n,scaleY:o,x:a,y:i}=l,c=t.left-a-(1-n)*parseFloat(r),d=t.top-i-(1-o)*parseFloat(r.slice(r.indexOf(" ")+1)),u=n?t.width/n:t.width,m=o?t.height/o:t.height;return{width:u,height:m,top:d,right:c+u,bottom:d+m,left:c}}const su={ignoreTransform:!1};function Us(t,s){s===void 0&&(s=su);let r=t.getBoundingClientRect();if(s.ignoreTransform){const{transform:d,transformOrigin:u}=jt(t).getComputedStyle(t);d&&(r=tu(r,d,u))}const{top:l,left:n,width:o,height:a,bottom:i,right:c}=r;return{top:l,left:n,width:o,height:a,bottom:i,right:c}}function Sn(t){return Us(t,{ignoreTransform:!0})}function ru(t){const s=t.innerWidth,r=t.innerHeight;return{top:0,left:0,right:s,bottom:r,width:s,height:r}}function ou(t,s){return s===void 0&&(s=jt(t).getComputedStyle(t)),s.position==="fixed"}function nu(t,s){s===void 0&&(s=jt(t).getComputedStyle(t));const r=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(n=>{const o=s[n];return typeof o=="string"?r.test(o):!1})}function tn(t,s){const r=[];function l(n){if(s!=null&&r.length>=s||!n)return r;if(Zo(n)&&n.scrollingElement!=null&&!r.includes(n.scrollingElement))return r.push(n.scrollingElement),r;if(!dr(n)||ql(n)||r.includes(n))return r;const o=jt(t).getComputedStyle(n);return n!==t&&nu(n,o)&&r.push(n),ou(n,o)?r:l(n.parentNode)}return t?l(t):r}function Bl(t){const[s]=tn(t,1);return s??null}function xo(t){return!Gr||!t?null:Os(t)?t:Qo(t)?Zo(t)||t===qs(t).scrollingElement?window:dr(t)?t:null:null}function Hl(t){return Os(t)?t.scrollX:t.scrollLeft}function Gl(t){return Os(t)?t.scrollY:t.scrollTop}function Eo(t){return{x:Hl(t),y:Gl(t)}}var Ze;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(Ze||(Ze={}));function Jl(t){return!Gr||!t?!1:t===document.scrollingElement}function Kl(t){const s={x:0,y:0},r=Jl(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},l={x:t.scrollWidth-r.width,y:t.scrollHeight-r.height},n=t.scrollTop<=s.y,o=t.scrollLeft<=s.x,a=t.scrollTop>=l.y,i=t.scrollLeft>=l.x;return{isTop:n,isLeft:o,isBottom:a,isRight:i,maxScroll:l,minScroll:s}}const lu={x:.2,y:.2};function au(t,s,r,l,n){let{top:o,left:a,right:i,bottom:c}=r;l===void 0&&(l=10),n===void 0&&(n=lu);const{isTop:d,isBottom:u,isLeft:m,isRight:p}=Kl(t),x={x:0,y:0},f={x:0,y:0},v={height:s.height*n.y,width:s.width*n.x};return!d&&o<=s.top+v.height?(x.y=Ze.Backward,f.y=l*Math.abs((s.top+v.height-o)/v.height)):!u&&c>=s.bottom-v.height&&(x.y=Ze.Forward,f.y=l*Math.abs((s.bottom-v.height-c)/v.height)),!p&&i>=s.right-v.width?(x.x=Ze.Forward,f.x=l*Math.abs((s.right-v.width-i)/v.width)):!m&&a<=s.left+v.width&&(x.x=Ze.Backward,f.x=l*Math.abs((s.left+v.width-a)/v.width)),{direction:x,speed:f}}function cu(t){if(t===document.scrollingElement){const{innerWidth:o,innerHeight:a}=window;return{top:0,left:0,right:o,bottom:a,width:o,height:a}}const{top:s,left:r,right:l,bottom:n}=t.getBoundingClientRect();return{top:s,left:r,right:l,bottom:n,width:t.clientWidth,height:t.clientHeight}}function Yl(t){return t.reduce((s,r)=>Es(s,Eo(r)),_t)}function iu(t){return t.reduce((s,r)=>s+Hl(r),0)}function du(t){return t.reduce((s,r)=>s+Gl(r),0)}function Xl(t,s){if(s===void 0&&(s=Us),!t)return;const{top:r,left:l,bottom:n,right:o}=s(t);Bl(t)&&(n<=0||o<=0||r>=window.innerHeight||l>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const uu=[["x",["left","right"],iu],["y",["top","bottom"],du]];class sn{constructor(s,r){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const l=tn(r),n=Yl(l);this.rect={...s},this.width=s.width,this.height=s.height;for(const[o,a,i]of uu)for(const c of a)Object.defineProperty(this,c,{get:()=>{const d=i(l),u=n[o]-d;return this.rect[c]+u},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Xs{constructor(s){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(r=>{var l;return(l=this.target)==null?void 0:l.removeEventListener(...r)})},this.target=s}add(s,r,l){var n;(n=this.target)==null||n.addEventListener(s,r,l),this.listeners.push([s,r,l])}}function mu(t){const{EventTarget:s}=jt(t);return t instanceof s?t:qs(t)}function fo(t,s){const r=Math.abs(t.x),l=Math.abs(t.y);return typeof s=="number"?Math.sqrt(r**2+l**2)>s:"x"in s&&"y"in s?r>s.x&&l>s.y:"x"in s?r>s.x:"y"in s?l>s.y:!1}var Lt;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(Lt||(Lt={}));function Cn(t){t.preventDefault()}function xu(t){t.stopPropagation()}var Ie;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})(Ie||(Ie={}));const Ql={start:[Ie.Space,Ie.Enter],cancel:[Ie.Esc],end:[Ie.Space,Ie.Enter,Ie.Tab]},fu=(t,s)=>{let{currentCoordinates:r}=s;switch(t.code){case Ie.Right:return{...r,x:r.x+25};case Ie.Left:return{...r,x:r.x-25};case Ie.Down:return{...r,y:r.y+25};case Ie.Up:return{...r,y:r.y-25}}};class Yr{constructor(s){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=s;const{event:{target:r}}=s;this.props=s,this.listeners=new Xs(qs(r)),this.windowListeners=new Xs(jt(r)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Lt.Resize,this.handleCancel),this.windowListeners.add(Lt.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Lt.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:s,onStart:r}=this.props,l=s.node.current;l&&Xl(l),r(_t)}handleKeyDown(s){if(Kr(s)){const{active:r,context:l,options:n}=this.props,{keyboardCodes:o=Ql,coordinateGetter:a=fu,scrollBehavior:i="smooth"}=n,{code:c}=s;if(o.end.includes(c)){this.handleEnd(s);return}if(o.cancel.includes(c)){this.handleCancel(s);return}const{collisionRect:d}=l.current,u=d?{x:d.left,y:d.top}:_t;this.referenceCoordinates||(this.referenceCoordinates=u);const m=a(s,{active:r,context:l.current,currentCoordinates:u});if(m){const p=Rr(m,u),x={x:0,y:0},{scrollableAncestors:f}=l.current;for(const v of f){const h=s.code,{isTop:b,isRight:j,isLeft:y,isBottom:N,maxScroll:w,minScroll:S}=Kl(v),k=cu(v),C={x:Math.min(h===Ie.Right?k.right-k.width/2:k.right,Math.max(h===Ie.Right?k.left:k.left+k.width/2,m.x)),y:Math.min(h===Ie.Down?k.bottom-k.height/2:k.bottom,Math.max(h===Ie.Down?k.top:k.top+k.height/2,m.y))},P=h===Ie.Right&&!j||h===Ie.Left&&!y,R=h===Ie.Down&&!N||h===Ie.Up&&!b;if(P&&C.x!==m.x){const M=v.scrollLeft+p.x,T=h===Ie.Right&&M<=w.x||h===Ie.Left&&M>=S.x;if(T&&!p.y){v.scrollTo({left:M,behavior:i});return}T?x.x=v.scrollLeft-M:x.x=h===Ie.Right?v.scrollLeft-w.x:v.scrollLeft-S.x,x.x&&v.scrollBy({left:-x.x,behavior:i});break}else if(R&&C.y!==m.y){const M=v.scrollTop+p.y,T=h===Ie.Down&&M<=w.y||h===Ie.Up&&M>=S.y;if(T&&!p.x){v.scrollTo({top:M,behavior:i});return}T?x.y=v.scrollTop-M:x.y=h===Ie.Down?v.scrollTop-w.y:v.scrollTop-S.y,x.y&&v.scrollBy({top:-x.y,behavior:i});break}}this.handleMove(s,Es(Rr(m,this.referenceCoordinates),x))}}}handleMove(s,r){const{onMove:l}=this.props;s.preventDefault(),l(r)}handleEnd(s){const{onEnd:r}=this.props;s.preventDefault(),this.detach(),r()}handleCancel(s){const{onCancel:r}=this.props;s.preventDefault(),this.detach(),r()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Yr.activators=[{eventName:"onKeyDown",handler:(t,s,r)=>{let{keyboardCodes:l=Ql,onActivation:n}=s,{active:o}=r;const{code:a}=t.nativeEvent;if(l.start.includes(a)){const i=o.activatorNode.current;return i&&t.target!==i?!1:(t.preventDefault(),n?.({event:t.nativeEvent}),!0)}return!1}}];function Pn(t){return!!(t&&"distance"in t)}function Mn(t){return!!(t&&"delay"in t)}class rn{constructor(s,r,l){var n;l===void 0&&(l=mu(s.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=s,this.events=r;const{event:o}=s,{target:a}=o;this.props=s,this.events=r,this.document=qs(a),this.documentListeners=new Xs(this.document),this.listeners=new Xs(l),this.windowListeners=new Xs(jt(a)),this.initialCoordinates=(n=Tr(o))!=null?n:_t,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:s,props:{options:{activationConstraint:r,bypassActivationConstraint:l}}}=this;if(this.listeners.add(s.move.name,this.handleMove,{passive:!1}),this.listeners.add(s.end.name,this.handleEnd),s.cancel&&this.listeners.add(s.cancel.name,this.handleCancel),this.windowListeners.add(Lt.Resize,this.handleCancel),this.windowListeners.add(Lt.DragStart,Cn),this.windowListeners.add(Lt.VisibilityChange,this.handleCancel),this.windowListeners.add(Lt.ContextMenu,Cn),this.documentListeners.add(Lt.Keydown,this.handleKeydown),r){if(l!=null&&l({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Mn(r)){this.timeoutId=setTimeout(this.handleStart,r.delay),this.handlePending(r);return}if(Pn(r)){this.handlePending(r);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(s,r){const{active:l,onPending:n}=this.props;n(l,s,this.initialCoordinates,r)}handleStart(){const{initialCoordinates:s}=this,{onStart:r}=this.props;s&&(this.activated=!0,this.documentListeners.add(Lt.Click,xu,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Lt.SelectionChange,this.removeTextSelection),r(s))}handleMove(s){var r;const{activated:l,initialCoordinates:n,props:o}=this,{onMove:a,options:{activationConstraint:i}}=o;if(!n)return;const c=(r=Tr(s))!=null?r:_t,d=Rr(n,c);if(!l&&i){if(Pn(i)){if(i.tolerance!=null&&fo(d,i.tolerance))return this.handleCancel();if(fo(d,i.distance))return this.handleStart()}if(Mn(i)&&fo(d,i.tolerance))return this.handleCancel();this.handlePending(i,d);return}s.cancelable&&s.preventDefault(),a(c)}handleEnd(){const{onAbort:s,onEnd:r}=this.props;this.detach(),this.activated||s(this.props.active),r()}handleCancel(){const{onAbort:s,onCancel:r}=this.props;this.detach(),this.activated||s(this.props.active),r()}handleKeydown(s){s.code===Ie.Esc&&this.handleCancel()}removeTextSelection(){var s;(s=this.document.getSelection())==null||s.removeAllRanges()}}const pu={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class xr extends rn{constructor(s){const{event:r}=s,l=qs(r.target);super(s,pu,l)}}xr.activators=[{eventName:"onPointerDown",handler:(t,s)=>{let{nativeEvent:r}=t,{onActivation:l}=s;return!r.isPrimary||r.button!==0?!1:(l?.({event:r}),!0)}}];const hu={move:{name:"mousemove"},end:{name:"mouseup"}};var Ao;(function(t){t[t.RightClick=2]="RightClick"})(Ao||(Ao={}));class gu extends rn{constructor(s){super(s,hu,qs(s.event.target))}}gu.activators=[{eventName:"onMouseDown",handler:(t,s)=>{let{nativeEvent:r}=t,{onActivation:l}=s;return r.button===Ao.RightClick?!1:(l?.({event:r}),!0)}}];const po={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class yu extends rn{constructor(s){super(s,po)}static setup(){return window.addEventListener(po.move.name,s,{capture:!1,passive:!1}),function(){window.removeEventListener(po.move.name,s)};function s(){}}}yu.activators=[{eventName:"onTouchStart",handler:(t,s)=>{let{nativeEvent:r}=t,{onActivation:l}=s;const{touches:n}=r;return n.length>1?!1:(l?.({event:r}),!0)}}];var Qs;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(Qs||(Qs={}));var Er;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})(Er||(Er={}));function bu(t){let{acceleration:s,activator:r=Qs.Pointer,canScroll:l,draggingRect:n,enabled:o,interval:a=5,order:i=Er.TreeOrder,pointerCoordinates:c,scrollableAncestors:d,scrollableAncestorRects:u,delta:m,threshold:p}=t;const x=ju({delta:m,disabled:!o}),[f,v]=Fd(),h=g.useRef({x:0,y:0}),b=g.useRef({x:0,y:0}),j=g.useMemo(()=>{switch(r){case Qs.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case Qs.DraggableRect:return n}},[r,n,c]),y=g.useRef(null),N=g.useCallback(()=>{const S=y.current;if(!S)return;const k=h.current.x*b.current.x,C=h.current.y*b.current.y;S.scrollBy(k,C)},[]),w=g.useMemo(()=>i===Er.TreeOrder?[...d].reverse():d,[i,d]);g.useEffect(()=>{if(!o||!d.length||!j){v();return}for(const S of w){if(l?.(S)===!1)continue;const k=d.indexOf(S),C=u[k];if(!C)continue;const{direction:P,speed:R}=au(S,C,j,s,p);for(const M of["x","y"])x[M][P[M]]||(R[M]=0,P[M]=0);if(R.x>0||R.y>0){v(),y.current=S,f(N,a),h.current=R,b.current=P;return}}h.current={x:0,y:0},b.current={x:0,y:0},v()},[s,N,l,v,o,a,JSON.stringify(j),JSON.stringify(x),f,d,w,u,JSON.stringify(p)])}const vu={x:{[Ze.Backward]:!1,[Ze.Forward]:!1},y:{[Ze.Backward]:!1,[Ze.Forward]:!1}};function ju(t){let{delta:s,disabled:r}=t;const l=Mr(s);return ur(n=>{if(r||!l||!n)return vu;const o={x:Math.sign(s.x-l.x),y:Math.sign(s.y-l.y)};return{x:{[Ze.Backward]:n.x[Ze.Backward]||o.x===-1,[Ze.Forward]:n.x[Ze.Forward]||o.x===1},y:{[Ze.Backward]:n.y[Ze.Backward]||o.y===-1,[Ze.Forward]:n.y[Ze.Forward]||o.y===1}}},[r,s,l])}function Nu(t,s){const r=s!=null?t.get(s):void 0,l=r?r.node.current:null;return ur(n=>{var o;return s==null?null:(o=l??n)!=null?o:null},[l,s])}function ku(t,s){return g.useMemo(()=>t.reduce((r,l)=>{const{sensor:n}=l,o=n.activators.map(a=>({eventName:a.eventName,handler:s(a.handler,l)}));return[...r,...o]},[]),[t,s])}var Ls;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})(Ls||(Ls={}));var Lo;(function(t){t.Optimized="optimized"})(Lo||(Lo={}));const Rn=new Map;function wu(t,s){let{dragging:r,dependencies:l,config:n}=s;const[o,a]=g.useState(null),{frequency:i,measure:c,strategy:d}=n,u=g.useRef(t),m=h(),p=rr(m),x=g.useCallback(function(b){b===void 0&&(b=[]),!p.current&&a(j=>j===null?b:j.concat(b.filter(y=>!j.includes(y))))},[p]),f=g.useRef(null),v=ur(b=>{if(m&&!r)return Rn;if(!b||b===Rn||u.current!==t||o!=null){const j=new Map;for(let y of t){if(!y)continue;if(o&&o.length>0&&!o.includes(y.id)&&y.rect.current){j.set(y.id,y.rect.current);continue}const N=y.node.current,w=N?new sn(c(N),N):null;y.rect.current=w,w&&j.set(y.id,w)}return j}return b},[t,o,r,m,c]);return g.useEffect(()=>{u.current=t},[t]),g.useEffect(()=>{m||x()},[r,m]),g.useEffect(()=>{o&&o.length>0&&a(null)},[JSON.stringify(o)]),g.useEffect(()=>{m||typeof i!="number"||f.current!==null||(f.current=setTimeout(()=>{x(),f.current=null},i))},[i,m,x,...l]),{droppableRects:v,measureDroppableContainers:x,measuringScheduled:o!=null};function h(){switch(d){case Ls.Always:return!1;case Ls.BeforeDragging:return r;default:return!r}}}function on(t,s){return ur(r=>t?r||(typeof s=="function"?s(t):t):null,[s,t])}function Su(t,s){return on(t,s)}function Cu(t){let{callback:s,disabled:r}=t;const l=Jr(s),n=g.useMemo(()=>{if(r||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(l)},[l,r]);return g.useEffect(()=>()=>n?.disconnect(),[n]),n}function Xr(t){let{callback:s,disabled:r}=t;const l=Jr(s),n=g.useMemo(()=>{if(r||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(l)},[r]);return g.useEffect(()=>()=>n?.disconnect(),[n]),n}function Pu(t){return new sn(Us(t),t)}function Tn(t,s,r){s===void 0&&(s=Pu);const[l,n]=g.useState(null);function o(){n(c=>{if(!t)return null;if(t.isConnected===!1){var d;return(d=c??r)!=null?d:null}const u=s(t);return JSON.stringify(c)===JSON.stringify(u)?c:u})}const a=Cu({callback(c){if(t)for(const d of c){const{type:u,target:m}=d;if(u==="childList"&&m instanceof HTMLElement&&m.contains(t)){o();break}}}}),i=Xr({callback:o});return Wt(()=>{o(),t?(i?.observe(t),a?.observe(document.body,{childList:!0,subtree:!0})):(i?.disconnect(),a?.disconnect())},[t]),l}function Mu(t){const s=on(t);return _l(t,s)}const Dn=[];function Ru(t){const s=g.useRef(t),r=ur(l=>t?l&&l!==Dn&&t&&s.current&&t.parentNode===s.current.parentNode?l:tn(t):Dn,[t]);return g.useEffect(()=>{s.current=t},[t]),r}function Tu(t){const[s,r]=g.useState(null),l=g.useRef(t),n=g.useCallback(o=>{const a=xo(o.target);a&&r(i=>i?(i.set(a,Eo(a)),new Map(i)):null)},[]);return g.useEffect(()=>{const o=l.current;if(t!==o){a(o);const i=t.map(c=>{const d=xo(c);return d?(d.addEventListener("scroll",n,{passive:!0}),[d,Eo(d)]):null}).filter(c=>c!=null);r(i.length?new Map(i):null),l.current=t}return()=>{a(t),a(o)};function a(i){i.forEach(c=>{const d=xo(c);d?.removeEventListener("scroll",n)})}},[n,t]),g.useMemo(()=>t.length?s?Array.from(s.values()).reduce((o,a)=>Es(o,a),_t):Yl(t):_t,[t,s])}function Fn(t,s){s===void 0&&(s=[]);const r=g.useRef(null);return g.useEffect(()=>{r.current=null},s),g.useEffect(()=>{const l=t!==_t;l&&!r.current&&(r.current=t),!l&&r.current&&(r.current=null)},[t]),r.current?Rr(t,r.current):_t}function Du(t){g.useEffect(()=>{if(!Gr)return;const s=t.map(r=>{let{sensor:l}=r;return l.setup==null?void 0:l.setup()});return()=>{for(const r of s)r?.()}},t.map(s=>{let{sensor:r}=s;return r}))}function Fu(t,s){return g.useMemo(()=>t.reduce((r,l)=>{let{eventName:n,handler:o}=l;return r[n]=a=>{o(a,s)},r},{}),[t,s])}function Zl(t){return g.useMemo(()=>t?ru(t):null,[t])}const En=[];function Eu(t,s){s===void 0&&(s=Us);const[r]=t,l=Zl(r?jt(r):null),[n,o]=g.useState(En);function a(){o(()=>t.length?t.map(c=>Jl(c)?l:new sn(s(c),c)):En)}const i=Xr({callback:a});return Wt(()=>{i?.disconnect(),a(),t.forEach(c=>i?.observe(c))},[t]),n}function ea(t){if(!t)return null;if(t.children.length>1)return t;const s=t.children[0];return dr(s)?s:t}function Au(t){let{measure:s}=t;const[r,l]=g.useState(null),n=g.useCallback(d=>{for(const{target:u}of d)if(dr(u)){l(m=>{const p=s(u);return m?{...m,width:p.width,height:p.height}:p});break}},[s]),o=Xr({callback:n}),a=g.useCallback(d=>{const u=ea(d);o?.disconnect(),u&&o?.observe(u),l(u?s(u):null)},[s,o]),[i,c]=Pr(a);return g.useMemo(()=>({nodeRef:i,rect:r,setRef:c}),[r,i,c])}const Lu=[{sensor:xr,options:{}},{sensor:Yr,options:{}}],$u={current:{}},Nr={draggable:{measure:Sn},droppable:{measure:Sn,strategy:Ls.WhileDragging,frequency:Lo.Optimized},dragOverlay:{measure:Us}};class Zs extends Map{get(s){var r;return s!=null&&(r=super.get(s))!=null?r:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(s=>{let{disabled:r}=s;return!r})}getNodeFor(s){var r,l;return(r=(l=this.get(s))==null?void 0:l.node.current)!=null?r:void 0}}const zu={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Zs,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Dr},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Nr,measureDroppableContainers:Dr,windowRect:null,measuringScheduled:!1},ta={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Dr,draggableNodes:new Map,over:null,measureDroppableContainers:Dr},fr=g.createContext(ta),sa=g.createContext(zu);function Iu(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Zs}}}function Ou(t,s){switch(s.type){case Xe.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:s.initialCoordinates,active:s.active}};case Xe.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:s.coordinates.x-t.draggable.initialCoordinates.x,y:s.coordinates.y-t.draggable.initialCoordinates.y}}};case Xe.DragEnd:case Xe.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Xe.RegisterDroppable:{const{element:r}=s,{id:l}=r,n=new Zs(t.droppable.containers);return n.set(l,r),{...t,droppable:{...t.droppable,containers:n}}}case Xe.SetDroppableDisabled:{const{id:r,key:l,disabled:n}=s,o=t.droppable.containers.get(r);if(!o||l!==o.key)return t;const a=new Zs(t.droppable.containers);return a.set(r,{...o,disabled:n}),{...t,droppable:{...t.droppable,containers:a}}}case Xe.UnregisterDroppable:{const{id:r,key:l}=s,n=t.droppable.containers.get(r);if(!n||l!==n.key)return t;const o=new Zs(t.droppable.containers);return o.delete(r),{...t,droppable:{...t.droppable,containers:o}}}default:return t}}function qu(t){let{disabled:s}=t;const{active:r,activatorEvent:l,draggableNodes:n}=g.useContext(fr),o=Mr(l),a=Mr(r?.id);return g.useEffect(()=>{if(!s&&!l&&o&&a!=null){if(!Kr(o)||document.activeElement===o.target)return;const i=n.get(a);if(!i)return;const{activatorNode:c,node:d}=i;if(!c.current&&!d.current)return;requestAnimationFrame(()=>{for(const u of[c.current,d.current]){if(!u)continue;const m=Ld(u);if(m){m.focus();break}}})}},[l,s,n,a,o]),null}function ra(t,s){let{transform:r,...l}=s;return t!=null&&t.length?t.reduce((n,o)=>o({transform:n,...l}),r):r}function Uu(t){return g.useMemo(()=>({draggable:{...Nr.draggable,...t?.draggable},droppable:{...Nr.droppable,...t?.droppable},dragOverlay:{...Nr.dragOverlay,...t?.dragOverlay}}),[t?.draggable,t?.droppable,t?.dragOverlay])}function Wu(t){let{activeNode:s,measure:r,initialRect:l,config:n=!0}=t;const o=g.useRef(!1),{x:a,y:i}=typeof n=="boolean"?{x:n,y:n}:n;Wt(()=>{if(!a&&!i||!s){o.current=!1;return}if(o.current||!l)return;const d=s?.node.current;if(!d||d.isConnected===!1)return;const u=r(d),m=_l(u,l);if(a||(m.x=0),i||(m.y=0),o.current=!0,Math.abs(m.x)>0||Math.abs(m.y)>0){const p=Bl(d);p&&p.scrollBy({top:m.y,left:m.x})}},[s,a,i,l,r])}const Qr=g.createContext({..._t,scaleX:1,scaleY:1});var fs;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(fs||(fs={}));const Ar=g.memo(function(s){var r,l,n,o;let{id:a,accessibility:i,autoScroll:c=!0,children:d,sensors:u=Lu,collisionDetection:m=Xd,measuring:p,modifiers:x,...f}=s;const v=g.useReducer(Ou,void 0,Iu),[h,b]=v,[j,y]=Ud(),[N,w]=g.useState(fs.Uninitialized),S=N===fs.Initialized,{draggable:{active:k,nodes:C,translate:P},droppable:{containers:R}}=h,M=k!=null?C.get(k):null,T=g.useRef({initial:null,translated:null}),D=g.useMemo(()=>{var Ue;return k!=null?{id:k,data:(Ue=M?.data)!=null?Ue:$u,rect:T}:null},[k,M]),F=g.useRef(null),[$,U]=g.useState(null),[B,O]=g.useState(null),z=rr(f,Object.values(f)),q=mr("DndDescribedBy",a),E=g.useMemo(()=>R.getEnabled(),[R]),I=Uu(p),{droppableRects:H,measureDroppableContainers:L,measuringScheduled:A}=wu(E,{dragging:S,dependencies:[P.x,P.y],config:I.droppable}),_=Nu(C,k),J=g.useMemo(()=>B?Tr(B):null,[B]),re=Ot(),de=Su(_,I.draggable.measure);Wu({activeNode:k!=null?C.get(k):null,config:re.layoutShiftCompensation,initialRect:de,measure:I.draggable.measure});const se=Tn(_,I.draggable.measure,de),ke=Tn(_?_.parentElement:null),be=g.useRef({activatorEvent:null,active:null,activeNode:_,collisionRect:null,collisions:null,droppableRects:H,draggableNodes:C,draggingNode:null,draggingNodeRect:null,droppableContainers:R,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),he=R.getNodeFor((r=be.current.over)==null?void 0:r.id),te=Au({measure:I.dragOverlay.measure}),W=(l=te.nodeRef.current)!=null?l:_,K=S?(n=te.rect)!=null?n:se:null,ue=!!(te.nodeRef.current&&te.rect),ye=Mu(ue?null:se),Fe=Zl(W?jt(W):null),ee=Ru(S?he??_:null),oe=Eu(ee),ve=ra(x,{transform:{x:P.x-ye.x,y:P.y-ye.y,scaleX:1,scaleY:1},activatorEvent:B,active:D,activeNodeRect:se,containerNodeRect:ke,draggingNodeRect:K,over:be.current.over,overlayNodeRect:te.rect,scrollableAncestors:ee,scrollableAncestorRects:oe,windowRect:Fe}),Y=J?Es(J,P):null,me=Tu(ee),fe=Fn(me),je=Fn(me,[se]),X=Es(ve,fe),ae=K?eu(K,ve):null,ge=D&&ae?m({active:D,collisionRect:ae,droppableRects:H,droppableContainers:E,pointerCoordinates:Y}):null,Ce=Kd(ge,"id"),[Be,Ke]=g.useState(null),Nt=ue?ve:Es(ve,je),nt=Qd(Nt,(o=Be?.rect)!=null?o:null,se),zt=g.useRef(null),It=g.useCallback((Ue,ie)=>{let{sensor:ce,options:pe}=ie;if(F.current==null)return;const Ee=C.get(F.current);if(!Ee)return;const qe=Ue.nativeEvent,We=new ce({active:F.current,activeNode:Ee,event:qe,options:pe,context:be,onAbort(He){if(!C.get(He))return;const{onDragAbort:tt}=z.current,lt={id:He};tt?.(lt),j({type:"onDragAbort",event:lt})},onPending(He,ft,tt,lt){if(!C.get(He))return;const{onDragPending:Ft}=z.current,Ct={id:He,constraint:ft,initialCoordinates:tt,offset:lt};Ft?.(Ct),j({type:"onDragPending",event:Ct})},onStart(He){const ft=F.current;if(ft==null)return;const tt=C.get(ft);if(!tt)return;const{onDragStart:lt}=z.current,Dt={activatorEvent:qe,active:{id:ft,data:tt.data,rect:T}};ps.unstable_batchedUpdates(()=>{lt?.(Dt),w(fs.Initializing),b({type:Xe.DragStart,initialCoordinates:He,active:ft}),j({type:"onDragStart",event:Dt}),U(zt.current),O(qe)})},onMove(He){b({type:Xe.DragMove,coordinates:He})},onEnd:Tt(Xe.DragEnd),onCancel:Tt(Xe.DragCancel)});zt.current=We;function Tt(He){return async function(){const{active:tt,collisions:lt,over:Dt,scrollAdjustedTranslate:Ft}=be.current;let Ct=null;if(tt&&Ft){const{cancelDrop:kt}=z.current;Ct={activatorEvent:qe,active:tt,collisions:lt,delta:Ft,over:Dt},He===Xe.DragEnd&&typeof kt=="function"&&await Promise.resolve(kt(Ct))&&(He=Xe.DragCancel)}F.current=null,ps.unstable_batchedUpdates(()=>{b({type:He}),w(fs.Uninitialized),Ke(null),U(null),O(null),zt.current=null;const kt=He===Xe.DragEnd?"onDragEnd":"onDragCancel";if(Ct){const ys=z.current[kt];ys?.(Ct),j({type:kt,event:Ct})}})}}},[C]),Vt=g.useCallback((Ue,ie)=>(ce,pe)=>{const Ee=ce.nativeEvent,qe=C.get(pe);if(F.current!==null||!qe||Ee.dndKit||Ee.defaultPrevented)return;const We={active:qe};Ue(ce,ie.options,We)===!0&&(Ee.dndKit={capturedBy:ie.sensor},F.current=pe,It(ce,ie))},[C,It]),St=ku(u,Vt);Du(u),Wt(()=>{se&&N===fs.Initializing&&w(fs.Initialized)},[se,N]),g.useEffect(()=>{const{onDragMove:Ue}=z.current,{active:ie,activatorEvent:ce,collisions:pe,over:Ee}=be.current;if(!ie||!ce)return;const qe={active:ie,activatorEvent:ce,collisions:pe,delta:{x:X.x,y:X.y},over:Ee};ps.unstable_batchedUpdates(()=>{Ue?.(qe),j({type:"onDragMove",event:qe})})},[X.x,X.y]),g.useEffect(()=>{const{active:Ue,activatorEvent:ie,collisions:ce,droppableContainers:pe,scrollAdjustedTranslate:Ee}=be.current;if(!Ue||F.current==null||!ie||!Ee)return;const{onDragOver:qe}=z.current,We=pe.get(Ce),Tt=We&&We.rect.current?{id:We.id,rect:We.rect.current,data:We.data,disabled:We.disabled}:null,He={active:Ue,activatorEvent:ie,collisions:ce,delta:{x:Ee.x,y:Ee.y},over:Tt};ps.unstable_batchedUpdates(()=>{Ke(Tt),qe?.(He),j({type:"onDragOver",event:He})})},[Ce]),Wt(()=>{be.current={activatorEvent:B,active:D,activeNode:_,collisionRect:ae,collisions:ge,droppableRects:H,draggableNodes:C,draggingNode:W,draggingNodeRect:K,droppableContainers:R,over:Be,scrollableAncestors:ee,scrollAdjustedTranslate:X},T.current={initial:K,translated:ae}},[D,_,ge,ae,C,W,K,H,R,Be,ee,X]),bu({...re,delta:P,draggingRect:ae,pointerCoordinates:Y,scrollableAncestors:ee,scrollableAncestorRects:oe});const Bt=g.useMemo(()=>({active:D,activeNode:_,activeNodeRect:se,activatorEvent:B,collisions:ge,containerNodeRect:ke,dragOverlay:te,draggableNodes:C,droppableContainers:R,droppableRects:H,over:Be,measureDroppableContainers:L,scrollableAncestors:ee,scrollableAncestorRects:oe,measuringConfiguration:I,measuringScheduled:A,windowRect:Fe}),[D,_,se,B,ge,ke,te,C,R,H,Be,L,ee,oe,I,A,Fe]),es=g.useMemo(()=>({activatorEvent:B,activators:St,active:D,activeNodeRect:se,ariaDescribedById:{draggable:q},dispatch:b,draggableNodes:C,over:Be,measureDroppableContainers:L}),[B,St,D,se,b,q,C,Be,L]);return V.createElement(Wl.Provider,{value:y},V.createElement(fr.Provider,{value:es},V.createElement(sa.Provider,{value:Bt},V.createElement(Qr.Provider,{value:nt},d)),V.createElement(qu,{disabled:i?.restoreFocus===!1})),V.createElement(Vd,{...i,hiddenTextDescribedById:q}));function Ot(){const Ue=$?.autoScrollEnabled===!1,ie=typeof c=="object"?c.enabled===!1:c===!1,ce=S&&!Ue&&!ie;return typeof c=="object"?{...c,enabled:ce}:{enabled:ce}}}),_u=g.createContext(null),An="button",Vu="Draggable";function Bu(t){let{id:s,data:r,disabled:l=!1,attributes:n}=t;const o=mr(Vu),{activators:a,activatorEvent:i,active:c,activeNodeRect:d,ariaDescribedById:u,draggableNodes:m,over:p}=g.useContext(fr),{role:x=An,roleDescription:f="draggable",tabIndex:v=0}=n??{},h=c?.id===s,b=g.useContext(h?Qr:_u),[j,y]=Pr(),[N,w]=Pr(),S=Fu(a,s),k=rr(r);Wt(()=>(m.set(s,{id:s,key:o,node:j,activatorNode:N,data:k}),()=>{const P=m.get(s);P&&P.key===o&&m.delete(s)}),[m,s]);const C=g.useMemo(()=>({role:x,tabIndex:v,"aria-disabled":l,"aria-pressed":h&&x===An?!0:void 0,"aria-roledescription":f,"aria-describedby":u.draggable}),[l,x,v,h,f,u.draggable]);return{active:c,activatorEvent:i,activeNodeRect:d,attributes:C,isDragging:h,listeners:l?void 0:S,node:j,over:p,setNodeRef:y,setActivatorNodeRef:w,transform:b}}function oa(){return g.useContext(sa)}const Hu="Droppable",Gu={timeout:25};function Ju(t){let{data:s,disabled:r=!1,id:l,resizeObserverConfig:n}=t;const o=mr(Hu),{active:a,dispatch:i,over:c,measureDroppableContainers:d}=g.useContext(fr),u=g.useRef({disabled:r}),m=g.useRef(!1),p=g.useRef(null),x=g.useRef(null),{disabled:f,updateMeasurementsFor:v,timeout:h}={...Gu,...n},b=rr(v??l),j=g.useCallback(()=>{if(!m.current){m.current=!0;return}x.current!=null&&clearTimeout(x.current),x.current=setTimeout(()=>{d(Array.isArray(b.current)?b.current:[b.current]),x.current=null},h)},[h]),y=Xr({callback:j,disabled:f||!a}),N=g.useCallback((C,P)=>{y&&(P&&(y.unobserve(P),m.current=!1),C&&y.observe(C))},[y]),[w,S]=Pr(N),k=rr(s);return g.useEffect(()=>{!y||!w.current||(y.disconnect(),m.current=!1,y.observe(w.current))},[w,y]),g.useEffect(()=>(i({type:Xe.RegisterDroppable,element:{id:l,key:o,disabled:r,node:w,rect:p,data:k}}),()=>i({type:Xe.UnregisterDroppable,key:o,id:l})),[l]),g.useEffect(()=>{r!==u.current.disabled&&(i({type:Xe.SetDroppableDisabled,id:l,key:o,disabled:r}),u.current.disabled=r)},[l,o,r,i]),{active:a,rect:p,isOver:c?.id===l,node:w,over:c,setNodeRef:S}}function Ku(t){let{animation:s,children:r}=t;const[l,n]=g.useState(null),[o,a]=g.useState(null),i=Mr(r);return!r&&!l&&i&&n(i),Wt(()=>{if(!o)return;const c=l?.key,d=l?.props.id;if(c==null||d==null){n(null);return}Promise.resolve(s(d,o)).then(()=>{n(null)})},[s,l,o]),V.createElement(V.Fragment,null,r,l?g.cloneElement(l,{ref:a}):null)}const Yu={x:0,y:0,scaleX:1,scaleY:1};function Xu(t){let{children:s}=t;return V.createElement(fr.Provider,{value:ta},V.createElement(Qr.Provider,{value:Yu},s))}const Qu={position:"fixed",touchAction:"none"},Zu=t=>Kr(t)?"transform 250ms ease":void 0,em=g.forwardRef((t,s)=>{let{as:r,activatorEvent:l,adjustScale:n,children:o,className:a,rect:i,style:c,transform:d,transition:u=Zu}=t;if(!i)return null;const m=n?d:{...d,scaleX:1,scaleY:1},p={...Qu,width:i.width,height:i.height,top:i.top,left:i.left,transform:Zt.Transform.toString(m),transformOrigin:n&&l?Hd(l,i):void 0,transition:typeof u=="function"?u(l):u,...c};return V.createElement(r,{className:a,style:p,ref:s},o)}),tm=t=>s=>{let{active:r,dragOverlay:l}=s;const n={},{styles:o,className:a}=t;if(o!=null&&o.active)for(const[i,c]of Object.entries(o.active))c!==void 0&&(n[i]=r.node.style.getPropertyValue(i),r.node.style.setProperty(i,c));if(o!=null&&o.dragOverlay)for(const[i,c]of Object.entries(o.dragOverlay))c!==void 0&&l.node.style.setProperty(i,c);return a!=null&&a.active&&r.node.classList.add(a.active),a!=null&&a.dragOverlay&&l.node.classList.add(a.dragOverlay),function(){for(const[c,d]of Object.entries(n))r.node.style.setProperty(c,d);a!=null&&a.active&&r.node.classList.remove(a.active)}},sm=t=>{let{transform:{initial:s,final:r}}=t;return[{transform:Zt.Transform.toString(s)},{transform:Zt.Transform.toString(r)}]},rm={duration:250,easing:"ease",keyframes:sm,sideEffects:tm({styles:{active:{opacity:"0"}}})};function om(t){let{config:s,draggableNodes:r,droppableContainers:l,measuringConfiguration:n}=t;return Jr((o,a)=>{if(s===null)return;const i=r.get(o);if(!i)return;const c=i.node.current;if(!c)return;const d=ea(a);if(!d)return;const{transform:u}=jt(a).getComputedStyle(a),m=Vl(u);if(!m)return;const p=typeof s=="function"?s:nm(s);return Xl(c,n.draggable.measure),p({active:{id:o,data:i.data,node:c,rect:n.draggable.measure(c)},draggableNodes:r,dragOverlay:{node:a,rect:n.dragOverlay.measure(d)},droppableContainers:l,measuringConfiguration:n,transform:m})})}function nm(t){const{duration:s,easing:r,sideEffects:l,keyframes:n}={...rm,...t};return o=>{let{active:a,dragOverlay:i,transform:c,...d}=o;if(!s)return;const u={x:i.rect.left-a.rect.left,y:i.rect.top-a.rect.top},m={scaleX:c.scaleX!==1?a.rect.width*c.scaleX/i.rect.width:1,scaleY:c.scaleY!==1?a.rect.height*c.scaleY/i.rect.height:1},p={x:c.x-u.x,y:c.y-u.y,...m},x=n({...d,active:a,dragOverlay:i,transform:{initial:c,final:p}}),[f]=x,v=x[x.length-1];if(JSON.stringify(f)===JSON.stringify(v))return;const h=l?.({active:a,dragOverlay:i,...d}),b=i.node.animate(x,{duration:s,easing:r,fill:"forwards"});return new Promise(j=>{b.onfinish=()=>{h?.(),j()}})}}let Ln=0;function lm(t){return g.useMemo(()=>{if(t!=null)return Ln++,Ln},[t])}const nn=V.memo(t=>{let{adjustScale:s=!1,children:r,dropAnimation:l,style:n,transition:o,modifiers:a,wrapperElement:i="div",className:c,zIndex:d=999}=t;const{activatorEvent:u,active:m,activeNodeRect:p,containerNodeRect:x,draggableNodes:f,droppableContainers:v,dragOverlay:h,over:b,measuringConfiguration:j,scrollableAncestors:y,scrollableAncestorRects:N,windowRect:w}=oa(),S=g.useContext(Qr),k=lm(m?.id),C=ra(a,{activatorEvent:u,active:m,activeNodeRect:p,containerNodeRect:x,draggingNodeRect:h.rect,over:b,overlayNodeRect:h.rect,scrollableAncestors:y,scrollableAncestorRects:N,transform:S,windowRect:w}),P=on(p),R=om({config:l,draggableNodes:f,droppableContainers:v,measuringConfiguration:j}),M=P?h.setRef:void 0;return V.createElement(Xu,null,V.createElement(Ku,{animation:R},m&&k?V.createElement(em,{key:k,id:m.id,ref:M,as:i,activatorEvent:u,adjustScale:s,className:c,transition:o,rect:P,style:{zIndex:d,...n},transform:C},r):null))}),$o=t=>{let{transform:s}=t;return{...s,x:0}};function Ss(t,s,r){const l=t.slice();return l.splice(r<0?l.length+r:r,0,l.splice(s,1)[0]),l}function am(t,s){return t.reduce((r,l,n)=>{const o=s.get(l);return o&&(r[n]=o),r},Array(t.length))}function hr(t){return t!==null&&t>=0}function cm(t,s){if(t===s)return!0;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==s[r])return!1;return!0}function im(t){return typeof t=="boolean"?{draggable:t,droppable:t}:t}const ln=t=>{let{rects:s,activeIndex:r,overIndex:l,index:n}=t;const o=Ss(s,l,r),a=s[n],i=o[n];return!i||!a?null:{x:i.left-a.left,y:i.top-a.top,scaleX:i.width/a.width,scaleY:i.height/a.height}},gr={scaleX:1,scaleY:1},Lr=t=>{var s;let{activeIndex:r,activeNodeRect:l,index:n,rects:o,overIndex:a}=t;const i=(s=o[r])!=null?s:l;if(!i)return null;if(n===r){const d=o[a];return d?{x:0,y:r<a?d.top+d.height-(i.top+i.height):d.top-i.top,...gr}:null}const c=dm(o,n,r);return n>r&&n<=a?{x:0,y:-i.height-c,...gr}:n<r&&n>=a?{x:0,y:i.height+c,...gr}:{x:0,y:0,...gr}};function dm(t,s,r){const l=t[s],n=t[s-1],o=t[s+1];return l?r<s?n?l.top-(n.top+n.height):o?o.top-(l.top+l.height):0:o?o.top-(l.top+l.height):n?l.top-(n.top+n.height):0:0}const na="Sortable",la=V.createContext({activeIndex:-1,containerId:na,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:ln,disabled:{draggable:!1,droppable:!1}});function nr(t){let{children:s,id:r,items:l,strategy:n=ln,disabled:o=!1}=t;const{active:a,dragOverlay:i,droppableRects:c,over:d,measureDroppableContainers:u}=oa(),m=mr(na,r),p=i.rect!==null,x=g.useMemo(()=>l.map(S=>typeof S=="object"&&"id"in S?S.id:S),[l]),f=a!=null,v=a?x.indexOf(a.id):-1,h=d?x.indexOf(d.id):-1,b=g.useRef(x),j=!cm(x,b.current),y=h!==-1&&v===-1||j,N=im(o);Wt(()=>{j&&f&&u(x)},[j,x,f,u]),g.useEffect(()=>{b.current=x},[x]);const w=g.useMemo(()=>({activeIndex:v,containerId:m,disabled:N,disableTransforms:y,items:x,overIndex:h,useDragOverlay:p,sortedRects:am(x,c),strategy:n}),[v,m,N.draggable,N.droppable,y,x,h,c,p,n]);return V.createElement(la.Provider,{value:w},s)}const um=t=>{let{id:s,items:r,activeIndex:l,overIndex:n}=t;return Ss(r,l,n).indexOf(s)},mm=t=>{let{containerId:s,isSorting:r,wasDragging:l,index:n,items:o,newIndex:a,previousItems:i,previousContainerId:c,transition:d}=t;return!d||!l||i!==o&&n===a?!1:r?!0:a!==n&&s===c},xm={duration:200,easing:"ease"},aa="transform",fm=Zt.Transition.toString({property:aa,duration:0,easing:"linear"}),pm={roleDescription:"sortable"};function hm(t){let{disabled:s,index:r,node:l,rect:n}=t;const[o,a]=g.useState(null),i=g.useRef(r);return Wt(()=>{if(!s&&r!==i.current&&l.current){const c=n.current;if(c){const d=Us(l.current,{ignoreTransform:!0}),u={x:c.left-d.left,y:c.top-d.top,scaleX:c.width/d.width,scaleY:c.height/d.height};(u.x||u.y)&&a(u)}}r!==i.current&&(i.current=r)},[s,r,l,n]),g.useEffect(()=>{o&&a(null)},[o]),o}function an(t){let{animateLayoutChanges:s=mm,attributes:r,disabled:l,data:n,getNewIndex:o=um,id:a,strategy:i,resizeObserverConfig:c,transition:d=xm}=t;const{items:u,containerId:m,activeIndex:p,disabled:x,disableTransforms:f,sortedRects:v,overIndex:h,useDragOverlay:b,strategy:j}=g.useContext(la),y=gm(l,x),N=u.indexOf(a),w=g.useMemo(()=>({sortable:{containerId:m,index:N,items:u},...n}),[m,n,N,u]),S=g.useMemo(()=>u.slice(u.indexOf(a)),[u,a]),{rect:k,node:C,isOver:P,setNodeRef:R}=Ju({id:a,data:w,disabled:y.droppable,resizeObserverConfig:{updateMeasurementsFor:S,...c}}),{active:M,activatorEvent:T,activeNodeRect:D,attributes:F,setNodeRef:$,listeners:U,isDragging:B,over:O,setActivatorNodeRef:z,transform:q}=Bu({id:a,data:w,attributes:{...pm,...r},disabled:y.draggable}),E=Dd(R,$),I=!!M,H=I&&!f&&hr(p)&&hr(h),L=!b&&B,A=L&&H?q:null,J=H?A??(i??j)({rects:v,activeNodeRect:D,activeIndex:p,overIndex:h,index:N}):null,re=hr(p)&&hr(h)?o({id:a,items:u,activeIndex:p,overIndex:h}):N,de=M?.id,se=g.useRef({activeId:de,items:u,newIndex:re,containerId:m}),ke=u!==se.current.items,be=s({active:M,containerId:m,isDragging:B,isSorting:I,id:a,index:N,items:u,newIndex:se.current.newIndex,previousItems:se.current.items,previousContainerId:se.current.containerId,transition:d,wasDragging:se.current.activeId!=null}),he=hm({disabled:!be,index:N,node:C,rect:k});return g.useEffect(()=>{I&&se.current.newIndex!==re&&(se.current.newIndex=re),m!==se.current.containerId&&(se.current.containerId=m),u!==se.current.items&&(se.current.items=u)},[I,re,m,u]),g.useEffect(()=>{if(de===se.current.activeId)return;if(de!=null&&se.current.activeId==null){se.current.activeId=de;return}const W=setTimeout(()=>{se.current.activeId=de},50);return()=>clearTimeout(W)},[de]),{active:M,activeIndex:p,attributes:F,data:w,rect:k,index:N,newIndex:re,items:u,isOver:P,isSorting:I,isDragging:B,listeners:U,node:C,overIndex:h,over:O,setNodeRef:E,setActivatorNodeRef:z,setDroppableNodeRef:R,setDraggableNodeRef:$,transform:he??J,transition:te()};function te(){if(he||ke&&se.current.newIndex===N)return fm;if(!(L&&!Kr(T)||!d)&&(I||be))return Zt.Transition.toString({...d,property:aa})}}function gm(t,s){var r,l;return typeof t=="boolean"?{draggable:t,droppable:!1}:{draggable:(r=t?.draggable)!=null?r:s.draggable,droppable:(l=t?.droppable)!=null?l:s.droppable}}Ie.Down,Ie.Right,Ie.Up,Ie.Left;const $r=({preset:t,listName:s,theme:r,language:l,onLoad:n,rightAdornment:o,onAfterSelect:a})=>{const{attributes:i,listeners:c,setNodeRef:d,transform:u,transition:m,isDragging:p}=an({id:t.id,data:{containerId:s}}),x={transform:Zt.Transform.toString(u),transition:m,opacity:p?.6:void 0};return e.jsx("div",{ref:d,style:x,children:e.jsxs("button",{"data-preset-id":t.id,onClick:()=>{n(t.id),a&&a()},className:`relative w-full p-2 pr-8 rounded-lg border transition-all duration-200 text-left flex items-center ${p?"opacity-60":"hover:shadow-sm"}`,style:{backgroundColor:r.colors.surface+"50",borderColor:r.colors.border,color:r.colors.text},children:[e.jsx("span",{className:"text-lg",children:t.emoji||"âš™ï¸"}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",children:t.name}),e.jsx("div",{className:"text-xs opacity-75 truncate",children:[t.formData.symbol,t.formData.timeframe,t.formData.strategy].filter(Boolean).join(" â€¢ ")||"â€”"})]}),o,e.jsx("div",{className:"w-5 flex-shrink-0 flex items-center justify-center absolute right-2 top-1/2 -translate-y-1/2 z-10",children:e.jsx("span",{className:"text-xs select-none",style:{color:r.colors.textMuted,cursor:"grab"},...i,...c,title:l==="fr"?"Glisser pour rÃ©organiser":"Drag to reorder",children:"â‹®â‹®"})})]})})};function ym(t,s){const[r,l]=g.useState(null),n=en(or(xr,{activationConstraint:{delay:150,tolerance:5}}),or(Yr)),o=g.useMemo(()=>t.filter(p=>p.isFavorite).sort((p,x)=>(p.sortIndex??0)-(x.sortIndex??0)),[t]),a=g.useMemo(()=>t.filter(p=>p.lastUsed&&!p.isFavorite).sort((p,x)=>(p.sortIndex??0)-(x.sortIndex??0)),[t]),i=g.useMemo(()=>t.filter(p=>!p.isFavorite&&!p.lastUsed).sort((p,x)=>(p.sortIndex??0)-(x.sortIndex??0)),[t]),c=g.useMemo(()=>[...a,...i],[a,i]);return{sensors:n,activeId:r,favoritePresets:o,recentPresets:a,otherPresets:i,getPresetById:p=>t.find(x=>x.id===p),handleDragStart:p=>{l(p.active.id)},handleDragEnd:p=>{const{active:x,over:f}=p;if(l(null),!f||x.id===f.id||!s)return;const v=x.data.current?.containerId,h=f.data.current?.containerId;if(!v||!h||v!==h)return;let b=o.map(N=>N.id),j=c.map(N=>N.id);if(v==="favorites"){const N=b.indexOf(x.id),w=b.indexOf(f.id);N!==-1&&w!==-1&&(b=Ss(b,N,w))}if(v==="others"){const N=j.indexOf(x.id),w=j.indexOf(f.id);N!==-1&&w!==-1&&(j=Ss(j,N,w))}const y=[...b,...j];s(y)}}}const bm=({favoritePresets:t,recentPresets:s,otherPresets:r,theme:l,language:n,onLoadPreset:o,onCloseDropdown:a})=>{const i=l.colors.textSecondary,c=l.colors.textMuted;return e.jsxs("div",{className:"flex",style:{maxHeight:"600px"},children:[e.jsx("div",{className:"flex-1 border-r",style:{borderColor:l.colors.border},children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(ot,{size:14,className:"mr-2",style:{color:"#F59E0B"}}),e.jsxs("span",{className:"text-xs font-semibold",style:{color:i},children:[n==="fr"?"Favoris":"Favorites"," (",t.length,")"]})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:e.jsx(nr,{items:t.map(d=>d.id),strategy:Lr,children:t.map(d=>e.jsx($r,{preset:d,listName:"favorites",onLoad:o,rightAdornment:e.jsx(ot,{size:12,className:"ml-2",style:{color:"#F59E0B"}}),theme:l,language:n,onAfterSelect:a},d.id))})})]})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(ms,{size:14,className:"mr-2",style:{color:c}}),e.jsxs("span",{className:"text-xs font-semibold",style:{color:i},children:[n==="fr"?"Autres":"Others"," (",s.length+r.length,")"]})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:(()=>{const d=new Set(s.map(m=>m.id)),u=[...s,...r];return e.jsx(nr,{items:u.map(m=>m.id),strategy:Lr,children:u.map(m=>e.jsx($r,{preset:m,listName:"others",onLoad:o,rightAdornment:d.has(m.id)?e.jsx(ze,{size:12,className:"ml-2 pointer-events-none",style:{color:"#10B981"}}):void 0,theme:l,language:n,onAfterSelect:a},m.id))})})()})]})})]})},ca=({formData:t,presets:s,onLoadPreset:r,onSavePreset:l,onDeletePreset:n,onToggleFavorite:o,onManagePresets:a,onReorderPresets:i})=>{const{currentTheme:c}=Q(),{currentLanguage:d}=Z(),[u,m]=g.useState(!1),[p,x]=g.useState(!1),[f,v]=g.useState("bottom"),h=g.useRef(null),b=g.useRef();g.useEffect(()=>{const F=$=>{h.current&&!h.current.contains($.target)&&m(!1)};return document.addEventListener("mousedown",F),()=>document.removeEventListener("mousedown",F)},[]);const j=()=>{b.current&&clearTimeout(b.current);const F=h.current?.querySelector("button")?.getBoundingClientRect();if(F){const $=window.innerHeight-F.bottom,U=F.top;v($<400&&U>$?"top":"bottom")}m(!0)},y=()=>{b.current=setTimeout(()=>{m(!1)},200)},N=()=>{const F=[];return t.strategy&&F.push(t.strategy),t.symbol&&F.push(t.symbol),t.timeframe&&F.push(t.timeframe),F.length===0?d==="fr"?"Nouveau Preset":"New Preset":F.join(" ")},w=F=>{if(F.stopPropagation(),F.shiftKey){const $=N();l($,t,!1),m(!1);return}x(!0),m(!1)},{sensors:S,activeId:k,favoritePresets:C,recentPresets:P,otherPresets:R,getPresetById:M,handleDragStart:T,handleDragEnd:D}=ym(s,i);return e.jsxs("div",{className:"relative",ref:h,children:[e.jsxs("button",{onMouseEnter:j,onMouseLeave:y,className:"flex items-center px-3 py-2 rounded-lg transition-all duration-200 hover:shadow-md",style:{backgroundColor:u?c.colors.accent+"20":c.colors.surface,color:u?c.colors.accent:c.colors.text,border:`1px solid ${c.colors.border}`},children:[e.jsx(Rt,{size:16,className:"mr-2"}),e.jsx("span",{className:"font-medium",children:"Presets"}),e.jsx($e,{size:14,className:`ml-2 transition-transform duration-200 ${u?"rotate-180":""}`})]}),u&&e.jsxs("div",{onMouseEnter:j,onMouseLeave:y,className:`absolute left-1/2 -translate-x-1/2 transform w-[48rem] rounded-xl shadow-2xl border z-50 overflow-hidden ${f==="top"?"bottom-full mb-2":"top-full mt-2"}`,style:{backgroundColor:c.colors.card,borderColor:c.colors.accent+"60",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",minHeight:"59vh",maxHeight:"none",overflowY:"auto"},children:[e.jsx("div",{className:"px-3 py-2 border-b",style:{borderColor:c.colors.border,background:`linear-gradient(135deg, ${c.colors.surface} 0%, ${c.colors.card} 100%)`},children:e.jsx("h3",{className:"font-bold text-sm",style:{color:c.colors.text},children:"Presets"})}),C.length>0&&(P.length>0||R.length>0)?e.jsx(Ar,{sensors:S,collisionDetection:Fr,modifiers:[$o],onDragStart:T,onDragEnd:D,children:e.jsx(bm,{favoritePresets:C,recentPresets:P,otherPresets:R,theme:c,language:d,onLoadPreset:r,onCloseDropdown:()=>m(!1)})}):e.jsxs(Ar,{sensors:S,collisionDetection:Fr,modifiers:[$o],onDragStart:T,onDragEnd:D,children:[e.jsx("div",{className:"p-3",style:{maxHeight:"600px"},children:e.jsxs("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:[C.map(F=>e.jsx($r,{preset:F,listName:"favorites",onLoad:r,rightAdornment:e.jsx(ot,{size:12,className:"ml-2",style:{color:"#F59E0B"}}),theme:c,language:d,onAfterSelect:()=>m(!1)},F.id)),P.map(F=>e.jsxs("button",{"data-preset-id":F.id,onClick:()=>{r(F.id),m(!1)},className:"relative w-full p-2 pr-8 rounded-lg border transition-all duration-200 text-left flex items-center hover:shadow-sm",style:{backgroundColor:c.colors.surface+"50",borderColor:c.colors.border,color:c.colors.text},children:[e.jsx("span",{className:"text-lg",children:F.emoji||"âš™ï¸"}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",children:F.name}),e.jsx("div",{className:"text-xs opacity-75 truncate",children:[F.formData.symbol,F.formData.timeframe,F.formData.strategy].filter(Boolean).join(" â€¢ ")||"â€”"})]}),e.jsx(ze,{size:12,className:"ml-2 relative z-0 pointer-events-none",style:{color:"#10B981"}})]},F.id)),R.map(F=>e.jsx($r,{preset:F,listName:"others",onLoad:r,theme:c,language:d,onAfterSelect:()=>m(!1)},F.id))]})}),ps.createPortal(e.jsx(nn,{adjustScale:!1,dropAnimation:null,children:k?(()=>{const F=M(k);return F?e.jsxs("div",{className:"p-2 rounded-lg border text-left flex items-center",style:{backgroundColor:c.colors.surface+"70",borderColor:c.colors.border,color:c.colors.text,pointerEvents:"none",boxShadow:"0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1)"},children:[e.jsx("span",{className:"text-lg",children:F.emoji||"âš™ï¸"}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",children:F.name}),e.jsx("div",{className:"text-xs opacity-75 truncate",children:[F.formData.symbol,F.formData.timeframe,F.formData.strategy].filter(Boolean).join(" â€¢ ")||"â€”"})]})]}):null})():null}),document.body)]}),s.length===0&&e.jsxs("div",{className:"p-6 text-center",style:{color:c.colors.textMuted},children:[e.jsx(Rt,{size:24,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:d==="fr"?"Aucun preset sauvegardÃ©":"No presets saved"})]}),e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("button",{onClick:w,className:"w-full flex items-center justify-between px-2 py-1.5 rounded-lg transition-all duration-200 hover:shadow-md text-sm",style:{backgroundColor:c.colors.accent+"20",color:c.colors.accent,border:`1px solid ${c.colors.accent}40`},children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Rt,{size:14,className:"mr-1.5"}),e.jsx("span",{className:"font-medium",children:d==="fr"?"ðŸ’¾ Sauvegarder":"ðŸ’¾ Save"})]}),e.jsx("span",{className:"text-xs opacity-75 text-white",children:d==="fr"?'Shift + clic "Sauvegarder" pour une sauvegarde rapide':'Shift + click "Save" for quick save'})]}),e.jsxs("button",{onClick:()=>{a(),m(!1)},className:"w-full flex items-center px-2 py-1.5 rounded-lg transition-all duration-200 hover:shadow-sm text-sm",style:{backgroundColor:c.colors.surface,color:c.colors.text,border:`1px solid ${c.colors.border}`},children:[e.jsx(ms,{size:14,className:"mr-1.5"}),e.jsx("span",{children:d==="fr"?"âš™ï¸ GÃ©rer":"âš™ï¸ Manage"})]})]})]}),p&&e.jsx(Td,{initialName:N(),onSave:(F,$)=>{l(F,t,$),x(!1)},onClose:()=>x(!1),existingNames:s.map(F=>F.name)})]})},vm=({isOpen:t,preset:s,onSave:r,onClose:l})=>{const{currentTheme:n}=Q(),{currentLanguage:o}=Z(),[a,i]=g.useState({name:"",emoji:""}),[c,d]=g.useState(!1),u=["ðŸ“ˆ","ðŸ“‰","ðŸ“Š","ðŸ’¹","âš¡","ðŸ”","ðŸŽ¯","ðŸ”„","âš™ï¸","ðŸŒŠ","ðŸ””","ðŸ’°"],m=["ðŸš€","ðŸ’Ž","ðŸ”¥","â­","ðŸ’ª","ðŸŽ²","ðŸ†","ðŸŒŸ","ðŸ’¡","âš”ï¸","ðŸŽ¨","ðŸŽ­","ðŸŽ¸","ðŸŽ¹","ðŸŽº","ðŸŽ»","ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰","ðŸ…","ðŸŽ–ï¸"];g.useEffect(()=>{s&&i({name:s.name,emoji:s.emoji||""})},[s]),g.useEffect(()=>{const f=v=>{if(c){const h=v.target,b=document.querySelector("[data-emoji-menu]");b&&!b.contains(h)&&d(!1)}};return c&&document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[c]);const p=f=>{f.preventDefault(),s&&a.name.trim()&&(r(s.id,{name:a.name.trim(),emoji:a.emoji}),l())},x=()=>{d(!1),l()};return!t||!s?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"w-full max-w-lg rounded-xl shadow-2xl border overflow-hidden",style:{backgroundColor:n.colors.card,borderColor:n.colors.border,minHeight:"400px"},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",style:{borderColor:n.colors.border},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-xl",children:a.emoji}),e.jsx("h2",{className:"text-lg font-bold",style:{color:n.colors.text},children:o==="fr"?"Modifier le Preset":"Edit Preset"})]}),e.jsx("button",{onClick:x,className:"p-1 rounded-full hover:bg-opacity-10 hover:bg-black transition-colors",style:{color:n.colors.textMuted},children:e.jsx(Ne,{size:20})})]}),e.jsxs("form",{onSubmit:p,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",style:{color:n.colors.textSecondary},children:[o==="fr"?"Nom":"Name"," *"]}),e.jsx("input",{type:"text",value:a.name,onChange:f=>i(v=>({...v,name:f.target.value})),placeholder:o==="fr"?"Nom du preset...":"Preset name...",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:n.colors.surface,borderColor:n.colors.border,color:n.colors.text},autoFocus:!0,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:n.colors.textSecondary},children:"Emoji"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"text",value:a.emoji,onChange:f=>i(v=>({...v,emoji:f.target.value})),placeholder:"Ex:ðŸš€",className:"w-20 px-2 py-3 border rounded-lg text-center text-2xl focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:n.colors.surface,borderColor:n.colors.border,color:n.colors.text},maxLength:4}),e.jsx("div",{className:"flex-1 flex items-center",children:e.jsxs("div",{className:"flex flex-wrap gap-2 relative",children:[u.map(f=>e.jsx("button",{type:"button",onClick:v=>{v.stopPropagation(),v.preventDefault(),i(h=>({...h,emoji:f})),d(!1)},className:`w-8 h-8 flex items-center justify-center rounded-lg text-xl transition-all ${a.emoji===f?"ring-2":""}`,style:{backgroundColor:a.emoji===f?`${n.colors.accent}20`:n.colors.surface,borderColor:a.emoji===f?n.colors.accent:n.colors.border},children:f},f)),e.jsx("button",{type:"button",onClick:f=>{f.stopPropagation(),f.preventDefault(),d(!c)},className:"w-8 h-8 flex items-center justify-center rounded-lg text-sm font-bold transition-all hover:scale-110",style:{backgroundColor:n.colors.surface,borderColor:n.colors.border,color:n.colors.text},title:o==="fr"?"Plus d'emojis":"More emojis",children:"+"}),c&&e.jsx("div",{"data-emoji-menu":!0,className:"absolute top-10 left-0 z-50 p-3 rounded-lg shadow-lg border max-h-48 overflow-y-auto",style:{backgroundColor:n.colors.card,borderColor:n.colors.border,minWidth:"200px"},children:e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(f=>e.jsx("button",{type:"button",onClick:v=>{v.stopPropagation(),v.preventDefault(),i(h=>({...h,emoji:f})),d(!1)},className:`w-8 h-8 flex items-center justify-center rounded-lg text-xl transition-all hover:scale-110 ${a.emoji===f?"ring-2":""}`,style:{backgroundColor:a.emoji===f?`${n.colors.accent}20`:n.colors.surface,borderColor:a.emoji===f?n.colors.accent:n.colors.border},children:f},f))})})]})})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 rounded-lg border transition-colors",style:{backgroundColor:n.colors.surface,borderColor:n.colors.border,color:n.colors.text},children:o==="fr"?"Annuler":"Cancel"}),e.jsxs("button",{type:"submit",className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:n.colors.accent,color:"#ffffff"},disabled:!a.name.trim(),children:[e.jsx(Rt,{size:16}),e.jsx("span",{children:o==="fr"?"Sauvegarder":"Save"})]})]})]})]})})},jm=({currentTheme:t,currentLanguage:s,searchQuery:r,setSearchQuery:l,filterType:n,setFilterType:o,selectedCategory:a,setSelectedCategory:i,categories:c,showCategoryFilter:d=!0})=>e.jsxs("div",{className:"p-6 border-b space-y-4",style:{borderColor:t.colors.border},children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(vt,{size:20,className:"absolute left-3 top-1/2 transform -translate-y-1/2",style:{color:t.colors.textMuted}}),e.jsx("input",{type:"text",placeholder:s==="fr"?"Rechercher des presets...":"Search presets...",value:r,onChange:u=>l(u.target.value),className:"w-full pl-10 pr-4 py-3 rounded-lg border",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}})]}),e.jsx("div",{className:"flex gap-2",children:[{key:"all",label:s==="fr"?"Tous":"All"},{key:"favorites",label:s==="fr"?"Favoris":"Favorites"},{key:"recent",label:s==="fr"?"RÃ©cents":"Recent"},{key:"category",label:s==="fr"?"CatÃ©gorie":"Category"}].map(u=>e.jsx("button",{onClick:()=>{o(u.key),i("")},className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${n===u.key?"text-white":""}`,style:{backgroundColor:n===u.key?t.colors.accent:t.colors.surface,color:n===u.key?"white":t.colors.text,border:`1px solid ${t.colors.border}`},children:u.label},u.key))})]}),n==="category"&&d&&e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{onClick:()=>i(""),className:`px-3 py-1 rounded-full text-xs ${a===""?"text-white":""}`,style:{backgroundColor:a===""?t.colors.accent:t.colors.surface,color:a===""?"white":t.colors.text,border:`1px solid ${t.colors.border}`},children:s==="fr"?"Toutes":"All"}),c.map(u=>e.jsx("button",{onClick:()=>i(u||""),className:`px-3 py-1 rounded-full text-xs ${a===u?"text-white":""}`,style:{backgroundColor:a===u?t.colors.accent:t.colors.surface,color:a===u?"white":t.colors.text,border:`1px solid ${t.colors.border}`},children:u},u))]})]}),Nm=({activeId:t,getItemById:s,theme:r})=>{const l=t?s(t):void 0;return e.jsx(nn,{adjustScale:!1,dropAnimation:null,children:l?e.jsxs("div",{className:"p-2 rounded-lg border text-left flex items-center",style:{backgroundColor:r.colors.surface+"70",borderColor:r.colors.border,color:r.colors.text,pointerEvents:"none",boxShadow:"0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1)"},children:[e.jsx("span",{className:"text-lg",children:l.emoji||"âš™ï¸"}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",children:l.name}),e.jsx("div",{className:"text-xs opacity-75 truncate",children:l.formData.symbol||l.formData.market||"â€”"})]})]}):null})};function km(t,s){const[r,l]=g.useState(null),n=en(or(xr,{activationConstraint:{delay:150,tolerance:5}}),or(Yr)),o=g.useMemo(()=>t.filter(u=>u.isFavorite).sort((u,m)=>(u.sortIndex??0)-(m.sortIndex??0)),[t]),a=g.useMemo(()=>t.filter(u=>!u.isFavorite).sort((u,m)=>(u.sortIndex??0)-(m.sortIndex??0)),[t]);return{sensors:n,activeId:r,favoritesSorted:o,othersSorted:a,getPresetById:u=>t.find(m=>m.id===u),handleDragStart:u=>{l(u.active.id)},handleDragEnd:u=>{const{active:m,over:p}=u;if(l(null),!p||m.id===p.id||!s)return;const x=m.data.current?.containerId,f=p.data.current?.containerId;if(!x||!f||x!==f)return;let v=o.map(j=>j.id),h=a.map(j=>j.id);if(x==="favorites"){const j=v.indexOf(m.id),y=v.indexOf(p.id);j!==-1&&y!==-1&&(v=Ss(v,j,y))}if(x==="others"){const j=h.indexOf(m.id),y=h.indexOf(p.id);j!==-1&&y!==-1&&(h=Ss(h,j,y))}const b=[...v,...h];s(b)}}}const $n=({preset:t,listName:s,theme:r,language:l})=>{const{attributes:n,listeners:o,setNodeRef:a,transform:i,transition:c,isDragging:d}=an({id:t.id,data:{containerId:s}}),u={transform:Zt.Transform.toString(i),transition:c,opacity:d?.6:void 0};return e.jsxs("div",{ref:a,className:"grid grid-cols-12 gap-4 p-3 rounded-lg border bg-opacity-60",style:{...u,backgroundColor:r.colors.surface+"40",borderColor:r.colors.border,color:r.colors.text},children:[e.jsx("div",{className:"col-span-1 flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:t.emoji||"âš™ï¸"})}),e.jsxs("div",{className:"col-span-7 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:t.name}),e.jsx("div",{className:"text-xs opacity-75 truncate",children:t.formData.symbol||t.formData.market||"â€”"})]}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsx("span",{className:"px-2 py-1 rounded-full text-xs",style:{backgroundColor:r.colors.accent+"20",color:r.colors.accent},children:t.category||"â€”"})}),e.jsx("div",{className:"col-span-2 flex items-center justify-end",children:e.jsx("span",{className:"text-xs select-none",style:{color:r.colors.text,opacity:.6,cursor:"grab"},...n,...o,title:l==="fr"?"Glisser pour rÃ©organiser":"Drag to reorder",children:"â‹®â‹®"})})]})},wm=({favorites:t,others:s,theme:r,language:l})=>e.jsxs("div",{className:"p-6 grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(ot,{size:14,className:"mr-2",style:{color:"#F59E0B"}}),e.jsxs("span",{className:"text-xs font-semibold",style:{color:r.colors.textSecondary},children:[l==="fr"?"Favoris":"Favorites"," (",t.length,")"]})]}),e.jsx("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto",children:e.jsx(nr,{items:t.map(n=>n.id),strategy:Lr,children:t.map(n=>e.jsx($n,{preset:n,listName:"favorites",theme:r,language:l},n.id))})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(cs,{size:14,className:"mr-2",style:{color:r.colors.textMuted}}),e.jsxs("span",{className:"text-xs font-semibold",style:{color:r.colors.textSecondary},children:[l==="fr"?"Autres":"Others"," (",s.length,")"]})]}),e.jsx("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto",children:e.jsx(nr,{items:s.map(n=>n.id),strategy:Lr,children:s.map(n=>e.jsx($n,{preset:n,listName:"others",theme:r,language:l},n.id))})})]})]}),Sm=({currentTheme:t,currentLanguage:s,displayedCount:r,onSelectMostRecent:l,onClose:n,disabledSelectMostRecent:o})=>e.jsx("div",{className:"p-6 border-t",style:{borderColor:t.colors.border},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm",style:{color:t.colors.textMuted},children:s==="fr"?`${r} preset(s) affichÃ©(s)`:`${r} preset(s) displayed`}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:l,className:"px-4 py-2 rounded-lg font-medium transition-colors",style:{backgroundColor:t.colors.surface,color:t.colors.text,border:`1px solid ${t.colors.border}`},disabled:o,children:s==="fr"?"SÃ©lectionner le plus rÃ©cent":"Select most recent"}),e.jsx("button",{onClick:n,className:"px-6 py-2 rounded-lg font-medium transition-colors",style:{backgroundColor:t.colors.accent,color:"white"},children:s==="fr"?"Fermer":"Close"})]})]})}),ia=({presets:t,onClose:s,onDeletePreset:r,onToggleFavorite:l,onUpdatePreset:n,onLoadPreset:o,onReorderPresets:a})=>{const{currentTheme:i}=Q(),{currentLanguage:c}=Z(),[d,u]=g.useState(""),[m,p]=g.useState("updatedAt"),[x,f]=g.useState("desc"),[v,h]=g.useState("all"),[b,j]=g.useState(""),[y,N]=g.useState(null),[w,S]=g.useState(!1),{sensors:k,activeId:C,favoritesSorted:P,othersSorted:R,getPresetById:M,handleDragStart:T,handleDragEnd:D}=km(t,a),F=g.useMemo(()=>{const z=t.map(q=>q.category).filter(q=>!!q);return[...new Set(z)]},[t]),$=g.useMemo(()=>{let z=t;switch(v){case"favorites":z=z.filter(q=>q.isFavorite);break;case"recent":z=z.filter(q=>q.lastUsed).sort((q,E)=>new Date(E.lastUsed).getTime()-new Date(q.lastUsed).getTime()).slice(0,10);break;case"category":b&&(z=z.filter(q=>q.category===b));break}if(d.trim()){const q=d.toLowerCase();z=z.filter(E=>E.name.toLowerCase().includes(q)||E.category?.toLowerCase().includes(q)||E.tags?.some(I=>I.toLowerCase().includes(q))||E.formData.symbol?.toLowerCase().includes(q)||E.formData.strategy?.toLowerCase().includes(q))}return z.sort((q,E)=>{let I,H;switch(m){case"name":I=q.name.toLowerCase(),H=E.name.toLowerCase();break;case"createdAt":I=new Date(q.createdAt).getTime(),H=new Date(E.createdAt).getTime();break;case"updatedAt":I=new Date(q.updatedAt).getTime(),H=new Date(E.updatedAt).getTime();break;case"lastUsed":I=q.lastUsed?new Date(q.lastUsed).getTime():0,H=E.lastUsed?new Date(E.lastUsed).getTime():0;break;case"usageCount":I=q.usageCount||0,H=E.usageCount||0;break;default:I=q.name.toLowerCase(),H=E.name.toLowerCase()}return x==="asc"?I>H?1:-1:I<H?1:-1}),z},[t,d,m,x,v,b]),U=z=>{N(z)},B=z=>{m===z?f(x==="asc"?"desc":"asc"):(p(z),f("asc"))},O=g.useMemo(()=>{const z=t.length,q=t.filter(H=>H.isFavorite).length,E=t.filter(H=>H.lastUsed).length,I=[...new Set(t.map(H=>H.category).filter(Boolean))].length;return{total:z,favorites:q,recentlyUsed:E,categories:I}},[t]);return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"w-full max-w-6xl h-full max-h-[90vh] rounded-2xl shadow-2xl overflow-hidden flex flex-col",style:{backgroundColor:i.colors.card},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",style:{borderColor:i.colors.border},children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:i.colors.text},children:c==="fr"?"Gestion des Presets":"Preset Management"}),e.jsx("p",{className:"text-sm mt-1",style:{color:i.colors.textMuted},children:c==="fr"?`${O.total} presets â€¢ ${O.favorites} favoris â€¢ ${O.recentlyUsed} rÃ©cents`:`${O.total} presets â€¢ ${O.favorites} favorites â€¢ ${O.recentlyUsed} recent`})]}),e.jsx("button",{onClick:s,className:"p-2 rounded-full hover:bg-opacity-10 hover:bg-black transition-colors",style:{color:i.colors.textMuted},children:e.jsx(Ne,{size:24})})]}),e.jsx("div",{className:"p-6 border-b space-y-4",style:{borderColor:i.colors.border},children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>S(z=>!z),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${w?"text-white":""}`,style:{backgroundColor:w?i.colors.accent:i.colors.surface,color:w?"white":i.colors.text,border:`1px solid ${i.colors.border}`},children:w?c==="fr"?"Terminer la rÃ©organisation":"Finish reordering":c==="fr"?"RÃ©organiser":"Reorder"}),e.jsx("div",{className:"flex-1",children:e.jsx(jm,{currentTheme:i,currentLanguage:c,searchQuery:d,setSearchQuery:u,filterType:v,setFilterType:h,selectedCategory:b,setSelectedCategory:j,categories:F,showCategoryFilter:!w})})]})}),e.jsx("div",{className:"px-6 py-3 border-b bg-opacity-50",style:{borderColor:i.colors.border,backgroundColor:i.colors.surface},children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 text-sm font-semibold",children:[e.jsx("div",{className:"col-span-1"}),e.jsxs("button",{onClick:()=>B("name"),className:"col-span-3 flex items-center gap-2 text-left",style:{color:i.colors.textSecondary},children:[c==="fr"?"Nom":"Name",m==="name"&&(x==="asc"?e.jsx(co,{size:14}):e.jsx(ao,{size:14}))]}),e.jsx("div",{className:"col-span-2 flex items-center gap-2 text-left",style:{color:i.colors.textSecondary},children:c==="fr"?"CatÃ©gorie":"Category"}),e.jsxs("button",{onClick:()=>B("updatedAt"),className:"col-span-2 flex items-center gap-2 text-left",style:{color:i.colors.textSecondary},children:[c==="fr"?"ModifiÃ©":"Modified",m==="updatedAt"&&(x==="asc"?e.jsx(co,{size:14}):e.jsx(ao,{size:14}))]}),e.jsxs("button",{onClick:()=>B("usageCount"),className:"col-span-2 flex items-center gap-2 text-left",style:{color:i.colors.textSecondary},children:[c==="fr"?"Utilisations":"Usage",m==="usageCount"&&(x==="asc"?e.jsx(co,{size:14}):e.jsx(ao,{size:14}))]}),e.jsx("div",{className:"col-span-2 text-center",style:{color:i.colors.textSecondary},children:"Actions"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:w?e.jsxs(Ar,{sensors:k,collisionDetection:Fr,modifiers:[$o],onDragStart:T,onDragEnd:D,children:[e.jsx(wm,{favorites:P,others:R,theme:i,language:c}),ps.createPortal(e.jsx(Nm,{activeId:C,getItemById:M,theme:i}),document.body)]}):$.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-8",children:[e.jsx(vt,{size:48,className:"mb-4 opacity-50",style:{color:i.colors.textMuted}}),e.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:i.colors.text},children:c==="fr"?"Aucun preset trouvÃ©":"No presets found"}),e.jsx("p",{style:{color:i.colors.textMuted},children:c==="fr"?"Essayez de modifier vos critÃ¨res de recherche":"Try adjusting your search criteria"})]}):e.jsx("div",{className:"p-6 space-y-2",children:$.map(z=>e.jsxs("div",{className:"grid grid-cols-12 gap-4 p-4 rounded-lg border hover:shadow-md transition-all cursor-pointer",style:{backgroundColor:i.colors.surface+"30",borderColor:i.colors.border},onDoubleClick:()=>{o(z.id),s()},title:c==="fr"?"Double-clic pour sÃ©lectionner":"Double-click to select",children:[e.jsx("div",{className:"col-span-1 flex items-center justify-center",children:e.jsx("span",{className:"text-xl",children:z.emoji||"âš™ï¸"})}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",style:{color:i.colors.text},children:z.name}),e.jsx("div",{className:"text-xs mt-1",style:{color:i.colors.textMuted},children:z.formData.symbol||z.formData.market||"â€”"})]})}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsx("span",{className:"px-2 py-1 rounded-full text-xs",style:{backgroundColor:i.colors.accent+"20",color:i.colors.accent},children:z.category||"â€”"})}),e.jsxs("div",{className:"col-span-2 flex items-center text-sm",style:{color:i.colors.textMuted},children:[e.jsx(yt,{size:14,className:"mr-1"}),new Date(z.updatedAt).toLocaleDateString()]}),e.jsxs("div",{className:"col-span-2 flex items-center text-sm",style:{color:i.colors.textMuted},children:[e.jsx(ze,{size:14,className:"mr-1"}),z.usageCount||0]}),e.jsxs("div",{className:"col-span-2 flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>{o(z.id),s()},className:"p-1 rounded hover:bg-opacity-10 transition-colors",style:{color:i.colors.accent},title:c==="fr"?"SÃ©lectionner ce preset":"Select this preset",children:"âœ“"}),e.jsx("button",{onClick:()=>l(z.id),className:"p-1 rounded hover:bg-opacity-10 transition-colors",style:{color:z.isFavorite?"#F59E0B":i.colors.textMuted},title:z.isFavorite?c==="fr"?"Retirer des favoris":"Remove from favorites":c==="fr"?"Ajouter aux favoris":"Add to favorites",children:z.isFavorite?e.jsx(ot,{size:16}):e.jsx(ac,{size:16})}),e.jsx("button",{onClick:()=>U(z),className:"p-1 rounded hover:bg-opacity-10 transition-colors",style:{color:i.colors.textMuted},title:c==="fr"?"Modifier":"Edit",children:e.jsx(Vo,{size:16})}),e.jsx("button",{onClick:()=>{confirm(c==="fr"?`Supprimer le preset "${z.name}" ?`:`Delete preset "${z.name}"?`)&&r(z.id)},className:"p-1 rounded hover:bg-opacity-10 transition-colors",style:{color:"#EF4444"},title:c==="fr"?"Supprimer":"Delete",children:e.jsx(Qt,{size:16})})]})]},z.id))})}),e.jsx(Sm,{currentTheme:i,currentLanguage:c,displayedCount:$.length,disabledSelectMostRecent:$.length===0,onSelectMostRecent:()=>{const z=$.sort((q,E)=>new Date(E.updatedAt).getTime()-new Date(q.updatedAt).getTime())[0];z&&(o(z.id),s())},onClose:s})]}),e.jsx(vm,{isOpen:!!y,preset:y,onSave:(z,q)=>{n(z,q),N(null)},onClose:()=>N(null)})]})},Cm=()=>{const[t,s]=us("trading-journal-wizard-presets",[]),[r,l]=g.useState(!1),n=t.map(v=>({...v,isFavorite:v.isFavorite??!1})),o=g.useCallback(async(v,h,b=!1)=>{l(!0);try{const j=Pm(h),y={id:`wizard-preset-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,name:v.trim(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),formData:j,isFavorite:b,category:Mm(j),tags:Rm(j),sortIndex:t.length};return s(N=>[...N,y]),y}finally{l(!1)}},[s]),a=g.useCallback(v=>{const h=t.find(b=>b.id===v);return h?(u(v),h.formData):null},[t]),i=g.useCallback(v=>{s(h=>h.filter(b=>b.id!==v))},[s]),c=g.useCallback(v=>{s(h=>h.map(b=>b.id===v?{...b,isFavorite:!b.isFavorite,updatedAt:new Date().toISOString()}:b))},[s]),d=g.useCallback((v,h)=>{s(b=>b.map(j=>j.id===v?{...j,...h,updatedAt:new Date().toISOString()}:j))},[s]),u=g.useCallback(v=>{s(h=>h.map(b=>b.id===v?{...b,lastUsed:new Date().toISOString(),usageCount:(b.usageCount||0)+1}:b))},[s]),m=g.useCallback(()=>t.filter(v=>v.isFavorite).sort((v,h)=>new Date(h.updatedAt).getTime()-new Date(v.updatedAt).getTime()),[t]),p=g.useCallback((v=5)=>t.sort((h,b)=>{const j=new Date(h.lastUsed||h.updatedAt).getTime();return new Date(b.lastUsed||b.updatedAt).getTime()-j}).slice(0,v),[t]),x=g.useCallback(v=>{if(!v.trim())return t;const h=v.toLowerCase();return t.filter(b=>b.name.toLowerCase().includes(h)||b.category?.toLowerCase().includes(h)||b.tags?.some(j=>j.toLowerCase().includes(h))||b.formData.symbol?.toLowerCase().includes(h)||b.formData.strategy?.toLowerCase().includes(h))},[t]),f=g.useCallback(()=>({total:t.length,favorites:t.filter(v=>v.isFavorite).length,categories:[...new Set(t.map(v=>v.category).filter(Boolean))].length,mostUsed:t.sort((v,h)=>(h.usageCount||0)-(v.usageCount||0)).slice(0,3)}),[t]);return{presets:n,isLoading:r,savePreset:o,loadPreset:a,deletePreset:i,toggleFavorite:c,updatePreset:d,reorderPresets:v=>{s(h=>{const b=new Map(h.map(y=>[y.id,y])),j=[];return v.forEach((y,N)=>{const w=b.get(y);w&&(j.push({...w,sortIndex:N,updatedAt:new Date().toISOString()}),b.delete(y))}),h.forEach(y=>{b.has(y.id)&&j.push({...y,sortIndex:j.length})}),j})},getFavoritePresets:m,getRecentPresets:p,searchPresets:x,getPresetStats:f}};function Pm(t){const{id:s,createdAt:r,updatedAt:l,date:n,time:o,entryDate:a,entryTime:i,exitDate:c,exitTime:d,pnl:u,pnlPercentage:m,duration:p,screenshots:x,...f}=t,v={};return Object.entries(f).forEach(([h,b])=>{b!=null&&b!==""&&(v[h]=b)}),v}function Mm(t){if(t.market)switch(t.market){case"futures":return"Futures";case"forex":return"Forex";case"crypto":return"Crypto";case"stocks":return"Actions";case"indices":return"Indices";case"commodities":return"MatiÃ¨res PremiÃ¨res";default:return"GÃ©nÃ©ral"}return"GÃ©nÃ©ral"}function Rm(t){const s=[];return t.market&&s.push(t.market),t.side&&s.push(t.side),t.strategy&&s.push(t.strategy),t.timeframe&&(["1m","5m","15m"].includes(t.timeframe)?s.push("scalping"):["1h","4h"].includes(t.timeframe)?s.push("intraday"):["1d","1w"].includes(t.timeframe)&&s.push("swing")),[...new Set(s)]}const Tm=({theme:t,language:s,progress:r,currentStep:l,isQuickMode:n,onPrev:o,onNext:a,onClose:i,onSubmit:c})=>e.jsxs("div",{className:`flex justify-between items-center ${r.padding||""} py-3 border-t`,style:{borderColor:t.colors.border,background:`linear-gradient(0deg, ${t.colors.card} 0%, ${t.colors.surface} 100%)`,borderTop:`1px solid ${t.colors.border}`},children:[e.jsxs("button",{onClick:o,disabled:l==="instrument-context",className:`flex items-center px-4 py-2 rounded-lg transition-all duration-200 ${l==="instrument-context"?"opacity-50 cursor-not-allowed":"hover:shadow-md"}`,style:{backgroundColor:t.colors.surface,color:t.colors.text,border:`1px solid ${t.colors.border}`},children:[e.jsx(il,{size:16,className:"mr-2"}),s==="fr"?"PrÃ©cÃ©dent":"Previous"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-1 rounded-full text-sm",style:{backgroundColor:r.percent===100?t.colors.success+"20":t.colors.surface,color:r.percent===100?t.colors.success:t.colors.text,border:`1px solid ${r.percent===100?t.colors.success:t.colors.border}`},children:[e.jsxs("span",{children:[r.done,"/",r.total]}),r.percent===100&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â†’"}),e.jsx("span",{className:"font-medium",children:s==="fr"?"âœ“ PrÃªt Ã  100%":"âœ“ Ready 100%"})]})]}),e.jsx("button",{onClick:i,className:"px-4 py-2 rounded-lg transition-all duration-200 hover:shadow-md",style:{backgroundColor:t.colors.surface,color:t.colors.text,border:`1px solid ${t.colors.border}`},children:s==="fr"?"Annuler":"Cancel"}),n||l==="notes-screenshots"?e.jsxs("button",{onClick:c,className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-all duration-200 hover:shadow-md",style:{backgroundColor:t.colors.accent,color:"#ffffff",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)"},children:[e.jsx(Rt,{size:16}),e.jsxs("span",{className:"font-medium",children:[s==="fr"?"Sauvegarder":"Save",n&&` (${s==="fr"?"Mode Rapide":"Quick Mode"})`]})]}):e.jsxs("button",{onClick:a,className:"flex items-center px-4 py-2 rounded-lg transition-all duration-200 hover:shadow-md",style:{backgroundColor:t.colors.accent,color:"#ffffff",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)"},children:[e.jsx("span",{className:"font-medium",children:s==="fr"?"Suivant":"Next"}),e.jsx(dl,{size:16,className:"ml-2"})]})]})]}),Dm=(t,s)=>{const[r,l]=g.useState([]);g.useEffect(()=>{const o=["instrument-context","position-entry","position-exit","risk-reward","notes-screenshots"],a=o.indexOf(t);l(o.slice(0,a))},[t]);const n=g.useMemo(()=>s.status==="open"?["position-exit"]:[],[s.status]);return{completedSteps:r,disabledSteps:n}},Fm=()=>{const[t,s]=g.useState({width:typeof window<"u"?window.innerWidth:1920,height:typeof window<"u"?window.innerHeight:1080});return g.useEffect(()=>{const r=()=>{s({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),t},Em=t=>(()=>{const{width:r,height:l}=t;return r<1024?{width:Math.min(r*.95,1100),maxHeight:l*.92,padding:"p-4",summaryWidth:220}:r<1440?{width:Math.min(r*.88,1400),maxHeight:l*.88,padding:"p-6",summaryWidth:240}:{width:Math.min(r*.8,1600),maxHeight:l*.85,padding:"p-8",summaryWidth:260}})(),er={nextStep:"Alt+ArrowRight",prevStep:"Alt+ArrowLeft",submit:"Ctrl+Enter",openSettings:"Alt+S",closeModal:"Escape",focusNextMissing:"Alt+M",focusPrevMissing:"Alt+Shift+M",focusNextField:"Ctrl+ArrowDown",focusPrevField:"Ctrl+ArrowUp"};function Am(){try{const t=localStorage.getItem("wizard-keybindings");if(!t)return er;const s=JSON.parse(t);return{...er,...s}}catch{return er}}function zn(t){localStorage.setItem("wizard-keybindings",JSON.stringify(t))}const Lm=[{id:"nextStep",labelFr:"Aller Ã  l'Ã©tape suivante",labelEn:"Go to next step"},{id:"prevStep",labelFr:"Aller Ã  l'Ã©tape prÃ©cÃ©dente",labelEn:"Go to previous step"},{id:"submit",labelFr:"Soumettre / enregistrer",labelEn:"Submit / Save"},{id:"openSettings",labelFr:"Ouvrir paramÃ¨tres",labelEn:"Open settings"},{id:"closeModal",labelFr:"Fermer le modal courant",labelEn:"Close current modal"},{id:"focusNextMissing",labelFr:"Champ manquant suivant",labelEn:"Next missing field"},{id:"focusPrevMissing",labelFr:"Champ manquant prÃ©cÃ©dent",labelEn:"Previous missing field"},{id:"focusNextField",labelFr:"Champ suivant",labelEn:"Next field"},{id:"focusPrevField",labelFr:"Champ prÃ©cÃ©dent",labelEn:"Previous field"}];function $m(t){const s=[];t.ctrlKey&&s.push("Ctrl"),t.altKey&&s.push("Alt"),t.metaKey&&s.push("Meta"),t.shiftKey&&s.push("Shift");const r=t.key;if(!r)return null;const l=r.length===1?r.toUpperCase():r;return["Shift","Control","Alt","Meta"].includes(l)?null:s.length?`${s.join("+")}+${l}`:l}const zm=({isOpen:t,onClose:s})=>{const{currentTheme:r}=Q(),{currentLanguage:l}=Z(),[n,o]=g.useState(Am()),[a,i]=g.useState(null),c=g.useRef(null);g.useEffect(()=>{if(!t)return;const u=m=>{if(!a)return;m.preventDefault(),m.stopPropagation();const p=$m(m);p&&(o(x=>({...x,[a]:p})),i(null))};return document.addEventListener("keydown",u,{capture:!0}),()=>document.removeEventListener("keydown",u,{capture:!0})},[a,t]);const d=(u,m)=>l==="fr"?u:m;return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-[60]",children:e.jsxs("div",{className:"w-full max-w-3xl max-h-[85vh] rounded-lg shadow-2xl overflow-hidden flex flex-col",style:{backgroundColor:r.colors.card,color:r.colors.text,border:`1px solid ${r.colors.border}`},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",style:{borderColor:r.colors.border,backgroundColor:r.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pl,{size:18,style:{color:r.colors.accent}}),e.jsx("h3",{className:"text-lg font-semibold",children:d("Raccourcis clavier","Keyboard shortcuts")})]}),e.jsx("button",{onClick:s,className:"p-2 rounded-full hover:bg-opacity-10 hover:bg-black transition-colors",style:{color:r.colors.textMuted},children:e.jsx(Ne,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsx("div",{ref:c,className:"text-xs px-3 py-2 rounded",style:{backgroundColor:r.colors.surface,color:r.colors.textMuted,border:`1px dashed ${r.colors.border}`},children:a?d("Appuyez sur une combinaison de touchesâ€¦","Press a key combinationâ€¦"):d("Cliquez sur 'Modifier' puis pressez la combinaison souhaitÃ©e.","Click 'Change' then press the desired combo.")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Lm.map(u=>e.jsxs("div",{className:"flex items-center justify-between gap-3 p-3 rounded border",style:{borderColor:r.colors.border,backgroundColor:r.colors.surface},children:[e.jsx("div",{className:"text-sm",style:{color:r.colors.text},children:d(u.labelFr,u.labelEn)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 rounded text-xs font-mono",style:{backgroundColor:r.colors.card,border:`1px solid ${r.colors.border}`,color:r.colors.text},children:n[u.id]}),e.jsx("button",{onClick:()=>i(u.id),className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:r.colors.card,color:r.colors.accent,borderColor:r.colors.accent},children:d("Modifier","Change")})]})]},u.id))})]}),e.jsxs("div",{className:"px-4 py-3 border-t flex items-center justify-between",style:{borderColor:r.colors.border,backgroundColor:r.colors.surface},children:[e.jsx("button",{onClick:()=>{o(er),zn(er)},className:"px-3 py-1.5 text-sm rounded border",style:{color:r.colors.text,borderColor:r.colors.border},children:d("RÃ©initialiser","Reset")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>s(),className:"px-3 py-1.5 text-sm rounded border",style:{color:r.colors.text,borderColor:r.colors.border},children:d("Annuler","Cancel")}),e.jsx("button",{onClick:()=>{zn(n),s()},className:"px-3 py-1.5 text-sm rounded border",style:{backgroundColor:r.colors.accent,color:"#fff",borderColor:r.colors.accent},children:d("Enregistrer","Save")})]})]})]})}):null},da=({isOpen:t,onClose:s,activeProfileId:r,onOpenEditMode:l})=>{const{currentTheme:n}=Q(),{currentLanguage:o}=Z(),[a,i]=g.useState("detailed"),[c,d]=g.useState(!0),[u,m]=g.useState(""),[p,x]=g.useState(!1),[f,v]=g.useState([]),[h,b]=g.useState(!1),[j,y]=g.useState(!0);g.useEffect(()=>{const C=ht.getString("pnlEntryMode"),P=ht.getBoolean("autoSave"),R=ht.getString("defaultPreset");C&&i(C),P!==null&&d(!!P),R&&m(R),N()},[]);const N=()=>{try{const C=ht.getJSON("presets");C&&v(C.map(P=>({id:P.id,name:P.name})))}catch(C){console.error("Erreur lors du chargement des presets:",C)}},w=C=>{i(C),ht.setString("pnlEntryMode",C)},S=C=>{d(C),ht.setBoolean("autoSave",C)},k=C=>{m(C),ht.setString("defaultPreset",C)};return t?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50",children:[e.jsxs("div",{className:"rounded-lg shadow-xl w-full max-w-7xl h-[95vh] flex flex-col",style:{backgroundColor:n.colors.card,color:n.colors.text,border:`1px solid ${n.colors.border}`},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",style:{borderColor:n.colors.border,backgroundColor:n.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bo,{size:18,style:{color:n.colors.accent}}),e.jsx("h3",{className:"text-lg font-semibold",children:o==="fr"?"ParamÃ¨tres du formulaire":"Form settings"})]}),e.jsx("button",{onClick:s,className:"p-2 rounded-full hover:bg-opacity-10 hover:bg-black transition-colors",style:{color:n.colors.textMuted},title:o==="fr"?"Fermer":"Close",children:e.jsx(Ne,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b",style:{borderColor:n.colors.border},children:[e.jsx(ms,{size:20,style:{color:n.colors.accent}}),e.jsx("h3",{className:"font-semibold text-lg",style:{color:n.colors.text},children:o==="fr"?"Comportement par dÃ©faut":"Default Behavior"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium",style:{color:n.colors.textSecondary},children:o==="fr"?"Raccourcis clavier":"Keyboard shortcuts"}),e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center space-x-2 px-4 py-2 text-sm rounded-lg border-2 transition-all duration-200 hover:shadow-sm",style:{backgroundColor:n.colors.surface,color:n.colors.text,borderColor:n.colors.border},children:[e.jsx(pl,{size:16}),e.jsx("span",{children:o==="fr"?"Configurer les raccourcis":"Configure shortcuts"})]}),e.jsx("p",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"Assignez vos propres touches pour naviguer plus vite.":"Assign your own keys to navigate faster."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium",style:{color:n.colors.textSecondary},children:o==="fr"?"Mode de saisie P&L":"P&L Input Mode"}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsxs("button",{onClick:()=>w("detailed"),className:`flex items-center space-x-2 px-4 py-2 text-sm rounded-lg border-2 transition-all duration-200 ${a==="detailed"?"border-0 shadow-md":"hover:shadow-sm"}`,style:{backgroundColor:a==="detailed"?n.colors.accent:n.colors.surface,color:a==="detailed"?"#ffffff":n.colors.text,borderColor:a==="detailed"?"transparent":n.colors.border},children:[e.jsx(qo,{size:16}),e.jsx("span",{children:o==="fr"?"Prix dÃ©taillÃ©s":"Detailed Prices"})]}),e.jsxs("button",{onClick:()=>w("direct"),className:`flex items-center space-x-2 px-4 py-2 text-sm rounded-lg border-2 transition-all duration-200 ${a==="direct"?"border-0 shadow-md":"hover:shadow-sm"}`,style:{backgroundColor:a==="direct"?n.colors.accent:n.colors.surface,color:a==="direct"?"#ffffff":n.colors.text,borderColor:a==="direct"?"transparent":n.colors.border},children:[e.jsx(ir,{size:16}),e.jsx("span",{children:o==="fr"?"P&L direct":"Direct P&L"})]})]}),e.jsx("p",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?a==="detailed"?"Saisie des prix d'entrÃ©e et sortie, calcul automatique du P&L":"Saisie directe du P&L, prix optionnels":a==="detailed"?"Enter entry and exit prices, automatic P&L calculation":"Direct P&L input, prices optional"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium",style:{color:n.colors.text},children:o==="fr"?"Preset par dÃ©faut":"Default preset"}),e.jsxs("select",{value:u,onChange:C=>k(C.target.value),className:"w-full px-3 py-2 text-sm rounded-lg border-2 transition-colors",style:{backgroundColor:n.colors.surface,color:n.colors.text,borderColor:n.colors.border},children:[e.jsx("option",{value:"",children:o==="fr"?"Aucun preset":"No preset"}),f.map(C=>e.jsx("option",{value:C.id,children:C.name},C.id))]}),e.jsx("p",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"Preset Ã  charger automatiquement Ã  l'ouverture du modal":"Preset to load automatically when opening the modal"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:C=>S(C.target.checked),className:"w-4 h-4 rounded border-2",style:{backgroundColor:c?n.colors.accent:"transparent",borderColor:n.colors.border}}),e.jsx("span",{className:"text-sm font-medium",style:{color:n.colors.text},children:o==="fr"?"Auto-sauvegarde":"Auto-save"})]}),e.jsx("p",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"Sauvegarder automatiquement pendant la saisie":"Automatically save during input"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b",style:{borderColor:n.colors.border},children:[e.jsx(_o,{size:20,style:{color:n.colors.accent}}),e.jsx("h3",{className:"font-semibold text-lg",style:{color:n.colors.text},children:"Interface"})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium",style:{color:n.colors.textSecondary},children:o==="fr"?"Personnalisation des champs":"Field customization"}),e.jsxs("button",{onClick:()=>{s(),l?.()},className:"flex items-center space-x-2 px-4 py-2 text-sm rounded-lg border-2 transition-all duration-200 hover:shadow-sm",style:{backgroundColor:n.colors.surface,color:n.colors.text,borderColor:n.colors.border},children:[e.jsx(Vo,{size:16}),e.jsx("span",{children:o==="fr"?"Configurer les champs":"Configure fields"})]}),e.jsx("p",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"Masquer/afficher les champs selon vos prÃ©fÃ©rences":"Hide/show fields according to your preferences"})]})})]})]})})]}),p&&e.jsx(zm,{isOpen:p,onClose:()=>x(!1)})]}):null},ua=({isOpen:t,onClose:s,currentHiddenFields:r,isRequired:l,order:n,onApply:o,onReset:a})=>{const{currentTheme:i}=Q(),{currentLanguage:c}=Z();if(!t)return null;const d=(k,C)=>c==="fr"?k:C,[u,m]=V.useState(""),[p,x]=V.useState(r);V.useEffect(()=>{x(r)},[r]);const f=k=>!p.includes(k),v=k=>{l(k)||x(C=>C.includes(k)?C.filter(P=>P!==k):[...C,k])},h=k=>({date:d("Date","Date"),time:d("Heure","Time"),market:d("MarchÃ©","Market"),symbol:d("Symbole","Symbol"),side:d("Direction","Side"),quantity:d("Taille","Quantity"),pnl:"P&L",timeframe:"Timeframe",strategy:d("StratÃ©gie","Strategy"),setup:"Setup",trend:d("Tendance","Trend"),notes:d("Notes","Notes"),tags:"Tags",screenshots:"Screenshots",entryDate:d("Date d'entrÃ©e","Entry Date"),entryTime:d("Heure d'entrÃ©e","Entry Time"),entryPrice:d("Prix d'entrÃ©e","Entry Price"),exitDate:d("Date de sortie","Exit Date"),exitTime:d("Heure de sortie","Exit Time"),exitPrice:d("Prix de sortie","Exit Price"),stopPrice:d("Stop prÃ©vu","Planned Stop"),takeProfitPrice:d("TP prÃ©vu","Planned Take Profit"),riskReward:"R:R",tradeResult:d("RÃ©sultat","Result"),fees_commission:d("Commission","Commission"),fees_spread:"Spread/Slippage",fees_swap:"Swap/Overnight",fees_exchange:d("Frais d'Ã©change","Exchange fees"),fees_regulatory:d("Frais rÃ©glementaires","Regulatory fees"),fees_other:d("Autres frais","Other fees"),tickSize:"Tick Size",tickValue:"Tick Value",marginPerContract:d("Marge par contrat","Margin per Contract"),leverage:"Leverage",marginRate:d("Taux de marge","Margin rate"),marginUsedOverride:d("Marge utilisÃ©e (override)","Margin used override"),emotion:d("Ã‰motion","Emotion"),emotionIntensity:d("IntensitÃ© Ã©motionnelle","Emotion intensity"),planRespected:d("Plan respectÃ©","Plan respected")})[k]||k,b=[{id:"core",title:d("Essentiels","Essentials"),fields:["date","market","symbol","side","quantity","pnl","time","timeframe"]},{id:"context",title:d("Contexte & StratÃ©gie","Context & Strategy"),fields:["strategy","setup","trend"]},{id:"entry",title:d("EntrÃ©e","Entry"),fields:["entryDate","entryTime","entryPrice"]},{id:"exit",title:d("Sortie","Exit"),fields:["exitDate","exitTime","exitPrice","tradeResult"]},{id:"risk",title:d("Gestion du risque","Risk management"),fields:["stopPrice","takeProfitPrice","riskReward"]},{id:"fees",title:d("Frais","Fees"),fields:["fees_commission","fees_spread","fees_swap","fees_exchange","fees_regulatory","fees_other"]},{id:"futures",title:d("Futures & Ticks","Futures & Ticks"),fields:["tickSize","tickValue"]},{id:"margin",title:d("Marge / Levier","Margin / Leverage"),fields:["marginPerContract","leverage","marginRate","marginUsedOverride"]},{id:"psychology",title:d("Psychologie","Psychology"),fields:["emotion","emotionIntensity","planRespected"]},{id:"notes",title:d("Notes & PiÃ¨ces jointes","Notes & Attachments"),fields:["notes","tags","screenshots"]}],[j,y]=V.useState(()=>{const k={};return b.forEach(C=>{k[C.id]=!0}),k}),N=k=>y(C=>({...C,[k]:!C[k]})),w=k=>{const C=[...p];k.forEach(P=>{if(l(P))return;const R=C.indexOf(P);R!==-1&&C.splice(R,1)}),x(C)},S=k=>{const C=[...p];k.forEach(P=>{l(P)||C.includes(P)||C.push(P)}),x(C)};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4",children:e.jsxs("div",{className:"w-full max-w-3xl rounded-lg shadow-xl",style:{backgroundColor:i.colors.card,color:i.colors.text,border:`1px solid ${i.colors.border}`,maxHeight:"85vh",display:"grid",gridTemplateRows:"auto auto 1fr auto"},children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",style:{borderColor:i.colors.border},children:[e.jsx("h3",{className:"text-lg font-semibold",children:c==="fr"?"Configurer les champs":"Configure fields"}),e.jsx("button",{onClick:s,className:"px-3 py-1 rounded-md",style:{backgroundColor:i.colors.surface,color:i.colors.text,border:`1px solid ${i.colors.border}`},children:c==="fr"?"Fermer":"Close"})]}),e.jsx("div",{className:"px-6 py-3 border-b",style:{borderColor:i.colors.border},children:e.jsx("input",{value:u,onChange:k=>m(k.target.value),placeholder:d("Rechercher un champâ€¦","Search fieldâ€¦"),className:"w-full px-3 py-2 rounded-md border",style:{backgroundColor:i.colors.surface,color:i.colors.text,borderColor:i.colors.border}})}),e.jsx("div",{className:"p-6 space-y-4 overflow-y-auto",children:b.map(k=>{const C=n.filter(T=>k.fields.includes(T));if(C.length===0)return null;const P=C.filter(T=>h(T).toLowerCase().includes(u.toLowerCase()));if(P.length===0)return null;const R=P.filter(T=>f(T)).length,M=C.length;return e.jsxs("div",{className:"rounded-lg border",style:{borderColor:i.colors.border},children:[e.jsxs("button",{type:"button",onClick:()=>N(k.id),className:"w-full flex items-center justify-between px-4 py-3",style:{backgroundColor:i.colors.surface,color:i.colors.text},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-semibold",children:k.title}),e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full",style:{backgroundColor:i.colors.accent+"20",color:i.colors.accent,border:`1px solid ${i.colors.accent}40`},children:[R,"/",M]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:T=>{T.stopPropagation(),w(P)},className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:i.colors.card,color:i.colors.text,borderColor:i.colors.border},title:c==="fr"?"Tout sÃ©lectionner":"Select all",children:c==="fr"?"Tout":"All"}),e.jsx("button",{type:"button",onClick:T=>{T.stopPropagation(),S(P)},className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:i.colors.card,color:i.colors.text,borderColor:i.colors.border},title:c==="fr"?"Tout dÃ©sÃ©lectionner":"Deselect all",children:c==="fr"?"Aucun":"None"}),e.jsx($e,{size:16,className:`transition-transform ${j[k.id]?"rotate-180":""}`})]})]}),j[k.id]&&e.jsx("div",{className:"p-3 grid grid-cols-1 md:grid-cols-2 gap-2",children:P.map(T=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-md border",style:{backgroundColor:i.colors.surface,borderColor:i.colors.border},children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:f(T),onChange:()=>v(T),disabled:l(T)}),e.jsxs("span",{className:"text-sm",children:[h(T),l(T)?" *":""]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>{},className:"px-2 py-1 text-xs rounded-md border",style:{backgroundColor:i.colors.card,borderColor:i.colors.border,color:i.colors.text},children:"â†‘"}),e.jsx("button",{onClick:()=>{},className:"px-2 py-1 text-xs rounded-md border",style:{backgroundColor:i.colors.card,borderColor:i.colors.border,color:i.colors.text},children:"â†“"})]})]},T))})]},k.id)})}),e.jsxs("div",{className:"px-6 py-3 border-t flex items-center justify-end gap-2",style:{borderColor:i.colors.border},children:[e.jsx("button",{onClick:a,className:"px-3 py-2 text-sm rounded-md border",style:{backgroundColor:i.colors.surface,color:i.colors.text,borderColor:i.colors.border},children:d("Restaurer par dÃ©faut","Restore defaults")}),e.jsx("button",{onClick:()=>s(),className:"px-3 py-2 text-sm rounded-md border",style:{backgroundColor:i.colors.surface,color:i.colors.text,border:`1px solid ${i.colors.border}`},children:d("Annuler","Cancel")}),e.jsx("button",{onClick:()=>o(p),className:"px-3 py-2 text-sm rounded-md",style:{backgroundColor:i.colors.accent,color:"#ffffff"},children:d("Appliquer","Apply")})]})]})})},Im=({isOpen:t,onClose:s,formData:r,settings:l,missingFields:n,currentStep:o})=>{const{currentTheme:a}=Q(),{currentLanguage:i}=Z();return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"w-full max-w-3xl max-h-[85vh] rounded-lg shadow-2xl overflow-hidden flex flex-col",style:{backgroundColor:a.colors.card,color:a.colors.text,border:`1px solid ${a.colors.border}`},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",style:{borderColor:a.colors.border,backgroundColor:a.colors.surface},children:[e.jsx("h3",{className:"text-lg font-semibold",children:i==="fr"?"RÃ©sumÃ© du Trade":"Trade Summary"}),e.jsx("button",{onClick:s,className:"p-2 rounded-full hover:bg-opacity-10 hover:bg-black transition-colors",style:{color:a.colors.textMuted},title:i==="fr"?"Fermer":"Close",children:e.jsx(Ne,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3",children:e.jsx(Jo,{formData:r,settings:l,missingFields:n,currentStep:o,headerClickable:!1,disableRingClick:!0})})]})}):null};function Om(t){const{enabled:s=!0,currentStep:r,stepsOrder:l,onNextStep:n,onPrevStep:o,onGoToStep:a,onSubmit:i,onOpenSettings:c,onCloseTopModal:d,onFocusNextMissing:u,onFocusPrevMissing:m,onFocusNextField:p,onFocusPrevField:x}=t;g.useEffect(()=>{if(!s)return;const f=N=>{const w=N;if(!w)return!1;const S=w.tagName?.toLowerCase(),k=w.getAttribute?.("contenteditable");return S==="input"||S==="textarea"||S==="select"||k==="true"},v=()=>{try{const N=localStorage.getItem("wizard-keybindings");return N?JSON.parse(N):null}catch{return null}},h=N=>N.length===1?N.toUpperCase():N==="Esc"?"Escape":N,b=N=>{const w=N.split("+").map(k=>k.trim()),S={ctrl:!1,alt:!1,shift:!1,meta:!1,key:""};for(const k of w){const C=k.toLowerCase();C==="ctrl"||C==="control"?S.ctrl=!0:C==="alt"?S.alt=!0:C==="shift"?S.shift=!0:C==="meta"||C==="cmd"||C==="command"?S.meta=!0:S.key=h(k)}return S},j=(N,w)=>{const S=b(w),k=h(N.key);return!(S.key&&k!==S.key||S.ctrl!==!!N.ctrlKey||S.alt!==!!N.altKey||S.shift!==!!N.shiftKey||S.meta!==!!N.metaKey)},y=N=>{const w=f(N.target),S=N.altKey||N.ctrlKey||N.metaKey||N.shiftKey;if(N.key==="Escape"){N.preventDefault(),d();return}const k=v(),P={...{nextStep:"Alt+ArrowRight",prevStep:"Alt+ArrowLeft",submit:"Ctrl+Enter",openSettings:"Alt+S",focusNextMissing:"Alt+M",focusPrevMissing:"Alt+Shift+M",focusNextField:"Ctrl+ArrowDown",focusPrevField:"Ctrl+ArrowUp"},...k};if(!(j(N,P.nextStep)||j(N,P.prevStep)||j(N,P.submit)||j(N,P.openSettings)||j(N,P.focusNextMissing)||j(N,P.focusPrevMissing)||j(N,P.focusNextField)||j(N,P.focusPrevField))){if(w&&!S)return}if(j(N,P.nextStep)){N.preventDefault(),n();return}if(j(N,P.prevStep)){N.preventDefault(),o();return}if(j(N,P.submit)){N.preventDefault(),i();return}if(j(N,P.openSettings)){N.preventDefault(),c();return}if(j(N,P.focusNextMissing)){N.preventDefault(),u&&u();return}if(j(N,P.focusPrevMissing)){N.preventDefault(),m&&m();return}if(j(N,P.focusNextField)){N.preventDefault(),p&&p();return}if(j(N,P.focusPrevField)){N.preventDefault(),x&&x();return}if(N.altKey&&/[1-9]/.test(N.key)){const M=parseInt(N.key,10)-1;M>=0&&M<l.length&&(N.preventDefault(),a(l[M]));return}};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[s,r,l,n,o,a,i,c,d,u,m,p,x])}function Hs(t){const s=t.querySelectorAll('[data-error="true"], .ring-danger, .border-danger');if(s.length>0){const n=s[0];n.focus(),n.scrollIntoView({behavior:"smooth",block:"center"});return}const r=['[name="symbol"]:invalid','[name="market"]:invalid','[name="side"]:invalid','[name="date"]:invalid','[name="entryDate"]:invalid','[name="entryTime"]:invalid','[name="entryPrice"]:invalid','[name="quantity"]:invalid','[name="exitDate"]:invalid','[name="exitTime"]:invalid','[name="exitPrice"]:invalid'];for(const n of r){const o=t.querySelector(n);if(o){o.focus(),o.scrollIntoView({behavior:"smooth",block:"center"});return}}const l=t.querySelector('input, select, textarea, button, [tabindex]:not([tabindex="-1"])');l&&(l.focus(),l.scrollIntoView({behavior:"smooth",block:"center"}))}const qm=({trade:t,onSubmit:s,onClose:r,settings:l,existingSymbols:n,existingTrades:o,activeProfileId:a,onOpenGlobalSettings:i})=>{const{currentTheme:c}=Q(),{currentLanguage:d}=Z(),u=Fm(),{currentStep:m,formData:p,errors:x,handleChange:f,goToNextStep:v,goToPreviousStep:h,goToStep:b,setErrors:j,getMissingFieldsForROI:y,validateStep:N,isQuickMode:w,pnlInputMode:S,setPnlInputMode:k,toggleQuickMode:C,calculatePnL:P,validateQuickMode:R,isEditMode:M,setIsEditMode:T,fieldConfig:D,shouldShowField:F,toggleFieldVisibility:$,resetFieldConfig:U,isObligatoryField:B,applyFieldConfig:O}=Oc(t,l),[z,q]=g.useState(!1),[E,I]=g.useState(!1),[H,L]=g.useState(!1),[A,_]=g.useState(!1),J=()=>{T(!0)},{completedSteps:re,disabledSteps:de}=Dm(m,p),se={},ke=!1,[be,he]=g.useState(!1);g.useEffect(()=>{be||he(!0)},[be]);const{presets:te,savePreset:W,loadPreset:K,deletePreset:ue,toggleFavorite:ye,updatePreset:Fe,reorderPresets:ee}=Cm(),oe=Em(u),ve=["date","time","market","symbol","side","timeframe","entryDate","entryTime","entryPrice","quantity","exitDate","exitTime","exitPrice","pnl","pnlPercentage","tradeResult","strategy","setup","trend","riskReward","tickSize","tickValue","marginPerContract","leverage","marginRate","marginUsedOverride","notes","tags","screenshots","stopPrice","takeProfitPrice"],Y=ie=>{switch(ie){case"instrument-context":return["status","side","market","symbol","timeframe","date","time"];case"position-entry":return["entryDate","entryTime","entryPrice","quantity","tickValue","tickSize","stopPrice","takeProfitPrice","marginPerContract","leverage","marginRate","marginUsedOverride"];case"position-exit":return["exitDate","exitTime","exitPrice","pnl","pnlPercentage","tradeResult"];case"risk-reward":return["strategy","setup","trend","riskReward"];case"notes-screenshots":return["notes","tags","screenshots"];default:return[]}},me=(()=>{const ie=new Set(Y(m));return(D?.hiddenFields||[]).filter(pe=>ie.has(pe)).length})(),je=(()=>{let ie=[];switch(m){case"instrument-context":ie=["status","side","market","symbol","timeframe","date"];break;case"position-entry":ie=["entryDate","entryTime","entryPrice","quantity"];break;case"position-exit":ie=["exitDate","exitTime","exitPrice","pnl"];break;case"risk-reward":ie=["strategy","setup","trend","tradeResult"];break;case"notes-screenshots":ie=["notes"];break;default:ie=["status","side","market","symbol","timeframe","date"]}const ce=ie.filter(qe=>{const We=p[qe];return We!=null&&We!==""}).length,pe=ie.length,Ee=ce/pe*100;return{done:ce,total:pe,percent:Ee}})(),[X,ae]=g.useState(!1),ge=()=>{const ie=N(m),ce=Object.keys(ie)[0];if(ce){const pe=document.querySelector(`[name="${ce}"]`);pe&&(pe.scrollIntoView({behavior:"smooth",block:"center"}),pe.focus())}},Ce=()=>{const ie=document.querySelector('[data-wizard-content="true"]');if(!ie)return;const ce=Array.from(ie.querySelectorAll('input, select, textarea, button, [tabindex]:not([tabindex="-1"])')).filter(We=>!We.hasAttribute("disabled")&&We.offsetParent!==null),pe=document.activeElement,Ee=pe?ce.indexOf(pe):-1,qe=ce[Math.min(Ee+1,ce.length-1)]||ce[0];qe?.focus(),qe?.scrollIntoView({behavior:"smooth",block:"center"})},Be=()=>{const ie=document.querySelector('[data-wizard-content="true"]');if(!ie)return;const ce=Array.from(ie.querySelectorAll('input, select, textarea, button, [tabindex]:not([tabindex="-1"])')).filter(We=>!We.hasAttribute("disabled")&&We.offsetParent!==null),pe=document.activeElement,Ee=pe?ce.indexOf(pe):-1,qe=ce[Math.max(Ee-1,0)]||ce[0];qe?.focus(),qe?.scrollIntoView({behavior:"smooth",block:"center"})};let Ke=0;const Nt=()=>{const ie=N(m);return Object.keys(ie)},nt=()=>{const ie=Nt();if(ie.length===0)return;Ke=Math.min(Ke+1,ie.length-1);const ce=ie[Ke],pe=document.querySelector(`[name="${ce}"]`);pe?.focus(),pe?.scrollIntoView({behavior:"smooth",block:"center"})},zt=()=>{const ie=Nt();if(ie.length===0)return;Ke=Math.max(Ke-1,0);const ce=ie[Ke],pe=document.querySelector(`[name="${ce}"]`);pe?.focus(),pe?.scrollIntoView({behavior:"smooth",block:"center"})};g.useEffect(()=>{},[]);const It=()=>{let ie={};return w?ie=R():(p.symbol||(ie.symbol=d==="fr"?"Le symbole est requis":"Symbol is required"),p.entryPrice||(ie.entryPrice=d==="fr"?"Le prix d'entrÃ©e est requis":"Entry price is required"),p.quantity||(ie.quantity=d==="fr"?"La quantitÃ© est requise":"Quantity is required"),p.status==="closed"&&!p.exitPrice&&(ie.exitPrice=d==="fr"?"Le prix de sortie est requis pour un trade fermÃ©":"Exit price is required for a closed trade")),j(ie),Object.keys(ie).length===0},Vt=()=>{It()&&s(p)};Om({currentStep:m,stepsOrder:["instrument-context","position-entry","position-exit","risk-reward","notes-screenshots"],onNextStep:()=>{const ie=N(m);if(console.log("ðŸ” Validation Ã©tape:",m,"Erreurs:",ie),Object.keys(ie).length>0){j(ie);const ce=document.querySelector('[data-wizard-content="true"]');ce&&Hs(ce);return}v(),setTimeout(()=>{const ce=document.querySelector('[data-wizard-content="true"]');ce&&Hs(ce)},50)},onPrevStep:()=>{h(),setTimeout(()=>{const ie=document.querySelector('[data-wizard-content="true"]');ie&&Hs(ie)},50)},onGoToStep:ie=>{const ce=N(m);if(Object.keys(ce).length>0){j(ce);const pe=document.querySelector('[data-wizard-content="true"]');pe&&Hs(pe);return}b(ie),setTimeout(()=>{const pe=document.querySelector('[data-wizard-content="true"]');pe&&Hs(pe)},50)},onSubmit:()=>Vt(),onFocusNextMissing:nt,onFocusPrevMissing:zt,onFocusNextField:Ce,onFocusPrevField:Be,onOpenSettings:()=>L(!0),onCloseTopModal:()=>{if(X)return ae(!1);if(E)return I(!1);if(z)return q(!1);if(H)return L(!1);r()}});const St=ie=>{f("strategy",ie),q(!1)},Bt=ie=>{const ce=K(ie);ce&&Object.entries(ce).forEach(([pe,Ee])=>{Ee!=null&&Ee!==""&&f(pe,Ee)})},es=async(ie,ce,pe=!1)=>{try{await W(ie,ce,pe)}catch(Ee){console.error("Erreur lors de la sauvegarde du preset:",Ee)}},Ot=()=>{I(!0)},Ue=()=>e.jsx(Qi,{currentStep:m,isQuickMode:w,isCustomMode:ke,formData:p,onChange:f,errors:x,settings:l,existingSymbols:n,existingTrades:o,pnlInputMode:S,setPnlInputMode:k,calculatePnL:P,onOpenStrategyModal:()=>q(!0),theme:c,language:d,customVisibleFields:se.visibleFields,customOrder:se.order,isEditMode:M,fieldConfig:D,shouldShowField:F,toggleFieldVisibility:$,isObligatoryField:B});return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4 overflow-y-auto",children:[e.jsxs("div",{className:"rounded-lg shadow-2xl flex flex-col",style:{width:`${oe.width}px`,height:`${oe.maxHeight}px`,backgroundColor:c.colors.card,color:c.colors.text,border:`1px solid ${c.colors.accent}30`,overflow:"hidden"},children:[e.jsxs("div",{className:`flex items-center justify-between ${oe.padding} py-3 border-b`,style:{borderColor:c.colors.border,background:`linear-gradient(180deg, ${c.colors.card} 0%, ${c.colors.surface} 100%)`,borderBottom:`1px solid ${c.colors.border}`},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>L(!0),className:"p-2 rounded-md hover:shadow-sm transition-colors",style:{border:`1px solid ${c.colors.border}`,backgroundColor:c.colors.surface,color:c.colors.accent},title:d==="fr"?"ParamÃ¨tres du formulaire":"Form settings",children:e.jsx(Bo,{size:16})}),e.jsx("button",{onClick:()=>T(!M),className:"px-2 py-1 rounded-md text-xs border transition-colors",style:{backgroundColor:M?c.colors.warning:c.colors.surface,color:M?"#000000":c.colors.text,border:`1px solid ${c.colors.border}`},title:d==="fr"?"Basculer le mode Ã©dition":"Toggle edit mode",children:d==="fr"?"Ã‰dition":"Edit"}),M&&e.jsx("button",{onClick:()=>_(!0),className:"p-2 rounded-md hover:shadow-sm transition-colors",style:{border:`1px solid ${c.colors.border}`,backgroundColor:c.colors.surface,color:c.colors.accent},title:d==="fr"?"Configurer les champs":"Configure fields",children:"Cf"})]}),e.jsx("h2",{className:"text-xl font-bold",style:{color:c.colors.text},children:t?d==="fr"?"Modifier le Trade":"Edit Trade":d==="fr"?"Ajouter un Trade":"Add Trade"}),e.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium",style:{backgroundColor:c.colors.accent+"20",color:c.colors.accent,border:`1px solid ${c.colors.accent}40`},children:"Wizard V2"}),M&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium",style:{backgroundColor:c.colors.warning+"20",color:c.colors.warning,border:`1px solid ${c.colors.warning}40`},children:d==="fr"?"Mode Ã‰dition":"Edit Mode"}),e.jsx("button",{onClick:U,className:"px-2 py-1 text-xs rounded border transition-colors hover:bg-gray-100",style:{backgroundColor:c.colors.surface,color:c.colors.text,borderColor:c.colors.border},title:d==="fr"?"RÃ©initialiser tous les champs":"Reset all fields",children:"Reset"}),e.jsx("button",{onClick:()=>T(!1),className:"px-2 py-1 text-xs rounded border transition-colors hover:bg-gray-100",style:{backgroundColor:c.colors.surface,color:c.colors.text,borderColor:c.colors.border},title:d==="fr"?"Terminer l'Ã©dition":"Finish editing",children:d==="fr"?"Terminer":"Finish"})]}),e.jsx(Zi,{isQuickMode:w,onToggle:C}),e.jsx(ca,{formData:p,presets:te,onLoadPreset:Bt,onSavePreset:es,onDeletePreset:ue,onToggleFavorite:ye,onManagePresets:Ot,onReorderPresets:ee})]}),e.jsx("button",{onClick:r,className:"p-2 rounded-full hover:bg-opacity-10 hover:bg-black transition-colors",style:{color:c.colors.textMuted},children:e.jsx(Ne,{size:24})})]}),!w&&e.jsxs("div",{className:"px-4 py-1 border-b",style:{borderColor:c.colors.border,backgroundColor:c.colors.surface+"50"},children:[e.jsx(qc,{currentStep:m,completedSteps:re,onStepClick:b,disabledSteps:de,formData:p}),me>0&&e.jsx("div",{className:"mt-1 text-xs inline-flex items-center gap-2",children:e.jsx("span",{className:"px-2 py-0.5 rounded-full",style:{backgroundColor:c.colors.accent+"20",color:c.colors.accent,border:`1px solid ${c.colors.accent}40`},children:d==="fr"?`${me} champs masquÃ©s`:`${me} hidden fields`})})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"flex-1 overflow-y-auto",style:{borderRight:`1px solid ${c.colors.border}`,backgroundColor:c.colors.card},children:e.jsx("div",{className:`${oe.padding} max-w-7xl mx-auto`,"data-wizard-content":"true",children:Ue()})}),e.jsx("div",{className:"overflow-y-auto",style:{width:`${oe.summaryWidth}px`,backgroundColor:c.colors.surface,borderLeft:`1px solid ${c.colors.border}`},children:e.jsx(Jo,{formData:p,settings:l,missingFields:y(),onProgressClick:ge,currentStep:m,onOpenModal:()=>ae(!0),headerClickable:!0,disableRingClick:!0})})]}),e.jsx(Tm,{theme:c,language:d,progress:{...je,padding:oe.padding},currentStep:m,isQuickMode:w,onPrev:h,onNext:v,onClose:r,onSubmit:Vt})]}),z&&e.jsx(Fo,{onSelect:St,onClose:()=>q(!1),currentValue:p.strategy||"",availableTrades:o||[],tradingSettings:l}),E&&e.jsx(ia,{presets:te,onClose:()=>I(!1),onDeletePreset:ue,onToggleFavorite:ye,onUpdatePreset:Fe,onLoadPreset:Bt,onReorderPresets:ee}),e.jsx(da,{isOpen:H,onClose:()=>L(!1),activeProfileId:a,onOpenEditMode:J}),e.jsx(ua,{isOpen:A,onClose:()=>_(!1),currentHiddenFields:D?.hiddenFields||[],isRequired:ie=>B(ie)||!1,order:ve,onApply:ie=>{O(ie),_(!1)},onReset:()=>{U()}}),e.jsx(Im,{isOpen:X,onClose:()=>ae(!1),formData:p,settings:l,missingFields:y(),currentStep:m})]})},Um=({currentTheme:t,currentLanguage:s,globalMetrics:r,formatCurrency:l,formatPercentage:n,formatDuration:o})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg shadow-sm border",style:{backgroundColor:t.colors.card,borderColor:t.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium",style:{color:t.colors.text},children:"Performance"}),e.jsx(Mt,{size:20,style:{color:t.colors.accent}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:"P&L:"}),e.jsx("span",{className:`text-sm font-bold ${r.totalPnLPercentage>=0?"text-green-600":"text-red-500"}`,children:n(r.totalPnLPercentage)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Win Rate:"}),e.jsxs("span",{className:"text-sm font-bold",style:{color:t.colors.text},children:[r.winRate.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Trades:"}),e.jsx("span",{className:"text-sm font-bold",style:{color:t.colors.text},children:r.totalTrades})]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg shadow-sm border",style:{backgroundColor:t.colors.card,borderColor:t.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium",style:{color:t.colors.text},children:s==="fr"?"Consistance":"Consistency"}),e.jsx(Te,{size:20,style:{color:t.colors.success}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Score:"}),e.jsxs("span",{className:"text-sm font-bold",style:{color:t.colors.text},children:[r.consistencyScore.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:s==="fr"?"Jours:":"Days:"}),e.jsx("span",{className:"text-sm font-bold",style:{color:t.colors.text},children:r.tradingDays})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:s==="fr"?"Meilleur:":"Best:"}),e.jsx("span",{className:"text-sm font-bold text-green-600",children:n(r.bestDay)})]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg shadow-sm border",style:{backgroundColor:t.colors.card,borderColor:t.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium",style:{color:t.colors.text},children:"Risk/Reward"}),e.jsx(ir,{size:20,style:{color:t.colors.danger}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:s==="fr"?"Gain moy:":"Avg Win:"}),e.jsx("span",{className:"text-sm font-bold text-green-600",children:l(r.avgWin)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:s==="fr"?"Perte moy:":"Avg Loss:"}),e.jsx("span",{className:"text-sm font-bold text-red-500",children:l(r.avgLoss)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Ratio:"}),e.jsxs("span",{className:"text-sm font-bold",style:{color:t.colors.text},children:["1:",Math.abs(r.avgLoss)>0?(r.avgWin/Math.abs(r.avgLoss)).toFixed(2):"âˆž"]})]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg shadow-sm border",style:{backgroundColor:t.colors.card,borderColor:t.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium",style:{color:t.colors.text},children:"Timing"}),e.jsx(ze,{size:20,style:{color:t.colors.warning}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:s==="fr"?"DurÃ©e:":"Duration:"}),e.jsx("span",{className:"text-sm font-bold",style:{color:t.colors.text},children:o(r.avgDuration)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:s==="fr"?"Trades/j:":"Trades/d:"}),e.jsx("span",{className:"text-sm font-bold",style:{color:t.colors.text},children:(r.totalTrades/Math.max(r.tradingDays,1)).toFixed(1)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:s==="fr"?"Avec durÃ©e:":"With dur:"}),e.jsx("span",{className:"text-sm font-bold",style:{color:t.colors.text}})]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg shadow-sm border",style:{backgroundColor:t.colors.card,borderColor:t.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium",style:{color:t.colors.text},children:s==="fr"?"RÃ©sultats":"Results"}),e.jsx(Te,{size:20,style:{color:t.colors.warning}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:"TP:"}),e.jsxs("span",{className:"text-sm font-bold text-green-600",children:[r.tpCount," (",r.tpWinRate.toFixed(1),"%)"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:"SL:"}),e.jsxs("span",{className:"text-sm font-bold text-red-500",children:[r.slCount," (",r.slWinRate.toFixed(1),"%)"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:"BE:"}),e.jsxs("span",{className:"text-sm font-bold text-yellow-600",children:[r.beCount," (",r.beWinRate.toFixed(1),"%)"]})]})]})]})]}),Wm=({selectedPeriod:t,onChange:s,currentTheme:r,currentLanguage:l})=>{const n=[{key:"7d",label:l==="fr"?"7 jours":"7 days"},{key:"30d",label:l==="fr"?"30 jours":"30 days"},{key:"90d",label:l==="fr"?"90 jours":"90 days"},{key:"all",label:l==="fr"?"Tout":"All"}];return e.jsx("div",{className:"flex space-x-1 p-1 rounded-lg",style:{backgroundColor:r.colors.surface},children:n.map(({key:o,label:a})=>e.jsx("button",{onClick:()=>s(o),className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${t===o?"shadow-sm":""}`,style:{backgroundColor:t===o?r.colors.card:"transparent",color:t===o?r.colors.accent:r.colors.textSecondary},children:a},o))})},_m=({trendAnalysis:t,currentTheme:s,currentLanguage:r})=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-bold",style:{color:s.colors.text},children:r==="fr"?"Tendances":"Trends"}),e.jsxs("div",{className:"p-6 rounded-lg shadow-sm border",style:{backgroundColor:s.colors.card,borderColor:s.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium",style:{color:s.colors.text},children:r==="fr"?"Tendance Taux de RÃ©ussite":"Win Rate Trend"}),e.jsx(Ae,{size:24,style:{color:s.colors.accent}})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-3xl font-bold ${t.winRateTrend>=0?"text-green-600":"text-red-500"}`,children:[t.winRateTrend>=0?"+":"",t.winRateTrend.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:r==="fr"?"Ã‰volution rÃ©cente":"Recent evolution"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold",style:{color:s.colors.text},children:[t.recentWinRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs",style:{color:s.colors.textSecondary},children:r==="fr"?"RÃ©cent (10)":"Recent (10)"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold",style:{color:s.colors.text},children:[t.olderWinRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs",style:{color:s.colors.textSecondary},children:r==="fr"?"Ancien":"Older"})]})]})]})]}),e.jsxs("div",{className:"p-6 rounded-lg shadow-sm border",style:{backgroundColor:s.colors.card,borderColor:s.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium",style:{color:s.colors.text},children:r==="fr"?"Tendance P&L":"P&L Trend"}),e.jsx(_e,{size:24,style:{color:s.colors.accent}})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-3xl font-bold ${t.pnlTrend>=0?"text-green-600":"text-red-500"}`,children:[t.pnlTrend>=0?"+":"",t.pnlTrend.toFixed(2),"%"]}),e.jsx("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:r==="fr"?"Ã‰volution P&L":"P&L evolution"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold",style:{color:s.colors.text},children:[t.recentAvgPnL.toFixed(2),"%"]}),e.jsx("p",{className:"text-xs",style:{color:s.colors.textSecondary},children:r==="fr"?"RÃ©cent (10)":"Recent (10)"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold",style:{color:s.colors.text},children:[t.olderAvgPnL.toFixed(2),"%"]}),e.jsx("p",{className:"text-xs",style:{color:s.colors.textSecondary},children:r==="fr"?"Ancien":"Older"})]})]})]})]})]}),Vm=t=>{switch(t){case"success":return{backgroundColor:"rgba(34, 197, 94, 0.2)",borderColor:"rgb(34, 197, 94)",color:"rgb(134, 239, 172)"};case"warning":return{backgroundColor:"rgba(234, 179, 8, 0.2)",borderColor:"rgb(234, 179, 8)",color:"rgb(253, 224, 71)"};case"danger":return{backgroundColor:"rgba(239, 68, 68, 0.2)",borderColor:"rgb(239, 68, 68)",color:"rgb(252, 165, 165)"};case"info":return{backgroundColor:"rgba(59, 130, 246, 0.2)",borderColor:"rgb(59, 130, 246)",color:"rgb(147, 197, 253)"};default:return{}}},Bm=({insights:t,currentTheme:s})=>e.jsx("div",{className:"space-y-4",children:t.map((r,l)=>{const n=r.icon;return e.jsx("div",{className:"p-4 rounded-lg border",style:Vm(r.type),children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(n,{size:24,className:"flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-lg mb-1",children:r.title}),e.jsx("p",{className:"text-sm opacity-90",children:r.message})]})]})},l)})}),Hm=({patternAnalysis:t,currentTheme:s,currentLanguage:r,formatPercentage:l})=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-bold",style:{color:s.colors.text},children:"Patterns"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.bestStrategy&&e.jsxs("div",{className:"p-6 rounded-lg shadow-sm border",style:{backgroundColor:s.colors.card,borderColor:s.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium",style:{color:s.colors.text},children:r==="fr"?"Meilleure StratÃ©gie":"Best Strategy"}),e.jsx(Te,{size:24,style:{color:s.colors.success}})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-2xl font-bold",style:{color:s.colors.accent},children:t.bestStrategy.name})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:s.colors.textSecondary},children:"P&L:"}),e.jsx("span",{className:"font-bold text-green-600",children:l(t.bestStrategy.pnl)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:s.colors.textSecondary},children:"Trades:"}),e.jsx("span",{className:"font-bold",style:{color:s.colors.text},children:t.bestStrategy.trades})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:s.colors.textSecondary},children:"Win Rate:"}),e.jsxs("span",{className:"font-bold",style:{color:s.colors.text},children:[t.bestStrategy.winRate.toFixed(1),"%"]})]})]})]}),t.bestTimeframe&&e.jsxs("div",{className:"p-6 rounded-lg shadow-sm border",style:{backgroundColor:s.colors.card,borderColor:s.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium",style:{color:s.colors.text},children:r==="fr"?"Meilleur Timeframe":"Best Timeframe"}),e.jsx(ze,{size:24,style:{color:s.colors.info}})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-2xl font-bold",style:{color:s.colors.accent},children:t.bestTimeframe.name})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:s.colors.textSecondary},children:"P&L:"}),e.jsx("span",{className:"font-bold text-green-600",children:l(t.bestTimeframe.pnl)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:s.colors.textSecondary},children:"Trades:"}),e.jsx("span",{className:"font-bold",style:{color:s.colors.text},children:t.bestTimeframe.trades})]})]})]}),t.bestDay&&e.jsxs("div",{className:"p-6 rounded-lg shadow-sm border",style:{backgroundColor:s.colors.card,borderColor:s.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium",style:{color:s.colors.text},children:r==="fr"?"Meilleur Jour":"Best Day"}),e.jsx(yt,{size:24,style:{color:s.colors.info}})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-2xl font-bold",style:{color:s.colors.accent},children:t.bestDay.name})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:s.colors.textSecondary},children:"P&L:"}),e.jsx("span",{className:"font-bold text-green-600",children:l(t.bestDay.pnl)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:s.colors.textSecondary},children:"Trades:"}),e.jsx("span",{className:"font-bold",style:{color:s.colors.text},children:t.bestDay.trades})]})]})]})]})]}),Gm=({trades:t,settings:s})=>{const{currentTheme:r}=Q(),{currentLanguage:l}=Z(),[n,o]=g.useState("30d"),a=g.useMemo(()=>{const f=new Date;let v;switch(n){case"7d":v=oo(f,7);break;case"30d":v=oo(f,30);break;case"90d":v=oo(f,90);break;default:return t.filter(h=>h.status==="closed")}return t.filter(h=>h.status==="closed"&&Ia(new Date(h.date),{start:v,end:f}))},[t,n]),i=g.useMemo(()=>{const f=a;if(f.length===0)return null;const v=f.reduce((I,H)=>I+(H.pnl||0),0),h=f.reduce((I,H)=>I+(H.pnlPercentage||0),0),b=f.filter(I=>(I.pnl||0)>0),j=f.filter(I=>(I.pnl||0)<0),y=b.length/f.length*100,N=b.length>0?b.reduce((I,H)=>I+(H.pnl||0),0)/b.length:0,w=j.length>0?j.reduce((I,H)=>I+(H.pnl||0),0)/j.length:0,S=Math.abs(w)>0?N/Math.abs(w):N>0?1/0:0,k=f.filter(I=>I.duration&&I.duration>0),C=k.length>0?k.reduce((I,H)=>I+(H.duration||0),0)/k.length:0,P=new Map;f.forEach(I=>{const H=I.date;P.set(H,(P.get(H)||0)+(I.pnlPercentage||0))});const R=Array.from(P.values()),M=R.filter(I=>I>0).length,T=R.length>0?M/R.length*100:0,D=f.filter(I=>I.tradeResult==="tp"),F=f.filter(I=>I.tradeResult==="sl"),$=f.filter(I=>I.tradeResult==="be"),U=D.length,B=F.length,O=$.length,z=D.length>0?D.filter(I=>(I.pnl||0)>0).length/D.length*100:0,q=F.length>0?F.filter(I=>(I.pnl||0)>0).length/F.length*100:0,E=$.length>0?$.filter(I=>(I.pnl||0)>0).length/$.length*100:0;return{totalTrades:f.length,totalPnL:v,totalPnLPercentage:h,winRate:y,profitFactor:S,avgDuration:C,consistencyScore:T,avgWin:N,avgLoss:w,bestDay:Math.max(...R,0),worstDay:Math.min(...R,0),tradingDays:R.length,tpCount:U,slCount:B,beCount:O,tpWinRate:z,slWinRate:q,beWinRate:E}},[a]),c=g.useMemo(()=>{if(!i||a.length<10)return null;const f=a.slice(-10),v=a.slice(0,-10),h=f.filter(N=>(N.pnl||0)>0).length/f.length*100,b=v.length>0?v.filter(N=>(N.pnl||0)>0).length/v.length*100:0,j=f.reduce((N,w)=>N+(w.pnlPercentage||0),0)/f.length,y=v.length>0?v.reduce((N,w)=>N+(w.pnlPercentage||0),0)/v.length:0;return{winRateTrend:h-b,pnlTrend:j-y,isImproving:h>b&&j>y,recentWinRate:h,olderWinRate:b,recentAvgPnL:j,olderAvgPnL:y}},[a,i]),d=g.useMemo(()=>{if(a.length===0)return null;const f=new Map;a.forEach(w=>{const S=w.strategy,k=f.get(S)||{trades:0,pnl:0,winRate:0};k.trades++,k.pnl+=w.pnlPercentage||0,f.set(S,k)}),f.forEach((w,S)=>{const k=a.filter(P=>P.strategy===S),C=k.filter(P=>(P.pnl||0)>0).length;w.winRate=C/k.length*100});const v=Array.from(f.entries()).sort((w,S)=>S[1].pnl-w[1].pnl)[0],h=new Map;a.forEach(w=>{const S=w.timeframe||"unknown",k=h.get(S)||{trades:0,pnl:0};k.trades++,k.pnl+=w.pnlPercentage||0,h.set(S,k)});const b=Array.from(h.entries()).sort((w,S)=>S[1].pnl-w[1].pnl)[0],j=new Map;a.forEach(w=>{const S=new Date(w.date).getDay(),k=j.get(S)||{trades:0,pnl:0};k.trades++,k.pnl+=w.pnlPercentage||0,j.set(S,k)});const y=Array.from(j.entries()).sort((w,S)=>S[1].pnl-w[1].pnl)[0],N=l==="fr"?["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"]:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return{bestStrategy:v?{name:v[0],...v[1]}:null,bestTimeframe:b?{name:b[0],...b[1]}:null,bestDay:y?{name:N[y[0]],day:y[0],...y[1]}:null,totalStrategies:f.size,totalTimeframes:h.size}},[a,l]),u=g.useMemo(()=>{if(!i||!c||!d)return[];const f=[];return i.winRate>=60?f.push({type:"success",title:l==="fr"?"Excellent taux de rÃ©ussite":"Excellent win rate",message:l==="fr"?`Votre taux de rÃ©ussite de ${i.winRate.toFixed(1)}% est excellent. Continuez sur cette voie !`:`Your win rate of ${i.winRate.toFixed(1)}% is excellent. Keep up the good work!`,icon:Or}):i.winRate<40&&f.push({type:"danger",title:l==="fr"?"Taux de rÃ©ussite faible":"Low win rate",message:l==="fr"?`Votre taux de rÃ©ussite de ${i.winRate.toFixed(1)}% nÃ©cessite une rÃ©vision de votre stratÃ©gie.`:`Your win rate of ${i.winRate.toFixed(1)}% requires a revision of your strategy.`,icon:fc}),i.profitFactor>=2?f.push({type:"success",title:"Excellent Profit Factor",message:l==="fr"?`Votre profit factor de ${i.profitFactor.toFixed(2)} indique une gestion des risques optimale.`:`Your profit factor of ${i.profitFactor.toFixed(2)} indicates optimal risk management.`,icon:Ps}):i.profitFactor<1.2&&f.push({type:"warning",title:l==="fr"?"Profit Factor Ã  amÃ©liorer":"Profit Factor needs improvement",message:l==="fr"?`Votre profit factor de ${i.profitFactor.toFixed(2)} suggÃ¨re d'optimiser votre ratio risque/rÃ©compense.`:`Your profit factor of ${i.profitFactor.toFixed(2)} suggests optimizing your risk/reward ratio.`,icon:Xt}),c.isImproving?f.push({type:"success",title:l==="fr"?"Progression positive":"Positive progression",message:l==="fr"?`Vos performances s'amÃ©liorent ! Taux de rÃ©ussite rÃ©cent : ${c.recentWinRate.toFixed(1)}%`:`Your performance is improving! Recent win rate: ${c.recentWinRate.toFixed(1)}%`,icon:Ae}):c.winRateTrend<-10&&f.push({type:"warning",title:l==="fr"?"Baisse de performance":"Performance decline",message:l==="fr"?`Attention : votre taux de rÃ©ussite a baissÃ© de ${Math.abs(c.winRateTrend).toFixed(1)}% rÃ©cemment.`:`Warning: your win rate has decreased by ${Math.abs(c.winRateTrend).toFixed(1)}% recently.`,icon:$t}),d.bestStrategy&&f.push({type:"info",title:l==="fr"?"StratÃ©gie performante":"High-performing strategy",message:l==="fr"?`Votre stratÃ©gie "${d.bestStrategy.name}" gÃ©nÃ¨re ${d.bestStrategy.pnl.toFixed(2)}% de profit.`:`Your strategy "${d.bestStrategy.name}" generates ${d.bestStrategy.pnl.toFixed(2)}% profit.`,icon:Te}),i.consistencyScore>=70?f.push({type:"success",title:l==="fr"?"Trading consistant":"Consistent trading",message:l==="fr"?`${i.consistencyScore.toFixed(1)}% de vos journÃ©es sont profitables. Excellente rÃ©gularitÃ© !`:`${i.consistencyScore.toFixed(1)}% of your days are profitable. Excellent consistency!`,icon:Mt}):i.consistencyScore<50&&f.push({type:"warning",title:l==="fr"?"Manque de consistance":"Lack of consistency",message:l==="fr"?`Seulement ${i.consistencyScore.toFixed(1)}% de vos journÃ©es sont profitables. Travaillez la rÃ©gularitÃ©.`:`Only ${i.consistencyScore.toFixed(1)}% of your days are profitable. Work on consistency.`,icon:Xt}),f},[i,c,d,l]),m=f=>new Intl.NumberFormat(l==="fr"?"fr-FR":"en-US",{style:"currency",currency:s.currency,minimumFractionDigits:0,maximumFractionDigits:0}).format(f),p=f=>`${f>=0?"+":""}${f.toFixed(2)}%`,x=f=>{if(f===0)return"0s";const v=Math.floor(f/3600),h=Math.floor(f%3600/60);return v>0?`${v}h ${h}m`:h>0?`${h}m`:`${f}s`};return i?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:e.jsx(Wm,{selectedPeriod:n,onChange:f=>o(f),currentTheme:r,currentLanguage:l})}),e.jsx(Um,{currentTheme:r,currentLanguage:l,globalMetrics:{totalPnLPercentage:i.totalPnLPercentage,winRate:i.winRate,totalTrades:i.totalTrades,consistencyScore:i.consistencyScore,tradingDays:i.tradingDays,bestDay:i.bestDay,avgWin:i.avgWin,avgLoss:i.avgLoss,avgDuration:i.avgDuration,tpCount:i.tpCount,slCount:i.slCount,beCount:i.beCount,tpWinRate:i.tpWinRate,slWinRate:i.slWinRate,beWinRate:i.beWinRate},formatCurrency:m,formatPercentage:p,formatDuration:x}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[c&&e.jsx(_m,{trendAnalysis:c,currentTheme:r,currentLanguage:l}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Bm,{insights:u,currentTheme:r,currentLanguage:l}),u.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Se,{size:48,className:"mx-auto mb-4",style:{color:r.colors.textMuted}}),e.jsx("p",{style:{color:r.colors.textSecondary},children:l==="fr"?"Continuez Ã  trader pour obtenir plus d'insights personnalisÃ©s":"Continue trading to get more personalized insights"})]})]})]}),d&&e.jsx(Hm,{patternAnalysis:d,currentTheme:r,currentLanguage:l,formatPercentage:p})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Se,{size:64,className:"mx-auto mb-4",style:{color:r.colors.textMuted}}),e.jsx("h3",{className:"text-xl font-bold mb-2",style:{color:r.colors.text},children:l==="fr"?"Pas assez de donnÃ©es":"Not enough data"}),e.jsx("p",{style:{color:r.colors.textSecondary},children:l==="fr"?"Ajoutez plus de trades fermÃ©s pour voir votre vue d'ensemble":"Add more closed trades to see your overview"})]})},Jm=({trades:t,settings:s})=>e.jsx(Gm,{trades:t,settings:s}),In=t=>{let s;const r=new Set,l=(d,u)=>{const m=typeof d=="function"?d(s):d;if(!Object.is(m,s)){const p=s;s=u??(typeof m!="object"||m===null)?m:Object.assign({},s,m),r.forEach(x=>x(s,p))}},n=()=>s,i={setState:l,getState:n,getInitialState:()=>c,subscribe:d=>(r.add(d),()=>r.delete(d))},c=s=t(l,n,i);return i},Km=(t=>t?In(t):In),Ym=t=>t;function Xm(t,s=Ym){const r=V.useSyncExternalStore(t.subscribe,V.useCallback(()=>s(t.getState()),[t,s]),V.useCallback(()=>s(t.getInitialState()),[t,s]));return V.useDebugValue(r),r}const On=t=>{const s=Km(t),r=l=>Xm(s,l);return Object.assign(r,s),r},Zr=(t=>t?On(t):On);function Et(t){return t==null||t===""?"0":String(t)}const qn=new Map;function Un(t,s){const r=t,l=[r.market,r.side,r.entryPrice,r.exitPrice,r.tickSize,r.tickValue,r.quantity,r.pnl,r.pnlPercentage,r.fees_commission,r.fees_spread_slippage,r.fees_swap_overnight,r.fees_other,s.equity];return JSON.stringify(l)}function ma(t,s={}){try{const S=Un(t,s),k=qn.get(S);if(k)return k}catch{}const r=t.side==="short"?Me("-1"):Me("1"),l=t.market==="futures",n=Me(Et(t.entryPrice)),o=Me(Et(t.exitPrice)),a=Me(Et(t.quantity)),i=Me(Et(t.tickSize)),c=Me(Et(t.tickValue)),d=Br(o,n),u=ut(d,r),m=l&&!i.isZero()?vs(u,i):Me("0");let p=null;if(a.gt(0))if(l){const S=i.isZero()?Me("0"):vs(c,i);p=ut(ut(u,S),a)}else p=ut(u,a);const x=Me(Et(t.fees?.commission??t.fees_commission)),f=Me(Et(t.fees?.spread_slippage??t.fees_spread_slippage)),v=Me(Et(t.fees?.swap_overnight??t.fees_swap_overnight)),h=Me(Et(t.fees?.other??t.fees_other)),b=Pt(Pt(x,f),Pt(v,h)),j=p?Pt(p,b):null,y=Me(Et(s.equity)),N=j&&!y.isZero()?ut(vs(j,y),Me("100")):null;if(t.pnl!==void 0||t.pnlPercentage!==void 0){const S=t.pnl!==void 0?Me(Et(t.pnl)):null,k=t.pnlPercentage!==void 0?Me(Et(t.pnlPercentage)):null;return{pnlBrut:S,totalFees:b,pnlNet:S?Pt(S,b):null,pnlPct:k??(S&&!y.isZero()?ut(vs(S,y),Me("100")):null),movePoints:u,moveTicks:m}}const w={pnlBrut:p,totalFees:b,pnlNet:j,pnlPct:N,movePoints:u,moveTicks:m};try{qn.set(Un(t,s),w)}catch{}return w}let ho=null,Wn=0;function Qm(){return typeof window>"u"?null:(ho||(ho=new Worker(new URL(""+new URL("computeMetrics.worker-BFmWPcxV.js",import.meta.url).href,import.meta.url),{type:"module"})),ho)}function go(t,s){const r=Qm(),l=()=>{const{formData:i,settings:c}=t();s({computed:ma(i,c)})};if(!r)return l();const n=++Wn,{formData:o,settings:a}=t();r.onmessage=i=>{const{id:c,result:d}=i.data||{};c===Wn&&s({computed:d})};try{r.postMessage({id:n,formData:o,settings:t().settings})}catch{l()}}const ts=Zr((t,s)=>({formData:{},settings:{equity:1e4},computed:{},updateField:(r,l)=>{t(n=>({formData:{...n.formData,[r]:l}})),go(s,t)},updateFields:r=>{t(l=>({formData:{...l.formData,...r}})),go(s,t)},setSettings:r=>{t(l=>({settings:typeof r=="function"?r(l.settings):r})),go(s,t)},reset:()=>{t({formData:{},settings:{equity:1e4},computed:{}})}}));function xa({children:t}){return e.jsx(e.Fragment,{children:t})}function xs(){const t=ts(a=>a.formData),s=ts(a=>a.computed),r=ts(a=>a.settings),l=ts(a=>a.updateField),n=ts(a=>a.updateFields),o=ts(a=>a.setSettings);return{formData:t,computed:s,settings:r,updateField:l,updateFields:n,setSettings:o}}const wt={sections:[{id:"instrument-context",label:"Contexte du trade",fields:[{id:"status",type:"toggle",component:"StatusToggleFieldWrapper",label:"Statut",required:!0,visibleIf:!0},{id:"side",type:"toggle",component:"SideToggleFieldWrapper",label:"Direction",required:!0,visibleIf:!0},{id:"market",type:"buttons-grid",component:"MarketSelectorFieldWrapper",label:"MarchÃ©",required:!0,visibleIf:!0},{id:"symbol",type:"text+overlay",component:"SymbolFieldWrapper",label:"Symbole",required:!0,visibleIf:!0,modals:["SymbolsOverlay"]},{id:"timeframe",type:"overlay",component:"TimeframeFieldWrapper",label:"Timeframe",visibleIf:!0}]},{id:"position-entry",label:"EntrÃ©e de position",fields:[{id:"entryDateTime",type:"composite",component:"EntryDateTimeSectionWrapper",label:"Date/Heure d'entrÃ©e",visibleIf:!0},{id:"entryPrice",type:"number",component:"EntryPriceFieldWrapper",label:"Prix d'entrÃ©e",requiredIf:t=>t.pnlEntryMode!=="direct",visibleIf:t=>t.pnlEntryMode!=="direct"},{id:"quantity",type:"number",component:"QuantityFieldWrapper",label:"QuantitÃ©",requiredIf:t=>t.pnlEntryMode!=="direct",visibleIf:t=>t.pnlEntryMode!=="direct"},{id:"futuresParams",type:"composite",component:"FuturesParamsSectionWrapper",label:"ParamÃ¨tres Futures",visibleIf:t=>t.market==="futures"},{id:"leverageMargin",type:"composite",component:"LeverageMarginSectionWrapper",label:"Levier & Marge",visibleIf:t=>t.market==="futures"},{id:"stopPrice",type:"number",component:"StopPriceFieldWrapper",label:"Stop prÃ©vu"},{id:"takeProfitPrice",type:"number",component:"TakeProfitPriceFieldWrapper",label:"TP prÃ©vu"}]},{id:"position-exit",label:"Sortie de position",fields:[{id:"exitDateTime",type:"composite",component:"ExitDateTimeSectionWrapper",label:"Date/Heure de sortie",visibleIf:!0},{id:"exitPrice",type:"number",component:"ExitPriceFieldWrapper",label:"Prix de sortie",requiredIf:t=>t.status==="closed"&&t.pnlEntryMode!=="direct",visibleIf:t=>t.pnlEntryMode!=="direct"},{id:"pnl",type:"number",component:"PnlFieldWrapper",label:"PnL",visibleIf:t=>t.pnlEntryMode==="direct"&&t.pnlMode==="absolute",requiredIf:t=>t.pnlEntryMode==="direct"&&t.pnlMode==="absolute"},{id:"pnlPercentage",type:"number",component:"PnlPercentageFieldWrapper",label:"PnL %",visibleIf:t=>t.pnlEntryMode==="direct"&&t.pnlMode==="percentage",requiredIf:t=>t.pnlEntryMode==="direct"&&t.pnlMode==="percentage"},{id:"pnlSummary",type:"composite",component:"PnLSummaryWrapper",label:"RÃ©sumÃ© P&L",visibleIf:!0},{id:"fees_commission",type:"number",component:"FeesCommissionFieldWrapper",label:"Commission"},{id:"fees_spread_slippage",type:"number",component:"FeesSpreadSlippageFieldWrapper",label:"Spread/Slippage"},{id:"fees_swap_overnight",type:"number",component:"FeesSwapOvernightFieldWrapper",label:"Swap/Overnight"},{id:"fees_other",type:"number",component:"FeesOtherFieldWrapper",label:"Autres frais"}]}]};wt.sections.push({id:"risk-reward",label:"Performance & StratÃ©gie",fields:[{id:"tradeResult",type:"enum",component:"TradeResultFieldWrapper",label:"RÃ©sultat",visibleIf:!0,placeholder:"",help:""},{id:"strategy",type:"text",component:"StrategyFieldWrapper",label:"StratÃ©gie",visibleIf:!0,placeholder:"Ex: Scalping, Momentum...",help:""},{id:"setup",type:"text",component:"SetupFieldWrapper",label:"Setup",visibleIf:!0,placeholder:"SÃ©lectionner un setup...",help:""},{id:"trend",type:"enum",component:"TrendFieldWrapper",label:"Tendance",visibleIf:!0,placeholder:"",help:""},{id:"riskReward",type:"number",component:"RiskRewardInputWrapper",label:"R:R",visibleIf:!0,placeholder:"Ex: 2.5",help:"CalculÃ© automatiquement si SL/TP"},{id:"tags",type:"tags",component:"TagsWrapper",label:"Tags",visibleIf:!0}]},{id:"trade-summary",label:"RÃ©sumÃ© du trade",fields:[{id:"summaryPanel",type:"composite",component:"SummaryPanelWrapper",label:"RÃ©sumÃ©",visibleIf:!0}]},{id:"notes-screenshots",label:"Notes & Psychologie",fields:[{id:"notesAndPsycho",type:"composite",component:"NotesAndScreenshotsStepWrapper",visibleIf:!0}]});const Zm=({headerClickable:t,onOpenModal:s})=>{const{formData:r}=xs(),{currentTheme:l}=Q(),{currentLanguage:n}=Z(),o=V.useMemo(()=>({currency:"EUR",initialCapital:1e4,currentCapital:1e4}),[]);return e.jsx("div",{className:"rounded border",style:{borderColor:l.colors.border},children:e.jsx(Jo,{formData:r,settings:o,missingFields:[],currentStep:"instrument-context",headerClickable:!!t,onOpenModal:s})})},ex=()=>{const{currentTheme:t}=Q(),{currentLanguage:s}=Z(),{formData:r}=xs(),l=V.useCallback(c=>{try{return new Intl.NumberFormat(s==="fr"?"fr-FR":"en-US",{style:"currency",currency:"EUR"}).format(c)}catch{return String(c??0)}},[s]),{pnlBrut:n,totalFees:o,pnlNet:a,accountPercentage:i}=V.useMemo(()=>{const c=parseFloat(r.entryPrice?.toString()||"0"),d=parseFloat(r.exitPrice?.toString()||"0"),u=parseFloat(r.quantity?.toString()||"0"),m=parseFloat(r.tickSize?.toString()||"0"),p=parseFloat(r.tickValue?.toString()||"0"),x=r.side,f=r.market,v=x==="short"?-1:1;let h=null;if(c>0&&d>0&&u>0)if(f==="futures"&&m>0){const R=p/m;h=(d-c)*R*u*v}else h=(d-c)*u*v;const b=r||{},j=parseFloat((b.fees_commission??0).toString()),y=parseFloat((b.fees_spread_slippage??0).toString()),N=parseFloat((b.fees_swap_overnight??0).toString()),w=parseFloat((b.fees_other??0).toString()),S=j+y+N+w,k=h!==null?h+S:null,P=k!==null?k/1e4*100:null;return{pnlBrut:h,totalFees:S,pnlNet:k,accountPercentage:P}},[r]);return e.jsx(Al,{currentTheme:t,currentLanguage:s,pnlBrut:n,totalFees:o,pnlNet:a,accountPercentage:i,formatCurrency:l})},tx=({formData:t,updateFieldGlobal:s})=>{const{currentTheme:r}=Q(),{currentLanguage:l}=Z(),[n,o]=V.useState(null),a=m=>{const[p="0",x="0",f="0"]=(m||"").split(":"),v=(h,b)=>{const j=parseInt(h,10);return Number.isNaN(j)?0:Math.max(0,Math.min(b,j))};return{hours:v(p,23),minutes:v(x,59),seconds:v(f,59)}},{hours:i,minutes:c,seconds:d}=a(t?.exitTime),u=(m,p,x)=>{const f=String(Math.max(0,Math.min(23,m))).padStart(2,"0"),v=String(Math.max(0,Math.min(59,p))).padStart(2,"0"),h=String(Math.max(0,Math.min(59,x))).padStart(2,"0");s&&s("exitTime",`${f}:${v}:${h}`)};return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx("div",{className:"relative",children:e.jsx(gs,{id:"exit-date-input",name:"exitDate",value:t?.exitDate||"",onChange:m=>s&&s("exitDate",m),placeholder:l==="fr"?"jj/mm/aaaa":"mm/dd/yyyy",className:"w-full",size:"compact"})})}),e.jsx("div",{children:e.jsx(Yo,{currentTheme:r,currentLanguage:l,errors:{},hours:i,minutes:c,seconds:d,active:n,setActive:o,updateTime:u,hideExitTimeLabel:!0})})]})};function Ye(t){const s=ts(V.useCallback(n=>n.formData[t],[t])),r=ts(n=>n.updateField),l=V.useCallback(n=>r(t,n),[r,t]);return[s,l]}const sx=V.lazy(()=>rs(()=>import("./NotesAndScreenshotsStep-Cw0raGbu.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),rx=V.lazy(()=>rs(()=>import("./V3LeverageMarginSection-CiPTlafK.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url)),ox=V.lazy(()=>rs(()=>import("./V3FuturesParamsSection-C1MXMILK.js"),__vite__mapDeps([6,1,2,3,4]),import.meta.url)),nx=({value:t,onChange:s,formData:r})=>{const{currentTheme:l}=Q(),{currentLanguage:n}=Z(),[o,a]=V.useState(!1),[i,c]=V.useState(""),d=[],u=[],m=[],p=[],x=[],f=v=>{s(v),a(!1),c("")};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:t||"",onChange:v=>s(v.target.value.toUpperCase()),placeholder:"Ex: EURUSD, AAPL...",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text}}),e.jsx("div",{className:"w-0 h-0 overflow-visible",children:e.jsx(Ko,{suggestions:x,favoriteSymbols:d,customSymbols:p,theme:l,onSelect:f,onToggleFavorite:()=>{},onRemoveCustom:()=>{}})}),e.jsx("button",{type:"button",onClick:()=>a(!0),className:"px-3 py-2 border rounded-lg",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},children:"â€¦"}),e.jsx(Vr,{isOpen:o,onClose:()=>a(!1),theme:l,t1:v=>v,symbolSearch:i,onChangeSearch:c,onAddCustomSymbol:()=>{},favoriteSymbols:d,filteredFavorites:u,filteredMarketSymbols:m,filteredCustomSymbols:p,currentSelectedSymbol:t,marketLabel:r?.market||"Market",onSelectSymbol:f,onToggleFavorite:()=>{},onRemoveCustomSymbol:()=>{},draggedItem:null,dragOverIndex:null,onDragStart:()=>{},onDragOver:()=>{},onDragLeave:()=>{},onDrop:()=>{},onDragEnd:()=>{}})]})},lx=({value:t,onChange:s,formData:r})=>{const{currentTheme:l}=Q(),{currentLanguage:n}=Z(),[o,a]=V.useState(!1);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:t||"",onChange:i=>s(i.target.value),placeholder:"1m, 5m, 1h, 50t...",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text}}),e.jsx("button",{type:"button",onClick:()=>a(!0),className:"px-3 py-2 border rounded-lg",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},title:n==="fr"?"Choisir dans la liste":"Choose from list",children:"â€¦"}),e.jsx(_r,{isOpen:o,onClose:()=>a(!1),onSelect:i=>{s(i),a(!1)},currentValue:t})]})},ax=({value:t,onChange:s})=>{const{currentLanguage:r}=Z();return e.jsx(gs,{id:"v3-date-input",value:t||"",onChange:l=>s(l),placeholder:r==="fr"?"jj/mm/aaaa":"mm/dd/yyyy",className:"w-full",size:"compact"})},cx=({value:t,onChange:s})=>{const{currentLanguage:r}=Z();return e.jsx("input",{type:"text",value:t??"",onChange:l=>{const n=l.target.value.replace(",",".");if(n.trim()==="")return s("");const o=Number(n);Number.isNaN(o)||s(o)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2"})},ix=({value:t,onChange:s})=>{const r=typeof t=="string"?t:"",l=n=>{const o=n.split(":").map(p=>p.padStart(2,"0")).slice(0,3);for(;o.length<3;)o.push("00");const[a,i,c]=o.map(p=>p.replace(/[^0-9]/g,"")),d=String(Math.min(23,parseInt(a||"0"))).padStart(2,"0"),u=String(Math.min(59,parseInt(i||"0"))).padStart(2,"0"),m=String(Math.min(59,parseInt(c||"0"))).padStart(2,"0");return`${d}:${u}:${m}`};return e.jsx("input",{type:"text",value:r,placeholder:"HH:mm:ss",onChange:n=>s(l(n.target.value)),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2"})},dx={SymbolInputWrapper:nx,TimeframeOverlayWrapper:lx,DatePickerWrapper:ax,NumberInput:cx,TimeInputWrapper:ix,EntryPriceFieldWrapper:()=>{const[t,s]=Ye("entryPrice"),r=l=>{const n=l.target.value.replace(",",".");if(n.trim()==="")return s("");const o=Number(n);Number.isNaN(o)||s(o)};return e.jsx("input",{type:"text",value:t??"",onChange:r,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2"})},SymbolFieldWrapper:()=>{const{currentTheme:t}=Q(),{currentLanguage:s}=Z(),[r,l]=Ye("symbol"),n=ts(f=>f.formData.market),[o,a]=V.useState(!1),[i,c]=V.useState(""),d=[],u=[],m=[],p=[],x=f=>{l(f),a(!1),c("")};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:r||"",onChange:f=>l(f.target.value.toUpperCase()),placeholder:"Ex: EURUSD, AAPL...",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}}),e.jsx("button",{type:"button",onClick:()=>a(!0),className:"px-3 py-2 border rounded-lg",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text},children:"â€¦"}),e.jsx(Vr,{isOpen:o,onClose:()=>a(!1),theme:t,t1:f=>f,symbolSearch:i,onChangeSearch:c,onAddCustomSymbol:()=>{},favoriteSymbols:d,filteredFavorites:u,filteredMarketSymbols:m,filteredCustomSymbols:p,currentSelectedSymbol:r,marketLabel:n||"Market",onSelectSymbol:x,onToggleFavorite:()=>{},onRemoveCustomSymbol:()=>{},draggedItem:null,dragOverIndex:null,onDragStart:()=>{},onDragOver:()=>{},onDragLeave:()=>{},onDrop:()=>{},onDragEnd:()=>{}})]})},TimeframeFieldWrapper:()=>{const{currentTheme:t}=Q(),{currentLanguage:s}=Z(),[r,l]=Ye("timeframe"),[n,o]=V.useState(!1);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:r||"",onChange:a=>l(a.target.value),placeholder:"1m, 5m, 1h, 50t...",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}}),e.jsx("button",{type:"button",onClick:()=>o(!0),className:"px-3 py-2 border rounded-lg",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text},title:s==="fr"?"Choisir dans la liste":"Choose from list",children:"â€¦"}),e.jsx(_r,{isOpen:n,onClose:()=>o(!1),onSelect:a=>{l(a),o(!1)},currentValue:r})]})},TagsFieldWrapper:()=>{const[t,s]=Ye("tags"),r=(t||[]).join(", "),l=n=>{const o=n.target.value.split(",").map(a=>a.trim()).filter(Boolean);s(o)};return e.jsx("input",{type:"text",value:r,onChange:l,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",placeholder:"tag1, tag2"})},QuantityFieldWrapper:()=>{const[t,s]=Ye("quantity"),r=l=>{const n=l.target.value.replace(/[^0-9]/g,"");if(n==="")return s("");const o=Number(n);Number.isNaN(o)||s(o)};return e.jsx("input",{type:"text",value:t??"",onChange:r,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",inputMode:"numeric"})},ExitPriceFieldWrapper:()=>{const[t,s]=Ye("exitPrice"),r=l=>{const n=l.target.value.replace(",",".");if(n.trim()==="")return s("");const o=Number(n);Number.isNaN(o)||s(o)};return e.jsx("input",{type:"text",value:t??"",onChange:r,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2"})},StopPriceFieldWrapper:()=>{const[t,s]=Ye("stopPrice"),r=l=>{const n=l.target.value.replace(",",".");if(n.trim()==="")return s("");const o=Number(n);Number.isNaN(o)||s(o)};return e.jsx("input",{type:"text",value:t??"",onChange:r,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2"})},TakeProfitPriceFieldWrapper:()=>{const[t,s]=Ye("takeProfitPrice"),r=l=>{const n=l.target.value.replace(",",".");if(n.trim()==="")return s("");const o=Number(n);Number.isNaN(o)||s(o)};return e.jsx("input",{type:"text",value:t??"",onChange:r,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2"})},PnlFieldWrapper:()=>{const[t,s]=Ye("pnl"),r=l=>{const n=l.target.value.replace(",",".");if(n.trim()==="")return s("");const o=Number(n);Number.isNaN(o)||s(o)};return e.jsx("input",{type:"text",value:t??"",onChange:r,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2"})},PnlPercentageFieldWrapper:()=>{const[t,s]=Ye("pnlPercentage"),r=l=>{const n=l.target.value.replace(",",".");if(n.trim()==="")return s("");const o=Number(n);Number.isNaN(o)||s(o)};return e.jsx("input",{type:"text",value:t??"",onChange:r,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2"})},FeesCommissionFieldWrapper:()=>{const[t,s]=Ye("fees_commission"),r=l=>{const n=l.target.value.replace(",",".");if(n.trim()==="")return s("");const o=Number(n);Number.isNaN(o)||s(o)};return e.jsx("input",{type:"text",value:t??"",onChange:r,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2"})},FeesSpreadSlippageFieldWrapper:()=>{const[t,s]=Ye("fees_spread_slippage"),r=l=>{const n=l.target.value.replace(",",".");if(n.trim()==="")return s("");const o=Number(n);Number.isNaN(o)||s(o)};return e.jsx("input",{type:"text",value:t??"",onChange:r,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2"})},FeesSwapOvernightFieldWrapper:()=>{const[t,s]=Ye("fees_swap_overnight"),r=l=>{const n=l.target.value.replace(",",".");if(n.trim()==="")return s("");const o=Number(n);Number.isNaN(o)||s(o)};return e.jsx("input",{type:"text",value:t??"",onChange:r,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2"})},FeesOtherFieldWrapper:()=>{const[t,s]=Ye("fees_other"),r=l=>{const n=l.target.value.replace(",",".");if(n.trim()==="")return s("");const o=Number(n);Number.isNaN(o)||s(o)};return e.jsx("input",{type:"text",value:t??"",onChange:r,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2"})},SectionTitle:({label:t})=>{const{currentTheme:s}=Q(),r=g.useMemo(()=>String(t||""),[t]);return e.jsx("div",{className:"mb-1",children:e.jsx("div",{className:"text-sm font-semibold",style:{color:s.colors.text},children:r})})},ExitDateTimeSectionWrapper:({formData:t,updateFieldGlobal:s})=>e.jsx(tx,{formData:t||{},updateFieldGlobal:s}),TextInputWrapper:({value:t,onChange:s})=>e.jsx("input",{type:"text",value:t??"",onChange:r=>s(r.target.value),className:"w-full px-3 py-2 border rounded"}),TextAreaWrapper:({value:t,onChange:s})=>e.jsx("textarea",{value:t??"",onChange:r=>s(r.target.value),className:"w-full px-3 py-2 border rounded min-h-[100px]"}),CheckboxWrapper:({value:t,onChange:s})=>e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!t,onChange:r=>s(r.target.checked)}),e.jsx("span",{children:"Oui"})]}),TradeResultSelectWrapper:({value:t,onChange:s})=>e.jsxs("select",{value:t??"",onChange:r=>s(r.target.value),className:"w-full px-3 py-2 border rounded",children:[e.jsx("option",{value:"",children:"â€”"}),e.jsx("option",{value:"win",children:"Win"}),e.jsx("option",{value:"loss",children:"Loss"}),e.jsx("option",{value:"be",children:"Break-even"})]}),TrendSelectWrapper:({value:t,onChange:s})=>e.jsxs("select",{value:t??"",onChange:r=>s(r.target.value),className:"w-full px-3 py-2 border rounded",children:[e.jsx("option",{value:"",children:"â€”"}),e.jsx("option",{value:"up",children:"Up"}),e.jsx("option",{value:"down",children:"Down"}),e.jsx("option",{value:"sideways",children:"Sideways"})]}),EmotionSelectWrapper:({value:t,onChange:s})=>e.jsxs("select",{value:t??"",onChange:r=>s(r.target.value),className:"w-full px-3 py-2 border rounded",children:[e.jsx("option",{value:"",children:"â€”"}),e.jsx("option",{value:"euphoria",children:"Euphorie"}),e.jsx("option",{value:"stress",children:"Stress"}),e.jsx("option",{value:"calm",children:"Calme"}),e.jsx("option",{value:"fatigue",children:"Fatigue"})]}),IntensitySliderWrapper:({value:t,onChange:s})=>e.jsx("input",{type:"range",min:0,max:10,value:Number(t??0),onChange:r=>s(Number(r.target.value)),className:"w-full"}),TagsWrapper:({value:t,onChange:s})=>e.jsx("input",{type:"text",value:(t??[]).join(", "),onChange:r=>s(r.target.value.split(",").map(l=>l.trim()).filter(Boolean)),className:"w-full px-3 py-2 border rounded",placeholder:"tag1, tag2"}),ScreenshotsListWrapper:({value:t,onChange:s})=>e.jsx("textarea",{value:(t??[]).join(`
`),onChange:r=>s(r.target.value.split(`
`).map(l=>l.trim()).filter(Boolean)),className:"w-full px-3 py-2 border rounded min-h-[120px]",placeholder:"https://...\\nhttps://..."}),EntryDateTimeSectionWrapper:({formData:t,updateFieldGlobal:s})=>{const r={},l=(n,o)=>s&&s(n,o);return e.jsx(El,{formData:t||{},onChange:l,errors:r,hideEntryDateLabel:!0,hideEntryTimeLabel:!0})},NotesAndScreenshotsStepWrapper:({formData:t,updateFieldGlobal:s})=>{const r={},l=(o,a)=>s&&s(o,a),n=o=>!0;return e.jsx(V.Suspense,{fallback:e.jsx("div",{className:"h-24 rounded border"}),children:e.jsx(sx,{formData:t||{},onChange:l,errors:r,shouldShowField:n})})},TradeResultSelectorWrapper:({value:t,onChange:s})=>{const{currentTheme:r}=Q(),{currentLanguage:l}=Z();return e.jsx(Po,{currentTheme:r,currentLanguage:l,value:t,onChange:n=>s(n),hideLabel:!0})},TradeResultFieldWrapper:()=>{const{currentTheme:t}=Q(),{currentLanguage:s}=Z(),[r,l]=Ye("tradeResult");return e.jsx(Po,{currentTheme:t,currentLanguage:s,value:r,onChange:n=>l(n),hideLabel:!0})},TrendSelectorWrapper:({value:t,onChange:s})=>{const{currentTheme:r}=Q(),{currentLanguage:l}=Z();return e.jsx(Mo,{currentTheme:r,currentLanguage:l,value:t,onChange:n=>s(n),hideLabel:!0})},TrendFieldWrapper:()=>{const{currentTheme:t}=Q(),{currentLanguage:s}=Z(),[r,l]=Ye("trend");return e.jsx(Mo,{currentTheme:t,currentLanguage:s,value:r,onChange:n=>l(n),hideLabel:!0})},RiskRewardInputWrapper:({value:t,onChange:s})=>{const{currentTheme:r}=Q(),{currentLanguage:l}=Z();return e.jsx($l,{currentTheme:r,currentLanguage:l,value:t,onChange:n=>s(n),isEditMode:!1,hideLabel:!0})},StrategySelectorWrapper:({value:t,onChange:s})=>{const{currentTheme:r}=Q(),{currentLanguage:l}=Z(),[n,o]=V.useState(!1),[a,i]=V.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(Ro,{currentTheme:r,currentLanguage:l,value:t,onChange:c=>s(c),onSelect:c=>s(c),filteredStrategies:[],previousStrategies:[],favoriteNames:[],error:void 0,showDropdown:n,setShowDropdown:o,onOpenModal:()=>i(!0),hideLabel:!0}),a&&e.jsx(Fo,{onSelect:c=>{s(c),i(!1)},onClose:()=>i(!1),currentValue:t||""})]})},StrategyFieldWrapper:()=>{const{currentTheme:t}=Q(),{currentLanguage:s}=Z(),[r,l]=Ye("strategy"),[n,o]=V.useState(!1),[a,i]=V.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(Ro,{currentTheme:t,currentLanguage:s,value:r,onChange:c=>l(c),onSelect:c=>l(c),filteredStrategies:[],previousStrategies:[],favoriteNames:[],error:void 0,showDropdown:n,setShowDropdown:o,onOpenModal:()=>i(!0),hideLabel:!0}),a&&e.jsx(Fo,{onSelect:c=>{l(c),i(!1)},onClose:()=>i(!1),currentValue:r||""})]})},SetupSelectorWrapper:({value:t,onChange:s})=>{const{currentTheme:r}=Q(),{currentLanguage:l}=Z(),[n,o]=V.useState(""),[a,i]=V.useState(!1);return e.jsx(To,{currentTheme:r,currentLanguage:l,value:t,onChange:c=>s(c),search:n,setSearch:o,filteredSetups:[],quickSetups:[],error:void 0,showDropdown:a,setShowDropdown:i,hideLabel:!0})},SetupFieldWrapper:()=>{const{currentTheme:t}=Q(),{currentLanguage:s}=Z(),[r,l]=Ye("setup"),[n,o]=V.useState(""),[a,i]=V.useState(!1);return e.jsx(To,{currentTheme:t,currentLanguage:s,value:r,onChange:c=>l(c),search:n,setSearch:o,filteredSetups:[],quickSetups:[],error:void 0,showDropdown:a,setShowDropdown:i,hideLabel:!0})},ExitTimeSelectorWrapper:({value:t,onChange:s})=>{const{currentTheme:r}=Q(),{currentLanguage:l}=Z(),[n,o]=V.useState(null),a=m=>{const[p="0",x="0",f="0"]=(m||"").split(":"),v=(h,b)=>{const j=parseInt(h,10);return Number.isNaN(j)?0:Math.max(0,Math.min(b,j))};return{hours:v(p,23),minutes:v(x,59),seconds:v(f,59)}},{hours:i,minutes:c,seconds:d}=a(t),u=(m,p,x)=>{const f=String(Math.max(0,Math.min(23,m))).padStart(2,"0"),v=String(Math.max(0,Math.min(59,p))).padStart(2,"0"),h=String(Math.max(0,Math.min(59,x))).padStart(2,"0");s(`${f}:${v}:${h}`)};return e.jsx(Yo,{currentTheme:r,currentLanguage:l,errors:{},hours:i,minutes:c,seconds:d,active:n,setActive:o,updateTime:u,hideExitTimeLabel:!0})},SummaryPanelWrapper:()=>e.jsx(Zm,{}),PnLSummaryWrapper:()=>e.jsx(ex,{}),LeverageMarginSectionWrapper:()=>e.jsx(V.Suspense,{fallback:e.jsx("div",{className:"h-24 rounded border"}),children:e.jsx(rx,{})}),FuturesParamsSectionWrapper:()=>e.jsx(V.Suspense,{fallback:e.jsx("div",{className:"h-24 rounded border"}),children:e.jsx(ox,{})}),StatusToggleFieldWrapper:()=>{const{currentTheme:t}=Q(),{currentLanguage:s}=Z(),[r,l]=Ye("status"),n=t.colors.accent,o=t.colors.surface,a=t.colors.text,i=t.colors.border;return e.jsx("div",{className:"flex gap-2",children:["open","closed"].map(c=>e.jsx("button",{onClick:()=>l(c),className:"gpu-btn flex-1 px-2 py-1 text-sm rounded-lg border",style:{backgroundColor:r===c?n:o,color:r===c?"#ffffff":a,borderColor:r===c?n:i},children:c==="open"?s==="fr"?"Ouvert":"Open":s==="fr"?"FermÃ©":"Closed"},c))})},SideToggleFieldWrapper:()=>{const{currentTheme:t}=Q(),{currentLanguage:s}=Z(),[r,l]=Ye("side"),n=t.colors.accent,o=t.colors.surface,a=t.colors.text,i=t.colors.border;return e.jsx("div",{className:"flex gap-2",children:["long","short"].map(c=>e.jsx("button",{onClick:()=>l(c),className:"gpu-btn flex-1 px-2 py-1 text-sm rounded-lg border",style:{backgroundColor:r===c?n:o,color:r===c?"#ffffff":a,borderColor:r===c?n:i},children:c==="long"?"Long":"Short"},c))})},MarketSelectorFieldWrapper:()=>{const{currentTheme:t}=Q(),{currentLanguage:s}=Z(),[r,l]=Ye("market"),n=["futures","forex","stocks","indices","crypto","commodities"],o=u=>({futures:"Futures",forex:"Forex",stocks:s==="fr"?"Actions":"Stocks",indices:"Indices",crypto:"Crypto",commodities:s==="fr"?"MatiÃ¨res PremiÃ¨res":"Commodities"})[u]||u,a=t.colors.accent,i=t.colors.surface,c=t.colors.text,d=t.colors.border;return e.jsx("div",{className:"grid grid-cols-3 gap-2",children:n.map(u=>e.jsx("button",{onClick:()=>l(u),className:"gpu-btn w-full h-8 px-2 py-1 text-sm rounded-lg border",style:{backgroundColor:r===u?a:i,color:r===u?"#ffffff":c,borderColor:r===u?a:d},children:o(u)},u))})}},Rs=new Map;function ux(t){return typeof t=="function"?`fn:${t.toString()}`:typeof t=="boolean"?`bool:${t}`:`str:${t??"undefined"}`}function mt(t){if(t===void 0)return()=>!0;if(typeof t=="boolean")return()=>t;if(typeof t=="function")return u=>t(u);const s=ux(t),r=Rs.get(s);if(r)return r;const l=String(t).trim();if(l.length===0||l.length>200){const u=()=>!0;return Rs.set(s,u),u}if(/[^\w\s\._'"=<>!&|()\-]/.test(l)){const u=()=>!0;return Rs.set(s,u),u}if(/(\bwindow\b|\bglobalThis\b|\bdocument\b|\bself\b|\bFunction\b|\beval\b|\bconstructor\b|\bthis\b|\bXMLHttpRequest\b|\bfetch\b|\bprocess\b|\brequire\b|\bimport\b|\bmodule\b|\bexports\b|\bsetTimeout\b|\bsetInterval\b|\bDate\b)/.test(l)){const u=()=>!0;return Rs.set(s,u),u}const i=(l.match(/\(/g)||[]).length,c=(l.match(/\)/g)||[]).length;if(i!==c){const u=()=>!0;return Rs.set(s,u),u}const d=u=>{try{const m=Object.keys(u),p=m.map(f=>u[f]);return!!new Function(...m,`return (${l});`)(...p)}catch{return!0}};return Rs.set(s,d),d}function mx(t){const s=new Map;return r=>{const l=JSON.stringify(r);if(s.has(l))return s.get(l);const n=!!t(r);return s.set(l,n),n}}const fa="v3_form_preferences";function xx(){try{const t=localStorage.getItem(fa);if(!t)return{isEditMode:!1,hiddenFields:{},hiddenSections:[]};const s=JSON.parse(t);return{isEditMode:!!s.isEditMode,hiddenFields:s.hiddenFields||{},hiddenSections:s.hiddenSections||[]}}catch{return{isEditMode:!1,hiddenFields:{},hiddenSections:[]}}}let yr=null;function fx(t){try{yr!==null&&typeof window<"u"&&window.clearTimeout(yr),yr=typeof window<"u"?window.setTimeout(()=>{try{localStorage.setItem(fa,JSON.stringify(t))}catch{}yr=null},200):null}catch{}}const At=Zr((t,s)=>{const r=xx(),l=n=>{const o={isEditMode:n.isEditMode??s().isEditMode,hiddenFields:n.hiddenFields??s().hiddenFields,hiddenSections:n.hiddenSections??s().hiddenSections};fx(o)};return{isEditMode:r.isEditMode,hiddenFields:r.hiddenFields,hiddenSections:r.hiddenSections,setEditMode:n=>{t({isEditMode:n}),l({isEditMode:n})},isFieldHidden:(n,o)=>(s().hiddenFields[n]||[]).includes(String(o)),toggleFieldHidden:(n,o)=>{t(a=>{const i={...a.hiddenFields},c=new Set(i[n]||[]),d=String(o);c.has(d)?c.delete(d):c.add(d),i[n]=Array.from(c);const u={hiddenFields:i};return l(u),u})},isSectionHidden:n=>s().hiddenSections.includes(n),toggleSectionHidden:n=>{t(o=>{const a=new Set(o.hiddenSections);a.has(n)?a.delete(n):a.add(n);const i={hiddenSections:Array.from(a)};return l(i),i})},unhideAllFieldsInSection:n=>{t(o=>{const a={...o.hiddenFields};a[n]&&delete a[n];const i={hiddenFields:a};return l(i),i})},unhideAllFields:()=>{t(()=>{const n={hiddenFields:{}};return l(n),n})},resetPreferences:()=>{t({hiddenFields:{},hiddenSections:[],isEditMode:!1}),l({hiddenFields:{},hiddenSections:[],isEditMode:!1})}}}),px=({sectionId:t="instrument-context",layout:s="vertical"})=>{const r=V.useMemo(()=>wt.sections.find(y=>y.id===t),[t]),l=V.useMemo(()=>{const y=new Map;if(!r)return y;for(const N of r.fields||[]){const w={visibleIf:mt(N.visibleIf),requiredIf:N.requiredIf!==void 0?mt(N.requiredIf):void 0,rules:Array.isArray(N.rules)?N.rules.map(S=>({when:mt(S?.when),visible:S?.visible,require:S?.require})):void 0};y.set(String(N.id),w)}return y},[r]),{currentTheme:n}=Q(),{currentLanguage:o}=Z(),{formData:a,updateField:i}=xs(),[c,d]=V.useTransition(),u=V.useDeferredValue(a),m=At(y=>y.isEditMode),p=At(y=>y.hiddenFields),x=At(y=>y.toggleFieldHidden),[f,v]=V.useState(!1);if(!r||!V.useMemo(()=>mt(r.visibleIf)(u),[r?.visibleIf,u]))return null;const b=y=>y==null?!0:typeof y=="string"?y.trim()==="":typeof y=="number"?Number.isNaN(y):Array.isArray(y)?y.length===0:!1,j=(y,N)=>{const w={color:n.colors.text},S=n.colors.border,k=n.colors.surface,C=n.colors.text,P=n.colors.accent;if(y.component==="StatusToggle")return e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold",style:w,children:o==="fr"?"Statut":"Status"}),N&&e.jsx("span",{className:"px-2 py-0.5 text-[10px] rounded-full border",style:{backgroundColor:P+"20",color:P,borderColor:P+"40"},children:o==="fr"?"Requis":"Required"})]}),e.jsx("div",{className:"flex gap-2",children:["open","closed"].map(R=>e.jsx("button",{onClick:()=>i("status",R),className:`flex-1 px-2 py-1 text-sm rounded-lg border-2 transition-all duration-200 ${a.status===R?"border-0 shadow-md":"hover:shadow-sm"}`,style:{backgroundColor:a.status===R?P:k,color:a.status===R?"#ffffff":C,borderColor:a.status===R?"transparent":S},children:R==="open"?o==="fr"?"Ouvert":"Open":o==="fr"?"FermÃ©":"Closed"},R))})]});if(y.component==="SideToggle")return e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold",style:w,children:o==="fr"?"Direction":"Side"}),N&&e.jsx("span",{className:"px-2 py-0.5 text-[10px] rounded-full border",style:{backgroundColor:P+"20",color:P,borderColor:P+"40"},children:o==="fr"?"Requis":"Required"})]}),e.jsx("div",{className:"flex gap-2",children:["long","short"].map(R=>e.jsx("button",{onClick:()=>i("side",R),className:`flex-1 px-2 py-1 text-sm rounded-lg border-2 transition-all duration-200 ${a.side===R?"border-0 shadow-md":"hover:shadow-sm"}`,style:{backgroundColor:a.side===R?P:k,color:a.side===R?"#ffffff":C,borderColor:a.side===R?"transparent":S},children:R==="long"?"Long":"Short"},R))})]});if(y.component==="MarketSelector"){const R=["futures","forex","stocks","indices","crypto","commodities"],M=T=>({futures:"Futures",forex:"Forex",stocks:o==="fr"?"Actions":"Stocks",indices:"Indices",crypto:"Crypto",commodities:o==="fr"?"MatiÃ¨res PremiÃ¨res":"Commodities"})[T]||T;return e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold",style:w,children:o==="fr"?"MarchÃ©":"Market"}),N&&e.jsx("span",{className:"px-2 py-0.5 text-[10px] rounded-full border",style:{backgroundColor:P+"20",color:P,borderColor:P+"40"},children:o==="fr"?"Requis":"Required"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:R.map(T=>e.jsx("button",{onClick:()=>i("market",T),className:`w-full h-8 px-2 py-1 text-sm rounded-lg border-2 transition-all duration-200 ${a.market===T?"border-0 shadow-md":"hover:shadow-sm"}`,style:{backgroundColor:a.market===T?P:k,color:a.market===T?"#ffffff":C,borderColor:a.market===T?"transparent":S},children:M(T)},T))})]})}return null};return e.jsxs("div",{style:{contain:"layout paint style"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:n.colors.text},children:r.label}),s!=="landscape"&&e.jsx("button",{type:"button",onClick:()=>v(!f),className:"gpu-btn px-2 py-1 text-xs rounded border",style:{backgroundColor:n.colors.surface,borderColor:n.colors.border,color:n.colors.text},children:f?o==="fr"?"DÃ©plier":"Expand":o==="fr"?"Replier":"Collapse"})]}),!f&&e.jsx("div",{className:s==="landscape"?"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4":"space-y-4",children:(()=>{let y=0;return r.fields.map(N=>{const w=s==="landscape"&&(N.type==="composite"||r.id==="notes-screenshots"||N.component==="NotesAndScreenshotsStepWrapper"||N.component==="FuturesParamsSectionWrapper"||N.component==="LeverageMarginSectionWrapper"||N.component==="PnLSummaryWrapper"||N.component==="SummaryPanelWrapper"||N.component==="EntryDateTimeSectionWrapper"),S=l.get(String(N.id));let k=S?S.visibleIf(u):!0,C=!!(N.required||S?.requiredIf&&S.requiredIf(u));const P=S?.rules;if(Array.isArray(P))for(const U of P)(U?.when?U.when(u):!0)&&(typeof U.visible=="boolean"&&(k=U.visible),typeof U.require=="boolean"&&(C=U.require));if(!k)return null;const R=N.id==="side"||N.id==="market"||N.id==="symbol"||C;if(Array.isArray(p?.[r.id])&&p[r.id].includes(String(N.id))&&!R)return e.jsx("div",{className:w?"md:col-span-2":"",children:m?e.jsxs("div",{className:"flex items-center justify-between text-xs opacity-70",children:[e.jsx("span",{className:"italic",children:o==="fr"?"Champ masquÃ© (mode Ã©dition)":"Field hidden (edit mode)"}),e.jsx("button",{type:"button",onClick:()=>x(r.id,String(N.id)),className:"px-1.5 py-0.5 rounded border",style:{backgroundColor:n.colors.surface,borderColor:n.colors.border,color:n.colors.text},children:o==="fr"?"RÃ©afficher":"Show"})]}):null},String(N.id));const T=u[N.id],D=C&&b(T);D&&(y+=1);const F=dx[N.component];if(F)return e.jsxs("div",{className:w?"md:col-span-2":"",children:[N.label&&e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"block text-sm font-semibold",style:{color:n.colors.text},children:N.label}),e.jsxs("div",{className:"flex items-center gap-2",children:[m&&e.jsx("button",{type:"button",onClick:()=>!R&&x(r.id,String(N.id)),className:"px-1.5 py-0.5 text-[10px] rounded border",title:R?o==="fr"?"ProtÃ©gÃ©":"Protected":o==="fr"?"Masquer/Afficher":"Hide/Show",style:{backgroundColor:n.colors.surface,borderColor:n.colors.border,color:n.colors.text},children:R?"ðŸ”’":Array.isArray(p?.[r.id])&&p[r.id].includes(String(N.id))?"ðŸ™ˆ":"ðŸ‘ï¸"}),C&&e.jsx("span",{className:"px-2 py-0.5 text-[10px] rounded-full border",style:{backgroundColor:n.colors.accent+"20",color:n.colors.accent,borderColor:n.colors.accent+"40"},children:o==="fr"?"Requis":"Required"})]})]}),e.jsx(F,{value:u[N.id],onChange:U=>d(()=>i(N.id,U)),...N.type==="composite"?{formData:u,updateFieldGlobal:(U,B)=>d(()=>i(U,B))}:{}}),e.jsx("div",{className:"mt-1 text-xs",style:{color:n.colors.danger,opacity:D?1:0,transition:"opacity 120ms ease-out"},children:o==="fr"?"Champ requis":"Required field"})]},String(N.id));const $=j(N,C);if($){const U=s==="landscape"&&N.component==="MarketSelector";return e.jsxs("div",{className:U?"md:col-span-2":"",children:[$,e.jsx("div",{className:"mt-1 text-xs",style:{color:n.colors.danger,opacity:D?1:0,transition:"opacity 120ms ease-out"},children:o==="fr"?"Champ requis":"Required field"})]},String(N.id))}return e.jsxs("div",{className:w?"md:col-span-2":"",children:[N.label&&e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"block text-sm font-semibold",style:{color:n.colors.text},children:N.label}),C&&e.jsx("span",{className:"px-2 py-0.5 text-[10px] rounded-full border",style:{backgroundColor:n.colors.accent+"20",color:n.colors.accent,borderColor:n.colors.accent+"40"},children:o==="fr"?"Requis":"Required"})]}),e.jsx("input",{type:"text",value:String(a[N.id]??""),onChange:U=>i(N.id,U.target.value),className:"w-full px-3 py-2 border rounded-lg",style:{backgroundColor:n.colors.surface,borderColor:n.colors.border,color:n.colors.text}}),D&&e.jsx("div",{className:"mt-1 text-xs",style:{color:n.colors.danger},children:o==="fr"?"Champ requis":"Required field"})]},String(N.id))}).concat([e.jsxs("div",{className:s==="landscape"?"md:col-span-2":"",children:[r.fields.filter(N=>{if(!mt(N.visibleIf)(a))return!1;const S=!!(N.required||N.requiredIf!==void 0&&mt(N.requiredIf)(a)),k=N.id==="side"||N.id==="market"||N.id==="symbol"||S;return!(Array.isArray(p?.[r.id])&&p[r.id].includes(String(N.id))&&!k)}).length<2&&e.jsx("div",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"Cette section a peu de champs visibles.":"This section has few visible fields."}),y>0&&e.jsx("div",{className:"text-xs mt-1",style:{color:n.colors.danger},children:o==="fr"?`${y} champ(s) requis manquant(s)`:`${y} required field(s) missing`})]},"__section_hint__")])})()})]})},gt=V.memo(px),pa=Object.freeze(Object.defineProperty({__proto__:null,SectionRenderer:gt},Symbol.toStringTag,{value:"Module"})),ha="v3-form-mode";function hx(){try{const t=localStorage.getItem(ha);if(!t)return null;const s=JSON.parse(t);return!s||typeof s!="object"?null:{mode:s.mode||"deck",deckLayout:s.deckLayout}}catch{return null}}let br=null;function gx(t){try{br!==null&&typeof window<"u"&&window.clearTimeout(br),br=typeof window<"u"?window.setTimeout(()=>{try{localStorage.setItem(ha,JSON.stringify(t))}catch{}br=null},250):null}catch{}}const yo={order:["context","entry","exit","performance","notes"],hidden:[]},Ds=Zr()((t,s)=>{const r=typeof window<"u"?hx():null,l=r?.mode||"add",n=r?.deckLayout||yo,o=a=>{const i={mode:a.mode??s().mode,deckLayout:a.deckLayout??s().deckLayout};gx(i)};return{mode:l,deckLayout:n,setMode:a=>{t({mode:a}),o({mode:a})},setDeckLayout:a=>{t({deckLayout:a}),o({deckLayout:a})},toggleHidden:a=>{const{deckLayout:i}=s(),c=i.hidden.includes(a)?i.hidden.filter(u=>u!==a):[...i.hidden,a],d={...i,hidden:c};t({deckLayout:d}),o({deckLayout:d})},reorder:a=>{const{deckLayout:i}=s(),c={...i,order:a};t({deckLayout:c}),o({deckLayout:c})},resetLayout:()=>{t({deckLayout:yo}),o({deckLayout:yo})}}});function ga(t){return t==null?!0:typeof t=="string"?t.trim()==="":typeof t=="number"?Number.isNaN(t):Array.isArray(t)?t.length===0:!1}function yx(t){const s=[];for(const r of wt.sections)if(mx(mt(r.visibleIf))(t))for(const n of r.fields){const o=mt(n.visibleIf),a=n.requiredIf!==void 0?mt(n.requiredIf):void 0;let i=o(t),c=!!n.required||(a?a(t):!1);const d=n.rules;if(Array.isArray(d))for(const m of d)mt(m?.when)(t)&&(typeof m.visible=="boolean"&&(i=m.visible),typeof m.require=="boolean"&&(c=m.require));if(!i||!c)continue;const u=t[n.id];ga(u)&&s.push({sectionId:r.id,fieldId:String(n.id),label:n.label,message:"required"})}return s}function $s(t,s){const r=[],l=new Set(s);for(const n of wt.sections)if(!(!l.has(n.id)||!mt(n.visibleIf)(t)))for(const a of n.fields){const i=mt(a.visibleIf),c=a.requiredIf!==void 0?mt(a.requiredIf):void 0;let d=i(t),u=!!a.required||(c?c(t):!1);const m=a.rules;if(Array.isArray(m))for(const x of m)mt(x?.when)(t)&&(typeof x.visible=="boolean"&&(d=x.visible),typeof x.require=="boolean"&&(u=x.require));if(!d||!u)continue;const p=t[a.id];ga(p)&&r.push({sectionId:n.id,fieldId:String(a.id),label:a.label,message:"required"})}return r}function _n(t,s){const r=wt.sections.find(c=>c.id===t);if(!r)return{filled:0,total:0,percentage:0};const l=c=>c==null?!0:typeof c=="string"?c.trim()==="":typeof c=="number"?Number.isNaN(c):Array.isArray(c)?c.length===0:!1,o=(r.fields||[]).filter(c=>c.type==="composite"?!1:mt(c.visibleIf)(s)).filter(c=>!!(c.required||c.requiredIf!==void 0&&mt(c.requiredIf)(s))),a=o.length,i=o.filter(c=>!l(s[c.id])).length;return{filled:i,total:a,percentage:a>0?Math.round(i/a*100):0}}function vr(t){switch(t){case"instrument-context":return"context";case"position-entry":return"entry";case"position-exit":return"exit";case"risk-reward":return"performance";case"notes-screenshots":return"notes";default:return null}}function bs(t){switch(t){case"context":return"instrument-context";case"entry":return"position-entry";case"exit":return"position-exit";case"performance":return"risk-reward";case"notes":return"notes-screenshots"}}const ya=()=>{const{currentTheme:t}=Q(),{currentLanguage:s}=Z(),r=Ds(A=>A.deckLayout),l=Ds(A=>A.toggleHidden),n=Ds(A=>A.resetLayout),o=Ds(A=>A.reorder),{formData:a,updateField:i}=xs(),c=At(A=>A.isEditMode),d=At(A=>A.setEditMode),u=At(A=>A.unhideAllFields),m=At(A=>A.hiddenFields);At(A=>A.unhideAllFieldsInSection);const p=At(A=>A.hiddenSections),[x,f]=V.useState(null),[v,h]=V.useState("normal"),b=V.useCallback(A=>f(_=>_===A?null:A),[]),[j,y]=V.useState(!1),[N,w]=V.useState(null);V.useEffect(()=>{if(x){y(!1);const A=setTimeout(()=>y(!0),150);return w(S),()=>clearTimeout(A)}w(null)},[x]);const S=V.useDeferredValue(a),k=V.useMemo(()=>new Set((p||[]).map(A=>vr(A)).filter(Boolean)),[p]),C=V.useMemo(()=>new Set([...r.hidden,...Array.from(k)]),[r.hidden,k]),P=V.useMemo(()=>r.order.filter(A=>!C.has(A)),[r.order,C]),R=V.useMemo(()=>P.map(bs),[P]),M=V.useMemo(()=>x?$s(S,[x]):$s(S,R),[S,x,R]),T=V.useMemo(()=>new Set(M.map(A=>A.sectionId)),[M]),[D,F]=V.useState({}),$=V.useRef(null);V.useEffect(()=>{const A=J=>{const re={};for(const de of J)re[de]=_n(de,S);F(de=>({...de,...re}))},_=x?[x]:R;return $.current&&window.clearTimeout($.current),$.current=window.setTimeout(()=>A(_),80),()=>{$.current&&window.clearTimeout($.current)}},[S,x,R]);const U=V.useCallback((A,_)=>_n(A,_),[]),B=A=>{const _=wt.sections.find(re=>re.id===A);if(!_)return;const J={entryDateTime:["entryDate","entryTime"],futuresParams:["tickSize","tickValue"],leverageMargin:["leverage","marginRatePercent","marginUsed"],pnlSummary:[],summaryPanel:[],notesAndPsycho:["notes","screenshots"]};_.fields?.forEach(re=>{re.type==="composite"?(J[String(re.id)]||[]).forEach(se=>i(se,"")):i(re.id,"")})},O=en(or(xr,{activationConstraint:{distance:15}}));V.useEffect(()=>{try{rs(()=>Promise.resolve().then(()=>pa),void 0,import.meta.url)}catch{}},[]),V.useEffect(()=>{const A=_=>{if(!x)return;const J=document.activeElement,re=J?.tagName==="INPUT"||J?.tagName==="TEXTAREA"||J?.tagName==="SELECT",de=new Set(r.hidden),se=r.order.filter(he=>!de.has(he)),ke=vr(x);if(!ke)return;const be=se.indexOf(ke);if(_.key==="Tab"&&!re)if(_.preventDefault(),_.shiftKey){const he=(be-1+se.length)%se.length;f(bs(se[he]))}else{const he=(be+1)%se.length;f(bs(se[he]))}else _.key==="Escape"&&f(null)};return window.addEventListener("keydown",A),()=>window.removeEventListener("keydown",A)},[x,r.hidden,r.order]);const[z,q]=V.useState(null),E=A=>{q(A.active.id)},I=A=>{q(null)},H=A=>{const{active:_,over:J}=A;if(q(null),!J||_.id===J.id)return;const re=new Set(r.hidden),de=r.order.filter(W=>!re.has(W)),se=de.indexOf(_.id),ke=de.indexOf(J.id);if(se===-1||ke===-1)return;const be=Ss(de,se,ke),he=r.order.filter(W=>re.has(W)),te=[...be,...he];o(te)},L=V.useMemo(()=>({compact:"grid-cols-1 md:grid-cols-3 xl:grid-cols-4",normal:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3",comfortable:"grid-cols-1 md:grid-cols-2"})[v],[v]);return e.jsx(Aa,{children:e.jsxs("div",{className:"space-y-4",children:[!x&&e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(),className:"px-3 py-1.5 rounded border text-xs hover:shadow-sm transition-all",style:{backgroundColor:t.colors.surface,color:t.colors.text,borderColor:t.colors.border},children:s==="fr"?"RÃ©initialiser":"Reset"}),e.jsx("button",{onClick:()=>d(!c),className:"px-3 py-1.5 rounded border text-xs hover:shadow-sm transition-all",style:{backgroundColor:c?t.colors.accent+"20":t.colors.surface,color:c?t.colors.accent:t.colors.text,borderColor:c?t.colors.accent:t.colors.border},children:s==="fr"?c?"âœ“ Mode Ã©dition":"Mode Ã©dition":c?"âœ“ Edit mode":"Edit mode"}),c&&e.jsx("button",{onClick:()=>u(),className:"px-3 py-1.5 rounded border text-xs hover:shadow-sm transition-all",style:{backgroundColor:t.colors.surface,color:t.colors.text,borderColor:t.colors.border},title:s==="fr"?"Tout rÃ©afficher":"Show all",children:s==="fr"?"Tout rÃ©afficher":"Show all"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textMuted},children:s==="fr"?"Grille:":"Grid:"}),["compact","normal","comfortable"].map(A=>e.jsx("button",{onClick:()=>h(A),className:"px-2 py-1 rounded text-xs transition-all",style:{backgroundColor:v===A?t.colors.accent+"20":t.colors.surface,color:v===A?t.colors.accent:t.colors.text,borderWidth:"1px",borderStyle:"solid",borderColor:v===A?t.colors.accent:t.colors.border},children:A==="compact"?"â–«â–«â–«":A==="normal"?"â–«â–«":"â–«"},A))]})]}),x&&e.jsx(dn,{children:e.jsx(Ks.div,{initial:{opacity:0},animate:{opacity:.5},exit:{opacity:0},transition:{duration:.12},className:"fixed inset-0 bg-black/60 z-40",onClick:()=>f(null),style:{willChange:"opacity"}},"deck-overlay")}),x?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(()=>{const A=new Set(r.hidden),_=vr(x);return r.order.filter(re=>!A.has(re)&&re!==_).map(re=>{const de=bs(re),se=wt.sections.find(ke=>ke.id===de);return se?e.jsxs("div",{className:"rounded-xl border opacity-50",style:{backgroundColor:t.colors.card,borderColor:t.colors.border},children:[e.jsx("div",{className:"px-4 py-3 border-b",style:{borderColor:t.colors.border},children:e.jsx("div",{className:"text-sm",style:{color:t.colors.text},children:se.label})}),e.jsx("div",{className:"px-4 py-3 text-xs",style:{color:t.colors.textMuted},children:ba(re,N||{},s)})]},re):null})})()}):e.jsx(Ar,{sensors:O,collisionDetection:Fr,measuring:{droppable:{strategy:Ls.BeforeDragging}},onDragStart:E,onDragCancel:I,onDragEnd:H,children:(()=>{const A=At.getState().hiddenSections,_=new Set(A.map(de=>vr(de)).filter(Boolean)),J=new Set([...r.hidden,...Array.from(_)]),re=r.order.filter(de=>!J.has(de));return e.jsxs(e.Fragment,{children:[e.jsx(nr,{items:re,strategy:ln,children:e.jsx("div",{className:`grid ${L} gap-4 transition-all duration-300`,style:{pointerEvents:x?"none":"auto"},children:re.map(de=>{const se=bs(de),ke=wt.sections.find(K=>K.id===se);if(!ke)return null;const be=x===se,he=D[se]||U(se,S),te=T.has(se),W=jx(de,S);return e.jsx(bx,{id:de,disabled:!!x,children:K=>e.jsx(vx,{keyId:de,sectionId:se,schemaSection:ke,isOpen:be,currentTheme:t,currentLanguage:s,isEditMode:c,hiddenFieldsPref:m,gridSize:v,hasIssues:te,progress:he,previewData:W,onResetSection:B,onToggleHidden:ue=>{const ye=bs(ue);ye&&At.getState().toggleSectionHidden(ye),l(ue)},onOpen:b,dragProps:K})},de)})})}),e.jsx(nn,{children:z?(()=>{const de=bs(z),se=wt.sections.find(ke=>ke.id===de);return se?e.jsx("div",{className:"rounded-lg border shadow-sm px-4 py-3",style:{backgroundColor:t.colors.card,borderColor:t.colors.border},children:e.jsx("div",{className:"text-sm font-medium",style:{color:t.colors.text},children:se.label})}):null})():null})]})})()}),e.jsx(dn,{children:x&&e.jsx(Ks.div,{className:"fixed inset-0 z-50 flex items-center justify-center p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},onClick:()=>f(null),style:{willChange:"opacity"},children:e.jsxs(Ks.div,{layoutId:`deck-card-${x}`,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.12,ease:"easeOut"},className:"rounded-xl border shadow-xl overflow-hidden",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,width:"90vw",maxWidth:"1300px",height:"90vh",maxHeight:"950px",willChange:"opacity",contain:"layout paint style"},onClick:A=>A.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",style:{borderColor:t.colors.border},children:[e.jsx("div",{className:"text-base font-semibold",style:{color:t.colors.text},children:wt.sections.find(A=>A.id===x)?.label}),e.jsx("button",{onClick:()=>f(null),className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:t.colors.surface,color:t.colors.text,borderColor:t.colors.border},children:s==="fr"?"Fermer":"Close"})]}),e.jsx("div",{className:"p-4 h-[calc(100%-56px)] overflow-y-auto",children:j?e.jsx(gt,{sectionId:x,layout:"landscape"}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-6 w-48 rounded",style:{backgroundColor:t.colors.surface}}),e.jsx("div",{className:"h-4 w-full rounded",style:{backgroundColor:t.colors.surface}}),e.jsx("div",{className:"h-4 w-full rounded",style:{backgroundColor:t.colors.surface}}),e.jsx("div",{className:"h-4 w-2/3 rounded",style:{backgroundColor:t.colors.surface}})]})})]})},"deck-centered-modal")})]})})},bx=({id:t,children:s,disabled:r})=>{const{attributes:l,listeners:n,setNodeRef:o,transform:a,transition:i,isDragging:c}=an({id:t,disabled:r}),d={transform:Zt.Transform.toString(a),transition:i,opacity:c?.85:1,cursor:r?"default":"grab"};return e.jsx("div",{ref:o,style:d,children:s(r?{}:{...l,...n})})},vx=V.memo(({keyId:t,sectionId:s,schemaSection:r,isOpen:l,currentTheme:n,currentLanguage:o,isEditMode:a,hiddenFieldsPref:i,gridSize:c,hasIssues:d,progress:u,previewData:m,onResetSection:p,onToggleHidden:x,onOpen:f,dragProps:v})=>{const[h,b]=V.useState(!1),[j,y]=V.useState(!1),N=V.useRef(null);V.useEffect(()=>{const k=N.current;if(!k||typeof IntersectionObserver>"u"){b(!0);return}const C=new IntersectionObserver(P=>{for(const R of P)if(R.isIntersecting){b(!0),C.disconnect();break}},{root:null,threshold:.1});return C.observe(k),()=>C.disconnect()},[]);const w=u.percentage===100&&!d,S=l||j;return e.jsxs(Ks.div,{ref:N,layout:"position",transition:{layout:{duration:.25,ease:"easeInOut"}},layoutId:`deck-card-${s}`,className:`relative rounded-xl border-2 transition-all cursor-pointer flex flex-col ${l?"z-50 shadow-md scale-105":w?"border-green-500/30 hover:border-green-500/50 opacity-95 hover:opacity-100 hover:shadow-sm":d?"border-orange-500/25 hover:border-orange-500/40 opacity-90 hover:opacity-100 hover:shadow-sm":"opacity-85 hover:opacity-100 hover:shadow-sm"}`,style:{backgroundColor:n.colors.card,borderColor:w?"rgba(34, 197, 94, 0.3)":d?"rgba(249, 115, 22, 0.25)":n.colors.border,willChange:"transform, opacity",contain:"layout paint style",minHeight:c==="compact"?"180px":c==="normal"?"200px":"220px"},onClick:()=>{l||f(s)},onMouseEnter:()=>{rs(()=>Promise.resolve().then(()=>pa),void 0,import.meta.url),y(!0)},onMouseLeave:()=>y(!1),children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 rounded-t-xl overflow-hidden",style:{backgroundColor:n.colors.surface},children:S?e.jsx(Ks.div,{initial:{width:0},animate:{width:`${u.percentage}%`},transition:{duration:.4,ease:"easeOut"},className:"h-full",style:{backgroundColor:w?"rgba(34, 197, 94, 0.9)":d?"rgba(249, 115, 22, 0.85)":n.colors.accent}}):e.jsx("div",{className:"h-full",style:{width:`${u.percentage}%`,backgroundColor:w?"rgba(34, 197, 94, 0.9)":d?"rgba(249, 115, 22, 0.85)":n.colors.accent}})}),e.jsxs("div",{className:"pt-3 px-4 pb-2 flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"p-1 cursor-grab select-none hover:bg-white/5 rounded",title:o==="fr"?"DÃ©placer":"Drag",...v,children:e.jsx("span",{className:"text-sm opacity-50",children:"â‰¡"})}),e.jsx("h3",{className:"text-sm font-semibold truncate",style:{color:n.colors.text},children:r.label})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[a&&Array.isArray(i?.[s])&&i[s].length>0&&e.jsx("button",{onClick:k=>{k.stopPropagation(),At.getState().unhideAllFieldsInSection(s)},className:"p-1 text-xs rounded hover:bg-white/10 transition-colors",style:{color:n.colors.textMuted},title:o==="fr"?"RÃ©afficher tous les champs de la section":"Show all fields in section",children:"âŸ³"}),w?e.jsx("span",{className:"px-1.5 py-0.5 text-[10px] rounded-full",style:{backgroundColor:"rgba(34, 197, 94, 0.2)",color:"rgb(34, 197, 94)"},children:"âœ“"}):d?e.jsx("span",{className:"px-1.5 py-0.5 text-[10px] rounded-full",style:{backgroundColor:"rgba(249, 115, 22, 0.2)",color:"rgb(249, 115, 22)"},children:"âš "}):null,e.jsx("button",{onClick:k=>{k.stopPropagation(),p(s)},className:"p-1 text-xs rounded hover:bg-white/10 transition-colors",style:{color:n.colors.textMuted},title:o==="fr"?"RÃ©initialiser":"Reset",children:"â†»"}),e.jsx("button",{onClick:k=>{k.stopPropagation(),x(t)},className:"p-1 text-xs rounded hover:bg-white/10 transition-colors",style:{color:n.colors.textMuted},title:o==="fr"?"Masquer":"Hide",children:"Ã—"})]})]}),e.jsx("div",{className:"space-y-1.5 text-[11px] flex-1 overflow-hidden",style:{color:n.colors.textMuted},children:h?ba(t,m,o):null}),e.jsxs("div",{className:"mt-auto pt-2 border-t flex items-center justify-between flex-shrink-0",style:{borderColor:n.colors.border},children:[e.jsxs("span",{className:"text-[10px]",style:{color:n.colors.textMuted},children:[u.filled,"/",u.total," ",o==="fr"?"champs":"fields"]}),e.jsxs("span",{className:"text-[10px] font-medium",style:{color:n.colors.text},children:[u.percentage,"%"]})]})]})]})});function ba(t,s,r){const l=(n,o="â€”")=>n!=null&&n!==""?String(n):o;switch(t){case"context":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:r==="fr"?"Symbole:":"Symbol:"}),e.jsx("span",{className:"font-medium",children:l(s.symbol)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:r==="fr"?"MarchÃ©:":"Market:"}),e.jsx("span",{children:l(s.market)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:"Direction:"}),e.jsx("span",{children:l(s.side,"â€”")})]})]});case"entry":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:"Date:"}),e.jsx("span",{className:"font-medium",children:l(s.entryDate)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:r==="fr"?"Prix:":"Price:"}),e.jsx("span",{children:l(s.entryPrice)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:r==="fr"?"QuantitÃ©:":"Quantity:"}),e.jsx("span",{children:l(s.quantity)})]})]});case"exit":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:r==="fr"?"Statut:":"Status:"}),e.jsx("span",{className:"font-medium",children:l(s.status,r==="fr"?"En cours":"Pending")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:r==="fr"?"Prix:":"Price:"}),e.jsx("span",{children:l(s.exitPrice)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:"P&L:"}),e.jsx("span",{className:s.pnl&&parseFloat(s.pnl)>0?"text-green-500":s.pnl&&parseFloat(s.pnl)<0?"text-red-500":"",children:l(s.pnl)})]})]});case"performance":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:r==="fr"?"StratÃ©gie:":"Strategy:"}),e.jsx("span",{className:"font-medium truncate",children:l(s.strategy)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:r==="fr"?"RÃ©sultat:":"Result:"}),e.jsx("span",{children:l(s.result)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:"R:R:"}),e.jsx("span",{children:l(s.riskReward)})]})]});case"notes":const n=s.notes||"",o=Array.isArray(s.screenshots)?s.screenshots.length:0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:"Note:"}),e.jsx("span",{className:"truncate",children:n?n.substring(0,30)+(n.length>30?"...":""):"â€”"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:"Screenshots:"}),e.jsx("span",{children:o>0?o:"â€”"})]})]});default:return e.jsx("span",{className:"opacity-50",children:r==="fr"?"Aucune donnÃ©e":"No data"})}}function jx(t,s){switch(t){case"context":return{symbol:s.symbol,market:s.market,side:s.side};case"entry":return{entryDate:s.entryDate,entryPrice:s.entryPrice,quantity:s.quantity};case"exit":return{status:s.status,exitPrice:s.exitPrice,pnl:s.pnl};case"performance":return{strategy:s.strategy,result:s.result,riskReward:s.riskReward};case"notes":return{notes:s.notes,screenshots:s.screenshots};default:return{}}}const Nx=({currentStepId:t,onStepClick:s,disabledSteps:r=[],stepIds:l})=>{const{currentTheme:n}=Q(),{currentLanguage:o,t:a}=Z(),{formData:i}=xs(),c=V.useDeferredValue(i),d=V.useMemo(()=>(l&&l.length>0?l:["instrument-context","position-entry","position-exit","risk-reward","notes-screenshots"]).filter(v=>!!wt.sections.find(h=>h.id===v)),[l]),u=V.useMemo(()=>d.map(v=>({id:v,label:(()=>{switch(v){case"instrument-context":return a.instrument___contexte||(o==="fr"?"Instrument & Contexte":"Instrument & Context");case"position-entry":return a.position__entr_e_||(o==="fr"?"Position (EntrÃ©e)":"Position (Entry)");case"position-exit":return a.sortie___frais||(o==="fr"?"Sortie & Frais":"Exit & Fees");case"risk-reward":return a.setup___risque||(o==="fr"?"Setup & Risque":"Setup & Risk");case"notes-screenshots":return a.notes___screenshots||"Notes & Screenshots";default:return v}})()})),[d,o,a]),[m,p]=V.useState(new Set),x=V.useRef(null);V.useEffect(()=>(x.current&&window.clearTimeout(x.current),x.current=window.setTimeout(()=>{const v=new Set(d.filter(h=>$s(c,[h]).length===0));p(v),x.current=null},50),()=>{x.current&&window.clearTimeout(x.current)}),[c,d]);const f=Math.max(0,d.indexOf(t));return e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:"flex-1 rounded-full h-3",style:{backgroundColor:n.colors.border+"40"},children:e.jsx("div",{className:"h-3 rounded-full gpu-progress",style:{backgroundColor:n.colors.accent,transform:`scaleX(${Math.max(0,Math.min(1,(f+1)/u.length))})`}})})}),e.jsx("div",{className:"flex flex-wrap items-center mt-2",style:{gap:"16px"},children:u.map((v,h)=>{const b=m.has(v.id),j=t===v.id,y=r.includes(v.id);return e.jsxs("div",{className:"relative flex items-center",children:[e.jsxs("button",{onClick:()=>{y||s(v.id)},disabled:y,className:`gpu-btn flex items-center px-4 py-2.5 text-base font-medium ${j?"shadow-md":b?"hover:opacity-100":"hover:opacity-90"} ${y?"cursor-not-allowed opacity-40":"cursor-pointer"}`,style:{backgroundColor:j?`${n.colors.accent}20`:"transparent",color:j?"#ffffff":b?n.colors.accent:n.colors.textSecondary,border:`2px solid ${j?n.colors.accent:b?n.colors.accent+"40":n.colors.border}`,clipPath:"polygon(8px 0, 100% 0, calc(100% - 8px) 100%, 0 100%)",position:"relative"},children:[e.jsx("div",{className:"mr-2.5",children:b?e.jsx("span",{style:{color:n.colors.accent},children:"âœ“"}):e.jsx("div",{className:"w-4 h-4 rounded-full border-2",style:{borderColor:n.colors.border,backgroundColor:n.colors.surface}})}),e.jsx("span",{children:v.label})]}),h<u.length-1&&e.jsx("div",{className:"flex items-center justify-center",style:{width:"20px",height:"28px",color:j?n.colors.accent:b?n.colors.accent+"40":n.colors.border,fontSize:"36px",fontWeight:"bold"},children:"â†’"})]},v.id)})})]})},kx=V.memo(Nx),va=()=>{const{currentTheme:t}=Q(),{currentLanguage:s}=Z(),{formData:r}=xs(),l=V.useDeferredValue(r),n=V.useMemo(()=>["instrument-context","position-entry","position-exit","risk-reward","notes-screenshots"].filter(j=>!!wt.sections.find(y=>y.id===j)),[]),o=V.useMemo(()=>n.map(j=>wt.sections.find(y=>y.id===j)),[n]),[a,i]=V.useState(0),c=o[a],d=o[a+1];V.useEffect(()=>{if(!d)return;const j={NotesAndScreenshotsStepWrapper:()=>rs(()=>import("./NotesAndScreenshotsStep-Cw0raGbu.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),LeverageMarginSectionWrapper:()=>rs(()=>import("./V3LeverageMarginSection-CiPTlafK.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url),FuturesParamsSectionWrapper:()=>rs(()=>import("./V3FuturesParamsSection-C1MXMILK.js"),__vite__mapDeps([6,1,2,3,4]),import.meta.url)};try{for(const y of d.fields||[]){const N=j[y.component];N&&N()}}catch{}},[a,d]);const u=V.useMemo(()=>$s(l,[c.id]),[l,c.id]),m=u.length===0,[p,x]=V.useState(0),f=V.useRef(null);V.useEffect(()=>{const j=()=>{const y=n.reduce((N,w)=>N+($s(r,[w]).length===0?1:0),0);x(y)};return f.current&&window.clearTimeout(f.current),f.current=window.setTimeout(j,100),()=>{f.current&&window.clearTimeout(f.current)}},[l,n]);const v=j=>{j<0||j>=o.length||(i(j),requestAnimationFrame(()=>{const y=document.getElementById("v3-wizard-scroll");y&&(y.scrollTop=0)}))},h=()=>{a<o.length-1&&v(a+1)},b=()=>{a>0&&v(a-1)};return V.useEffect(()=>{const j=y=>{const N=(document.activeElement?.tagName||"").toLowerCase(),w=N==="input"||N==="textarea"||N==="select";y.key==="ArrowRight"&&!w&&(y.preventDefault(),m&&h()),y.key==="ArrowLeft"&&!w&&(y.preventDefault(),b()),y.key==="Enter"&&!w&&(y.preventDefault(),m&&h())};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[m,a,o.length]),e.jsxs("div",{className:"flex flex-col h-full",style:{color:t.colors.text},children:[e.jsx("div",{className:"mb-4",children:e.jsx(kx,{currentStepId:c.id,onStepClick:j=>{const y=n.indexOf(j);y!==-1&&v(y)},stepIds:n})}),e.jsx("div",{className:"rounded-lg border p-3 mb-2",style:{borderColor:t.colors.border,backgroundColor:t.colors.card},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"px-2 py-0.5 rounded text-xs",style:{backgroundColor:t.colors.surface,color:t.colors.text},children:[s==="fr"?"Ã‰tape":"Step"," ",a+1,"/",o.length]}),e.jsx("h4",{className:"text-sm font-semibold",style:{color:t.colors.text},children:c.label})]}),!m&&e.jsx("div",{className:"text-xs",style:{color:t.colors.danger},children:s==="fr"?`${u.length} champ(s) requis manquant(s)`:`${u.length} required field(s) missing`})]})}),e.jsxs("div",{id:"v3-wizard-scroll",className:"flex-1 overflow-y-auto rounded-lg border p-4",style:{borderColor:t.colors.border,backgroundColor:t.colors.card},children:[e.jsx(gt,{sectionId:c.id,layout:"landscape"},c.id),d?e.jsx("div",{style:{display:"none"},"aria-hidden":!0,children:e.jsx(gt,{sectionId:d.id,layout:"landscape"},`preload-${d.id}`)}):null]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx("button",{onClick:b,disabled:a===0,className:"gpu-btn px-3 py-1.5 rounded border text-sm",style:{backgroundColor:t.colors.surface,color:t.colors.text,borderColor:t.colors.border,opacity:a===0?.5:1},children:s==="fr"?"Retour":"Back"}),e.jsx("button",{onClick:h,disabled:!m||a===o.length-1,className:"gpu-btn px-3 py-1.5 rounded border text-sm",style:{backgroundColor:m?t.colors.accent:t.colors.surface,color:m?"#fff":t.colors.text,borderColor:m?"transparent":t.colors.border,opacity:a===o.length-1?.5:1},children:s==="fr"?"Suivant":"Next"})]})]})},ja=()=>{const{currentTheme:t}=Q(),{currentLanguage:s}=Z(),{formData:r}=xs(),n=["instrument-context","position-entry","position-exit","risk-reward","notes-screenshots"].map(d=>wt.sections.find(u=>u.id===d)).filter(Boolean),[o,a]=V.useState({"notes-screenshots":!0}),i=d=>{a(u=>({...u,[d]:!u[d]}))},c=d=>$s(r,[d]).length===0?"complete":"incomplete";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:[n[0]&&e.jsx(Gs,{section:n[0],status:c(n[0].id),collapsed:o[n[0].id],onToggle:()=>i(n[0].id),currentTheme:t,currentLanguage:s}),n[1]&&e.jsx(Gs,{section:n[1],status:c(n[1].id),collapsed:o[n[1].id],onToggle:()=>i(n[1].id),currentTheme:t,currentLanguage:s}),n[2]&&e.jsx(Gs,{section:n[2],status:c(n[2].id),collapsed:o[n[2].id],onToggle:()=>i(n[2].id),currentTheme:t,currentLanguage:s})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[n[3]&&e.jsx(Gs,{section:n[3],status:c(n[3].id),collapsed:o[n[3].id],onToggle:()=>i(n[3].id),currentTheme:t,currentLanguage:s}),n[4]&&e.jsx(Gs,{section:n[4],status:c(n[4].id),collapsed:o[n[4].id],onToggle:()=>i(n[4].id),currentTheme:t,currentLanguage:s})]})]})},Gs=({section:t,status:s,collapsed:r,onToggle:l,currentTheme:n,currentLanguage:o})=>{const a=s==="complete";return e.jsxs("div",{className:"rounded-xl border-2 transition-all",style:{backgroundColor:n.colors.card,borderColor:a?"rgba(34, 197, 94, 0.3)":n.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b cursor-pointer",style:{borderColor:n.colors.border},onClick:l,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold",style:{color:n.colors.text},children:t.label}),a&&e.jsx("span",{className:"text-xs",style:{color:"rgb(34, 197, 94)"},children:"âœ“"})]}),e.jsx("button",{type:"button",className:"text-xs px-2 py-1 rounded",style:{color:n.colors.textMuted},children:r?"â–¼":"â–²"})]}),!r&&e.jsx("div",{className:"p-4",children:e.jsx(gt,{sectionId:t.id})})]})},wx=()=>{const{currentTheme:t}=Q(),{currentLanguage:s}=Z(),{formData:r,computed:l,settings:n,setSettings:o,updateField:a,updateFields:i}=xs(),{mode:c,setMode:d}=Ds(),[u,m]=V.useState(!0);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:`p-4 grid ${u?"grid-cols-1 lg:grid-cols-2":"grid-cols-1"} gap-6`,style:{color:t.colors.text},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm",style:{color:t.colors.textMuted},children:"Mode:"}),e.jsxs("select",{value:c,onChange:p=>d(p.target.value),className:"px-2 py-1 rounded border text-sm",style:{backgroundColor:t.colors.surface,color:t.colors.text,borderColor:t.colors.border},children:[e.jsx("option",{value:"add",children:"Add"}),e.jsx("option",{value:"form",children:"Form"}),e.jsx("option",{value:"deck",children:"Deck"}),e.jsx("option",{value:"wizard",children:"Wizard"})]}),e.jsx("button",{className:"px-2 py-1 rounded border text-xs",style:{backgroundColor:t.colors.surface,color:t.colors.text,borderColor:t.colors.border},onClick:()=>m(p=>!p),title:s==="fr"?u?"Masquer Debug":"Afficher Debug":u?"Hide Debug":"Show Debug",children:s==="fr"?u?"Masquer Debug":"Afficher Debug":u?"Hide Debug":"Show Debug"})]}),c==="add"?e.jsx(ja,{}):c==="deck"?e.jsx(ya,{}):c==="wizard"?e.jsx(va,{}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"V3 Demo â€” Instrument & Contexte"}),e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:t.colors.border,backgroundColor:t.colors.card},children:e.jsx(gt,{sectionId:"instrument-context"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"V3 Demo â€” EntrÃ©e de position"}),e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:t.colors.border,backgroundColor:t.colors.card},children:e.jsx(gt,{sectionId:"position-entry"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"V3 Demo â€” Sortie de position"}),e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:t.colors.border,backgroundColor:t.colors.card},children:e.jsx(gt,{sectionId:"position-exit"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"V3 Demo â€” Performance & StratÃ©gie"}),e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:t.colors.border,backgroundColor:t.colors.card},children:e.jsx(gt,{sectionId:"risk-reward"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"V3 Demo â€” Notes & Psychologie"}),e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:t.colors.border,backgroundColor:t.colors.card},children:e.jsx(gt,{sectionId:"notes-screenshots"})})]})]}),u&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Debug / MÃ©triques"}),e.jsxs("div",{className:"rounded-lg border p-3 text-sm space-y-3",style:{borderColor:t.colors.border,backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm",style:{color:t.colors.text},children:"Capital (equity):"}),e.jsx("input",{type:"number",className:"px-2 py-1 border rounded",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,color:t.colors.text},value:Number(n.equity??1e4),onChange:p=>o(x=>({...x,equity:Number(p.target.value||0)}))})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm",style:{color:t.colors.text},children:"PnL Entry Mode:"}),e.jsxs("select",{className:"px-2 py-1 border rounded",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,color:t.colors.text},value:r.pnlEntryMode??"detailed",onChange:p=>a("pnlEntryMode",p.target.value),children:[e.jsx("option",{value:"detailed",children:"detailed"}),e.jsx("option",{value:"direct",children:"direct"})]}),e.jsx("label",{className:"text-sm",style:{color:t.colors.text},children:"PnL Mode:"}),e.jsxs("select",{className:"px-2 py-1 border rounded",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,color:t.colors.text},value:r.pnlMode??"percentage",onChange:p=>a("pnlMode",p.target.value),children:[e.jsx("option",{value:"percentage",children:"percentage"}),e.jsx("option",{value:"absolute",children:"absolute"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("button",{className:"px-3 py-1 rounded border",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,color:t.colors.text},onClick:()=>{const x=new Date().toISOString().split("T")[0];i({status:"closed",side:"long",market:"futures",symbol:"ES",date:x,entryDate:x,entryTime:"09:00:00",entryPrice:4200,quantity:1,tickSize:.25,tickValue:5,exitDate:x,exitTime:"10:00:00",exitPrice:4202,fees_commission:-2.5,pnlEntryMode:"detailed",pnlMode:"percentage"})},children:"Prefill (Futures / Long)"}),e.jsx("button",{className:"px-3 py-1 rounded border",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,color:t.colors.text},onClick:()=>{const x=new Date().toISOString().split("T")[0];i({status:"closed",side:"short",market:"stocks",symbol:"AAPL",date:x,entryDate:x,entryTime:"09:30:00",entryPrice:180,quantity:10,exitDate:x,exitTime:"15:45:00",exitPrice:178.5,fees_commission:-1.2,pnlEntryMode:"detailed",pnlMode:"percentage"})},children:"Prefill (Spot / Short)"}),e.jsx("button",{className:"px-3 py-1 rounded border",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,color:t.colors.text},onClick:()=>{i({}),o({equity:1e4})},children:"Reset"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs opacity-70",children:"formData"}),e.jsx("pre",{className:"text-xs overflow-auto p-2 rounded",style:{backgroundColor:t.colors.card,border:`1px solid ${t.colors.border}`},children:JSON.stringify(r,null,2)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs opacity-70",children:"computed"}),e.jsx("pre",{className:"text-xs overflow-auto p-2 rounded",style:{backgroundColor:t.colors.card,border:`1px solid ${t.colors.border}`},children:JSON.stringify(l,null,2)})]})]})]})]})]})})},Vn=()=>e.jsx(xa,{children:e.jsx(wx,{})});var Sx={lessThanXSeconds:{one:"moins dâ€™une seconde",other:"moins de {{count}} secondes"},xSeconds:{one:"1 seconde",other:"{{count}} secondes"},halfAMinute:"30 secondes",lessThanXMinutes:{one:"moins dâ€™une minute",other:"moins de {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"environ 1 heure",other:"environ {{count}} heures"},xHours:{one:"1 heure",other:"{{count}} heures"},xDays:{one:"1 jour",other:"{{count}} jours"},aboutXWeeks:{one:"environ 1 semaine",other:"environ {{count}} semaines"},xWeeks:{one:"1 semaine",other:"{{count}} semaines"},aboutXMonths:{one:"environ 1 mois",other:"environ {{count}} mois"},xMonths:{one:"1 mois",other:"{{count}} mois"},aboutXYears:{one:"environ 1 an",other:"environ {{count}} ans"},xYears:{one:"1 an",other:"{{count}} ans"},overXYears:{one:"plus dâ€™un an",other:"plus de {{count}} ans"},almostXYears:{one:"presquâ€™un an",other:"presque {{count}} ans"}},Cx=function(s,r,l){var n,o=Sx[s];return typeof o=="string"?n=o:r===1?n=o.one:n=o.other.replace("{{count}}",String(r)),l!=null&&l.addSuffix?l.comparison&&l.comparison>0?"dans "+n:"il y a "+n:n},Px={full:"EEEE d MMMM y",long:"d MMMM y",medium:"d MMM y",short:"dd/MM/y"},Mx={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},Rx={full:"{{date}} 'Ã ' {{time}}",long:"{{date}} 'Ã ' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Tx={date:no({formats:Px,defaultWidth:"full"}),time:no({formats:Mx,defaultWidth:"full"}),dateTime:no({formats:Rx,defaultWidth:"full"})},Dx={lastWeek:"eeee 'dernier Ã ' p",yesterday:"'hier Ã ' p",today:"'aujourdâ€™hui Ã ' p",tomorrow:"'demain Ã ' p'",nextWeek:"eeee 'prochain Ã ' p",other:"P"},Fx=function(s,r,l,n){return Dx[s]},Ex={narrow:["av. J.-C","ap. J.-C"],abbreviated:["av. J.-C","ap. J.-C"],wide:["avant JÃ©sus-Christ","aprÃ¨s JÃ©sus-Christ"]},Ax={narrow:["T1","T2","T3","T4"],abbreviated:["1er trim.","2Ã¨me trim.","3Ã¨me trim.","4Ã¨me trim."],wide:["1er trimestre","2Ã¨me trimestre","3Ã¨me trimestre","4Ã¨me trimestre"]},Lx={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["janv.","fÃ©vr.","mars","avr.","mai","juin","juil.","aoÃ»t","sept.","oct.","nov.","dÃ©c."],wide:["janvier","fÃ©vrier","mars","avril","mai","juin","juillet","aoÃ»t","septembre","octobre","novembre","dÃ©cembre"]},$x={narrow:["D","L","M","M","J","V","S"],short:["di","lu","ma","me","je","ve","sa"],abbreviated:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],wide:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]},zx={narrow:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"mat.",afternoon:"ap.m.",evening:"soir",night:"mat."},abbreviated:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"matin",afternoon:"aprÃ¨s-midi",evening:"soir",night:"matin"},wide:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"du matin",afternoon:"de lâ€™aprÃ¨s-midi",evening:"du soir",night:"du matin"}},Ix=function(s,r){var l=Number(s),n=r?.unit;if(l===0)return"0";var o=["year","week","hour","minute","second"],a;return l===1?a=n&&o.includes(n)?"Ã¨re":"er":a="Ã¨me",l+a},Ox={ordinalNumber:Ix,era:Vs({values:Ex,defaultWidth:"wide"}),quarter:Vs({values:Ax,defaultWidth:"wide",argumentCallback:function(s){return s-1}}),month:Vs({values:Lx,defaultWidth:"wide"}),day:Vs({values:$x,defaultWidth:"wide"}),dayPeriod:Vs({values:zx,defaultWidth:"wide"})},qx=/^(\d+)(iÃ¨me|Ã¨re|Ã¨me|er|e)?/i,Ux=/\d+/i,Wx={narrow:/^(av\.J\.C|ap\.J\.C|ap\.J\.-C)/i,abbreviated:/^(av\.J\.-C|av\.J-C|apr\.J\.-C|apr\.J-C|ap\.J-C)/i,wide:/^(avant JÃ©sus-Christ|aprÃ¨s JÃ©sus-Christ)/i},_x={any:[/^av/i,/^ap/i]},Vx={narrow:/^T?[1234]/i,abbreviated:/^[1234](er|Ã¨me|e)? trim\.?/i,wide:/^[1234](er|Ã¨me|e)? trimestre/i},Bx={any:[/1/i,/2/i,/3/i,/4/i]},Hx={narrow:/^[jfmasond]/i,abbreviated:/^(janv|fÃ©vr|mars|avr|mai|juin|juill|juil|aoÃ»t|sept|oct|nov|dÃ©c)\.?/i,wide:/^(janvier|fÃ©vrier|mars|avril|mai|juin|juillet|aoÃ»t|septembre|octobre|novembre|dÃ©cembre)/i},Gx={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^av/i,/^ma/i,/^juin/i,/^juil/i,/^ao/i,/^s/i,/^o/i,/^n/i,/^d/i]},Jx={narrow:/^[lmjvsd]/i,short:/^(di|lu|ma|me|je|ve|sa)/i,abbreviated:/^(dim|lun|mar|mer|jeu|ven|sam)\.?/i,wide:/^(dimanche|lundi|mardi|mercredi|jeudi|vendredi|samedi)/i},Kx={narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^di/i,/^lu/i,/^ma/i,/^me/i,/^je/i,/^ve/i,/^sa/i]},Yx={narrow:/^(a|p|minuit|midi|mat\.?|ap\.?m\.?|soir|nuit)/i,any:/^([ap]\.?\s?m\.?|du matin|de l'aprÃ¨s[-\s]midi|du soir|de la nuit)/i},Xx={any:{am:/^a/i,pm:/^p/i,midnight:/^min/i,noon:/^mid/i,morning:/mat/i,afternoon:/ap/i,evening:/soir/i,night:/nuit/i}},Qx={ordinalNumber:Oa({matchPattern:qx,parsePattern:Ux,valueCallback:function(s){return parseInt(s)}}),era:Bs({matchPatterns:Wx,defaultMatchWidth:"wide",parsePatterns:_x,defaultParseWidth:"any"}),quarter:Bs({matchPatterns:Vx,defaultMatchWidth:"wide",parsePatterns:Bx,defaultParseWidth:"any",valueCallback:function(s){return s+1}}),month:Bs({matchPatterns:Hx,defaultMatchWidth:"wide",parsePatterns:Gx,defaultParseWidth:"any"}),day:Bs({matchPatterns:Jx,defaultMatchWidth:"wide",parsePatterns:Kx,defaultParseWidth:"any"}),dayPeriod:Bs({matchPatterns:Yx,defaultMatchWidth:"any",parsePatterns:Xx,defaultParseWidth:"any"})},rt={code:"fr",formatDistance:Cx,formatLong:Tx,formatRelative:Fx,localize:Ox,match:Qx,options:{weekStartsOn:1,firstWeekContainsDate:4}};const Na=({trade:t,onClose:s})=>{const[r,l]=g.useState(0),[n,o]=g.useState(!1),{currentLanguage:a}=Z(),{currentTheme:i}=Q(),c=g.useRef(null),d=(t.screenshots||[]).map(b=>typeof b=="string"?{url:b,caption:""}:b);if(d.length===0)return null;const u=()=>{l(b=>(b+1)%d.length)},m=()=>{l(b=>(b-1+d.length)%d.length)},p=()=>{const b=document.createElement("a");b.href=d[r].url,b.download=`${t.symbol}_${t.date}_${r+1}.png`,b.click()},x=()=>{o(!n)},f=()=>{window.open(d[r].url,"_blank")},v=d[r];g.useEffect(()=>{const b=c.current;b&&b.focus()},[]);const h=b=>{b.key==="Escape"&&(b.stopPropagation(),s())};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-50",role:"dialog","aria-modal":"true","aria-labelledby":"screenshot-modal-title",tabIndex:-1,ref:c,onKeyDown:h,children:e.jsxs("div",{className:`relative ${n?"w-full h-full":"max-w-6xl max-h-full w-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 theme-surface rounded-t-lg",children:[e.jsxs("div",{className:"theme-text",children:[e.jsxs("h3",{id:"screenshot-modal-title",className:"text-lg font-semibold flex items-center",children:[t.symbol," - ",t.date&&!isNaN(new Date(t.date).getTime())?st(new Date(t.date),"dd/MM/yyyy",{locale:rt}):"N/A",v.caption&&e.jsx("span",{className:"ml-4 px-3 py-1 theme-surface rounded-lg text-sm",children:v.caption})]}),e.jsxs("p",{className:"text-sm theme-text-muted",children:[t.strategy," â€¢ ",t.side==="long"?"Long":"Short"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:x,className:"p-2 theme-text hover:theme-surface rounded-lg transition-colors","aria-label":n?a==="fr"?"Quitter le plein Ã©cran":"Exit fullscreen":a==="fr"?"Plein Ã©cran":"Fullscreen",title:n?a==="fr"?"Quitter le plein Ã©cran":"Exit fullscreen":a==="fr"?"Plein Ã©cran":"Fullscreen",children:e.jsx(Za,{size:20})}),e.jsx("button",{onClick:f,className:"p-2 theme-text hover:theme-surface rounded-lg transition-colors","aria-label":a==="fr"?"Ouvrir dans un nouvel onglet":"Open in new tab",title:a==="fr"?"Ouvrir dans un nouvel onglet":"Open in new tab",children:e.jsx(Xa,{size:20})}),e.jsx("button",{onClick:p,className:"p-2 theme-text hover:theme-surface rounded-lg transition-colors","aria-label":a==="fr"?"TÃ©lÃ©charger":"Download",title:a==="fr"?"TÃ©lÃ©charger":"Download",children:e.jsx(cr,{size:20})}),e.jsx("button",{onClick:s,className:"p-2 theme-text hover:theme-surface rounded-lg transition-colors","aria-label":a==="fr"?"Fermer":"Close",title:a==="fr"?"Fermer":"Close",children:e.jsx(Ne,{size:20})})]})]}),e.jsxs("div",{className:"relative bg-gray-800",children:[e.jsx("img",{src:v.url,alt:v.caption||`Screenshot ${r+1}`,className:"w-full h-auto max-h-[70vh] object-contain"}),d.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:m,className:"absolute left-4 top-1/2 transform -translate-y-1/2 p-2 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-all","aria-label":a==="fr"?"Image prÃ©cÃ©dente":"Previous image",children:e.jsx(as,{size:24})}),e.jsx("button",{onClick:u,className:"absolute right-4 top-1/2 transform -translate-y-1/2 p-2 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-all","aria-label":a==="fr"?"Image suivante":"Next image",children:e.jsx(Is,{size:24})})]}),d.length>1&&e.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 px-3 py-1 bg-black bg-opacity-50 text-white rounded-full text-sm",children:[r+1," / ",d.length]})]}),d.length>1&&e.jsx("div",{className:"flex justify-center space-x-2 p-4 bg-gray-900 rounded-b-lg",children:d.map((b,j)=>e.jsx("button",{onClick:()=>l(j),className:`w-16 h-16 rounded-lg overflow-hidden border-2 transition-all ${j===r?"border-2":"theme-border hover:theme-border"}`,style:{borderColor:j===r?i.colors.accent:"var(--theme-border)"},title:b.caption||`Screenshot ${j+1}`,children:e.jsx("img",{src:b.url,alt:b.caption||`Thumbnail ${j+1}`,className:"w-full h-full object-cover"})},j))})]})})},Ms=()=>{const{currentLanguage:t}=Z();return{formatCurrency:(a,i="EUR")=>{const c=t==="fr"?"fr-FR":"en-US",d=t==="fr"?i:i==="EUR"?"USD":i;return new Intl.NumberFormat(c,{style:"currency",currency:d,minimumFractionDigits:2,maximumFractionDigits:2}).format(a)},formatPercentage:a=>`${a>=0?"+":""}${a.toFixed(2)}%`,formatDate:a=>{const i=t==="fr"?"fr-FR":"en-US";return(typeof a=="string"?new Date(a):a).toLocaleDateString(i,{year:"numeric",month:"short",day:"numeric"})},formatNumber:(a,i=2)=>{const c=t==="fr"?"fr-FR":"en-US";return new Intl.NumberFormat(c,{minimumFractionDigits:i,maximumFractionDigits:i}).format(a)},formatDuration:a=>{if(!a||a===0)return"-";const i=Math.floor(a/3600),c=Math.floor(a%3600/60);return i>0?`${i}h ${c}m`:c>0?`${c}m`:`${a}s`}}},Ws=({trade:t,settings:s,onClose:r,onEdit:l,onDelete:n})=>{const{currentTheme:o}=Q(),{currentLanguage:a}=Z(),{formatCurrency:i,formatPercentage:c,formatDuration:d}=Ms(),[u,m]=g.useState("info"),[p,x]=g.useState(!1),f=V.useMemo(()=>Cr(t,s,"equity",2),[t,s]),h=(()=>{if(!t.tradeResult)return{label:"-",color:o.colors.text};switch(t.tradeResult){case"tp":return{label:"Take Profit",color:o.colors.success,bgColor:"var(--theme-success)"};case"sl":return{label:"Stop Loss",color:o.colors.danger,bgColor:"var(--theme-danger)"};case"be":return{label:"Break Even",color:o.colors.warning,bgColor:"var(--theme-warning)"};default:return{label:"-",color:o.colors.text,bgColor:"var(--theme-surface)"}}})(),b=()=>t.market==="futures"?`${t.quantity||0} ${a==="fr"?"contrats":"contracts"}`:t.numberOfLots!==void 0&&t.numberOfLots!==null?`${t.numberOfLots} lots`:`${t.quantity||0} lots`,j=(t.screenshots||[]).map(y=>typeof y=="string"?{url:y,caption:""}:y);return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50",children:[e.jsxs("div",{className:"theme-surface rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col",style:{backgroundColor:o.colors.card,color:o.colors.text},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",style:{borderColor:o.colors.border},children:[e.jsxs("h2",{className:"text-xl font-semibold",style:{color:o.colors.text},children:[a==="fr"?"DÃ©tails du Trade":"Trade Details"," - ",t.symbol," - ",t.date&&!isNaN(new Date(t.date).getTime())?st(new Date(t.date),"dd/MM/yyyy",{locale:a==="fr"?rt:dt}):"N/A"]}),e.jsx("button",{onClick:r,className:"theme-text-muted hover:theme-text transition-colors",children:e.jsx(Ne,{size:24})})]}),e.jsxs("div",{className:"flex border-b",style:{borderColor:o.colors.border},children:[e.jsx("button",{onClick:()=>m("info"),className:`px-6 py-3 text-sm font-medium transition-colors ${u==="info"?"border-b-2":"border-b-2 border-transparent"}`,style:{color:u==="info"?o.colors.accent:o.colors.textSecondary,borderBottomColor:u==="info"?o.colors.accent:"transparent"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Fs,{size:16,className:"mr-2"}),a==="fr"?"Informations":"Information"]})}),e.jsx("button",{onClick:()=>m("notes"),className:`px-6 py-3 text-sm font-medium transition-colors ${u==="notes"?"border-b-2":"border-b-2 border-transparent"}`,style:{color:u==="notes"?o.colors.accent:o.colors.textSecondary,borderBottomColor:u==="notes"?o.colors.accent:"transparent"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ws,{size:16,className:"mr-2"}),"Notes"]})}),e.jsx("button",{onClick:()=>m("screenshots"),className:`px-6 py-3 text-sm font-medium transition-colors ${u==="screenshots"?"border-b-2":"border-b-2 border-transparent"}`,style:{color:u==="screenshots"?o.colors.accent:o.colors.textSecondary,borderBottomColor:u==="screenshots"?o.colors.accent:"transparent"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(fl,{size:16,className:"mr-2"}),"Screenshots",j.length>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs rounded-full",style:{backgroundColor:o.colors.accent+"20",color:o.colors.accent},children:j.length})]})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[u==="info"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:o.colors.text},children:a==="fr"?"Informations de base":"Basic Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"Date & Heure:":"Date & Time:"}),e.jsxs("span",{className:"font-medium",style:{color:o.colors.text},children:[t.date&&!isNaN(new Date(t.date).getTime())?st(new Date(t.date),"dd/MM/yyyy",{locale:a==="fr"?rt:dt}):"N/A"," ",t.time]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"Symbole:":"Symbol:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:t.symbol})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:"Direction:"}),e.jsx("span",{className:"font-medium",style:{color:t.side==="long"?o.colors.success:o.colors.danger,fontWeight:o.id==="ultra-dark"?"600":"500"},children:t.side==="long"?"Long":"Short"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"Prix d'entrÃ©e:":"Entry Price:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:t.entryPrice})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"Prix de sortie:":"Exit Price:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:t.exitPrice||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"QuantitÃ©:":"Quantity:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:b()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"MarchÃ©:":"Market:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:t.market==="futures"?"Futures":t.market==="forex"?"Forex":t.market==="crypto"?"Crypto":t.market==="stocks"?a==="fr"?"Actions":"Stocks":t.market==="indices"?"Indices":a==="fr"?"MatiÃ¨res premiÃ¨res":"Commodities"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"Tendance:":"Trend:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:t.trend==="bullish"?a==="fr"?"HaussiÃ¨re":"Bullish":t.trend==="bearish"?a==="fr"?"BaissiÃ¨re":"Bearish":a==="fr"?"LatÃ©rale":"Sideways"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:o.colors.text},children:"Performance"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"P&L Brut:":"Gross P&L:"}),e.jsx("span",{className:"font-medium",style:{color:f.gross.greaterThanOrEqualTo(0)?o.colors.success:o.colors.danger},children:i(f.gross.toNumber(),s.currency)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:"P&L %:"}),e.jsx("span",{className:"font-medium",style:{color:f.percent.greaterThanOrEqualTo(0)?o.colors.success:o.colors.danger},children:c(f.percent.toNumber())})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:f.totalFees.greaterThanOrEqualTo(0)?"Rebate:":a==="fr"?"Frais:":"Fees:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.warning},children:i(f.totalFees.toNumber(),s.currency)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"P&L Net:":"Net P&L:"}),e.jsx("span",{className:"font-medium",style:{color:f.net.greaterThanOrEqualTo(0)?o.colors.success:o.colors.danger},children:i(f.net.toNumber(),s.currency)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"P&L Net %:":"Net P&L %:"}),e.jsx("span",{className:"font-medium",style:{color:f.percent.greaterThanOrEqualTo(0)?o.colors.success:o.colors.danger},children:c(f.percent.toNumber())})]}),t.riskReward!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:"Risk/Reward:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:t.riskReward.toFixed(2)})]}),t.duration!==void 0&&t.duration>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"DurÃ©e:":"Duration:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:d(t.duration)})]}),t.ticksGained!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:"Ticks:"}),e.jsxs("span",{className:"font-medium",style:{color:(t.ticksGained||0)>=0?o.colors.success:o.colors.danger},children:[t.ticksGained>0?"+":"",t.ticksGained," ticks"]})]}),t.tradeResult&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"RÃ©sultat:":"Result:"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:h.bgColor}}),e.jsx("span",{className:"font-medium",style:{color:h.color},children:h.label})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:o.colors.text},children:a==="fr"?"StratÃ©gie & Setup":"Strategy & Setup"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"StratÃ©gie:":"Strategy:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:t.strategy})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:"Setup:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:t.setup||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:"Timeframe:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:t.timeframe||"-"})]}),t.tags&&t.tags.length>0&&e.jsxs("div",{children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:"Tags:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:t.tags.map((y,N)=>e.jsx("span",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:o.colors.accent+"20",color:o.colors.accent},children:y},N))})]})]})]}),t.fees&&Object.values(t.fees).some(y=>y!==void 0&&y!==0)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:o.colors.text},children:a==="fr"?"Frais DÃ©taillÃ©s":"Detailed Fees"}),e.jsxs("div",{className:"space-y-3",children:[t.fees.commission!==void 0&&t.fees.commission!==0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:"Commission:"}),e.jsx("span",{className:"font-medium",style:{color:"var(--theme-warning)"},children:i(t.fees.commission,s.currency)})]}),t.fees.spread!==void 0&&t.fees.spread!==0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:"Spread:"}),e.jsx("span",{className:"font-medium",style:{color:"var(--theme-warning)"},children:i(t.fees.spread,s.currency)})]}),t.fees.swapOvernight!==void 0&&t.fees.swapOvernight!==0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"Swap Overnight:":"Overnight Swap:"}),e.jsx("span",{className:"font-medium",style:{color:"var(--theme-warning)"},children:i(t.fees.swapOvernight,s.currency)})]}),t.fees.exchangeFees!==void 0&&t.fees.exchangeFees!==0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"Frais d'Ã‰change:":"Exchange Fees:"}),e.jsx("span",{className:"font-medium",style:{color:"var(--theme-warning)"},children:i(t.fees.exchangeFees,s.currency)})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t",style:{borderColor:o.colors.border},children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"Total des Frais:":"Total Fees:"}),e.jsx("span",{className:"font-medium",style:{color:"var(--theme-warning)"},children:i(t.fees.total||0,s.currency)})]})]})]})]}),u==="notes"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:o.colors.text},children:a==="fr"?"Notes & Commentaires":"Notes & Comments"}),t.notes?e.jsx("div",{className:"p-4 rounded-lg whitespace-pre-wrap",style:{backgroundColor:o.colors.surface,color:o.colors.textSecondary},children:t.notes}):e.jsx("div",{className:"p-4 rounded-lg text-center",style:{backgroundColor:o.colors.surface,color:o.colors.textMuted},children:a==="fr"?"Aucune note pour ce trade. Modifiez le trade pour ajouter des notes.":"No notes for this trade. Edit the trade to add notes."})]}),u==="screenshots"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:o.colors.text},children:a==="fr"?"Screenshots du Trade":"Trade Screenshots"}),j.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:j.map((y,N)=>e.jsxs("div",{className:"border rounded-lg overflow-hidden cursor-pointer",style:{borderColor:o.colors.border},onClick:()=>x(!0),children:[e.jsx("img",{src:y.url,alt:y.caption||`Screenshot ${N+1}`,className:"w-full h-48 object-cover"}),y.caption&&e.jsx("div",{className:"p-3 border-t",style:{borderColor:o.colors.border,backgroundColor:o.colors.surface},children:e.jsx("p",{className:"text-sm",style:{color:o.colors.textSecondary},children:y.caption})})]},N))}):e.jsx("div",{className:"p-4 rounded-lg text-center",style:{backgroundColor:o.colors.surface,color:o.colors.textMuted},children:a==="fr"?"Aucun screenshot pour ce trade. Modifiez le trade pour ajouter des screenshots.":"No screenshots for this trade. Edit the trade to add screenshots."})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t",style:{borderColor:o.colors.border},children:[e.jsxs("button",{onClick:()=>{window.confirm(a==="fr"?"ÃŠtes-vous sÃ»r de vouloir supprimer ce trade ?":"Are you sure you want to delete this trade?")&&(n(t.id),r())},className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:o.colors.danger,color:"#ffffff"},children:[e.jsx(Qt,{size:16}),e.jsx("span",{children:a==="fr"?"Supprimer":"Delete"})]}),e.jsxs("button",{onClick:()=>{l(t),r()},className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:o.colors.accent,color:"#ffffff"},children:[e.jsx(Vo,{size:16}),e.jsx("span",{children:a==="fr"?"Modifier":"Edit"})]}),e.jsx("button",{onClick:r,className:"px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:o.colors.surface,color:o.colors.text,border:`1px solid ${o.colors.border}`},children:a==="fr"?"Fermer":"Close"})]})]}),p&&e.jsx(Na,{trade:t,onClose:()=>x(!1)})]})},Zx=t=>{const[s,r]=g.useState("date"),[l,n]=g.useState("desc"),o=g.useCallback(i=>{r(c=>c===i?(n(d=>d==="asc"?"desc":"asc"),c):(n("desc"),i))},[]),a=g.useMemo(()=>[...t].sort((c,d)=>{let u=c[s],m=d[s];return s==="date"?(u=new Date(c.date+" "+(c.time||"00:00")).getTime(),m=new Date(d.date+" "+(d.time||"00:00")).getTime()):s==="pnl"?(u=c.pnl||0,m=d.pnl||0):s==="pnlPercentage"?(u=c.pnlPercentage||0,m=d.pnlPercentage||0):s==="duration"?(u=c.duration||0,m=d.duration||0):s==="ticksGained"?(u=c.ticksGained||0,m=d.ticksGained||0):s==="fees"?(u=c.fees?.total||c.commission||0,m=d.fees?.total||d.commission||0):typeof u=="string"&&typeof m=="string"&&(u=u.toLowerCase(),m=m.toLowerCase()),l==="asc"?u>m?1:-1:u<m?1:-1}),[t,s,l]);return{sortField:s,sortDirection:l,handleSort:o,sortedTrades:a}},ef=t=>{if(!t||t.length===0)return{symbols:["ES","RTY","NQ","YM","EURUSD","GBPUSD"],strategies:["Scalping","Swing","Breakout"],markets:["Futures","Forex","Crypto"],tags:["Matin","Breakout","Support"],pnlSuggestions:[">100",">500","<-100"],timeframes:["5s","15s","30s","1m","5m"],quantities:["1","2","3"],durations:["Court","Moyen","Long"],ticksSuggestions:[">10",">20","<-5","<-10"],setups:["Breakout","Support","Resistance","News"]};const s=t.reduce((S,k)=>(k.symbol&&(S[k.symbol]=(S[k.symbol]||0)+1),S),{}),r=Object.entries(s).sort(([,S],[,k])=>k-S).slice(0,8).map(([S])=>S),l=t.reduce((S,k)=>(k.strategy&&(S[k.strategy]=(S[k.strategy]||0)+1),S),{}),n=Object.entries(l).sort(([,S],[,k])=>k-S).slice(0,6).map(([S])=>S),o=t.reduce((S,k)=>(k.market&&(S[k.market]=(S[k.market]||0)+1),S),{}),a=Object.entries(o).sort(([,S],[,k])=>k-S).slice(0,4).map(([S])=>S),c=t.flatMap(S=>S.tags||[]).reduce((S,k)=>(S[k]=(S[k]||0)+1,S),{}),d=Object.entries(c).sort(([,S],[,k])=>k-S).slice(0,6).map(([S])=>S),u=t.reduce((S,k)=>(k.timeframe&&(S[k.timeframe]=(S[k.timeframe]||0)+1),S),{}),m=Object.entries(u).sort(([,S],[,k])=>k-S).slice(0,6).map(([S])=>S),p=t.reduce((S,k)=>(k.quantity&&(S[k.quantity.toString()]=(S[k.quantity.toString()]||0)+1),S),{}),x=Object.entries(p).sort(([,S],[,k])=>k-S).slice(0,4).map(([S])=>S),f=t.map(S=>S.duration||0).filter(S=>S>0).sort((S,k)=>S-k),v=[];if(f.length>0){const S=f.reduce((C,P)=>C+P,0)/f.length,k=Math.max(...f);S<60&&v.push("Court"),S>=60&&S<300&&v.push("Moyen"),k>=300&&v.push("Long")}const h=t.map(S=>S.ticksGained||0).filter(S=>S!==0).sort((S,k)=>S-k),b=[];if(h.length>0){const S=Math.max(...h),k=Math.min(...h);S>10&&b.push(">10"),S>20&&b.push(">20"),S>50&&b.push(">50"),k<-5&&b.push("<-5"),k<-10&&b.push("<-10"),k<-20&&b.push("<-20")}const j=t.reduce((S,k)=>(k.setup&&(S[k.setup]=(S[k.setup]||0)+1),S),{}),y=Object.entries(j).sort(([,S],[,k])=>k-S).slice(0,6).map(([S])=>S),N=t.map(S=>S.pnl||0).filter(S=>S!==0).sort((S,k)=>S-k),w=[];if(N.length>0){const S=Math.min(...N),k=Math.max(...N),C=N[Math.trunc(N.length/2)];k>50&&w.push(">50"),k>100&&w.push(">100"),k>200&&w.push(">200"),k>500&&w.push(">500"),k>1e3&&w.push(">1000"),S<-50&&w.push("<-50"),S<-100&&w.push("<-100"),S<-200&&w.push("<-200"),C>0&&w.push(`>${Math.trunc(C)}`)}return{symbols:r.length>0?r:["ES","RTY","NQ"],strategies:n.length>0?n:["Scalping","Swing"],markets:a.length>0?a:["Futures","Forex"],tags:d.length>0?d:["Matin","Breakout"],pnlSuggestions:w.length>0?w:[">100","<-100"],timeframes:m.length>0?m:["5s","15s","30s","1m"],quantities:x.length>0?x:["1","2"],durations:v.length>0?v:["Court","Moyen","Long"],ticksSuggestions:b.length>0?b:[">10","<-5"],setups:y.length>0?y:["Breakout","Support","News"]}},tf=(t,s,r)=>{const l=s.toLowerCase();if(r.symbols.includes(s))return!!(t.symbol&&t.symbol.toLowerCase()===l);if(r.strategies.includes(s))return!!(t.strategy&&t.strategy.toLowerCase()===l);if(r.markets.includes(s))return!!(t.market&&t.market.toLowerCase()===l);if(r.tags.includes(s))return!!(t.tags&&t.tags.some(n=>n.toLowerCase()===l));if(r.timeframes.includes(s))return!!(t.timeframe&&t.timeframe.toLowerCase()===l);if(r.quantities.includes(s))return!!(t.quantity&&t.quantity.toString()===s);if(r.durations.includes(s)){const n=t.duration||0;return s==="Court"?n<60:s==="Moyen"?n>=60&&n<300:s==="Long"?n>=300:!1}if(r.ticksSuggestions.includes(s)){const n=t.ticksGained||0;if(s.startsWith(">")){const o=s.slice(1),a=Number.parseFloat(o);return Number.isFinite(a)&&n>a}if(s.startsWith("<")){const o=s.slice(1),a=Number.parseFloat(o);return Number.isFinite(a)&&n<a}}if(r.setups.includes(s))return!!(t.setup&&t.setup.toLowerCase()===l);if(s.startsWith(">")||s.startsWith("<")){const n=t.pnl||0;if(s.startsWith(">")){const o=s.slice(1),a=Number.parseFloat(o);return Number.isFinite(a)&&n>a}if(s.startsWith("<")){const o=s.slice(1),a=Number.parseFloat(o);return Number.isFinite(a)&&n<a}}return l==="gagnant"?(t.pnl||0)>0:l==="perdant"?(t.pnl||0)<0:l==="long"?t.side==="long":l==="short"?t.side==="short":l==="open"||l==="ouvert"?t.status==="open":l==="closed"||l==="fermÃ©"?t.status==="closed":t.symbol&&t.symbol.toLowerCase().includes(l)||t.strategy&&t.strategy.toLowerCase().includes(l)||t.market&&t.market.toLowerCase().includes(l)||t.notes&&t.notes.toLowerCase().includes(l)||t.tags&&t.tags.some(n=>n.toLowerCase().includes(l))||t.date&&t.date.toLowerCase().includes(l)||t.time&&t.time.toLowerCase().includes(l)||t.side&&t.side.toLowerCase().includes(l)||t.status&&t.status.toLowerCase().includes(l)},sf=t=>{const[s,r]=g.useState(""),[l,n]=g.useState(!1),[o,a]=g.useState([]),i=g.useMemo(()=>ef(t),[t]),c=g.useMemo(()=>o.length===0?0:t.filter(u=>o.some(m=>tf(u,m,i))).length,[t,o,i]),d=g.useCallback(()=>{o.length>0&&(r(o.join(" ")),a([]),n(!1))},[o]);return{searchTerm:s,setSearchTerm:r,showSuggestionsModal:l,setShowSuggestionsModal:n,selectedSuggestions:o,setSelectedSuggestions:a,dynamicSuggestions:i,matchingTradesCount:c,applySelectedSuggestions:d}},rf=()=>{const[t,s]=g.useState(null),[r,l]=g.useState(null),[n,o]=g.useState(null),a=g.useCallback(d=>{s(u=>u===d?null:d)},[]),i=g.useCallback((d,u,m)=>{m.stopPropagation(),o(d)},[]),c=g.useCallback((d,u)=>{d.stopPropagation(),u()},[]);return{expandedTrade:t,showScreenshots:r,selectedTrade:n,setShowScreenshots:l,setSelectedTrade:o,toggleExpand:a,handleRowClick:i,handleActionClick:c}},of=({title:t,countText:s,searchTerm:r,onSearchChange:l,onOpenSuggestions:n})=>e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("h3",{className:"text-lg font-medium theme-text",children:[t,e.jsx("span",{className:"text-sm ml-2 theme-text-muted",children:s})]})}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",placeholder:"ðŸ” Rechercher dans les trades... (symbole, stratÃ©gie, notes, >100, gagnant, etc.)",value:r,onChange:o=>l(o.target.value),className:"w-full pl-10 pr-4 py-3 text-sm border rounded-lg focus:outline-none focus:ring-2 transition-all"}),e.jsx(vt,{size:18,className:"absolute left-3 top-1/2 transform -translate-y-1/2 theme-text-muted"}),r&&e.jsx("button",{onClick:()=>l(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 p-1 rounded-full hover:theme-surface transition-colors",title:"Effacer la recherche",children:e.jsx(Ne,{size:16,className:"theme-text-muted hover:theme-text"})})]}),e.jsxs("button",{onClick:n,className:"px-4 py-3 text-sm theme-surface theme-text-secondary border theme-border rounded-lg hover:theme-surface transition-colors cursor-pointer flex items-center space-x-2",title:"Voir toutes les suggestions de recherche",children:[e.jsx(hl,{size:16}),e.jsx("span",{children:"Suggestions"})]})]})})]}),nf=({trade:t,index:s,trades:r,settings:l,locale:n,colors:o,formatCurrency:a,formatPercentage:i,formatDuration:c,onRowClick:d,onEdit:u,onDelete:m,onActionClick:p,netPnL:x,netPnLPercentage:f})=>e.jsxs("tr",{className:"border-b transition-colors hover:theme-surface",style:{borderColor:o.border,cursor:"pointer"},tabIndex:0,onClick:v=>d(t,s,v),onKeyDown:v=>{(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),d(t,s,v))},children:[e.jsxs("td",{className:"px-4 py-3",style:{color:o.text},children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(yt,{size:16,className:"mr-2",style:{color:o.textMuted}}),t.date&&!isNaN(new Date(t.date).getTime())?st(new Date(t.date),"dd/MM/yyyy",{locale:n==="fr"?rt:dt}):"N/A"]}),e.jsx("div",{className:"text-xs",style:{color:o.textMuted},children:t.time})]}),e.jsxs("td",{className:"px-4 py-3",style:{color:o.text},children:[e.jsx("div",{className:"font-medium",children:t.symbol}),e.jsx("div",{className:"text-xs",style:{color:o.textMuted},children:t.market==="futures"?"Futures":t.market==="forex"?"Forex":t.market==="crypto"?"Crypto":t.market==="stocks"?n==="fr"?"Actions":"Stocks":t.market==="indices"?"Indices":n==="fr"?"MatiÃ¨res premiÃ¨res":"Commodities"})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsxs("div",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",style:{backgroundColor:t.side==="long"?`${o.success}20`:`${o.danger}20`,color:t.side==="long"?o.success:o.danger},children:[t.side==="long"?e.jsx(Ys,{size:12,className:"mr-1"}):e.jsx(cl,{size:12,className:"mr-1"}),t.side==="long"?"Long":"Short"]}),t.tradeResult&&e.jsx("div",{className:"mt-1 flex justify-center",children:e.jsx("span",{className:x>0?"text-green-500":x<0?"text-red-500":"theme-text-muted",children:"â—"})})]}),e.jsx("td",{className:"px-4 py-3",style:{color:o.text},children:e.jsx("div",{className:"font-medium",children:t.market==="futures"?`${t.quantity||0} ${n==="fr"?"contrats":"contracts"}`:`${t.numberOfLots||0} lots`})}),e.jsx("td",{className:"px-4 py-3",style:{color:o.text},children:e.jsx("div",{className:"font-medium",children:t.timeframe||"-"})}),e.jsx("td",{className:"px-4 py-3",style:{color:o.text},children:e.jsx("div",{className:"font-medium",children:c(t.duration||0)})}),e.jsxs("td",{className:"px-4 py-3",style:{color:o.text},children:[t.ticksGained!==void 0?e.jsxs("div",{className:`font-medium ${t.ticksGained>=0?"text-green-400":"text-red-400"}`,children:[t.ticksGained>0?"+":"",t.ticksGained," ticks"]}):e.jsx("div",{className:"text-xs",style:{color:o.textMuted},children:"-"}),t.tickValue!==void 0&&e.jsxs("div",{className:"text-xs",style:{color:o.textMuted},children:[t.tickValue," ",l.currency,"/tick"]})]}),e.jsx("td",{className:"px-4 py-3",style:{color:o.text},children:t.fees?.total||t.commission?e.jsx("div",{className:"font-medium text-orange-600 dark:text-orange-400",children:a(t.fees?.total!==void 0?t.fees.total:t.commission||0,l.currency)}):e.jsx("div",{className:"text-xs",style:{color:o.textMuted},children:"-"})}),e.jsxs("td",{className:"px-4 py-3",style:{color:o.text},children:[e.jsx("div",{className:"font-medium",children:t.strategy}),e.jsx("div",{className:"text-xs",style:{color:o.textMuted},children:t.setup||"-"})]}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("div",{className:`font-medium ${f>=0?"text-green-400":"text-red-400"}`,children:i(f)}),e.jsx("div",{className:`text-xs ${x>=0?"text-green-400":"text-red-400"}`,children:a(x,l.currency)}),e.jsxs("div",{className:"flex items-center justify-end space-x-1 mt-1",children:[e.jsx("button",{onClick:v=>p(v,()=>u(t)),className:"p-1 rounded transition-colors opacity-0 group-hover:opacity-100",title:n==="fr"?"Modifier":"Edit",children:"âœŽ"}),e.jsx("button",{onClick:v=>p(v,()=>m(t.id)),className:"p-1 rounded transition-colors opacity-0 group-hover:opacity-100",title:n==="fr"?"Supprimer":"Delete",children:"ðŸ—‘"})]})]})]},t.id),lf=({trades:t,sortedTrades:s,settings:r,sortField:l,sortDirection:n,onSort:o,colors:a,locale:i,formatCurrency:c,formatPercentage:d,formatDuration:u,onRowClick:m,onEdit:p,onDelete:x,onActionClick:f})=>e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"var(--theme-surface)"},children:[e.jsx("th",{className:"px-4 py-2 text-left cursor-pointer",onClick:()=>o("date"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(yt,{size:16,className:"mr-2"}),e.jsx("span",{children:"Date"}),l==="date"&&(n==="asc"?e.jsx(it,{size:16,className:"ml-1"}):e.jsx($e,{size:16,className:"ml-1"}))]})}),e.jsx("th",{className:"px-4 py-2 text-left cursor-pointer",onClick:()=>o("symbol"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{size:16,className:"mr-2"}),e.jsx("span",{children:"Symbol"}),l==="symbol"&&(n==="asc"?e.jsx(it,{size:16,className:"ml-1"}):e.jsx($e,{size:16,className:"ml-1"}))]})}),e.jsx("th",{className:"px-4 py-2 text-left cursor-pointer",onClick:()=>o("side"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(_e,{size:16,className:"mr-2"}),e.jsx("span",{children:"Direction"}),l==="side"&&(n==="asc"?e.jsx(it,{size:16,className:"ml-1"}):e.jsx($e,{size:16,className:"ml-1"}))]})}),e.jsx("th",{className:"px-4 py-2 text-left cursor-pointer",onClick:()=>o("quantity"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Quantity"}),l==="quantity"&&(n==="asc"?e.jsx(it,{size:16,className:"ml-1"}):e.jsx($e,{size:16,className:"ml-1"}))]})}),e.jsx("th",{className:"px-4 py-2 text-left cursor-pointer",onClick:()=>o("timeframe"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Timeframe"}),l==="timeframe"&&(n==="asc"?e.jsx(it,{size:16,className:"ml-1"}):e.jsx($e,{size:16,className:"ml-1"}))]})}),e.jsx("th",{className:"px-4 py-2 text-left cursor-pointer",onClick:()=>o("duration"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Duration"}),l==="duration"&&(n==="asc"?e.jsx(it,{size:16,className:"ml-1"}):e.jsx($e,{size:16,className:"ml-1"}))]})}),e.jsx("th",{className:"px-4 py-2 text-left cursor-pointer",onClick:()=>o("ticksGained"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Ticks"}),l==="ticksGained"&&(n==="asc"?e.jsx(it,{size:16,className:"ml-1"}):e.jsx($e,{size:16,className:"ml-1"}))]})}),e.jsx("th",{className:"px-4 py-2 text-left cursor-pointer",onClick:()=>o("fees"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Fees"}),l==="fees"&&(n==="asc"?e.jsx(it,{size:16,className:"ml-1"}):e.jsx($e,{size:16,className:"ml-1"}))]})}),e.jsx("th",{className:"px-4 py-2 text-left cursor-pointer",onClick:()=>o("strategy"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Strategy"}),l==="strategy"&&(n==="asc"?e.jsx(it,{size:16,className:"ml-1"}):e.jsx($e,{size:16,className:"ml-1"}))]})}),e.jsx("th",{className:"px-4 py-2 text-right cursor-pointer",onClick:()=>o("pnl"),children:e.jsxs("div",{className:"flex items-center justify-end",children:[e.jsx("span",{children:"P&L"}),l==="pnl"&&(n==="asc"?e.jsx(it,{size:16,className:"ml-1"}):e.jsx($e,{size:16,className:"ml-1"}))]})})]})}),e.jsx("tbody",{children:s.map(v=>{const h=t.findIndex(N=>N.id===v.id),b=Cr(v,r,"equity",2),j=b.net.toNumber(),y=b.percent.toNumber();return e.jsx(nf,{trade:v,index:h,trades:t,settings:r,locale:i,colors:a,formatCurrency:c,formatPercentage:d,formatDuration:u,onRowClick:m,onEdit:p,onDelete:x,onActionClick:f,netPnL:j,netPnLPercentage:y},v.id)})})]}),af=({isOpen:t,onClose:s,selected:r,setSelected:l,suggestions:n,matchingCount:o,totalTrades:a,onApply:i})=>{if(!t)return null;const c=d=>{l(r.includes(d)?r.filter(u=>u!==d):[...r,d])};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"theme-surface rounded-lg shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b theme-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(hl,{size:24,className:"theme-text-secondary"}),e.jsx("h2",{className:"text-xl font-bold theme-text",children:"Suggestions de recherche rapide"})]}),e.jsx("button",{onClick:s,className:"p-2 rounded-lg hover:theme-surface transition-colors",title:"Fermer",children:e.jsx(Ne,{size:20})})]}),r.length>0&&e.jsxs("div",{className:"mb-4 p-3 theme-surface border theme-border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(vt,{size:16,className:"theme-text-secondary"}),e.jsx("span",{className:"text-sm font-medium theme-text-secondary",children:"Trades correspondants :"})]}),e.jsx("span",{className:"text-lg font-bold theme-text-secondary",children:o})]}),e.jsxs("div",{className:"mt-2 text-xs theme-text-muted",children:['Recherche : "',r.join(" "),'"']})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 theme-text-muted hover:theme-text transition-colors border theme-border rounded hover:theme-surface",children:"Annuler"}),e.jsxs("button",{onClick:i,disabled:r.length===0,className:`px-6 py-2 rounded-lg font-medium transition-colors ${r.length>0?"theme-accent theme-text hover:theme-accent-hover shadow-sm":"theme-surface theme-text-muted cursor-not-allowed"}`,children:["Appliquer (",r.length,")"]})]})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[cf("Symboles",n.symbols,c,r),Gt("StratÃ©gies",n.strategies,c,r,e.jsx(_e,{size:18})),Gt("P&L",n.pnlSuggestions,c,r,e.jsx(Ge,{size:18})),Gt("Direction & Statut",["long","short","open","closed"],c,r,e.jsx(_e,{size:18})),Gt("MarchÃ©s",n.markets,c,r,e.jsx(Te,{size:18})),Gt("Tags",n.tags,c,r,e.jsx(Te,{size:18})),Gt("Timeframes",n.timeframes,c,r,e.jsx(ze,{size:18})),Gt("QuantitÃ©s",n.quantities,c,r,e.jsx(_e,{size:18})),Gt("DurÃ©es",n.durations,c,r,e.jsx(ze,{size:18})),Gt("Ticks",n.ticksSuggestions,c,r,e.jsx(Te,{size:18})),Gt("Setups",n.setups,c,r,e.jsx(Te,{size:18}))]}),e.jsxs("div",{className:"mt-8 p-4 theme-surface rounded-lg",children:[e.jsx("h4",{className:"text-md font-semibold mb-2 theme-text",children:"ðŸ“Š BasÃ© sur vos donnÃ©es"}),e.jsxs("div",{className:"text-sm theme-text-muted",children:["Suggestions gÃ©nÃ©rÃ©es Ã  partir de ",a," trades"]})]})]})]})})},cf=(t,s,r,l)=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold theme-text flex items-center space-x-2",children:e.jsx("span",{children:t})}),e.jsx("div",{className:"space-y-2",children:s.map(n=>e.jsx("button",{onClick:()=>r(n),className:`w-full text-left px-3 py-2 text-sm rounded border transition-all cursor-pointer ${l.includes(n)?"theme-surface theme-text border-2":"theme-surface theme-text theme-border hover:theme-surface"}`,style:{borderColor:l.includes(n)?"var(--theme-accent)":void 0},children:n},n))})]}),Gt=(t,s,r,l,n)=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-lg font-semibold theme-text flex items-center space-x-2",children:[n,e.jsx("span",{children:t})]}),e.jsx("div",{className:"space-y-2",children:s.map(o=>e.jsx("button",{onClick:()=>r(o),className:`w-full text-left px-3 py-2 text-sm rounded border transition-all cursor-pointer ${l.includes(o)?"theme-surface theme-text border-2":"theme-surface theme-text theme-border hover:theme-surface"}`,style:{borderColor:l.includes(o)?"var(--theme-accent)":void 0},children:o},o))})]}),ka=({trades:t,onEdit:s,onDelete:r,settings:l,hideHeader:n=!1})=>{const{currentTheme:o}=Q(),{currentLanguage:a}=Z(),{formatCurrency:i,formatPercentage:c,formatDuration:d}=Ms(),{sortField:u,sortDirection:m,handleSort:p,sortedTrades:x}=Zx(t),{searchTerm:f,setSearchTerm:v,showSuggestionsModal:h,setShowSuggestionsModal:b,selectedSuggestions:j,setSelectedSuggestions:y,dynamicSuggestions:N,matchingTradesCount:w,applySelectedSuggestions:S}=sf(t),{showScreenshots:k,setShowScreenshots:C,selectedTrade:P,setSelectedTrade:R,handleRowClick:M,handleActionClick:T}=rf();return t.length===0?e.jsx("div",{className:"text-center py-8",style:{color:o.colors.textMuted},children:e.jsx("p",{children:"No trades match the filter criteria"})}):e.jsxs("div",{className:"overflow-x-auto",children:[!n&&e.jsx(of,{title:a==="fr"?"Liste des Trades":"Trades List",countText:f?`${x.length} trades (recherche) sur ${t.length} filtrÃ©s`:`${t.length} trades`,searchTerm:f,onSearchChange:v,onOpenSuggestions:()=>b(!0)}),e.jsx(lf,{trades:t,sortedTrades:x,settings:l,sortField:u,sortDirection:m,onSort:p,colors:{text:o.colors.text,textMuted:o.colors.textMuted,border:o.colors.border,success:o.colors.success,danger:o.colors.danger},locale:a==="fr"?"fr":"en",formatCurrency:i,formatPercentage:c,formatDuration:d,onRowClick:M,onEdit:s,onDelete:r,onActionClick:T}),k&&e.jsx(Na,{trade:k,onClose:()=>C(null)}),P&&e.jsx(Ws,{trade:P,settings:l,onClose:()=>R(null),onEdit:s,onDelete:r}),e.jsx(af,{isOpen:h,onClose:()=>{y([]),b(!1)},selected:j,setSelected:y,suggestions:N,matchingCount:w,totalTrades:t.length,onApply:S})]})},we=({title:t,value:s,icon:r,color:l,subtitle:n,compact:o=!1})=>{const{currentTheme:a}=Q(),i={primary:a.colors.accent,success:a.colors.success,danger:a.colors.danger,warning:a.colors.warning,info:a.colors.info},c=o?"p-4":"p-6",d=o?"space-y-1":"space-y-2";return e.jsx("div",{className:`rounded-lg shadow-sm border ${c}`,style:{backgroundColor:a.colors.card,borderColor:a.colors.border},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:d,children:[e.jsx("p",{className:"text-sm font-medium",style:{color:a.colors.textSecondary},children:t}),e.jsx("p",{className:`${o?"text-xl":"text-2xl"} font-bold mt-1`,style:{color:a.colors.text},children:s}),n&&e.jsx("p",{className:"text-sm mt-1",style:{color:a.colors.textMuted},children:n})]}),e.jsx("div",{className:`${o?"p-2":"p-3"} rounded-full border`,style:{backgroundColor:i[l]+"20",borderColor:i[l]+"40",color:i[l]},children:r})]})})},df=({stats:t,settings:s,theme:r,language:l,formatCurrency:n,formatPercentage:o,compact:a})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(we,{title:l==="fr"?"Capital Initial":"Initial Capital",value:n(t.initialCapital,s.currency),icon:e.jsx(xc,{size:24}),color:"primary",compact:a}),e.jsx(we,{title:l==="fr"?"Capital Actuel":"Current Capital",value:n(t.currentCapital,s.currency),icon:e.jsx(Ge,{size:24}),color:t.currentCapital>=t.initialCapital?"success":"danger",subtitle:`${t.currentCapital>=t.initialCapital?"Gain":l==="fr"?"Perte":"Loss"} ${n(Math.abs(t.currentCapital-t.initialCapital),s.currency)}`,compact:a}),e.jsx(we,{title:l==="fr"?"Rendement Total":"Total Return",value:o(t.totalReturn),icon:e.jsx(os,{size:24}),color:t.totalReturn>=0?"success":"danger",subtitle:`${n(t.totalPnL,s.currency)} ${l==="fr"?"de P&L":"P&L"}`,compact:a})]}),uf=({stats:t,theme:s,language:r,formatPercentage:l,formatNumber:n,formatCurrency:o,currency:a,compact:i})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(we,{title:"Total Trades",value:t.totalTrades,icon:e.jsx(Te,{size:24}),color:"primary",compact:i}),e.jsx(we,{title:r==="fr"?"Taux de RÃ©ussite":"Win Rate",value:l(t.winRate),icon:e.jsx(is,{size:24}),color:t.winRate>=50?"success":"danger",subtitle:`${t.winningTrades} ${r==="fr"?"gagnants":"winning"} / ${t.losingTrades} ${r==="fr"?"perdants":"losing"}`,compact:i}),e.jsx(we,{title:"Profit Factor",value:n(t.profitFactor,2),icon:e.jsx(Ps,{size:24}),color:t.profitFactor>=1.5?"success":t.profitFactor>=1?"warning":"danger",compact:i}),e.jsx(we,{title:r==="fr"?"R/R Moyen":"Avg R/R",value:n(t.averageRiskReward,2),icon:e.jsx(Te,{size:24}),color:t.averageRiskReward>=2?"success":t.averageRiskReward>=1?"warning":"danger",compact:i}),e.jsx(we,{title:r==="fr"?"Gain Moyen":"Average Win",value:l(t.averageWinPercentage),icon:e.jsx(Ae,{size:24}),color:"success",subtitle:o(t.averageWin,a),compact:i}),e.jsx(we,{title:r==="fr"?"Perte Moyenne":"Average Loss",value:l(t.averageLossPercentage),icon:e.jsx($t,{size:24}),color:"danger",subtitle:o(t.averageLoss,a),compact:i}),e.jsx(we,{title:r==="fr"?"Plus Gros Gain":"Largest Win",value:l(t.largestWinPercentage),icon:e.jsx(Ae,{size:24}),color:"success",subtitle:o(t.largestWin,a),compact:i}),e.jsx(we,{title:r==="fr"?"Plus Grosse Perte":"Largest Loss",value:l(t.largestLossPercentage),icon:e.jsx($t,{size:24}),color:"danger",subtitle:o(t.largestLoss,a),compact:i})]}),mf=({stats:t,settings:s,theme:r,language:l,formatPercentage:n})=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center",style:{color:r.colors.text},children:[e.jsx("div",{className:"mr-2",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:r.colors.success}}),e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:r.colors.danger}}),e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:r.colors.warning}})]})}),l==="fr"?"RÃ©sultats des Trades (TP/SL/BE)":"Trade Results (TP/SL/BE)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"p-6 rounded-lg shadow-sm border relative",style:{backgroundColor:r.colors.card,borderColor:r.colors.border},children:[e.jsx("div",{className:"absolute top-6 right-6",children:e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center border-2",style:{backgroundColor:`${r.colors.success}20`,borderColor:r.colors.success},children:e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:r.colors.success}})})}),e.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:r.colors.text},children:"Take Profit"}),e.jsxs("div",{className:"text-3xl font-bold mb-1",style:{color:r.colors.text},children:[t.tpCount," ","trades"]}),e.jsxs("div",{style:{color:r.colors.textSecondary},children:[n(t.tpWinRate)," ",l==="fr"?"de rÃ©ussite":"win rate"]})]}),e.jsxs("div",{className:"p-6 rounded-lg shadow-sm border relative",style:{backgroundColor:r.colors.card,borderColor:r.colors.border},children:[e.jsx("div",{className:"absolute top-6 right-6",children:e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center border-2",style:{backgroundColor:`${r.colors.danger}20`,borderColor:r.colors.danger},children:e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:r.colors.danger}})})}),e.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:r.colors.text},children:"Stop Loss"}),e.jsxs("div",{className:"text-3xl font-bold mb-1",style:{color:r.colors.text},children:[t.slCount," ","trades"]}),e.jsxs("div",{style:{color:r.colors.textSecondary},children:[n(t.slWinRate)," ",l==="fr"?"de rÃ©ussite":"win rate"]})]}),e.jsxs("div",{className:"p-6 rounded-lg shadow-sm border relative",style:{backgroundColor:r.colors.card,borderColor:r.colors.border},children:[e.jsx("div",{className:"absolute top-6 right-6",children:e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center border-2",style:{backgroundColor:`${r.colors.warning}20`,borderColor:r.colors.warning},children:e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:r.colors.warning}})})}),e.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:r.colors.text},children:"Break Even"}),e.jsxs("div",{className:"text-3xl font-bold mb-1",style:{color:r.colors.text},children:[t.beCount," ","trades"]}),e.jsxs("div",{style:{color:r.colors.textSecondary},children:[n(t.beWinRate)," ",l==="fr"?"de rÃ©ussite":"win rate"]})]})]})]}),xf=({stats:t,settings:s,theme:r,language:l,formatNumber:n,formatPercentage:o,formatCurrency:a,compact:i})=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center",style:{color:r.colors.text},children:[e.jsx(Mt,{size:20,className:"mr-2"}),l==="fr"?"MÃ©triques AvancÃ©es":"Advanced Metrics"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(we,{title:l==="fr"?"Drawdown Max":"Max Drawdown",value:o(t.maxDrawdownPercentage),icon:e.jsx($t,{size:24}),color:"danger",subtitle:a(t.maxDrawdown,s.currency),compact:i}),e.jsx(we,{title:l==="fr"?"Ratio de Sharpe":"Sharpe Ratio",value:n(t.sharpeRatio,2),icon:e.jsx(lc,{size:24}),color:t.sharpeRatio>=1?"success":t.sharpeRatio>=.5?"warning":"danger",subtitle:l==="fr"?"Rendement ajustÃ© au risque":"Risk-adjusted return",compact:i}),e.jsx(we,{title:l==="fr"?"Score de Consistance":"Consistency Score",value:o(t.consistencyScore),icon:e.jsx(Mt,{size:24}),color:t.consistencyScore>=70?"success":t.consistencyScore>=50?"warning":"danger",subtitle:l==="fr"?"% de jours profitables":"% of profitable days",compact:i}),e.jsx(we,{title:l==="fr"?"Ratio de Calmar":"Calmar Ratio",value:n(t.calmarRatio,2),icon:e.jsx(Ps,{size:24}),color:t.calmarRatio>=1?"success":t.calmarRatio>=.5?"warning":"danger",subtitle:l==="fr"?"Rendement/Drawdown":"Return/Drawdown",compact:i}),e.jsx(we,{title:"Expectancy",value:a(t.expectancy,s.currency),icon:e.jsx(Te,{size:24}),color:t.expectancy>=0?"success":"danger",subtitle:o(t.expectancyPercentage),compact:i}),e.jsx(we,{title:l==="fr"?"Facteur de RÃ©cupÃ©ration":"Recovery Factor",value:n(t.recoveryFactor,2),icon:e.jsx(Ys,{size:24}),color:t.recoveryFactor>=2?"success":t.recoveryFactor>=1?"warning":"danger",subtitle:l==="fr"?"Profit/Drawdown max":"Profit/Max drawdown",compact:i}),e.jsx(we,{title:l==="fr"?"Trades/Jour":"Trades/Day",value:n(t.tradesPerDay,1),icon:e.jsx(yt,{size:24}),color:"info",subtitle:`${n(t.averageTradesPerMonth,1)} ${l==="fr"?"par mois":"per month"}`,compact:i}),e.jsx(we,{title:l==="fr"?"Meilleur/Pire Mois":"Best/Worst Month",value:`${o(t.bestMonth)} / ${o(t.worstMonth)}`,icon:e.jsx(os,{size:24}),color:"primary",subtitle:l==="fr"?"Performance mensuelle":"Monthly performance",compact:i})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-6",children:[e.jsx(we,{title:l==="fr"?"SÃ©rie Actuelle":"Current Streak",value:t.consecutiveWins>0?`${t.consecutiveWins} ${l==="fr"?"gains":"wins"}`:t.consecutiveLosses>0?`${t.consecutiveLosses} ${l==="fr"?"pertes":"losses"}`:l==="fr"?"Aucune":"None",icon:e.jsx(nc,{size:24}),color:t.consecutiveWins>0?"success":t.consecutiveLosses>0?"danger":"info",subtitle:l==="fr"?"SÃ©rie en cours":"Current streak",compact:i}),e.jsx(we,{title:l==="fr"?"Plus Longue SÃ©rie de Gains":"Longest Win Streak",value:`${t.maxConsecutiveWins} trades`,icon:e.jsx(Ys,{size:24}),color:"success",subtitle:l==="fr"?"Record de gains consÃ©cutifs":"Record of consecutive wins",compact:i}),e.jsx(we,{title:l==="fr"?"Plus Longue SÃ©rie de Pertes":"Longest Loss Streak",value:`${t.maxConsecutiveLosses} trades`,icon:e.jsx(Ys,{size:24}),color:"danger",subtitle:l==="fr"?"Record de pertes consÃ©cutives":"Record of consecutive losses",compact:i}),e.jsx(we,{title:l==="fr"?"Rendement Mensuel":"Monthly Return",value:o(t.monthlyReturn),icon:e.jsx(yt,{size:24}),color:t.monthlyReturn>=0?"success":"danger",subtitle:l==="fr"?"Performance mensuelle moyenne":"Average monthly performance",compact:i})]})]}),ff=({stats:t,theme:s,language:r,formatDuration:l,compact:n})=>t.averageDuration<=0?null:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center",style:{color:s.colors.text},children:[e.jsx(ze,{size:20,className:"mr-2"}),r==="fr"?"Statistiques de DurÃ©e":"Duration Statistics"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(we,{title:r==="fr"?"DurÃ©e Moyenne":"Average Duration",value:l(t.averageDuration),icon:e.jsx(dc,{size:24}),color:"info",subtitle:`${Math.round(t.averageDuration)} ${r==="fr"?"secondes":"seconds"}`,compact:n}),e.jsx(we,{title:r==="fr"?"Trade le Plus Court":"Shortest Trade",value:l(t.shortestTrade),icon:e.jsx(ir,{size:24}),color:"warning",subtitle:`${Math.round(t.shortestTrade)} ${r==="fr"?"secondes":"seconds"}`,compact:n}),e.jsx(we,{title:r==="fr"?"Trade le Plus Long":"Longest Trade",value:l(t.longestTrade),icon:e.jsx(ze,{size:24}),color:"primary",subtitle:`${Math.round(t.longestTrade)} ${r==="fr"?"secondes":"seconds"}`,compact:n}),e.jsx(we,{title:r==="fr"?"DurÃ©e Gagnants vs Perdants":"Winners vs Losers Duration",value:`${l(t.averageWinDuration)} / ${l(t.averageLossDuration)}`,icon:e.jsx(Te,{size:24}),color:t.averageWinDuration<t.averageLossDuration?"success":"warning",subtitle:r==="fr"?"Gagnants / Perdants":"Winners / Losers",compact:n})]})]}),pf=({stats:t,settings:s,theme:r,language:l,formatCurrency:n,formatPercentage:o,formatNumber:a,compact:i})=>{const c=`${t.totalFees<0?l==="fr"?"CoÃ»t":"Cost":l==="fr"?"CrÃ©dit":"Credit"} ${o(t.feesImpactOnProfitability)} ${l==="fr"?"du capital initial":"of initial capital"}`;return e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center",style:{color:r.colors.text},children:[e.jsx(Ge,{size:20,className:"mr-2"}),l==="fr"?"Analyse des Frais et Commissions":"Fees and Commissions Analysis"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(we,{title:l==="fr"?"Total des Frais":"Total Fees",value:n(t.totalFees,s.currency),icon:e.jsx(Ge,{size:24}),color:"warning",subtitle:c,compact:i}),e.jsx(we,{title:l==="fr"?"Frais Moyens par Trade":"Average Fees per Trade",value:n(Math.abs(t.averageFeesPerTrade),s.currency),icon:e.jsx(Te,{size:24}),color:"info",subtitle:l==="fr"?"CoÃ»t moyen par position":"Average cost per position",compact:i}),e.jsx(we,{title:l==="fr"?"Impact sur le P&L":"Impact on P&L",value:t.feesAsPercentageOfPnL>0?`${a(t.feesAsPercentageOfPnL,2)}%`:"N/A",icon:e.jsx(is,{size:24}),color:t.feesAsPercentageOfPnL>0?t.feesAsPercentageOfPnL<10?"success":t.feesAsPercentageOfPnL<25?"warning":"danger":"info",subtitle:t.feesAsPercentageOfPnL>0?l==="fr"?"% du P&L brut":"% of gross P&L":l==="fr"?"P&L = frais":"P&L = fees",compact:i}),e.jsx(we,{title:l==="fr"?"Commissions vs Autres":"Commissions vs Others",value:`${n(Math.abs(t.totalCommissions),s.currency)} / ${n(Math.abs(t.totalFees-t.totalCommissions),s.currency)}`,icon:e.jsx(os,{size:24}),color:"primary",subtitle:l==="fr"?"Commissions / Autres frais":"Commissions / Other fees",compact:i})]}),t.totalFees>0&&(t.totalSpreads>0||t.totalSwapFees>0)&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.totalSpreads>0&&e.jsx(we,{title:"Total Spreads",value:n(Math.abs(t.totalSpreads),s.currency),icon:e.jsx(os,{size:24}),color:"info",subtitle:l==="fr"?"CoÃ»t des spreads":"Cost of spreads",compact:i}),t.totalSwapFees>0&&e.jsx(we,{title:l==="fr"?"Frais de Financement":"Financing Fees",value:n(Math.abs(t.totalSwapFees),s.currency),icon:e.jsx(ze,{size:24}),color:t.totalSwapFees>=0?"success":"danger",subtitle:l==="fr"?"Swaps overnight":"Overnight swaps",compact:i}),e.jsx(we,{title:l==="fr"?"EfficacitÃ© des CoÃ»ts":"Cost Efficiency",value:`${a(t.totalPnL/(t.totalPnL+t.totalFees)*100,1)}%`,icon:e.jsx(Ps,{size:24}),color:t.totalPnL>t.totalFees?"success":"danger",subtitle:l==="fr"?"P&L net vs brut":"Net vs gross P&L",compact:i})]}),t.totalFees===0&&e.jsx("div",{className:"mt-4 p-4 rounded-lg border",style:{backgroundColor:`${r.colors.accent}10`,borderColor:r.colors.accent},children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ge,{size:20,style:{color:r.colors.accent}}),e.jsx("span",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"Aucun frais enregistrÃ© dans vos trades. Les statistiques de frais s'afficheront automatiquement dÃ¨s que vous ajouterez des frais Ã  vos trades.":"No fees recorded in your trades. Fee statistics will automatically appear once you add fees to your trades."})]})}),t.totalFees>0&&e.jsx("div",{className:"mt-4 p-4 rounded-lg border",style:{backgroundColor:`${r.colors.warning}10`,borderColor:r.colors.warning},children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ge,{size:20,style:{color:r.colors.warning}}),e.jsx("span",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?`Vos frais totaux de ${n(t.totalFees,s.currency)} reprÃ©sentent ${o(t.feesImpactOnProfitability)} de votre capital initial. ${t.feesAsPercentageOfPnL>0?`Ils reprÃ©sentent ${a(t.feesAsPercentageOfPnL,2)}% de votre P&L brut.`:"Ils sont Ã©gaux Ã  votre P&L brut, ce qui signifie que vos gains sont entiÃ¨rement absorbÃ©s par les frais."}`:`Your total fees of ${n(t.totalFees,s.currency)} represent ${o(t.feesImpactOnProfitability)} of your initial capital. ${t.feesAsPercentageOfPnL>0?`They represent ${a(t.feesAsPercentageOfPnL,2)}% of your gross P&L.`:"They are equal to your gross P&L, which means your gains are entirely absorbed by fees."}`})]})})]})},hf=({stats:t,theme:s,language:r,formatNumber:l,formatPercentage:n,compact:o})=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center",style:{color:s.colors.text},children:[e.jsx(Te,{size:20,className:"mr-2"}),r==="fr"?"Statistiques de Ticks (Scalping)":"Tick Statistics (Scalping)"]}),t.totalTicks!==0?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(we,{title:"Total Ticks",value:l(t.totalTicks,1),icon:e.jsx(Te,{size:24}),color:t.totalTicks>=0?"success":"danger",subtitle:r==="fr"?"Ticks capturÃ©s au total":"Total captured ticks",compact:o}),e.jsx(we,{title:r==="fr"?"Ticks Moyens par Trade":"Average Ticks per Trade",value:l(t.averageTicksPerTrade,2),icon:e.jsx(os,{size:24}),color:"info",subtitle:r==="fr"?"Capture moyenne":"Average capture",compact:o}),e.jsx(we,{title:r==="fr"?"EfficacitÃ© des Ticks":"Tick Efficiency",value:n(t.tickEfficiency),icon:e.jsx(Ps,{size:24}),color:t.tickEfficiency>=60?"success":t.tickEfficiency>=40?"warning":"danger",subtitle:r==="fr"?"% de trades avec ticks positifs":"% of trades with positive ticks",compact:o}),e.jsx(we,{title:r==="fr"?"Meilleure/Pire Capture":"Best/Worst Capture",value:`+${Math.round(t.bestTickCapture)} / ${Math.round(t.worstTickCapture)}`,icon:e.jsx(Ae,{size:24}),color:"primary",subtitle:r==="fr"?"Ticks max gagnÃ©s/perdus":"Max ticks gained/lost",compact:o}),e.jsx(we,{title:r==="fr"?"Ticks Gagnants Moyens":"Average Winning Ticks",value:l(t.averageWinTicks,2),icon:e.jsx(Ae,{size:24}),color:"success",subtitle:r==="fr"?"Capture moyenne des gains":"Average winning capture",compact:o}),e.jsx(we,{title:r==="fr"?"Ticks Perdants Moyens":"Average Losing Ticks",value:l(Math.abs(t.averageLossTicks),2),icon:e.jsx($t,{size:24}),color:"danger",subtitle:r==="fr"?"Perte moyenne en ticks":"Average loss in ticks",compact:o})]}):e.jsxs("div",{className:"p-6 rounded-lg border text-center",style:{backgroundColor:s.colors.surface,borderColor:s.colors.border},children:[e.jsx(Te,{size:48,className:"mx-auto mb-4",style:{color:s.colors.textMuted}}),e.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:s.colors.text},children:r==="fr"?"Aucune donnÃ©e de ticks":"No tick data"}),e.jsx("p",{style:{color:s.colors.textSecondary},children:r==="fr"?"Ajoutez des informations de ticks Ã  vos trades pour voir ces statistiques.":"Add tick information to your trades to see these statistics."}),e.jsx("p",{className:"text-sm mt-2",style:{color:s.colors.textMuted},children:r==="fr"?"Les ticks sont particuliÃ¨rement utiles pour le scalping et le trading haute frÃ©quence.":"Ticks are particularly useful for scalping and high-frequency trading."})]})]}),gf=({stats:t,theme:s,language:r,formatNumber:l,compact:n})=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center",style:{color:s.colors.text},children:[e.jsx(os,{size:20,className:"mr-2"}),r==="fr"?"Statistiques de Lots":"Lot Statistics"]}),t.totalLots>0?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(we,{title:r==="fr"?"Total Lots TradÃ©s":"Total Lots Traded",value:l(t.totalLots,2),icon:e.jsx(os,{size:24}),color:"primary",subtitle:r==="fr"?"Volume total en lots":"Total volume in lots",compact:n}),e.jsx(we,{title:r==="fr"?"Lots Moyens par Trade":"Average Lots per Trade",value:l(t.averageLotsPerTrade,2),icon:e.jsx(Te,{size:24}),color:"info",subtitle:r==="fr"?"Taille moyenne des positions":"Average position size",compact:n}),e.jsx(we,{title:r==="fr"?"Plus Grosse Position":"Largest Position",value:`${Math.round(t.maxLotsInSingleTrade)} lots`,icon:e.jsx(Ae,{size:24}),color:"warning",subtitle:r==="fr"?"Position la plus importante":"Most significant position",compact:n}),e.jsx(we,{title:r==="fr"?"Lots Gagnants vs Perdants":"Winning vs Losing Lots",value:`${l(t.averageLotsWinningTrades,2)} / ${l(t.averageLotsLosingTrades,2)}`,icon:e.jsx(Ps,{size:24}),color:t.averageLotsWinningTrades>t.averageLotsLosingTrades?"success":"warning",subtitle:r==="fr"?"Moyenne gagnants / perdants":"Average winners / losers",compact:n})]}):e.jsxs("div",{className:"p-6 rounded-lg border text-center",style:{backgroundColor:s.colors.surface,borderColor:s.colors.border},children:[e.jsx(os,{size:48,className:"mx-auto mb-4",style:{color:s.colors.textMuted}}),e.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:s.colors.text},children:r==="fr"?"Aucune donnÃ©e de lots":"No lot data"}),e.jsx("p",{style:{color:s.colors.textSecondary},children:r==="fr"?"Ajoutez des informations sur le nombre de lots Ã  vos trades pour voir ces statistiques.":"Add information about the number of lots to your trades to see these statistics."}),e.jsx("p",{className:"text-sm mt-2",style:{color:s.colors.textMuted},children:r==="fr"?"Le nombre de lots vous aide Ã  analyser la taille de vos positions et votre gestion du risque.":"The number of lots helps you analyze your position size and risk management."})]})]}),yf=({stats:t,settings:s,onOpenPreferences:r})=>{const{currentTheme:l}=Q(),{currentLanguage:n}=Z(),{formatCurrency:o,formatPercentage:a,formatNumber:i,formatDuration:c}=Ms();t.totalFees<0,`${a(t.feesImpactOnProfitability)}`;const d=s.statsDisplay||{showDurationStats:!0,showTicksStats:!0,showFeesStats:!0,showLotsStats:!0,showAdvancedMetrics:!1,compactView:!1};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(df,{stats:t,settings:s,theme:l,language:n,formatCurrency:o,formatPercentage:a,compact:!!d.compactView}),e.jsx(uf,{stats:t,theme:l,language:n,formatPercentage:a,formatNumber:i,formatCurrency:o,currency:s.currency,compact:!!d.compactView}),e.jsx(mf,{stats:t,settings:s,theme:l,language:n,formatPercentage:a}),d.showAdvancedMetrics&&e.jsx(xf,{stats:t,settings:s,theme:l,language:n,formatNumber:i,formatPercentage:a,formatCurrency:o,compact:!!d.compactView}),d.showDurationStats&&e.jsx(ff,{stats:t,theme:l,language:n,formatDuration:c,compact:!!d.compactView}),d.showFeesStats&&e.jsx(pf,{stats:t,settings:s,theme:l,language:n,formatCurrency:o,formatPercentage:a,formatNumber:i,compact:!!d.compactView}),d.showTicksStats&&e.jsx(hf,{stats:t,theme:l,language:n,formatNumber:i,formatPercentage:a,compact:!!d.compactView}),d.showLotsStats&&e.jsx(gf,{stats:t,theme:l,language:n,formatNumber:i,compact:!!d.compactView})]})},bf=({stats:t,settings:s,recentTrades:r,onEdit:l,onDelete:n,onOpenPreferences:o,title:a})=>e.jsxs("div",{children:[e.jsx(yf,{stats:t,settings:s,onOpenPreferences:o}),r.length>0&&e.jsxs("div",{className:"card rounded-lg shadow-sm p-6 mt-6",children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 theme-text",children:[a," (",Math.min(r.length,10),")"]}),e.jsx(ka,{trades:r.slice(0,10),onEdit:l,onDelete:i=>n(typeof i=="string"?i:i.id),settings:s,hideHeader:!0})]})]}),Yt=({active:t,payload:s,label:r,coordinate:l})=>{const{currentTheme:n}=Q(),{currentLanguage:o}=Z();if(!t||!s||!s.length)return null;const a=s[0].payload,c=(()=>{const y={backgroundColor:n.colors.card,border:`2px solid ${n.colors.border}`,color:n.colors.text,boxShadow:"0 5px 20px rgba(0,0,0,0.3)",accentColor:n.colors.accent,sectionColors:{primary:n.colors.accent,success:n.colors.success,info:n.colors.info,warning:n.colors.warning,analysis:n.colors.accent}};return n.id==="ultra-dark"?{...y,backgroundColor:"#000000",border:"2px solid #00ff88",color:"#ffffff",boxShadow:"0 0 20px rgba(0,255,136,0.6), 0 5px 20px rgba(0,0,0,0.8)",accentColor:"#00ff88",sectionColors:{primary:"#4fc3f7",success:"#4caf50",info:"#2196f3",warning:"#ff9800",analysis:"#00ff88"}}:n.isDark?{...y,backgroundColor:"#1a1a1a",border:"2px solid #ffffff",color:"#ffffff",boxShadow:"0 5px 20px rgba(255,255,255,0.2)",accentColor:"#ffffff",sectionColors:{primary:"#4fc3f7",success:"#4caf50",info:"#2196f3",warning:"#ff9800",analysis:"#ffffff"}}:{...y,backgroundColor:"#ffffff",border:"2px solid #000000",color:"#000000",boxShadow:"0 5px 20px rgba(0,0,0,0.3)",accentColor:"#000000",sectionColors:{primary:"#1976d2",success:"#388e3c",info:"#1565c0",warning:"#f57c00",analysis:"#000000"}}})(),d=y=>{const N=y!==void 0?y:0;return new Intl.NumberFormat(o==="fr"?"fr-FR":"en-US",{style:"currency",currency:o==="fr"?"EUR":"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(N)},u=y=>{const N=y!==void 0?y:0;return`${N>=0?"+":""}${N.toFixed(2)}%`},m=y=>{if(!y||y===0)return"-";const N=Math.floor(y/3600),w=Math.floor(y%3600/60);return N>0?`${N}h ${w}m`:w>0?`${w}m`:`${y}s`},p=()=>{if(!l)return{};const y=280,N=350,w=40,S=document.querySelector(".recharts-wrapper");if(!S)return{position:"fixed",left:l.x+w,top:l.y-N/2,transform:"none",pointerEvents:"none",zIndex:999999};const k=S.getBoundingClientRect(),C=k.width,P=k.left,R=k.right,T=l.x-P<C/2;let D,F;T?(D=l.x+w,D+y>R-20&&(D=l.x-y-w)):(D=l.x-y-w,D<P+20&&(D=l.x+w)),F=l.y-N/2;const $=window.innerWidth,U=window.innerHeight,B=15;return D<B?D=B:D+y>$-B&&(D=$-y-B),F<B?F=B:F+N>U-B&&(F=U-N-B),{position:"fixed",left:D,top:F,transform:"none",pointerEvents:"none",zIndex:999999}},x=({title:y,color:N,children:w})=>e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("div",{style:{color:N,fontSize:"11px",fontWeight:"700",marginBottom:"4px",borderBottom:`1px solid ${N}40`,paddingBottom:"2px"},children:y}),e.jsx("div",{style:{paddingLeft:"4px"},children:w})]}),f=({label:y,value:N,valueColor:w})=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px",fontSize:"12px"},children:[e.jsxs("span",{style:{color:c.color+"cc"},children:[y,":"]}),e.jsx("span",{style:{fontWeight:"700",color:w||c.color,marginLeft:"8px"},children:N})]}),h=(y=>{const N=[];if(y.winRate!==void 0&&(y.winRate>=80?N.push(o==="fr"?"ðŸ”¥ Performance Exceptionnelle":"ðŸ”¥ Exceptional Performance"):y.winRate>=70?N.push(o==="fr"?"âœ… Performance Solide":"âœ… Solid Performance"):y.winRate>=60?N.push(o==="fr"?"ðŸ‘ Performance Correcte":"ðŸ‘ Good Performance"):y.winRate>=50?N.push(o==="fr"?"âš ï¸ Performance Moyenne":"âš ï¸ Average Performance"):N.push(o==="fr"?"âŒ Performance Faible":"âŒ Poor Performance"),y.windowPnLPercentage!==void 0&&(y.windowPnLPercentage>=5?N.push(o==="fr"?"ðŸ’° FenÃªtre TrÃ¨s Profitable":"ðŸ’° Highly Profitable Window"):y.windowPnLPercentage>=2?N.push(o==="fr"?"ðŸ’š FenÃªtre Profitable":"ðŸ’š Profitable Window"):y.windowPnLPercentage>=0?N.push(o==="fr"?"ðŸŸ¡ FenÃªtre Ã‰quilibrÃ©e":"ðŸŸ¡ Balanced Window"):y.windowPnLPercentage>=-2?N.push(o==="fr"?"ðŸŸ  FenÃªtre en DifficultÃ©":"ðŸŸ  Struggling Window"):N.push(o==="fr"?"ðŸ”´ FenÃªtre ProblÃ©matique":"ðŸ”´ Problematic Window"))),y.drawdown!==void 0){const w=Math.abs(y.drawdown??0);w<=2?N.push(o==="fr"?"ðŸ›¡ï¸ Drawdown Excellent":"ðŸ›¡ï¸ Excellent Drawdown"):w<=5?N.push(o==="fr"?"âœ… Drawdown Acceptable":"âœ… Acceptable Drawdown"):w<=10?N.push(o==="fr"?"âš ï¸ Drawdown ModÃ©rÃ©":"âš ï¸ Moderate Drawdown"):w<=20?N.push(o==="fr"?"ðŸŸ  Drawdown Ã‰levÃ©":"ðŸŸ  High Drawdown"):N.push(o==="fr"?"ðŸ”´ Drawdown Critique":"ðŸ”´ Critical Drawdown"),(y.capital??0)>(y.peak??0)*.98?N.push(o==="fr"?"ðŸ“ˆ Proche du Peak":"ðŸ“ˆ Near Peak"):(y.capital??0)>(y.peak??0)*.95&&N.push(o==="fr"?"ðŸŽ¯ RÃ©cupÃ©ration en Cours":"ðŸŽ¯ Recovery in Progress")}if(y.cumulativePercentage!==void 0&&(y.tradeNumber??0)>0&&(y.cumulativePercentage>=20?N.push(o==="fr"?"ðŸš€ Croissance Exceptionnelle":"ðŸš€ Exceptional Growth"):y.cumulativePercentage>=10?N.push(o==="fr"?"ðŸ’ª Croissance Solide":"ðŸ’ª Solid Growth"):y.cumulativePercentage>=5?N.push(o==="fr"?"ðŸ“Š Progression Positive":"ðŸ“Š Positive Progression"):y.cumulativePercentage>=0?N.push(o==="fr"?"ðŸŸ¡ Ã‰quilibre Maintenu":"ðŸŸ¡ Balance Maintained"):y.cumulativePercentage>=-5?N.push(o==="fr"?"âš ï¸ LÃ©ger Recul":"âš ï¸ Slight Decline"):N.push(o==="fr"?"ðŸ”´ Correction NÃ©cessaire":"ðŸ”´ Correction Needed"),y.tradePercentage!==void 0&&(y.tradePercentage>=2?N.push("ðŸŽ¯ Excellent Trade"):y.tradePercentage>=1?N.push(o==="fr"?"âœ… Bon Trade":"âœ… Good Trade"):y.tradePercentage>=0?N.push(o==="fr"?"ðŸ‘ Trade Positif":"ðŸ‘ Positive Trade"):y.tradePercentage>=-1?N.push(o==="fr"?"ðŸŸ  Perte ContrÃ´lÃ©e":"ðŸŸ  Controlled Loss"):N.push(o==="fr"?"ðŸ”´ Perte Importante":"ðŸ”´ Significant Loss"))),y.range&&y.percentage!==void 0&&(y.percentage>=30?N.push(o==="fr"?"ðŸŽ¯ Tranche Dominante":"ðŸŽ¯ Dominant Range"):y.percentage>=20?N.push(o==="fr"?"ðŸ“Š Tranche Importante":"ðŸ“Š Important Range"):y.percentage>=10?N.push(o==="fr"?"ðŸ‘ Tranche Significative":"ðŸ‘ Significant Range"):N.push(o==="fr"?"ðŸ“ˆ Tranche Mineure":"ðŸ“ˆ Minor Range"),(y.totalPnLPercentage??0)>=5?N.push(o==="fr"?"ðŸ’° Tranche TrÃ¨s Profitable":"ðŸ’° Highly Profitable Range"):(y.totalPnLPercentage??0)>=0?N.push(o==="fr"?"âœ… Tranche Profitable":"âœ… Profitable Range"):N.push(o==="fr"?"âš ï¸ Tranche DÃ©ficitaire":"âš ï¸ Loss-Making Range")),y.fullStrategy&&y.winRate!==void 0&&(y.winRate>=70&&(y.profitFactor??0)>=2?N.push(o==="fr"?"ðŸ† StratÃ©gie d'Elite":"ðŸ† Elite Strategy"):y.winRate>=60&&(y.profitFactor??0)>=1.5?N.push(o==="fr"?"â­ StratÃ©gie Solide":"â­ Solid Strategy"):y.winRate>=50&&(y.profitFactor??0)>=1.2?N.push(o==="fr"?"ðŸ‘ StratÃ©gie Viable":"ðŸ‘ Viable Strategy"):(y.profitFactor??0)>=1?N.push(o==="fr"?"ðŸŸ¡ StratÃ©gie Marginale":"ðŸŸ¡ Marginal Strategy"):N.push(o==="fr"?"ðŸ”´ StratÃ©gie Ã  Revoir":"ðŸ”´ Strategy to Review"),(y.trades??0)>=20?N.push(o==="fr"?"ðŸ“Š Ã‰chantillon Significatif":"ðŸ“Š Significant Sample"):(y.trades??0)>=10?N.push(o==="fr"?"ðŸ“ˆ Ã‰chantillon Correct":"ðŸ“ˆ Adequate Sample"):N.push(o==="fr"?"âš ï¸ Ã‰chantillon LimitÃ©":"âš ï¸ Limited Sample")),y.cumulativeTicks!==void 0&&(y.tradeNumber??0)>0&&(y.cumulativeTicks>=100?N.push(o==="fr"?"ðŸŽ¯ Capture Exceptionnelle":"ðŸŽ¯ Exceptional Capture"):y.cumulativeTicks>=50?N.push(o==="fr"?"âœ… Capture Solide":"âœ… Solid Capture"):y.cumulativeTicks>=0?N.push(o==="fr"?"ðŸ‘ Capture Positive":"ðŸ‘ Positive Capture"):y.cumulativeTicks>=-25?N.push(o==="fr"?"âš ï¸ Capture DÃ©ficitaire":"âš ï¸ Deficit Capture"):N.push(o==="fr"?"ðŸ”´ Capture ProblÃ©matique":"ðŸ”´ Problematic Capture"),(y.tradeTicks??0)>0&&(y.tradeTicks??0)>=10?N.push(o==="fr"?"ðŸš€ Trade Excellent":"ðŸš€ Excellent Trade"):(y.tradeTicks??0)>0&&N.push(o==="fr"?"âœ… Trade Positif":"âœ… Positive Trade")),y.pnl!==void 0&&y.trades!==void 0&&!y.cumulativePercentage&&!y.winRate){(y.percentage??0)>=5?N.push(o==="fr"?"ðŸš€ PÃ©riode Exceptionnelle":"ðŸš€ Exceptional Period"):(y.percentage??0)>=2?N.push(o==="fr"?"ðŸ’° PÃ©riode TrÃ¨s Profitable":"ðŸ’° Highly Profitable Period"):(y.percentage??0)>=1?N.push(o==="fr"?"âœ… PÃ©riode Profitable":"âœ… Profitable Period"):(y.percentage??0)>=0?N.push(o==="fr"?"ðŸŸ¡ PÃ©riode Ã‰quilibrÃ©e":"ðŸŸ¡ Balanced Period"):(y.percentage??0)>=-1?N.push(o==="fr"?"âš ï¸ PÃ©riode Difficile":"âš ï¸ Difficult Period"):(y.percentage??0)>=-3?N.push(o==="fr"?"ðŸŸ  PÃ©riode ProblÃ©matique":"ðŸŸ  Problematic Period"):N.push(o==="fr"?"ðŸ”´ PÃ©riode Critique":"ðŸ”´ Critical Period"),(y.trades??0)>=10?N.push(o==="fr"?"ðŸ“Š Volume Ã‰levÃ©":"ðŸ“Š High Volume"):(y.trades??0)>=5?N.push(o==="fr"?"ðŸ“ˆ Volume ModÃ©rÃ©":"ðŸ“ˆ Moderate Volume"):(y.trades??0)>=2?N.push(o==="fr"?"ðŸ“‰ Volume Faible":"ðŸ“‰ Low Volume"):N.push(o==="fr"?"âš ï¸ Volume TrÃ¨s Faible":"âš ï¸ Very Low Volume");const w=(y.percentage??0)/Math.max(y.trades??1,1);w>=1?N.push(o==="fr"?"ðŸŽ¯ EfficacitÃ© Excellente":"ðŸŽ¯ Excellent Efficiency"):w>=.5?N.push(o==="fr"?"âœ… EfficacitÃ© Correcte":"âœ… Good Efficiency"):w>=0?N.push(o==="fr"?"ðŸ‘ EfficacitÃ© Positive":"ðŸ‘ Positive Efficiency"):N.push(o==="fr"?"ðŸ”´ EfficacitÃ© NÃ©gative":"ðŸ”´ Negative Efficiency");const S=(y.pnl??0)/1e4*100;Math.abs(S)>=2?N.push(o==="fr"?"ðŸ’¥ Impact Capital Majeur":"ðŸ’¥ Major Capital Impact"):Math.abs(S)>=1?N.push(o==="fr"?"ðŸ“Š Impact Capital Significatif":"ðŸ“Š Significant Capital Impact"):Math.abs(S)>=.5?N.push(o==="fr"?"ðŸ“ˆ Impact Capital ModÃ©rÃ©":"ðŸ“ˆ Moderate Capital Impact"):N.push(o==="fr"?"ðŸ“‰ Impact Capital Mineur":"ðŸ“‰ Minor Capital Impact")}return y.day&&y.winRate!==void 0&&(y.winRate>=80?N.push(o==="fr"?"ðŸ”¥ Jour Exceptionnel":"ðŸ”¥ Exceptional Day"):y.winRate>=65?N.push(o==="fr"?"âœ… Jour TrÃ¨s Performant":"âœ… Very Performant Day"):y.winRate>=50?N.push(o==="fr"?"ðŸ‘ Jour Positif":"ðŸ‘ Positive Day"):y.winRate>=35?N.push(o==="fr"?"âš ï¸ Jour Difficile":"âš ï¸ Challenging Day"):N.push(o==="fr"?"ðŸ”´ Jour ProblÃ©matique":"ðŸ”´ Problematic Day"),(y.trades??0)>=15?N.push(o==="fr"?"ðŸ“Š Volume Important":"ðŸ“Š High Volume"):(y.trades??0)<=3&&N.push(o==="fr"?"âš ï¸ Ã‰chantillon LimitÃ©":"âš ï¸ Limited Sample")),y.session&&y.winRate!==void 0&&(y.winRate>=75?N.push(o==="fr"?"ðŸ”¥ Session Exceptionnelle":"ðŸ”¥ Exceptional Session"):y.winRate>=60?N.push(o==="fr"?"âœ… Session Performante":"âœ… Performant Session"):y.winRate>=50?N.push(o==="fr"?"ðŸ‘ Session Positive":"ðŸ‘ Positive Session"):y.winRate>=40?N.push(o==="fr"?"âš ï¸ Session Difficile":"âš ï¸ Challenging Session"):N.push(o==="fr"?"ðŸ”´ Session Ã  Ã‰viter":"ðŸ”´ Session to Avoid"),(y.trades??0)>=20?N.push(o==="fr"?"ðŸ“Š Session TrÃ¨s Active":"ðŸ“Š Very Active Session"):(y.trades??0)<=5&&N.push(o==="fr"?"âš ï¸ ActivitÃ© LimitÃ©e":"âš ï¸ Limited Activity"),(y.pnlPercentage??0)>=5?N.push(o==="fr"?"ðŸ’° Session TrÃ¨s Profitable":"ðŸ’° Highly Profitable Session"):(y.pnlPercentage??0)<=-3&&N.push(o==="fr"?"ðŸ”´ Session CoÃ»teuse":"ðŸ”´ Costly Session")),N})(a),j=a.day&&a.dayNumber!==void 0?"weekday":a.session&&a.sessionId!==void 0?"session":a.winRate!==void 0&&a.trades!==void 0?"winrate":a.cumulativePercentage!==void 0&&(a.tradeNumber??0)>0?"pnl":a.capital!==void 0&&a.drawdown!==void 0?"equity":a.cumulativeTicks!==void 0&&(a.tradeNumber??0)>0?"ticks":a.range&&a.count!==void 0?"distribution":a.fullStrategy&&a.trades!==void 0?"performance":a.pnl!==void 0&&!a.cumulativePercentage&&!a.winRate?"periodic":"fallback";return e.jsxs("div",{className:"custom-tooltip",style:{...p(),backgroundColor:c.backgroundColor,border:c.border,borderRadius:"8px",padding:"12px",boxShadow:c.boxShadow,color:c.color,fontWeight:"600",fontSize:"12px",minWidth:"200px",maxWidth:"280px",fontFamily:"Inter, system-ui, sans-serif",lineHeight:"1.4"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"800",marginBottom:"8px",textAlign:"center",color:c.color},children:(a.tradeNumber??0)>0?`${r} â€¢ Trade #${a.tradeNumber}`:r}),j==="winrate"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{title:o==="fr"?"FenÃªtre Mobile (20 trades):":"Moving Window (20 trades):",color:c.sectionColors.primary,children:[e.jsx(f,{label:o==="fr"?"Taux de RÃ©ussite":"Win Rate",value:`${(a.winRate??0).toFixed(1)}%`,valueColor:"#4caf50"}),e.jsx(f,{label:o==="fr"?"RÃ©partition":"Distribution",value:`${a.wins||0} ${o==="fr"?"gagnants":"winners"} / ${a.losses||0} ${o==="fr"?"perdants":"losers"}`})]}),e.jsxs(x,{title:o==="fr"?"Performance de la FenÃªtre:":"Window Performance:",color:c.sectionColors.success,children:[e.jsx(f,{label:o==="fr"?"P&L Total":"Total P&L",value:u(a.windowPnLPercentage),valueColor:(a.windowPnLPercentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"En EUR":"In EUR",value:d(a.windowPnL),valueColor:(a.windowPnL??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"Moyenne/Trade":"Average/Trade",value:u(a.avgPercentagePerTrade)})]}),a.currentTrade&&e.jsxs(x,{title:o==="fr"?"Trade Actuel:":"Current Trade:",color:c.sectionColors.info,children:[e.jsx(f,{label:a.currentTrade.symbol,value:`${a.currentTrade.side==="long"?"ðŸ“ˆ Long":"ðŸ“‰ Short"}`}),e.jsx(f,{label:o==="fr"?"StratÃ©gie":"Strategy",value:a.currentTrade.strategy}),e.jsx(f,{label:o==="fr"?"RÃ©sultat":"Result",value:u(a.currentTrade.pnlPercentage),valueColor:(a.currentTrade.pnlPercentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:"Timeframe",value:a.currentTrade.timeframe}),e.jsx(f,{label:"Ticks",value:`${a.currentTrade.ticksGained||0} ticks`})]}),e.jsxs(x,{title:o==="fr"?"Analyse de la FenÃªtre:":"Window Analysis:",color:c.sectionColors.warning,children:[e.jsx(f,{label:o==="fr"?"StratÃ©gies":"Strategies",value:`${a.strategiesCount||0}`}),e.jsx(f,{label:o==="fr"?"Symboles":"Symbols",value:`${a.symbolsCount||0}`}),e.jsx(f,{label:o==="fr"?"Top StratÃ©gie":"Top Strategy",value:a.topStrategy||"-"}),e.jsx(f,{label:o==="fr"?"Top Symboles":"Top Symbols",value:Array.isArray(a.topSymbols)&&(a.topSymbols||[]).join(", ")||"-"}),e.jsx(f,{label:o==="fr"?"DurÃ©e Moyenne":"Average Duration",value:m(a.avgDuration)}),e.jsx(f,{label:o==="fr"?"Ticks Moyens":"Average Ticks",value:`${(a.avgTicks??0).toFixed(1)}`})]})]}),j==="weekday"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{title:o==="fr"?"Jour de Trading:":"Trading Day:",color:c.sectionColors.primary,children:[e.jsx(f,{label:o==="fr"?"Jour":"Day",value:a.day}),e.jsx(f,{label:o==="fr"?"Taux de RÃ©ussite":"Win Rate",value:`${(a.winRate??0).toFixed(1)}%`,valueColor:(a.winRate??0)>=50?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"RÃ©partition":"Distribution",value:`${a.wins||0} ${o==="fr"?"gagnants":"winners"} / ${a.losses||0} ${o==="fr"?"perdants":"losers"}`})]}),e.jsxs(x,{title:"Performance:",color:c.sectionColors.success,children:[e.jsx(f,{label:o==="fr"?"P&L Total":"Total P&L",value:u(a.pnlPercentage),valueColor:(a.pnlPercentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"En EUR":"In EUR",value:d(a.pnl),valueColor:(a.pnl??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"Moyenne/Trade":"Average/Trade",value:u(a.avgPnLPercentage)}),e.jsx(f,{label:o==="fr"?"Nombre de Trades":"Number of Trades",value:`${a.trades}`})]})]}),j==="session"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{title:o==="fr"?"Session de Trading:":"Trading Session:",color:c.sectionColors.primary,children:[e.jsx(f,{label:"Session",value:a.session}),e.jsx(f,{label:o==="fr"?"Taux de RÃ©ussite":"Win Rate",value:`${(a.winRate??0).toFixed(1)}%`,valueColor:(a.winRate??0)>=50?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"RÃ©partition":"Distribution",value:`${a.wins||0} ${o==="fr"?"gagnants":"winners"} / ${a.losses||0} ${o==="fr"?"perdants":"losers"}`})]}),e.jsxs(x,{title:"Performance:",color:c.sectionColors.success,children:[e.jsx(f,{label:o==="fr"?"P&L Total":"Total P&L",value:u(a.pnlPercentage),valueColor:(a.pnlPercentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"En EUR":"In EUR",value:d(a.pnl),valueColor:(a.pnl??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"Moyenne/Trade":"Average/Trade",value:u(a.avgPnLPercentage)}),e.jsx(f,{label:o==="fr"?"Nombre de Trades":"Number of Trades",value:`${a.trades}`})]}),e.jsxs(x,{title:o==="fr"?"Analyse de Session:":"Session Analysis:",color:c.sectionColors.info,children:[e.jsx(f,{label:o==="fr"?"ActivitÃ©":"Activity",value:(a.trades??0)>=20?o==="fr"?"TrÃ¨s Ã‰levÃ©e":"Very High":(a.trades??0)>=10?o==="fr"?"Ã‰levÃ©e":"High":(a.trades??0)>=5?o==="fr"?"ModÃ©rÃ©e":"Moderate":o==="fr"?"Faible":"Low"}),e.jsx(f,{label:o==="fr"?"QualitÃ©":"Quality",value:(a.winRate??0)>=70?o==="fr"?"Excellente":"Excellent":(a.winRate??0)>=55?o==="fr"?"Bonne":"Good":(a.winRate??0)>=45?o==="fr"?"Moyenne":"Average":o==="fr"?"Faible":"Poor",valueColor:(a.winRate??0)>=55?"#4caf50":(a.winRate??0)>=45?"#ff9800":"#f44336"}),e.jsx(f,{label:"Contribution",value:`${((a.trades??0)/(a.totalClosedTradesCount||1)*100).toFixed(0)}%`})]})]}),(j==="pnl"||j==="equity")&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{title:o==="fr"?"Performance Globale:":"Overall Performance:",color:c.sectionColors.success,children:[a.cumulativePercentage!==void 0&&e.jsx(f,{label:o==="fr"?"P&L CumulÃ©":"Cumulative P&L",value:u(a.cumulativePercentage),valueColor:(a.cumulativePercentage??0)>=0?"#4caf50":"#f44336"}),a.cumulativePnL!==void 0&&e.jsx(f,{label:o==="fr"?"En EUR":"In EUR",value:d(a.cumulativePnL),valueColor:(a.cumulativePnL??0)>=0?"#4caf50":"#f44336"}),a.capital&&e.jsx(f,{label:o==="fr"?"Capital Actuel":"Current Capital",value:d(a.capital),valueColor:c.sectionColors.primary})]}),e.jsxs(x,{title:o==="fr"?"Trade Actuel:":"Current Trade:",color:c.sectionColors.info,children:[e.jsx(f,{label:a.symbol,value:`${a.side==="long"?"ðŸ“ˆ Long":"ðŸ“‰ Short"}`}),e.jsx(f,{label:o==="fr"?"StratÃ©gie":"Strategy",value:a.strategy}),e.jsx(f,{label:o==="fr"?"RÃ©sultat":"Result",value:u(a.tradePercentage),valueColor:(a.tradePercentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"En EUR":"In EUR",value:d(a.tradePnL),valueColor:(a.tradePnL??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:"Timeframe",value:a.timeframe}),e.jsx(f,{label:o==="fr"?"DurÃ©e":"Duration",value:m(a.duration)}),a.ticksGained!==void 0&&a.ticksGained!==0&&e.jsx(f,{label:"Ticks",value:`${a.ticksGained>0?"+":""}${a.ticksGained} ticks`,valueColor:a.ticksGained>0?"#4caf50":"#f44336"}),(a.fees??0)>0&&e.jsx(f,{label:o==="fr"?"Frais":"Fees",value:d(a.fees),valueColor:"#ff9800"})]}),a.peak&&e.jsxs(x,{title:o==="fr"?"Analyse Drawdown:":"Drawdown Analysis:",color:c.sectionColors.warning,children:[e.jsx(f,{label:o==="fr"?"Peak Historique":"Historical Peak",value:d(a.peak),valueColor:"#4caf50"}),e.jsx(f,{label:"Drawdown",value:u(a.drawdown),valueColor:"#f44336"})]})]}),j==="distribution"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{title:o==="fr"?"Tranche de Performance:":"Performance Range:",color:c.sectionColors.primary,children:[e.jsx(f,{label:o==="fr"?"Tranche":"Range",value:a.range}),e.jsx(f,{label:"Trades",value:`${a.count}`}),e.jsx(f,{label:o==="fr"?"Pourcentage":"Percentage",value:`${(a.percentage??0).toFixed(1)}%`})]}),e.jsxs(x,{title:o==="fr"?"Performance de la Tranche:":"Range Performance:",color:c.sectionColors.success,children:[e.jsx(f,{label:o==="fr"?"P&L Total":"Total P&L",value:u(a.totalPnLPercentage),valueColor:(a.totalPnLPercentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"En EUR":"In EUR",value:d(a.totalPnL),valueColor:(a.totalPnL??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"P&L Moyen":"Average P&L",value:u(a.avgPnLPercentage)}),e.jsx(f,{label:o==="fr"?"Impact Portfolio":"Portfolio Impact",value:d(a.portfolioImpact)})]}),e.jsxs(x,{title:o==="fr"?"Analyse de la Tranche:":"Range Analysis:",color:c.sectionColors.info,children:[e.jsx(f,{label:o==="fr"?"DurÃ©e Moyenne":"Average Duration",value:m(a.avgDuration)}),e.jsx(f,{label:o==="fr"?"Ticks Moyens":"Average Ticks",value:`${(a.avgTicks??0).toFixed(1)}`}),e.jsx(f,{label:o==="fr"?"StratÃ©gies":"Strategies",value:`${a.strategiesCount}`}),e.jsx(f,{label:o==="fr"?"Symboles":"Symbols",value:`${a.symbolsCount}`})]})]}),j==="performance"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{title:o==="fr"?"StratÃ©gie:":"Strategy:",color:c.sectionColors.primary,children:[e.jsx(f,{label:o==="fr"?"Nom":"Name",value:a.fullStrategy||a.strategy||"-"}),e.jsx(f,{label:"Trades",value:`${a.trades||0}`}),e.jsx(f,{label:o==="fr"?"Taux de RÃ©ussite":"Win Rate",value:`${(a.winRate||0).toFixed(1)}%`,valueColor:(a.winRate||0)>=50?"#4caf50":"#f44336"})]}),e.jsxs(x,{title:"Performance:",color:c.sectionColors.success,children:[e.jsx(f,{label:o==="fr"?"P&L Total":"Total P&L",value:u(a.totalPercentage),valueColor:(a.totalPercentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"En EUR":"In EUR",value:d(a.totalPnL),valueColor:(a.totalPnL??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"P&L Moyen":"Average P&L",value:u(a.avgPercentage)}),e.jsx(f,{label:"Profit Factor",value:(a.profitFactor||0)===1/0?"âˆž":(a.profitFactor||0).toFixed(2)})]}),e.jsxs(x,{title:o==="fr"?"Analyse DÃ©taillÃ©e:":"Detailed Analysis:",color:c.sectionColors.info,children:[e.jsx(f,{label:o==="fr"?"Gain Moyen":"Average Win",value:d(a.avgWin),valueColor:"#4caf50"}),e.jsx(f,{label:o==="fr"?"Perte Moyenne":"Average Loss",value:d(a.avgLoss),valueColor:"#f44336"}),e.jsx(f,{label:o==="fr"?"DurÃ©e Moyenne":"Average Duration",value:m(a.avgDuration)}),e.jsx(f,{label:o==="fr"?"Ticks Moyens":"Average Ticks",value:`${(a.avgTicks??0).toFixed(1)}`}),e.jsx(f,{label:o==="fr"?"Frais Totaux":"Total Fees",value:d(a.totalFees),valueColor:"#ff9800"})]}),e.jsxs(x,{title:o==="fr"?"Performance de la FenÃªtre:":"Window Performance:",color:c.sectionColors.warning,children:[e.jsx(f,{label:o==="fr"?"P&L Total":"Total P&L",value:u(a.windowPnLPercentage),valueColor:(a.windowPnLPercentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"En EUR":"In EUR",value:d(a.windowPnL),valueColor:(a.windowPnL??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"Moyenne/Trade":"Average/Trade",value:u(a.avgPercentagePerTrade)}),e.jsx(f,{label:o==="fr"?"StratÃ©gies":"Strategies",value:`${a.strategiesCount||0}`}),e.jsx(f,{label:o==="fr"?"Symboles":"Symbols",value:`${a.symbolsCount||0}`}),e.jsx(f,{label:o==="fr"?"Top StratÃ©gie":"Top Strategy",value:a.topStrategy||"-"}),e.jsx(f,{label:o==="fr"?"Top Symboles":"Top Symbols",value:Array.isArray(a.topSymbols)&&(a.topSymbols||[]).join(", ")||"-"})]})]}),j==="ticks"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{title:o==="fr"?"Ticks CumulÃ©s:":"Cumulative Ticks:",color:c.sectionColors.success,children:[e.jsx(f,{label:"Total Ticks",value:`${(a.cumulativeTicks??0)>0?"+":""}${a.cumulativeTicks??0}`,valueColor:(a.cumulativeTicks??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"Ce Trade":"This Trade",value:`${(a.tradeTicks??0)>0?"+":""}${a.tradeTicks??0} ticks`,valueColor:(a.tradeTicks??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"Valeur CumulÃ©e":"Cumulative Value",value:d(a.cumulativeValue),valueColor:(a.cumulativeValue??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"Valeur ce Trade":"This Trade Value",value:d(a.tradeValue),valueColor:(a.tradeValue??0)>=0?"#4caf50":"#f44336"})]}),e.jsxs(x,{title:o==="fr"?"Trade Actuel:":"Current Trade:",color:c.sectionColors.info,children:[e.jsx(f,{label:a.symbol,value:`${a.side==="long"?"ðŸ“ˆ Long":"ðŸ“‰ Short"}`}),e.jsx(f,{label:o==="fr"?"StratÃ©gie":"Strategy",value:a.strategy}),e.jsx(f,{label:o==="fr"?"Valeur/Tick":"Value/Tick",value:d(a.tickValue)}),e.jsx(f,{label:"Timeframe",value:a.timeframe}),e.jsx(f,{label:o==="fr"?"DurÃ©e":"Duration",value:m(a.duration)}),e.jsx(f,{label:o==="fr"?"P&L Trade":"Trade P&L",value:u(a.pnlPercentage),valueColor:(a.pnlPercentage??0)>=0?"#4caf50":"#f44336"}),(a.fees??0)>0&&e.jsx(f,{label:o==="fr"?"Frais":"Fees",value:d(a.fees),valueColor:"#ff9800"})]})]}),j==="periodic"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{title:o==="fr"?"PÃ©riode AnalysÃ©e:":"Analyzed Period:",color:c.sectionColors.primary,children:[e.jsx(f,{label:"Date",value:r||""}),e.jsx(f,{label:o==="fr"?"Nombre de Trades":"Number of Trades",value:`${a.trades||0}`}),e.jsx(f,{label:o==="fr"?"FrÃ©quence":"Frequency",value:(a.trades??0)>=10?o==="fr"?"Ã‰levÃ©e":"High":(a.trades??0)>=5?o==="fr"?"ModÃ©rÃ©e":"Moderate":(a.trades??0)>=2?o==="fr"?"Faible":"Low":o==="fr"?"TrÃ¨s Faible":"Very Low"})]}),e.jsxs(x,{title:o==="fr"?"Performance de la PÃ©riode:":"Period Performance:",color:c.sectionColors.success,children:[e.jsx(f,{label:o==="fr"?"P&L PÃ©riode":"Period P&L",value:u(a.percentage),valueColor:(a.percentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"En EUR":"In EUR",value:d(a.pnl),valueColor:(a.pnl??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"P&L Moyen/Trade":"Average P&L/Trade",value:u((a.percentage??0)/Math.max(a.trades??1,1))}),e.jsx(f,{label:o==="fr"?"Impact Capital":"Capital Impact",value:`${((a.pnl??0)/1e4*100).toFixed(2)}%`,valueColor:(a.pnl??0)>=0?"#4caf50":"#f44336"})]}),e.jsxs(x,{title:o==="fr"?"Analyse de Performance:":"Performance Analysis:",color:c.sectionColors.info,children:[e.jsx(f,{label:o==="fr"?"EfficacitÃ©":"Efficiency",value:(a.trades??0)>0?`${((a.percentage??0)/(a.trades??1)).toFixed(2)}% ${o==="fr"?"par trade":"per trade"}`:"N/A",valueColor:(a.trades??0)>0&&(a.percentage??0)/(a.trades??1)>=.5?"#4caf50":"#ff9800"}),e.jsx(f,{label:o==="fr"?"IntensitÃ© Trading":"Trading Intensity",value:(a.trades??0)>=10?o==="fr"?"TrÃ¨s Active":"Very Active":(a.trades??0)>=5?"Active":(a.trades??0)>=2?o==="fr"?"ModÃ©rÃ©e":"Moderate":o==="fr"?"Faible":"Low",valueColor:(a.trades??0)>=5?"#4caf50":(a.trades??0)>=2?"#ff9800":"#f44336"}),e.jsx(f,{label:o==="fr"?"QualitÃ© PÃ©riode":"Period Quality",value:(a.percentage??0)>=2?o==="fr"?"Excellente":"Excellent":(a.percentage??0)>=1?o==="fr"?"Bonne":"Good":(a.percentage??0)>=0?o==="fr"?"Correcte":"Fair":(a.percentage??0)>=-1?o==="fr"?"Difficile":"Difficult":o==="fr"?"ProblÃ©matique":"Problematic",valueColor:(a.percentage??0)>=1?"#4caf50":(a.percentage??0)>=0?"#ff9800":"#f44336"})]}),e.jsxs(x,{title:o==="fr"?"Contexte de Trading:":"Trading Context:",color:c.sectionColors.warning,children:[e.jsx(f,{label:o==="fr"?"Volume Relatif":"Relative Volume",value:(a.trades??0)>=10?o==="fr"?"Ã‰levÃ© (>10)":"High (>10)":(a.trades??0)>=5?"Normal (5-10)":(a.trades??0)>=2?o==="fr"?"Faible (2-4)":"Low (2-4)":o==="fr"?"TrÃ¨s Faible (<2)":"Very Low (<2)"}),e.jsx(f,{label:o==="fr"?"Contribution Portfolio":"Portfolio Contribution",value:Math.abs(a.percentage??0)>=2?o==="fr"?"Majeure":"Major":Math.abs(a.percentage??0)>=1?o==="fr"?"Significative":"Significant":Math.abs(a.percentage??0)>=.5?o==="fr"?"ModÃ©rÃ©e":"Moderate":o==="fr"?"Mineure":"Minor"}),e.jsx(f,{label:o==="fr"?"Risque PÃ©riode":"Period Risk",value:Math.abs(a.percentage??0)>=3?o==="fr"?"Ã‰levÃ©":"High":Math.abs(a.percentage??0)>=1.5?o==="fr"?"ModÃ©rÃ©":"Moderate":o==="fr"?"Faible":"Low",valueColor:Math.abs(a.percentage??0)>=3?"#f44336":Math.abs(a.percentage??0)>=1.5?"#ff9800":"#4caf50"})]})]}),j==="fallback"&&e.jsx(x,{title:o==="fr"?"DonnÃ©es:":"Data:",color:c.sectionColors.primary,children:s.map((y,N)=>e.jsx(f,{label:y.name||y.dataKey,value:typeof y.value=="number"?y.value>1e3?d(y.value):y.value.toFixed(2):String(y.value||"-"),valueColor:y.color||c.sectionColors.primary},N))}),h.length>0&&e.jsx(x,{title:o==="fr"?"ðŸ§  Analyse Intelligente:":"ðŸ§  Intelligent Analysis:",color:c.sectionColors.analysis,children:h.map((y,N)=>e.jsx("div",{style:{fontSize:"11px",fontWeight:"700",marginBottom:"4px",padding:"3px 6px",borderRadius:"4px",backgroundColor:c.sectionColors.analysis+"20",color:c.sectionColors.analysis,textAlign:"center"},children:y},N))})]})},vf=({trades:t,settings:s,viewMode:r,onEditTrade:l,onDeleteTrade:n})=>{const{currentTheme:o}=Q(),{currentLanguage:a}=Z(),[i,c]=g.useState(!0),[d,u]=g.useState(!0),[m,p]=g.useState(null),[x,f]=g.useState(null),v=V.useMemo(()=>{const P=t.filter(F=>F.status==="closed");if(P.length===0)return[];const R=[...P].sort((F,$)=>new Date(F.date+" "+(F.time||"00:00")).getTime()-new Date($.date+" "+($.time||"00:00")).getTime());let M=0,T=0,D=s.initialCapital;return[{date:a==="fr"?"DÃ©but":"Start",cumulativePnL:0,cumulativePercentage:0,capital:s.initialCapital,tradeNumber:0,tradePnL:0,tradePercentage:0,symbol:"",strategy:"",side:"",timeframe:"",duration:0,ticksGained:void 0,fees:0},...R.map((F,$)=>{const U=F.pnl||0,B=F.pnlPercentage||0;return M+=U,T+=B,D+=U,{date:F.date&&!isNaN(new Date(F.date).getTime())?st(new Date(F.date),"dd/MM/yyyy",{locale:a==="fr"?rt:dt}):"N/A",cumulativePnL:M,cumulativePercentage:T,capital:D,tradeNumber:$+1,tradePnL:U,tradePercentage:B,symbol:F.symbol,strategy:F.strategy,side:F.side,timeframe:F.timeframe||"",duration:F.duration||0,ticksGained:F.ticksGained,fees:F.fees?.total||F.commission||0,tradeId:F.id,originalTrade:F}})]},[t,s.initialCapital,a]),h=P=>new Intl.NumberFormat(a==="fr"?"fr-FR":"en-US",{style:"currency",currency:s.currency,minimumFractionDigits:0,maximumFractionDigits:0}).format(P),b=P=>`${P>=0?"+":""}${P.toFixed(2)}%`,j=()=>{if(r==="percentage"){const P=v.map(F=>F.cumulativePercentage),R=Math.min(...P),M=Math.max(...P),T=M-R,D=Math.max(T*.1,1);return{percentageDomain:[R-D,M+D],currencyDomain:"dataMin"}}else{const P=v.map(F=>F.capital),R=Math.min(...P),M=Math.max(...P),T=M-R,D=Math.max(T*.1,100);return{currencyDomain:[R-D,M+D],percentageDomain:"dataMin"}}},{percentageDomain:y,currencyDomain:N}=j(),w=P=>{if(P&&P.activePayload&&P.activePayload.length>0){const R=P.activePayload[0].payload;R.originalTrade&&p(R.originalTrade)}},S=P=>{if(P&&P.activePayload&&P.activePayload.length>0){const R=P.activePayload[0].payload;R.tradeId&&(f(R.tradeId),document.body.style.cursor="pointer")}},k=()=>{f(null),document.body.style.cursor="default"},C=P=>{const{cx:R,cy:M,payload:T,index:D}=P,F=x===T.tradeId;return e.jsx("circle",{cx:R,cy:M,r:F?6:4,fill:o.colors.accent,stroke:"#ffffff",strokeWidth:F?3:2,style:{cursor:"pointer",filter:F?"drop-shadow(0 0 6px rgba(59, 130, 246, 0.6))":"none",transition:"all 0.2s ease"},onClick:()=>{T.originalTrade&&p(T.originalTrade)}},T?.tradeId??D)};return v.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{style:{color:o.colors.textSecondary},children:a==="fr"?"Pas assez de donnÃ©es pour afficher le graphique P&L":"Not enough data to display the P&L chart"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",style:{color:o.colors.text},children:r==="percentage"?a==="fr"?"P&L CumulÃ© (Pourcentage du Capital)":"Cumulative P&L (Percentage of Capital)":a==="fr"?"Ã‰volution du Capital (EUR)":"Capital Evolution (EUR)"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>c(!i),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${i?"shadow-sm":"opacity-50"}`,style:{backgroundColor:i?o.colors.accent:o.colors.surface,color:i?"#ffffff":o.colors.textSecondary,border:`1px solid ${i?o.colors.accent:o.colors.border}`},children:[i?e.jsx(Se,{size:16,className:"mr-2"}):e.jsx(De,{size:16,className:"mr-2"}),"Points"]}),r==="percentage"&&e.jsxs("button",{onClick:()=>u(!d),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${d?"shadow-sm":"opacity-50"}`,style:{backgroundColor:d?o.colors.warning:o.colors.surface,color:d?"#ffffff":o.colors.textSecondary,border:`1px solid ${d?o.colors.warning:o.colors.border}`},children:[d?e.jsx(Se,{size:16,className:"mr-2"}):e.jsx(De,{size:16,className:"mr-2"}),"Capital EUR"]})]})]}),e.jsx(Cs,{width:"100%",height:400,children:r==="percentage"?e.jsxs(As,{data:v,onClick:w,onMouseMove:S,onMouseLeave:k,children:[e.jsx(ns,{strokeDasharray:"3 3",stroke:o.colors.border}),e.jsx(ls,{dataKey:"date",stroke:o.colors.textMuted,fontSize:12}),e.jsx(bt,{yAxisId:"percentage",stroke:o.colors.textMuted,fontSize:12,domain:y,tickFormatter:P=>`${P.toFixed(1)}%`}),d&&e.jsx(bt,{yAxisId:"currency",orientation:"right",stroke:o.colors.textMuted,fontSize:12,domain:N,tickFormatter:P=>`${Math.round(P)} ${s.currency}`}),e.jsx(Jt,{content:e.jsx(Yt,{})}),e.jsx(Ut,{}),e.jsx(Ns,{y:0,yAxisId:"percentage",stroke:o.colors.textMuted,strokeDasharray:"5 5"}),e.jsx(Kt,{yAxisId:"percentage",type:"monotone",dataKey:"cumulativePercentage",stroke:o.colors.accent,strokeWidth:2,dot:i?C:!1,name:a==="fr"?"P&L CumulÃ© %":"Cumulative P&L %"}),d&&e.jsx(Kt,{yAxisId:"currency",type:"monotone",dataKey:"capital",stroke:o.colors.warning,strokeWidth:2,strokeDasharray:"5 5",dot:i?P=>{const{key:R,...M}=P,T=M?.payload?.tradeId??M?.index;return e.jsx(C,{...M,fill:o.colors.warning},T)}:!1,name:a==="fr"?"Capital en EUR":"Capital in EUR"})]}):e.jsxs(As,{data:v,onClick:w,onMouseMove:S,onMouseLeave:k,children:[e.jsx(ns,{strokeDasharray:"3 3",stroke:o.colors.border}),e.jsx(ls,{dataKey:"date",stroke:o.colors.textMuted,fontSize:12}),e.jsx(bt,{stroke:o.colors.textMuted,fontSize:12,domain:N,tickFormatter:P=>`${Math.round(P)} ${s.currency}`}),e.jsx(Jt,{content:e.jsx(Yt,{})}),e.jsx(Ut,{}),Array.isArray(N)&&s.initialCapital>=N[0]&&s.initialCapital<=N[1]&&e.jsx(Ns,{y:s.initialCapital,stroke:o.colors.textMuted,strokeDasharray:"5 5",label:{value:a==="fr"?"Capital Initial":"Initial Capital",position:"topLeft"}}),e.jsx(Kt,{type:"monotone",dataKey:"capital",stroke:o.colors.accent,strokeWidth:2,dot:i?C:!1,name:a==="fr"?"Capital Actuel":"Current Capital"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${v[v.length-1]?.cumulativePercentage>=0?"text-green-600":"text-red-600"}`,children:b(v[v.length-1]?.cumulativePercentage||0)}),e.jsx("div",{className:"text-sm",style:{color:o.colors.textMuted},children:a==="fr"?"P&L Total":"Total P&L"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:o.colors.text},children:h(v[v.length-1]?.capital||s.initialCapital)}),e.jsx("div",{className:"text-sm",style:{color:o.colors.textMuted},children:a==="fr"?"Capital Actuel":"Current Capital"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:o.colors.text},children:t.filter(P=>P.status==="closed").length}),e.jsx("div",{className:"text-sm",style:{color:o.colors.textMuted},children:a==="fr"?"Trades Total":"Total Trades"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--theme-accent)"},children:h(s.initialCapital)}),e.jsx("div",{className:"text-sm",style:{color:o.colors.textMuted},children:a==="fr"?"Capital Initial":"Initial Capital"})]})]}),m&&e.jsx(Ws,{trade:m,settings:s,onClose:()=>p(null),onEdit:P=>{l&&l(P),p(null)},onDelete:P=>{n&&n(P),p(null)}})]})},cn=Zr((t,s)=>({isOpen:!1,selectedTradeIds:[],baselineId:null,activeTab:"summary",graphMode:"side-by-side",openModal:(r=[])=>{const l=r.length>0?r:[];t({isOpen:!0,selectedTradeIds:l,baselineId:l[0]||null,activeTab:"summary",graphMode:"side-by-side"})},closeModal:()=>{t({isOpen:!1,selectedTradeIds:[],baselineId:null,activeTab:"summary",graphMode:"side-by-side"})},addTrade:r=>{const{selectedTradeIds:l}=s();if(!l.includes(r)){const n=[...l,r];t({selectedTradeIds:n,baselineId:s().baselineId||r})}},removeTrade:r=>{const{selectedTradeIds:l,baselineId:n}=s(),o=l.filter(i=>i!==r),a=n===r?o[0]||null:n;t({selectedTradeIds:o,baselineId:a})},setBaseline:r=>{t({baselineId:r})},setActiveTab:r=>{t({activeTab:r})},setGraphMode:r=>{t({graphMode:r})},clearAll:()=>{t({selectedTradeIds:[],baselineId:null,activeTab:"summary",graphMode:"side-by-side"})}})),jf=(t,s)=>{const r=s.find(n=>n.id===t)||null;return{trades:s.map(n=>{const o=n.id===t,a=r?{pnl:(n.pnl||0)-(r.pnl||0),pnlPercentage:(n.pnlPercentage||0)-(r.pnlPercentage||0),ticks:(n.ticksGained||0)-(r.ticksGained||0),duration:(n.duration||0)-(r.duration||0),riskReward:(n.riskReward||0)-(r.riskReward||0),fees:(n.fees?.total||0)-(r.fees?.total||0)}:{pnl:0,pnlPercentage:0,ticks:0,duration:0,riskReward:0,fees:0};return{trade:n,isBaseline:o,diffs:a}}),baseline:r}},Nf=t=>{if(t.length===0)return{};const s={pnl:t.map(r=>r.pnl||0),pnlPercentage:t.map(r=>r.pnlPercentage||0),ticks:t.map(r=>r.ticksGained||0),duration:t.map(r=>r.duration||0),riskReward:t.map(r=>r.riskReward||0),fees:t.map(r=>r.fees?.total||0)};return{pnl:{best:Math.max(...s.pnl),worst:Math.min(...s.pnl)},pnlPercentage:{best:Math.max(...s.pnlPercentage),worst:Math.min(...s.pnlPercentage)},ticks:{best:Math.max(...s.ticks),worst:Math.min(...s.ticks)},duration:{best:Math.min(...s.duration),worst:Math.max(...s.duration)},riskReward:{best:Math.max(...s.riskReward),worst:Math.min(...s.riskReward)},fees:{best:Math.min(...s.fees),worst:Math.max(...s.fees)}}},kf=(t,s)=>{const r=t>=0?"+":"";switch(s){case"currency":return`${r}${t.toFixed(0)}â‚¬`;case"percentage":return`${r}${t.toFixed(2)}%`;case"duration":const l=Math.floor(Math.abs(t)/3600),n=Math.floor(Math.abs(t)%3600/60),o=Math.floor(Math.abs(t)%60),a=l>0?`${l}h ${n}m`:n>0?`${n}m ${o}s`:`${o}s`;return`${r}${a}`;case"number":default:return`${r}${t.toFixed(2)}`}},wf=({theme:t,language:s,onToggleTradeSelector:r,onExportCSV:l,onSave:n,onCloseAll:o})=>e.jsxs("div",{className:"flex items-center space-x-2 p-6 border-b",style:{borderColor:t.colors.border},children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:t.colors.text},children:s==="fr"?"Comparaison de Trades":"Trade Comparison"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:r,className:"p-2 rounded-lg transition-colors",style:{color:t.colors.text,backgroundColor:t.colors.surface,border:`1px solid ${t.colors.border}`},onMouseEnter:a=>{a.currentTarget.style.backgroundColor=t.colors.accent,a.currentTarget.style.color=t.colors.card},onMouseLeave:a=>{a.currentTarget.style.backgroundColor=t.colors.surface,a.currentTarget.style.color=t.colors.text},title:s==="fr"?"Ajouter/Retirer des trades":"Add/Remove trades",children:e.jsx(Je,{size:20})}),e.jsx("button",{onClick:l,className:"p-2 rounded-lg transition-colors",style:{color:t.colors.text,backgroundColor:t.colors.surface,border:`1px solid ${t.colors.border}`},onMouseEnter:a=>{a.currentTarget.style.backgroundColor=t.colors.accent,a.currentTarget.style.color=t.colors.card},onMouseLeave:a=>{a.currentTarget.style.backgroundColor=t.colors.surface,a.currentTarget.style.color=t.colors.text},title:s==="fr"?"Exporter CSV":"Export CSV",children:e.jsx(cr,{size:20})}),e.jsx("button",{onClick:n,className:"p-2 rounded-lg transition-colors",style:{color:t.colors.text,backgroundColor:t.colors.surface,border:`1px solid ${t.colors.border}`},onMouseEnter:a=>{a.currentTarget.style.backgroundColor=t.colors.accent,a.currentTarget.style.color=t.colors.card},onMouseLeave:a=>{a.currentTarget.style.backgroundColor=t.colors.surface,a.currentTarget.style.color=t.colors.text},title:s==="fr"?"Sauvegarder":"Save",children:e.jsx(Rt,{size:20})}),e.jsx("button",{onClick:o,className:"p-2 rounded-lg transition-colors",style:{color:t.colors.text,backgroundColor:t.colors.surface,border:`1px solid ${t.colors.border}`},onMouseEnter:a=>{a.currentTarget.style.backgroundColor=t.colors.danger,a.currentTarget.style.color=t.colors.card},onMouseLeave:a=>{a.currentTarget.style.backgroundColor=t.colors.surface,a.currentTarget.style.color=t.colors.text},children:e.jsx(Ne,{size:20})})]})]}),Sf=({activeTab:t,setActiveTab:s,theme:r,language:l})=>{const n=[{id:"metrics",label:l==="fr"?"MÃ©triques":"Metrics",icon:ic},{id:"graph",label:l==="fr"?"Graphique":"Graph",icon:_e}];return e.jsx("div",{className:"flex border-b",style:{borderColor:r.colors.border},children:n.map(({id:o,label:a,icon:i})=>e.jsxs("button",{onClick:()=>s(o),className:"flex items-center space-x-2 px-6 py-3 text-sm font-medium transition-colors",style:{borderBottomColor:t===o?r.colors.accent:"transparent",color:t===o?r.colors.accent:r.colors.textMuted,backgroundColor:"transparent"},onMouseEnter:c=>{t!==o&&(c.currentTarget.style.backgroundColor=r.colors.surface)},onMouseLeave:c=>{t!==o&&(c.currentTarget.style.backgroundColor="transparent")},children:[e.jsx(i,{size:16}),e.jsx("span",{children:a})]},o))})},Cf=({trades:t,selectedTradeIds:s,onToggle:r,formatDate:l,theme:n})=>e.jsx("div",{className:"p-4 border-b",style:{borderColor:n.colors.border},children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 max-h-32 overflow-y-auto",children:t.map(o=>{const a=s.includes(o.id);return e.jsxs("button",{onClick:()=>r(o.id,a),className:"p-2 rounded text-sm flex items-center space-x-2 transition-colors",style:{backgroundColor:a?n.colors.accent:n.colors.surface,color:a?n.colors.card:n.colors.text,border:`1px solid ${a?n.colors.accent:n.colors.border}`},onMouseEnter:i=>{a||(i.currentTarget.style.backgroundColor=n.colors.accent,i.currentTarget.style.color=n.colors.card)},onMouseLeave:i=>{a||(i.currentTarget.style.backgroundColor=n.colors.surface,i.currentTarget.style.color=n.colors.text)},children:[a?e.jsx(gl,{size:14}):e.jsx(Je,{size:14}),e.jsxs("span",{children:[o.symbol," - ",l(o.date)]})]},o.id)})})}),Pf=({items:t,theme:s,language:r,settings:l,onSelectIndex:n,focusedIndex:o,setBaseline:a,formatDate:i})=>{const{formatCurrency:c,formatPercentage:d,formatDuration:u}=Ms();return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(({trade:m,isBaseline:p},x)=>e.jsxs("div",{className:`p-4 rounded-lg border-2 transition-all cursor-pointer ${o===x?"ring-2 ring-blue-500":""}`,style:{borderColor:p?s.colors.accent:s.colors.border,backgroundColor:s.colors.surface},onClick:()=>n(x),children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",checked:p,onChange:()=>a(m.id),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",style:{color:s.colors.text},children:p?"Baseline":`Trade ${x+1}`})]}),e.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium ${(m.pnl||0)>=0?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:(m.pnl||0)>=0?"WIN":"LOSS"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"Date:"}),e.jsx("span",{className:"text-sm font-medium",style:{color:s.colors.text},children:i(m.date)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"Symbole:"}),e.jsx("span",{className:"text-sm font-medium",style:{color:s.colors.text},children:m.symbol})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"Direction:"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[m.side==="long"?e.jsx(Ae,{size:14,style:{color:s.colors.success}}):e.jsx($t,{size:14,style:{color:s.colors.danger}}),e.jsx("span",{className:"text-sm font-medium",style:{color:s.colors.text},children:m.side==="long"?"Long":"Short"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"StratÃ©gie:"}),e.jsx("span",{className:"text-sm font-medium",style:{color:s.colors.text},children:m.strategy})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"P&L â‚¬:"}),e.jsx("span",{className:"text-sm font-medium",style:{color:(m.pnl||0)>=0?s.colors.success:s.colors.danger},children:c(m.pnl||0,l.currency)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"P&L %:"}),e.jsx("span",{className:"text-sm font-medium",style:{color:(m.pnlPercentage||0)>=0?s.colors.success:s.colors.danger},children:d(m.pnlPercentage||0)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"Ticks:"}),e.jsx("span",{className:"text-sm font-medium",style:{color:(m.ticksGained||0)>=0?s.colors.success:s.colors.danger},children:m.ticksGained?(m.ticksGained>0?"+":"")+m.ticksGained+" ticks":0})]}),m.duration!==void 0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"DurÃ©e:"}),e.jsx("span",{className:"text-sm font-medium",style:{color:s.colors.text},children:u(m.duration||0)})]}),m.riskReward!==void 0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"R:R:"}),e.jsxs("span",{className:"text-sm font-medium",style:{color:s.colors.text},children:["1:",m.riskReward.toFixed(1)]})]}),(m.fees?.total||m.commission)&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"Frais:"}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--theme-warning)"},children:c(m.fees?.total||m.commission||0,l.currency)})]})]})]},m.id))})},Mf=({metrics:t,bestWorstValues:s,theme:r,language:l,settings:n})=>{const{formatCurrency:o,formatPercentage:a,formatDuration:i}=Ms(),c=[{key:"pnl",label:"P&L â‚¬",type:"currency"},{key:"pnlPercentage",label:"P&L %",type:"percentage"},{key:"ticksGained",label:"Ticks",type:"number"},{key:"duration",label:"DurÃ©e",type:"duration"},{key:"riskReward",label:"R:R",type:"number"},{key:"fees",label:"Frais",type:"currency"}];return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottomColor:r.colors.border},children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium",style:{color:r.colors.textMuted},children:l==="fr"?"MÃ©trique":"Metric"}),t.trades.map(({trade:d,isBaseline:u},m)=>e.jsx("th",{className:"text-center py-3 px-4 font-medium",style:{color:r.colors.textMuted},children:u?"Baseline":`Trade ${m+1}`},d.id)),e.jsx("th",{className:"text-center py-3 px-4 font-medium",style:{color:r.colors.textMuted},children:"Diff vs Baseline"})]})}),e.jsx("tbody",{children:c.map(({key:d,label:u,type:m})=>e.jsxs("tr",{style:{borderBottomColor:r.colors.border},children:[e.jsx("td",{className:"py-3 px-4 font-medium",style:{color:r.colors.text},children:u}),t.trades.map(({trade:p})=>{const x=d==="fees"?p.fees?.total||0:p[d],f=s[d],v=f?.best===x,h=f?.worst===x;return e.jsx("td",{className:"text-center py-3 px-4",children:e.jsx("span",{className:`font-medium ${v?"text-green-600 dark:text-green-400":h?"text-red-600 dark:text-red-400":""}`,style:{color:v?r.colors.success:h?r.colors.danger:r.colors.text},children:m==="currency"?o(x,n.currency):m==="percentage"?a(x):m==="duration"?i(x):x?.toFixed(2)||"-"})},p.id)}),e.jsx("td",{className:"text-center py-3 px-4",children:t.trades.map(({diffs:p,isBaseline:x})=>x?null:e.jsx("span",{className:"text-sm",style:{color:p[d]>=0?r.colors.success:r.colors.danger},children:kf(p[d],m)},String(p[d])))})]},String(d)))})]})})},Rf=({trade:t,width:s=300,height:r=200,showNavigation:l=!0,onClick:n})=>{const{currentTheme:o}=Q(),{currentLanguage:a}=Z(),[i,c]=g.useState(0),d=g.useMemo(()=>!t.screenshots||t.screenshots.length===0?[]:t.screenshots.map(f=>typeof f=="string"?{url:f,caption:""}:f),[t.screenshots]),u=()=>{c(f=>(f-1+d.length)%d.length)},m=()=>{c(f=>(f+1)%d.length)};if(V.useEffect(()=>{const f=v=>{d.length<=1||(v.key==="ArrowLeft"?(v.preventDefault(),u()):v.key==="ArrowRight"&&(v.preventDefault(),m()))};return document.addEventListener("keydown",f),()=>document.removeEventListener("keydown",f)},[d.length]),d.length===0)return e.jsxs("div",{className:"flex flex-col items-center justify-center rounded border-2 border-dashed",style:{width:s,height:r,borderColor:o.colors.border,backgroundColor:o.colors.surface},children:[e.jsx(fl,{size:32,style:{color:o.colors.textMuted},className:"mb-2"}),e.jsx("span",{className:"text-sm text-center px-4",style:{color:o.colors.textMuted},children:a==="fr"?"Aucun screenshot disponible":"No screenshot available"})]});const p=d[i],x=d.length>1;return e.jsxs("div",{className:"relative rounded border overflow-hidden",style:{width:s,height:r,borderColor:o.colors.border,backgroundColor:o.colors.surface},children:[e.jsx("img",{src:p.url,alt:p.caption||`Screenshot ${i+1}`,className:"w-full h-full object-contain cursor-pointer hover:opacity-90 transition-opacity",style:{backgroundColor:o.colors.surface},onClick:n}),l&&x&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:u,className:"absolute left-2 top-1/2 transform -translate-y-1/2 p-1 rounded-full transition-all hover:bg-black hover:bg-opacity-20",style:{backgroundColor:o.colors.surface+"80"},title:a==="fr"?"PrÃ©cÃ©dent":"Previous",children:e.jsx(as,{size:20,style:{color:o.colors.text}})}),e.jsx("button",{onClick:m,className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1 rounded-full transition-all hover:bg-black hover:bg-opacity-20",style:{backgroundColor:o.colors.surface+"80"},title:a==="fr"?"Suivant":"Next",children:e.jsx(Is,{size:20,style:{color:o.colors.text}})}),e.jsxs("div",{className:"absolute bottom-2 left-1/2 transform -translate-x-1/2 px-2 py-1 rounded text-xs font-medium",style:{backgroundColor:o.colors.surface+"E6",color:o.colors.text},children:[i+1," / ",d.length]})]}),p.caption&&e.jsx("div",{className:"absolute top-2 left-2 right-2 px-2 py-1 rounded text-xs text-center",style:{backgroundColor:o.colors.surface+"E6",color:o.colors.text},children:p.caption})]})},Tf=({trades:t,baselineId:s,graphMode:r,setGraphMode:l,theme:n,language:o,settings:a,onScreenshotClick:i,formatDate:c,setBaseline:d})=>{const{formatCurrency:u,formatPercentage:m,formatDuration:p}=Ms();return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",style:{color:n.colors.text},children:o==="fr"?"Graphiques de Performance":"Performance Charts"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>l("side-by-side"),className:"p-2 rounded transition-colors",style:{backgroundColor:r==="side-by-side"?n.colors.accent:n.colors.surface,color:r==="side-by-side"?n.colors.card:n.colors.text,border:`1px solid ${n.colors.border}`},onMouseEnter:x=>{r!=="side-by-side"&&(x.currentTarget.style.backgroundColor=n.colors.accent,x.currentTarget.style.color=n.colors.card)},onMouseLeave:x=>{r!=="side-by-side"&&(x.currentTarget.style.backgroundColor=n.colors.surface,x.currentTarget.style.color=n.colors.text)},title:o==="fr"?"CÃ´te Ã  cÃ´te":"Side by side",children:e.jsx(os,{size:16})}),e.jsx("button",{onClick:()=>l("stack"),className:"p-2 rounded transition-colors",style:{backgroundColor:r==="stack"?n.colors.accent:n.colors.surface,color:r==="stack"?n.colors.card:n.colors.text,border:`1px solid ${n.colors.border}`},onMouseEnter:x=>{r!=="stack"&&(x.currentTarget.style.backgroundColor=n.colors.accent,x.currentTarget.style.color=n.colors.card)},onMouseLeave:x=>{r!=="stack"&&(x.currentTarget.style.backgroundColor=n.colors.surface,x.currentTarget.style.color=n.colors.text)},title:o==="fr"?"EmpilÃ©s":"Stacked",children:e.jsx(Mt,{size:16})})]})]}),e.jsx("div",{className:`grid gap-6 ${r==="side-by-side"?"grid-cols-1 lg:grid-cols-2":"grid-cols-1"}`,children:t.map(x=>{const f=x.id===s;return e.jsxs("div",{className:"p-6 rounded-lg border",style:{borderColor:n.colors.border},children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h4",{className:"font-medium",style:{color:n.colors.text},children:[x.symbol," - ",c(x.date)]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded font-medium ${(x.pnl||0)>=0?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:(x.pnl||0)>=0?"WIN":"LOSS"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"baseline",checked:f,onChange:()=>d(x.id),className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:"Baseline"})]})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Rf,{trade:x,width:450,height:280,showNavigation:!0,onClick:()=>i(x)})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:"Date:"}),e.jsx("span",{className:"text-xs font-medium",style:{color:n.colors.text},children:c(x.date)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"Symbole:":"Symbol:"}),e.jsx("span",{className:"text-xs font-medium",style:{color:n.colors.text},children:x.symbol})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:"Direction:"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[x.side==="long"?e.jsx(Ae,{size:12,style:{color:n.colors.success}}):e.jsx($t,{size:12,style:{color:n.colors.danger}}),e.jsx("span",{className:"text-xs font-medium",style:{color:n.colors.text},children:x.side==="long"?"Long":"Short"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"StratÃ©gie:":"Strategy:"}),e.jsx("span",{className:"text-xs font-medium",style:{color:n.colors.text},children:x.strategy||"-"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:"P&L â‚¬:"}),e.jsx("span",{className:"text-xs font-medium",style:{color:(x.pnl||0)>=0?n.colors.success:n.colors.danger},children:u(x.pnl||0,a.currency)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:"P&L %:"}),e.jsx("span",{className:"text-xs font-medium",style:{color:(x.pnlPercentage||0)>=0?n.colors.success:n.colors.danger},children:m(x.pnlPercentage||0)})]}),x.ticksGained!==void 0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:"Ticks:"}),e.jsxs("span",{className:"text-xs font-medium",style:{color:(x.ticksGained||0)>=0?n.colors.success:n.colors.danger},children:[x.ticksGained>0?"+":"",x.ticksGained," ticks"]})]}),x.duration!==void 0&&x.duration>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"DurÃ©e:":"Duration:"}),e.jsx("span",{className:"text-xs font-medium",style:{color:n.colors.text},children:p(x.duration||0)})]}),x.riskReward!==void 0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:"R:R:"}),e.jsx("span",{className:"text-xs font-medium",style:{color:n.colors.text},children:x.riskReward.toFixed(2)})]}),(x.fees?.total||x.commission)&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"Frais:":"Fees:"}),e.jsx("span",{className:"text-xs font-medium",style:{color:"var(--theme-warning)"},children:u(x.fees?.total||x.commission||0,a.currency)})]})]})})})]})]},x.id)})})]})},Df=({state:t,setState:s})=>{if(!t)return null;const{trade:r,index:l}=t,n=r.screenshots?.length||0,o=()=>{const a=r.screenshots[l];return typeof a=="string"?a:a.url};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[10001] p-4",onClick:()=>s(null),children:e.jsxs("div",{className:"relative max-w-[95vw] max-h-[95vh]",children:[e.jsx("button",{onClick:()=>s(null),className:"absolute top-4 right-4 z-10 p-2 rounded-full bg-black bg-opacity-50 hover:bg-opacity-70 transition-all",children:e.jsx(Ne,{size:24,color:"white"})}),n>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),s(i=>i?{...i,index:(i.index-1+n)%n}:null)},className:"absolute left-4 top-1/2 transform -translate-y-1/2 p-3 rounded-full bg-black bg-opacity-50 hover:bg-opacity-70 transition-all",children:e.jsx(as,{size:24,color:"white"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),s(i=>i?{...i,index:(i.index+1)%n}:null)},className:"absolute right-4 top-1/2 transform -translate-y-1/2 p-3 rounded-full bg-black bg-opacity-50 hover:bg-opacity-70 transition-all",children:e.jsx(Is,{size:24,color:"white"})}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-full bg-black bg-opacity-50 text-white text-sm font-medium",children:[l+1," / ",n]})]}),e.jsx("img",{src:o(),alt:`Screenshot ${l+1}`,className:"max-w-full max-h-full object-contain",onClick:a=>a.stopPropagation()})]})})},Ff=({trades:t,settings:s,onClose:r,initialTradeIds:l=[]})=>{const{currentTheme:n}=Q(),{currentLanguage:o}=Z();Ms();const{isOpen:a,selectedTradeIds:i,baselineId:c,activeTab:d,graphMode:u,openModal:m,closeModal:p,addTrade:x,removeTrade:f,setBaseline:v,setActiveTab:h,setGraphMode:b}=cn(),[j,y]=g.useState(0),[N,w]=g.useState(!1),[S,k]=g.useState(null),C=$=>{$.screenshots&&$.screenshots.length>0&&k({trade:$,index:0})};g.useEffect(()=>{l.length>0&&m(l)},[l,m]),g.useEffect(()=>{const $=U=>{a&&((U.ctrlKey||U.metaKey)&&U.key==="k"&&(U.preventDefault(),a||m()),U.key==="Escape"&&(p(),r()),U.key==="ArrowLeft"&&(U.preventDefault(),y(B=>Math.max(0,B-1))),U.key==="ArrowRight"&&(U.preventDefault(),y(B=>Math.min(i.length-1,B+1))))};return document.addEventListener("keydown",$),()=>document.removeEventListener("keydown",$)},[a,i.length,m,p,r]);const P=g.useMemo(()=>t.filter($=>i.includes($.id)),[t,i]),R=g.useMemo(()=>jf(c,P),[c,P]),M=g.useMemo(()=>Nf(P),[P]),T=$=>{const U=new Date($);return st(U,"dd/MM HH:mm",{locale:o==="fr"?rt:dt})},D=g.useCallback(()=>{const $=["Date","Symbol","Side","Strategy","P&L â‚¬","P&L %","Ticks","Duration","R:R","Fees","Market","Trend"],U=P.map(E=>[T(E.date),E.symbol,E.side,E.strategy,E.pnl||0,E.pnlPercentage||0,E.ticksGained||0,E.duration||0,E.riskReward||0,E.fees?.total||0,E.market,E.trend]),B=[$,...U].map(E=>E.map(I=>`"${I}"`).join(",")).join(`
`),O=new Blob([B],{type:"text/csv"}),z=URL.createObjectURL(O),q=document.createElement("a");q.href=z,q.download=`trades-comparison-${new Date().toISOString().split("T")[0]}.csv`,q.click(),URL.revokeObjectURL(z)},[P,o]),F=g.useCallback(()=>{const $={tradeIds:i,baselineId:c,timestamp:new Date().toISOString()},U=JSON.parse(localStorage.getItem("savedComparisons")||"[]");U.push($),localStorage.setItem("savedComparisons",JSON.stringify(U))},[i,c]);return a?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[10000] p-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-[1600px] max-h-[95vh] overflow-hidden",style:{backgroundColor:n.colors.card},children:[e.jsx(wf,{theme:n,language:o,onToggleTradeSelector:()=>w(!N),onExportCSV:D,onSave:F,onCloseAll:()=>{p(),r()}}),N&&e.jsx(Cf,{trades:t,selectedTradeIds:i,onToggle:($,U)=>U?f($):x($),formatDate:T,theme:n}),e.jsx(Sf,{activeTab:d,setActiveTab:h,theme:n,language:o}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[d==="summary"&&e.jsx(Pf,{items:R.trades.map(({trade:$,isBaseline:U})=>({trade:$,isBaseline:U})),theme:n,language:o,settings:s,onSelectIndex:$=>y($),focusedIndex:j,setBaseline:v,formatDate:T}),d==="metrics"&&e.jsx(Mf,{metrics:R,bestWorstValues:M,theme:n,language:o,settings:s}),d==="graph"&&e.jsx(Tf,{trades:P,baselineId:c,graphMode:u,setGraphMode:b,theme:n,language:o,settings:s,onScreenshotClick:C,formatDate:T,setBaseline:v})]})]}),e.jsx(Df,{state:S,setState:k})]}):null},Ef=({isOpen:t,onClose:s,trade:r,cumulativeData:l,isPinMode:n,selectedTrades:o,onPinModeChange:a})=>{const{currentTheme:i}=Q(),{currentLanguage:c}=Z(),{openModal:d}=cn();if(!t||!r&&!n)return null;const u=r;if(!u)return null;const m=j=>{const y=j!==void 0?j:0;return new Intl.NumberFormat(c==="fr"?"fr-FR":"en-US",{style:"currency",currency:c==="fr"?"EUR":"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(y)},p=j=>{const y=j!==void 0?j:0;return`${y>=0?"+":""}${y.toFixed(2)}%`},x=j=>{if(!j||j===0)return"-";const y=Math.floor(j/3600),N=Math.floor(j%3600/60);return y>0?`${y}h ${N}m`:N>0?`${N}m`:`${j}s`},f=j=>{const y=new Date(j);return new Intl.DateTimeFormat(c==="fr"?"fr-FR":"en-US",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(y)},v={backgroundColor:i.colors.card,border:`1px solid ${i.colors.border}`,color:i.colors.text,boxShadow:i.id==="ultra-dark"?"0 0 20px rgba(0,255,136,0.3), 0 8px 32px rgba(0,0,0,0.8)":i.isDark?"0 8px 32px rgba(0,0,0,0.6)":"0 8px 32px rgba(0,0,0,0.15)"},h={borderBottom:`1px solid ${i.colors.border}20`,padding:"8px 0"},b=({label:j,value:y,valueColor:N,icon:w})=>e.jsxs("div",{className:"flex items-center justify-between py-0.5",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[w&&e.jsx("span",{className:"text-sm",children:w}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[j,":"]})]}),e.jsx("span",{className:"text-sm font-semibold",style:{color:N||i.colors.text},children:y})]});return e.jsxs("div",{className:"fixed left-0 top-0 h-full w-72 z-[9999] transform transition-transform duration-300 ease-in-out",style:{transform:t?"translateX(0)":"translateX(-100%)",...v},children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b",style:{borderColor:i.colors.border},children:[e.jsx("h3",{className:"text-lg font-bold",style:{color:i.colors.text},children:c==="fr"?"DÃ©tails du Trade":"Trade Details"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{a(!n)},className:"p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",title:n?c==="fr"?"DÃ©sÃ©pingler":"Unpin":c==="fr"?"Ã‰pingler":"Pin",children:n?e.jsx(sc,{size:16}):e.jsx(rc,{size:16})}),e.jsx("button",{onClick:s,className:"p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",title:c==="fr"?"Fermer":"Close",children:e.jsx(Ne,{size:16})})]})]}),e.jsxs("div",{className:"p-3 space-y-3 overflow-y-auto",style:{height:"calc(100vh - 70px)"},children:[e.jsxs("div",{style:h,children:[e.jsx("h4",{className:"text-sm font-semibold mb-2 text-blue-500 dark:text-blue-400",children:c==="fr"?"Informations de Base":"Basic Information"}),e.jsx(b,{label:"Date",value:f(u.date),icon:e.jsx(ze,{size:14})}),e.jsx(b,{label:c==="fr"?"Symbole":"Symbol",value:u.symbol}),e.jsx(b,{label:"Direction",value:u.side==="long"?"ðŸ“ˆ Long":"ðŸ“‰ Short",valueColor:u.side==="long"?"#4caf50":"#f44336",icon:u.side==="long"?e.jsx(Ae,{size:14}):e.jsx($t,{size:14})}),e.jsx(b,{label:c==="fr"?"StratÃ©gie":"Strategy",value:u.strategy,icon:e.jsx(Te,{size:14})}),u.timeframe&&e.jsx(b,{label:"Timeframe",value:u.timeframe})]}),e.jsxs("div",{style:h,children:[e.jsx("h4",{className:"text-sm font-semibold mb-2 text-green-500 dark:text-green-400",children:c==="fr"?"RÃ©sultats du Trade":"Trade Results"}),u.ticksGained!==void 0&&u.ticksGained!==0&&e.jsx(b,{label:"Ticks",value:`${u.ticksGained>0?"+":""}${u.ticksGained}`,valueColor:u.ticksGained>0?"#4caf50":"#f44336"}),e.jsx(b,{label:"P&L %",value:p(u.pnlPercentage),valueColor:(u.pnlPercentage??0)>=0?"#4caf50":"#f44336",icon:e.jsx(Ge,{size:14})}),e.jsx(b,{label:"P&L â‚¬",value:m(u.pnl),valueColor:(u.pnl??0)>=0?"#4caf50":"#f44336"}),e.jsx(b,{label:c==="fr"?"DurÃ©e":"Duration",value:x(u.duration),icon:e.jsx(ze,{size:14})}),u.fees&&u.fees.total&&u.fees.total>0&&e.jsx(b,{label:c==="fr"?"Frais":"Fees",value:m(u.fees.total),valueColor:"#ff9800"})]}),l&&e.jsxs("div",{style:h,children:[e.jsx("h4",{className:"text-sm font-semibold mb-2 text-purple-500 dark:text-purple-400",children:c==="fr"?"Performance Globale":"Overall Performance"}),e.jsx(b,{label:c==="fr"?"P&L CumulÃ©":"Cumulative P&L",value:p(l.cumulativePercentage),valueColor:(l.cumulativePercentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(b,{label:c==="fr"?"En EUR":"In EUR",value:m(l.cumulativePnL),valueColor:(l.cumulativePnL??0)>=0?"#4caf50":"#f44336"}),e.jsx(b,{label:c==="fr"?"Capital Actuel":"Current Capital",value:m(l.capital)}),l.peak&&e.jsx(b,{label:c==="fr"?"Peak Historique":"Historical Peak",value:m(l.peak),valueColor:"#4caf50"}),l.drawdown!==void 0&&e.jsx(b,{label:"Drawdown",value:p(l.drawdown),valueColor:"#f44336"})]}),e.jsxs("div",{style:h,children:[e.jsx("h4",{className:"text-sm font-semibold mb-2 text-orange-500 dark:text-orange-400",children:c==="fr"?"Informations SupplÃ©mentaires":"Additional Information"}),e.jsx(b,{label:c==="fr"?"MarchÃ©":"Market",value:u.market}),e.jsx(b,{label:c==="fr"?"Tendance":"Trend",value:u.trend,valueColor:u.trend==="bullish"?"#4caf50":u.trend==="bearish"?"#f44336":"#ff9800"}),u.setup&&e.jsx(b,{label:"Setup",value:u.setup}),u.riskReward&&e.jsx(b,{label:"R:R",value:`1:${u.riskReward.toFixed(1)}`}),u.tags&&u.tags.length>0&&e.jsxs("div",{className:"py-1",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Tags:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:u.tags.map((j,y)=>e.jsx("span",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:i.colors.accent+"20",color:i.colors.accent},children:j},y))})]})]}),u.notes&&e.jsxs("div",{style:h,children:[e.jsx("h4",{className:"text-sm font-semibold mb-2 text-gray-500 dark:text-gray-400",children:"Notes"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 leading-relaxed",children:u.notes})]})]})]})},Af=({trades:t,settings:s,onEditTrade:r,onDeleteTrade:l})=>{const{currentTheme:n}=Q(),{currentLanguage:o}=Z(),[a,i]=g.useState(!0),[c,d]=g.useState(!0),[u,m]=g.useState(!0),[p,x]=g.useState(null),[f,v]=g.useState(null),[h,b]=g.useState(!1),[j,y]=g.useState(null),[N,w]=g.useState(!1),[S,k]=g.useState([]),[C,P]=g.useState(!1),[R,M]=g.useState(null),{openModal:T}=cn(),D=V.useMemo(()=>{const q=t.filter(L=>L.status==="closed"&&L.ticksGained!==void 0&&L.ticksGained!==0&&L.tickValue!==void 0);if(q.length===0)return[];const E=[...q].sort((L,A)=>new Date(L.date+" "+(L.time||"00:00")).getTime()-new Date(A.date+" "+(A.time||"00:00")).getTime());let I=0,H=0;return[{tradeNumber:0,cumulativeTicks:0,cumulativeValue:0,date:o==="fr"?"DÃ©but":"Start",tradeTicks:0,tradeValue:0,symbol:"",strategy:"",side:"",timeframe:"",duration:0,tickValue:0,fees:0,pnlPercentage:0},...E.map((L,A)=>{const _=L.ticksGained||0,J=L.tickValue||0,re=_*J;return I+=_,H+=re,{tradeNumber:A+1,cumulativeTicks:I,cumulativeValue:H,date:L.date&&!isNaN(new Date(L.date).getTime())?st(new Date(L.date),"dd/MM",{locale:o==="fr"?rt:dt}):"N/A",tradeTicks:_,tradeValue:re,symbol:L.symbol,strategy:L.strategy,side:L.side,timeframe:L.timeframe||"",duration:L.duration||0,tickValue:J,fees:L.fees?.total||L.commission||0,pnlPercentage:L.pnlPercentage||0,tradeId:L.id,originalTrade:L}})]},[t,o]),F=q=>{if(q&&q.activePayload&&q.activePayload.length>0){const E=q.activePayload[0].payload;if(E.originalTrade)if(N){const I=E.originalTrade.id,H=S.some(L=>L.id===I);k(H?L=>L.filter(A=>A.id!==I):L=>[...L,E.originalTrade])}else x(E.originalTrade)}},$=()=>{document.body.style.cursor="pointer"},U=()=>{v(null),M(null),document.body.style.cursor="default"},B=q=>{if(q&&q.activeCoordinate&&M(q.activeCoordinate.x),q&&q.activePayload&&q.activePayload.length>0){const E=q.activePayload[0].payload;E.tradeId&&E.originalTrade&&(v(E.tradeId),y(E.originalTrade),b(!0))}},O=q=>{const{cx:E,cy:I,payload:H,fill:L,index:A}=q,_=f===H.tradeId,J=S.some(se=>se.id===H.tradeId),re=R!==null&&Math.abs(E-R)<8;if(J)return e.jsxs("g",{children:[e.jsx("line",{x1:E,y1:I-100,x2:E,y2:I+100,stroke:"#d1d5db",strokeWidth:1,opacity:.6,strokeDasharray:"2,2",style:{pointerEvents:"none"}}),e.jsx("circle",{cx:E,cy:I,r:6,fill:"#eab308",stroke:"#eab308",strokeWidth:3,style:{cursor:"pointer",filter:"drop-shadow(0 0 8px rgba(234, 179, 8, 0.4))",transition:"all 0.2s ease"},onClick:()=>{H.originalTrade&&x(H.originalTrade)}},H?.tradeId??A)]});const de=_||re;return e.jsx("circle",{cx:E,cy:I,r:de?6:4,fill:L||n.colors.accent,stroke:"#ffffff",strokeWidth:de?3:2,style:{cursor:"pointer",filter:de?"drop-shadow(0 0 6px rgba(59, 130, 246, 0.6))":"none",transition:"all 0.15s ease"},onClick:()=>{H.originalTrade&&x(H.originalTrade)}},H?.tradeId??A)};if(D.length===0)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Te,{size:64,className:"mx-auto mb-4",style:{color:n.colors.textMuted}}),e.jsx("h3",{className:"text-xl font-bold mb-2",style:{color:n.colors.text},children:o==="fr"?"Aucune donnÃ©e de ticks":"No tick data"}),e.jsx("p",{style:{color:n.colors.textSecondary},children:o==="fr"?"Ajoutez des informations de ticks Ã  vos trades pour voir ce graphique":"Add tick information to your trades to see this chart"}),e.jsx("p",{className:"text-sm mt-2",style:{color:n.colors.textMuted},children:o==="fr"?"Ce graphique est spÃ©cialement conÃ§u pour le scalping":"This chart is specially designed for scalping"})]});const z=V.useMemo(()=>{if(!j)return;const E=[...t.filter(_=>_.status==="closed"&&_.ticksGained!==void 0&&_.ticksGained!==0&&_.tickValue!==void 0)].sort((_,J)=>new Date(_.date+" "+(_.time||"00:00")).getTime()-new Date(J.date+" "+(J.time||"00:00")).getTime());let I=0,H=0,L=1e4;for(const _ of E){const J=_.ticksGained||0,re=_.tickValue||0,de=J*re;I+=de,L+=de,L>H&&(H=L)}const A=H>0?(L-H)/H*100:0;return{cumulativePercentage:I/1e4*100,cumulativePnL:I,capital:L,peak:H,drawdown:A}},[j,t]);return e.jsxs("div",{children:[e.jsx(Ef,{isOpen:h||N,onClose:()=>{b(!1),w(!1)},trade:j,cumulativeData:z,isPinMode:N,selectedTrades:S,onPinModeChange:q=>{w(q),q?(b(!0),k([]),P(!1)):(k([]),P(!1))}}),N&&S.length===0&&e.jsx("div",{className:"mb-4 p-3 rounded-lg border-2",style:{borderColor:n.colors.accent,backgroundColor:n.colors.accent+"20"},children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{style:{color:n.colors.accent},children:"ðŸ“Œ"}),e.jsx("span",{className:"text-sm font-medium",style:{color:n.colors.accent},children:o==="fr"?"Mode comparaison activÃ© ! Cliquez sur des trades pour les sÃ©lectionner.":"Comparison mode activated! Click on trades to select them."})]})}),N&&S.length>0&&e.jsx("div",{className:"mb-4 p-3 rounded-lg border-2",style:{borderColor:n.colors.success+"60",backgroundColor:n.colors.success+"10"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{style:{color:n.colors.success},children:"â„¹ï¸"}),e.jsx("span",{className:"text-sm font-medium",style:{color:n.colors.success},children:o==="fr"?`${S.length} trade(s) sÃ©lectionnÃ©(s) !`:`${S.length} trade(s) selected!`})]}),e.jsx("button",{onClick:()=>{const q=S.map(E=>E.id);T(q)},className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors hover:opacity-80",style:{backgroundColor:n.colors.accent,color:"#ffffff",border:`1px solid ${n.colors.accent}`},title:o==="fr"?"Comparer les trades sÃ©lectionnÃ©s":"Compare selected trades",children:o==="fr"?"Comparer":"Compare"})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium",style:{color:n.colors.text},children:[o==="fr"?"ðŸ“Š Graphique Cumulatif des Ticks (Scalping)":"ðŸ“Š Cumulative Ticks Chart (Scalping)",e.jsxs("span",{className:"text-sm ml-2",style:{color:n.colors.textMuted},children:["(",D.length-1," ",o==="fr"?"trades avec ticks":"trades with ticks",")"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>m(!u),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${u?"shadow-sm":"opacity-70"}`,style:{backgroundColor:u?n.colors.info+"40":n.colors.surface,color:u?n.colors.text:n.colors.textSecondary,border:`1px solid ${u?n.colors.info+"60":n.colors.border}`},children:[u?e.jsx(Se,{size:16,className:"mr-2"}):e.jsx(De,{size:16,className:"mr-2"}),"Points"]}),e.jsxs("button",{onClick:()=>i(!a),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${a?"shadow-sm":"opacity-70"}`,style:{backgroundColor:a?n.colors.accent+"40":n.colors.surface,color:a?n.colors.text:n.colors.textSecondary,border:`1px solid ${a?n.colors.accent+"60":n.colors.border}`},children:[a?e.jsx(Se,{size:16,className:"mr-2"}):e.jsx(De,{size:16,className:"mr-2"}),o==="fr"?"Ligne Ticks (Bleue)":"Ticks Line (Blue)"]}),e.jsxs("button",{onClick:()=>d(!c),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${c?"shadow-sm":"opacity-70"}`,style:{backgroundColor:c?n.colors.success+"40":n.colors.surface,color:c?n.colors.text:n.colors.textSecondary,border:`1px solid ${c?n.colors.success+"60":n.colors.border}`},children:[c?e.jsx(Se,{size:16,className:"mr-2"}):e.jsx(De,{size:16,className:"mr-2"}),o==="fr"?"Ligne Valeur (Verte)":"Value Line (Green)"]})]})]}),e.jsx("div",{style:{position:"relative"},children:e.jsxs(Cs,{width:"100%",height:400,children:[e.jsxs(As,{data:D,onClick:F,onMouseMove:B,onMouseEnter:$,onMouseLeave:U,children:[e.jsx(ns,{strokeDasharray:"3 3",stroke:n.colors.border}),e.jsx(ls,{dataKey:"tradeNumber",stroke:n.colors.textMuted,fontSize:12,label:{value:o==="fr"?"NumÃ©ro de Trade":"Trade Number",position:"insideBottom",offset:-5}}),a&&e.jsx(bt,{yAxisId:"ticks",stroke:n.colors.textMuted,fontSize:12,label:{value:o==="fr"?"Ticks CumulÃ©s":"Cumulative Ticks",angle:-90,position:"insideLeft"}}),c&&e.jsx(bt,{yAxisId:"value",orientation:"right",stroke:n.colors.textMuted,fontSize:12,tickFormatter:q=>`${Math.round(q)} ${s.currency}`,label:{value:o==="fr"?`Valeur (${s.currency})`:`Value (${s.currency})`,angle:90,position:"insideRight"}}),e.jsx(Ut,{}),(a||c)&&e.jsx(Ns,{y:0,yAxisId:a?"ticks":"value",stroke:n.colors.textMuted,strokeDasharray:"5 5"}),a&&e.jsx(Kt,{yAxisId:"ticks",type:"stepAfter",dataKey:"cumulativeTicks",stroke:n.colors.accent,strokeWidth:3,dot:u?O:!1,name:o==="fr"?"Ticks CumulÃ©s":"Cumulative Ticks",onMouseEnter:$,onMouseLeave:U}),c&&e.jsx(Kt,{yAxisId:"value",type:"stepAfter",dataKey:"cumulativeValue",stroke:n.colors.success,strokeWidth:2,strokeDasharray:"5 5",dot:u?q=>e.jsx(O,{...q,fill:n.colors.success,r:3}):!1,name:o==="fr"?`Valeur CumulÃ©e (${s.currency})`:`Cumulative Value (${s.currency})`,onMouseEnter:$,onMouseLeave:U})]}),R!==null&&e.jsx("div",{style:{position:"absolute",left:R,top:0,width:1,height:"100%",backgroundColor:n.colors.textMuted,opacity:.5,pointerEvents:"none",zIndex:1e3}})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${D[D.length-1]?.cumulativeTicks>=0?"text-green-600":"text-red-600"}`,children:D[D.length-1]?.cumulativeTicks||0}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Ticks Totaux":"Total Ticks"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:new Intl.NumberFormat(o==="fr"?"fr-FR":"en-US",{style:"currency",currency:s.currency,minimumFractionDigits:0,maximumFractionDigits:0}).format(D[D.length-1]?.cumulativeValue||0)}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Valeur Totale":"Total Value"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:n.colors.text},children:D.length-1}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Trades avec Ticks":"Trades with Ticks"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--theme-accent)"},children:((D[D.length-1]?.cumulativeTicks||0)/Math.max(D.length-1,1)).toFixed(1)}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:"Ticks/Trade"})]})]}),p&&!N&&e.jsx(Ws,{trade:p,settings:s,onClose:()=>x(null),onEdit:q=>{r&&r(q),x(null)},onDelete:q=>{l&&l(q),x(null)}}),e.jsx(Ff,{trades:t,settings:s,onClose:()=>{}})]})},Lf=({trades:t,settings:s,onEditTrade:r,onDeleteTrade:l})=>{const{currentTheme:n}=Q(),{currentLanguage:o}=Z(),[a,i]=g.useState(!0),[c,d]=g.useState(!0),[u,m]=g.useState(null),[p,x]=g.useState(null),f=V.useMemo(()=>{const N=t.filter(C=>C.status==="closed");if(N.length===0)return[];const w=[...N].sort((C,P)=>new Date(C.date+" "+(C.time||"00:00")).getTime()-new Date(P.date+" "+(P.time||"00:00")).getTime());let S=s.initialCapital,k=s.initialCapital;return[{date:o==="fr"?"DÃ©but":"Start",capital:s.initialCapital,drawdown:0,peak:s.initialCapital,tradeNumber:0,tradePnL:0,tradePercentage:0,symbol:"",strategy:"",side:"",timeframe:"",duration:0,ticksGained:void 0,fees:0},...w.map((C,P)=>{const R=C.pnl||0;S+=R,S>k&&(k=S);const M=(k-S)/k*100;return{date:C.date&&!isNaN(new Date(C.date).getTime())?st(new Date(C.date),"dd/MM/yyyy",{locale:o==="fr"?rt:dt}):"N/A",capital:S,drawdown:-Math.abs(M),peak:k,tradeNumber:P+1,tradePnL:R,tradePercentage:C.pnlPercentage||0,symbol:C.symbol,strategy:C.strategy,side:C.side,timeframe:C.timeframe||"",duration:C.duration||0,ticksGained:C.ticksGained,fees:C.fees?.total||C.commission||0,tradeId:C.id,originalTrade:C}})]},[t,s.initialCapital,o]),v=V.useMemo(()=>{if(f.length===0)return{capitalDomain:"dataMin",drawdownDomain:"dataMin"};const N=f.map(U=>U.capital),w=f.map(U=>U.peak),S=f.map(U=>U.drawdown),k=Math.min(...N),C=Math.max(...N),P=Math.max(...w),R=Math.min(...S),M=C-k,T=Math.max(M*.15,500),D=[Math.max(0,k-T),P+T],F=Math.abs(R)*.1,$=[R-F,1];return{capitalDomain:D,drawdownDomain:$}},[f]),h=N=>{if(N&&N.activePayload&&N.activePayload.length>0){const w=N.activePayload[0].payload;w.originalTrade&&m(w.originalTrade)}},b=N=>{if(N&&N.activePayload&&N.activePayload.length>0){const w=N.activePayload[0].payload;w.tradeId&&(x(w.tradeId),document.body.style.cursor="pointer")}},j=()=>{x(null),document.body.style.cursor="default"},y=N=>{const{cx:w,cy:S,payload:k,fill:C,index:P}=N,R=p===k.tradeId;return e.jsx("circle",{cx:w,cy:S,r:R?6:4,fill:C||n.colors.accent,stroke:"#ffffff",strokeWidth:R?3:2,style:{cursor:"pointer",filter:R?"drop-shadow(0 0 6px rgba(59, 130, 246, 0.6))":"none",transition:"all 0.2s ease"},onClick:()=>{k.originalTrade&&m(k.originalTrade)}},k?.tradeId??P)};return f.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{style:{color:n.colors.textSecondary},children:o==="fr"?"Pas assez de donnÃ©es pour afficher la courbe d'Ã©quitÃ©":"Not enough data to display the equity curve"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",style:{color:n.colors.text},children:o==="fr"?"Courbe d'Ã‰quitÃ© et Drawdown":"Equity Curve and Drawdown"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>i(!a),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${a?"shadow-sm":"opacity-70"}`,style:{backgroundColor:a?n.colors.accent+"40":n.colors.surface,color:a?n.colors.text:n.colors.textSecondary,border:`1px solid ${a?n.colors.accent+"60":n.colors.border}`},children:[a?e.jsx(Se,{size:16,className:"mr-2"}):e.jsx(De,{size:16,className:"mr-2"}),"Points"]}),e.jsxs("button",{onClick:()=>d(!c),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${c?"shadow-sm":"opacity-70"}`,style:{backgroundColor:c?n.colors.success+"40":n.colors.surface,color:c?n.colors.text:n.colors.textSecondary,border:`1px solid ${c?n.colors.success+"60":n.colors.border}`},children:[c?e.jsx(Se,{size:16,className:"mr-2"}):e.jsx(De,{size:16,className:"mr-2"}),o==="fr"?"Peaks Historiques":"Historical Peaks"]})]})]}),e.jsx(Cs,{width:"100%",height:400,children:e.jsxs(As,{data:f,onClick:h,onMouseMove:b,onMouseLeave:j,children:[e.jsx(ns,{strokeDasharray:"3 3",stroke:n.colors.border}),e.jsx(ls,{dataKey:"date",stroke:n.colors.textMuted,fontSize:12}),e.jsx(bt,{yAxisId:"capital",stroke:n.colors.textMuted,fontSize:12,domain:v.capitalDomain,tickFormatter:N=>`${Math.round(N)} ${s.currency}`}),e.jsx(bt,{yAxisId:"drawdown",orientation:"right",stroke:n.colors.textMuted,fontSize:12,domain:v.drawdownDomain,tickFormatter:N=>`${N.toFixed(1)}%`}),e.jsx(Jt,{content:e.jsx(Yt,{})}),e.jsx(Ut,{}),e.jsx(Kt,{yAxisId:"capital",type:"monotone",dataKey:"capital",stroke:n.colors.accent,strokeWidth:3,dot:a?y:!1,name:"Capital"}),c&&e.jsx(Kt,{yAxisId:"capital",type:"monotone",dataKey:"peak",stroke:n.colors.success,strokeWidth:4,strokeDasharray:"8 4",dot:a?N=>{const{key:w,...S}=N,k=S?.payload?.tradeId??S?.index;return e.jsx(y,{...S,fill:n.colors.success,r:5},k)}:!1,name:o==="fr"?"Peak Historique":"Historical Peak",opacity:.9}),e.jsx(sl,{yAxisId:"drawdown",type:"monotone",dataKey:"drawdown",stroke:n.colors.danger,fill:n.colors.danger,fillOpacity:.3,name:"Drawdown %"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:n.colors.accent},children:new Intl.NumberFormat(o==="fr"?"fr-FR":"en-US",{style:"currency",currency:s.currency,minimumFractionDigits:0,maximumFractionDigits:0}).format(f[f.length-1]?.capital||s.initialCapital)}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Capital Actuel":"Current Capital"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:new Intl.NumberFormat(o==="fr"?"fr-FR":"en-US",{style:"currency",currency:s.currency,minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.max(...f.map(N=>N.peak)))}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Peak Maximum":"Maximum Peak"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:[Math.min(...f.map(N=>N.drawdown)).toFixed(2),"%"]}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Drawdown Max":"Max Drawdown"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:n.colors.info},children:f.length-1}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Trades Total":"Total Trades"})]})]}),u&&e.jsx(Ws,{trade:u,settings:s,onClose:()=>m(null),onEdit:N=>{r&&r(N),m(null)},onDelete:N=>{l&&l(N),m(null)}})]})},$f=({trades:t,settings:s,onEditTrade:r,onDeleteTrade:l})=>{const{currentTheme:n}=Q(),{currentLanguage:o}=Z(),[a,i]=g.useState("daily"),[c,d]=g.useState([]),[u,m]=g.useState(!1),[p,x]=g.useState(null),f=V.useMemo(()=>{const h=t.filter(j=>j.status==="closed");if(h.length===0)return[];const b=new Map;return h.forEach(j=>{const y=new Date(j.date);let N;switch(a){case"weekly":N=st(mn(y,{weekStartsOn:1}),"dd/MM/yyyy",{locale:o==="fr"?rt:dt});break;case"monthly":N=st(un(y),"MMM yyyy",{locale:o==="fr"?rt:dt});break;case"yearly":N=st(y,"yyyy",{locale:o==="fr"?rt:dt});break;default:N=st(y,"dd/MM/yyyy",{locale:o==="fr"?rt:dt})}const w=b.get(N)||{pnl:0,percentage:0,trades:0};w.pnl+=j.pnl||0,w.percentage+=j.pnlPercentage||0,w.trades+=1,b.set(N,w)}),Array.from(b.entries()).map(([j,y])=>({date:j,pnl:y.pnl,percentage:y.percentage,trades:y.trades,fill:y.percentage>=0?n.colors.success:n.colors.danger,periodTrades:h.filter(N=>{const w=new Date(N.date);let S;switch(a){case"weekly":S=st(mn(w,{weekStartsOn:1}),"dd/MM/yyyy",{locale:o==="fr"?rt:dt});break;case"monthly":S=st(un(w),"MMM yyyy",{locale:o==="fr"?rt:dt});break;case"yearly":S=st(w,"yyyy",{locale:o==="fr"?rt:dt});break;default:S=st(w,"dd/MM/yyyy",{locale:o==="fr"?rt:dt})}return S===j})})).sort((j,y)=>new Date(j.date).getTime()-new Date(y.date).getTime())},[t,a,n.colors,o]),v=h=>{if(h&&h.activePayload&&h.activePayload.length>0){const b=h.activePayload[0].payload;b.periodTrades&&b.periodTrades.length>0&&(d(b.periodTrades),m(!0))}};return f.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{style:{color:n.colors.textSecondary},children:o==="fr"?"Pas assez de donnÃ©es pour afficher le P&L pÃ©riodique":"Not enough data to display periodic P&L"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",style:{color:n.colors.text},children:a==="daily"?o==="fr"?"P&L Journalier":"Daily P&L":a==="weekly"?o==="fr"?"P&L Hebdomadaire":"Weekly P&L":a==="monthly"?o==="fr"?"P&L Mensuel":"Monthly P&L":o==="fr"?"P&L Annuel":"Yearly P&L"}),e.jsx("div",{className:"flex space-x-1 p-1 rounded-lg",style:{backgroundColor:n.colors.surface},children:[{key:"daily",label:o==="fr"?"Journalier":"Daily"},{key:"weekly",label:o==="fr"?"Hebdomadaire":"Weekly"},{key:"monthly",label:o==="fr"?"Mensuel":"Monthly"},{key:"yearly",label:o==="fr"?"Annuel":"Yearly"}].map(({key:h,label:b})=>e.jsxs("button",{onClick:()=>i(h),className:`flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ${a===h?"shadow-sm":""}`,style:{backgroundColor:a===h?n.colors.card:"transparent",color:a===h?n.colors.accent:n.colors.textSecondary},children:[e.jsx(yt,{size:16,className:"mr-2"}),b]},h))})]}),e.jsx(Cs,{width:"100%",height:400,children:e.jsxs(rl,{data:f,onClick:v,children:[e.jsx(ns,{strokeDasharray:"3 3",stroke:n.colors.border}),e.jsx(ls,{dataKey:"date",stroke:n.colors.textMuted,fontSize:12}),e.jsx(bt,{stroke:n.colors.textMuted,fontSize:12,tickFormatter:h=>`${h.toFixed(1)}%`}),e.jsx(Jt,{content:e.jsx(Yt,{})}),e.jsx(Ut,{}),e.jsx(Ns,{y:0,stroke:n.colors.textMuted,strokeDasharray:"5 5"}),e.jsx(Ir,{dataKey:"percentage",name:"P&L %",radius:[4,4,0,0],children:f.map((h,b)=>e.jsx(Oo,{fill:h.percentage>=0?n.colors.success:n.colors.danger,style:{cursor:"pointer",filter:"none",transition:"all 0.2s ease"}},`cell-${b}`))})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${f.filter(h=>h.percentage>0).length>=f.length/2?"text-green-600":"text-red-600"}`,children:f.filter(h=>h.percentage>0).length}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"PÃ©riodes Positives":"Positive Periods"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:f.filter(h=>h.percentage<0).length}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"PÃ©riodes NÃ©gatives":"Negative Periods"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:`${Math.max(...f.map(h=>h.percentage))>=0?"+":""}${Math.max(...f.map(h=>h.percentage)).toFixed(2)}%`}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Meilleure PÃ©riode":"Best Period"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:`${Math.min(...f.map(h=>h.percentage))>=0?"+":""}${Math.min(...f.map(h=>h.percentage)).toFixed(2)}%`}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Pire PÃ©riode":"Worst Period"})]})]}),u&&c.length>0&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col",style:{backgroundColor:n.colors.card,color:n.colors.text},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",style:{borderColor:n.colors.border},children:[e.jsxs("h2",{className:"text-xl font-semibold",style:{color:n.colors.text},children:[o==="fr"?"Trades de la PÃ©riode":"Period Trades"," (",c.length,")"]}),e.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:e.jsx(Ne,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"space-y-3",children:c.map(h=>e.jsx("div",{className:"p-4 rounded-lg border cursor-pointer hover:shadow-md transition-all",style:{backgroundColor:n.colors.surface,borderColor:n.colors.border},onClick:()=>{x(h),m(!1)},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"font-medium",style:{color:n.colors.text},children:h.symbol}),e.jsx("div",{className:"px-2 py-1 rounded text-xs",style:{backgroundColor:`${h.side==="long"?n.colors.success:n.colors.danger}20`,color:h.side==="long"?n.colors.success:n.colors.danger,border:`1px solid ${(h.side==="long"?n.colors.success:n.colors.danger)+"40"}`},children:h.side==="long"?"Long":"Short"}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textSecondary},children:h.strategy})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`font-bold ${(h.pnlPercentage||0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[(h.pnlPercentage||0)>=0?"+":"",(h.pnlPercentage||0).toFixed(2),"%"]}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textSecondary},children:new Date(h.date).toLocaleDateString(o==="fr"?"fr-FR":"en-US")})]})]})},h.id))})}),e.jsx("div",{className:"flex justify-end p-6 border-t",style:{borderColor:n.colors.border},children:e.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:n.colors.surface,color:n.colors.text,border:`1px solid ${n.colors.border}`},children:o==="fr"?"Fermer":"Close"})})]})}),p&&!u&&e.jsx(Ws,{trade:p,settings:s,onClose:()=>x(null),onEdit:h=>{r&&r(h),x(null)},onDelete:h=>{l&&l(h),x(null)}})]})},zf=({trades:t,settings:s,onEditTrade:r,onDeleteTrade:l})=>{const{currentTheme:n}=Q(),{currentLanguage:o}=Z(),[a,i]=g.useState(!0),[c,d]=g.useState("line"),[u,m]=g.useState(null),[p,x]=g.useState(null),f=V.useMemo(()=>{const w=t.filter(P=>P.status==="closed");if(w.length<10)return[];const S=[...w].sort((P,R)=>new Date(P.date+" "+(P.time||"00:00")).getTime()-new Date(R.date+" "+(R.time||"00:00")).getTime()),k=Math.min(20,Math.floor(S.length/5)),C=[];for(let P=k-1;P<S.length;P++){const R=S.slice(P-k+1,P+1),M=R.filter(J=>(J.pnl||0)>0).length,T=R.filter(J=>(J.pnl||0)<0).length,D=M/R.length*100,F=R.reduce((J,re)=>J+(re.pnl||0),0),$=R.reduce((J,re)=>J+(re.pnlPercentage||0),0),U=F/R.length,B=$/R.length,O=S[P],z=new Map;R.forEach(J=>{z.set(J.strategy,(z.get(J.strategy)||0)+1)});const q=Array.from(z.entries()).sort((J,re)=>re[1]-J[1])[0],E=new Map;R.forEach(J=>{E.set(J.symbol,(E.get(J.symbol)||0)+1)});const I=Array.from(E.entries()).sort((J,re)=>re[1]-J[1]).slice(0,3),H=R.filter(J=>J.duration&&J.duration>0),L=H.length>0?H.reduce((J,re)=>J+(re.duration||0),0)/H.length:0,A=R.filter(J=>J.ticksGained!==void 0&&J.ticksGained!==0),_=A.length>0?A.reduce((J,re)=>J+(re.ticksGained||0),0)/A.length:0;C.push({date:st(new Date(S[P].date),"dd/MM",{locale:o==="fr"?rt:dt}),winRate:D,trades:R.length,wins:M,losses:T,windowPnL:F,windowPnLPercentage:$,avgPnLPerTrade:U,avgPercentagePerTrade:B,currentTrade:{symbol:O.symbol,side:O.side,strategy:O.strategy,pnl:O.pnl||0,pnlPercentage:O.pnlPercentage||0,timeframe:O.timeframe||"",duration:O.duration||0,ticksGained:O.ticksGained},strategiesCount:z.size,topStrategy:q?q[0]:"",symbolsCount:E.size,topSymbols:I.map(([J])=>J),avgDuration:L,avgTicks:_,tradeNumber:P+1})}return C},[t,o]),v=w=>{if(w&&w.activePayload&&w.activePayload.length>0){const S=w.activePayload[0].payload;if(S.currentTrade){const k=t.find(C=>C.symbol===S.currentTrade.symbol&&C.date===S.currentTrade.date&&C.time===S.currentTrade.time);k&&m(k)}}},h=w=>{if(w&&w.activePayload&&w.activePayload.length>0){const S=w.activePayload[0].payload;S.currentTrade&&(x(S.currentTrade.symbol+S.currentTrade.date),document.body.style.cursor="pointer")}},b=()=>{x(null),document.body.style.cursor="default"},j=w=>{const{cx:S,cy:k,payload:C}=w,P=p===C.currentTrade?.symbol+C.currentTrade?.date;return e.jsx("circle",{cx:S,cy:k,r:P?6:4,fill:n.colors.success,stroke:"#ffffff",strokeWidth:P?3:2,style:{cursor:"pointer",filter:P?"drop-shadow(0 0 6px rgba(34, 197, 94, 0.6))":"none",transition:"all 0.2s ease"},onClick:()=>{if(C.currentTrade){const R=t.find(M=>M.symbol===C.currentTrade.symbol&&M.date===C.currentTrade.date&&M.time===C.currentTrade.time);R&&m(R)}}})},y=V.useMemo(()=>{const w=t.filter(C=>C.status==="closed");if(w.length===0)return[];const S=new Map;for(let C=1;C<=5;C++)S.set(C,{trades:0,wins:0,pnl:0,pnlPercentage:0});w.forEach(C=>{const R=new Date(C.date).getDay()||7;if(R>=1&&R<=5){const M=S.get(R)||{trades:0,wins:0,pnl:0,pnlPercentage:0};M.trades+=1,(C.pnl||0)>0&&(M.wins+=1),M.pnl+=C.pnl||0,M.pnlPercentage+=C.pnlPercentage||0,S.set(R,M)}});const k={fr:["Lundi","Mardi","Mercredi","Jeudi","Vendredi"],en:["Monday","Tuesday","Wednesday","Thursday","Friday"]};return Array.from(S.entries()).map(([C,P])=>{const R=P.trades>0?P.wins/P.trades*100:0;return{day:k[o==="fr"?"fr":"en"][C-1],dayNumber:C,trades:P.trades,wins:P.wins,losses:P.trades-P.wins,winRate:R,pnl:P.pnl,pnlPercentage:P.pnlPercentage,avgPnL:P.trades>0?P.pnl/P.trades:0,avgPnLPercentage:P.trades>0?P.pnlPercentage/P.trades:0,fill:R>=50?n.colors.success:n.colors.danger}}).sort((C,P)=>C.dayNumber-P.dayNumber)},[t,o,n.colors]),N=V.useMemo(()=>{const w=t.filter(P=>P.status==="closed");if(w.length===0)return[];const S=w.length,k=[{id:"asia",name:o==="fr"?"Session Asie":"Asia Session",startHour:0,endHour:8,color:"#8b5cf6"},{id:"eu",name:o==="fr"?"Session EU":"EU Session",startHour:8,endHour:14,color:"#3b82f6"},{id:"us",name:o==="fr"?"Session US":"US Session",startHour:14,endHour:21,color:"#10b981"},{id:"overlap",name:o==="fr"?"Overlap EU-US":"EU-US Overlap",startHour:14,endHour:16,color:"#f59e0b"},{id:"close",name:o==="fr"?"ClÃ´ture US":"US Close",startHour:21,endHour:23,color:"#ef4444"}],C=new Map;return k.forEach(P=>{C.set(P.id,{trades:0,wins:0,pnl:0,pnlPercentage:0})}),w.forEach(P=>{if(!P.time)return;const R=parseInt(P.time.split(":")[0]);let M="";for(const D of k)if(R>=D.startHour&&R<D.endHour){M=D.id;break}if(!M)return;const T=C.get(M)||{trades:0,wins:0,pnl:0,pnlPercentage:0};T.trades+=1,(P.pnl||0)>0&&(T.wins+=1),T.pnl+=P.pnl||0,T.pnlPercentage+=P.pnlPercentage||0,C.set(M,T)}),Array.from(C.entries()).filter(([P,R])=>R.trades>0).map(([P,R])=>{const M=k.find(D=>D.id===P),T=R.trades>0?R.wins/R.trades*100:0;return{session:M.name,sessionId:P,trades:R.trades,wins:R.wins,losses:R.trades-R.wins,winRate:T,pnl:R.pnl,pnlPercentage:R.pnlPercentage,avgPnL:R.trades>0?R.pnl/R.trades:0,avgPnLPercentage:R.trades>0?R.pnlPercentage/R.trades:0,fill:M.color,color:M.color,value:R.trades,name:M.name,totalClosedTradesCount:S}}).sort((P,R)=>{const M={asia:0,eu:1,overlap:2,us:3,close:4};return M[P.sessionId]-M[R.sessionId]})},[t,o,n.colors]);return f.length===0&&y.length===0&&N.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{style:{color:n.colors.textSecondary},children:o==="fr"?"Pas assez de donnÃ©es pour afficher le taux de rÃ©ussite (minimum 10 trades)":"Not enough data to display the win rate (minimum 10 trades)"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",style:{color:n.colors.text},children:c==="line"?o==="fr"?"Taux de RÃ©ussite Mobile (20 derniers trades)":"Moving Win Rate (last 20 trades)":c==="weekday"?o==="fr"?"Taux de RÃ©ussite par Jour":"Win Rate by Day":o==="fr"?"Taux de RÃ©ussite par Session":"Win Rate by Session"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex space-x-1 p-1 rounded-lg",style:{backgroundColor:n.colors.surface},children:[e.jsxs("button",{onClick:()=>d("line"),className:`flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ${c==="line"?"shadow-sm":""}`,style:{backgroundColor:c==="line"?n.colors.card:"transparent",color:c==="line"?n.colors.accent:n.colors.textSecondary},children:[e.jsx(Se,{size:16,className:"mr-2"}),o==="fr"?"Ã‰volution":"Evolution"]}),e.jsxs("button",{onClick:()=>d("weekday"),className:`flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ${c==="weekday"?"shadow-sm":""}`,style:{backgroundColor:c==="weekday"?n.colors.card:"transparent",color:c==="weekday"?n.colors.accent:n.colors.textSecondary},children:[e.jsx(_e,{size:16,className:"mr-2"}),o==="fr"?"Jours":"Days"]}),e.jsxs("button",{onClick:()=>d("session"),className:`flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ${c==="session"?"shadow-sm":""}`,style:{backgroundColor:c==="session"?n.colors.card:"transparent",color:c==="session"?n.colors.accent:n.colors.textSecondary},children:[e.jsx(ze,{size:16,className:"mr-2"}),"Sessions"]})]}),c==="line"&&e.jsxs("button",{onClick:()=>i(!a),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${a?"shadow-sm":"opacity-50"}`,style:{backgroundColor:a?n.colors.success:n.colors.surface,color:a?"#ffffff":n.colors.textSecondary,border:`1px solid ${a?n.colors.success:n.colors.border}`},children:[a?e.jsx(Se,{size:16,className:"mr-2"}):e.jsx(De,{size:16,className:"mr-2"}),"Points"]})]})]}),e.jsxs(Cs,{width:"100%",height:400,children:[c==="line"&&f.length>0&&e.jsxs(La,{data:f,onClick:v,onMouseMove:h,onMouseLeave:b,children:[e.jsx(ns,{strokeDasharray:"3 3",stroke:n.colors.border}),e.jsx(ls,{dataKey:"date",stroke:n.colors.textMuted,fontSize:12}),e.jsx(bt,{stroke:n.colors.textMuted,fontSize:12,domain:[0,100],tickFormatter:w=>`${w}%`}),e.jsx(Jt,{content:e.jsx(Yt,{})}),e.jsx(Ut,{}),e.jsx(Ns,{y:50,stroke:n.colors.textMuted,strokeDasharray:"5 5"}),e.jsx(Kt,{type:"monotone",dataKey:"winRate",stroke:n.colors.success,strokeWidth:3,dot:a?j:!1,name:o==="fr"?"Taux de RÃ©ussite %":"Win Rate %"})]}),c==="weekday"&&y.length>0&&e.jsxs(rl,{data:y,children:[e.jsx(ns,{strokeDasharray:"3 3",stroke:n.colors.border}),e.jsx(ls,{dataKey:"day",stroke:n.colors.textMuted,fontSize:12}),e.jsx(bt,{stroke:n.colors.textMuted,fontSize:12,domain:[0,100],tickFormatter:w=>`${w}%`}),e.jsx(Jt,{content:e.jsx(Yt,{})}),e.jsx(Ut,{}),e.jsx(Ns,{y:50,stroke:n.colors.textMuted,strokeDasharray:"5 5"}),e.jsx(Ir,{dataKey:"winRate",name:o==="fr"?"Taux de RÃ©ussite %":"Win Rate %",radius:[4,4,0,0]})]}),c==="session"&&N.length>0&&e.jsxs(ol,{children:[e.jsx(nl,{data:N,cx:"50%",cy:"50%",labelLine:!0,outerRadius:120,fill:"#8884d8",dataKey:"trades",nameKey:"session",label:({name:w,percent:S})=>`${w}: ${(S*100).toFixed(0)}%`,children:N.map((w,S)=>e.jsx(Oo,{fill:w.color},`cell-${S}`))}),e.jsx(Jt,{content:e.jsx(Yt,{})}),e.jsx(Ut,{})]})]}),c==="line"&&f.length>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-2xl font-bold ${f[f.length-1]?.winRate>=50?"text-green-600":"text-red-600"}`,children:[f[f.length-1]?.winRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Taux Actuel":"Current Rate"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[Math.max(...f.map(w=>w.winRate)).toFixed(1),"%"]}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Pic Maximum":"Maximum Peak"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:[Math.min(...f.map(w=>w.winRate)).toFixed(1),"%"]}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Plus Bas":"Lowest"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold",style:{color:n.colors.accent},children:[(f.reduce((w,S)=>w+S.winRate,0)/f.length).toFixed(1),"%"]}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Moyenne":"Average"})]})]}),c==="weekday"&&y.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mt-6",children:y.map(w=>e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-2xl font-bold ${w.winRate>=50?"text-green-600":"text-red-600"}`,children:[w.winRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm font-medium",style:{color:n.colors.text},children:w.day}),e.jsxs("div",{className:"text-xs",style:{color:n.colors.textMuted},children:[w.trades," ","trades"]})]},w.day))}),c==="session"&&N.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6",children:N.map(w=>e.jsxs("div",{className:"p-4 rounded-lg border",style:{borderColor:n.colors.border},children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"font-medium flex items-center",style:{color:n.colors.text},children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:w.color}}),w.session]}),e.jsxs("div",{className:`text-lg font-bold ${w.winRate>=50?"text-green-600":"text-red-600"}`,children:[w.winRate.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{style:{color:n.colors.textSecondary},children:[w.trades," ","trades"]}),e.jsxs("span",{style:{color:n.colors.textSecondary},children:[w.wins," ",o==="fr"?"gagnants":"wins"," / ",w.losses," ",o==="fr"?"perdants":"losses"]})]}),e.jsx("div",{className:"mt-2 text-sm",children:e.jsxs("span",{style:{color:n.colors.textSecondary},children:["P&L: ",w.pnlPercentage>=0?"+":"",w.pnlPercentage.toFixed(2),"%"]})})]},w.sessionId))}),u&&e.jsx(Ws,{trade:u,settings:s,onClose:()=>m(null),onEdit:w=>{r&&r(w),m(null)},onDelete:w=>{l&&l(w),m(null)}})]})},If=({trades:t,settings:s})=>{const{currentTheme:r}=Q(),{currentLanguage:l}=Z(),[n,o]=g.useState("histogram"),a=V.useMemo(()=>{const c=t.filter(m=>m.status==="closed");return c.length===0?[]:[{min:-1/0,max:-10,label:"< -10%",shortLabel:"<-10%",color:"#7f1d1d",severity:"critical"},{min:-10,max:-5,label:l==="fr"?"-10% Ã  -5%":"-10% to -5%",shortLabel:"-10/-5%",color:"#dc2626",severity:"high"},{min:-5,max:-2,label:l==="fr"?"-5% Ã  -2%":"-5% to -2%",shortLabel:"-5/-2%",color:"#ef4444",severity:"medium"},{min:-2,max:-1,label:l==="fr"?"-2% Ã  -1%":"-2% to -1%",shortLabel:"-2/-1%",color:"#f87171",severity:"low"},{min:-1,max:0,label:l==="fr"?"-1% Ã  0%":"-1% to 0%",shortLabel:"-1/0%",color:"#fca5a5",severity:"minimal"},{min:0,max:1,label:l==="fr"?"0% Ã  1%":"0% to 1%",shortLabel:"0/1%",color:"#bbf7d0",severity:"minimal"},{min:1,max:2,label:l==="fr"?"1% Ã  2%":"1% to 2%",shortLabel:"1/2%",color:"#86efac",severity:"low"},{min:2,max:5,label:l==="fr"?"2% Ã  5%":"2% to 5%",shortLabel:"2/5%",color:"#4ade80",severity:"medium"},{min:5,max:10,label:l==="fr"?"5% Ã  10%":"5% to 10%",shortLabel:"5/10%",color:"#22c55e",severity:"high"},{min:10,max:1/0,label:"> 10%",shortLabel:">10%",color:"#15803d",severity:"critical"}].map((m,p)=>{const x=c.filter(S=>{const k=S.pnlPercentage||0;return k>m.min&&k<=m.max}),f=x.length,v=f/c.length*100,h=x.reduce((S,k)=>S+(k.pnl||0),0),b=x.reduce((S,k)=>S+(k.pnlPercentage||0),0),j=x.length>0?x.reduce((S,k)=>S+(k.duration||0),0)/x.length:0,y=x.filter(S=>S.ticksGained!==void 0).length>0?x.filter(S=>S.ticksGained!==void 0).reduce((S,k)=>S+(k.ticksGained||0),0)/x.filter(S=>S.ticksGained!==void 0).length:0,N=new Set(x.map(S=>S.strategy)),w=new Set(x.map(S=>S.symbol));return{range:m.label,shortLabel:m.shortLabel,count:f,percentage:v,color:m.color,severity:m.severity,totalPnL:h,totalPnLPercentage:b,avgPnL:f>0?h/f:0,avgPnLPercentage:f>0?b/f:0,avgDuration:j,avgTicks:y,strategiesCount:N.size,symbolsCount:w.size,fill:m.color,index:p,density:v,portfolioImpact:b/100*s.initialCapital,name:m.shortLabel,value:f}}).filter(m=>m.count>0)},[t,s.initialCapital,l]);if(a.length===0)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_e,{size:48,className:"mx-auto mb-4",style:{color:r.colors.textMuted}}),e.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:r.colors.text},children:l==="fr"?"Aucune donnÃ©e de distribution":"No distribution data"}),e.jsx("p",{style:{color:r.colors.textSecondary},children:l==="fr"?"Ajoutez des trades pour voir la distribution des performances":"Add trades to see performance distribution"})]});const i=({name:c,percent:d})=>`${c}: ${(d*100).toFixed(0)}%`;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium",style:{color:r.colors.text},children:[l==="fr"?"ðŸ“Š Distribution des Performances":"ðŸ“Š Performance Distribution",e.jsxs("span",{className:"text-sm ml-2",style:{color:r.colors.textMuted},children:["(",a.length," ",l==="fr"?"tranches actives":"active ranges",")"]})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("div",{className:"flex space-x-1 p-1 rounded-lg",style:{backgroundColor:r.colors.surface},children:[e.jsxs("button",{onClick:()=>o("histogram"),className:`flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ${n==="histogram"?"shadow-sm":""}`,style:{backgroundColor:n==="histogram"?r.colors.card:"transparent",color:n==="histogram"?r.colors.accent:r.colors.textSecondary},children:[e.jsx(Te,{size:16,className:"mr-2"}),l==="fr"?"Histogramme":"Histogram"]}),e.jsxs("button",{onClick:()=>o("pie"),className:`flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ${n==="pie"?"shadow-sm":""}`,style:{backgroundColor:n==="pie"?r.colors.card:"transparent",color:n==="pie"?r.colors.accent:r.colors.textSecondary},children:[e.jsx(bl,{size:16,className:"mr-2"}),l==="fr"?"Camembert":"Pie"]})]})})]}),e.jsx(Cs,{width:"100%",height:400,children:n==="pie"?e.jsxs(ol,{children:[e.jsx(nl,{data:a,cx:"50%",cy:"50%",labelLine:!1,label:i,outerRadius:120,fill:"#8884d8",dataKey:"value",children:a.map((c,d)=>e.jsx(Oo,{fill:c.color},`cell-${d}`))}),e.jsx(Jt,{content:e.jsx(Yt,{})}),e.jsx(Ut,{})]}):e.jsxs(As,{data:a,children:[e.jsx(ns,{strokeDasharray:"3 3",stroke:r.colors.border}),e.jsx(ls,{dataKey:"shortLabel",stroke:r.colors.textMuted,fontSize:12,angle:-45,textAnchor:"end",height:60}),e.jsx(bt,{yAxisId:"density",stroke:r.colors.textMuted,fontSize:12,tickFormatter:c=>`${c}%`}),e.jsx(bt,{yAxisId:"count",orientation:"right",stroke:r.colors.textMuted,fontSize:12}),e.jsx(Jt,{content:e.jsx(Yt,{})}),e.jsx(Ut,{}),e.jsx(Ir,{yAxisId:"density",dataKey:"density",name:l==="fr"?"DensitÃ© %":"Density %",radius:[2,2,0,0],opacity:.7}),e.jsx(sl,{yAxisId:"count",type:"monotone",dataKey:"count",stroke:r.colors.warning,fill:r.colors.warning,fillOpacity:.3,name:l==="fr"?"Nombre de Trades":"Number of Trades"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:a.filter(c=>c.totalPnLPercentage>0).length}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"Tranches Positives":"Positive Ranges"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:a.filter(c=>c.totalPnLPercentage<0).length}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"Tranches NÃ©gatives":"Negative Ranges"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:r.colors.accent},children:a.reduce((c,d)=>c+d.count,0)}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:"Total Trades"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:r.colors.info},children:a.length}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"Tranches Actives":"Active Ranges"})]})]})]})},Of=({trades:t,settings:s})=>{const{currentTheme:r}=Q(),{currentLanguage:l}=Z(),[n,o]=g.useState(!0),[a,i]=g.useState(!0),c=V.useMemo(()=>{const d=t.filter(b=>b.status==="closed");if(d.length===0)return[];const u=new Map;d.forEach(b=>{const j=b.strategy,y=u.get(j)||{trades:0,wins:0,totalPnL:0,totalPercentage:0,avgDuration:0,totalTicks:0,tradesWithTicks:0,totalFees:0,winningTrades:[],losingTrades:[]};y.trades+=1;const N=b.pnl||0;N>0?(y.wins+=1,y.winningTrades.push(b)):N<0&&y.losingTrades.push(b),y.totalPnL+=N,y.totalPercentage+=b.pnlPercentage||0,y.avgDuration+=b.duration||0,y.totalFees+=b.fees?.total||b.commission||0,b.ticksGained!==void 0&&b.ticksGained!==0&&(y.totalTicks+=b.ticksGained,y.tradesWithTicks+=1),u.set(j,y)});const m=new Map,p=new Map;d.forEach(b=>{m.set(b.strategy,(m.get(b.strategy)||0)+1),p.set(b.symbol,(p.get(b.symbol)||0)+1)});let x="",f=0;m.forEach((b,j)=>{b>f&&(f=b,x=j)});const v=Array.from(p.entries()).sort((b,j)=>j[1]-b[1]).slice(0,3).map(b=>b[0]);d.reduce((b,j)=>b+(j.pnl||0),0);const h=d.reduce((b,j)=>b+(j.pnlPercentage||0),0);return d.length>0&&h/d.length,Array.from(u.entries()).map(([b,j])=>{const y=j.wins/j.trades*100,N=j.winningTrades.length>0?j.winningTrades.reduce((D,F)=>D+(F.pnl||0),0)/j.winningTrades.length:0,w=j.losingTrades.length>0?j.losingTrades.reduce((D,F)=>D+(F.pnl||0),0)/j.losingTrades.length:0,S=Math.abs(w)>0?N/Math.abs(w):N>0?1/0:0,k=d.filter(D=>D.strategy===b),C=k.reduce((D,F)=>D+(F.pnl||0),0),P=k.reduce((D,F)=>D+(F.pnlPercentage||0),0),R=k.length>0?P/k.length:0,M=new Map;k.forEach(D=>{M.set(D.symbol,(M.get(D.symbol)||0)+1)});const T=Array.from(M.entries()).sort((D,F)=>F[1]-D[1]).slice(0,3).map(D=>D[0]);return{strategy:b.length>15?b.substring(0,15)+"...":b,fullStrategy:b,trades:j.trades,winRate:y,totalPnL:j.totalPnL,totalPercentage:j.totalPercentage,avgPnL:j.totalPnL/j.trades,avgPercentage:j.totalPercentage/j.trades,avgDuration:j.avgDuration/j.trades,avgTicks:j.tradesWithTicks>0?j.totalTicks/j.tradesWithTicks:0,totalFees:j.totalFees,avgFees:j.totalFees/j.trades,profitFactor:S,avgWin:N,avgLoss:w,fill:j.totalPercentage>=0?r.colors.success:r.colors.danger,strategiesCount:m.size,symbolsCount:p.size,topStrategy:x,topSymbols:v,wins:j.wins,losses:j.trades-j.wins,totalPnLPercentage:P,windowTotalPnL:C,avgPercentagePerTrade:R,strategyTopSymbols:T,strategySymbolsCount:M.size,windowPnL:C,windowPnLPercentage:P}}).sort((b,j)=>j.totalPercentage-b.totalPercentage)},[t,r.colors]);return c.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_e,{size:48,className:"mx-auto mb-4",style:{color:r.colors.textMuted}}),e.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:r.colors.text},children:l==="fr"?"Aucune donnÃ©e de stratÃ©gie":"No strategy data"}),e.jsx("p",{style:{color:r.colors.textSecondary},children:l==="fr"?"Ajoutez des trades avec des stratÃ©gies pour voir ce graphique":"Add trades with strategies to see this chart"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium",style:{color:r.colors.text},children:[l==="fr"?"ðŸ“Š Performance par StratÃ©gie":"ðŸ“Š Performance by Strategy",e.jsxs("span",{className:"text-sm ml-2",style:{color:r.colors.textMuted},children:["(",c.length," ",l==="fr"?"stratÃ©gies":"strategies",")"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>o(!n),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${n?"shadow-sm":"opacity-70"}`,style:{backgroundColor:n?r.colors.warning+"40":r.colors.surface,color:n?r.colors.text:r.colors.textSecondary,border:`1px solid ${n?r.colors.warning+"60":r.colors.border}`},children:[n?e.jsx(Se,{size:16,className:"mr-2"}):e.jsx(De,{size:16,className:"mr-2"}),"Win Rate"]}),e.jsxs("button",{onClick:()=>i(!a),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${a?"shadow-sm":"opacity-70"}`,style:{backgroundColor:a?r.colors.info+"40":r.colors.surface,color:a?r.colors.text:r.colors.textSecondary,border:`1px solid ${a?r.colors.info+"60":r.colors.border}`},children:[a?e.jsx(Se,{size:16,className:"mr-2"}):e.jsx(De,{size:16,className:"mr-2"}),l==="fr"?"Nb Trades":"# Trades"]})]})]}),e.jsx(Cs,{width:"100%",height:400,children:e.jsxs(As,{data:c,children:[e.jsx(ns,{strokeDasharray:"3 3",stroke:r.colors.border}),e.jsx(ls,{dataKey:"strategy",stroke:r.colors.textMuted,fontSize:12,angle:-45,textAnchor:"end",height:80}),e.jsx(bt,{yAxisId:"pnl",stroke:r.colors.textMuted,fontSize:12,tickFormatter:d=>`${d.toFixed(1)}%`}),n&&e.jsx(bt,{yAxisId:"winrate",orientation:"right",stroke:r.colors.textMuted,fontSize:12,domain:[0,100],tickFormatter:d=>`${d}%`}),a&&!n&&e.jsx(bt,{yAxisId:"trades",orientation:"right",stroke:r.colors.textMuted,fontSize:12,tickFormatter:d=>`${d}`}),e.jsx(Jt,{content:e.jsx(Yt,{})}),e.jsx(Ut,{}),e.jsx(Ns,{yAxisId:"pnl",y:0,stroke:r.colors.textMuted,strokeDasharray:"5 5"}),e.jsx(Ir,{yAxisId:"pnl",dataKey:"totalPercentage",name:l==="fr"?"P&L Total %":"Total P&L %",radius:[4,4,0,0],stroke:r.colors.border,strokeWidth:1}),n&&e.jsx(Kt,{yAxisId:"winrate",type:"monotone",dataKey:"winRate",stroke:r.colors.warning,strokeWidth:3,dot:{fill:r.colors.warning,strokeWidth:2,r:5},name:"Win Rate %"}),a&&!n&&e.jsx(Kt,{yAxisId:"trades",type:"monotone",dataKey:"trades",stroke:r.colors.info,strokeWidth:2,strokeDasharray:"5 5",dot:{fill:r.colors.info,strokeWidth:2,r:4},name:l==="fr"?"Nombre de Trades":"Number of Trades"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:r.colors.accent},children:c.length}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"StratÃ©gies UtilisÃ©es":"Strategies Used"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:c.filter(d=>d.totalPercentage>0).length}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"StratÃ©gies Profitables":"Profitable Strategies"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:`${Math.max(...c.map(d=>d.totalPercentage))>=0?"+":""}${Math.max(...c.map(d=>d.totalPercentage)).toFixed(2)}%`}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"Meilleure Performance":"Best Performance"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold",style:{color:r.colors.info},children:[(c.reduce((d,u)=>d+u.winRate,0)/c.length).toFixed(1),"%"]}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"Win Rate Moyen":"Average Win Rate"})]})]})]})},qf=({trades:t,settings:s,onEditTrade:r,onDeleteTrade:l})=>{const{currentTheme:n}=Q(),{currentLanguage:o}=Z(),[a,i]=g.useState("pnl"),[c,d]=g.useState("percentage"),u=t.filter(x=>x.status==="closed"),m=s.statsDisplay?.showTicksCumulativeChart!==!1,p=[{key:"pnl",label:o==="fr"?"P&L CumulÃ©":"Cumulative P&L",icon:Ae},{key:"equity",label:o==="fr"?"Courbe d'Ã‰quitÃ©":"Equity Curve",icon:Mt},{key:"periodic",label:o==="fr"?"P&L PÃ©riodique":"Periodic P&L",icon:_e},{key:"winrate",label:o==="fr"?"Taux de RÃ©ussite":"Win Rate",icon:Te},{key:"distribution",label:"Distribution",icon:bl},{key:"performance",label:"Performance",icon:ir},...m?[{key:"ticks",label:o==="fr"?"Ticks CumulÃ©s":"Cumulative Ticks",icon:Te}]:[]];return u.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_e,{size:64,className:"mx-auto mb-4",style:{color:n.colors.textMuted}}),e.jsx("h3",{className:"text-xl font-bold mb-2",style:{color:n.colors.text},children:o==="fr"?"Pas assez de donnÃ©es":"Not enough data"}),e.jsx("p",{style:{color:n.colors.textSecondary},children:o==="fr"?"Ajoutez plus de trades fermÃ©s pour voir les graphiques":"Add more closed trades to see charts"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:p.map(({key:x,label:f,icon:v})=>e.jsxs("button",{onClick:()=>i(x),className:`flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-colors ${a===x?"shadow-sm":""}`,style:{backgroundColor:a===x?n.colors.card:n.colors.surface,color:a===x?n.colors.accent:n.colors.textSecondary,border:`1px solid ${n.colors.border}`},children:[e.jsx(v,{size:16,className:"mr-2"}),f]},x))}),a==="pnl"&&e.jsxs("div",{className:"flex justify-end space-x-1 p-1 rounded-lg",style:{backgroundColor:n.colors.surface},children:[e.jsxs("button",{onClick:()=>d("currency"),className:`flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ${c==="currency"?"shadow-sm":""}`,style:{backgroundColor:c==="currency"?n.colors.card:"transparent",color:c==="currency"?n.colors.accent:n.colors.textSecondary},children:[e.jsx(sr,{size:16,className:"mr-2"}),"Capital (EUR)"]}),e.jsxs("button",{onClick:()=>d("percentage"),className:`flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ${c==="percentage"?"shadow-sm":""}`,style:{backgroundColor:c==="percentage"?n.colors.card:"transparent",color:c==="percentage"?n.colors.accent:n.colors.textSecondary},children:[e.jsx(is,{size:16,className:"mr-2"}),o==="fr"?"Pourcentage":"Percentage"]})]}),e.jsxs("div",{className:"rounded-lg shadow-sm border p-6",style:{backgroundColor:n.colors.card,borderColor:n.colors.border},children:[a==="pnl"&&e.jsx(vf,{trades:t,settings:s,viewMode:c,onEditTrade:r,onDeleteTrade:l}),a==="equity"&&e.jsx(Lf,{trades:t,settings:s,onEditTrade:r,onDeleteTrade:l}),a==="periodic"&&e.jsx($f,{trades:t,settings:s,onEditTrade:r,onDeleteTrade:l}),a==="winrate"&&e.jsx(zf,{trades:t,settings:s,onEditTrade:r,onDeleteTrade:l}),a==="distribution"&&e.jsx(If,{trades:t,settings:s}),a==="performance"&&e.jsx(Of,{trades:t,settings:s}),a==="ticks"&&m&&e.jsx(Af,{trades:t,settings:s,onEditTrade:r,onDeleteTrade:l}),a==="ticks"&&!m&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Te,{size:64,className:"mx-auto mb-4",style:{color:n.colors.textMuted}}),e.jsx("h3",{className:"text-xl font-bold mb-2",style:{color:n.colors.text},children:o==="fr"?"Graphique des Ticks DÃ©sactivÃ©":"Ticks Chart Disabled"}),e.jsx("p",{style:{color:n.colors.textSecondary},children:o==="fr"?"Activez le graphique cumulatif des ticks dans les paramÃ¨tres du profil pour voir ce graphique.":"Enable the cumulative ticks chart in the profile settings to see this chart."})]})]})]})},Uf=({trades:t,settings:s,onEditTrade:r,onDeleteTrade:l})=>e.jsx(qf,{trades:t,settings:s,onEditTrade:r,onDeleteTrade:n=>l(typeof n=="string"?n:n.id)}),Wf=({trades:t,settings:s,onEdit:r,onDelete:l})=>e.jsx("div",{className:"card rounded-lg shadow-sm p-6",children:e.jsx(ka,{trades:t,onEdit:r,onDelete:n=>l(typeof n=="string"?n:n.id),settings:s})}),_f=()=>{const[t,s]=us("trading-journal-profiles",[]),[r,l]=us("trading-journal-active-profile",null),n=t.find(u=>u.id===r)||null,o=u=>{const m={...u,id:Date.now().toString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return s(p=>[...p,m]),t.length===0&&l(m.id),m};return{profiles:t,activeProfile:n,createProfile:o,updateProfile:(u,m)=>{s(p=>p.map(x=>x.id===u?{...x,...m,updatedAt:new Date().toISOString()}:x))},deleteProfile:u=>{if(s(m=>m.filter(p=>p.id!==u)),r===u){const m=t.filter(p=>p.id!==u);l(m.length>0?m[0].id:null)}},setActiveProfile:u=>{l(u)},duplicateProfile:(u,m)=>{const p=t.find(j=>j.id===u);if(!p)return null;const{id:x,createdAt:f,updatedAt:v,...h}=p;return o({...h,name:m})}}},Vf=t=>{const{profiles:s,activeProfile:r,createProfile:l,updateProfile:n,deleteProfile:o,setActiveProfile:a}=_f(),[i,c]=g.useState(!1),[d,u]=g.useState(null),m=g.useCallback(h=>{const b=l(h);a(b.id),c(!1),u(null)},[l,a]),p=g.useCallback(h=>{d&&(n(d.id,h),c(!1),u(null))},[d,n]),x=g.useCallback(h=>{t(b=>b.filter(j=>j.profileId!==h.id)),o(h.id)},[o,t]),f=g.useCallback(h=>{u(h||null),c(!0)},[]),v=g.useCallback(()=>{c(!1),u(null)},[]);return{profiles:s,activeProfile:r,createProfile:l,updateProfile:n,deleteProfile:o,setActiveProfile:a,showProfileModal:i,setShowProfileModal:c,editingProfile:d,setEditingProfile:u,handleCreateProfile:m,handleUpdateProfile:p,handleDeleteProfile:x,openProfileModal:f,closeProfileModal:v}},Bf=()=>{const t=typeof window<"u"&&window.electronAPI?.isElectron;return{isElectron:t,electronAPI:t?window.electronAPI:null}};function hs(t){if(typeof t!="string")return null;const s=t.trim().replace(/\s+/g," ");if(s===""||!Hf(s))return null;const r=s.replace(/[\s_'']/g,"").replace(",",".");if(!Gf(r))return null;const l=Jf(r);return Kf(l)?{raw:s,normalized:r,decimalString:l}:null}function Hf(t){return/[\s_'']/.test(t)?/^\d{1,3}([\s_'']\d{3})*([,.]\d+)?$/.test(t):!0}function Gf(t){return/^-?(\d+\.?\d*|\.\d+)$/.test(t)}function Jf(t){let s=t;return s.endsWith(".")&&(s=s+"0"),s.startsWith("-.")&&(s=s.replace("-.","-0.")),s.startsWith(".")&&!s.startsWith("-.")&&(s="0"+s),(s==="-0"||s==="-0.0")&&(s="0"),s}function Kf(t){return!(!/^[-]?\d+(\.\d+)?$/.test(t)||t.length>64)}function wa(t,s,r){const l=hs(t);if(!l)throw new Error(`computeTicks: invalid entry price "${t}"`);const n=hs(s);if(!n)throw new Error(`computeTicks: invalid exit price "${s}"`);const o=hs(r);if(!o)throw new Error(`computeTicks: invalid tick size "${r}"`);const a=Me(l.decimalString),i=Me(n.decimalString),c=Me(o.decimalString);if(c.isZero())throw new Error("computeTicks: tick size cannot be zero");const d=Br(i,a);return vs(d,c)}function Sa(t,s,r,l,n){const o=hs(l);if(!o)throw new Error(`computePnL: invalid tick value "${l}"`);const a=hs(n);if(!a)throw new Error(`computePnL: invalid contracts "${n}"`);const i=Me(o.decimalString),c=Me(a.decimalString),d=wa(t,s,r);return ut(ut(d,i),c)}function Ca(t,s){const r=hs(t);if(!r)throw new Error(`computeFees: invalid fee per contract "${t}"`);const l=hs(s);if(!l)throw new Error(`computeFees: invalid contracts "${s}"`);const n=Me(r.decimalString),o=Me(l.decimalString);return ut(n,o)}function Yf(t,s,r,l,n,o){const a=Sa(t,s,r,l,n),i=Ca(o,n);return Br(a,i)}function Xf(t,s){const r=hs(s);if(!r)throw new Error(`computePnLPercentage: invalid capital "${s}"`);const l=Me(r.decimalString);if(l.isZero())throw new Error("computePnLPercentage: capital cannot be zero");return ut(vs(t,l),Me("100"))}function Qf(t,s){const r=t.split(":"),l=s.split(":");if(r.length!==3||l.length!==3)throw new Error(`computeDuration: invalid time format. Expected HH:MM:SS, got entry="${t}", exit="${s}"`);const n=Pt(Pt(ut(Me(r[0]),Me("3600")),ut(Me(r[1]),Me("60"))),Me(r[2])),o=Pt(Pt(ut(Me(l[0]),Me("3600")),ut(Me(l[1]),Me("60"))),Me(l[2])),a=Br(o,n);if(a.isNegative())throw new Error(`computeDuration: exit time "${s}" is before entry time "${t}"`);return a}const Zf=Object.freeze(Object.defineProperty({__proto__:null,computeDuration:Qf,computeFees:Ca,computeNetPnL:Yf,computePnL:Sa,computePnLPercentage:Xf,computeTicks:wa},Symbol.toStringTag,{value:"Module"})),ep=t=>{const s={...t};return Object.keys(s).forEach(r=>{const l=s[r];Array.isArray(l)&&l.length===0&&delete s[r]}),["pnlRange","durationRange","feesRange","contractsRange","lotsRange","ticksRange"].forEach(r=>{const l=s[r];l&&typeof l=="object"&&(l.min===void 0||l.min===null||l.min==="")&&(l.max===void 0||l.max===null||l.max==="")&&delete s[r]}),["dateRange","timeRange"].forEach(r=>{const l=s[r];l&&typeof l=="object"&&(l.start===void 0||l.start===null||l.start==="")&&(l.end===void 0||l.end===null||l.end==="")&&delete s[r]}),s.tradeResult&&typeof s.tradeResult=="object"&&!s.tradeResult.takeProfit&&!s.tradeResult.stopLoss&&!s.tradeResult.breakEven&&delete s.tradeResult,s},Bn=t=>{if(typeof t=="number")return t;if(t==null)return NaN;let s=String(t).trim();if(s==="")return NaN;s=s.replace(/,/g,"."),s.endsWith(".")&&(s+="0");const r=Number.parseFloat(s);return Number.isNaN(r)?NaN:r},tp=(t,s)=>{const r=Bn(t),l=Bn(s),n=Number.isNaN(r)?-1/0:r,o=Number.isNaN(l)?1/0:l;return{min:n,max:o}},sp={seconds:1,minutes:60,hours:3600,days:86400},Pa={seconds:{min:0,max:59},minutes:{min:0,max:59},hours:{min:0,max:23},days:{min:0,max:365}},Hn=(t,s)=>typeof t!="number"||Number.isNaN(t)?NaN:Math.floor(t*sp[s]),Gn=(t,s)=>{if(t===void 0)return!0;const{min:r,max:l}=Pa[s];return t>=r&&t<=l},rp=(t,s,r)=>{const l=[];return Gn(t,r)||l.push(`Valeur min invalide pour ${r}`),Gn(s,r)||l.push(`Valeur max invalide pour ${r}`),t!==void 0&&s!==void 0&&t>s&&l.push("La valeur min ne peut pas Ãªtre supÃ©rieure Ã  la valeur max"),{isValid:l.length===0,errors:l}},op=(t,s,r)=>{const l=t===void 0?void 0:Hn(t,r),n=s===void 0?void 0:Hn(s,r);return{minSeconds:l,maxSeconds:n}},np=t=>{const s=new Date(t);return["january","february","march","april","may","june","july","august","september","october","november","december"][s.getMonth()]},Jn=t=>{if(!t)return-1;const s=parseInt(t.split(":")[0]);return isNaN(s)?-1:s},lp=t=>{const s=new Date(t);return["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][s.getDay()]},ap=t=>t>=0&&t<8?"asia":t>=8&&t<14?"eu":t>=14&&t<16?"overlap":t>=16&&t<21?"us":t>=21&&t<24?"close":"asia";function cp(t,s){return t.filter(r=>{if(s.dateRange?.start||s.dateRange?.end){console.log("ðŸ” Date filter active in useFilters:",{start:s.dateRange.start,end:s.dateRange.end,tradeDate:r.date});const l=new Date(r.date);if(l.setHours(0,0,0,0),s.dateRange.start){const n=new Date(s.dateRange.start);if(n.setHours(0,0,0,0),console.log("ðŸ“… Comparing dates:",{tradeDate:l.toISOString(),startDate:n.toISOString(),isBefore:l<n}),l<n)return!1}if(s.dateRange.end){const n=new Date(s.dateRange.end);if(n.setHours(23,59,59,999),l>n)return!1}}if((s.timeRange?.start||s.timeRange?.end)&&r.time){const l=r.time;if(s.timeRange.start&&s.timeRange.end){const n=s.timeRange.start,o=s.timeRange.end;if(n<=o){if(l<n||l>o)return!1}else if(l<n&&l>o)return!1}else if(s.timeRange.start){if(l<s.timeRange.start)return!1}else if(s.timeRange.end&&l>s.timeRange.end)return!1}if(s.weekdays&&s.weekdays.length>0){const l=lp(r.date);if(!s.weekdays.includes(l))return!1}if(s.months&&s.months.length>0){const l=np(r.date);if(!s.months.includes(l))return!1}if(s.hours&&s.hours.length>0){const l=Jn(r.time);if(l===-1||!s.hours.includes(l))return!1}if(s.sessions&&s.sessions.length>0&&r.time){const l=Jn(r.time);if(l===-1)return!1;const n=ap(l);if(!s.sessions.includes(n))return!1}if(s.pnlRange){let l;s.pnlUnit==="percent"?l=r.pnlPercentage||0:l=r.pnl||0;const n=s.pnlRange.min!==void 0?s.pnlRange.min:-1/0,o=s.pnlRange.max!==void 0?s.pnlRange.max:1/0;if(l<n||l>o)return!1}if(s.durationRange&&r.duration!==void 0){const l=s.durationUnit||"minutes",{minSeconds:n,maxSeconds:o}=op(s.durationRange.min,s.durationRange.max,l);if(n!==void 0&&r.duration<n||o!==void 0&&r.duration>o)return!1}if(s.ticksRange&&r.ticksGained!==void 0){const l=s.ticksRange.min!==void 0?s.ticksRange.min:-1/0,n=s.ticksRange.max!==void 0?s.ticksRange.max:1/0;if(r.ticksGained<l||r.ticksGained>n)return!1}if(s.feesRange){const l=Number(r.fees?.total??r.commission??0),{min:n,max:o}=tp(s.feesRange.min,s.feesRange.max);if(l<n||l>o)return!1}if(s.lotsRange&&r.numberOfLots!==void 0){const l=s.lotsRange.min!==void 0?s.lotsRange.min:0,n=s.lotsRange.max!==void 0?s.lotsRange.max:1/0;if(r.numberOfLots<l||r.numberOfLots>n)return!1}if(s.tradeResult){const{takeProfit:l,stopLoss:n,breakEven:o}=s.tradeResult;if(l&&r.tradeResult!=="tp"||n&&r.tradeResult!=="sl"||o&&r.tradeResult!=="be")return!1}if(s.marketType&&s.marketType.length>0&&!s.marketType.includes(r.market)||s.trend&&s.trend.length>0&&!s.trend.includes(r.trend)||s.direction&&s.direction.length>0&&!s.direction.includes(r.side)||s.strategy&&s.strategy.length>0&&!s.strategy.includes(r.strategy)||s.status&&s.status.length>0&&!s.status.includes(r.status)||s.symbols&&s.symbols.length>0&&!s.symbols.includes(r.symbol)||s.tags&&s.tags.length>0&&!s.tags.some(n=>r.tags.some(o=>o.toLowerCase().includes(n.toLowerCase())))||s.timeframe&&s.timeframe.length>0&&(!r.timeframe||!s.timeframe.includes(r.timeframe)))return!1;if(s.ticksRange&&r.ticksGained!==void 0){const l=s.ticksRange.min!==void 0?s.ticksRange.min:-1/0,n=s.ticksRange.max!==void 0?s.ticksRange.max:1/0;if(r.ticksGained<l||r.ticksGained>n)return!1}return s.tickEntry&&s.tickEntry.length>0,!0})}const zo=Xo,zr=cp,Ts=zl,Ma=Il;new Proxy(Nn,{get(t,s){const r=Zf[s],l=Nn[s];return typeof r=="function"&&typeof l!="function"?(...n)=>r(...n):typeof r=="function"&&typeof l=="function"?(...n)=>r(...n):l}});const ip=({isOpen:t,onToggle:s,onOpenSettings:r,onOpenProfileSettings:l,onOpenImportExport:n})=>{const[o,a]=g.useState(!1),[i,c]=g.useState(!1),d=g.useRef(null),u=g.useRef(null),m=g.useRef(null),{currentTheme:p,themes:x,setTheme:f}=Q(),{currentLanguage:v,changeLanguage:h}=Z(),b=()=>{d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{t||(a(!0),s())},200)},j=()=>{d.current&&(clearTimeout(d.current),d.current=null),o&&!t&&(a(!1),s())};g.useEffect(()=>()=>{d.current&&clearTimeout(d.current)},[]);const y=w=>v==="fr"?w==="light"?"Clair":w==="dark"?"Sombre":w==="ultra-dark"?"Ultra Sombre":"ThÃ¨me":w==="light"?"Light":w==="dark"?"Dark":w==="ultra-dark"?"Ultra Dark":"Theme",N=()=>{h(v==="fr"?"en":"fr")};return e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:m,onClick:s,onMouseEnter:b,onMouseLeave:j,className:`fixed left-0 top-1/2 transform -translate-y-1/2 z-50 p-2 rounded-r-lg transition-all duration-300 ease-in-out ${t?"theme-text shadow-lg":"theme-surface hover:theme-border theme-text-muted hover:theme-text"}`,style:{backgroundColor:t?"var(--theme-accent)":void 0,left:t?"280px":"0",transition:"left 0.3s ease-in-out"},children:t?e.jsx(as,{size:20}):e.jsx(Is,{size:20})}),e.jsx("div",{ref:u,className:`fixed left-0 top-0 h-full theme-surface border-r theme-border shadow-lg transition-all duration-300 ease-in-out z-40 ${t?"w-72 translate-x-0":"w-0 -translate-x-full"}`,onMouseEnter:()=>{d.current&&(clearTimeout(d.current),d.current=null),a(!1)},onMouseLeave:()=>{o&&setTimeout(()=>{o&&(a(!1),s())},200)},children:e.jsx("div",{className:"h-full overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold theme-text mb-6",children:"ParamÃ¨tres Rapides"}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("h3",{className:"text-lg font-medium theme-text-secondary mb-3 flex items-center",children:[e.jsx(Ho,{size:18,className:"mr-2"}),"Profil"]}),e.jsxs("button",{onClick:N,className:"w-full flex items-center p-3 rounded-lg border theme-border hover:theme-surface transition-colors text-left",children:[e.jsx(Wo,{size:18,className:"mr-3 theme-text-muted"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:"Langue"}),e.jsx("div",{className:"text-sm theme-text-muted",children:v==="fr"?"FranÃ§ais":"English"})]})]}),e.jsxs("button",{onClick:l,className:"w-full flex items-center p-3 rounded-lg border theme-border hover:theme-surface transition-colors text-left",children:[e.jsx(ms,{size:18,className:"mr-3 theme-text-muted"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:"ParamÃ¨tres du Profil"}),e.jsx("div",{className:"text-sm theme-text-muted",children:"Capital, risque, devise"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>c(!i),className:"w-full flex items-center p-3 rounded-lg border theme-border hover:theme-surface transition-colors text-left",children:[e.jsx(_o,{size:18,className:"mr-3 theme-text-muted"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium theme-text",children:"ThÃ¨me"}),e.jsx("div",{className:"text-sm theme-text-muted",children:y(p.id)})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full border theme-border",style:{backgroundColor:p.colors.bg}}),e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:p.colors.accent}})]})]}),i&&e.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 theme-surface border theme-border rounded-lg shadow-lg z-50",children:e.jsx("div",{className:"p-2 space-y-1",children:x.map(w=>e.jsxs("button",{onClick:()=>{f(w.id),c(!1)},className:`w-full flex items-center p-2 rounded text-left hover:theme-surface ${p.id===w.id?"shadow-md":"theme-text"}`,style:{backgroundColor:p.id===w.id?`${p.colors.accent}10`:void 0,color:p.id===w.id?p.colors.accent:void 0},children:[e.jsxs("div",{className:"flex space-x-2 mr-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full border theme-border",style:{backgroundColor:w.colors.bg}}),e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:w.colors.accent}})]}),e.jsx("span",{className:"text-sm",children:y(w.id)}),p.id===w.id&&e.jsx("div",{className:"ml-auto text-blue-600",children:"âœ“"})]},w.id))})})]})]}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("h3",{className:"text-lg font-medium theme-text-secondary mb-3 flex items-center",children:[e.jsx(tr,{size:18,className:"mr-2"}),"DonnÃ©es"]}),e.jsxs("button",{onClick:n,className:"w-full flex items-center p-3 rounded-lg border theme-border hover:theme-surface transition-colors text-left",children:[e.jsxs("div",{className:"mr-3 flex space-x-1",children:[e.jsx(cr,{size:16,className:"text-green-600"}),e.jsx(wr,{size:16,className:"text-blue-600"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:"Import/Export"}),e.jsx("div",{className:"text-sm theme-text-muted",children:"CSV, JSON, PDF"})]})]}),e.jsxs("button",{onClick:()=>{window.location.hash="#/v3demo"},className:"w-full flex items-center p-3 rounded-lg border theme-border hover:theme-surface transition-colors text-left",title:"V3 Sandbox (POC)",children:[e.jsx("div",{className:"mr-3 flex space-x-1",children:e.jsx("span",{className:"inline-block w-2 h-2 rounded-full",style:{backgroundColor:p.colors.accent}})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:"V3 Sandbox (POC)"}),e.jsx("div",{className:"text-sm theme-text-muted",children:"Formulaire V3 dÃ©claratif (dÃ©mo)"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium theme-text-secondary mb-3 flex items-center",children:[e.jsx(Te,{size:18,className:"mr-2"}),"Plan de Trading"]}),e.jsxs("div",{className:"theme-text-muted text-center py-6 border border-dashed theme-border rounded-lg",children:[e.jsx(Te,{size:24,className:"mx-auto mb-2 theme-text-muted"}),e.jsx("p",{className:"text-sm",children:"Section Ã  venir..."}),e.jsx("p",{className:"text-xs mt-1",children:"On ajoutera le contenu progressivement"})]})]})]})})}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-20 z-30",onClick:s})]})},Kn=[{type:"scalper",name:"Scalper",description:"Trading haute frÃ©quence, positions courtes, focus sur les ticks",icon:"âš¡",defaultSettings:{preferences:{timeframes:["5s","10s","15s","30s","45s","1m"],markets:["futures","forex"],tradingSessions:[],units:{price:"ticks",quantity:"contracts"},keyMetrics:["trades_per_day","avg_hold_time","tick_capture","win_rate"]},settings:{initialCapital:1e4,riskPerTrade:.5,currency:"EUR",maxDailyTrades:50},uiSettings:{defaultView:"overview",compactMode:!0,showAdvancedStats:!0,chartType:"candlestick"}}},{type:"daytrader",name:"Day Trader",description:"Trading intraday, analyse technique, fermeture en fin de journÃ©e",icon:"ðŸ“ˆ",defaultSettings:{preferences:{timeframes:["1m","5m","15m","30m","1h"],markets:["futures","stocks","indices"],tradingSessions:[],units:{price:"points",quantity:"contracts"},keyMetrics:["win_rate","profit_factor","avg_rr","daily_pnl"]},settings:{initialCapital:1e4,riskPerTrade:2,currency:"EUR",maxDailyTrades:10},uiSettings:{defaultView:"stats",compactMode:!1,showAdvancedStats:!0,chartType:"candlestick"}}},{type:"swingtrader",name:"Swing Trader",description:"Positions de plusieurs jours/semaines, analyse fondamentale",icon:"ðŸŒŠ",defaultSettings:{preferences:{timeframes:["4h","1d","1w"],markets:["stocks","crypto","commodities"],tradingSessions:[],units:{price:"points",quantity:"shares"},keyMetrics:["monthly_return","max_drawdown","sharpe_ratio","hold_time"]},settings:{initialCapital:1e4,riskPerTrade:3,currency:"EUR",maxDailyTrades:2},uiSettings:{defaultView:"charts",compactMode:!1,showAdvancedStats:!0,chartType:"candlestick"}}},{type:"custom",name:"PersonnalisÃ©",description:"Configuration entiÃ¨rement personnalisable",icon:"âš™ï¸",defaultSettings:{preferences:{timeframes:["1m","5m","15m","1h","1d"],markets:["futures","forex","stocks"],tradingSessions:[],units:{price:"points",quantity:"contracts"},keyMetrics:["win_rate","profit_factor","total_return"]},settings:{initialCapital:1e4,riskPerTrade:2,currency:"EUR"},uiSettings:{defaultView:"overview",compactMode:!1,showAdvancedStats:!1,chartType:"candlestick"}}}],Ra=({profile:t,onSubmit:s,onClose:r})=>{const{currentLanguage:l,t:n}=Z(),[o,a]=g.useState({name:"",type:"custom",accountType:"demo",description:"",settings:{initialCapital:1e4,riskPerTrade:2,currency:"EUR"},preferences:{timeframes:["1m","5m","15m"],markets:["futures"],tradingSessions:[],units:{price:"points",quantity:"contracts"},keyMetrics:["win_rate","profit_factor","total_return"]},uiSettings:{defaultView:"stats",compactMode:!1,showAdvancedStats:!1,chartType:"candlestick"},isActive:!0,color:"#0ea5e9",id:"",createdAt:"",updatedAt:""}),[i,c]=g.useState("basic");g.useEffect(()=>{t&&a(t)},[t]);const d=x=>{const f=Kn.find(v=>v.type===x);f&&a(v=>({...v,type:f.type,...f.defaultSettings,settings:{...v.settings,...f.defaultSettings.settings},preferences:{...v.preferences,...f.defaultSettings.preferences},uiSettings:{...v.uiSettings,...f.defaultSettings.uiSettings}}))},u=x=>{x.preventDefault();const{id:f,createdAt:v,updatedAt:h,...b}=o;s(b)},m=(x,f)=>{a(v=>{const h=x.split("."),b={...v};let j=b;for(let y=0;y<h.length-1;y++)j[h[y]]||(j[h[y]]={}),j=j[h[y]];return j[h[h.length-1]]=f,b})},p=["#0ea5e9","#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#84cc16","#f97316","#ec4899","#6366f1"];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"theme-surface rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b theme-border flex-shrink-0",children:[e.jsx("h2",{className:"text-2xl font-bold theme-text mb-6",children:l==="fr"?"CrÃ©er/Modifier un Profil":"Create/Edit Profile"}),e.jsx("button",{onClick:r,className:"theme-text-muted hover:theme-text transition-colors",children:e.jsx(Ne,{size:24})})]}),e.jsx("div",{className:"flex border-b theme-border flex-shrink-0",children:[{key:"basic",label:l==="fr"?"Informations":"Information"},{key:"trading",label:"Trading"},{key:"display",label:l==="fr"?"Affichage Stats":"Stats Display"},{key:"ui",label:"Interface"}].map(x=>e.jsx("button",{type:"button",onClick:()=>c(x.key),className:`px-6 py-3 text-sm font-medium transition-colors ${i===x.key?"border-b-2":"theme-text-muted hover:theme-text"}`,style:{color:i===x.key?"var(--theme-accent)":void 0,borderBottomColor:i===x.key?"var(--theme-accent)":void 0},children:x.label},x.key))}),e.jsxs("form",{onSubmit:u,className:"flex flex-col flex-1 min-h-0",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[i==="basic"&&e.jsxs("div",{className:"space-y-6",children:[!t&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-muted mb-3",children:l==="fr"?"Choisir un Template":"Choose a Template"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Kn.map(x=>e.jsxs("button",{type:"button",onClick:()=>d(x.type),className:`p-4 border-2 rounded-lg text-center transition-colors ${o.type===x.type?"shadow-md":"theme-border hover:theme-border"}`,style:{borderColor:o.type===x.type?"var(--theme-accent)":void 0,backgroundColor:o.type===x.type?"var(--theme-accent)10":void 0},children:[e.jsx("div",{className:"text-2xl mb-2",children:x.icon}),e.jsx("div",{className:"font-medium theme-text text-sm",children:x.name}),e.jsx("div",{className:"text-xs theme-text-muted mt-1",children:x.description})]},x.type))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-1",children:l==="fr"?"Nom du Profil":"Profile Name"}),e.jsx("input",{type:"text",value:o.name,onChange:x=>m("name",x.target.value),className:"w-full px-3 py-2 border theme-border rounded-md focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},placeholder:l==="fr"?"Mon Profil Scalping":"My Scalping Profile",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-1",children:l==="fr"?"Type de Compte":"Account Type"}),e.jsxs("select",{value:o.accountType,onChange:x=>m("accountType",x.target.value),className:"w-full px-3 py-2 border theme-border rounded-md focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},children:[e.jsx("option",{value:"demo",children:l==="fr"?"Compte DÃ©mo":"Demo Account"}),e.jsx("option",{value:"live",children:l==="fr"?"Compte RÃ©el":"Live Account"}),e.jsx("option",{value:"backtest",children:"Backtest"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-1",children:l==="fr"?"Couleur du Profil":"Profile Color"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 rounded border theme-border",style:{backgroundColor:o.color}}),e.jsx("div",{className:"flex space-x-1",children:p.map(x=>e.jsx("button",{type:"button",onClick:()=>m("color",x),className:`w-6 h-6 rounded border-2 ${o.color===x?"theme-border":"border-transparent"}`,style:{backgroundColor:x}},x))})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("textarea",{value:o.description,onChange:x=>m("description",x.target.value),rows:3,className:"w-full px-3 py-2 border theme-border rounded-md focus:outline-none focus:ring-2 focus:ring-theme-accent focus:border-transparent theme-surface theme-text",placeholder:l==="fr"?"Description du profil...":"Profile description..."})]})]}),i==="trading"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium theme-text mb-4",children:l==="fr"?"ParamÃ¨tres Financiers de Base":"Basic Financial Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:l==="fr"?"Capital Initial":"Initial Capital"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",value:o.settings?.initialCapital,onChange:x=>m("settings.initialCapital",parseFloat(x.target.value)||0),className:"w-full px-3 py-2 pr-12 border theme-border rounded-md focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},placeholder:"10000",required:!0}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"theme-text-muted text-sm",children:o.settings?.currency})})]}),e.jsx("p",{className:"text-xs theme-text-muted mt-1",children:l==="fr"?"Montant de dÃ©part de votre compte de trading":"Starting amount of your trading account"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:l==="fr"?"Devise":"Currency"}),e.jsxs("select",{value:o.settings?.currency,onChange:x=>m("settings.currency",x.target.value),className:"w-full px-3 py-2 border theme-border rounded-md focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},children:[e.jsx("option",{value:"EUR",children:"Euro (â‚¬)"}),e.jsx("option",{value:"USD",children:"Dollar US ($)"}),e.jsx("option",{value:"GBP",children:"Livre Sterling (Â£)"}),e.jsx("option",{value:"CHF",children:"Franc Suisse (CHF)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:l==="fr"?"Risque par Trade (%)":"Risk per Trade (%)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.1",min:"0",max:"100",value:o.settings?.riskPerTrade,onChange:x=>m("settings.riskPerTrade",parseFloat(x.target.value)||0),className:"w-full px-3 py-2 pr-8 border theme-border rounded-md focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},placeholder:"2",required:!0}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"theme-text-muted text-sm",children:"%"})})]}),e.jsx("p",{className:"text-xs theme-text-muted mt-1",children:l==="fr"?"Pourcentage du capital que vous risquez par trade (recommandÃ©: 1-3%)":"Percentage of capital you risk per trade (recommended: 1-3%)"})]})]})]})}),i==="display"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium theme-text mb-4",children:l==="fr"?"Sections de Statistiques Ã  Afficher":"Statistics Sections to Display"}),e.jsx("p",{className:"text-sm theme-text-muted mb-6",children:l==="fr"?"Choisissez quelles sections de statistiques afficher dans l'interface":"Choose which statistics sections to display in the interface"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 theme-surface rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{style:{color:"var(--theme-info)"},children:"â±ï¸"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium theme-text",children:l==="fr"?"Statistiques de DurÃ©e":"Duration Statistics"}),e.jsx("p",{className:"text-xs theme-text-muted",children:l==="fr"?"DurÃ©e moyenne, plus court/long trade, etc.":"Average duration, shortest/longest trade, etc."})]})]}),e.jsx("button",{type:"button",onClick:()=>m("settings.statsDisplay.showDurationStats",!o.settings?.statsDisplay?.showDurationStats),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors",style:{backgroundColor:o.settings?.statsDisplay?.showDurationStats?"var(--theme-accent)":"var(--theme-surface)"},children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${o.settings?.statsDisplay?.showDurationStats?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 theme-surface rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-green-600 dark:text-green-400",children:"ðŸŽ¯"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium theme-text",children:l==="fr"?"Statistiques de Ticks":"Tick Statistics"}),e.jsx("p",{className:"text-xs theme-text-muted",children:l==="fr"?"Ticks capturÃ©s, efficacitÃ©, meilleure capture (scalping)":"Captured ticks, efficiency, best capture (scalping)"})]})]}),e.jsx("button",{type:"button",onClick:()=>m("settings.statsDisplay.showTicksStats",!o.settings?.statsDisplay?.showTicksStats),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors",style:{backgroundColor:o.settings?.statsDisplay?.showTicksStats?"var(--theme-accent)":"var(--theme-surface)"},children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${o.settings?.statsDisplay?.showTicksStats?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg border-2 border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-green-600 dark:text-green-400",children:"ðŸ“ˆ"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium theme-text",children:l==="fr"?"Graphique Cumulatif des Ticks":"Cumulative Tick Chart"}),e.jsx("p",{className:"text-xs theme-text-muted",children:l==="fr"?"Courbe en escalier des ticks cumulÃ©s (idÃ©al pour scalpers)":"Step chart of cumulative ticks (ideal for scalpers)"})]})]}),e.jsx("button",{type:"button",onClick:()=>m("settings.statsDisplay.showTicksCumulativeChart",!o.settings?.statsDisplay?.showTicksCumulativeChart),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${o.settings?.statsDisplay?.showTicksCumulativeChart?"bg-green-600":"bg-gray-200 dark:bg-gray-600"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${o.settings?.statsDisplay?.showTicksCumulativeChart?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 theme-surface rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-orange-600 dark:text-orange-400",children:"ðŸ’°"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium theme-text",children:l==="fr"?"Analyse des Frais":"Fee Analysis"}),e.jsx("p",{className:"text-xs theme-text-muted",children:l==="fr"?"Commissions, spreads, impact sur la rentabilitÃ©":"Commissions, spreads, impact on profitability"})]})]}),e.jsx("button",{type:"button",onClick:()=>m("settings.statsDisplay.showFeesStats",!o.settings?.statsDisplay?.showFeesStats),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors",style:{backgroundColor:o.settings?.statsDisplay?.showFeesStats?"var(--theme-accent)":"var(--theme-surface)"},children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${o.settings?.statsDisplay?.showFeesStats?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 theme-surface rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-purple-600 dark:text-purple-400",children:"ðŸ“Š"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium theme-text",children:l==="fr"?"Statistiques de Lots":"Lot Statistics"}),e.jsx("p",{className:"text-xs theme-text-muted",children:l==="fr"?"Taille moyenne des positions, lots max, etc.":"Average position size, max lots, etc."})]})]}),e.jsx("button",{type:"button",onClick:()=>m("settings.statsDisplay.showLotsStats",!o.settings?.statsDisplay?.showLotsStats),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors",style:{backgroundColor:o.settings?.statsDisplay?.showLotsStats?"var(--theme-accent)":"var(--theme-surface)"},children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${o.settings?.statsDisplay?.showLotsStats?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 theme-surface rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-indigo-600 dark:text-indigo-400",children:"ðŸ”¬"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium theme-text",children:l==="fr"?"MÃ©triques AvancÃ©es":"Advanced Metrics"}),e.jsx("p",{className:"text-xs theme-text-muted",children:l==="fr"?"Statistiques dÃ©taillÃ©es et mÃ©triques complexes":"Detailed statistics and complex metrics"})]})]}),e.jsx("button",{type:"button",onClick:()=>m("settings.statsDisplay.showAdvancedMetrics",!o.settings?.statsDisplay?.showAdvancedMetrics),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors",style:{backgroundColor:o.settings?.statsDisplay?.showAdvancedMetrics?"var(--theme-accent)":"var(--theme-surface)"},children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${o.settings?.statsDisplay?.showAdvancedMetrics?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 theme-surface rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"theme-text-muted",children:"ðŸ“±"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium theme-text",children:l==="fr"?"Vue Compacte":"Compact View"}),e.jsx("p",{className:"text-xs theme-text-muted",children:l==="fr"?"Interface plus dense avec moins d'espacement":"Denser interface with less spacing"})]})]}),e.jsx("button",{type:"button",onClick:()=>m("settings.statsDisplay.compactView",!o.settings?.statsDisplay?.compactView),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors",style:{backgroundColor:o.settings?.statsDisplay?.compactView?"var(--theme-accent)":"var(--theme-surface)"},children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${o.settings?.statsDisplay?.compactView?"translate-x-6":"translate-x-1"}`})})]})]})]})}),i==="ui"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l==="fr"?"Vue par DÃ©faut":"Default View"}),e.jsxs("select",{value:o.uiSettings?.defaultView,onChange:x=>m("uiSettings.defaultView",x.target.value),className:"w-full px-3 py-2 border theme-border rounded-md focus:outline-none focus:ring-2 focus:ring-theme-accent focus:border-transparent theme-surface theme-text",children:[e.jsx("option",{value:"overview",children:l==="fr"?"Vue d'Ensemble":"Overview"}),e.jsx("option",{value:"stats",children:l==="fr"?"Statistiques":"Statistics"}),e.jsx("option",{value:"trades",children:l==="fr"?"Liste des Trades":"Trades List"}),e.jsx("option",{value:"charts",children:l==="fr"?"Graphiques":"Charts"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:l==="fr"?"Onglet affichÃ© par dÃ©faut Ã  l'ouverture de l'application":"Default tab displayed when opening the application"})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 theme-text theme-surface rounded-md hover:theme-surface transition-colors",children:l==="fr"?"Annuler":"Cancel"}),e.jsxs("button",{type:"submit",className:"flex items-center space-x-2 px-4 py-2 theme-text rounded-md transition-colors",style:{backgroundColor:"var(--theme-accent)"},onMouseEnter:x=>{x.currentTarget.style.backgroundColor="var(--theme-accent-hover)"},onMouseLeave:x=>{x.currentTarget.style.backgroundColor="var(--theme-accent)"},children:[e.jsx(Rt,{size:16}),e.jsx("span",{children:t?l==="fr"?"Modifier":"Update":l==="fr"?"CrÃ©er":"Create"})]})]})]})]})})},dp=({profiles:t,activeProfile:s,onProfileChange:r,onCreateProfile:l,onUpdateProfile:n,onDeleteProfile:o,onClose:a,defaultTab:i="profiles"})=>{const[c,d]=g.useState(i),[u,m]=g.useState(!1),[p,x]=g.useState(null),{currentTheme:f,themes:v,setTheme:h}=Q(),{currentLanguage:b,changeLanguage:j}=Z(),y=()=>{x(null),m(!0)},N=k=>{x(k),m(!0)},w=k=>{p?n(k):l(k),m(!1),x(null)},S=k=>b==="fr"?k==="light"?"Clair":k==="dark"?"Sombre":k==="ultra-dark"?"Ultra Sombre":"ThÃ¨me":k==="light"?"Light":k==="dark"?"Dark":k==="ultra-dark"?"Ultra Dark":"Theme";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-6xl h-[90vh] theme-surface rounded-xl shadow-2xl overflow-hidden",style:{backgroundColor:f.colors.surface},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b theme-border",children:[e.jsx("h1",{className:"text-2xl font-bold theme-text",children:b==="fr"?"ParamÃ¨tres & Profils":"Settings & Profiles"}),e.jsx("button",{onClick:a,className:"p-2 rounded-lg hover:theme-surface transition-colors",children:e.jsx(Ne,{size:24,className:"theme-text"})})]}),e.jsxs("div",{className:"flex space-x-1 p-6 pb-0",children:[e.jsxs("button",{onClick:()=>d("profiles"),className:`flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-colors ${c==="profiles"?"theme-text shadow-sm":"theme-text-muted hover:theme-text"}`,style:{backgroundColor:c==="profiles"?f.colors.accent:"transparent"},children:[e.jsx(Ho,{size:16,className:"mr-2"}),b==="fr"?"Profils":"Profiles"]}),e.jsxs("button",{onClick:()=>d("preferences"),className:`flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-colors ${c==="preferences"?"theme-text shadow-sm":"theme-text-muted hover:theme-text"}`,style:{backgroundColor:c==="preferences"?f.colors.accent:"transparent"},children:[e.jsx(Se,{size:16,className:"mr-2"}),b==="fr"?"PrÃ©fÃ©rences":"Preferences"]}),e.jsxs("button",{onClick:()=>d("advanced"),className:`flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-colors ${c==="advanced"?"theme-text shadow-sm":"theme-text-muted hover:theme-text"}`,style:{backgroundColor:c==="advanced"?f.colors.accent:"transparent"},children:[e.jsx(ms,{size:16,className:"mr-2"}),b==="fr"?"AvancÃ©":"Advanced"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[c==="profiles"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"card rounded-lg shadow-sm p-6 border-2 border-dashed transition-colors cursor-pointer",style:{borderColor:"var(--theme-border)"},onClick:y,onMouseEnter:k=>{k.currentTarget.style.borderColor="var(--theme-accent)"},onMouseLeave:k=>{k.currentTarget.style.borderColor="var(--theme-border)"},children:e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx(Je,{size:24,style:{color:"var(--theme-accent)"}}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium theme-text",children:b==="fr"?"CrÃ©er un nouveau profil":"Create a new profile"}),e.jsx("p",{className:"text-sm theme-text-muted",children:b==="fr"?"Commencer avec un nouveau profil de trading":"Start with a new trading profile"})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(k=>e.jsxs("div",{className:"card rounded-lg shadow-sm p-4 border-2 transition-all cursor-pointer hover:shadow-md",style:{borderColor:s?.id===k.id?f.colors.accent:"var(--theme-border)",backgroundColor:s?.id===k.id?`${f.colors.accent}10`:"transparent"},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:k.color}}),e.jsx("span",{className:"font-medium theme-text",children:k.name}),k.accountType==="demo"&&e.jsx("span",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:`${f.colors.accent}20`,color:f.colors.accent},children:b==="fr"?"DÃ©mo":"Demo"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:C=>{C.stopPropagation(),N(k)},className:"p-1 theme-text-muted transition-colors",style:{color:"var(--theme-text-muted)"},onMouseEnter:C=>{C.currentTarget.style.color="var(--theme-accent)"},onMouseLeave:C=>{C.currentTarget.style.color="var(--theme-text-muted)"},children:e.jsx(tc,{size:16})}),e.jsx("button",{onClick:C=>{C.stopPropagation(),window.confirm(b==="fr"?"Supprimer ce profil ?":"Delete this profile?")&&o(k)},className:"p-1 theme-text-muted transition-colors",style:{color:"var(--theme-text-muted)"},onMouseEnter:C=>{C.currentTarget.style.color="var(--theme-danger)"},onMouseLeave:C=>{C.currentTarget.style.color="var(--theme-text-muted)"},children:e.jsx(Qt,{size:16})})]})]}),e.jsx("p",{className:"text-sm theme-text-muted mb-3 line-clamp-2",children:k.description||(b==="fr"?"Aucune description":"No description")}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm theme-text-muted",children:["Capital:"," ",k.settings.initialCapital.toLocaleString()," ",k.settings.currency]}),s?.id===k.id?e.jsxs("div",{className:"flex items-center space-x-1",style:{color:f.colors.accent},children:[e.jsx(qt,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:b==="fr"?"Actif":"Active"})]}):e.jsx("button",{onClick:C=>{C.stopPropagation(),r(k)},className:"px-3 py-1 text-sm theme-text rounded-md transition-colors",style:{backgroundColor:f.colors.accent,color:f.colors.text},onMouseEnter:C=>{C.currentTarget.style.backgroundColor=f.colors.accentHover},onMouseLeave:C=>{C.currentTarget.style.backgroundColor=f.colors.accent},children:b==="fr"?"Activer":"Activate"})]})]},k.id))})]}),c==="preferences"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card rounded-lg shadow-sm p-6",children:[e.jsxs("h3",{className:"text-lg font-medium theme-text mb-4 flex items-center",children:[e.jsx(_o,{size:20,className:"mr-2"}),b==="fr"?"ThÃ¨me":"Theme"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:v.map(k=>e.jsx("button",{onClick:()=>h(k.id),className:`p-4 rounded-lg border-2 transition-all ${f.id===k.id?"shadow-md":"theme-border hover:theme-border-hover"}`,style:{borderColor:f.id===k.id?f.colors.accent:"var(--theme-border)",backgroundColor:f.id===k.id?`${f.colors.accent}10`:"transparent"},children:e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300",style:{backgroundColor:k.colors.bg}}),e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:k.colors.accent}})]}),e.jsx("span",{className:"font-medium theme-text",children:S(k.id)}),f.id===k.id&&e.jsx(qt,{size:16,className:"ml-auto",style:{color:f.colors.accent}})]})},k.id))})]}),e.jsxs("div",{className:"card rounded-lg shadow-sm p-6",children:[e.jsxs("h3",{className:"text-lg font-medium theme-text mb-4 flex items-center",children:[e.jsx(Wo,{size:20,className:"mr-2"}),b==="fr"?"Langue":"Language"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("button",{onClick:()=>j("fr"),className:`p-4 rounded-lg border-2 transition-all ${b==="fr"?"shadow-md":"theme-border hover:theme-border-hover"}`,style:{borderColor:b==="fr"?f.colors.accent:"var(--theme-border)",backgroundColor:b==="fr"?`${f.colors.accent}10`:"transparent"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ‡«ðŸ‡·"}),e.jsx("span",{className:"font-medium theme-text",children:"FranÃ§ais"}),b==="fr"&&e.jsx(qt,{size:16,className:"mx-auto mt-2",style:{color:f.colors.accent}})]})}),e.jsx("button",{onClick:()=>j("en"),className:`p-4 rounded-lg border-2 transition-all ${b==="en"?"shadow-md":"theme-border hover:theme-border-hover"}`,style:{borderColor:b==="en"?f.colors.accent:"var(--theme-border)",backgroundColor:b==="en"?`${f.colors.accent}10`:"transparent"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ‡¬ðŸ‡§"}),e.jsx("span",{className:"font-medium theme-text",children:"English"}),b==="en"&&e.jsx(qt,{size:16,className:"mx-auto mt-2",style:{color:f.colors.accent}})]})})]})]})]}),c==="advanced"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card rounded-lg shadow-sm p-6",children:[e.jsxs("h3",{className:"text-lg font-medium theme-text mb-4 flex items-center",children:[e.jsx(Te,{size:20,className:"mr-2"}),b==="fr"?"ParamÃ¨tres AvancÃ©s":"Advanced Settings"]}),e.jsx("p",{className:"text-sm theme-text-muted",children:b==="fr"?"Cette section sera dÃ©veloppÃ©e dans les futures versions avec des options avancÃ©es de configuration.":"This section will be developed in future versions with advanced configuration options."})]})})]}),u&&e.jsx(Ra,{profile:p||void 0,onSubmit:w,onClose:()=>{m(!1),x(null)}})]})})},Ta=({settings:t,onSettingsChange:s,onClose:r})=>{const{currentTheme:l}=Q(),{currentLanguage:n}=Z(),[o,a]=g.useState({showDurationStats:t.statsDisplay?.showDurationStats??!0,showTicksStats:t.statsDisplay?.showTicksStats??!0,showTicksCumulativeChart:t.statsDisplay?.showTicksCumulativeChart??!0,showFeesStats:t.statsDisplay?.showFeesStats??!0,showLotsStats:t.statsDisplay?.showLotsStats??!0,showAdvancedMetrics:t.statsDisplay?.showAdvancedMetrics??!1,compactView:t.statsDisplay?.compactView??!1}),i=d=>{a(u=>({...u,[d]:!u[d]}))},c=()=>{const d={...t,statsDisplay:o};s(d),r()};return o.showDurationStats,o.showTicksStats,o.showTicksCumulativeChart,o.showFeesStats,o.showLotsStats,o.showAdvancedMetrics,o.compactView,e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-2xl max-h-[85vh] bg-white dark:bg-gray-800 rounded-xl shadow-2xl overflow-hidden",style:{backgroundColor:l.colors.surface},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h1",{className:"text-xl font-bold theme-text",children:n==="fr"?"Affichage des Statistiques":"Statistics Display"}),e.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx(Ne,{size:20,className:"theme-text"})})]}),e.jsxs("div",{className:"p-4 space-y-3 max-h-[60vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ze,{size:20,className:"text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:n==="fr"?"Statistiques de DurÃ©e":"Duration Statistics"}),e.jsx("div",{className:"text-sm theme-text-muted",children:n==="fr"?"DurÃ©e moyenne, plus court/long trade, etc.":"Average duration, shortest/longest trade, etc."})]})]}),e.jsx("button",{onClick:()=>i("showDurationStats"),className:`w-12 h-6 rounded-full transition-colors ${o.showDurationStats?"bg-blue-600":"theme-surface"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full transition-transform ${o.showDurationStats?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Te,{size:20,className:"text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:n==="fr"?"Statistiques de Ticks":"Ticks Statistics"}),e.jsx("div",{className:"text-sm theme-text-muted",children:n==="fr"?"Ticks capturÃ©s, efficacitÃ©, meilleure capture (scalping)":"Ticks captured, efficiency, better capture (scalping)"})]})]}),e.jsx("button",{onClick:()=>i("showTicksStats"),className:`w-12 h-6 rounded-full transition-colors ${o.showTicksStats?"bg-blue-600":"theme-surface"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full transition-transform ${o.showTicksStats?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-600 bg-green-50 dark:bg-green-900/20",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ae,{size:20,className:"text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:n==="fr"?"Graphique Cumulatif des Ticks":"Cumulative Ticks Chart"}),e.jsx("div",{className:"text-sm theme-text-muted",children:n==="fr"?"Courbe en escalier des ticks cumulÃ©s (idÃ©al pour scalpers)":"Cumulative ticks step curve (ideal for scalpers)"})]})]}),e.jsx("button",{onClick:()=>i("showTicksCumulativeChart"),className:`w-12 h-6 rounded-full transition-colors ${o.showTicksCumulativeChart?"bg-blue-600":"theme-surface"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full transition-transform ${o.showTicksCumulativeChart?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ge,{size:20,className:"text-yellow-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:n==="fr"?"Analyse des Frais":"Fees Analysis"}),e.jsx("div",{className:"text-sm theme-text-muted",children:n==="fr"?"Commissions, spreads, impact sur la rentabilitÃ©":"Commissions, spreads, impact on profitability"})]})]}),e.jsx("button",{onClick:()=>i("showFeesStats"),className:`w-12 h-6 rounded-full transition-colors ${o.showFeesStats?"bg-blue-600":"theme-surface"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full transition-transform ${o.showFeesStats?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(_e,{size:20,className:"text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:n==="fr"?"Statistiques de Lots":"Lots Statistics"}),e.jsx("div",{className:"text-sm theme-text-muted",children:n==="fr"?"Taille moyenne des positions, lots max, etc.":"Average position size, max lots, etc."})]})]}),e.jsx("button",{onClick:()=>i("showLotsStats"),className:`w-12 h-6 rounded-full transition-colors ${o.showLotsStats?"bg-blue-600":"theme-surface"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full transition-transform ${o.showLotsStats?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(hn,{size:20,className:"text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:n==="fr"?"MÃ©triques AvancÃ©es":"Advanced Metrics"}),e.jsx("div",{className:"text-sm theme-text-muted",children:n==="fr"?"Statistiques dÃ©taillÃ©es et mÃ©triques complexes":"Detailed statistics and complex metrics"})]})]}),e.jsx("button",{onClick:()=>i("showAdvancedMetrics"),className:`w-12 h-6 rounded-full transition-colors ${o.showAdvancedMetrics?"bg-blue-600":"theme-surface"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full transition-transform ${o.showAdvancedMetrics?"translate-x-6":"translate-x-1"}`})})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 p-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:n==="fr"?"Annuler":"Cancel"}),e.jsxs("button",{onClick:c,className:"px-4 py-2 bg-blue-600 theme-text rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[e.jsx(Rt,{size:16}),e.jsx("span",{children:n==="fr"?"Modifier":"Save"})]})]})]})})},Le=t=>Array.isArray(t)&&t.length>0,js=t=>t!=null&&t!=="",xt=t=>!!(t&&(js(t.min)||js(t.max))),zs=t=>!!(t&&(js(t.start)||js(t.end))),up=t=>{const s=[];return zs(t.dateRange)&&s.push({section:"time",key:"dateRange"}),zs(t.timeRange)&&s.push({section:"time",key:"timeRange"}),Le(t.sessions)&&s.push({section:"time",key:"sessions"}),Le(t.months)&&s.push({section:"time",key:"months"}),Le(t.weekdays)&&s.push({section:"time",key:"weekdays"}),Le(t.hours)&&s.push({section:"time",key:"hours"}),xt(t.pnlRange)&&s.push({section:"performance",key:"pnlRange"}),xt(t.durationRange)&&s.push({section:"performance",key:"durationRange"}),t.tradeResult&&(t.tradeResult.takeProfit||t.tradeResult.stopLoss||t.tradeResult.breakEven)&&s.push({section:"performance",key:"tradeResult"}),xt(t.feesRange)&&s.push({section:"performance",key:"feesRange"}),Le(t.marketType)&&s.push({section:"market",key:"marketType"}),Le(t.symbols)&&s.push({section:"market",key:"symbols"}),Le(t.strategy)&&s.push({section:"market",key:"strategy"}),Le(t.trend)&&s.push({section:"market",key:"trend"}),Le(t.direction)&&s.push({section:"market",key:"direction"}),Le(t.status)&&s.push({section:"market",key:"status"}),Le(t.timeframe)&&s.push({section:"market",key:"timeframe"}),Le(t.tickEntry)&&s.push({section:"market",key:"tickEntry"}),xt(t.contractsRange)&&s.push({section:"exposure",key:"contractsRange"}),xt(t.lotsRange)&&s.push({section:"exposure",key:"lotsRange"}),Le(t.tags)&&s.push({section:"tags",key:"tags"}),s},mp=t=>{const s=[];if(zs(t.dateRange)&&s.push({id:"dateRange",labelKey:"dateRange",value:`${String(t.dateRange.start)} â†’ ${String(t.dateRange.end)}`}),zs(t.timeRange)&&s.push({id:"timeRange",labelKey:"timeRange",value:`${String(t.timeRange.start)} â†’ ${String(t.timeRange.end)}`}),Le(t.months)&&s.push({id:"months",labelKey:"months",value:t.months.join(", ")}),Le(t.weekdays)&&s.push({id:"weekdays",labelKey:"weekdays",value:t.weekdays.join(", ")}),Le(t.hours)&&s.push({id:"hours",labelKey:"hours",value:t.hours.join(", ")}),Le(t.sessions)&&s.push({id:"sessions",labelKey:"sessions",value:t.sessions.join(", ")}),xt(t.pnlRange)&&s.push({id:"pnlRange",labelKey:"pnl",value:`${String(t.pnlRange.min??"")} â€“ ${String(t.pnlRange.max??"")}`}),xt(t.durationRange)&&s.push({id:"durationRange",labelKey:"duration",value:`${String(t.durationRange.min??"")} â€“ ${String(t.durationRange.max??"")}`}),t.tradeResult&&(t.tradeResult.takeProfit||t.tradeResult.stopLoss||t.tradeResult.breakEven)){const r=[];t.tradeResult.takeProfit&&r.push("TP"),t.tradeResult.stopLoss&&r.push("SL"),t.tradeResult.breakEven&&r.push("BE"),s.push({id:"tradeResult",labelKey:"tradeResult",value:r.join(", ")})}return xt(t.feesRange)&&s.push({id:"feesRange",labelKey:"fees",value:`${String(t.feesRange.min??"")} â€“ ${String(t.feesRange.max??"")}`}),Le(t.marketType)&&s.push({id:"marketType",labelKey:"marketType",value:t.marketType.join(", ")}),Le(t.symbols)&&s.push({id:"symbols",labelKey:"symbols",value:t.symbols.join(", ")}),Le(t.strategy)&&s.push({id:"strategy",labelKey:"strategy",value:t.strategy.join(", ")}),Le(t.trend)&&s.push({id:"trend",labelKey:"trend",value:t.trend.join(", ")}),Le(t.direction)&&s.push({id:"direction",labelKey:"direction",value:t.direction.join(", ")}),Le(t.status)&&s.push({id:"status",labelKey:"status",value:t.status.join(", ")}),Le(t.timeframe)&&s.push({id:"timeframe",labelKey:"timeframe",value:t.timeframe.join(", ")}),Le(t.tickEntry)&&s.push({id:"tickEntry",labelKey:"tickEntry",value:t.tickEntry.join(", ")}),xt(t.contractsRange)&&s.push({id:"contractsRange",labelKey:"contracts",value:`${String(t.contractsRange.min??"")} â€“ ${String(t.contractsRange.max??"")}`}),xt(t.lotsRange)&&s.push({id:"lotsRange",labelKey:"lots",value:`${String(t.lotsRange.min??"")} â€“ ${String(t.lotsRange.max??"")}`}),Le(t.tags)&&s.push({id:"tags",labelKey:"tags",value:t.tags.join(", ")}),s},xp=t=>{const r={...{time:0,performance:0,exposure:0,market:0,tags:0}};return zs(t.dateRange)&&r.time++,zs(t.timeRange)&&r.time++,Le(t.sessions)&&r.time++,Le(t.months)&&r.time++,Le(t.weekdays)&&r.time++,Le(t.hours)&&r.time++,xt(t.pnlRange)&&r.performance++,xt(t.durationRange)&&r.performance++,t.tradeResult&&(t.tradeResult.takeProfit||t.tradeResult.stopLoss||t.tradeResult.breakEven)&&r.performance++,xt(t.feesRange)&&r.performance++,js(t.market)&&(typeof t.market!="string"||t.market!=="all")&&r.market++,js(t.symbol)&&r.market++,Le(t.strategy)&&r.market++,Le(t.trend)&&r.market++,js(t.side)&&r.market++,Le(t.status)&&r.market++,xt(t.contractsRange)&&r.exposure++,xt(t.lotsRange)&&r.exposure++,xt(t.ticksRange)&&r.exposure++,Le(t.tags)&&r.tags++,r},Da=({isOpen:t,onClose:s,activeFilters:r,onNavigateToFilter:l,onResetFilter:n})=>{const{currentLanguage:o}=Z(),{currentTheme:a}=Q();if(!t)return null;const i={time:{light:"text-[#3b82f6]",dark:"text-[#3b82f6]","ultra-dark":"text-[#3b82f6]"},performance:{light:"text-[#16a34a]",dark:"text-[#16a34a]","ultra-dark":"text-[#22c55e]"},exposition:{light:"text-[#ca8a04]",dark:"text-[#ca8a04]","ultra-dark":"text-[#eab308]"},market:{light:"text-[#ea580c]",dark:"text-[#ea580c]","ultra-dark":"text-[#f97316]"},tags:{light:"text-[#4f46e5]",dark:"text-[#4f46e5]","ultra-dark":"text-[#6366f1]"}},c=x=>{const f=a.id,v=i[x];return v&&v[f]||Object.values(v||{})[0]||"text-blue-600"},d={time:e.jsx(ze,{size:20,className:c("time")}),performance:e.jsx(Ae,{size:20,className:c("performance")}),exposition:e.jsx(Mt,{size:20,className:c("exposition")}),market:e.jsx(_e,{size:20,className:c("market")}),tags:e.jsx(ds,{size:20,className:c("tags")})},u={time:o==="fr"?"Temps":"Time",performance:"Performance",exposition:o==="fr"?"Exposition":"Exposure",market:o==="fr"?"MarchÃ©":"Market",tags:"Tags"},m=r.reduce((x,f)=>(x[f.category]||(x[f.category]=[]),x[f.category].push(f),x),{}),p=x=>{l(x.category,x.section),s()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50",onClick:s}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:x=>x.stopPropagation(),children:e.jsxs("div",{className:"w-full max-w-2xl max-h-[80vh] overflow-y-auto rounded-lg shadow-2xl",style:{backgroundColor:a.colors.surface,border:`1px solid ${a.colors.border}`},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b theme-border",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:`${a.colors.accent}20`},children:e.jsx(cs,{size:24,style:{color:a.colors.accent}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold theme-text",children:o==="fr"?"Filtres Actifs":"Active Filters"}),e.jsx("p",{className:"text-sm theme-text-muted",children:o==="fr"?`${r.length} filtre(s) actif(s) - Cliquez pour naviguer`:`${r.length} active filter(s) - Click to navigate`})]})]}),e.jsx("button",{onClick:s,className:"p-2 rounded-lg hover:theme-surface transition-colors",children:e.jsx(Ne,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[Object.entries(m).map(([x,f])=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 pb-2 border-b theme-border",children:[d[x],e.jsx("h3",{className:"text-lg font-semibold theme-text",children:u[x]}),e.jsxs("span",{className:"text-sm theme-text-muted",children:["(",f.length,")"]})]}),e.jsx("div",{className:"space-y-2 pl-8",children:f.map((v,h)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>p(v),className:"flex-1 text-left p-3 rounded-lg hover:theme-surface transition-colors border theme-border group",style:{borderColor:"var(--theme-border)"},onMouseEnter:b=>{b.currentTarget.style.borderColor="var(--theme-accent)"},onMouseLeave:b=>{b.currentTarget.style.borderColor="var(--theme-border)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium theme-text transition-colors",style:{color:"var(--theme-text)"},onMouseEnter:b=>{b.currentTarget.style.color="var(--theme-accent)"},onMouseLeave:b=>{b.currentTarget.style.color="var(--theme-text)"},children:v.description}),e.jsx("div",{className:"text-sm theme-text-muted mt-1",children:v.value})]}),e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity",style:{color:"var(--theme-accent)"},children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})}),e.jsx("button",{onClick:b=>{b.stopPropagation(),n(v.category,v.section)},className:"p-2 rounded-lg transition-colors border group",style:{borderColor:"var(--theme-danger)",backgroundColor:"transparent"},onMouseEnter:b=>{b.currentTarget.style.backgroundColor=`${a.colors.danger}20`,b.currentTarget.style.borderColor=a.colors.danger},onMouseLeave:b=>{b.currentTarget.style.backgroundColor="transparent",b.currentTarget.style.borderColor="var(--theme-danger)"},title:o==="fr"?"RÃ©initialiser ce filtre":"Reset this filter",children:e.jsx("svg",{className:"w-4 h-4 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{color:"var(--theme-danger)"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},`${v.category}-${v.section}-${h}`))})]},x)),r.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"theme-text-muted mb-2",children:e.jsx(cs,{size:48,className:"mx-auto"})}),e.jsx("p",{className:"theme-text-muted",children:o==="fr"?"Aucun filtre actif":"No active filters"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t theme-border",children:[e.jsx("div",{className:"text-sm theme-text-muted",children:o==="fr"?"Cliquez sur un filtre pour naviguer vers sa section":"Click on a filter to navigate to its section"}),e.jsx("button",{onClick:s,className:"px-4 py-2 theme-surface theme-text rounded-lg hover:theme-surface transition-colors",children:o==="fr"?"Fermer":"Close"})]})]})})]})},fp={dateRange:"dateRange",timeRange:"hoursTimeRange",sessions:"sessions",months:"months",weekdays:"weekdays",hours:"hours",symbol:"marketType",strategy:"strategies",trend:"trend",side:"direction",status:"status",market:"marketType",pnlRange:"pnl",durationRange:"duration",tradeResult:"tradeResult",feesRange:"fees",contractsRange:"contracts",lotsRange:"lots",ticksRange:"ticks",tags:"tags"};function pp(t){const[s,r]=g.useState(!1),[l,n]=g.useState(!1),[o,a]=g.useState(!1),i=g.useRef({isCollapsed:!1,isPinned:!1,isHovering:!1}),c=g.useRef(!1);g.useEffect(()=>{i.current={isCollapsed:s,isPinned:o,isHovering:l}},[s,o,l]),g.useEffect(()=>{if(t&&!c.current&&(r(!1),n(!1),a(!1)),c.current){const m=setTimeout(()=>{c.current=!1},100);return()=>clearTimeout(m)}},[t]);const d=g.useCallback(()=>{c.current=!0,r(m=>!m)},[]),u=g.useCallback(()=>{r(!1),n(!0),a(!1),setTimeout(()=>{r(!0),n(!1)},2e3)},[]);return{isCollapsed:s,isHovering:l,isPinned:o,setIsCollapsed:r,setIsHovering:n,setIsPinned:a,isTogglingRef:c,toggleOpen:d,forcePreviewThenCollapse:u}}const hp=()=>{const[t,s]=g.useState({dateRange:!0,timeRange:!0,weekdays:!0,months:!0,hours:!0,hoursMain:!0,hoursTimeRange:!0,sessions:!0,contracts:!0,marketType:!0,symbols:!0,strategies:!0,trendDirection:!0,status:!0,timeframeTick:!0,pnl:!0,duration:!0,tradeResult:!0,fees:!0,lots:!0,ticks:!0,tags:!0}),r=g.useCallback(d=>{s(u=>({...u,[d]:!u[d]}))},[]),l=g.useCallback(()=>{const d=["dateRange","timeRange","weekdays","months","hours","hoursMain","hoursTimeRange","sessions"];s(u=>{const m=d.every(x=>u[x]),p={...u};return d.forEach(x=>{p[x]=!m}),p})},[]),n=g.useCallback(()=>{const d=["marketType","symbols","strategies","trendDirection","status","timeframeTick"];s(u=>{const m=d.every(x=>u[x]),p={...u};return d.forEach(x=>{p[x]=!m}),p})},[]),o=g.useCallback(()=>{const d=["pnl","duration","tradeResult","fees"];s(u=>{const m=d.every(x=>u[x]),p={...u};return d.forEach(x=>{p[x]=!m}),p})},[]),a=g.useCallback(()=>{const d=["contracts","lots","ticks"];s(u=>{const m=d.every(x=>u[x]),p={...u};return d.forEach(x=>{p[x]=!m}),p})},[]),i=g.useCallback(()=>{const d=["tags"];s(u=>{const m=d.every(x=>u[x]),p={...u};return d.forEach(x=>{p[x]=!m}),p})},[]),c=g.useCallback((d,u)=>{s(m=>{const p={...m};return Object.keys(p).forEach(x=>{p[x]=!0}),p[d]=!1,u&&(p[u]=!1),p})},[]);return{collapsedSections:t,toggleSection:r,toggleAllTimeSections:l,toggleAllMarketSections:n,toggleAllPerformanceSections:o,toggleAllExpositionSections:a,toggleAllTagsSections:i,openExclusiveSection:c}},gp={time:{light:"text-[#2563eb]",dark:"text-[#2563eb]","ultra-dark":"text-[#3b82f6]"},performance:{light:"text-[#16a34a]",dark:"text-[#16a34a]","ultra-dark":"text-[#22c55e]"},exposition:{light:"text-[#ca8a04]",dark:"text-[#ca8a04]","ultra-dark":"text-[#eab308]"},market:{light:"text-[#ea580c]",dark:"text-[#ea580c]","ultra-dark":"text-[#f97316]"},tags:{light:"text-[#4f46e5]",dark:"text-[#4f46e5]","ultra-dark":"text-[#6366f1]"}},bo={time:{light:{base:"#1e40af",borderInactive:"#2563eb",borderHover:"#3b82f6"},dark:{base:"#1e40af",borderInactive:"#2563eb",borderHover:"#3b82f6"},"ultra-dark":{base:"#1e3a8a",borderInactive:"#1d4ed8",borderHover:"#3b82f6"}},market:{light:{base:"#9a3412",borderInactive:"#ea580c",borderHover:"#ea580c"},dark:{base:"#9a3412",borderInactive:"#ea580c",borderHover:"#ea580c"},"ultra-dark":{base:"#7c2d12",borderInactive:"#ea580c",borderHover:"#ea580c"}},performance:{light:{base:"#14532d",borderInactive:"#16a34a",borderHover:"#22c55e"},dark:{base:"#14532d",borderInactive:"#16a34a",borderHover:"#22c55e"},"ultra-dark":{base:"#14532d",borderInactive:"#16a34a",borderHover:"#22c55e"}},exposition:{light:{base:"#a16207",borderInactive:"#ca8a04",borderHover:"#eab308"},dark:{base:"#a16207",borderInactive:"#ca8a04",borderHover:"#eab308"},"ultra-dark":{base:"#7a5c00",borderInactive:"#ca8a04",borderHover:"#eab308"}},tags:{light:{base:"#4338ca",borderInactive:"#6366f1",borderHover:"#4f46e5"},dark:{base:"#4338ca",borderInactive:"#6366f1",borderHover:"#4f46e5"},"ultra-dark":{base:"#3730a3",borderInactive:"#6366f1",borderHover:"#4f46e5"}}},jr=(t,s)=>{const r=t.replace("#",""),l=parseInt(r,16),n=l>>16&255,o=l>>8&255,a=l&255;return`rgba(${n}, ${o}, ${a}, ${s})`},yp=(t,s)=>{const r=gp[t];return r&&r[s]||Object.values(r||{})[0]||"text-blue-600"},bp=(t,s,r)=>{const l=bo[t]&&bo[t][s]||bo.time.light,n=r?jr(l.base,.2):jr(l.base,.1),o=r?jr(l.base,.3):jr(l.base,.15),a=r?l.borderHover:l.borderInactive,i=l.borderHover;return{"--card-bg":n,"--card-bg-hover":o,"--card-border":a,"--card-border-hover":i}},vp=({isCollapsed:t,isPinned:s,currentLanguage:r,currentTheme:l,filteredTradesCount:n,activeFilterCount:o,globalSearchTerm:a,showSearchSuggestions:i,searchSuggestions:c,onToggleCollapse:d,onClose:u,onOpenActiveFilters:m,onChangeSearch:p,onSearchFocus:x,onSearchBlur:f,onClickSuggestion:v,getSectionTextColor:h})=>e.jsxs("div",{className:"flex items-center justify-between p-4 border-b theme-border",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:`${l.colors.border}20`},children:e.jsx(cs,{size:24})}),!t&&e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h2",{className:"text-lg font-bold theme-text",children:r==="fr"?"Filtres":"Filters"}),s&&e.jsxs("div",{className:"px-2 py-1 rounded-full text-xs font-medium flex items-center space-x-1 border border-green-400",style:{border:"1px solid #4ade80"},children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),e.jsx("span",{children:r==="fr"?"Ã‰pinglÃ©":"Pinned"})]})]}),e.jsx("p",{className:"text-sm theme-text-muted",children:s?r==="fr"?"Mode filtres Ã©pinglÃ© (reste ouvert)":"Pinned filter mode (stays open)":r==="fr"?"Mode filtres actif":"Filter mode active"})]}),e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 theme-surface rounded-lg border theme-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-xs font-medium theme-text-secondary",children:[n.filtered,"/",n.total]}),e.jsx("span",{className:"text-xs theme-text-muted",children:r==="fr"?"trades filtrÃ©s":"filtered trades"})]}),e.jsxs("div",{className:"text-xs font-bold theme-text-secondary",children:[n.percentage,"%"]})]}),e.jsxs("button",{onClick:m,className:`flex items-center space-x-2 px-3 py-2 rounded-lg border transition-all duration-200 cursor-pointer group ${o>0?l.id==="ultra-dark"?"bg-indigo-900/20 border-indigo-800 hover:bg-indigo-900/30 hover:border-indigo-500 hover:shadow-md hover:ring-2 hover:ring-indigo-800":l.id==="dark"?"bg-blue-900/20 border-blue-800 hover:bg-blue-900/30 hover:border-blue-500 hover:shadow-md hover:ring-2 hover:ring-blue-800":"bg-blue-50 border-blue-200 hover:bg-blue-100 hover:border-blue-400 hover:shadow-md hover:ring-2 hover:ring-blue-200":l.id==="ultra-dark"?"theme-surface border theme-border hover:theme-surface hover:shadow-sm hover:border-indigo-600 hover:ring-1 hover:ring-indigo-800":l.id==="dark"?"theme-surface border theme-border hover:theme-surface hover:shadow-sm hover:border-blue-600 hover:ring-1 hover:ring-blue-800":"theme-surface border theme-border hover:theme-surface hover:shadow-sm hover:border-blue-300 hover:ring-1 hover:ring-blue-200"}`,children:[e.jsx(Se,{size:14,className:`transition-colors ${o>0?l.id==="ultra-dark"?"text-indigo-400 group-hover:text-indigo-300":l.id==="dark"?"text-blue-400 group-hover:text-blue-300":"text-blue-600 group-hover:text-blue-700":"theme-text-muted group-hover:theme-text-secondary"}`}),e.jsx("span",{className:`text-xs font-medium transition-colors ${o>0?l.id==="ultra-dark"?"text-indigo-300 group-hover:text-indigo-200":l.id==="dark"?"text-blue-300 group-hover:text-blue-200":"text-blue-700 group-hover:text-blue-800":"theme-text-secondary group-hover:theme-text"}`,children:o}),e.jsx("span",{className:`text-xs transition-colors ${o>0?l.id==="ultra-dark"?"text-indigo-400 group-hover:text-indigo-300":l.id==="dark"?"text-blue-400 group-hover:text-blue-300":"text-blue-600 group-hover:text-blue-700":"theme-text-muted group-hover:theme-text-secondary"}`,children:r==="fr"?"filtres actifs":"active filters"})]}),e.jsxs("div",{className:"relative flex-1 max-w-xs",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:r==="fr"?"Rechercher un filtre...":"Search filter...",value:a,onChange:b=>p(b.target.value),onFocus:x,onBlur:f,className:"w-full pl-8 pr-3 py-2 text-xs border rounded-lg focus:outline-none transition-all",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text}}),e.jsx(vt,{size:14,className:"absolute left-2.5 top-1/2 transform -translate-y-1/2 theme-text-muted"})]}),i&&c.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 theme-surface border theme-border rounded-lg shadow-lg z-60 max-h-48 overflow-y-auto",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border},children:c.map((b,j)=>e.jsxs("button",{onClick:()=>v(b),className:"w-full text-left px-3 py-2 text-xs hover:theme-surface transition-colors border-b theme-border last:border-b-0 flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-1",children:[b.type==="category"?e.jsx(cs,{size:12,className:"theme-text-muted"}):e.jsx(vt,{size:12,className:h("time")}),e.jsx("span",{className:"theme-text font-medium",children:b.title})]}),e.jsx("span",{className:"text-xs theme-text-muted",children:b.type==="category"?r==="fr"?"CatÃ©gorie":"Category":r==="fr"?"Filtre":"Filter"})]},`${b.category}-${b.section}-${j}`))})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:d,className:`p-2 rounded-lg transition-all duration-200 ${s?"border-2 border-green-400 hover:border-green-500":"border border-gray-300 hover:border-green-400 hover:bg-green-50 dark:border-gray-600 dark:hover:border-green-400 dark:hover:bg-green-900/20"}`,style:s?{border:"2px solid #4ade80"}:{border:"1px solid var(--theme-border)"},title:s?r==="fr"?"DÃ©sÃ©pingler (se ferme au hover)":"Unpin (closes on hover)":r==="fr"?"Ã‰pingler (reste ouvert)":"Pin (stays open)",children:s?e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),e.jsx(as,{size:16})]}):e.jsx(as,{size:20})}),e.jsx("button",{onClick:u,className:"p-2 rounded-lg hover:theme-surface transition-colors",title:r==="fr"?"Fermer":"Close",children:e.jsx(Ne,{size:20})})]})]}),jp=({categories:t,activeCategory:s,onSelect:r,cardBaseClasses:l,getCategoryCardVars:n})=>e.jsx("div",{className:"grid grid-cols-5 gap-2",children:t.map(o=>e.jsx("button",{onClick:()=>r(o.id),className:`p-3 text-center focus:outline-none focus:ring-0 focus-visible:outline-none focus-visible:ring-0 ${l}`,style:{...n(o.id,s===o.id),clipPath:"polygon(8px 0%, 100% 0%, calc(100% - 8px) 100%, 0% 100%)"},children:e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[o.icon,e.jsx("span",{className:"text-xs font-medium",children:o.label})]})},o.id))}),Np=t=>{const[s,r]=g.useState({});return g.useEffect(()=>{const n={};Array.from(new Set(t.map(a=>a.market))).forEach(a=>{n[a]=!0}),r(n)},[t]),{collapsedMarkets:s,toggleMarket:n=>{r(o=>({...o,[n]:!o[n]}))}}},kp=({currentLanguage:t,filteredTradesCount:s})=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm theme-text-muted",children:t==="fr"?"Filtres actifs":"Active filters"}),e.jsx("div",{className:"w-3 h-3 bg-green-800 rounded-full"})]}),e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-1.5 rounded-lg border-2 border-green-500/30 hover:border-green-500/50 transition-all duration-200 bg-transparent hover:bg-green-500/5",children:[e.jsx("span",{className:"text-xs font-semibold text-green-600 dark:text-green-400",children:s.filtered}),e.jsx("span",{className:"text-xs font-medium text-green-500 dark:text-green-400",children:"trades"})]})]}),wp=({currentTheme:t,currentLanguage:s,activeCategory:r,filters:l,filteredTradesCount:n,onFiltersChange:o})=>e.jsx("div",{className:"p-4 border-t theme-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{className:"flex items-center space-x-2 px-3 py-2 rounded-lg border transition-colors",style:{backgroundColor:t.colors.surface,color:t.colors.text,borderColor:t.colors.border},onClick:()=>{r==="market"?o({...l,symbol:[],strategy:[],side:[],status:[],trend:[],timeframe:[],tickEntry:[]}):r==="time"?o({...l,dateRange:{start:"",end:""},timeRange:{start:"",end:""},weekdays:[],months:[],hours:[],sessions:[]}):r==="performance"?o({...l,pnlRange:{min:void 0,max:void 0},pnlUnit:"euro",durationRange:{min:void 0,max:void 0},durationUnit:void 0,feesRange:{min:void 0,max:void 0},tradeResult:void 0}):r==="exposition"?o({...l,contractsRange:{min:void 0,max:void 0},lotsRange:{min:void 0,max:void 0},ticksRange:{min:void 0,max:void 0}}):r==="tags"&&o({...l,tags:[]})},title:s==="fr"?"RÃ©initialiser la catÃ©gorie":"Reset category",children:[e.jsx(Ne,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:r==="time"?s==="fr"?"Temps":"Time":r==="market"?s==="fr"?"MarchÃ©":"Market":r==="performance"?"Performance":r==="exposition"?s==="fr"?"Exposition":"Exposure":"Tags"})]}),e.jsxs("button",{className:"flex items-center space-x-2 px-3 py-2 rounded-lg border transition-colors",style:{backgroundColor:t.colors.surface,color:t.colors.text,borderColor:t.colors.border},onClick:()=>o({}),title:s==="fr"?"RÃ©initialiser tout":"Reset all",children:[e.jsx(Ne,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:s==="fr"?"Tout":"All"})]})]}),e.jsx(kp,{currentLanguage:s,filteredTradesCount:n})]})}),Sp=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center h-full space-y-4",children:[e.jsx(cs,{size:24,className:"text-blue-600"}),e.jsx("div",{className:"w-2 h-2 bg-green-800 rounded-full"}),e.jsx(as,{size:16,className:"theme-text-muted"})]}),Cp=t=>{const s={"text-blue-600":{text:"text-blue-600",hover:"hover:text-blue-600",groupHover:"group-hover:text-blue-600"},"text-green-600":{text:"text-green-600",hover:"hover:text-green-600",groupHover:"group-hover:text-green-600"},"text-yellow-600":{text:"text-yellow-600",hover:"hover:text-yellow-600",groupHover:"group-hover:text-yellow-600"},"text-orange-600":{text:"text-orange-600",hover:"hover:text-orange-600",groupHover:"group-hover:text-orange-600"},"text-indigo-600":{text:"text-indigo-600",hover:"hover:text-indigo-600",groupHover:"group-hover:text-indigo-600"}};return t.includes("text-[#")?{text:t,hover:t,groupHover:t}:s[t]||{text:t,hover:`hover:${t}`,groupHover:`group-hover:text-${t.replace("text-","")}`}},et=({title:t,icon:s,color:r,isCollapsed:l,onToggle:n,onReset:o,onToggleAll:a,areAllSubsectionsOpen:i,children:c})=>{const{currentLanguage:d}=Z(),u=Cp(r);return(()=>{if(r.includes("text-[#")){const p=r.match(/text-\[#([a-fA-F0-9]{6})\]/);if(p)return{color:`#${p[1]}`}}return{}})(),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:n,className:`flex items-center space-x-2 text-sm font-medium theme-text transition-colors ${r.includes("text-[#")?"":u.hover}`,onMouseEnter:p=>{if(r.includes("text-[#")){const x=r.match(/text-\[#([a-fA-F0-9]{6})\]/);x&&(p.currentTarget.style.color=`#${x[1]}`)}},onMouseLeave:p=>{r.includes("text-[#")&&(p.currentTarget.style.color="")},children:[l?e.jsx($e,{size:16}):e.jsx(it,{size:16}),s,e.jsx("span",{children:t})]}),a&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:"absolute top-0 left-0 white-chevron",children:e.jsx("button",{onClick:a,className:"p-1 rounded",title:d==="fr"?"DÃ©plier/Replier toutes les sous-catÃ©gories":"Expand/Collapse all sub-categories",children:i?e.jsx("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJtMTcgMTEtNS01LTUgNSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48cGF0aCBkPSJtMTcgMTgtNS01LTUgNSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",width:"14",height:"14",alt:"Chevrons Up"}):e.jsx("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJtNyAxMyA1IDUgNS01IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjxwYXRoIGQ9Im03IDYgNSA1IDUtNSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",width:"14",height:"14",alt:"Chevrons Down"})})}),e.jsx("div",{className:"colored-chevron opacity-0",children:e.jsx("button",{onClick:a,className:"p-1 rounded",title:d==="fr"?"DÃ©plier/Replier toutes les sous-catÃ©gories":"Expand/Collapse all sub-categories",children:i?e.jsx("img",{src:`data:image/svg+xml;base64,${btoa(`<svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="m17 11-5-5-5 5" stroke="${r==="text-blue-600"?"#2563eb":r==="text-green-600"?"#16a34a":r==="text-yellow-600"?"#ca8a04":r==="text-orange-600"?"#ea580c":r==="text-purple-600"?"#9333ea":"#2563eb"}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="m17 18-5-5-5 5" stroke="${r==="text-blue-600"?"#2563eb":r==="text-green-600"?"#16a34a":r==="text-yellow-600"?"#ca8a04":r==="text-orange-600"?"#ea580c":r==="text-purple-600"?"#9333ea":"#2563eb"}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`)}`,width:"14",height:"14",alt:"Chevrons Up"}):e.jsx("img",{src:`data:image/svg+xml;base64,${btoa(`<svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="m7 13 5 5 5-5" stroke="${r==="text-blue-600"?"#2563eb":r==="text-green-600"?"#16a34a":r==="text-yellow-600"?"#ca8a04":r==="text-orange-600"?"#ea580c":r==="text-purple-600"?"#9333ea":"#2563eb"}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="m7 6 5 5 5-5" stroke="${r==="text-blue-600"?"#2563eb":r==="text-green-600"?"#16a34a":r==="text-yellow-600"?"#ca8a04":r==="text-orange-600"?"#ea580c":r==="text-purple-600"?"#9333ea":"#2563eb"}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`)}`,width:"14",height:"14",alt:"Chevrons Down"})})}),e.jsx("style",{children:`
                .white-chevron {
                  z-index: 1;
                  transition: opacity 0.2s;
                }
                .colored-chevron {
                  z-index: 2;
                  transition: opacity 0.2s;
                }
                .relative:hover .white-chevron {
                  opacity: 0;
                }
                .relative:hover .colored-chevron {
                  opacity: 1;
                }
              `})]})]}),e.jsx("button",{onClick:o,className:`text-xs transition-colors ${r.includes("text-[#")?"":u.text}`,style:r.includes("text-[#")?{color:r.replace("text-[","").replace("]","")}:{},onMouseEnter:p=>{if(r.includes("text-[#")){const x=r.match(/text-\[#([a-fA-F0-9]{6})\]/);x&&(p.currentTarget.style.color=`#${x[1]}`,p.currentTarget.style.opacity="0.8")}},onMouseLeave:p=>{if(r.includes("text-[#")){const x=r.match(/text-\[#([a-fA-F0-9]{6})\]/);x&&(p.currentTarget.style.color=`#${x[1]}`,p.currentTarget.style.opacity="")}},children:d==="fr"?"RÃ©initialiser":"Reset"})]}),!l&&e.jsx("div",{className:"pl-6",children:c})]})},Pp=({value:t,onChange:s,collapsedSections:r,toggleSection:l,onToggleAllTimeSections:n})=>{const{currentLanguage:o}=Z(),{currentTheme:a}=Q(),i={time:{light:"text-[#2563eb]",dark:"text-[#2563eb]","ultra-dark":"text-[#3b82f6]"},performance:{light:"text-[#16a34a]",dark:"text-[#16a34a]","ultra-dark":"text-[#22c55e]"}},c=p=>{const x=a.id,f=i[p];return f&&f[x]||Object.values(f||{})[0]||"text-blue-600"},d=[{id:"january",label:{fr:"Janvier",en:"January"}},{id:"february",label:{fr:"FÃ©vrier",en:"February"}},{id:"march",label:{fr:"Mars",en:"March"}},{id:"april",label:{fr:"Avril",en:"April"}},{id:"may",label:{fr:"Mai",en:"May"}},{id:"june",label:{fr:"Juin",en:"June"}},{id:"july",label:{fr:"Juillet",en:"July"}},{id:"august",label:{fr:"AoÃ»t",en:"August"}},{id:"september",label:{fr:"Septembre",en:"September"}},{id:"october",label:{fr:"Octobre",en:"October"}},{id:"november",label:{fr:"Novembre",en:"November"}},{id:"december",label:{fr:"DÃ©cembre",en:"December"}}],u=[{id:"monday",label:{fr:"Lun",en:"Mon"}},{id:"tuesday",label:{fr:"Mar",en:"Tue"}},{id:"wednesday",label:{fr:"Mer",en:"Wed"}},{id:"thursday",label:{fr:"Jeu",en:"Thu"}},{id:"friday",label:{fr:"Ven",en:"Fri"}},{id:"saturday",label:{fr:"Sam",en:"Sat"}},{id:"sunday",label:{fr:"Dim",en:"Sun"}}],m=[{id:"asia",label:{fr:"Session Asie",en:"Asia Session"},color:"bg-purple-800/5",timeRange:{fr:"0h-8h UTC",en:"0h-8h UTC"}},{id:"eu",label:{fr:"Session EU",en:"EU Session"},color:"bg-blue-800/5",timeRange:{fr:"8h-14h UTC",en:"8h-14h UTC"}},{id:"overlap",label:{fr:"Overlap EU-US",en:"EU-US Overlap"},color:"bg-orange-700/5",timeRange:{fr:"14h-16h UTC",en:"14h-16h UTC"}},{id:"us",label:{fr:"Session US",en:"US Session"},color:"bg-green-800/5",timeRange:{fr:"14h-21h UTC",en:"21h-24h UTC"}},{id:"close",label:{fr:"ClÃ´ture US",en:"US Close"},color:"bg-red-700/5",timeRange:{fr:"21h-24h UTC",en:"21h-24h UTC"}}];return e.jsxs("div",{className:"space-y-6",style:{maxHeight:"calc(100vh - 350px)",overflowY:"auto"},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h3",{className:"text-lg font-semibold theme-text flex items-center",children:[e.jsx(yt,{size:20,className:`mr-2 ${c("time")}`}),o==="fr"?"Filtres Temporels":"Time Filters"]}),e.jsx("button",{onClick:n,className:"p-1.5 rounded-lg hover:theme-surface transition-colors group",title:o==="fr"?"DÃ©plier/Replier toutes les sous-catÃ©gories":"Expand/Collapse all sub-categories",children:(()=>{const x=["dateRange","timeRange","weekdays","months","hours","hoursMain","hoursTimeRange","sessions"].every(h=>!r[h]),f=c("time"),v=f==="text-blue-600"?"#2563eb":f==="text-green-600"?"#16a34a":f==="text-yellow-600"?"#ca8a04":f==="text-orange-600"?"#ea580c":f==="text-purple-600"?"#9333ea":"#2563eb";return x?e.jsx(ar,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:h=>{h.currentTarget.style.color=v},onMouseOut:h=>{h.currentTarget.style.color="white"}}):e.jsx(lr,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:h=>{h.currentTarget.style.color=v},onMouseOut:h=>{h.currentTarget.style.color="white"}})})()})]}),e.jsx("p",{className:"text-sm theme-text-muted mb-4",children:o==="fr"?"Filtres par date, heure, jour de la semaine et mois":"Filters by date, time, weekday and month"}),e.jsxs(et,{title:o==="fr"?"Plages de Dates":"Date Ranges",icon:e.jsx(yt,{size:16,className:`${c("time")}`}),color:c("time"),isCollapsed:r.dateRange,onToggle:()=>l("dateRange"),onReset:()=>s({dateRange:{start:"",end:""}}),children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-medium theme-text-muted mb-2",children:o==="fr"?"Presets rapides":"Quick presets"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"7d",label:"7j",days:7},{key:"30d",label:"30j",days:30},{key:"3m",label:"3m",days:90},{key:"6m",label:"6m",days:180},{key:"1a",label:"1a",days:365}].map(p=>{const x=(()=>{if(!t.dateRange?.start||!t.dateRange?.end)return!1;const f=new Date,v=new Date;v.setDate(f.getDate()-p.days);const h=new Date(t.dateRange.start),b=new Date(t.dateRange.end);return h.toDateString()===v.toDateString()&&b.toDateString()===f.toDateString()})();return e.jsx("button",{onClick:()=>{const f=new Date,v=new Date;v.setDate(f.getDate()-p.days),s({dateRange:{start:v.toISOString().split("T")[0],end:f.toISOString().split("T")[0]}})},className:`px-3 py-2 text-xs font-medium rounded-lg transition-all ${x?"bg-blue-800 theme-text shadow-md":"hover:theme-surface theme-text border theme-border"}`,children:p.label},p.key)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium theme-text-muted mb-2",children:o==="fr"?"DÃ©but":"Start"}),e.jsx(gs,{id:"date-start-input",value:t.dateRange?.start||"",onChange:p=>{console.log("ðŸ—“ï¸ TimeSection onChange received:",p),s({dateRange:{start:p,end:t.dateRange?.end||""}})},placeholder:o==="fr"?"jj/mm/aaaa":"mm/dd/yyyy",size:"compact",className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text,fontSize:"14px",paddingLeft:"12px",paddingRight:"80px"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium theme-text-muted mb-2",children:o==="fr"?"Fin":"End"}),e.jsx(gs,{id:"date-end-input",value:t.dateRange?.end||"",onChange:p=>s({dateRange:{start:t.dateRange?.start||"",end:p}}),placeholder:o==="fr"?"jj/mm/aaaa":"mm/dd/yyyy",size:"compact",className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text,fontSize:"14px",paddingLeft:"12px",paddingRight:"80px"}})]})]})]}),e.jsx(et,{title:o==="fr"?"Mois":"Months",icon:e.jsx(yt,{size:16,className:`${c("time")}`}),color:c("time"),isCollapsed:r.months,onToggle:()=>l("months"),onReset:()=>s({months:[]}),children:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[0,1,2].map(p=>e.jsx("div",{className:"flex flex-col gap-2",children:[0,1,2,3].map(x=>{const f=p*4+x,v=d[f];return e.jsx("button",{onClick:()=>{const h=t.months||[],b=h.includes(v.id)?h.filter(j=>j!==v.id):[...h,v.id];s({months:b})},className:`p-2 text-xs font-medium rounded-lg transition-all ${(t.months||[]).includes(v.id)?"bg-blue-800 theme-text shadow-md":"hover:theme-surface theme-text"}`,children:v.label[o]},v.id)})},p))})}),e.jsx(et,{title:o==="fr"?"Jours de la Semaine":"Weekdays",icon:e.jsx(yt,{size:16,className:`${c("time")}`}),color:c("time"),isCollapsed:r.weekdays,onToggle:()=>l("weekdays"),onReset:()=>s({weekdays:[]}),children:e.jsx("div",{className:"grid grid-cols-7 gap-2",children:u.map(p=>e.jsx("button",{onClick:()=>{const x=t.weekdays||[],f=x.includes(p.id)?x.filter(v=>v!==p.id):[...x,p.id];s({weekdays:f})},className:`p-2 text-xs font-medium rounded-lg transition-all ${(t.weekdays||[]).includes(p.id)?"bg-blue-800 theme-text shadow-md":"hover:theme-surface theme-text"}`,children:p.label[o]},p.id))})}),e.jsxs(et,{title:o==="fr"?"Heures":"Hours",icon:e.jsx(ze,{size:16,className:`${c("time")}`}),color:c("time"),isCollapsed:r.hoursMain,onToggle:()=>l("hoursMain"),onReset:()=>{s({timeRange:{start:"",end:""},hours:[]})},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>l("hoursTimeRange"),className:"flex items-center space-x-2 text-sm font-medium theme-text hover:text-green-600 transition-colors",children:[r.hoursTimeRange?e.jsx($e,{size:16,className:"text-green-500"}):e.jsx(it,{size:16,className:"text-green-500"}),e.jsx(ze,{size:16,className:`${c("performance")}`}),e.jsx("span",{children:o==="fr"?"Plage Horaire":"Time Range"})]}),e.jsx("button",{onClick:()=>s({timeRange:{start:"",end:""}}),className:"text-xs text-green-500 hover:text-green-600 transition-colors",children:o==="fr"?"RÃ©initialiser":"Reset"})]}),!r.hoursTimeRange&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 pl-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium theme-text-muted mb-2",children:o==="fr"?"DÃ©but":"Start"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"time-start-input",type:"time",value:t.timeRange?.start||"",onChange:p=>s({timeRange:{start:p.target.value,end:t.timeRange?.end||""}}),className:"w-full pr-12 pl-4 py-3 text-base border rounded-lg focus:outline-none transition-all cursor-pointer theme-border ring-performance",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text}}),e.jsxs("button",{type:"button",onClick:()=>{const p=document.getElementById("time-start-input");p&&p.showPicker()},className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center space-x-1 p-1 rounded-md hover:theme-surface transition-colors cursor-pointer",children:[e.jsx(ze,{size:18,className:`${c("performance")}`}),e.jsx($e,{size:14,className:"text-green-400"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium theme-text-muted mb-2",children:o==="fr"?"Fin":"End"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"time-end-input",type:"time",value:t.timeRange?.end||"",onChange:p=>s({timeRange:{start:t.timeRange?.start||"",end:p.target.value}}),className:"w-full pr-12 pl-4 py-3 text-base border rounded-lg focus:outline-none transition-all cursor-pointer theme-border ring-performance",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text}}),e.jsxs("button",{type:"button",onClick:()=>{const p=document.getElementById("time-end-input");p&&p.showPicker()},className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center space-x-1 p-1 rounded-md hover:theme-surface transition-colors cursor-pointer",children:[e.jsx(ze,{size:18,className:`${c("performance")}`}),e.jsx($e,{size:14,className:"text-green-400"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>l("hoursMain"),className:"flex items-center space-x-2 text-sm font-medium theme-text hover:text-orange-600 transition-colors",children:[r.hoursMain?e.jsx($e,{size:16,className:"text-orange-500"}):e.jsx(it,{size:16,className:"text-orange-500"}),e.jsx(ze,{size:16,className:"text-orange-500"}),e.jsx("span",{children:o==="fr"?"Heures (Alternative Rapide)":"Hours (Quick Alternative)"})]}),e.jsx("button",{onClick:()=>s({hours:[]}),className:"text-xs text-orange-500 hover:text-orange-600 transition-colors",children:o==="fr"?"RÃ©initialiser":"Reset"})]}),!r.hoursMain&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-medium theme-text-muted mb-2 flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full mr-2"}),o==="fr"?"Matin":"Morning"]}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:Array.from({length:12},(p,x)=>e.jsxs("button",{onClick:()=>{const f=t.hours||[],v=f.includes(x)?f.filter(h=>h!==x):[...f,x];s({hours:v})},className:`p-2 text-xs font-medium rounded-lg transition-all ${(t.hours||[]).includes(x)?"bg-blue-800 theme-text shadow-md":"hover:theme-surface theme-text border theme-border"}`,children:[x,":00"]},x))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-medium theme-text-muted mb-2 flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-400 rounded-full mr-2"}),o==="fr"?"AprÃ¨s-midi":"Afternoon"]}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:Array.from({length:12},(p,x)=>{const f=x+12;return e.jsxs("button",{onClick:()=>{const v=t.hours||[],h=v.includes(f)?v.filter(b=>b!==f):[...v,f];s({hours:h})},className:`p-2 text-xs font-medium rounded-lg transition-all ${(t.hours||[]).includes(f)?"bg-orange-700/70 theme-text shadow-md":"hover:theme-surface theme-text border theme-border"}`,children:[f,":00"]},f)})})]})]})})]})]}),e.jsx(et,{title:o==="fr"?"Sessions de Trading":"Trading Sessions",icon:e.jsx(ze,{size:16,className:`${c("time")}`}),color:c("time"),isCollapsed:r.sessions,onToggle:()=>l("sessions"),onReset:()=>s({sessions:[]}),children:e.jsx("div",{className:"grid grid-cols-5 gap-2",children:m.map(p=>e.jsx("button",{onClick:()=>{const x=t.sessions||[],f=x.includes(p.id)?x.filter(v=>v!==p.id):[...x,p.id];s({sessions:f})},className:`p-3 rounded-lg transition-all duration-200 text-center transform hover:scale-105 ${(t.sessions||[]).includes(p.id)?`${p.color} theme-text shadow-lg`:"hover:theme-surface theme-text"}`,style:(()=>{if((t.sessions||[]).includes(p.id))switch(p.id){case"asia":return{borderTop:"2px solid #9333ea",borderBottom:"2px solid #9333ea"};case"eu":return{borderTop:"2px solid #2563eb",borderBottom:"2px solid #2563eb"};case"overlap":return{borderTop:"2px solid #ea580c",borderBottom:"2px solid #ea580c"};case"us":return{borderTop:"2px solid #16a34a",borderBottom:"2px solid #16a34a"};case"close":return{borderTop:"2px solid #dc2626",borderBottom:"2px solid #dc2626"};default:return{}}return{}})(),children:e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${(t.sessions||[]).includes(p.id)?"theme-surface":p.color}`}),e.jsx("div",{className:"text-xs font-medium",children:p.label[o]}),e.jsx("div",{className:"text-[10px] theme-text-muted",children:p.timeRange[o]})]})},p.id))})})]})},Mp=V.memo(Pp),vo=({minValue:t,maxValue:s,onMinChange:r,onMaxChange:l,minPlaceholder:n,maxPlaceholder:o,minLabel:a,maxLabel:i,step:c="0.01"})=>{const{currentTheme:d}=Q(),u=m=>{if(m==null)return;const p=String(m);if(p==="")return;let x=p.replace(",",".");x.endsWith(".")&&(x+="0");const f=parseFloat(x);return Number.isNaN(f)?void 0:f};return e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 theme-text-muted",children:a}),e.jsx("input",{type:"number",step:c,placeholder:n,value:t!==void 0?t:"",onChange:m=>r(u(m.target.value)),className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none transition-all ring-performance",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.text}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 theme-text-muted",children:i}),e.jsx("input",{type:"number",step:c,placeholder:o,value:s!==void 0?s:"",onChange:m=>l(u(m.target.value)),className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none transition-all ring-performance",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.text}})]})]})},Rp=({value:t,onChange:s,collapsedSections:r,toggleSection:l,onToggleAllPerformanceSections:n})=>{const{currentLanguage:o}=Z(),{currentTheme:a}=Q(),i={performance:{light:"text-[#16a34a]",dark:"text-[#16a34a]","ultra-dark":"text-[#22c55e]"}},c=u=>{const m=a.id,p=i[u];return p&&p[m]||Object.values(p||{})[0]||"text-green-600"},d=[{id:"seconds",label:{fr:"Secondes",en:"Seconds"}},{id:"minutes",label:{fr:"Minutes",en:"Minutes"}},{id:"hours",label:{fr:"Heures",en:"Hours"}},{id:"days",label:{fr:"Jours",en:"Days"}}];return e.jsxs("div",{className:"space-y-6",style:{maxHeight:"calc(100vh - 350px)",overflowY:"auto"},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h3",{className:"text-lg font-semibold theme-text flex items-center",children:[e.jsx(Ae,{size:20,className:`mr-2 ${c("performance")}`}),o==="fr"?"Filtres de Performance":"Performance Filters"]}),e.jsx("button",{onClick:n,className:"p-1.5 rounded-lg hover:theme-surface transition-colors group",title:o==="fr"?"DÃ©plier/Replier toutes les sous-catÃ©gories":"Expand/Collapse all sub-categories",children:(()=>{const m=["pnl","duration","tradeResult","fees"].every(f=>!r[f]),p=c("performance"),x=p==="text-[#16a34a]"?"#16a34a":p==="text-[#22c55e]"?"#22c55e":"#16a34a";return m?e.jsx(ar,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:f=>{f.currentTarget.style.color=x},onMouseOut:f=>{f.currentTarget.style.color="white"}}):e.jsx(lr,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:f=>{f.currentTarget.style.color=x},onMouseOut:f=>{f.currentTarget.style.color="white"}})})()})]}),e.jsx("p",{className:"text-sm theme-text-muted mb-4",children:o==="fr"?"Filtres par P&L, durÃ©e, rÃ©sultat du trade et frais":"Filters by P&L, duration, trade result and fees"}),e.jsx(et,{title:o==="fr"?"Gains & Pertes":"Profit & Loss",icon:e.jsx(Ae,{size:16,className:`${c("performance")}`}),color:c("performance"),isCollapsed:r.pnl,onToggle:()=>l("pnl"),onReset:()=>s({pnlRange:void 0}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("button",{onClick:()=>s({pnlUnit:"euro",pnlRange:void 0}),className:`px-3 py-1.5 text-xs font-medium rounded-lg transition-all ${(t.pnlUnit||"euro")==="euro"?"bg-green-800 theme-text shadow-md border border-green-700":"theme-surface theme-text-muted border theme-border hover:theme-surface"}`,children:"â‚¬ Euro"}),e.jsx("button",{onClick:()=>s({pnlUnit:"percent",pnlRange:void 0}),className:`px-3 py-1.5 text-xs font-medium rounded-lg transition-all ${(t.pnlUnit||"euro")==="percent"?"bg-green-800 theme-text shadow-md border border-green-700":"theme-surface theme-text-muted border theme-border hover:theme-surface"}`,children:"% Pourcentage"})]}),e.jsx(vo,{minValue:t.pnlRange?.min,maxValue:t.pnlRange?.max,onMinChange:u=>s({pnlRange:{min:u,max:t.pnlRange?.max}}),onMaxChange:u=>s({pnlRange:{min:t.pnlRange?.min,max:u}}),minPlaceholder:o==="fr"?`Entrez la valeur min ${t.pnlUnit==="percent"?"%":"â‚¬"}...`:`Enter min value ${t.pnlUnit==="percent"?"%":"â‚¬"}...`,maxPlaceholder:o==="fr"?`Entrez la valeur max ${t.pnlUnit==="percent"?"%":"â‚¬"}...`:`Enter max value ${t.pnlUnit==="percent"?"%":"â‚¬"}...`,minLabel:"Min",maxLabel:"Max",step:"0.01"})]})}),e.jsx(et,{title:o==="fr"?"RÃ©sultat du Trade":"Trade Result",icon:e.jsx(Qa,{size:16,className:`${c("performance")}`}),color:c("performance"),isCollapsed:r.tradeResult,onToggle:()=>l("tradeResult"),onReset:()=>s({tradeResult:void 0}),children:e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium mb-2 theme-text-muted",children:o==="fr"?"Type de sortie":"Exit Type"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("button",{onClick:()=>s({tradeResult:{takeProfit:!t.tradeResult?.takeProfit,stopLoss:t.tradeResult?.stopLoss||!1,breakEven:t.tradeResult?.breakEven||!1}}),className:`p-2 text-xs font-medium rounded-lg transition-all ${t.tradeResult?.takeProfit?"bg-green-800 theme-text shadow-md":"hover:theme-surface theme-text border theme-border"}`,children:"TP"}),e.jsx("button",{onClick:()=>s({tradeResult:{takeProfit:t.tradeResult?.takeProfit||!1,stopLoss:!t.tradeResult?.stopLoss,breakEven:t.tradeResult?.breakEven||!1}}),className:`p-2 text-xs font-medium rounded-lg transition-all ${t.tradeResult?.stopLoss?"bg-red-700/70 theme-text shadow-md":"hover:theme-surface theme-text border theme-border"}`,children:"SL"}),e.jsx("button",{onClick:()=>s({tradeResult:{takeProfit:t.tradeResult?.takeProfit||!1,stopLoss:t.tradeResult?.stopLoss||!1,breakEven:!t.tradeResult?.breakEven}}),className:`p-2 text-xs font-medium rounded-lg transition-all ${t.tradeResult?.breakEven?"bg-yellow-500/65 theme-text shadow-md":"hover:theme-surface theme-text border theme-border"}`,children:"BE"})]})]})})}),e.jsx(et,{title:o==="fr"?"Frais":"Fees",icon:e.jsx(Ge,{size:16,className:`${c("performance")}`}),color:c("performance"),isCollapsed:r.fees,onToggle:()=>l("fees"),onReset:()=>s({feesRange:void 0}),children:e.jsx("div",{className:"space-y-4",children:e.jsx(vo,{minValue:t.feesRange?.min,maxValue:t.feesRange?.max,onMinChange:u=>s({feesRange:{min:u,max:t.feesRange?.max}}),onMaxChange:u=>s({feesRange:{min:t.feesRange?.min,max:u}}),minPlaceholder:o==="fr"?"Entrez les frais min...":"Enter min fees...",maxPlaceholder:o==="fr"?"Entrez les frais max...":"Enter max fees...",minLabel:"Min",maxLabel:"Max",step:"0.01"})})}),e.jsx(et,{title:o==="fr"?"DurÃ©e des Trades":"Trade Duration",icon:e.jsx(ze,{size:16,className:`${c("performance")}`}),color:c("performance"),isCollapsed:r.duration,onToggle:()=>l("duration"),onReset:()=>s({durationRange:void 0,durationUnit:void 0}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-2 theme-text-muted",children:o==="fr"?"UnitÃ© de temps":"Time Unit"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:d.map(u=>e.jsx("button",{onClick:()=>s({durationUnit:u.id,durationRange:void 0}),className:`px-3 py-1.5 text-xs font-medium rounded-lg transition-all ${t.durationUnit===u.id?"bg-green-800 theme-text shadow-md":"hover:theme-surface theme-text border theme-border"}`,children:u.label[o]},u.id))})]}),t.durationUnit&&(()=>{const u=t.durationUnit,m=Pa[u],{isValid:p,errors:x}=rp(t.durationRange?.min,t.durationRange?.max,u);return e.jsxs("div",{className:"space-y-2",children:[e.jsx(vo,{minValue:t.durationRange?.min,maxValue:t.durationRange?.max,onMinChange:f=>s({durationRange:{min:f,max:t.durationRange?.max}}),onMaxChange:f=>s({durationRange:{min:t.durationRange?.min,max:f}}),minPlaceholder:o==="fr"?`Min (${m.min}â€“${m.max})`:`Min (${m.min}â€“${m.max})`,maxPlaceholder:o==="fr"?`Max (${m.min}â€“${m.max})`:`Max (${m.min}â€“${m.max})`,minLabel:"Min",maxLabel:"Max",step:u==="seconds"?"1":"0.01"}),!p&&e.jsx("div",{className:"text-xs text-red-400",children:x.map((f,v)=>e.jsx("div",{children:f},v))})]})})()]})})]})},Tp=V.memo(Rp),Dp=({value:t,onChange:s,collapsedSections:r,toggleSection:l,onToggleAllExpositionSections:n})=>{const{currentLanguage:o}=Z(),{currentTheme:a}=Q(),i={exposition:{light:"text-[#ca8a04]",dark:"text-[#ca8a04]","ultra-dark":"text-[#eab308]"}},c=d=>{const u=a.id,m=i[d];return m&&m[u]||Object.values(m||{})[0]||"text-yellow-600"};return e.jsxs("div",{className:"space-y-6",style:{maxHeight:"calc(100vh - 350px)",overflowY:"auto"},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h3",{className:"text-lg font-semibold theme-text flex items-center",children:[e.jsx(Mt,{size:20,className:`mr-2 ${c("exposition")}`}),o==="fr"?"Filtres d'Exposition":"Exposure Filters"]}),e.jsx("button",{onClick:n,className:"p-1.5 rounded-lg hover:theme-surface transition-colors group",title:o==="fr"?"DÃ©plier/Replier toutes les sous-catÃ©gories":"Expand/Collapse all sub-categories",children:(()=>{const u=["contracts","lots","ticks"].every(x=>!r[x]),m=c("exposition"),p=m==="text-[#ca8a04]"?"#ca8a04":m==="text-[#eab308]"?"#eab308":"#ca8a04";return u?e.jsx(ar,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:x=>{x.currentTarget.style.color=p},onMouseOut:x=>{x.currentTarget.style.color="white"}}):e.jsx(lr,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:x=>{x.currentTarget.style.color=p},onMouseOut:x=>{x.currentTarget.style.color="white"}})})()})]}),e.jsx("p",{className:"text-sm theme-text-muted mb-4",children:o==="fr"?"Filtres par contrats, lots, ticks et valeur du tick":"Filters by contracts, lots, ticks and tick value"}),e.jsx(et,{title:o==="fr"?"Contrats EngagÃ©s":"Contracts Engaged",icon:e.jsx(Mt,{size:16,className:`${c("exposition")}`}),color:c("exposition"),isCollapsed:r.contracts,onToggle:()=>l("contracts"),onReset:()=>s({contractsRange:void 0}),children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 theme-text-muted",children:"Min"}),e.jsx("input",{type:"number",step:"1",placeholder:"Entrez la valeur min...",value:t.contractsRange?.min!==void 0&&t.contractsRange?.min!==null?t.contractsRange.min:"",onChange:d=>s({contractsRange:{min:d.target.value?parseInt(d.target.value):void 0,max:t.contractsRange?.max??void 0}}),className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none transition-all theme-border ring-exposition",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 theme-text-muted",children:"Max"}),e.jsx("input",{type:"number",step:"1",placeholder:"Entrez la valeur max...",value:t.contractsRange?.max!==void 0&&t.contractsRange?.max!==null?t.contractsRange.max:"",onChange:d=>s({contractsRange:{min:t.contractsRange?.min??void 0,max:d.target.value?parseInt(d.target.value):void 0}}),className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none transition-all theme-border ring-exposition",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text}})]})]})}),e.jsx(et,{title:"Lots",icon:e.jsx(Mt,{size:16,className:`${c("exposition")}`}),color:c("exposition"),isCollapsed:r.lots,onToggle:()=>l("lots"),onReset:()=>s({lotsRange:void 0}),children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 theme-text-muted",children:"Min"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Entrez la valeur min...",value:t.lotsRange?.min!==void 0&&t.lotsRange?.min!==null?t.lotsRange.min:"",onChange:d=>s({lotsRange:{min:d.target.value?parseFloat(d.target.value):void 0,max:t.lotsRange?.max??void 0}}),className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none transition-all theme-border ring-exposition",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 theme-text-muted",children:"Max"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Entrez la valeur max...",value:t.lotsRange?.max!==void 0&&t.lotsRange?.max!==null?t.lotsRange.max:"",onChange:d=>s({lotsRange:{min:t.lotsRange?.min??void 0,max:d.target.value?parseFloat(d.target.value):void 0}}),className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none transition-all theme-border ring-exposition",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text}})]})]})}),e.jsx(et,{title:"Ticks",icon:e.jsx(Mt,{size:16,className:`${c("exposition")}`}),color:c("exposition"),isCollapsed:r.ticks,onToggle:()=>l("ticks"),onReset:()=>s({ticksRange:void 0}),children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 theme-text-muted",children:"Min"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Entrez la valeur min...",value:t.ticksRange?.min!==void 0&&t.ticksRange?.min!==null?t.ticksRange.min:"",onChange:d=>s({ticksRange:{min:d.target.value?parseFloat(d.target.value):void 0,max:t.ticksRange?.max??void 0}}),className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none transition-all theme-border ring-exposition",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 theme-text-muted",children:"Max"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Entrez la valeur max...",value:t.ticksRange?.max!==void 0&&t.ticksRange?.max!==null?t.ticksRange.max:"",onChange:d=>s({ticksRange:{min:t.ticksRange?.min??void 0,max:d.target.value?parseFloat(d.target.value):void 0}}),className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none transition-all theme-border ring-exposition",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text}})]})]})})]})},Fp=V.memo(Dp),Ep=[{id:"bullish",label:{fr:"HaussiÃ¨re",en:"Bullish"},color:"bg-green-800"},{id:"bearish",label:{fr:"BaissiÃ¨re",en:"Bearish"},color:"bg-red-700/70"},{id:"sideways",label:{fr:"LatÃ©rale",en:"Sideways"},color:"bg-yellow-600"}],Ap=[{id:"long",label:{fr:"Long",en:"Long"},color:"bg-green-800"},{id:"short",label:{fr:"Short",en:"Short"},color:"bg-red-700/70"}],Lp=[{id:"open",label:{fr:"Ouvert",en:"Open"},color:"bg-green-800"},{id:"closed",label:{fr:"FermÃ©",en:"Closed"},color:"bg-red-700/70"}],$p=[{id:"10ticks",label:{fr:"10ticks",en:"10ticks"},color:"bg-purple-600"},{id:"25ticks",label:{fr:"25ticks",en:"25ticks"},color:"bg-purple-600"},{id:"50ticks",label:{fr:"50ticks",en:"50ticks"},color:"bg-blue-600"},{id:"100ticks",label:{fr:"100ticks",en:"100ticks"},color:"bg-blue-600"},{id:"200ticks",label:{fr:"200ticks",en:"200ticks"},color:"bg-green-600"},{id:"500ticks",label:{fr:"500ticks",en:"500ticks"},color:"bg-green-600"},{id:"1000ticks",label:{fr:"1000ticks",en:"1000ticks"},color:"bg-orange-600"},{id:"2000ticks",label:{fr:"2000ticks",en:"2000ticks"},color:"bg-orange-600"}],Yn={forex:"bg-blue-800",futures:"bg-green-800",stocks:"bg-purple-800",crypto:"bg-pink-700",indices:"bg-indigo-700",commodities:"bg-orange-700/70"},zp={forex:{fr:"Forex",en:"Forex"},futures:{fr:"Futures",en:"Futures"},stocks:{fr:"Actions",en:"Stocks"},crypto:{fr:"Crypto",en:"Crypto"},indices:{fr:"Indices",en:"Indices"},commodities:{fr:"MatiÃ¨res PremiÃ¨res",en:"Commodities"}},Ip=({value:t,onChange:s,availableTrades:r,availableStrategies:l,availableTimeframes:n,availableTickEntries:o,collapsedSections:a,collapsedMarkets:i,toggleSection:c,toggleMarket:d,onToggleAllMarketSections:u})=>{const{currentLanguage:m}=Z(),{currentTheme:p}=Q(),x=()=>p.id==="ultra-dark"?"text-[#f97316]":"text-[#ea580c]",f=g.useMemo(()=>{const v={};return r.forEach(h=>{const b=h.market;v[b]=v[b]||[],h.symbol&&!v[b].includes(h.symbol)&&v[b].push(h.symbol)}),Object.keys(v).forEach(h=>{v[h]=v[h].sort((b,j)=>b.localeCompare(j))}),v},[r]);return e.jsxs("div",{className:"space-y-6",style:{maxHeight:"calc(100vh - 350px)",overflowY:"auto"},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h3",{className:"text-lg font-semibold theme-text flex items-center",children:[e.jsx(_e,{size:20,className:`mr-2 ${x()}`}),m==="fr"?"Filtres de MarchÃ© & Trading":"Market & Trading Filters"]}),e.jsx("button",{onClick:u,className:"p-1.5 rounded-lg hover:theme-surface transition-colors group",title:m==="fr"?"DÃ©plier/Replier toutes les sous-catÃ©gories":"Expand/Collapse all sub-categories",children:(()=>{const h=["marketType","symbols","strategies","direction","status","trend"].every(y=>!a[y]),j=x()==="text-[#ea580c]"?"#ea580c":"#f97316";return h?e.jsx(ar,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:y=>{y.currentTarget.style.color=j},onMouseOut:y=>{y.currentTarget.style.color="white"}}):e.jsx(lr,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:y=>{y.currentTarget.style.color=j},onMouseOut:y=>{y.currentTarget.style.color="white"}})})()})]}),e.jsx("p",{className:"text-sm theme-text-muted mb-4",children:m==="fr"?"Filtres par type de marchÃ©, symboles, stratÃ©gies, tendance, direction, statut et timeframe":"Filters by market type, symbols, strategies, trend, direction, status and timeframe"}),e.jsx(et,{title:m==="fr"?"Types de MarchÃ© & Symboles":"Market Types & Symbols",icon:e.jsx(_e,{size:16,className:`${x()}`}),color:x(),isCollapsed:a.marketType,onToggle:()=>c("marketType"),onReset:()=>s({symbols:[]}),children:e.jsx("div",{className:"space-y-4",children:["forex","indices","futures","crypto","stocks","commodities"].map(v=>{const h=f[v]||[];return h.length===0?null:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("button",{onClick:()=>d(v),className:"flex items-center space-x-2 hover:opacity-80 transition-opacity",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${Yn[v]}`}),e.jsx("h4",{className:"text-sm font-medium theme-text capitalize",children:zp[v]?.[m]||v.charAt(0).toUpperCase()+v.slice(1)}),e.jsxs("span",{className:"text-xs theme-text-muted",children:["(",h.length,")"]}),i[v]?e.jsx($e,{size:14}):e.jsx(it,{size:14})]})}),!i[v]&&e.jsx("div",{className:"grid grid-cols-3 gap-2 pl-4",children:h.map(b=>e.jsx("button",{onClick:()=>{const j=Array.isArray(t.symbols)||t.symbols?t.symbols:[],y=j.includes(b)?j.filter(N=>N!==b):[...j,b];s({symbols:y})},className:`p-2 text-xs font-medium rounded-lg transition-all ${Array.isArray(t.symbols)&&t.symbols.includes(b)?`${Yn[v]} theme-text shadow-md`:"hover:theme-surface theme-text"}`,children:b},b))})]},v)})})}),e.jsx(et,{title:m==="fr"?"StratÃ©gies":"Strategies",icon:e.jsx(Ae,{size:16,className:`${x()}`}),color:x(),isCollapsed:a.strategies,onToggle:()=>c("strategies"),onReset:()=>s({strategy:[]}),children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:l.map(v=>e.jsx("button",{onClick:()=>{const h=Array.isArray(t.strategy)||t.strategy?t.strategy:[],b=h.includes(v)?h.filter(j=>j!==v):[...h,v];s({strategy:b})},className:`p-2 text-xs font-medium rounded-lg transition-all ${Array.isArray(t.strategy)&&t.strategy.includes(v)?"bg-orange-700/70 theme-text shadow-md":"hover:theme-surface theme-text"}`,children:v},v))})}),e.jsx(et,{title:m==="fr"?"Tendance & Direction":"Trend & Direction",icon:e.jsx(Ae,{size:16,className:`${x()}`}),color:x(),isCollapsed:a.trendDirection,onToggle:()=>c("trendDirection"),onReset:()=>s({trend:[],direction:[]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-medium theme-text flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),m==="fr"?"Tendance":"Trend"]}),e.jsx("button",{onClick:()=>s({trend:[]}),className:"text-xs text-green-500 hover:text-green-600 transition-colors",children:m==="fr"?"RÃ©initialiser":"Reset"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 pl-4",children:Ep.map(v=>e.jsx("button",{onClick:()=>{const h=t.trend||[],b=h.includes(v.id)?h.filter(j=>j!==v.id):[...h,v.id];s({trend:b})},className:`p-2 text-xs font-medium rounded-lg transition-all ${(t.trend||[]).includes(v.id)?`${v.color} theme-text shadow-md`:"hover:theme-surface theme-text"}`,children:v.label[m]},v.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-medium theme-text flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-2"}),"Direction"]}),e.jsx("button",{onClick:()=>s({direction:[]}),className:"text-xs text-blue-500 hover:text-blue-600 transition-colors",children:m==="fr"?"RÃ©initialiser":"Reset"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 pl-4",children:Ap.map(v=>e.jsx("button",{onClick:()=>{const h=Array.isArray(t.direction)||t.direction?t.direction:[],b=h.includes(v.id)?h.filter(j=>j!==v.id):[...h,v.id];s({direction:b})},className:`p-2 text-xs font-medium rounded-lg transition-all ${Array.isArray(t.direction)&&t.direction.includes(v.id)?`${v.color} theme-text shadow-md`:"hover:theme-surface theme-text"}`,children:v.label[m]},v.id))})]})]})}),e.jsx(et,{title:"Timeframe/Tick",icon:e.jsx(Ae,{size:16,className:`${x()}`}),color:x(),isCollapsed:a.timeframeTick,onToggle:()=>c("timeframeTick"),onReset:()=>s({timeframe:[],tickEntry:[]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>c("timeframe"),className:"flex items-center space-x-2 text-sm font-medium theme-text hover:text-purple-600 transition-colors",children:[a.timeframe?e.jsx($e,{size:16,className:"text-purple-500"}):e.jsx(it,{size:16,className:"text-purple-500"}),e.jsx(Ae,{size:16,className:"text-purple-500"}),e.jsx("span",{children:"Timeframe"})]}),e.jsx("button",{onClick:()=>s({timeframe:[]}),className:"text-xs text-purple-500 hover:text-purple-600 transition-colors",children:m==="fr"?"RÃ©initialiser":"Reset"})]}),!a.timeframe&&e.jsx("div",{className:"grid grid-cols-4 gap-2 pl-6",children:n.length>0?n.map(v=>{const h=b=>b.includes("s")?"bg-purple-600":b.includes("m")?"bg-blue-600":b.includes("h")?"bg-green-600":b.includes("d")?"bg-orange-600":b.includes("w")||b.includes("M")?"bg-red-600":"bg-gray-600";return e.jsx("button",{onClick:()=>{const b=Array.isArray(t.timeframe)||t.timeframe?t.timeframe:[],j=b.includes(v)?b.filter(y=>y!==v):[...b,v];s({timeframe:j})},className:`p-2 text-xs font-medium rounded-lg transition-all ${Array.isArray(t.timeframe)&&t.timeframe.includes(v)?`${h(v)} theme-text shadow-md`:"hover:theme-surface theme-text"}`,children:v},v)}):e.jsx("div",{className:"col-span-4 text-center text-sm theme-text-muted py-4",children:m==="fr"?"Aucun timeframe trouvÃ© dans vos trades":"No timeframes found in your trades"})}),o&&o.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>c("tickEntry"),className:"flex items-center space-x-2 text-sm font-medium theme-text hover:text-cyan-600 transition-colors",children:[a.tickEntry?e.jsx($e,{size:16,className:"text-cyan-500"}):e.jsx(it,{size:16,className:"text-cyan-500"}),e.jsx(Ae,{size:16,className:"text-cyan-500"}),e.jsx("span",{children:m==="fr"?"Ticks d'EntrÃ©e":"Entry Ticks"})]}),e.jsx("button",{onClick:()=>s({tickEntry:[]}),className:"text-xs text-cyan-500 hover:text-cyan-600 transition-colors",children:m==="fr"?"RÃ©initialiser":"Reset"})]}),!a.tickEntry&&e.jsx("div",{className:"grid grid-cols-4 gap-2 pl-6",children:$p.map(v=>e.jsx("button",{onClick:()=>{const h=Array.isArray(t.tickEntry)||t.tickEntry?t.tickEntry:[],b=h.includes(v.id)?h.filter(j=>j!==v.id):[...h,v.id];s({tickEntry:b})},className:`p-2 text-xs font-medium rounded-lg transition-all ${Array.isArray(t.tickEntry)&&t.tickEntry.includes(v.id)?`${v.color} theme-text shadow-md`:"hover:theme-surface theme-text"}`,children:v.label[m]},v.id))})]})]})}),e.jsx(et,{title:m==="fr"?"Statut":"Status",icon:e.jsx(Ps,{size:16,className:`${x()}`}),color:x(),isCollapsed:a.status,onToggle:()=>c("status"),onReset:()=>s({status:[]}),children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Lp.map(v=>e.jsx("button",{onClick:()=>{const h=Array.isArray(t.status)||t.status?t.status:[],b=h.includes(v.id)?h.filter(j=>j!==v.id):[...h,v.id];s({status:b})},className:`p-2 text-xs font-medium rounded-lg transition-all ${Array.isArray(t.status)&&t.status.includes(v.id)?`${v.color} theme-text shadow-md`:"hover:theme-surface theme-text"}`,children:v.label[m]},v.id))})})]})},Op=V.memo(Ip),qp=({value:t,onChange:s,availableTags:r,popularTags:l,collapsedSections:n,toggleSection:o,onToggleAllTagsSections:a})=>{const{currentLanguage:i}=Z(),{currentTheme:c}=Q(),d=()=>"text-[#4f46e5]",u=V.useMemo(()=>{const m=(t.tagSearch||"").trim();if(!m)return r;const p=m.toLowerCase();return r.length>200?r.filter(x=>x.toLowerCase().includes(p)):r.filter(x=>x.includes(m))},[r,t.tagSearch]);return e.jsxs("div",{className:"space-y-4",style:{maxHeight:"calc(100vh - 350px)",overflowY:"auto"},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h3",{className:"text-lg font-semibold theme-text flex items-center",children:[e.jsx(ds,{size:20,className:`mr-2 ${d()}`}),i==="fr"?"Filtrage par Tags":"Filter by Tags"]}),e.jsx("button",{onClick:a,className:"p-1.5 rounded-lg hover:theme-surface transition-colors group",title:i==="fr"?"DÃ©plier/Replier toutes les sous-catÃ©gories":"Expand/Collapse all sub-categories",children:(()=>{const p=["tags","tagSearch"].every(f=>!n[f]),x="#9333ea";return p?e.jsx(ar,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:f=>{f.currentTarget.style.color=x},onMouseOut:f=>{f.currentTarget.style.color="white"}}):e.jsx(lr,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:f=>{f.currentTarget.style.color=x},onMouseOut:f=>{f.currentTarget.style.color="white"}})})()})]}),e.jsx("p",{className:"text-sm theme-text-muted",children:i==="fr"?"SÃ©lectionnez les tags pour filtrer vos trades":"Select tags to filter your trades"}),e.jsx(et,{title:"Tags",icon:e.jsx(ds,{size:16,className:`${d()}`}),color:d(),isCollapsed:n.tags,onToggle:()=>o("tags"),onReset:()=>s({tags:void 0}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-2 theme-text-muted",children:i==="fr"?"Rechercher un tag":"Search for a tag"}),e.jsx("input",{type:"text",placeholder:i==="fr"?"Tapez pour rechercher...":"Type to search...",value:t.tagSearch||"",onChange:m=>s({tagSearch:m.target.value}),className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none transition-all theme-border ring-tags",style:{backgroundColor:c.colors.surface,borderColor:c.colors.border,color:c.colors.text}})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:u.map(m=>e.jsx("button",{onClick:()=>{const p=t.tags||[],x=p.includes(m)?p.filter(f=>f!==m):[...p,m];s({tags:x.length>0?x:void 0})},className:`p-2 text-xs font-medium rounded-lg transition-all ${(t.tags||[]).includes(m)?"bg-indigo-700/70 theme-text shadow-md":"hover:theme-surface theme-text"}`,children:m},m))}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium theme-text-muted mb-2",children:i==="fr"?"Tags populaires":"Popular tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.map(m=>e.jsx("button",{onClick:()=>{const p=t.tags||[],x=p.includes(m)?p.filter(f=>f!==m):[...p,m];s({tags:x.length>0?x:void 0})},className:`px-3 py-1.5 text-xs font-medium rounded-lg transition-all ${(t.tags||[]).includes(m)?"bg-indigo-700/70 theme-text shadow-md":"hover:theme-surface theme-text border theme-border"}`,children:m},m))})]})]})})]})},Up=V.memo(qp),Wp=({activeCategory:t,filters:s,onFiltersChange:r,collapsedSections:l,toggleSection:n,availableTrades:o,availableStrategies:a,availableTimeframes:i,availableTickEntries:c,symbolsByMarket:d,toggleAll:u,collapsedMarkets:m,toggleMarket:p,availableTags:x,popularTags:f})=>{const v=h=>{const b={...s,...h};r(b)};return e.jsxs("div",{className:"flex-1 p-4",children:[t==="time"&&e.jsx(Mp,{value:{dateRange:s.dateRange,months:s.months,weekdays:s.weekdays,hours:s.hours,timeRange:s.timeRange,sessions:s.sessions},onChange:v,collapsedSections:l,toggleSection:n,onToggleAllTimeSections:u.time}),t==="performance"&&e.jsx(Tp,{value:{pnlRange:s.pnlRange,pnlUnit:s.pnlUnit,durationRange:s.durationRange,durationUnit:s.durationUnit,tradeResult:s.tradeResult,feesRange:s.feesRange},onChange:h=>r({...s,...h}),collapsedSections:l,toggleSection:n,onToggleAllPerformanceSections:u.performance}),t==="exposition"&&e.jsx(Fp,{value:{contractsRange:s.contractsRange,lotsRange:s.lotsRange,ticksRange:s.ticksRange},onChange:h=>r({...s,...h}),collapsedSections:l,toggleSection:n,onToggleAllExpositionSections:u.exposition}),t==="market"&&e.jsx(Op,{value:{symbols:Array.isArray(s.symbol)?s.symbol:s.symbol?[s.symbol]:[],strategy:Array.isArray(s.strategy)?s.strategy:s.strategy?[s.strategy]:[],direction:Array.isArray(s.side)?s.side:s.side?[s.side]:[],status:Array.isArray(s.status)?s.status:s.status?[s.status]:[],trend:s.trend,timeframe:Array.isArray(s.timeframe)?s.timeframe:s.timeframe?[s.timeframe]:[],tickEntry:Array.isArray(s.tickEntry)?s.tickEntry:s.tickEntry?[s.tickEntry]:[]},onChange:h=>{const b={};h.symbols!==void 0&&(b.symbol=h.symbols),h.strategy!==void 0&&(b.strategy=h.strategy),h.direction!==void 0&&(b.side=h.direction),h.status!==void 0&&(b.status=h.status),h.trend!==void 0&&(b.trend=h.trend),h.timeframe!==void 0&&(b.timeframe=h.timeframe),h.tickEntry!==void 0&&(b.tickEntry=h.tickEntry),r(ep({...s,...b}))},availableTrades:o,availableStrategies:a,availableTimeframes:i,availableTickEntries:c,collapsedSections:l,collapsedMarkets:m,toggleSection:n,toggleMarket:p,onToggleAllMarketSections:u.market}),t==="tags"&&e.jsx(Up,{value:{tags:s.tags,tagSearch:void 0},onChange:h=>r({...s,...h}),availableTags:x,popularTags:f,collapsedSections:l,toggleSection:n,onToggleAllTagsSections:u.tags})]})},_p=({isOpen:t,onToggle:s,filters:r,onFiltersChange:l,availableStrategies:n,availableTags:o,availableTimeframes:a,availableTickEntries:i,availableTrades:c,navigationRequest:d,onNavigationComplete:u})=>{const{currentTheme:m}=Q(),{currentLanguage:p,t:x}=Z(),f=W=>{const K=m.id;return yp(W,K)},v=(W,K)=>{const ue=m.id;return bp(W,ue,K)},h="theme-text border transition-all bg-[var(--card-bg)] hover:bg-[var(--card-bg-hover)] border-[var(--card-border)] hover:border-[var(--card-border-hover)]",{isCollapsed:b,isHovering:j,isPinned:y,setIsCollapsed:N,setIsHovering:w,setIsPinned:S,isTogglingRef:k}=pp(t),[C,P]=g.useState("time"),[R,M]=g.useState(!1),{collapsedSections:T,toggleSection:D,toggleAllTimeSections:F,toggleAllMarketSections:$,toggleAllPerformanceSections:U,toggleAllExpositionSections:B,toggleAllTagsSections:O}=hp(),z=g.useCallback(W=>{J(!1),A(""),P(W.category),W.type==="filter"&&W.section!=="general"&&{dateRange:"dateRange",timeRange:"hoursTimeRange",sessions:"sessions",months:"months",weekdays:"weekdays",hours:"hours",hoursTimeRange:"hoursTimeRange",symbols:"symbols",strategies:"strategies",trendDirection:"trendDirection",status:"status",timeframeTick:"timeframeTick",timeframe:"timeframeTick",tickEntry:"timeframeTick",marketType:"marketType",pnl:"pnl",duration:"duration",tradeResult:"tradeResult",fees:"fees",contracts:"contracts",lots:"lots",ticks:"ticks",tags:"tags"}[W.section]},[T]),{collapsedMarkets:q,toggleMarket:E}=Np(c);g.useEffect(()=>{d&&t&&!k.current&&(N(!1),w(!0),S(!1),P(d.category),fp[d.section]||d.section,setTimeout(()=>{N(!0),w(!1)},2e3))},[d,t]);const[I,H]=g.useState(""),[L,A]=g.useState(""),[_,J]=g.useState(!1);g.useMemo(()=>I?o.filter(W=>W.toLowerCase().includes(I.toLowerCase())):o,[o,I]);const re=g.useMemo(()=>{const W={};return c.forEach(K=>{K.tags.forEach(ue=>{W[ue]=(W[ue]||0)+1})}),Object.entries(W).sort(([,K],[,ue])=>ue-K).slice(0,10).map(([K])=>K)},[c]),de=g.useMemo(()=>{if(!L||L.length<2)return[];const W=[],K=L.toLowerCase(),ue=[{title:"Filtres Temporels",category:"time",section:"general"},{title:"Filtres de Performance",category:"performance",section:"general"},{title:"Filtres de MarchÃ© & Trading",category:"market",section:"general"},{title:"Filtres d'Exposition",category:"exposition",section:"general"},{title:"Filtrage par Tags",category:"tags",section:"general"}],ye=[{title:"Plages de Dates",category:"time",section:"dateRange"},{title:"Mois",category:"time",section:"months"},{title:"Jours de la Semaine",category:"time",section:"weekdays"},{title:"Heures",category:"time",section:"hours"},{title:"Plage Horaire",category:"time",section:"hoursTimeRange"},{title:"Sessions de Trading",category:"time",section:"sessions"},{title:"Gains & Pertes",category:"performance",section:"pnl"},{title:"P&L",category:"performance",section:"pnl"},{title:"DurÃ©e des Trades",category:"performance",section:"duration"},{title:"RÃ©sultat du Trade",category:"performance",section:"tradeResult"},{title:"Frais",category:"performance",section:"fees"},{title:"Types de MarchÃ©",category:"market",section:"marketType"},{title:"Symboles",category:"market",section:"symbols"},{title:"StratÃ©gies",category:"market",section:"strategies"},{title:"Tendance & Direction",category:"market",section:"trendDirection"},{title:"Tendance",category:"market",section:"trendDirection"},{title:"Direction",category:"market",section:"trendDirection"},{title:"Statut",category:"market",section:"status"},{title:"Timeframe/Tick",category:"market",section:"timeframeTick"},{title:"Timeframe",category:"market",section:"timeframeTick"},{title:"Ticks d'EntrÃ©e",category:"market",section:"timeframeTick"},{title:"Entry Ticks",category:"market",section:"timeframeTick"},{title:"Contrats EngagÃ©s",category:"exposition",section:"contracts"},{title:"Lots",category:"exposition",section:"lots"},{title:"Ticks",category:"exposition",section:"ticks"},{title:"Tags",category:"tags",section:"tags"}];return ue.forEach(Fe=>{Fe.title.toLowerCase().includes(K)&&W.push({...Fe,type:"category"})}),ye.forEach(Fe=>{Fe.title.toLowerCase().includes(K)&&W.push({...Fe,type:"filter"})}),W.slice(0,6)},[L]),se=g.useMemo(()=>{const W=zr(c,r);return{filtered:W.length,total:c.length,percentage:c.length>0?Math.round(W.length/c.length*100):0}},[c,r]);g.useMemo(()=>xp(r),[r]),g.useMemo(()=>mp(r),[r]),g.useMemo(()=>up(r),[r]);const ke=g.useMemo(()=>{const W={};return c.forEach(K=>{const ue=K.market;W[ue]||(W[ue]=[]),W[ue].includes(K.symbol)||W[ue].push(K.symbol)}),W},[c]),be=g.useCallback(()=>{b&&!y&&!k.current&&(w(!0),N(!1))},[b,y]),he=g.useCallback(()=>{j&&!y&&(w(!1),N(!0))},[j,y]),te=g.useCallback(()=>{k.current=!0,y?(S(!1),w(!1),N(!0)):(S(!0),w(!0)),setTimeout(()=>{k.current=!1},100)},[y,j]);return t?e.jsxs(e.Fragment,{children:[!b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>{y||N(!0)}}),e.jsxs("div",{className:`fixed right-0 top-0 h-full theme-surface border-l theme-border shadow-2xl transition-all duration-300 ease-in-out z-50 ${b?"w-16":"w-1/2"}`,style:{backgroundColor:m.colors.surface},onMouseEnter:be,onMouseLeave:he,children:[e.jsx(vp,{isCollapsed:b,isPinned:y,currentLanguage:p,currentTheme:m,filteredTradesCount:se,activeFilterCount:Ts(r),globalSearchTerm:L,showSearchSuggestions:_,searchSuggestions:de,onToggleCollapse:te,onClose:s,onOpenActiveFilters:()=>M(!0),onChangeSearch:W=>{A(W),J(W.length>=2)},onSearchFocus:()=>J(L.length>=2),onSearchBlur:()=>{setTimeout(()=>J(!1),200)},onClickSuggestion:z,getSectionTextColor:W=>f(W)}),!b&&e.jsx("div",{className:"p-4 border-b theme-border",children:e.jsx(jp,{categories:[{id:"time",label:p==="fr"?"Temps":"Time",icon:e.jsx(yt,{size:20})},{id:"market",label:p==="fr"?"MarchÃ©":"Market",icon:e.jsx(_e,{size:20})},{id:"performance",label:"Performance",icon:e.jsx(Ae,{size:20})},{id:"exposition",label:p==="fr"?"Exposition":"Exposure",icon:e.jsx(Mt,{size:20})},{id:"tags",label:"Tags",icon:e.jsx(ds,{size:20})}],activeCategory:C,onSelect:W=>P(W),cardBaseClasses:h,getCategoryCardVars:v})}),!b&&e.jsx("div",{className:"flex-1 p-4",children:e.jsx(Wp,{activeCategory:C,filters:r,onFiltersChange:l,collapsedSections:T,toggleSection:D,availableTrades:c,availableStrategies:n,availableTimeframes:a,availableTickEntries:i,symbolsByMarket:ke,toggleAll:{time:F,performance:U,exposition:B,market:$,tags:O},collapsedMarkets:q,toggleMarket:E,availableTags:o,popularTags:re})}),!b&&e.jsx("div",{className:"p-4 border-t theme-border",children:e.jsx(wp,{currentTheme:m,currentLanguage:p,activeCategory:C,filters:r,filteredTradesCount:se,onFiltersChange:l})}),b&&e.jsx(Sp,{}),e.jsx(Da,{isOpen:R,onClose:()=>M(!1),activeFilters:Ma(r,x),onNavigateToFilter:(W,K)=>{M(!1),P(W)},onResetFilter:(W,K)=>{const ue={...r};delete ue[K],l(ue)}})]})]}):null},Vp=({isOpen:t,onToggle:s,filters:r,onFiltersChange:l,availableStrategies:n,availableTags:o,availableTimeframes:a,availableTickEntries:i,availableTrades:c,navigationRequest:d,onNavigationComplete:u})=>e.jsx(e.Fragment,{children:e.jsx(_p,{isOpen:t,onToggle:s,filters:r,onFiltersChange:l,availableStrategies:n,availableTags:o,availableTimeframes:a,availableTickEntries:i,availableTrades:c,navigationRequest:d,onNavigationComplete:u})}),Bp=({mode:t,onChange:s})=>{const{currentTheme:r}=Q(),{currentLanguage:l}=Z(),n=[{id:"normal",label:"Normal"},{id:"quick",label:l==="fr"?"Rapide":"Quick"}];return e.jsx("div",{className:"flex items-center space-x-2",children:n.map(o=>e.jsx("button",{type:"button",onClick:()=>s(o.id),className:`px-3 py-2 rounded-md border text-sm font-medium transition-colors ${t===o.id?"shadow-sm":"hover:shadow-sm"}`,style:{backgroundColor:t===o.id?r.colors.accent:r.colors.surface,color:t===o.id?"#ffffff":r.colors.text,borderColor:r.colors.border},children:o.label},o.id))})},Fa=["date","market","symbol","side","quantity","pnl"],Xn=["date","market","symbol","side","quantity","pnl","timeframe","notes","tags"],Io=["date","market","symbol","side","quantity","pnl","time","timeframe","strategy","setup","trend","notes","tags","screenshots","entryDate","entryTime","entryPrice","exitDate","exitTime","exitPrice","stopPrice","takeProfitPrice","riskReward","tradeResult","fees_commission","fees_spread","fees_swap","fees_exchange","fees_regulatory","fees_other","tickSize","tickValue","marginPerContract","leverage","marginRate","marginUsedOverride","emotion","emotionIntensity","planRespected"];function Hp(t){return`custom-form:${t}`}function Gp(t){const s=g.useMemo(()=>Hp(t),[t]),[r,l]=g.useState(()=>({preferredFormMode:"normal",visibleFields:Xn,order:Io,preferredPnlMode:"percentage"}));g.useEffect(()=>{try{if(!s)return;const d=localStorage.getItem(s);if(!d)return;const u=JSON.parse(d),m={preferredFormMode:u.preferredFormMode||"normal",visibleFields:Qn(Array.isArray(u.visibleFields)?u.visibleFields:Xn),order:Zn(Array.isArray(u.order)?u.order:Io),preferredPnlMode:u.preferredPnlMode==="absolute"?"absolute":"percentage"};l(m)}catch{}},[s]);const n=g.useCallback(d=>{try{if(!s)return;localStorage.setItem(s,JSON.stringify(d))}catch{}},[s]),o=g.useCallback(d=>{l(u=>{const m={...u,preferredFormMode:d};return n(m),m})},[n]),a=g.useCallback(d=>{l(u=>{const m={...u,preferredPnlMode:d};return n(m),m})},[n]),i=g.useCallback(d=>{l(u=>{const m={...u,visibleFields:Qn(d)};return n(m),m})},[n]),c=g.useCallback(d=>{l(u=>{const m={...u,order:Zn(d)};return n(m),m})},[n]);return{config:r,setPreferredFormMode:o,setPreferredPnlMode:a,setVisibleFields:i,setOrder:c,REQUIRED_FIELDS:Fa}}function Qn(t){const s=new Set(t);return Fa.forEach(r=>s.add(r)),Array.from(s)}function Zn(t){const s=[],r=new Set;return t.forEach(l=>{r.has(l)||(r.add(l),s.push(l))}),Io.forEach(l=>{r.has(l)||(r.add(l),s.push(l))}),s}const Jp=({isOpen:t,settings:s,onSettingsChange:r,onClose:l})=>{const[n,o]=g.useState({...s}),{config:a,setPreferredFormMode:i,setVisibleFields:c,REQUIRED_FIELDS:d}=Gp("GLOBAL"),[u,m]=g.useState(!1),[p,x]=g.useState(!0),{currentLanguage:f,changeLanguage:v,t:h}=Z(),{currentTheme:b}=Q();g.useEffect(()=>{try{const w=localStorage.getItem("custom-form:allow-profile-overrides");w!==null&&x(JSON.parse(w))}catch{}},[]);const j=w=>{w.preventDefault(),r(n),l()},y=[{code:"EUR",name:"Euro (â‚¬)"},{code:"USD",name:f==="fr"?"Dollar US ($)":"US Dollar ($)"},{code:"GBP",name:f==="fr"?"Livre Sterling (Â£)":"British Pound (Â£)"},{code:"CHF",name:f==="fr"?"Franc Suisse (CHF)":"Swiss Franc (CHF)"},{code:"CAD",name:f==="fr"?"Dollar Canadien (CAD)":"Canadian Dollar (CAD)"},{code:"JPY",name:f==="fr"?"Yen Japonais (Â¥)":"Japanese Yen (Â¥)"}];if(!t)return null;const N={role:"dialog","aria-modal":!0,"aria-labelledby":"settings-modal-title"};return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",...N,children:[e.jsxs("div",{className:"theme-surface rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b theme-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ms,{size:20,className:"theme-text-muted"}),e.jsx("h2",{id:"settings-modal-title",className:"text-xl font-semibold theme-text",children:f==="fr"?"ParamÃ¨tres Rapides":"Quick Settings"})]}),e.jsx("button",{onClick:l,className:"theme-text-muted hover:theme-text transition-colors",children:e.jsx(Ne,{size:24})})]}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium theme-text mb-4 flex items-center",children:[e.jsx(Wo,{size:20,className:"mr-2 text-blue-500"}),f==="fr"?"Langue / Language":"Language / Langue"]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Js.map(w=>e.jsxs("button",{type:"button",onClick:()=>v(w.code),className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${f===w.code?"theme-text shadow-md":"theme-surface theme-text hover:theme-surface"}`,style:{backgroundColor:f===w.code?"var(--theme-accent)":"var(--theme-surface)"},children:[e.jsx("span",{className:"text-lg",children:w.flag}),e.jsx("span",{children:w.name})]},w.code))})]}),e.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:`${b.colors.accent}10`,borderColor:b.colors.accent},children:[e.jsxs("h3",{className:"text-sm font-medium mb-2",style:{color:b.colors.accent},children:["â„¹ï¸ ",f==="fr"?"ParamÃ¨tres Rapides":"Quick Settings"]}),e.jsx("p",{className:"text-xs",style:{color:b.colors.textMuted},children:f==="fr"?"Pour des paramÃ¨tres avancÃ©s (affichage des stats, prÃ©fÃ©rences de trading, etc.), utilisez la configuration du profil.":"For advanced settings (stats display, trading preferences, etc.), use the profile configuration."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium theme-text mb-4",children:f==="fr"?"ParamÃ¨tres Financiers de Base":"Basic Financial Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:f==="fr"?"Capital Initial":"Initial Capital"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",value:n.initialCapital,onChange:w=>o(S=>({...S,initialCapital:parseFloat(w.target.value)||0})),className:"w-full px-3 py-2 pr-12 border theme-border rounded-md focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},placeholder:"10000",required:!0}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"theme-text-muted text-sm",children:n.currency})})]}),e.jsx("p",{className:"text-xs theme-text-muted mt-1",children:f==="fr"?"Montant de dÃ©part de votre compte de trading":"Starting amount of your trading account"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:f==="fr"?"Risque par Trade":"Risk per Trade"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.1",min:"0",max:"100",value:n.riskPerTrade,onChange:w=>o(S=>({...S,riskPerTrade:parseFloat(w.target.value)||0})),className:"w-full px-3 py-2 pr-8 border theme-border rounded-md focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},placeholder:"2",required:!0}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"theme-text-muted text-sm",children:"%"})})]}),e.jsx("p",{className:"text-xs theme-text-muted mt-1",children:f==="fr"?"Pourcentage du capital que vous risquez par trade (recommandÃ©: 1-3%)":"Percentage of capital you risk per trade (recommended: 1-3%)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:f==="fr"?"Devise":"Currency"}),e.jsx("select",{value:n.currency,onChange:w=>o(S=>({...S,currency:w.target.value})),className:"w-full px-3 py-2 border theme-border rounded-md focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},children:y.map(w=>e.jsx("option",{value:w.code,children:w.name},w.code))}),e.jsx("p",{className:"text-xs theme-text-muted mt-1",children:f==="fr"?"Devise utilisÃ©e pour l'affichage des montants":"Currency used for displaying amounts"})]})]})]}),e.jsxs("div",{className:"theme-surface p-4 rounded-lg border theme-border",children:[e.jsx("h3",{className:"text-lg font-medium theme-text mb-4",children:"Interface"}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx("div",{className:"text-sm theme-text-muted",children:f==="fr"?"Formulaire de trade - Mode par dÃ©faut":"Trade form - Default mode"}),e.jsx(Bp,{mode:a.preferredFormMode||"normal",onChange:w=>i(w)})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:"text-sm theme-text-muted",children:f==="fr"?"Configuration du mode personnalisÃ©":"Custom mode configuration"}),e.jsx("button",{type:"button",onClick:()=>m(!0),className:"px-3 py-2 rounded-md border theme-border theme-text hover:theme-surface transition-colors text-sm",children:f==="fr"?"Configurer le mode personnalisÃ©":"Configure custom mode"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"allow-overrides",type:"checkbox",checked:p,onChange:w=>{const S=w.target.checked;x(S);try{localStorage.setItem("custom-form:allow-profile-overrides",JSON.stringify(S))}catch{}}}),e.jsx("label",{htmlFor:"allow-overrides",className:"text-sm theme-text",children:f==="fr"?"Autoriser les rÃ©glages par profil":"Allow per-profile overrides"})]})]}),e.jsxs("div",{className:"theme-surface p-4 rounded-lg border theme-border",children:[e.jsx("h3",{className:"text-sm font-medium theme-text mb-2",children:f==="fr"?"AperÃ§u des Calculs":"Calculation Preview"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"theme-text-muted",children:f==="fr"?"Capital initial:":"Initial capital:"}),e.jsxs("span",{className:"font-medium theme-text",children:[n.initialCapital.toLocaleString(f==="fr"?"fr-FR":"en-US")," ",n.currency]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"theme-text-muted",children:f==="fr"?"Risque par trade:":"Risk per trade:"}),e.jsxs("span",{className:"font-medium theme-text",children:[(n.initialCapital*n.riskPerTrade/100).toLocaleString(f==="fr"?"fr-FR":"en-US")," ",n.currency," (",n.riskPerTrade,"%)"]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 theme-text theme-surface rounded-md transition-colors",style:{color:"var(--theme-text)",backgroundColor:"var(--theme-surface)"},onMouseEnter:w=>{w.currentTarget.style.backgroundColor="var(--theme-border)"},onMouseLeave:w=>{w.currentTarget.style.backgroundColor="var(--theme-surface)"},children:f==="fr"?"Annuler":"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 theme-text rounded-md transition-colors",style:{backgroundColor:"var(--theme-accent)"},onMouseEnter:w=>{w.currentTarget.style.backgroundColor="var(--theme-accent-hover)"},onMouseLeave:w=>{w.currentTarget.style.backgroundColor="var(--theme-accent)"},children:f==="fr"?"Sauvegarder":"Save"})]})]})]}),e.jsx(ua,{isOpen:u,onClose:()=>m(!1),currentHiddenFields:a.order.filter(w=>!a.visibleFields.includes(w)),isRequired:w=>d.includes(w),order:a.order,onApply:w=>{const k=a.order.filter(C=>!w.includes(C));c(k)},onReset:()=>{c(a.order)}})]})},jo={name:"Scalper Pro - DEMO",type:"scalper",accountType:"demo",description:"Profil de dÃ©monstration pour tester les fonctionnalitÃ©s de scalping",settings:{initialCapital:1e4,riskPerTrade:.5,currency:"EUR",maxDailyTrades:50,statsDisplay:{showDurationStats:!0,showTicksStats:!0,showFeesStats:!0,showLotsStats:!0,showAdvancedMetrics:!0,compactView:!1,showTicksCumulativeChart:!0}},preferences:{timeframes:["5s","10s","15s","30s","1m"],markets:["futures"],tradingSessions:[],units:{price:"ticks",quantity:"contracts"},keyMetrics:["trades_per_day","avg_hold_time","tick_capture","win_rate"]},uiSettings:{defaultView:"overview",compactMode:!0,showAdvancedStats:!0,chartType:"candlestick"},isActive:!0,color:"#ef4444"},Kp=(t,s=75)=>{const r=[],l=["ES","NQ","YM","RTY"],n=["Order Flow Scalping","Momentum Scalping","Range Scalping","News Scalping","Breakout Scalping"],o=["5s","10s","15s","30s","1m"],a=new Date;a.setDate(a.getDate()-30);const i={"Order Flow Scalping":{winRate:.75,avgTicks:8,variance:12},"Momentum Scalping":{winRate:.65,avgTicks:6,variance:15},"Range Scalping":{winRate:.55,avgTicks:4,variance:8},"News Scalping":{winRate:.45,avgTicks:12,variance:25},"Breakout Scalping":{winRate:.6,avgTicks:10,variance:18}};for(let c=0;c<s;c++){const d=new Date(a),u=Math.floor(Math.random()*30);d.setDate(d.getDate()+u),(d.getDay()===0||d.getDay()===6)&&d.setDate(d.getDate()+1);const m=8+Math.floor(Math.random()*9),p=Math.floor(Math.random()*60),x=Math.floor(Math.random()*60),f=`${m.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`,v=Math.floor(Math.random()*295)+5,h=n[Math.floor(Math.random()*n.length)],b=i[h];let j;Math.random()<b.winRate?(j=Math.floor(Math.random()*b.variance)+1,h==="Order Flow Scalping"&&(j+=Math.floor(Math.random()*5))):j=-(Math.floor(Math.random()*(b.variance/2))+1);const N=l[Math.floor(Math.random()*l.length)],S={ES:12.5,NQ:5,YM:5,RTY:5}[N],k=j*S,C=-2.5,P=-1.2,R=C+P,T=(k+R)/1e4*100,F={ES:4500,NQ:15e3,YM:35e3,RTY:2e3}[N]+(Math.random()-.5)*100,$=Math.random()>.5?"long":"short",U=$==="long"?F+j*.25:F-j*.25,B=Math.floor(Math.random()*60),O=`${m.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}:${B.toString().padStart(2,"0")}`,z=new Date(d.getTime()+v*1e3).toTimeString().split(" ")[0],q=["25ticks","50ticks","100ticks","200ticks"],E=q[Math.floor(Math.random()*q.length)],I=j>0?"tp":j<-5?"sl":"be",H={id:`demo-${c+1}`,date:d.toISOString().split("T")[0],time:f,symbol:N,side:$,entryPrice:Math.round(F*100)/100,exitPrice:Math.round(U*100)/100,quantity:1,quantityUnit:"contracts",numberOfLots:Math.floor(Math.random()*5)+1,pnlPercentage:Math.round(T*100)/100,pnl:Math.round(k*100)/100,ticksGained:j,tickValue:S,tickEntry:E,status:"closed",strategy:h,timeframe:o[Math.floor(Math.random()*o.length)],market:"futures",trend:Math.random()>.5?"bullish":"bearish",setup:"Scalping setup",notes:`Trade ${c+1} - ${j>0?"Gagnant":"Perdant"} (${j} ticks)`,tags:["demo","scalping",j>0?"winner":"loser"],riskReward:j>0?Math.abs(j)/5:void 0,tradeResult:I,fees:{commission:C,exchangeFees:P,spread:0,swapOvernight:0,regulatoryFees:0,otherFees:0,total:R},entryTime:O,exitTime:z,duration:v,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),profileId:t};r.push(H)}return r.sort((c,d)=>{const u=new Date(c.date+" "+c.time),m=new Date(d.date+" "+d.time);return u.getTime()-m.getTime()})},Yp=(t,s=40)=>{const r=[],l=["AAPL","TSLA","MSFT","GOOGL","AMZN","NVDA","META","NFLX"],n=["Breakout Trading","Pullback Trading","Reversal Trading","Mean Reversion","Gap Trading"],o=["5m","15m","30m","1h"],a=new Date;a.setDate(a.getDate()-30);const i={"Breakout Trading":{winRate:.7,avgReturn:2.5,variance:3},"Pullback Trading":{winRate:.65,avgReturn:1.8,variance:2.5},"Reversal Trading":{winRate:.5,avgReturn:3.2,variance:4},"Mean Reversion":{winRate:.6,avgReturn:1.5,variance:2},"Gap Trading":{winRate:.55,avgReturn:2.8,variance:3.5}};for(let c=0;c<s;c++){const d=new Date(a),u=Math.floor(Math.random()*30);d.setDate(d.getDate()+u),(d.getDay()===0||d.getDay()===6)&&d.setDate(d.getDate()+1);const m=9+Math.floor(Math.random()*7),p=Math.floor(Math.random()*60),x=`${m.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`,f=Math.floor(Math.random()*18e3)+1800,v=n[Math.floor(Math.random()*n.length)],h=i[v];let b;Math.random()<h.winRate?(b=Math.random()*h.variance+.3,v==="Breakout Trading"&&(b+=Math.random()*1.5)):b=-(Math.random()*(h.variance/1.5)+.2);const y=1e4*b/100,N=l[Math.floor(Math.random()*l.length)],w=100+Math.random()*200,S=Math.random()>.5?"long":"short",k=b/100*w,C=S==="long"?w+k:w-k,P=-5,R=P,M=Math.floor(Math.random()*60),T=`${m.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}:${M.toString().padStart(2,"0")}`,D=new Date(d.getTime()+f*1e3).toTimeString().split(" ")[0],F=["100ticks","200ticks","500ticks","1000ticks"],$=F[Math.floor(Math.random()*F.length)],U=b>0?"tp":b<-2?"sl":"be",B={id:`demo-day-${c+1}`,date:d.toISOString().split("T")[0],time:x,symbol:N,side:S,entryPrice:Math.round(w*100)/100,exitPrice:Math.round(C*100)/100,quantity:Math.floor(Math.random()*500)+100,quantityUnit:"lots",numberOfLots:Math.floor(Math.random()*3)+1,pnlPercentage:Math.round(b*100)/100,pnl:Math.round(y*100)/100,tickEntry:$,status:"closed",strategy:v,timeframe:o[Math.floor(Math.random()*o.length)],market:"stocks",trend:Math.random()>.5?"bullish":"bearish",setup:"Day trading setup",notes:`Day trade ${c+1} - ${b>0?"Gagnant":"Perdant"}`,tags:["demo","daytrading",b>0?"winner":"loser"],riskReward:b>0?Math.abs(b)/1.5:void 0,tradeResult:U,fees:{commission:P,spread:0,swapOvernight:0,exchangeFees:0,regulatoryFees:0,otherFees:0,total:R},entryTime:T,exitTime:D,duration:f,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),profileId:t};r.push(B)}return r.sort((c,d)=>{const u=new Date(c.date+" "+c.time),m=new Date(d.date+" "+d.time);return u.getTime()-m.getTime()})},Xp=({isOpen:t,onClose:s,onLoadData:r,onClearData:l})=>{const{currentTheme:n}=Q(),{t:o,currentLanguage:a}=Z(),[i,c]=g.useState(!1),[d,u]=g.useState(null),m=f=>{u(f),c(!0)},p=f=>{const v={...jo,id:`demo-${f}-${Date.now()}`,name:f==="scalper"?"Scalper Pro - DEMO":"Day Trader Pro - DEMO",type:f==="scalper"?"scalper":"daytrader",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),settings:{...jo.settings,statsDisplay:{...jo.settings.statsDisplay,showTicksCumulativeChart:f==="scalper"}}},h=f==="scalper"?Kp(v.id,75):Yp(v.id,40);console.log("ðŸŽ¯ DemoDataButton calling onLoadData:",{tradesCount:h.length,profileName:v.name,profileId:v.id}),r(h,v),c(!1),u(null),s()},x=()=>{d&&p(d)};return t?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:[e.jsxs("div",{className:"card rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b theme-border",children:[e.jsx("h2",{className:"text-xl font-semibold theme-text",children:a==="fr"?"DonnÃ©es de DÃ©monstration":"Demo Data"}),e.jsx("button",{onClick:s,className:"theme-text-muted hover:theme-text transition-colors",children:"âœ•"})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex flex-col space-y-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("h3",{className:"text-lg font-medium mb-2",style:{color:n.colors.text},children:["ðŸš€ ",a==="fr"?"DonnÃ©es de DÃ©monstration":"Demo Data"]}),e.jsx("p",{className:"text-sm mb-4",style:{color:n.colors.textSecondary},children:a==="fr"?"Chargez des donnÃ©es rÃ©alistes pour tester toutes les fonctionnalitÃ©s":"Load realistic data to test all features"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>m("scalper"),className:"p-4 rounded-lg border-2 border-dashed transition-all hover:shadow-md",style:{borderColor:n.colors.border,backgroundColor:n.colors.card},onMouseEnter:f=>{f.currentTarget.style.borderColor=n.colors.accent,f.currentTarget.style.backgroundColor=n.colors.surface},onMouseLeave:f=>{f.currentTarget.style.borderColor=n.colors.border,f.currentTarget.style.backgroundColor=n.colors.card},children:[e.jsx("div",{className:"flex items-center justify-center mb-3",children:e.jsx("div",{className:"text-3xl",children:"âš¡"})}),e.jsx("h4",{className:"font-bold text-lg mb-2",style:{color:n.colors.text},children:"Scalper Pro"}),e.jsxs("div",{className:"text-sm space-y-1",style:{color:n.colors.textSecondary},children:[e.jsxs("p",{children:["â€¢ ",a==="fr"?"75 trades de scalping":"75 scalping trades"]}),e.jsxs("p",{children:["â€¢ ",a==="fr"?"DonnÃ©es de ticks rÃ©alistes":"Realistic tick data"]}),e.jsxs("p",{children:["â€¢ ",a==="fr"?"Graphique cumulatif des ticks":"Cumulative tick chart"]}),e.jsxs("p",{children:["â€¢ ",a==="fr"?"DurÃ©es courtes (5s-5min)":"Short durations (5s-5min)"]}),e.jsxs("p",{children:["â€¢ ",a==="fr"?"Futures ES, NQ, YM, RTY":"ES, NQ, YM, RTY futures"]})]})]}),e.jsxs("button",{onClick:()=>m("daytrader"),className:"p-4 rounded-lg border-2 border-dashed transition-all hover:shadow-md",style:{borderColor:n.colors.border,backgroundColor:n.colors.card},onMouseEnter:f=>{f.currentTarget.style.borderColor=n.colors.accent,f.currentTarget.style.backgroundColor=n.colors.surface},onMouseLeave:f=>{f.currentTarget.style.borderColor=n.colors.border,f.currentTarget.style.backgroundColor=n.colors.card},children:[e.jsx("div",{className:"flex items-center justify-center mb-3",children:e.jsx("div",{className:"text-3xl",children:"ðŸ“ˆ"})}),e.jsx("h4",{className:"font-bold text-lg mb-2",style:{color:n.colors.text},children:"Day Trader Pro"}),e.jsxs("div",{className:"text-sm space-y-1",style:{color:n.colors.textSecondary},children:[e.jsxs("p",{children:["â€¢ ",a==="fr"?"40 trades intraday":"40 intraday trades"]}),e.jsxs("p",{children:["â€¢ ",a==="fr"?"Actions US populaires":"Popular US stocks"]}),e.jsxs("p",{children:["â€¢ ",a==="fr"?"DurÃ©es moyennes (30min-5h)":"Medium durations (30min-5h)"]}),e.jsxs("p",{children:["â€¢ ",a==="fr"?"StratÃ©gies de day trading":"Day trading strategies"]}),e.jsx("p",{children:"â€¢ AAPL, TSLA, MSFT, etc."})]})]})]}),e.jsx("div",{className:"mt-4 p-3 rounded-lg",style:{backgroundColor:n.colors.warning+"20"},children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(Xt,{size:16,style:{color:n.colors.warning}}),e.jsx("span",{style:{color:n.colors.text},children:a==="fr"?"Le chargement remplacera toutes vos donnÃ©es existantes.":"Loading will replace all your existing data."})]})}),e.jsxs("button",{onClick:l,className:"flex items-center justify-center space-x-2 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:n.colors.danger+"20",color:n.colors.danger,border:`1px solid ${n.colors.danger}40`},onMouseEnter:f=>{f.currentTarget.style.backgroundColor=n.colors.danger+"30"},onMouseLeave:f=>{f.currentTarget.style.backgroundColor=n.colors.danger+"20"},children:[e.jsx(Qt,{size:16}),e.jsx("span",{children:a==="fr"?"Effacer toutes les donnÃ©es":"Clear all data"})]})]})})]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]",children:e.jsxs("div",{className:"rounded-lg shadow-xl max-w-md w-full p-6",style:{backgroundColor:n.colors.card,border:`1px solid ${n.colors.border}`},children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(Xt,{size:24,style:{color:n.colors.warning}}),e.jsx("h3",{className:"text-lg font-bold",style:{color:n.colors.text},children:a==="fr"?"Confirmer le chargement":"Confirm loading"})]}),e.jsx("p",{className:"mb-6",style:{color:n.colors.textSecondary},children:a==="fr"?"Cette action va remplacer tous vos trades et profils existants par les donnÃ©es de dÃ©monstration. Cette action est irrÃ©versible.":"This action will replace all your existing trades and profiles with demo data. This action is irreversible."}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>c(!1),className:"flex-1 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:n.colors.surface,color:n.colors.text,border:`1px solid ${n.colors.border}`},children:a==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:x,className:"flex-1 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:n.colors.warning,color:"#ffffff"},children:a==="fr"?"Confirmer":"Confirm"})]})]})})]}):null};let No=null;const Qp=async()=>{if(!No)try{const t=await rs(()=>import("./pdf-DQpr2XkM.js").then(s=>s.j),[],import.meta.url);No=t.default||t.jsPDF}catch(t){throw console.error("Erreur chargement jsPDF:",t),new Error("Impossible de charger jsPDF")}return No},Zp=(t,s)=>{const r=t.filter(u=>u.date.startsWith(s)),l=r.filter(u=>u.pnl>0).reduce((u,m)=>u+m.pnl,0),n=r.filter(u=>u.pnl<0).reduce((u,m)=>u+m.pnl,0),o=r.reduce((u,m)=>{const p=m.fees?.total||0;return u+Math.abs(p)},0),a=l+n-o,i=r.length>0?r.filter(u=>u.pnl>0).length/r.length*100:0,c=new Map;r.forEach(u=>{const m=u.date.substring(0,7);c.has(m)||c.set(m,{gains:0,losses:0,fees:0,count:0});const p=c.get(m);u.pnl>0?p.gains+=u.pnl:p.losses+=u.pnl;const x=u.fees?.total||0;p.fees+=Math.abs(x),p.count++});const d=Array.from(c.entries()).map(([u,m])=>({month:new Date(u+"-01").toLocaleDateString("fr-FR",{month:"long",year:"numeric"}),gains:m.gains,losses:m.losses,fees:m.fees,net:m.gains+m.losses-m.fees,tradeCount:m.count})).sort((u,m)=>u.month.localeCompare(m.month));return{period:s,totalTrades:r.length,totalGains:l,totalLosses:n,totalFees:o,netResult:a,winRate:i,tradesByMonth:d}},eh=async(t,s,r="Compte de Trading",l="EUR",n="Trader",o="Utilisateur")=>{try{console.log("DÃ©but gÃ©nÃ©ration PDF fiscal...");const a=Zp(t,s);console.log("Stats calculÃ©es:",a);const i=await Qp();console.log("jsPDF chargÃ©");const c=new i;console.log("PDF crÃ©Ã©");const d=c.internal.pageSize.getWidth(),u=20;let m=u;const p=[41,128,185],x=[39,174,96],f=[231,76,60],v=[44,62,80],h=(M,T,D,F={})=>{F.color?Array.isArray(F.color)?c.setTextColor(F.color[0],F.color[1],F.color[2]):c.setTextColor(F.color):c.setTextColor(v[0],v[1],v[2]),c.setFontSize(F.fontSize||12),c.text(M,T,D)},b=(M,T,D,F,$=v)=>{c.setDrawColor($[0],$[1],$[2]),c.line(M,T,D,F)};c.setFillColor(p[0],p[1],p[2]),c.rect(0,0,d,50,"F"),h("RAPPORT FISCAL DE TRADING",u,30,{color:[255,255,255],fontSize:20}),h(`AnnÃ©e ${s}`,u,45,{color:[255,255,255],fontSize:14}),m=80,h("INFORMATIONS DU TRADER",u,m,{fontSize:16,color:p}),m+=25,h(`Nom : ${o}`,u,m,{fontSize:12}),m+=15,h(`PrÃ©nom : ${n}`,u,m,{fontSize:12}),m+=15,h(`Compte : ${r}`,u,m,{fontSize:12}),m+=15,h(`PÃ©riode : 01/01/${s} au 31/12/${s}`,u,m,{fontSize:12}),m+=15,h(`Devise : ${l}`,u,m,{fontSize:12}),m+=40,h("RÃ‰SUMÃ‰ EXÃ‰CUTIF",u,m,{fontSize:16,color:p}),m+=25,h(`Total des trades : ${a.totalTrades}`,u,m,{fontSize:12}),m+=15,h(`Gains totaux : ${a.totalGains.toFixed(2)} ${l}`,u,m,{fontSize:12,color:x}),m+=15,h(`Pertes totales : ${a.totalLosses.toFixed(2)} ${l}`,u,m,{fontSize:12,color:f}),m+=15,h(`Frais totaux : ${a.totalFees.toFixed(2)} ${l}`,u,m,{fontSize:12,color:[128,128,128]}),m+=15,h(`RÃ©sultat net imposable : ${a.netResult.toFixed(2)} ${l}`,u,m,{fontSize:14,color:a.netResult>=0?x:f}),m+=15,h(`Taux de rÃ©ussite : ${a.winRate.toFixed(1)}%`,u,m,{fontSize:12}),c.addPage(),m=u,h("DÃ‰TAIL PAR MOIS",u,m,{fontSize:16,color:p}),m+=20,h("Mois",u,m,{fontSize:10}),h("Trades",u+50,m,{fontSize:10}),h("Gains",u+80,m,{fontSize:10}),h("Pertes",u+120,m,{fontSize:10}),h("Frais",u+160,m,{fontSize:10}),h("Net",u+200,m,{fontSize:10}),b(u,m+5,d-u,m+5),m+=15,a.tradesByMonth.forEach(M=>{m>270&&(c.addPage(),m=u),h(M.month,u,m,{fontSize:9}),h(M.tradeCount.toString(),u+50,m,{fontSize:9}),h(`${M.gains.toFixed(2)}`,u+80,m,{fontSize:9,color:x}),h(`${M.losses.toFixed(2)}`,u+120,m,{fontSize:9,color:f}),h(`${M.fees.toFixed(2)}`,u+160,m,{fontSize:9,color:[128,128,128]}),h(`${M.net.toFixed(2)}`,u+200,m,{fontSize:9,color:M.net>=0?x:f}),m+=12}),m>200&&(c.addPage(),m=u),h("DÃ‰TAIL DES FRAIS",u,m,{fontSize:16,color:p}),m+=20,h("Type de frais",u,m,{fontSize:10}),h("Calcul",u+80,m,{fontSize:10}),h("Montant",u+150,m,{fontSize:10}),b(u,m+5,d-u,m+5),m+=15;const j=t.filter(M=>M.date.startsWith(s)),y=j.reduce((M,T)=>M+Math.abs(T.fees?.commission||0),0),N=j.reduce((M,T)=>M+Math.abs(T.fees?.spread||0),0),w=j.reduce((M,T)=>M+Math.abs(T.fees?.swapOvernight||0),0),S=j.reduce((M,T)=>M+Math.abs(T.fees?.exchangeFees||0),0),k=j.reduce((M,T)=>M+Math.abs(T.fees?.otherFees||0),0);y>0&&(h("Commissions",u,m,{fontSize:9}),h(`${j.length} trades`,u+80,m,{fontSize:9}),h(`${y.toFixed(2)} ${l}`,u+150,m,{fontSize:9,color:[128,128,128]}),m+=12),N>0&&(h("Spreads",u,m,{fontSize:9}),h(`${j.length} trades`,u+80,m,{fontSize:9}),h(`${N.toFixed(2)} ${l}`,u+150,m,{fontSize:9,color:[128,128,128]}),m+=12),w>0&&(h("Frais de financement",u,m,{fontSize:9}),h(`${j.length} trades`,u+80,m,{fontSize:9}),h(`${w.toFixed(2)} ${l}`,u+150,m,{fontSize:9,color:[128,128,128]}),m+=12),S>0&&(h("Frais d'Ã©change",u,m,{fontSize:9}),h(`${j.length} trades`,u+80,m,{fontSize:9}),h(`${S.toFixed(2)} ${l}`,u+150,m,{fontSize:9,color:[128,128,128]}),m+=12),k>0&&(h("Autres frais",u,m,{fontSize:9}),h(`${j.length} trades`,u+80,m,{fontSize:9}),h(`${k.toFixed(2)} ${l}`,u+150,m,{fontSize:9,color:[128,128,128]}),m+=12),b(u,m+3,d-u,m+3),m+=8,h("TOTAL FRAIS",u,m,{fontSize:10,color:p}),h(`${a.totalFees.toFixed(2)} ${l}`,u+150,m,{fontSize:10,color:[128,128,128]}),m+=25,m>200&&(c.addPage(),m=u),h("DÃ‰TAIL DES TRADES (TOUS)",u,m,{fontSize:16,color:p}),m+=20,h("Date",u,m,{fontSize:8}),h("Symbole",u+25,m,{fontSize:8}),h("Type",u+60,m,{fontSize:8}),h("P&L",u+85,m,{fontSize:8}),h("Frais",u+120,m,{fontSize:8}),b(u,m+3,d-u,m+3),m+=10,t.filter(M=>M.date.startsWith(s)).forEach(M=>{m>270&&(c.addPage(),m=u),h(M.date,u,m,{fontSize:7}),h(M.symbol,u+25,m,{fontSize:7}),h(M.side==="long"?"Achat":"Vente",u+60,m,{fontSize:7}),h(`${M.pnl.toFixed(2)} ${l}`,u+85,m,{fontSize:7,color:M.pnl>=0?x:f});const T=M.fees?.total||0,D=T!==0?`${Math.abs(T).toFixed(2)} ${l}`:"-";h(D,u+120,m,{fontSize:7,color:T!==0?[128,128,128]:[128,128,128]}),m+=8});const P=c.getNumberOfPages();for(let M=1;M<=P;M++)if(c.setPage(M),h(`Page ${M} sur ${P}`,d-40,c.internal.pageSize.getHeight()-10,{fontSize:8,color:[128,128,128]}),h(`GÃ©nÃ©rÃ© le ${new Date().toLocaleDateString("fr-FR")}`,u,c.internal.pageSize.getHeight()-10,{fontSize:8,color:[128,128,128]}),M===P){const T=c.internal.pageSize.getHeight()-30;h("NOTES IMPORTANTES :",u,T,{fontSize:8,color:[128,128,128]});const D=T+8;h("â€¢ Les frais sont calculÃ©s Ã  partir des donnÃ©es rÃ©elles des trades (commissions, spreads, etc.)",u,D,{fontSize:7,color:[128,128,128]});const F=D+6;h("â€¢ Conversion devise : Les montants sont exprimÃ©s en "+l+" (taux BCE ou broker)",u,F,{fontSize:7,color:[128,128,128]});const $=F+6;h("â€¢ Ce rapport est gÃ©nÃ©rÃ© Ã  titre de justificatif fiscal. Les montants sont Ã  dÃ©clarer",u,$,{fontSize:7,color:[128,128,128]});const U=$+6;h("  conformÃ©ment Ã  la rÃ©glementation fiscale en vigueur.",u,U,{fontSize:7,color:[128,128,128]})}console.log("TÃ©lÃ©chargement du PDF...");const R=`rapport_fiscal_${r.replace(/\s+/g,"_")}_${s}.pdf`;c.save(R),console.log("PDF tÃ©lÃ©chargÃ©:",R)}catch(a){throw console.error("Erreur lors de la gÃ©nÃ©ration du PDF fiscal:",a),console.error("Stack trace:",a instanceof Error?a.stack:"Pas de stack trace"),new Error(`Erreur lors de la gÃ©nÃ©ration du PDF: ${a instanceof Error?a.message:"Erreur inconnue"}`)}};async function th(t,s,r,l,n,o){await eh(t,s,r,l,n,o)}function sh(t,s="fr"){const r=t.split(`
`).filter(f=>f.trim());if(r.length<2)return{success:!1,trades:[],errors:[s==="fr"?"Fichier CSV vide ou invalide":"Empty or invalid CSV file"],warnings:[],summary:{totalRows:0,validTrades:0,invalidTrades:0,skippedRows:0}};const l=r[0].split(",").map(f=>f.trim().toLowerCase()),n=[],o=[],a=[],i=f=>{for(const v of f){const h=l.findIndex(b=>b.includes(v.toLowerCase()));if(h!==-1)return h}return-1},c=i(["date","time","datetime"]),d=i(["symbol","instrument","pair","asset"]),u=i(["side","direction","type","action"]),m=i(["entry","open","price","entryprice"]),p=i(["exit","close","exitprice"]),x=i(["pnl","profit","gain","result"]);if(c===-1&&o.push(s==="fr"?'Colonne "Date" manquante':'Missing "Date" column'),d===-1&&o.push(s==="fr"?'Colonne "Symbol" manquante':'Missing "Symbol" column'),u===-1&&o.push(s==="fr"?'Colonne "Side/Direction" manquante':'Missing "Side/Direction" column'),m===-1&&o.push(s==="fr"?'Colonne "Entry Price" manquante':'Missing "Entry Price" column'),o.length>0)return{success:!1,trades:[],errors:o,warnings:a,summary:{totalRows:r.length-1,validTrades:0,invalidTrades:0,skippedRows:0}};for(let f=1;f<r.length;f++){const v=r[f].split(",").map(h=>h.trim().replace(/"/g,""));try{const h={id:`imported-${Date.now()}-${f}`,date:v[c]||new Date().toISOString().split("T")[0],symbol:v[d]||"UNKNOWN",side:v[u]?.toLowerCase().includes("buy")||v[u]?.toLowerCase().includes("long")?"long":"short",entryPrice:parseFloat(v[m])||0,exitPrice:p!==-1&&parseFloat(v[p])||void 0,pnl:x!==-1&&parseFloat(v[x])||0,quantity:1,status:"closed",strategy:"",notes:"",tags:["imported"],profileId:"temp-profile-id",isImported:!0};if(h.entryPrice<=0){a.push(`${s==="fr"?"Ligne":"Line"} ${f+1}: ${s==="fr"?"Prix d'entrÃ©e invalide":"Invalid entry price"}`);continue}n.push(h)}catch{a.push(`${s==="fr"?"Ligne":"Line"} ${f+1}: ${s==="fr"?"Erreur de parsing":"Parsing error"}`)}}return{success:n.length>0,trades:n,errors:o,warnings:a,summary:{totalRows:r.length-1,validTrades:n.length,invalidTrades:r.length-1-n.length,skippedRows:0}}}function rh(t,s="UTF-8"){return new Promise((r,l)=>{const n=new FileReader;n.onload=o=>r(o.target?.result),n.onerror=()=>l(new Error("File read error")),n.readAsText(t,s)})}function oh(t,s={}){const r=s.separator??",",l=["Date","Symbol","Side","Entry Price","Exit Price","P&L"],n=t.map(a=>[a.date,a.symbol,a.side,String(a.entryPrice??""),String(a.exitPrice??""),String(a.pnl??0)]),o=[l,...n].map(a=>a.join(r)).join(`
`);return s.includeHeaders===!1?n.map(a=>a.join(r)).join(`
`):o}function nh(t,s){return[["Metric","Value"],["Total Trades",String(t.totalTrades)],["Win Rate",`${t.winRate.toFixed(2)}%`],["Total P&L",`${t.totalPnL.toFixed(2)} ${s.currency}`],["Profit Factor",t.profitFactor===1/0?"âˆž":t.profitFactor.toFixed(2)]].map(l=>l.join(",")).join(`
`)}const lh=({currentTheme:t,currentLanguage:s,selectedBroker:r,setSelectedBroker:l,isImporting:n,fileInputRef:o,onFileSelect:a,importResult:i,showPreview:c,onTogglePreview:d,previewData:u,onConfirmImport:m})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4 theme-text",children:s==="fr"?"ðŸ“¥ Importer des Trades depuis un fichier CSV":"ðŸ“¥ Import Trades from CSV file"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 theme-text-muted",children:s==="fr"?"Format de fichier":"File format"}),e.jsxs("select",{value:r,onChange:p=>l(p.target.value),className:"w-full px-3 py-2 border theme-border rounded-md focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},children:[e.jsx("option",{value:"auto",children:s==="fr"?"DÃ©tection automatique":"Auto-detect"}),e.jsx("option",{value:"mt4",children:"MetaTrader 4/5"}),e.jsx("option",{value:"tradingview",children:"TradingView"}),e.jsx("option",{value:"interactive_brokers",children:"Interactive Brokers"}),e.jsx("option",{value:"etoro",children:"eToro"})]})]}),e.jsxs("div",{className:"border-2 border-dashed theme-border rounded-lg p-8 text-center theme-surface transition-colors",children:[e.jsx(ml,{size:48,className:"mx-auto mb-4 text-gray-400 dark:text-gray-500"}),e.jsx("h4",{className:"text-lg font-medium mb-2 theme-text",children:s==="fr"?"SÃ©lectionner un fichier CSV":"Select a CSV file"}),e.jsx("p",{className:"mb-4 theme-text-muted",children:s==="fr"?"Glissez-dÃ©posez votre fichier ou cliquez pour parcourir":"Drag and drop your file or click to browse"}),e.jsx("button",{onClick:()=>o.current?.click(),disabled:n,className:"px-6 py-2 theme-text rounded-lg transition-colors disabled:opacity-50",style:{backgroundColor:"var(--theme-accent)"},onMouseEnter:p=>{p.currentTarget.style.backgroundColor="var(--theme-accent-hover)"},onMouseLeave:p=>{p.currentTarget.style.backgroundColor="var(--theme-accent)"},children:n?s==="fr"?"Import en cours...":"Importing...":s==="fr"?"Choisir un fichier":"Choose a file"}),e.jsx("input",{ref:o,type:"file",accept:".csv",onChange:a,className:"hidden"})]}),i&&e.jsx("div",{className:"mt-6",children:i.success?e.jsxs("div",{className:"p-4 border rounded-lg",style:{backgroundColor:`${t.colors.success}20`,borderColor:t.colors.success},children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(Or,{size:20,style:{color:t.colors.success}}),e.jsx("h4",{className:"font-medium",style:{color:t.colors.success},children:s==="fr"?"Import rÃ©ussi !":"Import successful!"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.success},children:i.summary.validTrades}),e.jsx("div",{className:"text-sm theme-text-muted",children:s==="fr"?"Trades valides":"Valid trades"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.danger},children:i.summary.invalidTrades}),e.jsx("div",{className:"text-sm theme-text-muted",children:s==="fr"?"Trades invalides":"Invalid trades"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.warning},children:i.summary.skippedRows}),e.jsx("div",{className:"text-sm theme-text-muted",children:s==="fr"?"Lignes ignorÃ©es":"Skipped rows"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.info},children:i.summary.totalRows}),e.jsx("div",{className:"text-sm theme-text-muted",children:s==="fr"?"Total lignes":"Total rows"})]})]}),u.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("button",{onClick:d,className:"flex items-center space-x-2 text-sm font-medium transition-colors",style:{color:"var(--theme-accent)"},onMouseEnter:p=>{p.currentTarget.style.color="var(--theme-accent-hover)"},onMouseLeave:p=>{p.currentTarget.style.color="var(--theme-accent)"},children:[c?e.jsx(De,{size:16}):e.jsx(Se,{size:16}),e.jsxs("span",{children:[c?s==="fr"?"Masquer":"Hide":s==="fr"?"AperÃ§u":"Preview"," ",s==="fr"?" des donnÃ©es":" data"]})]}),c&&e.jsx("div",{className:"mt-3 overflow-x-auto theme-surface rounded border theme-border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"theme-surface",children:[e.jsx("th",{className:"px-3 py-2 text-left theme-text",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-left theme-text",children:s==="fr"?"Symbole":"Symbol"}),e.jsx("th",{className:"px-3 py-2 text-left theme-text",children:"Direction"}),e.jsx("th",{className:"px-3 py-2 text-left theme-text",children:"P&L"}),e.jsx("th",{className:"px-3 py-2 text-left theme-text",children:s==="fr"?"StratÃ©gie":"Strategy"})]})}),e.jsx("tbody",{children:u.map((p,x)=>e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-600",children:[e.jsx("td",{className:"px-3 py-2 theme-text",children:p.date}),e.jsx("td",{className:"px-3 py-2 theme-text",children:p.symbol}),e.jsx("td",{className:"px-3 py-2 theme-text",children:p.side}),e.jsx("td",{className:"px-3 py-2 theme-text",children:p.pnl?.toFixed?p.pnl.toFixed(2):p.pnl??"N/A"}),e.jsx("td",{className:"px-3 py-2 theme-text",children:p.strategy})]},x))})]})})]}),i.warnings.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"font-medium mb-2",style:{color:"var(--theme-warning)"},children:s==="fr"?"Avertissements :":"Warnings:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:i.warnings.map((p,x)=>e.jsx("li",{className:"text-sm",style:{color:"var(--theme-warning)"},children:p},x))})]}),e.jsx("button",{onClick:m,className:"w-full px-4 py-2 text-white rounded-lg transition-colors",style:{backgroundColor:"var(--theme-success)"},onMouseEnter:p=>{p.currentTarget.style.backgroundColor="var(--theme-success-hover)"},onMouseLeave:p=>{p.currentTarget.style.backgroundColor="var(--theme-success)"},children:s==="fr"?`Confirmer l'import de ${i.summary.validTrades} trades`:`Confirm import of ${i.summary.validTrades} trades`})]}):e.jsxs("div",{className:"p-4 border rounded-lg",style:{backgroundColor:`${t.colors.danger}20`,borderColor:t.colors.danger},children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(Xt,{size:20,style:{color:t.colors.danger}}),e.jsx("h4",{className:"font-medium",style:{color:t.colors.danger},children:s==="fr"?"Import Ã©chouÃ©":"Import failed"})]}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:i.errors.map((p,x)=>e.jsx("li",{className:"text-sm",style:{color:t.colors.danger},children:p},x))})]})})]})}),ah=({currentLanguage:t,exportOptions:s,setExportOptions:r,tradesCount:l,onExportTrades:n,onExportStats:o,onExportComplete:a})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4 theme-text",children:t==="fr"?"ðŸ“¤ Exporter vos DonnÃ©es CSV":"ðŸ“¤ Export your CSV Data"}),e.jsxs("div",{className:"p-4 theme-surface border theme-border rounded-lg mb-6",children:[e.jsx("h4",{className:"font-medium mb-3 text-gray-900 dark:text-white",children:t==="fr"?"Options d'export CSV":"CSV Export Options"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:t==="fr"?"Format de date":"Date format"}),e.jsxs("select",{value:s.dateFormat,onChange:i=>r(c=>({...c,dateFormat:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"fr",children:t==="fr"?"FranÃ§ais (JJ/MM/AAAA)":"French (DD/MM/YYYY)"}),e.jsx("option",{value:"us",children:t==="fr"?"US (MM/JJ/AAAA)":"US (MM/DD/YYYY)"}),e.jsx("option",{value:"iso",children:"ISO (YYYY-MM-DD)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:t==="fr"?"SÃ©parateur":"Separator"}),e.jsxs("select",{value:s.separator,onChange:i=>r(c=>({...c,separator:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[e.jsx("option",{value:",",children:t==="fr"?"Virgule (,)":"Comma (,)"}),e.jsx("option",{value:";",children:t==="fr"?"Point-virgule (;)":"Semicolon (;)"}),e.jsx("option",{value:"\\t",children:t==="fr"?"Tabulation":"Tab"})]})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:s.includeHeaders,onChange:i=>r(c=>({...c,includeHeaders:i.target.checked})),className:"rounded theme-border focus:ring-2",style:{color:"var(--theme-accent)","--tw-ring-color":"var(--theme-accent)"}}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:t==="fr"?"Inclure les en-tÃªtes":"Include headers"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:s.includeCalculatedFields,onChange:i=>r(c=>({...c,includeCalculatedFields:i.target.checked})),className:"rounded theme-border focus:ring-2",style:{color:"var(--theme-accent)","--tw-ring-color":"var(--theme-accent)"}}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:t==="fr"?"Inclure les champs calculÃ©s":"Include calculated fields"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("button",{onClick:n,disabled:l===0,className:"flex items-center justify-center space-x-2 p-4 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ml,{size:24,className:"text-gray-600 dark:text-gray-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t==="fr"?"Trades CSV":"CSV Trades"}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[l," ","trades"]})]})]}),e.jsxs("button",{onClick:o,disabled:l===0,className:"flex items-center justify-center space-x-2 p-4 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ws,{size:24,className:"text-gray-600 dark:text-gray-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t==="fr"?"Statistiques CSV":"CSV Statistics"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:t==="fr"?"MÃ©triques complÃ¨tes":"Complete metrics"})]})]}),e.jsxs("button",{onClick:a,disabled:l===0,className:"flex items-center justify-center space-x-2 p-4 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(tr,{size:24,className:"text-gray-600 dark:text-gray-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t==="fr"?"Backup JSON":"JSON Backup"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:t==="fr"?"Sauvegarde complÃ¨te":"Complete backup"})]})]})]})]})}),ch=({currentLanguage:t,isGeneratingPDF:s,tradesCount:r,pdfOptions:l,setPdfOptions:n,onGeneratePDF:o})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4 theme-text",children:t==="fr"?"ðŸ“„ GÃ©nÃ©rer un Rapport PDF Professionnel":"ðŸ“„ Generate a Professional PDF Report"}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-800 rounded-lg",children:e.jsx(So,{size:24,className:"text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 dark:text-blue-100",children:t==="fr"?"Rapport Fiscal":"Fiscal Report"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:t==="fr"?"GÃ©nÃ¨re un rapport PDF optimisÃ© pour vos dÃ©clarations fiscales":"Generate a PDF report optimized for your tax declarations"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("div",{className:"font-medium mb-2",children:t==="fr"?"Contenu inclus :":"Content included:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{children:["âœ“ ",t==="fr"?"RÃ©sumÃ© fiscal complet":"Complete fiscal summary"]}),e.jsxs("li",{children:["âœ“ ",t==="fr"?"Gains et pertes par mois":"Gains and losses by month"]}),e.jsxs("li",{children:["âœ“ ",t==="fr"?"Liste dÃ©taillÃ©e des trades":"Detailed trades list"]}),e.jsxs("li",{children:["âœ“ ",t==="fr"?"Statistiques de performance":"Performance statistics"]})]})]}),e.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("div",{className:"font-medium mb-2",children:t==="fr"?"Format :":"Format:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{children:["â€¢ ",t==="fr"?"PDF professionnel":"Professional PDF"]}),e.jsxs("li",{children:["â€¢ ",t==="fr"?"PrÃªt pour impression":"Print ready"]}),e.jsxs("li",{children:["â€¢ ",t==="fr"?"Compatible dÃ©clarations":"Tax declaration compatible"]}),e.jsxs("li",{children:["â€¢ ",t==="fr"?"AnnÃ©e courante":"Current year"]})]})]})]}),e.jsx("button",{onClick:o,disabled:r===0||s,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:t==="fr"?"GÃ©nÃ©ration en cours...":"Generating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(So,{size:20}),e.jsx("span",{children:t==="fr"?"GÃ©nÃ©rer le Rapport Fiscal":"Generate Fiscal Report"})]})})]})}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3 text-gray-900 dark:text-white",children:t==="fr"?"Options du rapport PDF":"PDF Report Options"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:l.includeCharts,onChange:a=>n(i=>({...i,includeCharts:a.target.checked})),className:"rounded theme-border focus:ring-2",style:{color:"var(--theme-accent)","--tw-ring-color":"var(--theme-accent)"}}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:t==="fr"?"Inclure les graphiques de performance":"Include performance charts"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:l.includeDetailedStats,onChange:a=>n(i=>({...i,includeDetailedStats:a.target.checked})),className:"rounded theme-border focus:ring-2",style:{color:"var(--theme-accent)","--tw-ring-color":"var(--theme-accent)"}}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:t==="fr"?"Inclure les statistiques dÃ©taillÃ©es":"Include detailed statistics"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:l.includeTradesList,onChange:a=>n(i=>({...i,includeTradesList:a.target.checked})),className:"rounded theme-border focus:ring-2",style:{color:"var(--theme-accent)","--tw-ring-color":"var(--theme-accent)"}}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:t==="fr"?"Inclure la liste des trades":"Include trades list"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:l.includeFiscalSummary,onChange:a=>n(i=>({...i,includeFiscalSummary:a.target.checked})),className:"rounded theme-border focus:ring-2",style:{color:"var(--theme-accent)","--tw-ring-color":"var(--theme-accent)"}}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:t==="fr"?"Inclure le rÃ©sumÃ© fiscal":"Include fiscal summary"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:l.language==="en",onChange:a=>n(i=>({...i,language:a.target.checked?"en":"fr"})),className:"rounded theme-border focus:ring-2",style:{color:"var(--theme-accent)","--tw-ring-color":"var(--theme-accent)"}}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:t==="fr"?"GÃ©nÃ©rer en anglais":"Generate in English"})]})]})]}),s&&e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-600 dark:border-blue-600 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-blue-800 dark:text-blue-200",children:t==="fr"?"GÃ©nÃ©ration du rapport PDF en cours...":"Generating PDF report..."})]})}),r===0&&e.jsx("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--theme-warning)10",borderColor:"var(--theme-warning)30",border:"1px solid var(--theme-warning)30"},children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Xt,{size:20,style:{color:"var(--theme-warning)"}}),e.jsx("span",{style:{color:"var(--theme-warning)"},children:t==="fr"?"Aucun trade disponible pour gÃ©nÃ©rer un rapport":"No trades available to generate a report"})]})})]})}),ih=({isOpen:t,onClose:s,trades:r,settings:l,onImportTrades:n})=>{const{currentTheme:o}=Q(),{currentLanguage:a}=Z(),[i,c]=g.useState("import"),[d,u]=g.useState(null),[m,p]=g.useState(!1),[x,f]=g.useState(!1),[v,h]=g.useState("auto"),[b,j]=g.useState(!1),[y,N]=g.useState([]),w=g.useRef(null),[S,k]=g.useState({includeHeaders:!0,dateFormat:"fr",separator:",",encoding:"utf-8-bom",includeCalculatedFields:!0}),[C,P]=g.useState({includeCharts:!0,includeTradesList:!0,includeDetailedStats:!0,includeFiscalSummary:!0,template:"professional",language:a});if(!t)return null;const R=async B=>{const O=B.target.files?.[0];if(O){p(!0),u(null);try{const z=await rh(O),q=sh(z,a);u(q),q.success&&q.trades.length>0&&N(q.trades.slice(0,5))}catch(z){u({success:!1,trades:[],errors:[`${a==="fr"?"Erreur":"Error"}: ${z instanceof Error?z.message:a==="fr"?"Erreur inconnue":"Unknown error"}`],warnings:[],summary:{totalRows:0,validTrades:0,invalidTrades:0,skippedRows:0}})}finally{p(!1)}}},M=()=>{d?.trades&&(n(d.trades),u(null),s())},T=()=>{const B=oh(r,{separator:S.separator,includeHeaders:S.includeHeaders}),O=new Blob([B],{type:"text/csv"}),z=URL.createObjectURL(O),q=document.createElement("a");q.href=z,q.download=`trades_${new Date().toISOString().split("T")[0]}.csv`,q.click(),URL.revokeObjectURL(z)},D=()=>{const B=zo(r,l),O=nh(B,l),z=new Blob([O],{type:"text/csv"}),q=URL.createObjectURL(z),E=document.createElement("a");E.href=q,E.download=`stats_${new Date().toISOString().split("T")[0]}.csv`,E.click(),URL.revokeObjectURL(q)},F=()=>{const B={trades:r,stats:zo(r,l),exportDate:new Date().toISOString(),version:"2.0.0"},O=JSON.stringify(B,null,2),z=new Blob([O],{type:"application/json"}),q=URL.createObjectURL(z),E=document.createElement("a");E.href=q,E.download=`backup_${new Date().toISOString().split("T")[0]}.json`,E.click(),URL.revokeObjectURL(q)},$=async()=>{f(!0);try{const B=r.map(z=>({date:z.date,symbol:z.symbol,side:z.side,entryPrice:z.entryPrice,exitPrice:z.exitPrice,pnl:z.pnl||0,quantity:z.quantity||1,fees:z.fees})),O=new Date().getFullYear().toString();await th(B,O,"Compte de Trading",l.currency,"Trader","Utilisateur")}catch(B){console.error("Erreur gÃ©nÃ©ration PDF fiscal:",B),alert(a==="fr"?"Erreur lors de la gÃ©nÃ©ration du PDF":"Error generating PDF")}finally{f(!1)}},U={role:"dialog","aria-modal":!0,"aria-labelledby":"import-export-modal-title"};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",...U,children:e.jsxs("div",{className:"theme-surface rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] flex flex-col border theme-border",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b theme-border theme-surface",children:[e.jsx("h2",{id:"import-export-modal-title",className:"text-xl font-semibold theme-text",children:a==="fr"?"Import / Export des DonnÃ©es":"Data Import / Export"}),e.jsx("button",{onClick:s,className:"theme-text-muted hover:theme-text transition-colors",children:e.jsx(Ne,{size:24})})]}),e.jsx("div",{className:"flex border-b theme-border theme-surface",children:[{key:"import",icon:wr,label:a==="fr"?"Import CSV":"CSV Import"},{key:"export",icon:cr,label:a==="fr"?"Export CSV":"CSV Export"},{key:"pdf",icon:So,label:a==="fr"?"Rapport PDF":"PDF Report"}].map(({key:B,icon:O,label:z})=>e.jsxs("button",{onClick:()=>c(B),className:`flex items-center px-6 py-3 text-sm font-medium transition-colors border-b-2 ${i===B?"theme-text border-b-2":"theme-text-muted border-transparent hover:theme-text"}`,style:{color:i===B?"var(--theme-accent)":void 0,borderBottomColor:i===B?"var(--theme-accent)":void 0},children:[e.jsx(O,{size:16,className:"mr-2"}),z]},B))}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 theme-surface",children:[i==="import"&&e.jsx(lh,{currentTheme:o,currentLanguage:a,selectedBroker:v,setSelectedBroker:h,isImporting:m,fileInputRef:w,onFileSelect:R,importResult:d,showPreview:b,onTogglePreview:()=>j(!b),previewData:y,onConfirmImport:M}),i==="export"&&e.jsx(ah,{currentLanguage:a,exportOptions:S,setExportOptions:k,tradesCount:r.length,onExportTrades:T,onExportStats:D,onExportComplete:F}),i==="pdf"&&e.jsx(ch,{currentLanguage:a,isGeneratingPDF:x,tradesCount:r.length,pdfOptions:C,setPdfOptions:P,onGeneratePDF:$})]}),e.jsx("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:a==="fr"?"Fermer":"Close"})})]})})},dh=({showSettings:t,showProfileModal:s,showDemoData:r,showImportExport:l,showStatsDisplaySettings:n,isActiveFiltersModalOpen:o,onCloseSettings:a,onCloseProfileModal:i,onCloseDemoData:c,onCloseImportExport:d,onCloseStatsDisplaySettings:u,setIsActiveFiltersModalOpen:m,currentSettings:p,activeProfile:x,updateProfile:f,editingProfile:v,handleUpdateProfile:h,handleCreateProfile:b,closeProfileModal:j,profileTrades:y,handleImportTrades:N,onLoadDemoData:w,onClearData:S,activeFilters:k,onNavigateToFilter:C,onResetFilter:P})=>e.jsxs(e.Fragment,{children:[t&&e.jsx(Jp,{isOpen:t,onClose:a,settings:p,onSettingsChange:R=>{x&&f(x.id,{...x,settings:R})}}),s&&e.jsx(Ra,{profile:v||void 0,onSubmit:v?h:b,onClose:j}),r&&e.jsx(Xp,{isOpen:r,onClose:c,onLoadData:w,onClearData:S}),l&&e.jsx(ih,{isOpen:l,onClose:d,trades:y,onImportTrades:N,settings:p}),n&&e.jsx(Ta,{onClose:u,settings:p,onSettingsChange:R=>{x&&f(x.id,{...x,settings:R})}}),e.jsx(Da,{isOpen:o,onClose:()=>m(!1),activeFilters:k,onNavigateToFilter:C,onResetFilter:P})]}),el=({children:t})=>{const[s,r]=g.useState(!1),[l,n]=g.useState(null),[o,a]=g.useState(null);return g.useEffect(()=>{const i=d=>{if(d.message&&(d.message.includes("CORS")||d.message.includes("SameSite")||d.message.includes("ahoy_")||d.message.includes("sentry-cdn")||d.message.includes("onMessage"))){console.warn("ðŸŸ¡ Non-critical error filtered:",d.message);return}console.error("ðŸ”´ CRITICAL ERROR DETECTED:",d.error),r(!0),n(d.error),a({stack:d.error?.stack})},c=d=>{if(d.reason&&typeof d.reason=="string"&&(d.reason.includes("CORS")||d.reason.includes("onMessage")||d.reason.includes("sentry-cdn"))){console.warn("ðŸŸ¡ Non-critical promise rejection filtered:",d.reason);return}console.error("ðŸ”´ CRITICAL PROMISE REJECTION:",d.reason),r(!0),n(new Error(d.reason))};return window.addEventListener("error",i),window.addEventListener("unhandledrejection",c),()=>{window.removeEventListener("error",i),window.removeEventListener("unhandledrejection",c)}},[]),s?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f8f9fa",color:"#212529",padding:"20px"},children:e.jsxs("div",{style:{maxWidth:"600px",backgroundColor:"white",padding:"30px",borderRadius:"10px",boxShadow:"0 10px 25px rgba(0,0,0,0.1)",border:"1px solid #dee2e6"},children:[e.jsx("h1",{style:{fontSize:"24px",marginBottom:"20px",color:"#dc3545"},children:"ðŸ”´ Application Error Detected"}),e.jsx("p",{style:{marginBottom:"15px"},children:"A critical error has been detected. Here are the technical details:"}),e.jsxs("div",{style:{backgroundColor:"#f3f4f6",padding:"15px",borderRadius:"5px",marginBottom:"20px",fontFamily:"monospace",fontSize:"14px",overflow:"auto",maxHeight:"300px"},children:[e.jsx("strong",{children:"Error:"})," ",l?.message||"Unknown error",e.jsx("br",{}),e.jsx("strong",{children:"Stack :"}),e.jsx("br",{}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",margin:"10px 0"},children:l?.stack||o?.stack||"No stack trace available"})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>window.location.reload(),style:{backgroundColor:"#3b82f6",color:"white",padding:"10px 20px",border:"none",borderRadius:"5px",cursor:"pointer"},children:"ðŸ”„ Reload Application"}),e.jsx("button",{onClick:()=>{r(!1),n(null),a(null)},style:{backgroundColor:"#10b981",color:"white",padding:"10px 20px",border:"none",borderRadius:"5px",cursor:"pointer"},children:"âœ… Try Again"})]})]})}):e.jsx(e.Fragment,{children:t})},uh=({initialFilters:t,trades:s})=>{const[r,l]=g.useState(t||{}),[n,o]=g.useState(!1),[a,i]=g.useState(null),[c,d]=g.useState(!1),u=g.useMemo(()=>{try{return zr(s,r)}catch(f){return console.error("ðŸ”´ Error applying filters:",f),s}},[s,r]),m=g.useCallback((f,v)=>{d(!1),i({category:f,section:v}),o(!0)},[]),p=g.useCallback((f,v)=>{const b={dateRange:"dateRange",timeRange:"timeRange",sessions:"sessions",months:"months",weekdays:"weekdays",hours:"hours",symbol:"symbol",strategy:"strategy",trend:"trend",side:"side",status:"status",market:"market",pnlRange:"pnlRange",durationRange:"durationRange",tradeResult:"tradeResult",feesRange:"feesRange",contractsRange:"contractsRange",lotsRange:"lotsRange",ticksRange:"ticksRange",tags:"tags"}[v];b&&l(j=>{const y={...j};return delete y[b],y})},[]),x=g.useMemo(()=>Ma(r),[r]);return{filters:r,setFilters:l,filtersMode:n,setFiltersMode:o,filterNavigation:a,setFilterNavigation:i,isActiveFiltersModalOpen:c,setIsActiveFiltersModalOpen:d,handleNavigateToFilter:m,handleResetFilter:p,filteredTrades:u,activeFiltersList:x}},mh=({trades:t,setTrades:s,activeProfile:r,setActiveProfile:l,createProfile:n,t:o})=>{const[a,i]=g.useState(!1),[c,d]=g.useState(!1),[u,m]=g.useState(null),p=g.useCallback(y=>{if(!r){alert(o.selectProfileFirst);return}const N={...y,id:Date.now().toString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),...y,profileId:r.id};s(w=>[N,...w]),i(!1)},[r,s,o]),x=g.useCallback(y=>{if(!u||!r)return;const N={...y,id:u.id,createdAt:u.createdAt,updatedAt:new Date().toISOString(),...y,profileId:r.id};s(w=>w.map(S=>S.id===u.id?N:S)),m(null),i(!1)},[u,r,s]),f=g.useCallback(y=>{window.confirm(o.confirmDelete)&&s(N=>N.filter(w=>w.id!==y))},[s,o]),v=g.useCallback(y=>{if(!r){alert(o.selectProfileFirst);return}const N=y.map(w=>({...w,profileId:r.id}));s(w=>[...w,...N]),alert(o.importSuccess.replace("{count}",y.length.toString()))},[r,s,o]),h=g.useCallback(()=>{window.confirm(o.confirmClearData)&&s(()=>[])},[s,o]),b=g.useCallback(y=>{m(y),i(!0)},[]),j=g.useCallback(()=>{i(!1),m(null)},[]);return{showForm:a,setShowForm:i,showFormV2:c,setShowFormV2:d,editingTrade:u,setEditingTrade:m,handleAddTrade:p,handleEditTrade:x,handleDeleteTrade:f,handleImportTrades:v,handleClearAllData:h,openEditForm:b,closeForm:j}},xh=({setFilters:t,setFiltersMode:s,setFilterNavigation:r})=>{g.useEffect(()=>{const l=n=>{try{const o=n?.detail?.strategy;if(!o)return;t(a=>({...a,strategy:[o]})),setTimeout(()=>{s(!0),r({category:"market",section:"strategies"})},100)}catch(o){console.error("Failed to handle open-filters-for-strategy event",o)}};return window.addEventListener("open-filters-for-strategy",l),()=>window.removeEventListener("open-filters-for-strategy",l)},[t,s,r])},fh=t=>({totalTrades:0,winningTrades:0,losingTrades:0,winRate:0,totalPnL:0,totalPnLPercentage:0,averageWin:0,averageLoss:0,averageWinPercentage:0,averageLossPercentage:0,profitFactor:0,largestWin:0,largestLoss:0,largestWinPercentage:0,largestLossPercentage:0,averageRiskReward:0,currentCapital:t.initialCapital,initialCapital:t.initialCapital,totalReturn:0,averageDuration:0,shortestTrade:0,longestTrade:0,averageWinDuration:0,averageLossDuration:0,totalTicks:0,averageTicksPerTrade:0,averageWinTicks:0,averageLossTicks:0,bestTickCapture:0,worstTickCapture:0,tickEfficiency:0,totalFees:0,averageFeesPerTrade:0,feesAsPercentageOfPnL:0,totalCommissions:0,totalSpreads:0,totalSwapFees:0,feesImpactOnProfitability:0,totalLots:0,averageLotsPerTrade:0,maxLotsInSingleTrade:0,averageLotsWinningTrades:0,averageLotsLosingTrades:0,maxDrawdown:0,maxDrawdownPercentage:0,tradesPerDay:0,sharpeRatio:0,monthlyReturn:0,consistencyScore:0,calmarRatio:0,recoveryFactor:0,expectancy:0,expectancyPercentage:0,averageTradesPerMonth:0,bestMonth:0,worstMonth:0,consecutiveWins:0,consecutiveLosses:0,maxConsecutiveWins:0,maxConsecutiveLosses:0,tpCount:0,slCount:0,beCount:0,tpWinRate:0,slWinRate:0,beWinRate:0}),ph=({activeProfile:t,currentSettings:s,isElectron:r,filters:l,filtersMode:n,onToggleFilters:o,onResetFilters:a,onOpenActiveFiltersModal:i,profileTrades:c,onOpenForm:d,onOpenFormV2:u,onOpenFormV3:m,onOpenDemoData:p})=>{const{currentTheme:x}=Q(),{t:f,currentLanguage:v}=Z();return e.jsx("header",{className:"shadow-sm border-b theme-border",style:{backgroundColor:x.colors.surface},children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsx("div",{className:"flex items-center space-x-6",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold theme-text",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx("span",{children:f.appTitle})}),r&&e.jsxs("span",{className:"text-sm ml-2 theme-text-muted",children:["(",f.desktop,")"]})]}),t&&e.jsxs("p",{className:"mt-1 theme-text-muted",children:[t.name," â€¢ ",f.capital,": ",s.initialCapital.toLocaleString(v==="en"?"en-US":"fr-FR")," ",s.currency]})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:p,className:"flex items-center space-x-2 p-2 transition-colors rounded-lg theme-text-muted hover:theme-surface",title:f.loadDemoData,children:[e.jsx(tr,{size:20}),e.jsx("span",{className:"hidden sm:inline text-sm",children:f.demo})]}),e.jsx("div",{className:"relative flex items-center",children:(()=>{const h=()=>{try{const k=localStorage.getItem("addTradePreferredForm");if(k==="v1"||k==="v2"||k==="v3")return k}catch{}return"v3"},[b,j]=V.useState(!1),[y,N]=V.useState(h),w=()=>{t&&(y==="v3"?m():y==="v2"?u():d())},S=k=>{N(k);try{localStorage.setItem("addTradePreferredForm",k)}catch{}j(!1),t&&(k==="v3"?m():k==="v2"?u():d())};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:w,disabled:!t,className:"inline-flex items-center px-4 py-2 rounded-l-lg transition-all duration-200 shadow-sm disabled:opacity-50 disabled:cursor-not-allowed border btn-secondary",title:v==="fr"?"Ajouter un trade":"Add trade",children:[e.jsx(Je,{size:20,className:"mr-2"}),f.newTrade]}),e.jsx("button",{onClick:()=>j(k=>!k),disabled:!t,className:"px-2 py-2 rounded-r-lg transition-all duration-200 shadow-sm disabled:opacity-50 disabled:cursor-not-allowed border",style:{backgroundColor:x.colors.surface,color:x.colors.text,borderColor:x.colors.border},"aria-haspopup":"menu","aria-expanded":b,title:v==="fr"?"Choisir le mode":"Choose mode",children:e.jsx($e,{size:16})}),b&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-44 rounded-md shadow-lg border z-20",style:{backgroundColor:x.colors.card,borderColor:x.colors.border},role:"menu",children:[e.jsx("button",{onClick:()=>S("v1"),className:"w-full text-left px-3 py-2 text-sm hover:opacity-90",style:{color:x.colors.text},role:"menuitem",children:v==="fr"?"Form v1 (classique)":"Form v1 (classic)"}),e.jsx("button",{onClick:()=>S("v2"),className:"w-full text-left px-3 py-2 text-sm hover:opacity-90",style:{color:x.colors.text},role:"menuitem",children:v==="fr"?"Form v2 (wizard impÃ©ratif)":"Form v2 (imperative wizard)"}),e.jsx("button",{onClick:()=>S("v3"),className:"w-full text-left px-3 py-2 text-sm hover:opacity-90",style:{color:x.colors.text},role:"menuitem",children:v==="fr"?"Form v3 (wizard dÃ©claratif)":"Form v3 (declarative wizard)"})]})]})})()}),e.jsxs("button",{onClick:()=>{n&&a(),o()},className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-all duration-200 shadow-sm border ${n?"text-white":"btn-secondary hover:theme-surface"}`,style:{backgroundColor:n?"var(--theme-accent)":void 0,borderColor:n?"var(--theme-accent)":void 0},onMouseEnter:h=>{n&&(h.currentTarget.style.backgroundColor="var(--theme-accent-hover)")},onMouseLeave:h=>{n&&(h.currentTarget.style.backgroundColor="var(--theme-accent)")},title:n?v==="fr"?"DÃ©sactiver les filtres":"Disable filters":v==="fr"?"Activer les filtres":"Enable filters",children:[e.jsx(cs,{size:20,className:"mr-2"}),e.jsx("span",{className:"text-sm font-medium",children:v==="fr"?"Filtres":"Filters"}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full ml-1"}),e.jsx(as,{size:16,className:"ml-1"})]})]}),t&&!n&&e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 theme-surface rounded-lg border theme-border",children:[e.jsx("span",{className:"text-xs font-medium theme-text-secondary",children:c.length}),e.jsx("span",{className:"text-xs theme-text-muted",children:"trades"})]}),t&&n&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 theme-surface rounded-lg border theme-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs font-medium theme-text-secondary",children:`${zr(c,l).length}/${c.length}`}),e.jsx("span",{className:"text-xs theme-text-muted",children:v==="fr"?"trades filtrÃ©s":"filtered trades"})]}),e.jsxs("div",{className:"text-xs font-bold theme-text-secondary",children:[(()=>{const h=zr(c,l);return c.length>0?Math.round(h.length/c.length*100):0})(),"%"]})]}),e.jsxs("button",{onClick:i,className:`flex items-center space-x-2 px-3 py-2 rounded-lg border transition-all duration-200 cursor-pointer group ${Ts(l)>0?x.id==="ultra-dark"?"bg-indigo-900/20 border-indigo-800 hover:bg-indigo-900/30 hover:border-indigo-500 hover:shadow-md hover:ring-2 hover:ring-indigo-800":x.id==="dark"?"bg-blue-900/20 border-blue-800 hover:bg-blue-900/30 hover:border-blue-500 hover:shadow-md hover:ring-2 hover:ring-blue-800":"bg-blue-50 border-blue-200 hover:bg-blue-100 hover:border-blue-400 hover:shadow-md hover:ring-2 hover:ring-blue-200":x.id==="ultra-dark"?"theme-surface border theme-border hover:theme-surface hover:shadow-sm hover:border-indigo-600 hover:ring-1 hover:ring-indigo-800":x.id==="dark"?"theme-surface border theme-border hover:theme-surface hover:shadow-sm hover:border-blue-600 hover:ring-1 hover:ring-blue-800":"theme-surface border theme-border hover:theme-surface hover:shadow-sm hover:border-blue-300 hover:ring-1 hover:ring-blue-200"}`,title:v==="fr"?"Cliquer pour voir les filtres actifs et ouvrir les filtres":"Click to see active filters and open filters",children:[e.jsx(Se,{size:14,className:`transition-colors ${Ts(l)>0?x.id==="ultra-dark"?"text-indigo-400 group-hover:text-indigo-300":x.id==="dark"?"text-blue-400 group-hover:text-blue-300":"text-blue-600 group-hover:text-blue-700":"theme-text-muted group-hover:theme-text-secondary"}`}),e.jsx("span",{className:`text-xs font-medium transition-colors ${Ts(l)>0?x.id==="ultra-dark"?"text-indigo-300 group-hover:text-indigo-200":x.id==="dark"?"text-blue-300 group-hover:text-blue-200":"text-blue-700 group-hover:text-blue-800":"theme-text-secondary group-hover:theme-text"}`,children:Ts(l)}),e.jsx("span",{className:`text-xs transition-colors ${Ts(l)>0?x.id==="ultra-dark"?"text-indigo-400 group-hover:text-indigo-300":x.id==="dark"?"text-blue-400 group-hover:text-blue-300":"text-blue-600 group-hover:text-blue-700":"theme-text-muted group-hover:theme-text-secondary"}`,children:v==="fr"?"filtres actifs":"active filters"})]})]})]})]})})})},Ea="trading-journal-trades";function hh(){try{const t=window.localStorage.getItem(Ea);return t?JSON.parse(t):[]}catch{return[]}}function gh(t){try{window.localStorage.setItem(Ea,JSON.stringify(t))}catch{}}function yh(t){const s=hh();s.push(t),gh(s)}function ko(t,s){return t??s}function ct(t){if(t==null||t==="")return;const s=typeof t=="number"?t:Number(t);return Number.isFinite(s)?s:void 0}function bh(t,s){const r=new Date().toISOString(),l=`t_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,n=ct(t.entryPrice)??0,o=ct(t.exitPrice),a=ct(t.quantity)??0,i=ct(t.tickSize),c=ct(t.tickValue),d=ma(t,{equity:t.equity});return{id:l,date:ko(t.date,t.entryDate||r.slice(0,10)),time:ko(t.time,t.entryTime||"00:00:00"),entryDate:t.entryDate,exitDate:t.exitDate,entryTime:t.entryTime,exitTime:t.exitTime,symbol:String(ko(t.symbol,"")),side:t.side==="short"?"short":"long",market:t.market||"futures",status:t.status==="open"?"open":"closed",entryPrice:n,exitPrice:o,quantity:a,quantityUnit:"contracts",tickSize:i,tickValue:c,pnl:d.pnlNet?Number(d.pnlNet.toString()):void 0,pnlPercentage:d.pnlPct?Number(d.pnlPct.toString()):void 0,riskReward:ct(t.riskReward),riskRewardRatio:ct(t.riskReward),strategy:String(t.strategy||""),timeframe:t.timeframe,trend:t.trend==="bearish"||t.trend==="sideways"?t.trend:"bullish",setup:String(t.setup||""),notes:t.notesAndPsycho||t.notes||"",tags:Array.isArray(t.tags)?t.tags:[],fees:{commission:ct(t.fees?.commission??t.fees_commission),spread:ct(t.fees?.spread??t.fees_spread_slippage),swapOvernight:ct(t.fees?.swapOvernight??t.fees_swap_overnight),exchangeFees:ct(t.fees?.exchangeFees),regulatoryFees:ct(t.fees?.regulatoryFees),otherFees:ct(t.fees?.other??t.fees_other),total:d.totalFees?Number(d.totalFees.toString()):void 0,spread_slippage:ct(t.fees?.spread_slippage??t.fees_spread_slippage),swap_overnight:ct(t.fees?.swap_overnight??t.fees_swap_overnight),other:ct(t.fees?.other??t.fees_other)},tradeResult:t.tradeResult||"",createdAt:r,updatedAt:r,profileId:s}}function vh(t,s){try{const r=bh(t,s);return yh(r),{ok:!0,trade:r}}catch(r){return{ok:!1,error:r instanceof Error?r.message:"Unknown error"}}}const jh=({onSelect:t})=>{const{currentTheme:s}=Q(),r=({label:l,mode:n})=>e.jsx("button",{onClick:()=>t?.(n),className:"px-3 py-2 rounded-lg border text-sm hover:shadow-md transition-shadow",style:{backgroundColor:s.colors.surface,color:s.colors.text,borderColor:s.colors.border},children:l});return e.jsxs("div",{className:"rounded-xl border p-3 flex flex-col gap-2",style:{backgroundColor:s.colors.card,borderColor:s.colors.border},children:[e.jsx("div",{className:"text-xs font-semibold opacity-80",style:{color:s.colors.text},children:"Modes de saisie (WIP)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(r,{mode:"split",label:"Split Flow"}),e.jsx(r,{mode:"deck",label:"Deck Mode"}),e.jsx(r,{mode:"capsule",label:"Quick Capsule"}),e.jsx(r,{mode:"wizard",label:"Wizard (V2+)"})]})]})},Nh=t=>{V.useEffect(()=>{if(t.isOpen)return document.body.setAttribute("data-v3-futures","1"),()=>{document.body.removeAttribute("data-v3-futures")}},[t.isOpen]);const[s,r]=V.useState(null);return V.useEffect(()=>{if(!t.isOpen){r(null);return}let l=!1;const n=()=>{if(!l){try{const a=Array.from(document.querySelectorAll("label")).find(i=>/Personnalisation des champs|Field customization/i.test(i.textContent||""));if(a&&a.parentElement){const i=a.parentElement;let c=i.querySelector("#v3-mode-selector-slot");c||(c=document.createElement("div"),c.id="v3-mode-selector-slot",c.style.marginTop="8px",i.appendChild(c)),r(c);return}}catch{}setTimeout(n,100)}};return n(),()=>{l=!0}},[t.isOpen]),e.jsxs(e.Fragment,{children:[t.isOpen&&e.jsx("style",{children:`
          /* Ã‰largir et sÃ©curiser la hauteur du modal paramÃ¨tres quand ouvert depuis V3 */
          body[data-v3-futures="1"] [class*="max-w-7xl"] { max-width: min(95vw, 1600px) !important; width: 95vw !important; }
          body[data-v3-futures="1"] [class*="h-\\[95vh\\]"] { max-height: 92vh !important; height: auto !important; }
          body[data-v3-futures="1"] [class*="overflow-y-auto"] { overflow-y: auto !important; }
          /* Ajouter un lÃ©ger padding pour Ã©viter la coupe au bord droit sur Ã©crans Ã©troits */
          body[data-v3-futures="1"] .fixed.inset-0 { padding-left: 1.25rem !important; padding-right: 1.25rem !important; }
        `}),e.jsx(da,{...t}),s&&ps.createPortal(e.jsx(jh,{onSelect:()=>{}}),s)]})},tl=({onClose:t})=>{const{currentTheme:s}=Q(),{currentLanguage:r}=Z(),{formData:l,setSettings:n,updateFields:o,settings:a}=xs(),{presets:i,addPreset:c,deletePreset:d,toggleFavorite:u,updatePreset:m,getPreset:p}=jl(),{mode:x,setMode:f}=Ds(),[v,h]=V.useState(!1),[b,j]=V.useState(null),[y,N]=V.useState(!1),[w,S]=V.useState(!1),[k,C]=V.useState(!1),[P,R]=V.useState(!1);V.useEffect(()=>{try{const F=Object.keys(l||{}).length>0,$=!a||String(a.equity??"")==="10000";N(F||!$)}catch{N(!1)}},[l,a]);const M=()=>{o({}),n({equity:1e4}),j(null),N(!1)},T=()=>{if(y){S(!0);return}t()},D=()=>{if(yx(l).length>0){j(r==="fr"?"Certains champs requis sont manquants.":"Some required fields are missing.");return}h(!0);const $=vh(l);h(!1),$.ok?(j(r==="fr"?"Trade ajoutÃ© avec succÃ¨s.":"Trade added successfully."),M(),setTimeout(()=>{j(null),t()},600)):j((r==="fr"?"Erreur: ":"Error: ")+$.error)};return V.useEffect(()=>{const F=$=>{const U=navigator.platform.toUpperCase().includes("MAC");if(U&&$.metaKey&&$.key.toLowerCase()==="s"||!U&&$.ctrlKey&&$.key.toLowerCase()==="s"){$.preventDefault(),v||D();return}$.key==="Escape"&&($.preventDefault(),y?S(!0):t())};return window.addEventListener("keydown",F),()=>window.removeEventListener("keydown",F)},[v,y,l,a]),e.jsxs("div",{className:"w-full rounded-2xl shadow-xl border border-border/50 bg-background/95 flex flex-col overflow-y-auto",style:{backgroundColor:s.colors.card,color:s.colors.text,border:`1px solid ${s.colors.border}`,height:"clamp(700px, 92vh, 960px)"},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",style:{borderColor:s.colors.border,backgroundColor:s.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>R(!0),className:"p-2 rounded-md hover:shadow-sm",style:{border:`1px solid ${s.colors.border}`,backgroundColor:s.colors.surface,color:s.colors.accent},title:r==="fr"?"ParamÃ¨tres du formulaire":"Form settings",children:e.jsx(Bo,{size:16})}),e.jsx("h3",{className:"text-lg font-semibold flex-shrink-0",style:{color:s.colors.text},children:r==="fr"?"Formulaire d'ajout V3 (Test)":"V3 Add Form (Test)"}),e.jsx("div",{className:"ml-4 mr-12",children:e.jsx(ca,{formData:l,presets:i,onLoadPreset:F=>{if(y&&!confirm(r==="fr"?"Ã‰craser les modifications en cours ?":"Override current changes?"))return;const $=p(F);$?.formData&&o($.formData)},onSavePreset:(F,$,U)=>c(F,$,!!U),onDeletePreset:d,onToggleFavorite:u,onManagePresets:()=>C(!0)})}),e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx("label",{style:{color:s.colors.textMuted},children:"Mode:"}),e.jsxs("select",{value:x,onChange:F=>f(F.target.value),className:"px-2 py-1 rounded border",style:{backgroundColor:s.colors.surface,color:s.colors.text,borderColor:s.colors.border},children:[e.jsx("option",{value:"add",children:"Add"}),e.jsx("option",{value:"deck",children:"Deck"}),e.jsx("option",{value:"wizard",children:"Wizard"}),e.jsx("option",{value:"form",children:"Form"})]})]})]}),e.jsx("button",{onClick:T,className:"px-3 py-1 rounded border text-sm",style:{backgroundColor:s.colors.card,borderColor:s.colors.border,color:s.colors.text},children:r==="fr"?"Fermer":"Close"})]}),e.jsxs("div",{className:"flex-1 p-6 space-y-6",children:[x==="add"&&e.jsx(ja,{}),x==="deck"&&e.jsx(ya,{}),x==="wizard"&&e.jsx(va,{}),x==="form"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:s.colors.border,backgroundColor:s.colors.card},children:e.jsx(gt,{sectionId:"instrument-context"})}),e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:s.colors.border,backgroundColor:s.colors.card},children:e.jsx(gt,{sectionId:"position-entry"})}),e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:s.colors.border,backgroundColor:s.colors.card},children:e.jsx(gt,{sectionId:"position-exit"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:s.colors.border,backgroundColor:s.colors.card},children:e.jsx(gt,{sectionId:"risk-reward"})}),e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:s.colors.border,backgroundColor:s.colors.card},children:e.jsx(gt,{sectionId:"notes-screenshots"})})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-background/80 backdrop-blur-md p-4 border-t flex items-center justify-between",style:{borderColor:s.colors.border,backgroundColor:s.colors.surface},children:[e.jsx("div",{className:"text-xs",style:{color:s.colors.textMuted},children:b}),e.jsxs("div",{className:"flex items-center gap-3 ml-auto",children:[e.jsx("button",{onClick:()=>{y?S(!0):(M(),t())},className:"px-4 py-2 rounded border text-sm hover:shadow-md transition-shadow",style:{backgroundColor:"transparent",color:s.colors.text,borderColor:s.colors.border},children:r==="fr"?"Annuler":"Cancel"}),e.jsx("button",{disabled:v||!1,onClick:D,className:"px-4 py-2 rounded border text-sm hover:shadow-md transition-shadow",style:{backgroundColor:s.colors.accent,color:"#fff",borderColor:"transparent",opacity:v?.7:1},children:r==="fr"?"Enregistrer":"Save"})]})]}),w&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsxs("div",{className:"w-full max-w-md rounded-lg shadow-lg p-4",style:{backgroundColor:s.colors.card,color:s.colors.text,border:`1px solid ${s.colors.border}`},children:[e.jsx("h4",{className:"text-base font-semibold mb-2",children:r==="fr"?"Confirmer la sortie":"Confirm exit"}),e.jsx("p",{className:"text-sm mb-4",style:{color:s.colors.textMuted},children:r==="fr"?"Des modifications non sauvegardÃ©es seront perdues. Annuler ou quitter ?":"Unsaved changes will be lost. Cancel or leave?"}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>S(!1),className:"px-3 py-1.5 rounded border text-sm",style:{backgroundColor:"transparent",color:s.colors.text,borderColor:s.colors.border},children:r==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:()=>{M(),S(!1),t()},className:"px-3 py-1.5 rounded border text-sm",style:{backgroundColor:s.colors.accent,color:"#fff",borderColor:"transparent"},children:r==="fr"?"Quitter":"Leave"})]})]})}),k&&e.jsx(ia,{presets:i,onClose:()=>C(!1),onDeletePreset:d,onToggleFavorite:u,onUpdatePreset:m,onLoadPreset:F=>{if(y&&!confirm(r==="fr"?"Ã‰craser les modifications en cours ?":"Override current changes?"))return;const $=p(F);$?.formData&&o($.formData)}}),P&&e.jsx(Nh,{isOpen:P,onClose:()=>R(!1),activeProfileId:null,onOpenEditMode:void 0})]})},kh=({isOpen:t,onClose:s,provideContext:r=!0})=>{const[l,n]=V.useState(!1);return V.useEffect(()=>{n(!!t)},[t]),t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{backgroundColor:"rgba(0,0,0,0.7)"},children:e.jsx("div",{className:`transform transition-transform transition-opacity duration-200 ease-out ${l?"opacity-100 scale-100":"opacity-0 scale-95"}`,style:{width:"clamp(320px, 90vw, 1500px)"},children:r?e.jsx(xa,{children:e.jsx(tl,{onClose:s})}):e.jsx(tl,{onClose:s})})}):null};function wh(){const[t,s]=g.useState(!1),[r,l]=g.useState(null),[n,o]=us("trading-journal-trades",[]),[a,i]=g.useState(!1),[c,d]=g.useState(!1),[u,m]=g.useState(null),[p,x]=g.useState(!1),[f,v]=g.useState(!1),[h,b]=g.useState(!1),[j,y]=g.useState(!1),[N,w]=g.useState(!1),[S,k]=g.useState(!1),[C,P]=g.useState("profiles"),[R,M]=g.useState(!1),[T,D]=g.useState("overview"),[F,$]=g.useState(0),[U,B]=g.useState(!1),[O,z]=g.useState(typeof window<"u"?window.location.hash:""),{currentTheme:q}=Q(),{t:E,currentLanguage:I}=Z(),{isElectron:H}=Bf();if(g.useEffect(()=>{const ce=()=>z(typeof window<"u"?window.location.hash:"");return window.addEventListener("hashchange",ce),()=>window.removeEventListener("hashchange",ce)},[]),O==="#/v3demo")return e.jsx(el,{children:e.jsx("div",{className:"min-h-screen transition-colors theme-bg",children:e.jsx(Vn,{})})});const{profiles:L,activeProfile:A,createProfile:_,updateProfile:J,setActiveProfile:re,handleDeleteProfile:de,showProfileModal:se,editingProfile:ke,handleCreateProfile:be,handleUpdateProfile:he,closeProfileModal:te}=Vf(o),W=A?.settings||{initialCapital:1e4,riskPerTrade:2,currency:I==="en"?"USD":"EUR"},K=g.useMemo(()=>{try{return A?n.filter(ce=>ce.profileId===A.id):[]}catch(ce){return console.error("ðŸ”´ Error filtering profile trades:",ce),[]}},[n,A]),{handleAddTrade:ue,handleEditTrade:ye,handleDeleteTrade:Fe,handleImportTrades:ee,handleClearAllData:oe,openEditForm:ve,closeForm:Y}=mh({trades:n,setTrades:o,activeProfile:A,setActiveProfile:re,createProfile:_,t:E}),{filters:me,setFilters:fe,filtersMode:je,setFiltersMode:X,filterNavigation:ae,setFilterNavigation:ge,isActiveFiltersModalOpen:Ce,setIsActiveFiltersModalOpen:Be,handleNavigateToFilter:Ke,handleResetFilter:Nt,filteredTrades:nt,activeFiltersList:zt}=uh({initialFilters:{},trades:K});xh({setFilters:ce=>fe(pe=>ce(pe)),setFiltersMode:X,setFilterNavigation:ge});const It=g.useMemo(()=>{try{return zo(nt,W)}catch(ce){return console.error("ðŸ”´ Error calculating stats:",ce),fh(W)}},[nt,W]),Vt=g.useMemo(()=>Array.from(new Set(K.map(ce=>ce.strategy).filter(Boolean))),[K]),St=g.useMemo(()=>Array.from(new Set(K.flatMap(ce=>ce.tags))),[K]),Bt=g.useMemo(()=>{const ce=K.map(pe=>pe.timeframe).filter(pe=>typeof pe=="string"&&pe.length>0);return Array.from(new Set(ce))},[K]),es=g.useMemo(()=>{const ce=K.map(pe=>pe.tickEntry).filter(pe=>typeof pe=="string"&&pe.length>0);return Array.from(new Set(ce))},[K]),Ot=g.useMemo(()=>Array.from(new Set(K.map(ce=>ce.symbol))),[K]),Ue=ce=>{try{D(ce)}catch(pe){console.error("ðŸ”´ Error changing tab:",pe)}},ie=g.useCallback((ce,pe)=>{if(console.log("ðŸš€ handleLoadDemoData called:",{tradesCount:ce.length,profile:pe?.name,hasProfile:!!pe}),!pe){console.log("âŒ No profile provided");return}try{console.log("ðŸ“ Creating profile...");const Ee=_(pe);console.log("âœ… Profile created:",Ee.id),console.log("ðŸ”„ Activating profile..."),re(Ee.id),console.log("âœ… Profile activated"),console.log("ðŸ’¾ Loading trades with profileId...");const qe=ce.map(We=>({...We,profileId:Ee.id}));o(()=>qe),console.log("âœ… Trades loaded:",qe.length),console.log("ðŸšª Closing modal..."),b(!1),console.log("âœ… Modal closed")}catch(Ee){console.error("âŒ Error in handleLoadDemoData:",Ee)}},[_,re,o]);return e.jsx(el,{children:e.jsxs("div",{className:"min-h-screen transition-colors theme-bg",children:[e.jsx(ph,{activeProfile:A,currentSettings:W,isElectron:!!H,filters:me,filtersMode:je,onToggleFilters:()=>X(!je),onResetFilters:()=>fe({}),onOpenActiveFiltersModal:()=>Be(!0),profileTrades:K,onOpenForm:()=>i(!0),onOpenFormV2:()=>d(!0),onOpenFormV3:()=>x(!0),onOpenDemoData:()=>b(!0)}),e.jsx("main",{className:`transition-all duration-300 ease-in-out ${U&&!a&&!c&&!p?"ml-72":"ml-0"} ${a||c||p?"pointer-events-none":""} px-4 sm:px-6 lg:px-8 py-8`,children:e.jsx("div",{className:`${U&&!a&&!c&&!p?"":"max-w-7xl mx-auto"}`,children:A?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex space-x-1 p-1 rounded-lg theme-surface",children:[e.jsxs("button",{onClick:()=>Ue("overview"),className:`flex items-center px-4 py-2 rounded-md text-sm font-medium transition-colors ${T==="overview"?"shadow-sm btn-primary":"theme-text-muted hover:theme-text"}`,style:{backgroundColor:T==="overview"?q.colors.accent:"transparent",color:T==="overview"?"#ffffff":q.colors.textSecondary},children:[e.jsx(Se,{size:16,className:"mr-2"}),E.overview]}),e.jsxs("button",{onClick:()=>Ue("stats"),className:`flex items-center px-4 py-2 rounded-md text-sm font-medium transition-colors ${T==="stats"?"shadow-sm btn-primary":"theme-text-muted hover:theme-text"}`,style:{backgroundColor:T==="stats"?q.colors.accent:"transparent",color:T==="stats"?"#ffffff":q.colors.textSecondary},children:[e.jsx(_e,{size:16,className:"mr-2"}),E.statistics]}),e.jsxs("button",{onClick:()=>Ue("charts"),className:`flex items-center px-4 py-2 rounded-md text-sm font-medium transition-colors ${T==="charts"?"shadow-sm btn-primary":"theme-text-muted hover:theme-text"}`,style:{backgroundColor:T==="charts"?q.colors.accent:"transparent",color:T==="charts"?"#ffffff":q.colors.textSecondary},children:[e.jsx(Ae,{size:16,className:"mr-2"}),E.charts]}),e.jsxs("button",{onClick:()=>Ue("trades"),className:`flex items-center px-4 py-2 rounded-md text-sm font-medium transition-colors ${T==="trades"?"shadow-sm btn-primary":"theme-text-muted hover:theme-text"}`,style:{backgroundColor:T==="trades"?q.colors.accent:"transparent",color:T==="trades"?"#ffffff":q.colors.textSecondary},children:[e.jsx(qr,{size:16,className:"mr-2"}),E.tradesList]})]}),T==="stats"&&e.jsx("button",{onClick:()=>M(!0),className:"p-2 rounded-lg hover:theme-surface transition-colors theme-text-muted hover:theme-text",title:I==="fr"?"PrÃ©fÃ©rences d'affichage":"Display preferences",children:e.jsx(ms,{size:20})})]}),e.jsxs("div",{className:"tab-content",children:[O==="#/v3demo"?e.jsx(Vn,{}):T==="overview"&&e.jsx(Jm,{trades:nt,settings:W}),T==="stats"&&e.jsx(bf,{stats:It,settings:W,recentTrades:nt,onEdit:ve,onDelete:Fe,onOpenPreferences:()=>M(!0),title:E.recentTrades}),T==="charts"&&e.jsx(Uf,{trades:nt,settings:W,onEditTrade:ve,onDeleteTrade:Fe}),T==="trades"&&e.jsx(Wf,{trades:nt,settings:W,onEdit:ve,onDelete:Fe})]}),K.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-xl mb-4 theme-text-muted",children:E.noTrades}),e.jsx("p",{className:"mb-8 theme-text-muted",children:E.startRecordingTrades}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>i(!0),className:"inline-flex items-center px-6 py-3 rounded-lg transition-colors btn-primary",children:[e.jsx(Je,{size:20,className:"mr-2"}),E.addFirstTrade]}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"text-sm theme-text-muted",children:E.or})}),e.jsxs("button",{onClick:()=>b(!0),className:"inline-flex items-center px-6 py-3 rounded-lg transition-colors border btn-secondary",children:[e.jsx(tr,{size:20,className:"mr-2"}),E.loadDemoData]})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ho,{size:64,className:"mx-auto mb-4 theme-text-muted"}),e.jsx("h2",{className:"text-2xl font-bold mb-2 theme-text",children:E.noProfileSelected}),e.jsx("p",{className:"mb-8 theme-text-muted",children:E.createSelectProfile}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>k(!0),className:"inline-flex items-center px-6 py-3 rounded-lg transition-colors btn-primary",children:[e.jsx(Je,{size:20,className:"mr-2"}),E.createFirstProfile]}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"text-sm theme-text-muted",children:E.or})}),e.jsxs("button",{onClick:()=>b(!0),className:"inline-flex items-center px-6 py-3 rounded-lg transition-colors border btn-secondary",children:[e.jsx(tr,{size:20,className:"mr-2"}),E.testWithDemoData]})]})]})})}),e.jsx(kh,{isOpen:p,onClose:()=>x(!1)}),a&&e.jsx($c,{trade:u||void 0,onSubmit:u?ye:ue,onClose:Y,settings:W,existingSymbols:Ot,existingTrades:n}),c&&e.jsx(qm,{trade:u||void 0,onSubmit:u?ye:ue,onClose:()=>{d(!1),m(null)},settings:{...W,currentCapital:It.currentCapital},existingSymbols:Ot,existingTrades:n,activeProfileId:A?.id||null,onOpenGlobalSettings:()=>v(!0)}),e.jsx(dh,{showSettings:f,showProfileModal:se,showDemoData:h,showImportExport:N,showStatsDisplaySettings:R,isActiveFiltersModalOpen:Ce,onCloseSettings:()=>v(!1),onCloseProfileModal:te,onCloseDemoData:()=>b(!1),onCloseImportExport:()=>w(!1),onCloseStatsDisplaySettings:()=>M(!1),setIsActiveFiltersModalOpen:Be,currentSettings:W,activeProfile:A,updateProfile:J,editingProfile:ke,handleUpdateProfile:he,handleCreateProfile:be,closeProfileModal:te,profileTrades:K,handleImportTrades:ee,onLoadDemoData:ie,onClearData:oe,activeFilters:zt,onNavigateToFilter:Ke,onResetFilter:Nt}),!a&&!c&&!p&&e.jsx(ip,{isOpen:U,onToggle:()=>B(!U),onOpenSettings:()=>v(!0),onOpenProfileSettings:()=>k(!0),onOpenImportExport:()=>w(!0)}),S&&e.jsx(dp,{profiles:L,activeProfile:A,onProfileChange:ce=>re(ce.id),onCreateProfile:be,onUpdateProfile:he,onDeleteProfile:de,onClose:()=>k(!1),defaultTab:C}),R&&e.jsx(Ta,{onClose:()=>M(!1),settings:W,onSettingsChange:ce=>{A&&J(A.id,{...A,settings:ce})}}),e.jsx(Vp,{isOpen:je,onToggle:()=>X(!je),filters:me,onFiltersChange:fe,availableStrategies:Vt,availableTags:St,availableTimeframes:Bt,availableTickEntries:es,availableTrades:K,navigationRequest:ae,onNavigationComplete:()=>ge(null)})]},F)})}typeof document<"u"&&(document.cookie="ahoy_visitor=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=None; Secure",document.cookie="ahoy_visit=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=None; Secure");const Sh=t=>{if(console.error("ðŸ”´ GLOBAL ERROR CAPTURED:",{message:t.message||t.error?.message,filename:t.filename,lineno:t.lineno,colno:t.colno,stack:t.error?.stack,type:"javascript-error"}),t.message&&(t.message.includes("CORS")||t.message.includes("SameSite")||t.message.includes("cross-origin")||t.message.includes("ahoy_")))return console.warn("ðŸŸ¡ Non-critical error suppressed:",t.message),t.preventDefault(),!1};window.addEventListener("error",t=>{Sh(t)});window.addEventListener("unhandledrejection",t=>{if(console.error("ðŸ”´ UNHANDLED PROMISE REJECTION:",{reason:t.reason,promise:t.promise,type:"promise-rejection"}),t.reason&&typeof t.reason=="string"&&(t.reason.includes("CORS")||t.reason.includes("onMessage")||t.reason.includes("sentry-cdn")||t.reason.includes("cross-origin")))return console.warn("ðŸŸ¡ Non-critical promise rejection suppressed:",t.reason),t.preventDefault(),!1});const wo=document.getElementById("root");if(wo)try{Wa.createRoot(wo).render(e.jsx(V.StrictMode,{children:e.jsx(_a,{children:e.jsx(Va,{children:e.jsx(wh,{})})})}))}catch(t){console.error("ðŸ”´ REACT APPLICATION RENDER FAILED:",t);const s=document.createElement("div");s.style.color="red",s.style.padding="20px",s.style.fontFamily="Arial",s.style.background="white",s.style.minHeight="100vh",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center";const r=document.createElement("pre");r.textContent=t instanceof Error?t.message:"Unknown error",s.textContent="React Render Error: Failed to render application. Check console for details.",s.appendChild(r),wo.appendChild(s)}else{console.error('ðŸ”´ ROOT ELEMENT NOT FOUND! Check that index.html has a div with id="root"');const t=document.createElement("div");t.style.color="red",t.style.padding="20px",t.style.fontFamily="Arial",t.style.background="white",t.style.minHeight="100vh",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.innerText="Application Error: root element not found. Please check your HTML file.",document.body.appendChild(t)}export{Si as F,Ci as L,Ji as N,Z as a,xs as b,Q as u};
