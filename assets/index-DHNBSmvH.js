const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./NotesAndScreenshotsStep-BrkDteei.js","./charts-BPa70Nrz.js","./vendor_react-Dazix4UH.js","./utils-CXH6lFM8.js","./pdf-DQpr2XkM.js","./V3LeverageMarginSection-CECNOeYD.js","./V3FuturesParamsSection-CLGXK843.js"])))=>i.map(i=>d[i]);
import{r as b,j as e,R as O,a as St,m as Ys,L as Ga,A as hn,b as Ms,C as $s,c as as,X as is,Y as vt,T as Yt,d as Wt,e as ks,f as Xt,g as il,B as cl,h as Wr,i as _o,k as Ja,P as dl,l as ul}from"./charts-BPa70Nrz.js";import{a as Ka,g as Ya}from"./vendor_react-Dazix4UH.js";import{D as ws,s as co,i as Xa,b as uo,a as Bs,c as Hs,d as Qa,f as lt,l as xt,e as gn,g as yn}from"./utils-CXH6lFM8.js";import{a as ns}from"./pdf-DQpr2XkM.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();var gr={},bn;function Za(){if(bn)return gr;bn=1;var t=Ka();return gr.createRoot=t.createRoot,gr.hydrateRoot=t.hydrateRoot,gr}var ei=Za();const ti=Ya(ei),Mr={ES:12.5,NQ:5,YM:5,RTY:5,CL:10,GC:10,SI:25,ZB:31.25,ZN:15.625,ZF:7.8125,EURUSD:10,GBPUSD:10,USDJPY:10,USDCHF:10,AUDUSD:10,USDCAD:10,BTCUSD:1,ETHUSD:.1,ADAUSD:1e-4,DEFAULT:1},mo=[{id:"light",name:"Clair",isDark:!1,colors:{bg:"#fafafa",surface:"#e5e5e5",text:"#1a1a1a",textMuted:"#666666",textSecondary:"#404040",accent:"#3b82f6",accentHover:"#2563eb",success:"#00cc6a",danger:"#cc3333",warning:"#7a5c00",info:"#084a5c",border:"#e0e0e0",borderHover:"#d0d0d0",card:"#ffffff"}},{id:"dark",name:"Sombre",isDark:!0,colors:{bg:"#0f172a",surface:"#1e293b",text:"#f1f5f9",textMuted:"#94a3b8",textSecondary:"#cbd5e1",accent:"#0ea5e9",accentHover:"#0284c7",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",info:"#3b82f6",border:"#334155",borderHover:"#475569",card:"#283345"}},{id:"ultra-dark",name:"Ultra Sombre",isDark:!0,colors:{bg:"#050505",surface:"#0f0f0f",text:"#d5d5d5",textMuted:"#757575",textSecondary:"#a5a5a5",accent:"#0f5c4a",accentHover:"#0a4436",success:"#00cc6a",danger:"#cc3333",warning:"#7a5c00",info:"#084a5c",border:"#1f1f1f",borderHover:"#2f2f2f",card:"#151515"}}],ml=b.createContext(void 0),si=({children:t})=>{const[s,r]=b.useState("dark"),[l,n]=b.useState([]);b.useEffect(()=>{try{const u=localStorage.getItem("simple-theme-id");u&&r(u);const m=localStorage.getItem("simple-custom-themes");m&&n(JSON.parse(m))}catch(u){console.warn("Erreur chargement thÃ¨mes:",u)}},[]),b.useEffect(()=>{localStorage.setItem("simple-theme-id",s)},[s]),b.useEffect(()=>{localStorage.setItem("simple-custom-themes",JSON.stringify(l))},[l]);const o=[...mo,...l],a=o.find(u=>u.id===s)||mo[1];b.useEffect(()=>{const u=document.documentElement;u.classList.remove("dark","light","ultra-dark"),u.removeAttribute("data-theme"),u.style.setProperty("--theme-bg",a.colors.bg),u.style.setProperty("--theme-surface",a.colors.surface),u.style.setProperty("--theme-text",a.colors.text),u.style.setProperty("--theme-text-muted",a.colors.textMuted),u.style.setProperty("--theme-text-secondary",a.colors.textSecondary),u.style.setProperty("--theme-accent",a.colors.accent),u.style.setProperty("--theme-accent-hover",a.colors.accentHover),u.style.setProperty("--theme-success",a.colors.success),u.style.setProperty("--theme-danger",a.colors.danger),u.style.setProperty("--theme-warning",a.colors.warning),u.style.setProperty("--theme-info",a.colors.info),u.style.setProperty("--theme-border",a.colors.border),u.style.setProperty("--theme-border-hover",a.colors.borderHover),u.style.setProperty("--theme-card",a.colors.card),u.classList.add(a.id),u.setAttribute("data-theme",a.id)},[a]);const c=u=>{o.find(m=>m.id===u)&&r(u)},i=u=>{const m={...u,id:`custom-${Date.now()}`};n(p=>[...p,m]),r(m.id)},d=u=>{mo.find(m=>m.id===u)||(n(m=>m.filter(p=>p.id!==u)),s===u&&r("dark"))};return e.jsx(ml.Provider,{value:{currentTheme:a,themes:o,setTheme:c,createTheme:i,deleteTheme:d},children:t})},ee=()=>{const t=b.useContext(ml);if(!t)throw new Error("useSimpleTheme must be used within SimpleThemeProvider");return t},Ks=[{code:"fr",name:"FranÃ§ais",flag:"ðŸ‡«ðŸ‡·",locale:"fr-FR"},{code:"en",name:"English",flag:"ðŸ‡¬ðŸ‡§",locale:"en-US"}],vn={fr:{appTitle:"MetrixSight",newTrade:"Nouveau Trade",overview:"Vue d'Ensemble",statistics:"Statistiques",charts:"Graphiques",tradesList:"Liste des Trades",filters:"Filtres",settings:"ParamÃ¨tres",addTrade:"Ajouter un Trade",editTrade:"Modifier le Trade",date:"Date",time:"Heure",symbol:"Symbole",direction:"Direction",long:"Long",short:"Short",entryPrice:"Prix d'EntrÃ©e",exitPrice:"Prix de Sortie",quantity:"QuantitÃ©",strategy:"StratÃ©gie",market:"MarchÃ©",timeframe:"Timeframe",timeframe_tick:"Timeframe/Tick",notes:"Notes",save:"Sauvegarder",cancel:"Annuler",totalTrades:"Total Trades",winRate:"Taux de RÃ©ussite",profitFactor:"Profit Factor",totalPnL:"P&L Total",currentCapital:"Capital Actuel",initialCapital:"Capital Initial",averageWin:"Gain Moyen",averageLoss:"Perte Moyenne",largestWin:"Plus Gros Gain",largestLoss:"Plus Grosse Perte",maxDrawdown:"Drawdown Max",pnlChart:"Graphique P&L",equityChart:"Courbe d'Ã‰quitÃ©",distributionChart:"Distribution",performanceChart:"Performance",noTrades:"Aucun trade enregistrÃ©",confirmDelete:"ÃŠtes-vous sÃ»r de vouloir supprimer ce trade ?",confirmClearData:"ÃŠtes-vous sÃ»r de vouloir effacer toutes les donnÃ©es ? Cette action est irrÃ©versible.",success:"SuccÃ¨s",error:"Erreur",selectProfileFirst:"Veuillez sÃ©lectionner un profil avant d'ajouter un trade",importSuccess:"{count} trades importÃ©s avec succÃ¨s !",profile:"Profil",capital:"Capital",desktop:"Desktop",demo:"Demo",importExport:"Import/Export",loadDemoData:"Charger des donnÃ©es de dÃ©monstration",exportData:"Exporter les donnÃ©es",noProfileSelected:"Aucun profil sÃ©lectionnÃ©",createSelectProfile:"CrÃ©ez ou sÃ©lectionnez un profil de trading pour commencer",createFirstProfile:"CrÃ©er mon premier profil",testWithDemoData:"Tester avec des donnÃ©es de dÃ©monstration",or:"ou",recentTrades:"Trades RÃ©cents",startRecordingTrades:"Commencez Ã  enregistrer vos trades pour suivre vos performances",addFirstTrade:"Ajouter votre premier trade",loadTestData:"Charger des donnÃ©es de test",recents:"RÃ©cents",symboles_existants:"Symboles existants",rechercher_un_symbole:"Rechercher un symbole...",aucun_symbole_trouve:"Aucun symbole trouvÃ©",alt_s_pour_ouvrir_entree_pour_selectionner_esc_pour_fermer:"Alt+S pour ouvrir â€¢ EntrÃ©e pour sÃ©lectionner â€¢ Esc pour fermer",statut:"Statut",ouvert:"Ouvert",ferme:"FermÃ©",marche:"MarchÃ©",optionnel:"optionnel",demoData:"DonnÃ©es de DÃ©monstration",futures:"Futures",forex:"Forex",crypto:"Crypto",stocks:"Actions",indices:"Indices",commodities:"MatiÃ¨res premiÃ¨res",bullish:"HaussiÃ¨re",bearish:"BaissiÃ¨re",sideways:"LatÃ©rale",sessionEU:"Session EU",sessionUS:"Session US",sessionAsia:"Session Asie",premarket:"PrÃ©-marchÃ©",open:"Ouvert",closed:"FermÃ©",globalPerformance:"Performance Globale",consistency:"Consistance",timing:"Timing",riskReward:"Risk/Reward",score:"Score",tradingDays:"Jours tradÃ©s",bestDay:"Meilleur jour",worstDay:"Pire jour",averageDuration:"DurÃ©e moyenne",tradesPerDay:"Trades/jour",ratio:"Ratio",days7:"7 jours",days30:"30 jours",days90:"90 jours",all:"Tout",summary:"RÃ©sumÃ©",trends:"Tendances",patterns:"Patterns",insights:"Insights",noData:"Pas assez de donnÃ©es",addMoreTrades:"Ajoutez plus de trades fermÃ©s pour voir votre vue d'ensemble",unknownError:"Erreur inconnue"},en:{appTitle:"MetrixSight",newTrade:"New Trade",overview:"Overview",statistics:"Statistics",charts:"Charts",tradesList:"Trades List",filters:"Filters",settings:"Settings",addTrade:"Add Trade",editTrade:"Edit Trade",date:"Date",time:"Time",symbol:"Symbol",direction:"Direction",long:"Long",short:"Short",entryPrice:"Entry Price",exitPrice:"Exit Price",quantity:"Quantity",strategy:"Strategy",market:"Market",timeframe:"Timeframe",timeframe_tick:"Timeframe/Tick",notes:"Notes",save:"Save",cancel:"Cancel",totalTrades:"Total Trades",winRate:"Win Rate",profitFactor:"Profit Factor",totalPnL:"Total P&L",currentCapital:"Current Capital",initialCapital:"Initial Capital",averageWin:"Average Win",averageLoss:"Average Loss",largestWin:"Largest Win",largestLoss:"Largest Loss",maxDrawdown:"Max Drawdown",pnlChart:"P&L Chart",equityChart:"Equity Curve",distributionChart:"Distribution",performanceChart:"Performance",noTrades:"No trades recorded",confirmDelete:"Are you sure you want to delete this trade?",confirmClearData:"Are you sure you want to clear all data? This action is irreversible.",success:"Success",error:"Error",selectProfileFirst:"Please select a profile before adding a trade",importSuccess:"{count} trades imported successfully!",profile:"Profile",capital:"Capital",desktop:"Desktop",demo:"Demo",importExport:"Import/Export",loadDemoData:"Load demo data",exportData:"Export data",noProfileSelected:"No profile selected",createSelectProfile:"Create or select a trading profile to get started",createFirstProfile:"Create my first profile",testWithDemoData:"Test with demo data",or:"or",recentTrades:"Recent Trades",startRecordingTrades:"Start recording your trades to track your performance",addFirstTrade:"Add your first trade",loadTestData:"Load test data",demoData:"Demo Data",futures:"Futures",forex:"Forex",crypto:"Crypto",stocks:"Stocks",indices:"Indices",commodities:"Commodities",bullish:"Bullish",bearish:"Bearish",sideways:"Sideways",sessionEU:"EU Session",sessionUS:"US Session",sessionAsia:"Asia Session",premarket:"Pre-market",open:"Open",closed:"Closed",globalPerformance:"Global Performance",consistency:"Consistency",timing:"Timing",riskReward:"Risk/Reward",score:"Score",tradingDays:"Trading days",bestDay:"Best day",worstDay:"Worst day",averageDuration:"Average duration",tradesPerDay:"Trades/day",ratio:"Ratio",days7:"7 days",days30:"30 days",days90:"90 days",all:"All",summary:"Summary",trends:"Trends",patterns:"Patterns",insights:"Insights",noData:"Not enough data",addMoreTrades:"Add more closed trades to see your overview",unknownError:"Unknown error",recents:"Recent",symboles_existants:"Existing Symbols",rechercher_un_symbole:"Search for a symbol...",aucun_symbole_trouve:"No symbol found",alt_s_pour_ouvrir_entree_pour_selectionner_esc_pour_fermer:"Alt+S to open â€¢ Enter to select â€¢ Esc to close",statut:"Status",ouvert:"Open",ferme:"Closed",marche:"Market",optionnel:"optional"}},xl=b.createContext(void 0),ri=({children:t})=>{const[s,r]=b.useState(()=>{const d=localStorage.getItem("trading-journal-language");return d&&Ks.find(u=>u.code===d)?d:"fr"});b.useEffect(()=>{localStorage.setItem("trading-journal-language",s),document.documentElement.lang=s;const d={fr:"MetrixSight",en:"MetrixSight"};document.title=d[s],window.dispatchEvent(new CustomEvent("languageChanged",{detail:s}))},[s]);const l=d=>{r(d)},n=(d,u)=>{const p=Ks.find(f=>f.code===s)?.locale||"fr-FR",x=u||(s==="fr"?"EUR":"USD");return new Intl.NumberFormat(p,{style:"currency",currency:x,minimumFractionDigits:0,maximumFractionDigits:2}).format(d)},o=d=>{const m=Ks.find(x=>x.code===s)?.locale||"fr-FR";return(typeof d=="string"?new Date(d):d).toLocaleDateString(m,{year:"numeric",month:"short",day:"numeric"})},a=(d,u=2)=>{const p=Ks.find(x=>x.code===s)?.locale||"fr-FR";return new Intl.NumberFormat(p,{minimumFractionDigits:u,maximumFractionDigits:u}).format(d)},c=d=>`${d>=0?"+":""}${d.toFixed(2)}%`,i={currentLanguage:s,changeLanguage:l,t:vn[s]||vn.fr,formatCurrency:n,formatDate:o,formatNumber:a,formatPercentage:c};return e.jsx(xl.Provider,{value:i,children:t})},X=()=>{const t=b.useContext(xl);if(!t)throw new Error("useLanguage must be used within a LanguageProvider");return t};var oi={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const ni=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),li=(t,s)=>{const r=b.forwardRef(({color:l="currentColor",size:n=24,strokeWidth:o=2,absoluteStrokeWidth:a,children:c,...i},d)=>b.createElement("svg",{ref:d,...oi,width:n,height:n,stroke:l,strokeWidth:a?Number(o)*24/Number(n):o,className:`lucide lucide-${ni(t)}`,...i},[...s.map(([u,m])=>b.createElement(u,m)),...(Array.isArray(c)?c:[c])||[]]));return r.displayName=`${t}`,r};var ae=li;const Tt=ae("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),ai=ae("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Zt=ae("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),xo=ae("ArrowDownWideNarrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]]),fl=ae("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),pl=ae("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),hl=ae("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),fo=ae("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]),Xs=ae("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),Rs=ae("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),ii=ae("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]),He=ae("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),ls=ae("BarChart",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]),po=ae("BookMarked",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}],["polyline",{points:"10 2 10 10 13 7 16 10 16 2",key:"13o6vz"}]]),ci=ae("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]),Wo=ae("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),bt=ae("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),gl=ae("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),Vr=ae("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),_t=ae("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),Le=ae("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),cs=ae("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Os=ae("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),mt=ae("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),ar=ae("ChevronsDown",[["path",{d:"m7 6 5 5 5-5",key:"1lc07p"}],["path",{d:"m7 13 5 5 5-5",key:"1d48rs"}]]),ir=ae("ChevronsUp",[["path",{d:"m17 11-5-5-5 5",key:"e8nh98"}],["path",{d:"m17 18-5-5-5 5",key:"2avn1x"}]]),$e=ae("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),sr=ae("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),Ke=ae("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),cr=ae("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),rr=ae("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]),di=ae("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),Re=ae("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),ke=ae("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Vo=ae("FileImage",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["circle",{cx:"10",cy:"13",r:"2",key:"6v46hv"}],["path",{d:"m20 17-1.09-1.09a2 2 0 0 0-2.82 0L10 22",key:"17vly1"}]]),yl=ae("FileSpreadsheet",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M14 17h2",key:"10kma7"}]]),Ss=ae("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),ds=ae("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),ui=ae("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]),Bo=ae("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z",key:"nb9nel"}]]),bl=ae("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),vl=ae("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),As=ae("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),jl=ae("Keyboard",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",ry:"2",key:"15u882"}],["path",{d:"M6 8h.001",key:"1ej0i3"}],["path",{d:"M10 8h.001",key:"1x2st2"}],["path",{d:"M14 8h.001",key:"1vkmyp"}],["path",{d:"M18 8h.001",key:"kfsenl"}],["path",{d:"M8 12h.001",key:"1sjpby"}],["path",{d:"M12 12h.001",key:"al75ts"}],["path",{d:"M16 12h.001",key:"931bgk"}],["path",{d:"M7 16h10",key:"wp8him"}]]),Nl=ae("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),Br=ae("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]),jn=ae("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),mi=ae("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]),kl=ae("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),xi=ae("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),Ho=ae("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),fi=ae("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),Go=ae("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),wl=ae("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),us=ae("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]),Sl=ae("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]),pi=ae("PinOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["line",{x1:"12",x2:"12",y1:"17",y2:"22",key:"1jrz49"}],["path",{d:"M9 9v1.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V17h12",key:"13x2n8"}],["path",{d:"M15 9.34V6h1a2 2 0 0 0 0-4H7.89",key:"reo3ki"}]]),hi=ae("Pin",[["line",{x1:"12",x2:"12",y1:"17",y2:"22",key:"1jrz49"}],["path",{d:"M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z",key:"13yl11"}]]),Ye=ae("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),To=ae("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]),gi=ae("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z",key:"wqdwcb"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17V7",key:"pyj7ub"}]]),yi=ae("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]),Nn=ae("Ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]),Dt=ae("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),jt=ae("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),ss=ae("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),bi=ae("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),Jo=ae("Sliders",[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]]),vi=ae("StarOff",[["path",{d:"M8.34 8.34 2 9.27l5 4.87L5.82 21 12 17.77 18.18 21l-.59-3.43",key:"16m0ql"}],["path",{d:"M18.42 12.76 22 9.27l-6.91-1L12 2l-1.44 2.91",key:"1vt8nq"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),it=ae("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),ji=ae("StickyNote",[["path",{d:"M15.5 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z",key:"1wis1t"}],["path",{d:"M15 3v6h6",key:"edgan2"}]]),Ni=ae("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]),ms=ae("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]),Me=ae("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),ki=ae("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]),wi=ae("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]),Si=ae("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),es=ae("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Ot=ae("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),Ee=ae("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),kn=ae("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),Rr=ae("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Ko=ae("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Ci=ae("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]),Pi=ae("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),be=ae("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),dr=ae("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),wn=[{id:"scalp-orderflow",name:"Order Flow Scalping",description:"Scalping basÃ© sur l'analyse du flux d'ordres",category:"scalping",isDefault:!0,timeframes:["5s","10s","15s","30s"],markets:["futures"],riskLevel:"high",complexity:"advanced",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"scalp-momentum",name:"Momentum Scalping",description:"Scalping sur les mouvements de momentum",category:"scalping",isDefault:!0,timeframes:["15s","30s","1m"],markets:["futures","forex"],riskLevel:"high",complexity:"intermediate",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"scalp-range",name:"Range Scalping",description:"Scalping dans les zones de range",category:"scalping",isDefault:!0,timeframes:["1m","5m"],markets:["futures","forex"],riskLevel:"medium",complexity:"beginner",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"scalp-news",name:"News Scalping",description:"Scalping sur les annonces Ã©conomiques",category:"scalping",isDefault:!0,timeframes:["5s","10s","15s"],markets:["forex","indices"],riskLevel:"high",complexity:"advanced",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"scalp-breakout",name:"Breakout Scalping",description:"Scalping sur les cassures de niveaux clÃ©s",category:"scalping",isDefault:!0,timeframes:["5s","10s","15s","30s"],markets:["futures","forex"],riskLevel:"high",complexity:"intermediate",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"day-breakout",name:"Breakout Trading",description:"Trading des cassures de niveaux clÃ©s",category:"daytrading",isDefault:!0,timeframes:["5m","15m","30m"],markets:["futures","stocks","indices"],riskLevel:"medium",complexity:"intermediate",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"day-pullback",name:"Pullback Trading",description:"Trading des retours sur tendance",category:"daytrading",isDefault:!0,timeframes:["15m","30m","1h"],markets:["stocks","indices","commodities"],riskLevel:"medium",complexity:"intermediate",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"day-reversal",name:"Reversal Trading",description:"Trading des retournements de tendance",category:"daytrading",isDefault:!0,timeframes:["30m","1h","4h"],markets:["futures","forex","crypto"],riskLevel:"high",complexity:"advanced",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"day-mean-reversion",name:"Mean Reversion",description:"Trading du retour Ã  la moyenne",category:"daytrading",isDefault:!0,timeframes:["15m","30m","1h"],markets:["stocks","indices"],riskLevel:"medium",complexity:"intermediate",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"day-gap-trading",name:"Gap Trading",description:"Trading des gaps d'ouverture",category:"daytrading",isDefault:!0,timeframes:["5m","15m","30m"],markets:["stocks","indices"],riskLevel:"medium",complexity:"beginner",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"swing-trend-following",name:"Trend Following",description:"Suivi de tendance long terme",category:"swingtrading",isDefault:!0,timeframes:["4h","1d","1w"],markets:["stocks","commodities","crypto"],riskLevel:"low",complexity:"beginner",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"swing-support-resistance",name:"Support/Resistance",description:"Trading sur les niveaux de support et rÃ©sistance",category:"swingtrading",isDefault:!0,timeframes:["1h","4h","1d"],markets:["stocks","indices","commodities"],riskLevel:"medium",complexity:"intermediate",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"swing-earnings",name:"Earnings Play",description:"Trading autour des publications de rÃ©sultats",category:"swingtrading",isDefault:!0,timeframes:["1d","1w"],markets:["stocks"],riskLevel:"high",complexity:"advanced",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"swing-sector-rotation",name:"Sector Rotation",description:"Trading de rotation sectorielle",category:"swingtrading",isDefault:!0,timeframes:["1d","1w","1M"],markets:["stocks","indices"],riskLevel:"medium",complexity:"advanced",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"custom-arbitrage",name:"Arbitrage",description:"Arbitrage entre diffÃ©rents marchÃ©s ou instruments",category:"custom",isDefault:!0,timeframes:["1m","5m","15m"],markets:["futures","forex","crypto"],riskLevel:"low",complexity:"advanced",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"custom-pairs-trading",name:"Pairs Trading",description:"Trading de paires corrÃ©lÃ©es",category:"custom",isDefault:!0,timeframes:["15m","1h","4h"],markets:["stocks","forex"],riskLevel:"medium",complexity:"advanced",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"custom-algo-trading",name:"Algorithmic Trading",description:"Trading algorithmique automatisÃ©",category:"custom",isDefault:!0,timeframes:["1m","5m","15m","1h"],markets:["futures","forex","crypto"],riskLevel:"medium",complexity:"advanced",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}],Hr=[{id:"scalping",name:"Scalping",description:"StratÃ©gies ultra-courtes (secondes Ã  minutes)",icon:"âš¡",color:"#ef4444",defaultTimeframes:["5s","10s","15s","30s","1m","5m"],defaultMarkets:["futures","forex"]},{id:"daytrading",name:"Day Trading",description:"StratÃ©gies intraday (minutes Ã  heures)",icon:"ðŸ“ˆ",color:"#3b82f6",defaultTimeframes:["5m","15m","30m","1h","4h"],defaultMarkets:["futures","stocks","indices","forex"]},{id:"swingtrading",name:"Swing Trading",description:"StratÃ©gies moyen terme (jours Ã  semaines)",icon:"ðŸŒŠ",color:"#10b981",defaultTimeframes:["4h","1d","1w","1M"],defaultMarkets:["stocks","commodities","crypto","indices"]},{id:"custom",name:"PersonnalisÃ©",description:"StratÃ©gies sur mesure et hybrides",icon:"âš™ï¸",color:"#8b5cf6",defaultTimeframes:["1m","5m","15m","30m","1h","4h","1d"],defaultMarkets:["futures","forex","stocks","crypto","indices","commodities"]}],Gr=[{id:"low",name:"Faible",color:"#10b981",description:"Risque limitÃ©, gains modÃ©rÃ©s"},{id:"medium",name:"Moyen",color:"#f59e0b",description:"Ã‰quilibre risque/rendement"},{id:"high",name:"Ã‰levÃ©",color:"#ef4444",description:"Risque Ã©levÃ©, gains potentiels importants"}],Cl=[{id:"beginner",name:"DÃ©butant",color:"#10b981",description:"Facile Ã  comprendre et appliquer"},{id:"intermediate",name:"IntermÃ©diaire",color:"#f59e0b",description:"NÃ©cessite une expÃ©rience modÃ©rÃ©e"},{id:"advanced",name:"AvancÃ©",color:"#ef4444",description:"Requiert une expertise approfondie"}];function xs(t,s){const[r,l]=b.useState(()=>{try{const o=window.localStorage.getItem(t);return o?JSON.parse(o):s}catch(o){return console.error(`Error reading localStorage key "${t}":`,o),s}});return[r,o=>{try{const a=o instanceof Function?o(r):o;l(a);const c=JSON.stringify(a);window.localStorage.setItem(t,c)}catch(a){a instanceof DOMException&&(a.name==="QuotaExceededError"||a.name==="NS_ERROR_DOM_QUOTA_REACHED")?alert(`Stockage local plein ! Votre navigateur a atteint sa limite de stockage.

Pour continuer Ã  ajouter des trades :
1. Exportez vos donnÃ©es actuelles pour les sauvegarder
2. Supprimez d'anciens trades pour libÃ©rer de l'espace
3. Utilisez la fonction d'export/import pour gÃ©rer vos donnÃ©es

Votre trade actuel n'a pas Ã©tÃ© sauvegardÃ©.`):(console.error(`Error setting localStorage key "${t}":`,a),alert(`Une erreur est survenue lors de la sauvegarde des donnÃ©es: ${a instanceof Error?a.message:"Erreur inconnue"}`))}}]}const Yo=()=>{const[t,s]=xs("trading-journal-strategy-presets",[]),[r,l]=xs("trading-journal-favorite-strategies",[]),n=[...wn,...t].map(h=>({...h,isFavorite:r.includes(h.id)}));return{allPresets:n,customPresets:t,defaultPresets:wn,createPreset:h=>{const y={...h,id:`custom-${Date.now()}`,isDefault:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return s(j=>[...j,y]),y},updatePreset:(h,y)=>{s(j=>j.map(v=>v.id===h?{...v,...y,updatedAt:new Date().toISOString()}:v))},deletePreset:h=>{s(y=>y.filter(j=>j.id!==h))},getPresetsByCategory:h=>h?n.filter(y=>y.category===h):n,searchPresets:h=>{const y=h.toLowerCase();return n.filter(j=>j.name.toLowerCase().includes(y)||j.description?.toLowerCase().includes(y))},getPresetById:h=>n.find(y=>y.id===h),getPresetByName:h=>n.find(y=>y.name.toLowerCase()===h.toLowerCase()),getMostUsedStrategies:h=>{const y=new Map;return h.forEach(j=>{j.strategy&&y.set(j.strategy,(y.get(j.strategy)||0)+1)}),Array.from(y.entries()).sort((j,v)=>v[1]-j[1]).slice(0,5).map(([j,v])=>({name:j,count:v}))},toggleFavorite:h=>{r.includes(h)?l(y=>y.filter(j=>j!==h)):l(y=>[...y,h])},getFavoritePresets:()=>n.filter(h=>h.isFavorite),getStrategyStats:(h,y)=>{const j=y.filter(k=>k.strategy===h&&k.status==="closed");if(j.length===0)return null;const v=j.filter(k=>k.pnl&&k.pnl>0),N=j.filter(k=>k.pnl&&k.pnl<0),S=j.reduce((k,M)=>k+(M.pnl||0),0),w=S/j.length;return{totalTrades:j.length,winningTrades:v.length,losingTrades:N.length,winRate:j.length>0?v.length/j.length:0,totalPnl:S,averagePnl:w,bestTrade:j.reduce((k,M)=>!k||(M.pnl||0)>(k.pnl||0)?M:k,null),worstTrade:j.reduce((k,M)=>!k||(M.pnl||0)<(k.pnl||0)?M:k,null),recentTrades:j.sort((k,M)=>new Date(M.date).getTime()-new Date(k.date).getTime()).slice(0,5)}}}},Mi=({onSelect:t,onClose:s,currentValue:r})=>{const[l,n]=b.useState(""),[o,a]=b.useState("all"),[c,i]=b.useState(!1),{getMostUsedStrategies:d,searchPresets:u,allPresets:m,getPresetsByCategory:p,createPreset:x}=Yo(),f=b.useMemo(()=>l.trim()?u(l):o==="all"?m:p(o),[l,o,u,m,p]),g=d([]),h=[{id:"all",name:"Toutes",icon:"â­",count:m.length},{id:"scalping",name:"Scalping",icon:"âš¡",count:m.filter(v=>v.category==="scalping").length},{id:"daytrading",name:"Day Trading",icon:"ðŸ“ˆ",count:m.filter(v=>v.category==="daytrading").length},{id:"swingtrading",name:"Swing Trading",icon:"ðŸŒŠ",count:m.filter(v=>v.category==="swingtrading").length},{id:"custom",name:"PersonnalisÃ©",icon:"âš™ï¸",count:m.filter(v=>v.category==="custom").length}],y=v=>{t(v)},j=()=>{l.trim()&&i(!0)};return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]",children:[e.jsxs("div",{className:"theme-surface rounded-lg shadow-xl max-w-5xl w-full h-[85vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b theme-border flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold theme-text",children:"SÃ©lectionner une StratÃ©gie"}),e.jsxs("p",{className:"text-sm theme-text-muted mt-1",children:["Choisissez parmi ",m.length," stratÃ©gies ou crÃ©ez la vÃ´tre"]})]}),e.jsx("button",{onClick:s,className:"theme-text-muted hover:theme-text transition-colors p-2 hover:theme-surface rounded-lg",children:e.jsx(be,{size:24})})]}),e.jsx("div",{className:"p-6 border-b theme-border flex-shrink-0",children:e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(jt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 theme-text-muted",size:20}),e.jsx("input",{type:"text",value:l,onChange:v=>n(v.target.value),placeholder:"Rechercher une stratÃ©gie...",className:"w-full pl-10 pr-4 py-3 border theme-border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},autoFocus:!0})]}),l.trim()&&!m.find(v=>v.name.toLowerCase()===l.toLowerCase())&&e.jsxs("button",{onClick:j,className:"flex items-center space-x-2 px-4 py-3 theme-text rounded-lg transition-colors whitespace-nowrap",style:{backgroundColor:"var(--theme-accent)"},onMouseEnter:v=>{v.currentTarget.style.backgroundColor="var(--theme-accent-hover)"},onMouseLeave:v=>{v.currentTarget.style.backgroundColor="var(--theme-accent)"},children:[e.jsx(Ye,{size:16}),e.jsxs("span",{children:['Ajouter "',l.slice(0,15),l.length>15?"...":"",'"']})]})]})}),e.jsx("div",{className:"px-6 py-4 border-b theme-border flex-shrink-0",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:h.map(v=>e.jsxs("button",{onClick:()=>a(v.id),className:`flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-colors ${o===v.id?"theme-text shadow-md":"theme-surface theme-text hover:theme-surface"}`,style:{backgroundColor:o===v.id?"var(--theme-accent)":void 0},children:[e.jsx("span",{className:"mr-2",children:v.icon}),v.name,e.jsx("span",{className:"ml-2 px-2 py-0.5 theme-surface rounded-full text-xs",children:v.count})]},v.id))})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[!l&&g.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-lg font-semibold theme-text mb-4 flex items-center",children:[e.jsx(it,{size:20,className:"mr-2 text-yellow-500"}),"StratÃ©gies les plus utilisÃ©es"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:g.slice(0,6).map((v,N)=>e.jsxs("button",{onClick:()=>y(v.name),className:`p-4 text-left rounded-lg border-2 transition-all hover:shadow-md ${r===v.name?"shadow-md":"theme-border hover:theme-surface"}`,style:{borderColor:r===v.name?"var(--theme-accent)":void 0,backgroundColor:r===v.name?"var(--theme-accent)10":void 0},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold theme-text",children:v.name}),e.jsxs("div",{className:"flex items-center space-x-1 text-yellow-500",children:[e.jsx(it,{size:14}),e.jsx("span",{className:"text-xs font-medium",children:v.count})]})]}),e.jsxs("div",{className:"text-xs theme-text-muted",children:["UtilisÃ©e ",v.count," fois"]})]},N))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold theme-text",children:l?`RÃ©sultats pour "${l}"`:"Toutes les stratÃ©gies"}),e.jsxs("span",{className:"text-sm theme-text-muted theme-surface px-3 py-1 rounded-full",children:[f.length," stratÃ©gie",f.length>1?"s":""]})]}),f.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"theme-text-muted mb-4",children:e.jsx(jt,{size:48,className:"mx-auto"})}),e.jsx("h4",{className:"text-lg font-medium theme-text mb-2",children:l?"Aucune stratÃ©gie trouvÃ©e":"Aucune stratÃ©gie disponible"}),e.jsx("p",{className:"theme-text-muted mb-6",children:l?`Aucune stratÃ©gie ne correspond Ã  "${l}"`:"Il n\\'y a pas de stratÃ©gies dans cette catÃ©gorie"}),l&&e.jsxs("button",{onClick:j,className:"inline-flex items-center space-x-2 px-6 py-3 theme-text rounded-lg transition-colors",style:{backgroundColor:"var(--theme-accent)"},onMouseEnter:v=>{v.currentTarget.style.backgroundColor="var(--theme-accent-hover)"},onMouseLeave:v=>{v.currentTarget.style.backgroundColor="var(--theme-accent)"},children:[e.jsx(Ye,{size:16}),e.jsxs("span",{children:['CrÃ©er la stratÃ©gie "',l,'"']})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.map((v,N)=>{const S=Hr.find(k=>k.id===v.category),w=Gr.find(k=>k.id===v.riskLevel);return Cl.find(k=>k.id===v.complexity),e.jsxs("button",{onClick:()=>y(v.name),className:`p-4 text-left rounded-lg border-2 transition-all hover:shadow-md ${r===v.name?"shadow-md":"theme-border hover:border-blue-300 hover:theme-surface"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:S?.icon||"ðŸ“Š"}),e.jsx("div",{className:"font-semibold theme-text",children:v.name})]}),v.isDefault&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full",style:{backgroundColor:"var(--theme-accent)20",color:"var(--theme-accent)"},children:"DÃ©faut"})]}),v.description&&e.jsx("p",{className:"text-sm theme-text-muted mb-3 line-clamp-2",children:v.description}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[S&&e.jsx("span",{className:"px-2 py-1 text-xs rounded-full font-medium",style:{backgroundColor:`${S.color}15`,color:S.color,border:`1px solid ${S.color}30`},children:S.name}),w&&e.jsx("span",{className:"px-2 py-1 text-xs rounded-full font-medium",style:{backgroundColor:`${w.color}15`,color:w.color,border:`1px solid ${w.color}30`},children:w.name}),v.timeframes&&v.timeframes.length>0&&e.jsxs("div",{className:"flex items-center space-x-1 theme-surface px-2 py-1 rounded-full",children:[e.jsx($e,{size:10,className:"theme-text-muted"}),e.jsxs("span",{className:"text-xs theme-text-muted",children:[v.timeframes.slice(0,2).join(", "),v.timeframes.length>2&&` +${v.timeframes.length-2}`]})]})]})]},N)})})]})]}),e.jsxs("div",{className:"flex justify-between items-center p-6 border-t theme-border theme-surface flex-shrink-0",children:[e.jsx("div",{className:"text-sm theme-text-muted",children:"ðŸ’¡ Tapez le nom d'une nouvelle stratÃ©gie pour la crÃ©er rapidement"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 theme-text theme-surface border theme-border rounded-lg hover:theme-surface transition-colors",children:"Fermer"}),l.trim()&&!m.find(v=>v.name.toLowerCase()===l.toLowerCase())&&e.jsxs("button",{onClick:j,className:"flex items-center space-x-2 px-4 py-2 theme-text rounded-lg transition-colors",style:{backgroundColor:"var(--theme-accent)"},onMouseEnter:v=>{v.currentTarget.style.backgroundColor="var(--theme-accent-hover)"},onMouseLeave:v=>{v.currentTarget.style.backgroundColor="var(--theme-accent)"},children:[e.jsx(Ye,{size:16}),e.jsxs("span",{children:['CrÃ©er "',l.slice(0,20),l.length>20?"...":"",'"']})]})]})]})]}),c&&e.jsx(Ri,{initialName:l,onSave:v=>{const N=x(v);y(N.name),i(!1)},onCancel:()=>i(!1)})]})},Ri=({initialName:t,onSave:s,onCancel:r})=>{const[l,n]=b.useState({name:t,description:"",category:"custom",riskLevel:"medium",complexity:"intermediate",timeframes:[],markets:[]}),o=a=>{a.preventDefault(),s(l)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-[70]",children:e.jsxs("div",{className:"theme-surface rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b theme-border",children:[e.jsx("h3",{className:"text-lg font-semibold theme-text",children:"CrÃ©er une Nouvelle StratÃ©gie"}),e.jsx("button",{onClick:r,className:"theme-text-muted hover:theme-text transition-colors",children:e.jsx(be,{size:20})})]}),e.jsxs("form",{onSubmit:o,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:"Nom de la stratÃ©gie *"}),e.jsx("input",{type:"text",value:l.name,onChange:a=>n(c=>({...c,name:a.target.value})),className:"w-full px-3 py-2 border theme-border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},placeholder:"Ma stratÃ©gie personnalisÃ©e",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:"Description (optionnel)"}),e.jsx("textarea",{value:l.description,onChange:a=>n(c=>({...c,description:a.target.value})),rows:3,className:"w-full px-3 py-2 border theme-border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},placeholder:"Description de votre stratÃ©gie..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:"CatÃ©gorie"}),e.jsx("select",{value:l.category,onChange:a=>n(c=>({...c,category:a.target.value})),className:"w-full px-3 py-2 border theme-border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},children:Hr.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:"Niveau de risque"}),e.jsx("select",{value:l.riskLevel,onChange:a=>n(c=>({...c,riskLevel:a.target.value})),className:"w-full px-3 py-2 border theme-border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},children:Gr.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t theme-border",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 theme-text theme-surface rounded-lg hover:theme-surface transition-colors",children:"Annuler"}),e.jsxs("button",{type:"submit",className:"flex items-center space-x-2 px-4 py-2 theme-text rounded-lg transition-colors",style:{backgroundColor:"var(--theme-accent)"},onMouseEnter:a=>{a.currentTarget.style.backgroundColor="var(--theme-accent-hover)"},onMouseLeave:a=>{a.currentTarget.style.backgroundColor="var(--theme-accent)"},children:[e.jsx(_t,{size:16}),e.jsx("span",{children:"CrÃ©er et Utiliser"})]})]})]})]})})},Ti=({activeTab:t,onTabChange:s})=>{const{currentLanguage:r}=X(),{currentTheme:l}=ee(),n=[{id:"basic",label:r==="fr"?"Informations de base":"Basic Information",icon:As},{id:"market",label:r==="fr"?"MarchÃ© & Trading":"Market & Trading",icon:ii},{id:"performance",label:"Performance",icon:Tt},{id:"notes",label:"Notes & Screenshots",icon:Ss},{id:"advanced",label:r==="fr"?"RÃ©sumÃ© & Frais":"Summary & Fees",icon:Ke}];return e.jsx("div",{className:"flex border-b overflow-x-auto",style:{borderColor:l.colors.border},children:n.map(o=>{const a=o.icon,c=t===o.id;return e.jsxs("button",{onClick:()=>s(o.id),className:`flex items-center px-6 py-3 transition-colors ${c?"border-b-2":"border-b-2 border-transparent"}`,style:{color:c?l.colors.accent:l.colors.textSecondary,borderBottomColor:c?l.colors.accent:"transparent",backgroundColor:c?`${l.colors.accent}10`:"transparent"},children:[e.jsx(a,{size:18,className:"mr-2"}),e.jsx("span",{className:"font-medium",children:o.label})]},o.id)})})},Di=({formData:t,onChange:s,errors:r,symbols:l})=>{const{currentLanguage:n,t:o}=X(),{currentTheme:a}=ee(),[c,i]=b.useState(null),[d,u]=b.useState(!1),[m,p]=b.useState(""),x=b.useRef(null),f=b.useRef(null),g=t.time?t.time.split(":").map(Number):[0,0,0],[h=0,y=0,j=0]=g,v=(D,T,E)=>{const L=D.toString().padStart(2,"0"),U=T.toString().padStart(2,"0"),_=E.toString().padStart(2,"0");s("time",`${L}:${U}:${_}`)};b.useEffect(()=>{const D=T=>{x.current&&!x.current.contains(T.target)&&i(null),f.current&&!f.current.contains(T.target)&&u(!1)};return document.addEventListener("mousedown",D),()=>{document.removeEventListener("mousedown",D)}},[]);const N=D=>{const T=D.target.value;if(T===""){v(0,y,j);return}const E=parseInt(T);!isNaN(E)&&E>=0&&E<=23&&v(E,y,j)},S=D=>{const T=D.target.value;if(T===""){v(h,0,j);return}const E=parseInt(T);!isNaN(E)&&E>=0&&E<=59&&v(h,E,j)},w=D=>{const T=D.target.value;if(T===""){v(h,y,0);return}const E=parseInt(T);!isNaN(E)&&E>=0&&E<=59&&v(h,y,E)},k=D=>{s("symbol",D),u(!1)},M=m?l.filter(D=>D.toLowerCase().includes(m.toLowerCase())):l,C=["ES","NQ","YM","RTY","CL","GC","EURUSD"],R=()=>l.length>0?l.slice(0,5):C.slice(0,5),P=D=>D==null?"":String(D);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(bt,{size:16,className:"mr-2"}),"Date"]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:t.date,onChange:D=>s("date",D.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.date?a.colors.danger:a.colors.border,color:a.colors.text},required:!0}),r.date&&e.jsx("p",{className:"text-xs mt-1",style:{color:a.colors.danger},children:r.date})]})]}),e.jsxs("div",{ref:x,children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx($e,{size:16,className:"mr-2"}),n==="fr"?"Heure":"Time"]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:h.toString().padStart(2,"0"),onChange:N,onClick:()=>i(c==="hours"?null:"hours"),className:"w-full px-3 py-2 border rounded-md text-center focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.time?a.colors.danger:a.colors.border,color:a.colors.text}}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:a.colors.textMuted},children:n==="fr"?"Heures":"Hours"}),c==="hours"&&e.jsx("div",{className:"absolute z-10 mt-1 w-full theme-surface border theme-border rounded-md shadow-lg",style:{backgroundColor:a.colors.card,borderColor:a.colors.border,left:"0",maxHeight:"200px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Array.from({length:24},(D,T)=>e.jsx("button",{type:"button",onClick:()=>{v(T,y,j),i(null)},className:"px-2 py-2 text-sm rounded text-center transition-colors w-full",style:{backgroundColor:h===T?`${a.colors.accent}20`:a.colors.surface,color:h===T?a.colors.accent:a.colors.text,border:`1px solid ${h===T?a.colors.accent:"transparent"}`},children:T.toString().padStart(2,"0")},T))})})})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:y.toString().padStart(2,"0"),onChange:S,onClick:()=>i(c==="minutes"?null:"minutes"),className:"w-full px-3 py-2 border rounded-md text-center focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.time?a.colors.danger:a.colors.border,color:a.colors.text}}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:a.colors.textMuted},children:"Minutes"}),c==="minutes"&&e.jsx("div",{className:"absolute z-10 mt-1 w-full theme-surface border theme-border rounded-md shadow-lg",style:{backgroundColor:a.colors.card,borderColor:a.colors.border,left:"0",maxHeight:"200px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Array.from({length:60},(D,T)=>e.jsx("button",{type:"button",onClick:()=>{v(h,T,j),i(null)},className:"px-2 py-2 text-sm rounded text-center transition-colors w-full",style:{backgroundColor:y===T?`${a.colors.accent}20`:a.colors.surface,color:y===T?a.colors.accent:a.colors.text,border:`1px solid ${y===T?a.colors.accent:"transparent"}`},children:T.toString().padStart(2,"0")},T))})})})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:j.toString().padStart(2,"0"),onChange:w,onClick:()=>i(c==="seconds"?null:"seconds"),className:"w-full px-3 py-2 border rounded-md text-center focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.time?a.colors.danger:a.colors.border,color:a.colors.text}}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:a.colors.textMuted},children:n==="fr"?"Secondes":"Seconds"}),c==="seconds"&&e.jsx("div",{className:"absolute z-10 mt-1 w-full theme-surface border theme-border rounded-md shadow-lg",style:{backgroundColor:a.colors.card,borderColor:a.colors.border,left:"0",maxHeight:"200px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Array.from({length:60},(D,T)=>e.jsx("button",{type:"button",onClick:()=>{v(h,y,T),i(null)},className:"px-2 py-2 text-sm rounded text-center transition-colors w-full",style:{backgroundColor:j===T?`${a.colors.accent}20`:a.colors.surface,color:j===T?a.colors.accent:a.colors.text,border:`1px solid ${j===T?a.colors.accent:"transparent"}`},children:T.toString().padStart(2,"0")},T))})})})]})]}),r.time&&e.jsx("p",{className:"text-xs mt-1",style:{color:a.colors.danger},children:r.time})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(He,{size:16,className:"mr-2"}),n==="fr"?"MarchÃ©":"Market"]})}),e.jsxs("select",{value:t.market,onChange:D=>s("market",D.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.market?a.colors.danger:a.colors.border,color:a.colors.text},required:!0,children:[e.jsx("option",{value:"futures",children:"Futures"}),e.jsx("option",{value:"forex",children:"Forex"}),e.jsx("option",{value:"crypto",children:"Crypto"}),e.jsx("option",{value:"stocks",children:n==="fr"?"Actions":"Stocks"}),e.jsx("option",{value:"indices",children:"Indices"}),e.jsx("option",{value:"commodities",children:n==="fr"?"MatiÃ¨res premiÃ¨res":"Commodities"})]}),r.market&&e.jsx("p",{className:"text-xs mt-1",style:{color:a.colors.danger},children:r.market})]}),e.jsxs("div",{ref:f,children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:n==="fr"?"Symbole":"Symbol"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"text",value:t.symbol,onChange:D=>{s("symbol",D.target.value.toUpperCase()),p(D.target.value)},onClick:()=>u(!0),className:"w-full px-3 py-2 border rounded-l-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.symbol?a.colors.danger:a.colors.border,color:a.colors.text},placeholder:"Ex: ES, NQ, EURUSD",required:!0}),e.jsx("button",{type:"button",onClick:()=>u(!d),className:"px-3 py-2 border-t border-r border-b rounded-r-md",style:{backgroundColor:a.colors.surface,borderColor:r.symbol?a.colors.danger:a.colors.border,color:a.colors.text},children:e.jsx(Le,{size:16,className:`transition-transform ${d?"rotate-180":""}`})})]}),d&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md shadow-lg overflow-hidden",style:{backgroundColor:a.colors.card,borderColor:a.colors.border,border:`1px solid ${a.colors.border}`},children:e.jsx("div",{className:"max-h-60 overflow-y-auto",children:e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-xs font-semibold mb-2 px-2 py-1 rounded",style:{backgroundColor:a.colors.surface,color:a.colors.textMuted},children:n==="fr"?"Symboles existants":"Existing symbols"}),M.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-1",children:M.map(D=>e.jsx("button",{type:"button",onClick:()=>k(D),className:"px-3 py-2 text-sm rounded text-left transition-colors",style:{backgroundColor:t.symbol===D?a.colors.accent+"30":a.colors.surface,color:t.symbol===D?a.colors.accent:a.colors.text,border:`1px solid ${t.symbol===D?a.colors.accent:"transparent"}`},children:D},D))}):e.jsx("div",{className:"grid grid-cols-1 gap-1",children:C.map(D=>e.jsx("button",{type:"button",onClick:()=>k(D),className:"px-3 py-2 text-sm rounded text-left transition-colors",style:{backgroundColor:t.symbol===D?a.colors.accent+"30":a.colors.surface,color:t.symbol===D?a.colors.accent:a.colors.text,border:`1px solid ${t.symbol===D?a.colors.accent:"transparent"}`},children:D},D))})]})})}),r.symbol&&e.jsx("p",{className:"text-xs mt-1",style:{color:a.colors.danger},children:r.symbol})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:R().map(D=>e.jsx("button",{type:"button",onClick:()=>s("symbol",D),className:"px-2 py-1 text-xs rounded transition-colors",style:{backgroundColor:t.symbol===D?a.colors.accent:a.colors.surface,color:t.symbol===D?"#ffffff":a.colors.text,border:`1px solid ${t.symbol===D?a.colors.accent:a.colors.border}`},children:D},D))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:"Direction"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>s("side","long"),className:`flex items-center justify-center px-4 py-2 rounded-lg transition-colors ${t.side==="long"?"shadow-md":""}`,style:{backgroundColor:t.side==="long"?a.colors.success+"20":a.colors.surface,color:t.side==="long"?a.colors.success:a.colors.text,borderWidth:1,borderStyle:"solid",borderColor:t.side==="long"?a.colors.success:a.colors.border},children:[e.jsx(Xs,{size:16,className:"mr-2"}),e.jsx("span",{children:"Long"})]}),e.jsxs("button",{type:"button",onClick:()=>s("side","short"),className:`flex items-center justify-center px-4 py-2 rounded-lg transition-colors ${t.side==="short"?"shadow-md":""}`,style:{backgroundColor:t.side==="short"?a.colors.danger+"20":a.colors.surface,color:t.side==="short"?a.colors.danger:a.colors.text,borderWidth:1,borderStyle:"solid",borderColor:t.side==="short"?a.colors.danger:a.colors.border},children:[e.jsx(fl,{size:16,className:"mr-2"}),e.jsx("span",{children:"Short"})]})]}),r.side&&e.jsx("p",{className:"text-xs mt-1",style:{color:a.colors.danger},children:r.side})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:n==="fr"?"Prix d'EntrÃ©e":"Entry Price"}),e.jsx("span",{className:"text-xs",style:{color:a.colors.textMuted},children:n==="fr"?"(Optionnel)":"(Optional)"})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:P(t.entryPrice),onChange:D=>{s("entryPrice",D.target.value)},className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.entryPrice?a.colors.danger:a.colors.border,color:a.colors.text},placeholder:"0"}),r.entryPrice&&e.jsx("p",{className:"text-xs mt-1",style:{color:a.colors.danger},children:r.entryPrice})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:n==="fr"?"Prix de Sortie":"Exit Price"}),e.jsx("span",{className:"text-xs",style:{color:a.colors.textMuted},children:n==="fr"?"(Optionnel)":"(Optional)"})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:P(t.exitPrice),onChange:D=>{s("exitPrice",D.target.value)},className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.exitPrice?a.colors.danger:a.colors.border,color:a.colors.text},placeholder:"0"}),r.exitPrice&&e.jsx("p",{className:"text-xs mt-1",style:{color:a.colors.danger},children:r.exitPrice})]})]})]})]})},Ei=["Breakout Trading","Scalping","Momentum","Reversal Trading","Range Trading","Trend Following","Support/Resistance","Mean Reversion","Gap Trading","News Trading","Order Flow","Pullback Trading"],Fi=["Cassure","Rebond","Divergence","Support/RÃ©sistance","Tendance","Range","Momentum","Retournement","Double Top","Double Bottom","Triple Top","Triple Bottom","Head & Shoulders","Inverse H&S","Bull Flag","Bear Flag","Triangle Ascendant","Triangle Descendant","Triangle SymÃ©trique","Wedge","Faux Breakout","Pullback"],Ai={seconds:[{value:"5s",label:"5s"},{value:"10s",label:"10s"},{value:"15s",label:"15s"},{value:"30s",label:"30s"},{value:"45s",label:"45s"}],minutes:[{value:"1m",label:"1m"},{value:"2m",label:"2m"},{value:"3m",label:"3m"},{value:"5m",label:"5m"},{value:"10m",label:"10m"},{value:"15m",label:"15m"},{value:"20m",label:"20m"},{value:"30m",label:"30m"},{value:"45m",label:"45m"}],hours:[{value:"1h",label:"1h"},{value:"2h",label:"2h"},{value:"3h",label:"3h"},{value:"4h",label:"4h"},{value:"8h",label:"8h"},{value:"12h",label:"12h"}],days:[{value:"1d",label:"1d"},{value:"2d",label:"2d"},{value:"3d",label:"3d"}],weeks:[{value:"1w",label:"1w"}]},Li=["1m","5m","15m","30m","1h","4h"],$i=({currentLanguage:t,currentTheme:s,value:r,errors:l,showDropdown:n,setShowDropdown:o,customTimeframe:a,setCustomTimeframe:c,categorizedTimeframes:i,onSelect:d,onSubmitCustom:u})=>e.jsx("div",{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex space-x-2",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx("button",{type:"button",onClick:()=>o(!n),className:"w-full px-3 py-2 border rounded-md text-left focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:s.colors.surface,borderColor:l.timeframe?s.colors.danger:s.colors.border,color:r?s.colors.text:s.colors.textMuted},children:r||(t==="fr"?"SÃ©lectionner...":"Select...")}),n&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md shadow-lg overflow-hidden",style:{backgroundColor:s.colors.card,borderColor:s.colors.border,border:`1px solid ${s.colors.border}`},children:e.jsx("div",{className:"max-h-60 overflow-y-auto",children:e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"flex space-x-1 mb-2",children:[e.jsx("input",{type:"text",value:a,onChange:m=>c(m.target.value),placeholder:"Ex: 5m, 1h, 4h, 1d, 1w",className:"flex-1 px-2 py-1 text-sm border rounded",style:{backgroundColor:s.colors.surface,borderColor:s.colors.border,color:s.colors.text},onKeyDown:m=>{m.key==="Enter"&&u()}}),e.jsx("button",{type:"button",onClick:u,className:"px-2 py-1 text-sm rounded",style:{backgroundColor:s.colors.accent,color:"#ffffff"},children:"OK"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs font-semibold mb-1 px-2 py-1 rounded",style:{backgroundColor:s.colors.surface,color:s.colors.textMuted},children:t==="fr"?"Secondes":"Seconds"}),e.jsx("div",{className:"grid grid-cols-5 gap-1",children:i.seconds.map(m=>e.jsx("button",{type:"button",onClick:()=>d(m.value),className:"px-2 py-1 text-sm rounded text-center transition-colors",style:{backgroundColor:r===m.value?s.colors.accent+"30":s.colors.surface,color:r===m.value?s.colors.accent:s.colors.text,border:`1px solid ${r===m.value?s.colors.accent:"transparent"}`},children:m.label},m.value))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs font-semibold mb-1 px-2 py-1 rounded",style:{backgroundColor:s.colors.surface,color:s.colors.textMuted},children:"Minutes"}),e.jsx("div",{className:"grid grid-cols-5 gap-1",children:i.minutes.map(m=>e.jsx("button",{type:"button",onClick:()=>d(m.value),className:"px-2 py-1 text-sm rounded text-center transition-colors",style:{backgroundColor:r===m.value?s.colors.accent+"30":s.colors.surface,color:r===m.value?s.colors.accent:s.colors.text,border:`1px solid ${r===m.value?s.colors.accent:"transparent"}`},children:m.label},m.value))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs font-semibold mb-1 px-2 py-1 rounded",style:{backgroundColor:s.colors.surface,color:s.colors.textMuted},children:t==="fr"?"Heures":"Hours"}),e.jsx("div",{className:"grid grid-cols-5 gap-1",children:i.hours.map(m=>e.jsx("button",{type:"button",onClick:()=>d(m.value),className:"px-2 py-1 text-sm rounded text-center transition-colors",style:{backgroundColor:r===m.value?s.colors.accent+"30":s.colors.surface,color:r===m.value?s.colors.accent:s.colors.text,border:`1px solid ${r===m.value?s.colors.accent:"transparent"}`},children:m.label},m.value))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold mb-1 px-2 py-1 rounded",style:{backgroundColor:s.colors.surface,color:s.colors.textMuted},children:t==="fr"?"Jours":"Days"}),e.jsx("div",{className:"grid grid-cols-3 gap-1",children:i.days.map(m=>e.jsx("button",{type:"button",onClick:()=>d(m.value),className:"px-2 py-1 text-sm rounded text-center transition-colors",style:{backgroundColor:r===m.value?s.colors.accent+"30":s.colors.surface,color:r===m.value?s.colors.accent:s.colors.text,border:`1px solid ${r===m.value?s.colors.accent:"transparent"}`},children:m.label},m.value))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold mb-1 px-2 py-1 rounded",style:{backgroundColor:s.colors.surface,color:s.colors.textMuted},children:t==="fr"?"Semaines":"Weeks"}),e.jsx("div",{className:"grid grid-cols-3 gap-1",children:i.weeks.map(m=>e.jsx("button",{type:"button",onClick:()=>d(m.value),className:"px-2 py-1 text-sm rounded text-center transition-colors",style:{backgroundColor:r===m.value?s.colors.accent+"30":s.colors.surface,color:r===m.value?s.colors.accent:s.colors.text,border:`1px solid ${r===m.value?s.colors.accent:"transparent"}`},children:m.label},m.value))})]})]})]})})})]})}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Li.map(m=>e.jsx("button",{type:"button",onClick:()=>d(m),className:"px-2 py-1 text-xs rounded transition-colors",style:{backgroundColor:r===m?s.colors.accent:s.colors.surface,color:r===m?"#ffffff":s.colors.text,border:`1px solid ${r===m?s.colors.accent:s.colors.border}`},children:m},m))}),l.timeframe&&e.jsx("p",{className:"text-xs mt-1",style:{color:s.colors.danger},children:l.timeframe})]})}),Ii=({currentLanguage:t,currentTheme:s,value:r,errors:l,showDropdown:n,setShowDropdown:o,strategies:a,onInputChange:c,onSelect:i,onOpenStrategyModal:d})=>e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsxs("button",{type:"button",onClick:()=>o(!n),className:"w-full flex items-center justify-between px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:s.colors.surface,borderColor:l.strategy?s.colors.danger:s.colors.border,color:r?s.colors.text:s.colors.textMuted},children:[e.jsx("span",{children:r||(t==="fr"?"SÃ©lectionner une stratÃ©gie...":"Select a strategy...")}),e.jsx(Le,{size:16,className:`transition-transform ${n?"rotate-180":""}`})]}),n&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md shadow-lg overflow-hidden",style:{backgroundColor:s.colors.card,borderColor:s.colors.border,border:`1px solid ${s.colors.border}`},children:e.jsx("div",{className:"max-h-60 overflow-y-auto",children:e.jsxs("div",{className:"p-2",children:[e.jsx("input",{type:"text",value:r||"",onChange:u=>c(u.target.value),placeholder:t==="fr"?"Rechercher ou saisir...":"Search or type...",className:"w-full px-3 py-2 mb-2 border rounded-md",style:{backgroundColor:s.colors.surface,borderColor:s.colors.border,color:s.colors.text}}),e.jsx("div",{className:"grid grid-cols-1 gap-1",children:a.map(u=>e.jsx("button",{type:"button",onClick:()=>i(u),className:"px-3 py-2 text-sm rounded text-left transition-colors",style:{backgroundColor:r===u?s.colors.accent+"30":s.colors.surface,color:r===u?s.colors.accent:s.colors.text,border:`1px solid ${r===u?s.colors.accent:"transparent"}`},children:u},u))})]})})})]}),e.jsx("button",{type:"button",onClick:d,className:"px-3 py-2 rounded-md transition-colors",style:{backgroundColor:s.colors.accent,color:"#ffffff"},children:t==="fr"?"Choisir":"Choose"})]}),l.strategy&&e.jsx("p",{className:"text-xs mt-1",style:{color:s.colors.danger},children:l.strategy})]}),zi=({currentLanguage:t,currentTheme:s,value:r,errors:l,showDropdown:n,setShowDropdown:o,searchText:a,setSearchText:c,options:i,quickOptions:d,onSelect:u})=>e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>o(!n),className:"w-full flex items-center justify-between px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:s.colors.surface,borderColor:l.setup?s.colors.danger:s.colors.border,color:r?s.colors.text:s.colors.textMuted},children:[e.jsx("span",{children:r||(t==="fr"?"SÃ©lectionner un setup...":"Select a setup...")}),e.jsx(Le,{size:16,className:`transition-transform ${n?"rotate-180":""}`})]}),n&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md shadow-lg overflow-hidden",style:{backgroundColor:s.colors.card,borderColor:s.colors.border,border:`1px solid ${s.colors.border}`},children:e.jsx("div",{className:"max-h-60 overflow-y-auto",children:e.jsxs("div",{className:"p-2",children:[e.jsx("input",{type:"text",value:a,onChange:m=>c(m.target.value),placeholder:t==="fr"?"Rechercher ou saisir...":"Search or type...",className:"w-full px-3 py-2 mb-2 border rounded-md",style:{backgroundColor:s.colors.surface,borderColor:s.colors.border,color:s.colors.text}}),e.jsx("div",{className:"grid grid-cols-1 gap-1",children:i.map(m=>e.jsx("button",{type:"button",onClick:()=>u(m),className:"px-3 py-2 text-sm rounded text-left transition-colors",style:{backgroundColor:r===m?s.colors.accent+"30":s.colors.surface,color:r===m?s.colors.accent:s.colors.text,border:`1px solid ${r===m?s.colors.accent:"transparent"}`},children:m},m))})]})})}),l.setup&&e.jsx("p",{className:"text-xs mt-1",style:{color:s.colors.danger},children:l.setup}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:d.map(m=>e.jsx("button",{type:"button",onClick:()=>u(m),className:"px-2 py-1 text-xs rounded transition-colors",style:{backgroundColor:r===m?s.colors.accent:s.colors.surface,color:r===m?"#ffffff":s.colors.text,border:`1px solid ${r===m?s.colors.accent:s.colors.border}`},children:m},m))})]}),Oi=({currentLanguage:t,currentTheme:s,value:r,errors:l,showDropdown:n,setShowDropdown:o,newTag:a,setNewTag:c,previousTags:i,onAddTag:d,onAddFromDropdown:u,onRemoveTag:m})=>{const p=x=>{x.key==="Enter"&&(x.preventDefault(),d())};return e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:r.map(x=>e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 rounded-full",style:{backgroundColor:s.colors.accent+"20",borderColor:s.colors.accent,border:`1px solid ${s.colors.accent}40`},children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.text},children:x}),e.jsx("button",{type:"button",onClick:()=>m(x),className:"rounded-full p-0.5 hover:bg-opacity-80 transition-colors",style:{backgroundColor:s.colors.accent+"30"},children:e.jsx(be,{size:12,style:{color:s.colors.text}})})]},x))}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"text",value:a,onChange:x=>c(x.target.value),onKeyDown:p,placeholder:t==="fr"?"Ajouter un tag et appuyer sur EntrÃ©e":"Add a tag and press Enter",className:"w-full px-3 py-2 border rounded-l-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:s.colors.surface,borderColor:l.tags?s.colors.danger:s.colors.border,color:s.colors.text}}),e.jsx("button",{type:"button",onClick:()=>o(!n),className:"px-3 py-2 border-t border-r border-b rounded-r-md",style:{backgroundColor:s.colors.surface,borderColor:l.tags?s.colors.danger:s.colors.border,color:s.colors.text},children:e.jsx(Le,{size:16,className:`transition-transform ${n?"rotate-180":""}`})})]}),n&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md shadow-lg overflow-hidden",style:{backgroundColor:s.colors.card,borderColor:s.colors.border,border:`1px solid ${s.colors.border}`},children:e.jsx("div",{className:"max-h-60 overflow-y-auto",children:e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-xs font-semibold mb-2 px-2 py-1 rounded",style:{backgroundColor:s.colors.surface,color:s.colors.textMuted},children:t==="fr"?"Tags existants":"Existing tags"}),e.jsx("div",{className:"grid grid-cols-1 gap-1",children:i.map(x=>e.jsx("button",{type:"button",onClick:()=>u(x),className:"px-3 py-2 text-sm rounded text-left transition-colors",style:{backgroundColor:r.includes(x)?s.colors.accent+"30":s.colors.surface,color:r.includes(x)?s.colors.accent:s.colors.text,border:`1px solid ${r.includes(x)?s.colors.accent:"transparent"}`},children:x},x))})]})})})]}),e.jsx("button",{type:"button",onClick:d,className:"px-3 py-2 rounded-md transition-colors",style:{backgroundColor:s.colors.accent,color:"#ffffff"},children:e.jsx(Ye,{size:16})})]}),l.tags&&e.jsx("p",{className:"text-xs mt-1",style:{color:s.colors.danger},children:l.tags})]})},qi=t=>{const[s,r]=b.useState(!1),[l,n]=b.useState(!1),[o,a]=b.useState(!1),[c,i]=b.useState(!1);return b.useEffect(()=>{const d=u=>{const{timeframeRef:m,strategyRef:p,setupRef:x,tagsRef:f}=t;m?.current&&!m.current.contains(u.target)&&r(!1),p?.current&&!p.current.contains(u.target)&&n(!1),x?.current&&!x.current.contains(u.target)&&a(!1),f?.current&&!f.current.contains(u.target)&&i(!1)};return document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[t]),{showTimeframeDropdown:s,setShowTimeframeDropdown:r,showStrategyDropdown:l,setShowStrategyDropdown:n,showSetupDropdown:o,setShowSetupDropdown:a,showTagsDropdown:c,setShowTagsDropdown:i}},Ui=(t=[])=>{const[s,r]=b.useState(t);return{previousSetups:s,setPreviousSetups:r,addSetupToPrevious:o=>{o&&!s.includes(o)&&r(a=>[o,...a])},getQuickSelectSetups:()=>{const o=[],a=new Set;for(const c of s)!a.has(c)&&o.length<5&&(a.add(c),o.push(c));return o}}},_i=(t=[])=>{const[s,r]=b.useState(t);return{previousTags:s,setPreviousTags:r,addTagsToPrevious:a=>{const c=a.filter(i=>!s.includes(i));c.length>0&&r(i=>[...c,...i])},addSingleTagToPrevious:a=>{a&&!s.includes(a)&&r(c=>[a,...c])},getQuickSelectTags:()=>s.slice(0,5)}},Wi=({formData:t,onChange:s,errors:r,onOpenStrategyModal:l})=>{const{currentLanguage:n,t:o}=X(),{currentTheme:a}=ee(),[c,i]=b.useState(""),[d,u]=b.useState(""),[m,p]=b.useState(""),x=b.useRef(null),f=b.useRef(null),g=b.useRef(null),h=b.useRef(null),{showTimeframeDropdown:y,setShowTimeframeDropdown:j,showStrategyDropdown:v,setShowStrategyDropdown:N,showSetupDropdown:S,setShowSetupDropdown:w,showTagsDropdown:k,setShowTagsDropdown:M}=qi({timeframeRef:x,strategyRef:f,setupRef:g,tagsRef:h}),{previousSetups:C,setPreviousSetups:R,addSetupToPrevious:P,getQuickSelectSetups:D}=Ui(["Cassure","Rebond","Divergence","Support/RÃ©sistance","Tendance","Range","Momentum","Retournement"]),{previousTags:T,addTagsToPrevious:E,addSingleTagToPrevious:L}=_i(["important","Ã  revoir","rÃ©ussi","Ã©chec","scalping","day trading","swing","momentum"]),U=$=>{s("timeframe",$),j(!1)},_=$=>{s("strategy",$),N(!1)},B=$=>{s("setup",$),w(!1),C.includes($)||R(V=>[$,...V])},z=()=>{c&&(s("timeframe",c),i(""),j(!1))},A=()=>{if(m.trim()){const $=[...t.tags];if(!$.includes(m.trim())){const V=[...$,m.trim()];s("tags",V),L(m.trim())}p("")}},F=$=>{const V=[...t.tags];if(!V.includes($)){const K=[...V,$];s("tags",K)}M(!1)},q=$=>{const V=t.tags.filter(K=>K!==$);s("tags",V)},I=(()=>{const $=[...Fi];return C.forEach(V=>{$.includes(V)||$.push(V)}),d?$.filter(V=>V.toLowerCase().includes(d.toLowerCase())):$})();return b.useEffect(()=>{t.setup&&P(t.setup),t.tags&&t.tags.length>0&&E(t.tags)},[t.setup,t.tags]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{ref:x,children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ee,{size:16,className:"mr-2"}),"Timeframe"]}),e.jsx("span",{className:"text-xs",style:{color:a.colors.textMuted},children:n==="fr"?"(Optionnel pour les trades en ticks)":"(Optional for tick trading)"})]})}),e.jsx($i,{currentLanguage:n,currentTheme:a,value:t.timeframe,errors:r,showDropdown:y,setShowDropdown:j,customTimeframe:c,setCustomTimeframe:i,categorizedTimeframes:Ai,onSelect:U,onSubmitCustom:z})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:n==="fr"?"Tendance":"Trend"}),e.jsxs("select",{value:t.trend,onChange:$=>s("trend",$.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.trend?a.colors.danger:a.colors.border,color:a.colors.text},required:!0,children:[e.jsx("option",{value:"bullish",children:n==="fr"?"HaussiÃ¨re":"Bullish"}),e.jsx("option",{value:"bearish",children:n==="fr"?"BaissiÃ¨re":"Bearish"}),e.jsx("option",{value:"sideways",children:n==="fr"?"LatÃ©rale":"Sideways"})]}),r.trend&&e.jsx("p",{className:"text-xs mt-1",style:{color:a.colors.danger},children:r.trend})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:n==="fr"?"Statut":"Status"}),e.jsxs("select",{value:t.status,onChange:$=>s("status",$.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:a.colors.surface,borderColor:r.status?a.colors.danger:a.colors.border,color:a.colors.text},required:!0,children:[e.jsx("option",{value:"closed",children:n==="fr"?"FermÃ©":"Closed"}),e.jsx("option",{value:"open",children:n==="fr"?"Ouvert":"Open"})]}),r.status&&e.jsx("p",{className:"text-xs mt-1",style:{color:a.colors.danger},children:r.status})]})]}),e.jsxs("div",{ref:f,children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Me,{size:16,className:"mr-2"}),n==="fr"?"StratÃ©gie":"Strategy"]})}),e.jsx(Ii,{currentLanguage:n,currentTheme:a,value:t.strategy,errors:r,showDropdown:v,setShowDropdown:N,strategies:Ei,onInputChange:$=>s("strategy",$),onSelect:_,onOpenStrategyModal:l})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{ref:g,children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:"Setup"}),e.jsx(zi,{currentLanguage:n,currentTheme:a,value:t.setup,errors:r,showDropdown:S,setShowDropdown:w,searchText:d,setSearchText:$=>{u($),s("setup",$)},options:I,quickOptions:D(),onSelect:B})]}),e.jsxs("div",{ref:h,children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:a.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ms,{size:16,className:"mr-2"}),"Tags"]})}),e.jsx(Oi,{currentLanguage:n,currentTheme:a,value:t.tags,errors:r,showDropdown:k,setShowDropdown:M,newTag:m,setNewTag:p,previousTags:T,onAddTag:A,onAddFromDropdown:F,onRemoveTag:q})]})]})]})},Vi=({formData:t,onChange:s,errors:r,settings:l})=>{const{currentLanguage:n}=X(),{currentTheme:o}=ee(),[a,c]=b.useState(null),[i,d]=b.useState("percentage"),[u,m]=b.useState("auto"),[p,x]=b.useState(0),[f,g]=b.useState(0),[h,y]=b.useState(0),[j,v]=b.useState(0),[N,S]=b.useState("");O.useEffect(()=>{if(t.duration!==void 0&&t.duration!==""){const F=Number(t.duration);if(!isNaN(F)){const q=Math.floor(F/86400),W=Math.floor(F%86400/3600),I=Math.floor(F%3600/60),$=F%60;x(q),g(W),y(I),v($)}}t.tradeResult&&S(t.tradeResult)},[]);const w=F=>l.initialCapital*F/100,k=F=>F/l.initialCapital*100,M=()=>{const F=typeof t.ticksGained=="number"?t.ticksGained:parseFloat(String(t.ticksGained).replace(",","."))||0,q=typeof t.tickValue=="number"?t.tickValue:parseFloat(String(t.tickValue).replace(",","."))||0,W=typeof t.quantity=="number"?t.quantity:parseFloat(String(t.quantity).replace(",","."))||0;return F*q*W},C=()=>M()/l.initialCapital*100;b.useEffect(()=>{if(t.ticksGained!==void 0&&t.ticksGained!==""&&t.tickValue!==void 0&&t.tickValue!==""&&t.quantity!==void 0&&t.quantity!==""){const F=M(),q=C();s("pnlPercentage",Math.round(q*100)/100),s("pnl",Math.round(F*100)/100)}},[t.ticksGained,t.tickValue,t.quantity]);const R=F=>{S(F),s("tradeResult",F)},P=F=>{if(!F)return"0s";const q=Math.floor(F/86400),W=Math.floor(F%86400/3600),I=Math.floor(F%3600/60),$=F%60;let V="";return q>0&&(V+=`${q}j `),(W>0||q>0)&&(V+=`${W}h `),(I>0||W>0||q>0)&&(V+=`${I}m `),($>0||!q&&!W&&!I)&&(V+=`${$}s`),V.trim()},D=(F,q,W,I)=>{const $=F*86400+q*3600+W*60+I;s("duration",$>0?$:void 0)},T=(F,q)=>{const W=parseInt(q)||0;F==="days"?(x(W),D(W,f,h,j)):F==="hours"?(g(W),D(p,W,h,j)):F==="minutes"?(y(W),D(p,f,W,j)):F==="seconds"&&(v(W),D(p,f,h,W))},E=F=>F==null?"":String(F),L=()=>t.pnlPercentage===void 0||t.pnlPercentage===""?0:parseFloat(String(t.pnlPercentage).replace(",","."))||0,U=L()>0,_=L()<0,B=()=>{d(i==="percentage"?"currency":"percentage")},z=u==="auto"||u==="ticks",A=u==="auto"||u==="lots";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm font-medium",style:{color:o.colors.textSecondary},children:n==="fr"?"RÃ©sultat:":"Result:"}),e.jsxs("div",{className:"flex space-x-1 p-1 rounded-lg",style:{backgroundColor:o.colors.surface},children:[e.jsxs("button",{type:"button",onClick:()=>R("tp"),className:"flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors",style:{backgroundColor:"transparent",color:N==="tp"?o.colors.success:o.colors.textSecondary},children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-1",style:{backgroundColor:N==="tp"?"var(--theme-success)":"var(--theme-surface)"}}),"TP"]}),e.jsxs("button",{type:"button",onClick:()=>R("sl"),className:"flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors",style:{backgroundColor:"transparent",color:N==="sl"?o.colors.danger:o.colors.textSecondary},children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-1",style:{backgroundColor:N==="sl"?"var(--theme-danger)":"var(--theme-surface)"}}),"SL"]}),e.jsxs("button",{type:"button",onClick:()=>R("be"),className:"flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors",style:{backgroundColor:"transparent",color:N==="be"?o.colors.warning:o.colors.textSecondary},children:[e.jsx("div",{className:`w-3 h-3 rounded-full mr-1 ${N==="be"?"bg-yellow-500 dark:bg-yellow-400":"theme-surface"}`}),"BE"]}),e.jsx("button",{type:"button",onClick:()=>R(""),className:"flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors",style:{backgroundColor:"transparent",color:N===""?o.colors.text:o.colors.textSecondary,border:N===""?`1px solid ${o.colors.border}`:"none"},children:n==="fr"?"Aucun":"None"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>{const F=document.getElementById("display-mode-dropdown");F&&F.classList.toggle("hidden")},className:"flex items-center space-x-2 px-3 py-2 rounded-lg text-sm transition-colors",style:{backgroundColor:o.colors.surface,color:o.colors.text,border:`1px solid ${o.colors.border}`},children:[e.jsx(ss,{size:16,className:"mr-2"}),e.jsx("span",{children:n==="fr"?"DonnÃ©es de performance":"Performance data"}),e.jsx(Le,{size:14})]}),e.jsx("div",{id:"display-mode-dropdown",className:"absolute right-0 mt-1 w-48 rounded-md shadow-lg hidden z-10",style:{backgroundColor:o.colors.card,border:`1px solid ${o.colors.border}`},children:e.jsx("div",{className:"py-1",children:[{value:"auto",label:n==="fr"?"Automatique (tout afficher)":"Automatic (show all)"},{value:"ticks",label:n==="fr"?"Ticks uniquement":"Ticks only"},{value:"lots",label:n==="fr"?"Lots uniquement":"Lots only"},{value:"none",label:n==="fr"?"Aucun":"None"}].map(F=>e.jsx("button",{type:"button",onClick:()=>{m(F.value);const q=document.getElementById("display-mode-dropdown");q&&q.classList.add("hidden")},className:"block w-full text-left px-4 py-2 text-sm transition-colors",style:{backgroundColor:u===F.value?`${o.colors.accent}20`:"transparent",color:u===F.value?o.colors.accent:o.colors.text},children:F.label},F.value))})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:o.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[i==="percentage"?e.jsx(us,{size:16,className:"mr-2"}):e.jsx(rr,{size:16,className:"mr-2"}),"P&L"]}),e.jsx("button",{type:"button",onClick:B,className:"flex items-center text-xs px-2 py-1 rounded transition-colors",style:{backgroundColor:o.colors.accent+"20",color:o.colors.accent},children:i==="percentage"?e.jsxs(e.Fragment,{children:[e.jsx(rr,{size:12,className:"mr-1"}),e.jsx("span",{children:"Mode â‚¬"}),e.jsx(wi,{size:16,className:"ml-1"})]}):e.jsxs(e.Fragment,{children:[e.jsx(us,{size:12,className:"mr-1"}),e.jsx("span",{children:"Mode %"}),e.jsx(Si,{size:16,className:"ml-1"})]})})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:E(i==="percentage"?t.pnlPercentage:t.pnl),onChange:F=>{if(i==="percentage"){s("pnlPercentage",F.target.value);const q=parseFloat(String(F.target.value).replace(",","."));if(!isNaN(q)){const W=w(q);s("pnl",W)}}else{s("pnl",F.target.value);const q=parseFloat(String(F.target.value).replace(",","."));if(!isNaN(q)){const W=k(q);s("pnlPercentage",W)}}},className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.pnlPercentage?o.colors.danger:o.colors.border,color:U?o.colors.success:_?o.colors.danger:o.colors.text},placeholder:"0",required:!0}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{style:{color:o.colors.textMuted},children:i==="percentage"?"%":l.currency})}),r.pnlPercentage&&e.jsx("p",{className:"text-xs mt-1",style:{color:o.colors.danger},children:r.pnlPercentage})]}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("p",{className:"text-xs",style:{color:U?o.colors.success:_?o.colors.danger:o.colors.textMuted},children:i==="percentage"?t.pnlPercentage!==void 0&&t.pnlPercentage!==""&&e.jsx("span",{children:new Intl.NumberFormat(n==="fr"?"fr-FR":"en-US",{style:"currency",currency:l.currency,minimumFractionDigits:0,maximumFractionDigits:0}).format(w(parseFloat(String(t.pnlPercentage).replace(",","."))||0))}):t.pnl!==void 0&&t.pnl!==""&&e.jsx("span",{children:`${k(parseFloat(String(t.pnl).replace(",","."))||0)>=0?"+":""}${k(parseFloat(String(t.pnl).replace(",","."))||0).toFixed(2)}%`})}),e.jsxs("div",{className:"ml-2 cursor-help",onMouseEnter:()=>c("pnl"),onMouseLeave:()=>c(null),children:[e.jsx(As,{size:14,style:{color:o.colors.textMuted}}),a==="pnl"&&e.jsx("div",{className:"absolute z-10 p-2 rounded-md shadow-lg max-w-xs",style:{backgroundColor:o.colors.card,border:`1px solid ${o.colors.border}`,color:o.colors.text},children:e.jsx("p",{className:"text-xs",children:n==="fr"?"Pourcentage de gain/perte par rapport au capital initial. Le montant en devise est calculÃ© automatiquement.":"Percentage of gain/loss relative to initial capital. The amount in currency is calculated automatically."})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:o.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(He,{size:16,className:"mr-2"}),n==="fr"?"Ratio Risk/Reward":"Risk/Reward Ratio"]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:E(t.riskReward),onChange:F=>{s("riskReward",F.target.value)},className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.riskReward?o.colors.danger:o.colors.border,color:o.colors.text},placeholder:"0"}),r.riskReward&&e.jsx("p",{className:"text-xs mt-1",style:{color:o.colors.danger},children:r.riskReward})]}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("p",{className:"text-xs",style:{color:o.colors.textMuted},children:n==="fr"?"Ratio entre le gain potentiel et la perte potentielle":"Ratio between potential gain and potential loss"}),e.jsxs("div",{className:"ml-2 cursor-help",onMouseEnter:()=>c("rr"),onMouseLeave:()=>c(null),children:[e.jsx(As,{size:14,style:{color:o.colors.textMuted}}),a==="rr"&&e.jsx("div",{className:"absolute z-10 p-2 rounded-md shadow-lg max-w-xs",style:{backgroundColor:o.colors.card,border:`1px solid ${o.colors.border}`,color:o.colors.text},children:e.jsx("p",{className:"text-xs",children:n==="fr"?"Ex: Un ratio de 2 signifie que vous risquez 1 pour gagner 2. Un ratio nÃ©gatif indique un trade avec un risque plus Ã©levÃ© que le gain potentiel.":"Ex: A ratio of 2 means you risk 1 to gain 2. A negative ratio indicates a trade with higher risk than potential gain."})})]})]})]})]}),A&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:o.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(He,{size:16,className:"mr-2"}),n==="fr"?"Nombre de lots (Forex/CFD)":"Number of lots (Forex/CFD)"]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:E(t.numberOfLots),onChange:F=>{s("numberOfLots",F.target.value)},className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.numberOfLots?o.colors.danger:o.colors.border,color:o.colors.text},placeholder:"0"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{style:{color:o.colors.textMuted},children:"lots"})}),r.numberOfLots&&e.jsx("p",{className:"text-xs mt-1",style:{color:o.colors.danger},children:r.numberOfLots})]}),e.jsx("div",{className:"flex items-center mt-1",children:e.jsx("p",{className:"text-xs",style:{color:o.colors.textMuted},children:n==="fr"?"Information sur le nombre de lots pour Forex/CFD":"Information about number of lots for Forex/CFD"})})]}),z&&e.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:o.colors.surface+"30",borderColor:o.colors.border},children:[e.jsx("h3",{className:"text-sm font-medium mb-3",style:{color:o.colors.text},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Me,{size:16,className:"mr-2"}),n==="fr"?"SystÃ¨me de Ticks (Scalping)":"Tick System (Scalping)"]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:o.colors.textSecondary},children:n==="fr"?"Ticks gagnÃ©s/perdus":"Ticks gained/lost"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:E(t.ticksGained),onChange:F=>{s("ticksGained",F.target.value)},className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.ticksGained?o.colors.danger:o.colors.border,color:parseFloat(String(t.ticksGained).replace(",","."))>0?o.colors.success:parseFloat(String(t.ticksGained).replace(",","."))<0?o.colors.danger:o.colors.text},placeholder:"0"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{style:{color:o.colors.textMuted},children:"ticks"})}),r.ticksGained&&e.jsx("p",{className:"text-xs mt-1",style:{color:o.colors.danger},children:r.ticksGained})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:o.colors.textSecondary},children:n==="fr"?"Valeur par tick":"Value per tick"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:E(t.tickValue),onChange:F=>{s("tickValue",F.target.value)},className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.tickValue?o.colors.danger:o.colors.border,color:o.colors.text},placeholder:"0"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsxs("span",{style:{color:o.colors.textMuted},children:[l.currency,"/tick"]})}),r.tickValue&&e.jsx("p",{className:"text-xs mt-1",style:{color:o.colors.danger},children:r.tickValue})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",style:{color:o.colors.textSecondary},children:[e.jsx("span",{children:n==="fr"?"Nombre de contrats":"Number of contracts"}),e.jsx("span",{className:"ml-2 text-xs",style:{color:o.colors.textMuted},children:n==="fr"?"(Optionnel)":"(Optional)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:E(t.quantity),onChange:F=>{s("quantity",F.target.value)},className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.quantity?o.colors.danger:o.colors.border,color:o.colors.text},placeholder:"0"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{style:{color:o.colors.textMuted},children:n==="fr"?"contrats":"contracts"})}),r.quantity&&e.jsx("p",{className:"text-xs mt-1",style:{color:o.colors.danger},children:r.quantity})]})]})]}),t.ticksGained!==void 0&&t.ticksGained!==""&&t.tickValue!==void 0&&t.tickValue!==""&&t.quantity!==void 0&&t.quantity!==""&&e.jsxs("div",{className:"mt-3 p-3 rounded-lg",style:{backgroundColor:o.colors.surface},children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm",style:{color:o.colors.textSecondary},children:[n==="fr"?"Valeur totale des ticks":"Total ticks value",":"]}),e.jsx("span",{className:"font-bold",style:{color:parseFloat(String(t.ticksGained).replace(",","."))>=0?o.colors.success:o.colors.danger},children:new Intl.NumberFormat(n==="fr"?"fr-FR":"en-US",{style:"currency",currency:l.currency,minimumFractionDigits:0,maximumFractionDigits:0}).format(M())})]}),e.jsx("div",{className:"text-xs mt-1",style:{color:o.colors.textMuted},children:n==="fr"?`Calcul: ${t.ticksGained} ticks Ã— ${t.tickValue} ${l.currency} Ã— ${t.quantity||0} contrat${parseFloat(String(t.quantity||0).replace(",","."))>1?"s":""}`:`Calculation: ${t.ticksGained} ticks Ã— ${t.tickValue} ${l.currency} Ã— ${t.quantity||0} contract${parseFloat(String(t.quantity||0).replace(",","."))>1?"s":""}`})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:o.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx($e,{size:16,className:"mr-2"}),n==="fr"?"DurÃ©e":"Duration"]})}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{children:[e.jsx("input",{type:"number",min:"0",value:p||"",onChange:F=>T("days",F.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.duration?o.colors.danger:o.colors.border,color:o.colors.text},placeholder:"0"}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:o.colors.textMuted},children:n==="fr"?"Jours":"Days"})]}),e.jsxs("div",{children:[e.jsx("input",{type:"number",min:"0",max:"23",value:f||"",onChange:F=>T("hours",F.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.duration?o.colors.danger:o.colors.border,color:o.colors.text},placeholder:"0"}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:o.colors.textMuted},children:n==="fr"?"Heures":"Hours"})]}),e.jsxs("div",{children:[e.jsx("input",{type:"number",min:"0",max:"59",value:h||"",onChange:F=>T("minutes",F.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.duration?o.colors.danger:o.colors.border,color:o.colors.text},placeholder:"0"}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:o.colors.textMuted},children:"Minutes"})]}),e.jsxs("div",{children:[e.jsx("input",{type:"number",min:"0",max:"59",value:j||"",onChange:F=>T("seconds",F.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:o.colors.surface,borderColor:r.duration?o.colors.danger:o.colors.border,color:o.colors.text},placeholder:"0"}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:o.colors.textMuted},children:n==="fr"?"Secondes":"Seconds"})]})]}),r.duration&&e.jsx("p",{className:"text-xs mt-1",style:{color:o.colors.danger},children:r.duration}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("p",{className:"text-xs",style:{color:o.colors.textMuted},children:typeof t.duration=="number"&&t.duration>0&&e.jsx("span",{children:P(t.duration)})}),e.jsxs("div",{className:"ml-2 cursor-help",onMouseEnter:()=>c("duration"),onMouseLeave:()=>c(null),children:[e.jsx(As,{size:14,style:{color:o.colors.textMuted}}),a==="duration"&&e.jsx("div",{className:"absolute z-10 p-2 rounded-md shadow-lg max-w-xs",style:{backgroundColor:o.colors.card,border:`1px solid ${o.colors.border}`,color:o.colors.text},children:e.jsx("p",{className:"text-xs",children:n==="fr"?"DurÃ©e totale du trade, du moment de l'entrÃ©e jusqu'Ã  la sortie.":"Total duration of the trade, from entry to exit."})})]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:o.colors.surface+"50"},children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(Ee,{size:18,style:{color:o.colors.accent},className:"mr-2"}),e.jsx("h3",{className:"text-sm font-medium",style:{color:o.colors.text},children:n==="fr"?"Informations de Performance":"Performance Information"})]}),e.jsxs("div",{className:"text-xs space-y-2",style:{color:o.colors.textSecondary},children:[e.jsx("p",{children:n==="fr"?"â€¢ Le P&L peut Ãªtre saisi en pourcentage ou en euros selon le mode choisi.":"â€¢ P&L can be entered as percentage or euros depending on the selected mode."}),e.jsx("p",{children:n==="fr"?"â€¢ Pour le scalping, renseignez les ticks gagnÃ©s, la valeur par tick et le nombre de contrats.":"â€¢ For scalping, enter the ticks gained, value per tick, and number of contracts."}),e.jsx("p",{children:n==="fr"?"â€¢ Pour le Forex/CFD, utilisez le champ nombre de lots (distinct des contrats).":"â€¢ For Forex/CFD, use the number of lots field (separate from contracts)."}),e.jsx("p",{children:n==="fr"?"â€¢ La durÃ©e peut Ãªtre exprimÃ©e en jours, heures, minutes et secondes.":"â€¢ Duration can be expressed in days, hours, minutes and seconds."}),e.jsx("p",{children:n==="fr"?"â€¢ Le ratio Risk/Reward reprÃ©sente le rapport entre gain potentiel et perte potentielle.":"â€¢ Risk/Reward ratio represents the relationship between potential gain and potential loss."}),e.jsx("p",{children:n==="fr"?"â€¢ Indiquez si le trade a atteint son Take Profit (TP), son Stop Loss (SL) ou son Break Even (BE).":"â€¢ Indicate if the trade reached its Take Profit (TP), Stop Loss (SL) or Break Even (BE)."})]})]})]})},Bi=({screenshots:t,onScreenshotsChange:s})=>{const r=b.useRef(null),[l,n]=b.useState(!1),{currentLanguage:o}=X(),{currentTheme:a}=ee(),c=t.map(f=>typeof f=="string"?{url:f,caption:""}:f),i=f=>{f&&Array.from(f).forEach(g=>{if(g.type.startsWith("image/")){const h=new FileReader;h.onload=y=>{const j=y.target?.result;j&&s([...c,{url:j,caption:""}])},h.readAsDataURL(g)}})},d=f=>{f.preventDefault(),n(!1),i(f.dataTransfer.files)},u=f=>{f.preventDefault(),n(!0)},m=f=>{f.preventDefault(),n(!1)},p=f=>{const g=[...c];g.splice(f,1),s(g)},x=(f,g)=>{const h=[...c];h[f].caption=g,s(h)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium theme-text-muted",children:o==="fr"?"Screenshots du Trade":"Trade Screenshots"}),e.jsx("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${l?"border-blue-600 bg-blue-600/10":"theme-border hover:border-blue-300"}`,onDrop:d,onDragOver:u,onDragLeave:m,style:{borderColor:l?a.colors.accent:a.colors.border,backgroundColor:l?`${a.colors.accent}10`:"transparent"},children:e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx(gl,{className:"w-8 h-8",style:{color:a.colors.textMuted}}),e.jsxs("div",{className:"text-sm",style:{color:a.colors.textSecondary},children:[e.jsx("button",{type:"button",onClick:()=>r.current?.click(),className:"font-medium",style:{color:a.colors.accent},children:o==="fr"?"Cliquez pour ajouter":"Click to add"})," ",o==="fr"?"ou glissez-dÃ©posez vos screenshots":"or drag and drop your screenshots"]}),e.jsxs("div",{className:"text-xs",style:{color:a.colors.textMuted},children:["PNG, JPG, GIF ",o==="fr"?"jusqu'Ã ":"up to"," 10MB"]})]})}),e.jsx("input",{ref:r,type:"file",multiple:!0,accept:"image/*",onChange:f=>i(f.target.files),className:"hidden"}),c.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:c.map((f,g)=>e.jsxs("div",{className:"relative group border rounded-lg p-2",style:{borderColor:a.colors.border},children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:f.url,alt:`Screenshot ${g+1}`,className:"w-full h-48 object-cover rounded-lg",style:{borderColor:a.colors.border}}),e.jsx("button",{type:"button",onClick:()=>p(g),className:"absolute top-2 right-2 p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",style:{backgroundColor:a.colors.danger,color:"#ffffff"},children:e.jsx(be,{size:14})}),e.jsx("div",{className:"absolute bottom-2 left-2 px-2 py-1 rounded text-xs font-medium",style:{backgroundColor:"rgba(0,0,0,0.6)",color:"#ffffff"},children:g+1})]}),e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"text",value:f.caption,onChange:h=>x(g,h.target.value),placeholder:o==="fr"?"LÃ©gende du screenshot...":"Screenshot caption...",className:"w-full px-3 py-2 text-sm border rounded-md",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text}})})]},g))})]})},Hi=({formData:t,onChange:s,errors:r})=>{const{currentLanguage:l}=X(),{currentTheme:n}=ee();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:n.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ss,{size:16,className:"mr-2"}),"Notes"]})}),e.jsx("textarea",{value:t.notes||"",onChange:o=>s("notes",o.target.value),rows:6,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:n.colors.surface,borderColor:r.notes?n.colors.danger:n.colors.border,color:n.colors.text},placeholder:l==="fr"?"Notes sur le trade, observations, leÃ§ons apprises...":"Notes about the trade, observations, lessons learned..."}),r.notes&&e.jsx("p",{className:"text-xs mt-1",style:{color:n.colors.danger},children:r.notes}),e.jsx("p",{className:"text-xs mt-1",style:{color:n.colors.textMuted},children:l==="fr"?"Documentez vos observations, les raisons de votre entrÃ©e/sortie, et les leÃ§ons apprises":"Document your observations, reasons for entry/exit, and lessons learned"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:n.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(gl,{size:16,className:"mr-2"}),l==="fr"?"Screenshots du Trade":"Trade Screenshots"]})}),e.jsx(Bi,{screenshots:t.screenshots||[],onScreenshotsChange:o=>s("screenshots",o)}),e.jsx("p",{className:"text-xs mt-2",style:{color:n.colors.textMuted},children:l==="fr"?"Ajoutez des captures d'Ã©cran de votre setup, entrÃ©e, sortie ou analyse technique":"Add screenshots of your setup, entry, exit or technical analysis"})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:n.colors.surface+"50"},children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(Ss,{size:18,style:{color:n.colors.accent},className:"mr-2"}),e.jsx("h3",{className:"text-sm font-medium",style:{color:n.colors.text},children:l==="fr"?"Pourquoi documenter vos trades ?":"Why document your trades?"})]}),e.jsxs("div",{className:"text-xs space-y-2",style:{color:n.colors.textSecondary},children:[e.jsx("p",{children:l==="fr"?"â€¢ Les notes dÃ©taillÃ©es vous aident Ã  identifier vos forces et faiblesses.":"â€¢ Detailed notes help you identify your strengths and weaknesses."}),e.jsx("p",{children:l==="fr"?"â€¢ Les screenshots sont essentiels pour revoir vos setups et votre analyse technique.":"â€¢ Screenshots are essential for reviewing your setups and technical analysis."}),e.jsx("p",{children:l==="fr"?"â€¢ Un journal bien documentÃ© est la clÃ© pour amÃ©liorer votre trading Ã  long terme.":"â€¢ A well-documented journal is key to improving your trading in the long run."})]})]})]})},Gi=({formData:t,onChange:s,errors:r})=>{const{currentLanguage:l}=X(),{currentTheme:n}=ee(),[o,a]=b.useState({grossPnl:0,totalFees:0,netPnl:0}),c=m=>{if(m==null||m==="")return 0;if(typeof m=="number")return m;const p=String(m).replace(",","."),x=parseFloat(p);return isNaN(x)?0:x},i=(m,p)=>{const x={...t.fees||{}};x[m]=p;const f=["commission","spread","swapOvernight","exchangeFees","regulatoryFees","otherFees"];x.total=f.reduce((g,h)=>{const y=c(x[h]);return g+y},0),s("fees",x)},d=m=>m==null?"":String(m);b.useEffect(()=>{const m=c(t.pnl),p=t.fees?.total||0,x=m+p;a({grossPnl:m,totalFees:p,netPnl:x})},[t.pnl,t.fees]);const u=m=>new Intl.NumberFormat(l==="fr"?"fr-FR":"en-US",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}).format(m);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:n.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ke,{size:16,className:"mr-2"}),l==="fr"?"Frais et Commissions":"Fees and Commissions"]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",style:{color:n.colors.textMuted},children:"Commission"}),e.jsx("input",{type:"text",value:d(t.fees?.commission),onChange:m=>i("commission",m.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:n.colors.surface,borderColor:r.notes?n.colors.danger:n.colors.border,color:n.colors.text},placeholder:"-2.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",style:{color:n.colors.textMuted},children:"Spread"}),e.jsx("input",{type:"text",value:d(t.fees?.spread),onChange:m=>i("spread",m.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:n.colors.surface,borderColor:r.notes?n.colors.danger:n.colors.border,color:n.colors.text},placeholder:"-1.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",style:{color:n.colors.textMuted},children:l==="fr"?"Swap Overnight":"Overnight Swap"}),e.jsx("input",{type:"text",value:d(t.fees?.swapOvernight),onChange:m=>i("swapOvernight",m.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:n.colors.surface,borderColor:r.notes?n.colors.danger:n.colors.border,color:n.colors.text},placeholder:"-0.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",style:{color:n.colors.textMuted},children:l==="fr"?"Frais d'Ã‰change":"Exchange Fees"}),e.jsx("input",{type:"text",value:d(t.fees?.exchangeFees),onChange:m=>i("exchangeFees",m.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:n.colors.surface,borderColor:r.notes?n.colors.danger:n.colors.border,color:n.colors.text},placeholder:"-1.2"})]})]}),e.jsx("div",{className:"mt-4 p-3 rounded-lg",style:{backgroundColor:n.colors.surface},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",style:{color:n.colors.text},children:l==="fr"?"Total des frais":"Total fees"}),e.jsxs("span",{className:"font-bold",style:{color:n.colors.warning},children:[(t.fees?.total||0)>=0?"+":"",u(t.fees?.total||0)]})]})})]}),e.jsxs("div",{className:"mt-8 p-4 rounded-lg border",style:{backgroundColor:n.colors.surface+"30",borderColor:n.colors.border,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(Wo,{size:20,className:"mr-2",style:{color:n.colors.accent}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:n.colors.text},children:l==="fr"?"RÃ©sumÃ© P&L":"P&L Summary"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ee,{size:16,className:"mr-2",style:{color:o.grossPnl>=0?n.colors.success:n.colors.danger}}),e.jsx("span",{style:{color:n.colors.textSecondary},children:l==="fr"?"P&L Brut (avant frais)":"Gross P&L (before fees)"})]}),e.jsxs("span",{className:"font-bold",style:{color:o.grossPnl>=0?n.colors.success:n.colors.danger},children:[o.grossPnl>=0?"+":"",u(o.grossPnl)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ke,{size:16,className:"mr-2",style:{color:n.colors.warning}}),e.jsx("span",{style:{color:n.colors.textSecondary},children:l==="fr"?"Frais Totaux":"Total Fees"})]}),e.jsxs("span",{className:"font-bold",style:{color:n.colors.warning},children:[o.totalFees>=0?"+":"",u(o.totalFees)]})]}),e.jsx("div",{className:"border-t my-2",style:{borderColor:n.colors.border}}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ot,{size:16,className:"mr-2",style:{color:o.netPnl>=0?n.colors.success:n.colors.danger}}),e.jsx("span",{className:"font-medium",style:{color:n.colors.text},children:l==="fr"?"P&L Net (aprÃ¨s frais)":"Net P&L (after fees)"})]}),e.jsxs("span",{className:"text-lg font-bold",style:{color:o.netPnl>=0?n.colors.success:n.colors.danger},children:[o.netPnl>=0?"+":"",u(o.netPnl)]})]})]})]})]})},Ji=({presets:t,onSavePreset:s,onLoadPreset:r,onDeletePreset:l,onToggleFavorite:n,currentFormData:o})=>{const{currentLanguage:a}=X(),{currentTheme:c}=ee(),[i,d]=b.useState(!1),[u,m]=b.useState(!1),[p,x]=b.useState(""),[f,g]=b.useState(!1),[h,y]=b.useState(""),[j,v]=b.useState("all"),[N,S]=b.useState(""),w=b.useRef(null),k=b.useRef(null);b.useEffect(()=>{const T=E=>{w.current&&!w.current.contains(E.target)&&(d(!1),m(!1),y(""))};return i&&document.addEventListener("mousedown",T),()=>{document.removeEventListener("mousedown",T)}},[i]),b.useEffect(()=>{u&&k.current&&k.current.focus()},[u]);const M=()=>{if(!p.trim()){y(a==="fr"?"Veuillez entrer un nom":"Please enter a name");return}if(t.some(T=>T.name.toLowerCase()===p.trim().toLowerCase())){y(a==="fr"?"Ce nom existe dÃ©jÃ ":"This name already exists");return}s(p.trim(),f),x(""),g(!1),m(!1),y("")},C=T=>{T.key==="Enter"?(T.preventDefault(),M()):T.key==="Escape"&&(m(!1),y(""))},P=[...t.filter(T=>{const E=j==="all"||j==="favorites"&&T.isFavorite,L=!N||T.name.toLowerCase().includes(N.toLowerCase());return E&&L})].sort((T,E)=>T.isFavorite&&!E.isFavorite?-1:!T.isFavorite&&E.isFavorite?1:new Date(E.createdAt).getTime()-new Date(T.createdAt).getTime()),D=()=>{if(!o)return null;const T=[];return o.symbol&&T.push(o.symbol),o.side&&T.push(o.side==="long"?"ðŸ“ˆ Long":"ðŸ“‰ Short"),o.strategy&&T.push(o.strategy),o.timeframe&&T.push(o.timeframe),T.length>0?T.join(" â€¢ "):null};return e.jsxs("div",{className:"relative",ref:w,children:[e.jsxs("button",{type:"button",onClick:()=>d(!i),className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:c.colors.surface,color:c.colors.text,border:`1px solid ${c.colors.border}`},children:[e.jsx(po,{size:16}),e.jsx("span",{children:"Presets"}),t.length>0&&e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 text-xs font-medium rounded-full",style:{backgroundColor:c.colors.accent+"30",color:c.colors.accent},children:t.length}),e.jsx(Le,{size:16,className:`transition-transform ${i?"rotate-180":""}`})]}),i&&e.jsxs("div",{className:"absolute z-50 mt-2 w-80 rounded-lg shadow-lg overflow-hidden",style:{backgroundColor:c.colors.card,border:`1px solid ${c.colors.border}`,right:0},children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b",style:{borderColor:c.colors.border},children:[e.jsxs("div",{className:"flex space-x-1 p-1 rounded-lg",style:{backgroundColor:c.colors.surface},children:[e.jsxs("button",{onClick:()=>v("all"),className:`flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors ${j==="all"?"shadow-sm":""}`,style:{backgroundColor:j==="all"?c.colors.card:"transparent",color:j==="all"?c.colors.accent:c.colors.textSecondary},children:[e.jsx(po,{size:12,className:"mr-1"}),a==="fr"?"Tous":"All"]}),e.jsxs("button",{onClick:()=>v("favorites"),className:`flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors ${j==="favorites"?"shadow-sm":""}`,style:{backgroundColor:j==="favorites"?c.colors.card:"transparent",color:j==="favorites"?c.colors.accent:c.colors.textSecondary},children:[e.jsx(it,{size:12,className:"mr-1"}),a==="fr"?"Favoris":"Favorites"]})]}),e.jsx("button",{onClick:()=>{m(!0),d(!0)},className:"p-1 rounded-full transition-colors",style:{backgroundColor:c.colors.accent+"20",color:c.colors.accent},title:a==="fr"?"Enregistrer un nouveau preset":"Save a new preset",children:e.jsx(Ye,{size:16})})]}),t.length>5&&e.jsx("div",{className:"p-3 border-b",style:{borderColor:c.colors.border},children:e.jsx("input",{type:"text",value:N,onChange:T=>S(T.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:c.colors.surface,borderColor:c.colors.border,color:c.colors.text},placeholder:a==="fr"?"Rechercher un preset...":"Search presets..."})}),u&&e.jsxs("div",{className:"p-3 border-b",style:{borderColor:c.colors.border},children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:c.colors.textSecondary},children:a==="fr"?"Nom du preset":"Preset name"}),e.jsx("input",{ref:k,type:"text",value:p,onChange:T=>{x(T.target.value),y("")},onKeyDown:C,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:c.colors.surface,borderColor:h?c.colors.danger:c.colors.border,color:c.colors.text},placeholder:a==="fr"?"Ex: Scalping ES":"Ex: ES Scalping"}),h&&e.jsx("p",{className:"text-xs mt-1",style:{color:c.colors.danger},children:h})]}),D()&&e.jsxs("div",{className:"mb-2 p-2 rounded-md text-xs",style:{backgroundColor:c.colors.surface,color:c.colors.textSecondary},children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(ms,{size:12,className:"mr-1"}),e.jsx("span",{className:"font-medium",children:a==="fr"?"Contenu Ã  sauvegarder:":"Content to save:"})]}),D()]}),e.jsx("div",{className:"flex items-center mb-3",children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:()=>g(!f),className:"sr-only"}),e.jsx("div",{className:`w-4 h-4 mr-2 flex items-center justify-center rounded border ${f?"border-transparent":""}`,style:{backgroundColor:f?c.colors.warning:"transparent",borderColor:f?"transparent":c.colors.border},children:f&&e.jsx(_t,{size:12,color:"#ffffff"})}),e.jsx("span",{className:"text-xs",style:{color:c.colors.textSecondary},children:a==="fr"?"Ajouter aux favoris":"Add to favorites"})]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{type:"button",onClick:()=>{m(!1),y("")},className:"flex-1 flex items-center justify-center space-x-1 px-3 py-2 rounded-md transition-colors",style:{backgroundColor:c.colors.surface,color:c.colors.text,border:`1px solid ${c.colors.border}`},children:[e.jsx(be,{size:14}),e.jsx("span",{children:a==="fr"?"Annuler":"Cancel"})]}),e.jsxs("button",{type:"button",onClick:M,className:"flex-1 flex items-center justify-center space-x-1 px-3 py-2 rounded-md transition-colors",style:{backgroundColor:c.colors.accent,color:"#ffffff"},children:[e.jsx(Dt,{size:14}),e.jsx("span",{children:a==="fr"?"Enregistrer":"Save"})]})]})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto",children:P.length===0?e.jsx("div",{className:"p-4 text-center",children:N?e.jsx(e.Fragment,{children:e.jsx("p",{className:"text-sm",style:{color:c.colors.textMuted},children:a==="fr"?`Aucun rÃ©sultat pour "${N}"`:`No results for "${N}"`})}):j==="favorites"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center mb-2",children:e.jsx(it,{size:24,style:{color:c.colors.textMuted}})}),e.jsx("p",{className:"text-sm",style:{color:c.colors.textMuted},children:a==="fr"?"Aucun preset favori":"No favorite presets"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center mb-2",children:e.jsx(po,{size:24,style:{color:c.colors.textMuted}})}),e.jsx("p",{className:"text-sm",style:{color:c.colors.textMuted},children:a==="fr"?"Aucun preset enregistrÃ©":"No saved presets"}),e.jsx("p",{className:"text-xs mt-1",style:{color:c.colors.textMuted},children:a==="fr"?"Enregistrez vos paramÃ¨tres frÃ©quents":"Save your frequent settings"})]})}):e.jsx("div",{className:"py-1",children:P.map(T=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 hover:theme-surface transition-colors",style:{borderBottom:`1px solid ${c.colors.border}20`},children:[e.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[T.isFavorite&&e.jsx(it,{size:16,className:"mr-2 flex-shrink-0",style:{color:c.colors.warning},fill:c.colors.warning}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium truncate",style:{color:c.colors.text},children:T.name}),e.jsxs("div",{className:"flex items-center text-xs",style:{color:c.colors.textMuted},children:[e.jsx($e,{size:10,className:"mr-1"}),new Date(T.createdAt).toLocaleDateString(a==="fr"?"fr-FR":"en-US")]})]})]}),e.jsxs("div",{className:"flex items-center space-x-1 ml-2",children:[e.jsx("button",{onClick:()=>r(T.id),className:"p-2 rounded-md transition-colors",style:{backgroundColor:c.colors.accent+"20",color:c.colors.accent},title:a==="fr"?"Appliquer ce preset":"Apply this preset",children:e.jsx(cr,{size:16})}),n&&e.jsx("button",{onClick:()=>n(T.id),className:"p-2 rounded-md transition-colors",style:{backgroundColor:c.colors.warning+"20",color:c.colors.warning},title:a==="fr"?T.isFavorite?"Retirer des favoris":"Ajouter aux favoris":T.isFavorite?"Remove from favorites":"Add to favorites",children:e.jsx(it,{size:16,fill:T.isFavorite?c.colors.warning:"none"})}),e.jsx("button",{onClick:()=>{window.confirm(a==="fr"?`ÃŠtes-vous sÃ»r de vouloir supprimer le preset "${T.name}" ?`:`Are you sure you want to delete the preset "${T.name}"?`)&&l(T.id)},className:"p-2 rounded-md transition-colors",style:{backgroundColor:c.colors.danger+"20",color:c.colors.danger},title:a==="fr"?"Supprimer ce preset":"Delete this preset",children:e.jsx(es,{size:16})})]})]},T.id))})}),e.jsx("div",{className:"p-3 border-t text-xs",style:{borderColor:c.colors.border,backgroundColor:c.colors.surface+"50",color:c.colors.textMuted},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Zt,{size:12,className:"mr-1"}),e.jsx("span",{children:a==="fr"?"Les presets incluent tous les champs du formulaire":"Presets include all form fields"})]})})]})]})},Pl=()=>{const[t,s]=xs("trading-journal-presets",[]);return{presets:t,addPreset:(i,d,u=!1)=>{const m={id:`preset-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,name:i,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),formData:d,isFavorite:u,sortIndex:Math.max(-1,...t.map(p=>p.sortIndex??-1))+1};return s(p=>[...p,m]),m},deletePreset:i=>{s(d=>d.filter(u=>u.id!==i))},getPreset:i=>t.find(d=>d.id===i),toggleFavorite:i=>{s(d=>d.map(u=>u.id===i?{...u,isFavorite:!u.isFavorite,updatedAt:new Date().toISOString()}:u))},updatePreset:(i,d)=>{s(u=>u.map(m=>m.id===i?{...m,...d,updatedAt:new Date().toISOString()}:m))},reorderPresets:i=>{const d=new Map;i.forEach((u,m)=>d.set(u,m)),s(u=>u.map(m=>{const p=d.get(m.id);return p===void 0?m:{...m,sortIndex:p,updatedAt:new Date().toISOString()}}))}}},Ki=({trade:t,onSubmit:s,onClose:r,settings:l,existingSymbols:n,existingTrades:o})=>{const{currentTheme:a}=ee(),{currentLanguage:c}=X(),[i,d]=b.useState("basic"),[u,m]=b.useState(!1),[p,x]=b.useState({}),f=b.useRef(null),[g,h]=b.useState(null),{presets:y,addPreset:j,deletePreset:v,getPreset:N,toggleFavorite:S}=Pl(),[w,k]=b.useState({date:new Date().toISOString().split("T")[0],time:new Date().toTimeString().slice(0,8),symbol:"",side:"long",entryPrice:void 0,exitPrice:void 0,quantity:0,quantityUnit:"contracts",numberOfLots:void 0,pnlPercentage:void 0,pnl:void 0,ticksGained:void 0,tickValue:void 0,status:"closed",strategy:"",timeframe:"",market:"futures",trend:"bullish",setup:"",notes:"",tags:[],riskReward:void 0,tradeResult:"",fees:{commission:void 0,spread:void 0,swapOvernight:void 0,exchangeFees:void 0,regulatoryFees:void 0,otherFees:void 0,total:0},duration:void 0,screenshots:[]});b.useEffect(()=>{k(t?{...t,fees:t.fees||{commission:t.commission||void 0,spread:void 0,swapOvernight:void 0,exchangeFees:void 0,regulatoryFees:void 0,otherFees:void 0,total:t.commission||0},tags:t.tags||[],tradeResult:t.tradeResult||""}:L=>({...L,fees:{commission:void 0,spread:void 0,swapOvernight:void 0,exchangeFees:void 0,regulatoryFees:void 0,otherFees:void 0,total:0}}))},[t]),b.useEffect(()=>{if(w.symbol&&!w.tickValue){const L=w.symbol.toString().toUpperCase(),U=Mr[L]||Mr.DEFAULT;k(_=>({..._,tickValue:U}))}},[w.symbol]);const M=(L,U=!0)=>{if(L==null||L==="")return;if(typeof L=="number")return L;const _=String(L).replace(",","."),B=parseFloat(_);if(!isNaN(B)&&!(!U&&B===0))return B},C=(L,U)=>{k(_=>({..._,[L]:U})),p[L]&&x(_=>{const B={..._};return delete B[L],B}),g&&h(null)},R=()=>{const L={};w.date||(L.date=c==="fr"?"La date est requise":"Date is required"),w.symbol||(L.symbol=c==="fr"?"Le symbole est requis":"Symbol is required"),w.side||(L.side=c==="fr"?"La direction est requise":"Direction is required");const U=M(w.entryPrice);U!==void 0&&U<0&&(L.entryPrice=c==="fr"?"Le prix d'entrÃ©e doit Ãªtre un nombre positif":"Entry price must be a positive number");const _=M(w.exitPrice);_!==void 0&&_<0&&(L.exitPrice=c==="fr"?"Le prix de sortie doit Ãªtre un nombre positif":"Exit price must be a positive number"),w.strategy||(L.strategy=c==="fr"?"La stratÃ©gie est requise":"Strategy is required"),w.market||(L.market=c==="fr"?"Le marchÃ© est requis":"Market is required"),w.status||(L.status=c==="fr"?"Le statut est requis":"Status is required");const B=M(w.duration);B!==void 0&&B<0&&(L.duration=c==="fr"?"La durÃ©e ne peut pas Ãªtre nÃ©gative":"Duration cannot be negative");const z=M(w.numberOfLots);return z!==void 0&&z<=0&&(L.numberOfLots=c==="fr"?"Le nombre de lots doit Ãªtre supÃ©rieur Ã  0":"Number of lots must be greater than 0"),x(L),Object.keys(L).length===0},P=L=>{if(L.preventDefault(),R()){const U={...w};if(["entryPrice","exitPrice","quantity","pnlPercentage","pnl","ticksGained","tickValue","riskReward","duration","numberOfLots"].forEach(B=>{if(B in U){const z=U[B];U[B]=M(z)}}),U.fees){const B={...U.fees};Object.keys(B).forEach(z=>{if(z!=="total"&&B[z]!==void 0){const A=B[z];B[z]=M(A,!0)}}),B.total=Object.keys(B).filter(z=>z!=="total").reduce((z,A)=>{const F=B[A];return z+(typeof F=="number"?F:0)},0),U.fees=B}s(U)}else p.date||p.symbol||p.side||p.entryPrice||p.market?d("basic"):p.strategy||p.timeframe||p.status?d("market"):p.pnlPercentage||p.ticksGained||p.tickValue||p.duration||p.riskReward?d("performance"):p.notes?d("notes"):d("advanced")},D=L=>{k(U=>({...U,strategy:L})),m(!1)},T=(L,U=!1)=>{j(L,w,U)},E=L=>{const U=N(L);U&&(k(_=>({..._,...U.formData})),h(U.name),setTimeout(()=>{h(null)},3e3))};return b.useEffect(()=>{const L=U=>{if((U.ctrlKey||U.metaKey)&&U.key==="Enter"){U.preventDefault();const _=document.getElementById("trade-form");_&&_.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}};return window.addEventListener("keydown",L),()=>{window.removeEventListener("keydown",L)}},[]),e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:[e.jsxs("div",{className:"theme-surface rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col",style:{backgroundColor:a.colors.card,color:a.colors.text},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",style:{borderColor:a.colors.border},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h2",{className:"text-xl font-semibold",style:{color:a.colors.text},children:t?c==="fr"?"Modifier le Trade":"Edit Trade":c==="fr"?"Ajouter un Trade":"Add Trade"}),e.jsxs("div",{className:"px-3 py-1 rounded-lg text-xs font-medium",style:{backgroundColor:a.colors.surface,color:a.colors.textSecondary},children:["Ctrl+Enter ",c==="fr"?"pour sauvegarder":"to save"]}),g&&e.jsxs("div",{className:"px-3 py-1 rounded-lg text-xs font-medium flex items-center",style:{backgroundColor:a.colors.success+"20",color:a.colors.success},children:[e.jsx(_t,{size:12,className:"mr-1"}),c==="fr"?`Preset "${g}" appliquÃ©`:`Preset "${g}" applied`]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ji,{presets:y,onSavePreset:T,onLoadPreset:E,onDeletePreset:v,onToggleFavorite:S,currentFormData:w}),e.jsx("button",{onClick:r,className:"theme-text-muted hover:theme-text transition-colors",children:e.jsx(be,{size:24})})]})]}),e.jsx(Ti,{activeTab:i,onTabChange:d}),e.jsxs("form",{id:"trade-form",ref:f,onSubmit:P,className:"flex-1 overflow-y-auto p-6",children:[i==="basic"&&e.jsx(Di,{formData:w,onChange:C,errors:p,symbols:n}),i==="market"&&e.jsx(Wi,{formData:w,onChange:C,errors:p,onOpenStrategyModal:()=>m(!0)}),i==="performance"&&e.jsx(Vi,{formData:w,onChange:C,errors:p,settings:l}),i==="notes"&&e.jsx(Hi,{formData:w,onChange:C,errors:p}),i==="advanced"&&e.jsx(Gi,{formData:w,onChange:C,errors:p})]}),e.jsx("div",{className:"flex justify-end items-center p-6 border-t",style:{borderColor:a.colors.border},children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:a.colors.surface,color:a.colors.text,border:`1px solid ${a.colors.border}`},children:c==="fr"?"Annuler":"Cancel"}),e.jsxs("button",{type:"submit",form:"trade-form",className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:a.colors.accent,color:"#ffffff"},children:[e.jsx(Dt,{size:16}),e.jsx("span",{children:c==="fr"?"Sauvegarder":"Save"})]})]})})]}),u&&e.jsx(Mi,{onSelect:D,onClose:()=>m(!1),currentValue:w.strategy||""})]})};function Yi(){try{if(typeof window>"u"||!("localStorage"in window))return!1;const t="__storage_test__";return window.localStorage.setItem(t,"1"),window.localStorage.removeItem(t),!0}catch{return!1}}const Ml=Yi(),Tr=new Map;function Xi(t){return Ml?window.localStorage.getItem(t):Tr.has(t)?Tr.get(t):null}function ho(t,s){if(Ml){s===null?window.localStorage.removeItem(t):window.localStorage.setItem(t,s);return}s===null?Tr.delete(t):Tr.set(t,s)}const yt={getString(t){try{return Xi(t)}catch{return null}},setString(t,s){try{ho(t,s)}catch{}},getBoolean(t){const s=this.getString(t);return s===null?null:s==="true"||s==="1"?!0:s==="false"||s==="0"?!1:null},setBoolean(t,s){this.setString(t,s?"true":"false")},getJSON(t){const s=this.getString(t);if(s===null)return null;try{return JSON.parse(s)}catch{return null}},setJSON(t,s){try{const r=JSON.stringify(s);ho(t,r)}catch{}},remove(t){ho(t,null)}},Qi=(t,s)=>{const[r,l]=b.useState("instrument-context"),[n,o]=b.useState([]),[a,c]=b.useState({}),[i,d]=b.useState(()=>yt.getBoolean("quickMode")??!1),[u,m]=b.useState("percentage"),[p,x]=b.useState(!1),f={hiddenFields:[],createdAt:new Date().toISOString()},g=()=>yt.getJSON("fieldConfig")??f,h=I=>{yt.setJSON("fieldConfig",I)},[y,j]=b.useState(g()),v=I=>!y.hiddenFields.includes(I),N=["date","market","symbol","side"],S=I=>!!(N.includes(I)||P.status==="closed"&&["exitPrice","exitDate","exitTime"].includes(I)||I==="pnl"&&u==="absolute"||I==="pnlPercentage"&&u==="percentage"),w=I=>S(I),k=I=>S(I),M=I=>{const $={hiddenFields:Array.from(new Set(I)),createdAt:new Date().toISOString()};j($),h($)},C=I=>{if(S(I))return;const $={...y};$.hiddenFields.includes(I)?$.hiddenFields=$.hiddenFields.filter(V=>V!==I):$.hiddenFields.push(I),$.createdAt=new Date().toISOString(),j($),h($)},R=()=>{j(f),h(f)},[P,D]=b.useState({date:"",time:"",symbol:"",side:void 0,entryDate:"",entryTime:"",entryPrice:void 0,exitDate:"",exitTime:"",exitPrice:void 0,quantity:void 0,quantityUnit:"contracts",numberOfLots:void 0,pnlPercentage:void 0,pnl:void 0,ticksGained:void 0,tickValue:void 0,tickSize:void 0,stopPrice:void 0,takeProfitPrice:void 0,riskRewardRatio:void 0,marginPerContract:void 0,leverage:void 0,marginRate:void 0,marginUsedOverride:void 0,status:void 0,strategy:"",timeframe:"",market:void 0,trend:void 0,setup:"",notes:"",tags:[],riskReward:void 0,tradeResult:"",fees:{commission:void 0,spread:void 0,swapOvernight:void 0,exchangeFees:void 0,regulatoryFees:void 0,otherFees:void 0,total:0},duration:void 0,screenshots:[]});b.useEffect(()=>{if(!t){const I=yt.getString("defaultPreset");if(I)try{const $=yt.getJSON("presets");if($){const V=$.find(K=>K.id===I);V&&V.formData&&D(K=>({...K,...V.formData}))}}catch($){console.error("Erreur lors du chargement du preset par dÃ©faut:",$)}}},[t]),b.useEffect(()=>{D(t?{...t,fees:t.fees||{commission:t.commission||void 0,spread:void 0,swapOvernight:void 0,exchangeFees:void 0,regulatoryFees:void 0,otherFees:void 0,total:t.commission||0},tags:t.tags||[],tradeResult:t.tradeResult||""}:I=>({...I,fees:{commission:void 0,spread:void 0,swapOvernight:void 0,exchangeFees:void 0,regulatoryFees:void 0,otherFees:void 0,total:0}}))},[t]);const T=(I,$)=>{D(V=>({...V,[I]:$})),a[I]&&c(V=>{const K={...V};return delete K[I],K})},E=(I,$)=>I?$==="percentage"?(s?.initialCapital||1e4)*I/100:I:0,L=()=>{const I=!i;d(I),yt.setBoolean("quickMode",I),I&&D($=>({...$,entryPrice:void 0,exitPrice:void 0,pnlPercentage:void 0,pnl:void 0}))},U=()=>{const I={};return P.symbol||(I.symbol="Le symbole est requis"),P.market||(I.market="Le marchÃ© est requis"),P.side||(I.side="La direction est requise"),P.date||(I.date="La date de rÃ©fÃ©rence est requise"),P.quantity||(I.quantity="La quantitÃ© est requise"),u==="percentage"&&!P.pnlPercentage&&(I.pnlPercentage="Le pourcentage de gain/perte est requis"),u==="absolute"&&!P.pnl&&(I.pnl="Le montant de gain/perte est requis"),I};return b.useEffect(()=>{P.date&&!P.entryDate&&D(I=>({...I,entryDate:P.date}))},[P.date]),b.useEffect(()=>{P.time&&!P.entryTime&&D(I=>({...I,entryTime:P.time}))},[P.time]),b.useEffect(()=>{P.time&&!P.exitTime&&D(I=>({...I,exitTime:P.time}))},[P.time]),b.useEffect(()=>{if(P.pnlPercentage!==void 0&&s?.initialCapital){const I=s.initialCapital*P.pnlPercentage/100;D($=>({...$,pnl:I}))}},[P.pnlPercentage,s?.initialCapital]),b.useEffect(()=>{if(P.ticksGained!==void 0&&P.tickValue!==void 0&&s?.initialCapital){const I=P.ticksGained*P.tickValue,$=I/s.initialCapital*100;P.pnlPercentage===void 0&&D(V=>({...V,pnl:I,pnlPercentage:$}))}},[P.ticksGained,P.tickValue,s?.initialCapital]),b.useEffect(()=>{if(P.symbol&&!P.tickValue){const I=Mr[P.symbol.toUpperCase()]||Mr.DEFAULT;D($=>({...$,tickValue:I}))}},[P.symbol]),{currentStep:r,formData:P,errors:a,handleChange:T,goToNextStep:()=>{const I=["instrument-context","position-entry","position-exit","risk-reward","notes-screenshots"],$=I.indexOf(r);if($<I.length-1){const V=I[$+1];if(V==="position-exit"&&P.status==="open"){const K=$+2;K<I.length&&l(I[K])}else l(V);n.includes(r)||o([...n,r])}},goToPreviousStep:()=>{const I=["instrument-context","position-entry","position-exit","risk-reward","notes-screenshots"],$=I.indexOf(r);if($>0){const V=I[$-1];if(V==="position-exit"&&P.status==="open"){const K=$-2;K>=0&&l(I[K])}else l(V)}},goToStep:I=>{l(I)},isStepCompleted:I=>n.includes(I),calculateProgress:()=>{const I=["instrument-context","position-entry","position-exit","risk-reward","notes-screenshots"],$=P.status==="open"?I.length-1:I.length,V=I.indexOf(r);return Math.round(V/Math.max($-1,1)*100)},setErrors:c,getMissingFieldsForROI:()=>{const I=[];return P.entryPrice||I.push("Prix d'entrÃ©e"),P.quantity||I.push("Taille"),P.market==="futures"&&!P.tickValue&&I.push("Multiplicateur/Valeur par tick"),I},validateStep:I=>{const $={};if(i)return!P.symbol&&v("symbol")&&($.symbol="Le symbole est requis"),!P.market&&v("market")&&($.market="Le marchÃ© est requis"),!P.side&&v("side")&&($.side="La direction est requise"),!P.date&&v("date")&&($.date="La date de rÃ©fÃ©rence est requise"),!P.quantity&&v("quantity")&&($.quantity="La quantitÃ© est requise"),u==="percentage"&&!P.pnlPercentage&&v("pnlPercentage")&&($.pnlPercentage="Le pourcentage de gain/perte est requis"),u==="absolute"&&!P.pnl&&v("pnl")&&($.pnl="Le montant de gain/perte est requis"),$;switch(I){case"instrument-context":!P.symbol&&v("symbol")&&($.symbol="Le symbole est requis"),!P.market&&v("market")&&($.market="Le marchÃ© est requis"),!P.side&&v("side")&&($.side="La direction est requise"),!P.date&&v("date")&&($.date="La date de rÃ©fÃ©rence est requise"),!P.timeframe&&v("timeframe")&&($.timeframe="Le timeframe est requis");break;case"position-entry":(yt.getString("pnlEntryMode")||"detailed")==="detailed"&&!P.entryPrice&&v("entryPrice")&&($.entryPrice="Le prix d'entrÃ©e est requis pour le ROI"),!P.quantity&&v("quantity")&&($.quantity="La taille est requise pour le ROI"),P.market==="futures"&&!P.tickValue&&v("tickValue")&&($.tickValue="Le multiplicateur est requis pour les futures");break;case"position-exit":if(P.status==="closed"){!P.exitDate&&v("exitDate")&&($.exitDate="La date de sortie est requise"),!P.exitTime&&v("exitTime")&&($.exitTime="L'heure de sortie est requise");const K=yt.getString("pnlEntryMode")||"detailed";K==="detailed"?!P.exitPrice&&v("exitPrice")&&($.exitPrice="Le prix de sortie est requis"):!P.pnl&&!P.pnlPercentage&&(v("pnl")||v("pnlPercentage"))&&($.pnl="Le P&L (montant ou pourcentage) est requis"),K==="detailed"||(u==="percentage"&&!P.pnlPercentage&&v("pnlPercentage")&&($.pnlPercentage="Le pourcentage de gain/perte est requis"),u==="absolute"&&!P.pnl&&v("pnl")&&($.pnl="Le montant de gain/perte est requis"))}break}return $},isQuickMode:i,pnlInputMode:u,setPnlInputMode:m,toggleQuickMode:L,calculatePnL:E,validateQuickMode:U,isEditMode:p,setIsEditMode:x,fieldConfig:y,shouldShowField:v,toggleFieldVisibility:C,resetFieldConfig:R,isObligatoryField:w,isObligatoryFieldDynamic:k,applyFieldConfig:M}},Zi=({currentStep:t,completedSteps:s,onStepClick:r,disabledSteps:l=[],formData:n})=>{const{currentTheme:o}=ee(),{currentLanguage:a,t:c}=X(),i=[{id:"instrument-context",label:c.instrument___contexte||"Instrument & Contexte"},{id:"position-entry",label:c.position__entr_e_||"Position (EntrÃ©e)"},{id:"position-exit",label:c.sortie___frais||"Sortie & Frais"},{id:"risk-reward",label:c.setup___risque||"Setup & Risque"},{id:"notes-screenshots",label:c.notes___screenshots||"Notes & Screenshots"}];return e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-3 dark:bg-gray-700",style:{backgroundColor:o.colors.border+"40"},children:e.jsx("div",{className:"h-3 rounded-full transition-all duration-500 ease-in-out",style:{width:`${(i.findIndex(d=>d.id===t)+1)/i.length*100}%`,backgroundColor:o.colors.accent,boxShadow:"0 0 8px rgba(0, 0, 0, 0.1)"}})})}),e.jsx("div",{className:"flex flex-wrap items-center mt-2",style:{gap:"16px"},children:i.map((d,u)=>{const m=s.includes(d.id),p=t===d.id,x=l.includes(d.id);return e.jsxs("div",{className:"relative flex items-center",children:[e.jsxs("button",{onClick:()=>!x&&r(d.id),disabled:x,className:`flex items-center px-4 py-2.5 text-base font-medium transition-all duration-200 ${p?"shadow-md":m?"hover:opacity-100":"hover:opacity-90"} ${x?"cursor-not-allowed opacity-40":"cursor-pointer"}`,style:{backgroundColor:p?`${o.colors.accent}20`:"transparent",color:p?"#ffffff":m?o.colors.accent:o.colors.textSecondary,border:`2px solid ${p?o.colors.accent:m?o.colors.accent+"40":o.colors.border}`,clipPath:"polygon(8px 0, 100% 0, calc(100% - 8px) 100%, 0 100%)",position:"relative"},children:[e.jsx("div",{className:"mr-2.5",children:m?e.jsx(Vr,{size:18}):e.jsx("div",{className:"w-4 h-4 rounded-full border-2",style:{borderColor:o.colors.border,backgroundColor:o.colors.surface}})}),e.jsx("span",{children:d.label})]}),u<i.length-1&&e.jsx("div",{className:"flex items-center justify-center",style:{width:"20px",height:"28px",color:p?o.colors.accent:m?o.colors.accent+"40":o.colors.border,fontSize:"36px",fontWeight:"bold"},children:"â†’"})]},d.id)})})]})},ec=({progress:t,size:s=20,strokeWidth:r=2,onClick:l,className:n=""})=>{const{currentTheme:o}=ee(),a=(s-r)/2,c=a*2*Math.PI,i=c,d=c-t/100*c,m=(p=>p===0?"#6B7280":p<80?"#F59E0B":p<100?"#16A34A":"#10B981")(t);return e.jsxs("div",{className:`relative cursor-pointer ${n}`,onClick:l,style:{width:s,height:s},children:[e.jsxs("svg",{width:s,height:s,className:"transform -rotate-90",children:[e.jsx("circle",{cx:s/2,cy:s/2,r:a,stroke:"#E5E7EB",strokeWidth:r,fill:"transparent"}),e.jsx("circle",{cx:s/2,cy:s/2,r:a,stroke:m,strokeWidth:r,fill:"transparent",strokeDasharray:i,strokeDashoffset:d,strokeLinecap:"round",className:"transition-all duration-300"})]}),t===100&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{color:"#10B981"},children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})})})]})},tc=({formData:t,settings:s,theme:r,language:l,computed:n,pnlValues:o,formatCurrency:a})=>e.jsxs("div",{className:"space-y-0.5",children:[t.exitDate&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:r.colors.textSecondary},children:l==="fr"?"Sortie":"Exit"}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-xs font-medium",style:{color:r.colors.text},children:[new Date(t.exitDate).toLocaleDateString(l==="fr"?"fr-FR":"en-US"),t.exitTime&&e.jsx("span",{className:"text-xs ml-1",style:{color:r.colors.textMuted},children:t.exitTime.substring(0,5)})]})})]}),t.exitPrice&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:r.colors.textSecondary},children:l==="fr"?"Prix":"Price"}),e.jsx("span",{className:"text-xs font-bold",style:{color:r.colors.text},children:t.exitPrice})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-1 gap-y-0.5",children:[(t.pnl!==void 0||o.pnlBrut!==null)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:r.colors.textSecondary},children:l==="fr"?"P&L Brut":"Gross P&L"}),e.jsx("span",{className:"text-xs font-bold text-right",style:{color:(t.pnl||o.pnlBrut||0)>0?r.colors.success:(t.pnl||o.pnlBrut||0)<0?r.colors.danger:r.colors.text},children:a(t.pnl||o.pnlBrut||0)})]}),n.totalFees!==0&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-xs flex items-center",style:{color:r.colors.textSecondary},children:[e.jsx(Ke,{size:10,style:{color:r.colors.textMuted},className:"mr-0.5"}),l==="fr"?"Frais":"Fees"]}),e.jsx("span",{className:"text-xs font-medium text-right",style:{color:r.colors.warning},children:a(n.totalFees)})]}),(t.pnl!==void 0||o.pnlNet!==null)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:r.colors.textSecondary},children:l==="fr"?"P&L Net":"Net P&L"}),(()=>{const c=t.pnl!==void 0?t.pnl+n.totalFees:n.netPnL,i=c>0?r.colors.success:c<0?r.colors.danger:r.colors.text;return e.jsx("span",{className:"text-xs font-bold text-right",style:{color:i},children:a(c)})})()]}),(t.pnl!==void 0||o.pnlNet!==null)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:r.colors.textSecondary},children:l==="fr"?"ROI brut (position)":"Gross ROI (position)"}),e.jsx("span",{className:"text-xs font-bold text-right",style:{color:(t.pnl!==void 0?t.pnl:o.pnlBrut||0)>0?r.colors.success:(t.pnl!==void 0?t.pnl:o.pnlBrut||0)<0?r.colors.danger:r.colors.text},children:`${n.roiGrossPercentage>0?"+":""}${n.roiGrossPercentage.toFixed(2)}%`}),e.jsx("span",{className:"text-xs",style:{color:r.colors.textSecondary},children:l==="fr"?"ROI net":"Net ROI"}),e.jsx("span",{className:"text-xs font-bold text-right",style:{color:(t.pnl!==void 0?t.pnl:o.pnlBrut||0)>0?r.colors.success:(t.pnl!==void 0?t.pnl:o.pnlBrut||0)<0?r.colors.danger:r.colors.text},children:`${n.roiPercentage>0?"+":""}${n.roiPercentage.toFixed(2)}%`}),e.jsx("span",{className:"text-xs",style:{color:r.colors.textSecondary},children:l==="fr"?"% sur capital initial":"% on initial capital"}),e.jsx("span",{className:"text-xs font-bold text-right",style:{color:(t.pnl!==void 0?t.pnl:o.pnlBrut||0)>0?r.colors.success:(t.pnl!==void 0?t.pnl:o.pnlBrut||0)<0?r.colors.danger:r.colors.text},children:`${n.initialCapitalPercentage>0?"+":""}${n.initialCapitalPercentage.toFixed(2)}%`}),e.jsx("span",{className:"text-xs",style:{color:r.colors.textSecondary},children:l==="fr"?"% sur capital actuel":"% on current capital"}),e.jsx("span",{className:"text-xs font-bold text-right",style:{color:(t.pnl!==void 0?t.pnl:o.pnlBrut||0)>0?r.colors.success:(t.pnl!==void 0?t.pnl:o.pnlBrut||0)<0?r.colors.danger:r.colors.text},children:`${n.currentCapitalPercentage>0?"+":""}${n.currentCapitalPercentage.toFixed(2)}%`})]}),t.duration!==void 0&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-xs flex items-center",style:{color:r.colors.textSecondary},children:[e.jsx($e,{size:10,style:{color:r.colors.textMuted},className:"mr-0.5"}),l==="fr"?"DurÃ©e":"Duration"]}),e.jsxs("span",{className:"text-xs font-medium text-right",style:{color:r.colors.text},children:[t.duration,"s"]})]})]})]}),sc=({formData:t,theme:s,language:r})=>e.jsxs("div",{className:"space-y-1",children:[t.tradeResult&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:r==="fr"?"RÃ©sultat":"Result"}),e.jsx("span",{className:"px-1.5 py-0.5 text-xs font-medium rounded",style:{backgroundColor:t.tradeResult==="tp"?`${s.colors.success}20`:t.tradeResult==="sl"?`${s.colors.danger}20`:`${s.colors.warning}20`,color:t.tradeResult==="tp"?s.colors.success:t.tradeResult==="sl"?s.colors.danger:s.colors.warning},children:t.tradeResult})]}),(t.riskRewardRatio||t.riskReward)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:"R:R"}),e.jsxs("span",{className:"text-xs font-bold",style:{color:s.colors.accent},children:[t.riskRewardRatio??t.riskReward,":1"]})]}),t.trend&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:r==="fr"?"Tendance":"Trend"}),e.jsx("span",{className:"text-xs font-medium",style:{color:s.colors.text},children:t.trend})]}),t.setup&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:"Setup"}),e.jsx("span",{className:"text-xs font-medium",style:{color:s.colors.text},children:t.setup})]}),t.strategy&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:r==="fr"?"StratÃ©gie":"Strategy"}),e.jsx("span",{className:"text-xs font-medium",style:{color:s.colors.text},children:t.strategy})]})]}),rc=({formData:t,theme:s,language:r})=>e.jsxs("div",{className:"space-y-0.5",children:[t.side&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:"Direction"}),e.jsx("span",{className:"px-1 py-0 text-xs font-medium rounded",style:{backgroundColor:t.side==="long"?`${s.colors.success}20`:`${s.colors.danger}20`,color:t.side==="long"?s.colors.success:s.colors.danger},children:t.side==="long"?"LONG":"SHORT"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-1 gap-y-0.5",children:[t.market&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:r==="fr"?"MarchÃ©":"Market"}),e.jsx("span",{className:"text-xs font-medium text-right",style:{color:s.colors.text},children:t.market.charAt(0).toUpperCase()+t.market.slice(1)})]}),t.symbol&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:r==="fr"?"Symbole":"Symbol"}),e.jsx("span",{className:"text-xs font-bold text-right",style:{color:s.colors.text},children:t.symbol})]}),t.date&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:"Date"}),e.jsx("span",{className:"text-xs font-medium text-right",style:{color:s.colors.text},children:new Date(t.date).toLocaleDateString(r==="fr"?"fr-FR":"en-US")})]}),t.timeframe&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:s.colors.textSecondary},children:"Timeframe"}),e.jsx("span",{className:"text-xs font-medium text-right",style:{color:s.colors.text},children:t.timeframe})]})]})]});function ut(t,s=0){const r=typeof t=="string"||typeof t=="number"?Number(t):NaN;return Number.isFinite(r)?r:s}function oc(t,s){const r=ut(t.entryPrice),l=ut(t.exitPrice),n=ut(t.quantity),o=ut(t.tickSize),a=ut(t.tickValue),c=t.side==="long"?1:t.side==="short"?-1:0,i=t.market==="futures"&&o>0?a/o:1;let d=0;r>0&&l>0&&n>0&&c!==0&&(t.market==="futures"?d=(l-r)*i*n*c:d=(l-r)*n*c);const u=t.fees||{},m=ut(u.commission),p=ut(u.spread)+ut(u.spread_slippage),x=ut(u.swapOvernight)+ut(u.swap_overnight),f=ut(u.exchangeFees),g=ut(u.regulatoryFees),h=ut(u.otherFees)+ut(u.other),y=m+p+x+f+g+h,j=d+y,v=r>0&&n>0?r*n:0,N=v>0?j/v*100:0,S=v>0?d/v*100:0,w=ut(s.initialCapital,0),k=ut(s.currentCapital,w),M=w>0?j/w*100:0,C=k>0?j/k*100:0;return{grossPnL:d,totalFees:y,netPnL:j,roiPercentage:N,roiGrossPercentage:S,initialCapitalPercentage:M,currentCapitalPercentage:C}}const Xo=({formData:t,settings:s,missingFields:r,onProgressClick:l,currentStep:n="instrument-context",onOpenModal:o,disableRingClick:a=!1,headerClickable:c=!1})=>{const{currentTheme:i}=ee(),{currentLanguage:d}=X(),[u,m]=b.useState(!1),p=R=>R===void 0?"-":new Intl.NumberFormat(d==="fr"?"fr-FR":"en-US",{style:"currency",currency:s.currency}).format(R),f=(()=>{const P=["instrument-context","position-entry","position-exit","risk-reward","notes-screenshots"].indexOf(n);return{instrument:!0,position:P>=1,exit:P>=2,performance:P>=2,setup:P>=3,notes:P>=4}})(),h=(()=>{let R=[];switch(n){case"instrument-context":R=["status","side","market","symbol","timeframe","date"];break;case"instrument-context-v3":R=["status","side","market","symbol","timeframe"];break;case"position-entry":R=["entryDate","entryTime","entryPrice","quantity"];break;case"position-entry-v3":{R=t.pnlEntryMode!=="direct"?["entryPrice","quantity"]:[];break}case"position-exit":R=["exitDate","exitTime","exitPrice","pnl"];break;case"risk-reward":R=["strategy","setup","trend","tradeResult"];break;case"notes-screenshots":R=["notes"];break;default:R=["status","side","market","symbol","timeframe","date"]}const P=R.filter(E=>{const L=t[E];return L!=null&&L!==""}).length,D=R.length,T=P/D*100;return{done:P,total:D,percent:T}})(),y=typeof window<"u"&&localStorage.getItem("summary-debug")==="1",v=(()=>{let R=[],P={};switch(n){case"instrument-context":R=["status","side","market","symbol","timeframe","date"],P={status:d==="fr"?"Statut":"Status",side:"Direction",market:d==="fr"?"MarchÃ©":"Market",symbol:d==="fr"?"Symbole":"Symbol",timeframe:"Timeframe",date:"Date"};break;case"instrument-context-v3":R=["status","side","market","symbol","timeframe"],P={status:d==="fr"?"Statut":"Status",side:"Direction",market:d==="fr"?"MarchÃ©":"Market",symbol:d==="fr"?"Symbole":"Symbol",timeframe:"Timeframe"};break;case"position-entry":R=["entryDate","entryTime","entryPrice","quantity"],P={entryDate:d==="fr"?"Date d'entrÃ©e":"Entry Date",entryTime:d==="fr"?"Heure d'entrÃ©e":"Entry Time",entryPrice:d==="fr"?"Prix d'entrÃ©e":"Entry Price",quantity:d==="fr"?"QuantitÃ©":"Quantity"};break;case"position-entry-v3":{R=t.pnlEntryMode!=="direct"?["entryPrice","quantity"]:[],P={entryPrice:d==="fr"?"Prix d'entrÃ©e":"Entry Price",quantity:d==="fr"?"QuantitÃ©":"Quantity"};break}case"position-exit":R=["exitDate","exitTime","exitPrice","pnl"],P={exitDate:d==="fr"?"Date de sortie":"Exit Date",exitTime:d==="fr"?"Heure de sortie":"Exit Time",exitPrice:d==="fr"?"Prix de sortie":"Exit Price",pnl:"P&L"};break;case"risk-reward":R=["strategy","setup","trend","tradeResult"],P={strategy:d==="fr"?"StratÃ©gie":"Strategy",setup:"Setup",trend:d==="fr"?"Tendance":"Trend",tradeResult:d==="fr"?"RÃ©sultat":"Result"};break;case"notes-screenshots":R=["notes"],P={notes:"Notes"};break;default:R=["status","side","market","symbol","timeframe","date"],P={status:d==="fr"?"Statut":"Status",side:"Direction",market:d==="fr"?"MarchÃ©":"Market",symbol:d==="fr"?"Symbole":"Symbol",timeframe:"Timeframe",date:"Date"}}return R.filter(D=>{const T=t[D];return T==null||T===""}).map(D=>P[D])})(),S=(()=>{const R=parseFloat(t.entryPrice?.toString()||"0"),P=parseFloat(t.exitPrice?.toString()||"0"),D=parseFloat(t.quantity?.toString()||"0"),T=parseFloat(t.tickSize?.toString()||"0"),E=parseFloat(t.tickValue?.toString()||"0"),L=t.side==="long"?1:-1,U=t.market==="futures"&&T>0?E/T:1;let _=null;R>0&&P>0&&D>0&&(t.market==="futures"?_=(P-R)*U*D*L:_=(P-R)*D*L);const B=t.fees||{},z=parseFloat(B.commission?.toString()||"0"),A=parseFloat(B.spread?.toString()||"0"),F=parseFloat(B.swapOvernight?.toString()||"0"),q=parseFloat(B.exchangeFees?.toString()||"0"),W=parseFloat(B.regulatoryFees?.toString()||"0"),I=parseFloat(B.otherFees?.toString()||"0"),$=z+A+F+q+W+I;let V=null;_!==null&&(V=_+$);let K=null;if(V!==null){const ne=s.currentCapital||s.initialCapital||1e4;K=ne>0?V/ne*100:0}return{pnlBrut:_,totalFees:$,pnlNet:V,pnlPercentage:K}})(),w=b.useMemo(()=>oc(t,s),[t,s]),k=()=>{a||(l&&l(),m(!0),setTimeout(()=>m(!1),3e3))},M=({title:R,icon:P})=>e.jsxs("div",{className:"flex items-center justify-between py-1 px-1.5 rounded border border-dashed opacity-50",style:{borderColor:i.colors.border+"50"},children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(P,{size:10,style:{color:i.colors.textMuted}}),e.jsx("span",{className:"text-xs font-medium",style:{color:i.colors.textMuted},children:R})]}),e.jsx("span",{className:"text-xs",children:"ðŸ”’"})]}),C=({title:R,icon:P,children:D})=>e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{className:"flex items-center space-x-1 mb-1 py-0.5",children:[e.jsx(P,{size:10,style:{color:i.colors.accent}}),e.jsx("span",{className:"text-xs font-bold",style:{color:i.colors.text},children:R}),e.jsx("span",{className:"text-xs",children:"âœ…"})]}),D]});return e.jsxs("div",{className:"h-full",children:[e.jsxs("div",{className:`flex items-center justify-between py-2 px-3 border-b mb-2 ${c?"cursor-pointer":""}`,style:{borderColor:i.colors.border,background:`linear-gradient(180deg, ${i.colors.surface}50 0%, transparent 100%)`},onClick:c&&o?()=>o():void 0,children:[e.jsx("h3",{className:"font-bold text-sm",style:{color:i.colors.text},children:d==="fr"?"RÃ©sumÃ© du Trade":"Trade Summary"}),e.jsxs("div",{className:"flex items-center space-x-2 relative",onClick:R=>{c&&R.stopPropagation()},children:[e.jsxs("span",{className:"text-sm",style:{color:i.colors.textMuted},children:[h.done,"/",h.total]}),e.jsxs("div",{className:"relative",children:[e.jsx(ec,{progress:h.percent,size:24,strokeWidth:2.5,onClick:k}),u&&v.length>0&&e.jsxs("div",{className:"absolute z-50 px-3 py-2 rounded shadow-lg border text-sm max-w-xs",style:{backgroundColor:i.colors.card,borderColor:i.colors.border,color:i.colors.text,top:"100%",right:"0",transform:"translateX(0)",marginTop:"8px",maxWidth:"220px",wordWrap:"break-word"},children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(ai,{size:14,style:{color:i.colors.warning,marginTop:"2px"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium text-sm",children:d==="fr"?"Champs manquants":"Missing fields"}),e.jsx("div",{className:"text-sm mt-1",style:{color:i.colors.textMuted},children:v.join(", ")})]})]}),e.jsx("div",{className:"absolute w-2 h-2 transform rotate-45 -top-1 right-4",style:{backgroundColor:i.colors.card}})]})]}),h.percent<100&&e.jsxs("span",{className:"text-xs",style:{color:i.colors.text},children:[Math.round(h.percent),"%"]})]})]}),e.jsxs("div",{className:"px-1.5 space-y-1",children:[e.jsx(C,{title:d==="fr"?"Instrument & Contexte":"Instrument & Context",icon:He,children:e.jsx(rc,{formData:t,theme:i,language:d})}),f.position?e.jsx(C,{title:d==="fr"?"Position (EntrÃ©e)":"Position (Entry)",icon:Ee,children:e.jsxs("div",{className:"space-y-0.5",children:[t.entryDate&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:i.colors.textSecondary},children:d==="fr"?"EntrÃ©e":"Entry"}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-xs font-medium",style:{color:i.colors.text},children:[new Date(t.entryDate).toLocaleDateString(d==="fr"?"fr-FR":"en-US"),t.entryTime&&e.jsx("span",{className:"text-xs ml-1",style:{color:i.colors.textMuted},children:t.entryTime.substring(0,5)})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-1 gap-y-0.5",children:[t.entryPrice&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:i.colors.textSecondary},children:d==="fr"?"Prix":"Price"}),e.jsx("span",{className:"text-xs font-bold text-right",style:{color:i.colors.text},children:t.entryPrice})]}),t.quantity&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:i.colors.textSecondary},children:d==="fr"?"Taille":"Size"}),e.jsxs("span",{className:"text-xs font-medium text-right",style:{color:i.colors.text},children:[t.quantity," ",t.quantityUnit||"contrats"]})]}),t.stopPrice&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:i.colors.textSecondary},children:"Stop"}),e.jsx("span",{className:"text-xs font-medium text-right",style:{color:i.colors.danger},children:t.stopPrice})]}),t.takeProfitPrice&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",style:{color:i.colors.textSecondary},children:"TP"}),e.jsx("span",{className:"text-xs font-medium text-right",style:{color:i.colors.success},children:t.takeProfitPrice})]})]})]})}):e.jsx(M,{title:d==="fr"?"Position (EntrÃ©e)":"Position (Entry)",icon:Ee}),f.exit?e.jsxs(C,{title:d==="fr"?"Sortie & Frais":"Exit & Fees",icon:Me,children:[e.jsx(tc,{formData:t,settings:s,theme:i,language:d,computed:w,pnlValues:S,formatCurrency:p}),y&&e.jsx("div",{className:"mt-1 p-1.5 rounded border",style:{backgroundColor:i.colors.surface,borderColor:i.colors.border},children:e.jsxs("div",{className:"text-xs",style:{color:i.colors.textMuted},children:["netPnL: ",w.netPnL.toFixed(2)," | ROI:"," ",w.roiPercentage.toFixed(2),"% | %init:"," ",w.initialCapitalPercentage.toFixed(2),"% | %current:"," ",w.currentCapitalPercentage.toFixed(2),"%"]})})]}):e.jsx(M,{title:d==="fr"?"Sortie & Frais":"Exit & Fees",icon:Me}),f.setup?e.jsx(C,{title:d==="fr"?"Setup & Risque":"Setup & Risk",icon:He,children:e.jsx(sc,{formData:t,theme:i,language:d})}):e.jsx(M,{title:d==="fr"?"Setup & Risque":"Setup & Risk",icon:He}),f.notes?e.jsx(C,{title:"Notes",icon:Ss,children:e.jsx("div",{className:"space-y-1",children:t.notes&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium",style:{color:i.colors.textSecondary},children:"Notes"}),e.jsx("div",{className:"text-xs p-1.5 rounded max-h-16 overflow-y-auto",style:{backgroundColor:i.colors.surface,color:i.colors.text},children:t.notes})]})})}):e.jsx(M,{title:"Notes",icon:Ss})]})]})},nc=({searchQuery:t,onSearchChange:s,showCustom:r,onToggleCustom:l,customValue:n,onCustomValueChange:o,customType:a,onCustomTypeChange:c,onCustomSubmit:i,theme:d,currentLanguage:u})=>{const m=b.useRef(null),p={seconds:u==="fr"?"Secondes":"Seconds",minutes:"Minutes",hours:u==="fr"?"Heures":"Hours",days:u==="fr"?"Jours":"Days",weeks:u==="fr"?"Semaines":"Weeks",months:u==="fr"?"Mois":"Months",ticks:"Ticks"},x={seconds:60,minutes:60,hours:24,days:7,weeks:3,months:12,ticks:1e4};return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(jt,{size:16,className:"absolute left-2 top-1/2 transform -translate-y-1/2",style:{color:d.colors.textMuted}}),e.jsx("input",{ref:m,type:"text",value:t,onChange:f=>s(f.target.value),placeholder:u==="fr"?"Rechercher / saisir (ex: 5m, 1h, 2d, 1mo, 1000tick)":"Search / type (ex: 5m, 1h, 2d, 1mo, 1000tick)",className:"w-full pl-8 pr-3 py-1.5 border rounded-lg focus:outline-none focus:ring-2 transition-colors text-sm",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.text}})]}),e.jsxs("button",{onClick:l,className:`px-3 py-1.5 rounded-lg border transition-colors text-sm ${r?"bg-blue-500 text-white":""}`,style:{backgroundColor:r?d.colors.accent:d.colors.card,borderColor:d.colors.border,color:r?"#ffffff":d.colors.text},children:[e.jsx(Ye,{size:14,className:"inline mr-1"}),"Custom"]})]}),r&&e.jsx("div",{className:"mt-1 p-2 rounded-lg",style:{backgroundColor:d.colors.surface},children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("select",{value:a,onChange:f=>c(f.target.value),className:"px-2 py-1 border rounded-lg focus:outline-none focus:ring-2 text-sm",style:{backgroundColor:d.colors.card,borderColor:d.colors.border,color:d.colors.text},children:Object.entries(p).map(([f,g])=>e.jsx("option",{value:f,children:g},f))}),e.jsx("input",{type:"number",value:n,onChange:f=>o(f.target.value),placeholder:"5",min:"1",max:x[a],className:"px-2 py-1 border rounded-lg focus:outline-none focus:ring-2 w-16 text-sm",style:{backgroundColor:d.colors.card,borderColor:d.colors.border,color:d.colors.text}}),e.jsx("button",{onClick:i,className:"px-3 py-1 rounded-lg text-white transition-colors text-sm",style:{backgroundColor:d.colors.accent},children:u==="fr"?"Ajouter":"Add"})]}),e.jsx("div",{className:"text-xs",style:{color:d.colors.textMuted},children:u==="fr"?`Exemple: 5 ${p[a]} (max: ${x[a]})`:`Example: 5 ${p[a]} (max: ${x[a]})`})]})})]})},lc=[{id:"intraday",label:"Intraday",icon:"âš¡"},{id:"daily",label:"Jours+",icon:"ðŸ“…"},{id:"ticks",label:"Ticks (AvancÃ©)",icon:"ðŸŽ¯"}],ac=({activeCategory:t,onCategoryChange:s,theme:r,currentLanguage:l})=>e.jsx("div",{className:"flex space-x-1",children:lc.map(n=>e.jsxs("button",{onClick:()=>s(n.id),className:`flex-1 flex items-center justify-center px-3 py-2 font-medium transition-all duration-200 ${t===n.id?"shadow-md":"hover:shadow-sm"}`,style:{backgroundColor:(t===n.id,"transparent"),color:t===n.id?r.colors.accent:r.colors.text,border:`2px solid ${t===n.id?r.colors.accent:r.colors.border}`,clipPath:"polygon(8px 0, 100% 0, calc(100% - 8px) 100%, 0 100%)"},children:[e.jsx("span",{className:"mr-1.5 text-xs",children:n.icon}),e.jsx("span",{className:"text-xs font-semibold",children:n.label})]},n.id))}),Do=({option:t,isCustom:s,isSelected:r,isFavorite:l,onSelect:n,onToggleFavorite:o,onDeleteCustom:a,theme:c})=>e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:()=>n(t.value),className:`px-3 py-1.5 text-sm rounded-md border transition-all duration-200 hover:shadow-sm ${r?"ring-2":""} ${s?"border-dashed":""}`,style:{backgroundColor:r?c.colors.accent:c.colors.card,borderColor:r||s?c.colors.accent:c.colors.border,color:r?"#ffffff":c.colors.text},title:s?"Timeframe personnalisÃ©":"",children:[t.label,s&&e.jsx("span",{className:"ml-1 text-xs",children:"â˜…"})]}),e.jsx("button",{onClick:i=>o(t.value,i),className:"absolute -top-1 -right-1 p-1 rounded-full bg-yellow-500 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:bg-yellow-600",title:l?"Retirer des favoris":"Ajouter aux favoris",children:e.jsx(it,{size:12,fill:l?"#ffffff":"none",style:{color:"#ffffff"}})}),s&&a&&e.jsx("button",{onClick:i=>a(t.value,i),className:"absolute -top-1 -left-1 p-1 rounded-full bg-red-500 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:bg-red-600",title:"Supprimer ce timeframe personnalisÃ©",children:e.jsx(es,{size:12})})]}),Jt=({title:t,options:s,customTimeframes:r,favorites:l,currentValue:n,onSelect:o,onToggleFavorite:a,onDeleteCustom:c,theme:i,currentLanguage:d})=>e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs font-semibold mb-2",style:{color:i.colors.textMuted},children:t}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.map(u=>{const m=r.some(f=>f.value===u.value),p=n===u.value,x=l.includes(u.value);return e.jsx(Do,{option:u,isCustom:m,isSelected:p,isFavorite:x,onSelect:o,onToggleFavorite:a,onDeleteCustom:c,theme:i},u.value)})})]}),ic=({favorites:t,recent:s,allOptions:r,customTimeframes:l,currentValue:n,onSelect:o,onToggleFavorite:a,onDeleteCustom:c,theme:i,currentLanguage:d})=>{const u=p=>r.find(x=>x.value===p),m=["1m","5m","15m","1h","4h","1d"];return e.jsxs("div",{className:"flex items-center gap-4",children:[s.length>0?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"ðŸ•’"}),e.jsxs("span",{className:"text-xs font-medium",style:{color:i.colors.textMuted},children:[d==="fr"?"RÃ©cents":"Recent",":"]}),e.jsx("div",{className:"flex gap-1",children:s.slice(0,4).reverse().map(p=>{const x=u(p);if(!x)return null;const f=l.some(y=>y.value===p),g=n===p,h=t.includes(p);return e.jsx(Do,{option:x,isCustom:f,isSelected:g,isFavorite:h,onSelect:o,onToggleFavorite:a,onDeleteCustom:c,theme:i},p)})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"âš¡"}),e.jsxs("span",{className:"text-xs font-medium",style:{color:i.colors.textMuted},children:[d==="fr"?"Populaires":"Popular",":"]}),e.jsx("div",{className:"flex gap-1",children:m.slice(0,4).map(p=>{const x=u(p);if(!x)return null;const f=n===p;return e.jsx("button",{onClick:()=>o(p),className:`px-2 py-1 text-xs rounded transition-all duration-200 ${f?"shadow-md transform scale-105":"hover:shadow-sm"}`,style:{backgroundColor:f?i.colors.accent:i.colors.surface,color:f?"#ffffff":i.colors.text,border:`1px solid ${f?"transparent":i.colors.border}`},children:x.label},p)})})]}),t.length>0?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"â­"}),e.jsxs("span",{className:"text-xs font-medium",style:{color:i.colors.textMuted},children:[d==="fr"?"Favoris":"Favorites",":"]}),e.jsx("div",{className:"flex gap-1",children:t.slice(0,4).map(p=>{const x=u(p);if(!x)return null;const f=l.some(y=>y.value===p),g=n===p;return e.jsx(Do,{option:x,isCustom:f,isSelected:g,isFavorite:!0,onSelect:o,onToggleFavorite:a,onDeleteCustom:c,theme:i},p)})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"â­"}),e.jsxs("span",{className:"text-xs font-medium",style:{color:i.colors.textMuted},children:[d==="fr"?"Populaires":"Popular",":"]}),e.jsx("div",{className:"flex gap-1",children:m.slice(4,6).map(p=>{const x=u(p);if(!x)return null;const f=n===p;return e.jsx("button",{onClick:()=>o(p),className:`px-2 py-1 text-xs rounded transition-all duration-200 ${f?"shadow-md transform scale-105":"hover:shadow-sm"}`,style:{backgroundColor:f?i.colors.accent:i.colors.surface,color:f?"#ffffff":i.colors.text,border:`1px solid ${f?"transparent":i.colors.border}`},children:x.label},p)})})]})]})},Sn=[{value:"1s",label:"1s",category:"seconds"},{value:"5s",label:"5s",category:"seconds"},{value:"10s",label:"10s",category:"seconds"},{value:"15s",label:"15s",category:"seconds"},{value:"30s",label:"30s",category:"seconds"},{value:"45s",label:"45s",category:"seconds"},{value:"1m",label:"1m",category:"minutes"},{value:"2m",label:"2m",category:"minutes"},{value:"3m",label:"3m",category:"minutes"},{value:"5m",label:"5m",category:"minutes"},{value:"10m",label:"10m",category:"minutes"},{value:"15m",label:"15m",category:"minutes"},{value:"30m",label:"30m",category:"minutes"},{value:"45m",label:"45m",category:"minutes"},{value:"50m",label:"50m",category:"minutes"},{value:"1h",label:"1h",category:"hours"},{value:"2h",label:"2h",category:"hours"},{value:"4h",label:"4h",category:"hours"},{value:"6h",label:"6h",category:"hours"},{value:"8h",label:"8h",category:"hours"},{value:"12h",label:"12h",category:"hours"},{value:"1d",label:"1d",category:"days"},{value:"2d",label:"2d",category:"days"},{value:"3d",label:"3d",category:"days"},{value:"4d",label:"4d",category:"days"},{value:"5d",label:"5d",category:"days"},{value:"1w",label:"1w",category:"weeks"},{value:"2w",label:"2w",category:"weeks"},{value:"1mo",label:"1M",category:"months"},{value:"3mo",label:"3M",category:"months"},{value:"6mo",label:"6M",category:"months"},{value:"1y",label:"1A",category:"months"},{value:"1t",label:"1t",category:"ticks-micro"},{value:"5t",label:"5t",category:"ticks-micro"},{value:"10t",label:"10t",category:"ticks-micro"},{value:"25t",label:"25t",category:"ticks-micro"},{value:"50t",label:"50t",category:"ticks-micro"},{value:"100t",label:"100t",category:"ticks-day"},{value:"250t",label:"250t",category:"ticks-day"},{value:"500t",label:"500t",category:"ticks-day"},{value:"750t",label:"750t",category:"ticks-day"},{value:"1kt",label:"1k",category:"ticks-k"},{value:"2kt",label:"2k",category:"ticks-k"},{value:"3kt",label:"3k",category:"ticks-k"},{value:"5kt",label:"5k",category:"ticks-k"},{value:"10kt",label:"10k",category:"ticks-k"},{value:"89t",label:"89t",category:"ticks-fibo"},{value:"144t",label:"144t",category:"ticks-fibo"},{value:"233t",label:"233t",category:"ticks-fibo"},{value:"377t",label:"377t",category:"ticks-fibo"},{value:"610t",label:"610t",category:"ticks-fibo"}],Jr=({isOpen:t,onClose:s,onSelect:r,currentValue:l,position:n})=>{const{currentTheme:o}=ee(),{currentLanguage:a}=X(),[c,i]=b.useState(""),[d,u]=b.useState("intraday"),[m,p]=b.useState(()=>{try{return JSON.parse(localStorage.getItem("timeframe-favorites")||"[]")}catch{return[]}}),[x,f]=b.useState(()=>{try{return JSON.parse(localStorage.getItem("timeframe-recent")||"[]")}catch{return[]}}),[g,h]=b.useState(()=>{try{return JSON.parse(localStorage.getItem("timeframe-custom")||"[]")}catch{return[]}}),[y,j]=b.useState(""),[v,N]=b.useState("minutes"),[S,w]=b.useState(!1),[k,M]=b.useState(!1),[C,R]=b.useState(!1),P=b.useRef(null);b.useEffect(()=>{try{const A=JSON.parse(localStorage.getItem("timeframe-favorites")||"[]"),F=JSON.parse(localStorage.getItem("timeframe-recent")||"[]"),q=JSON.parse(localStorage.getItem("timeframe-custom")||"[]");p(A),f(F),h(q)}catch(A){console.warn("Erreur lors du chargement des timeframes depuis localStorage:",A),localStorage.removeItem("timeframe-favorites"),localStorage.removeItem("timeframe-recent"),localStorage.removeItem("timeframe-custom"),p([]),f([]),h([])}},[]),b.useEffect(()=>{const A=F=>{F.key==="Escape"&&s()};if(t)return document.addEventListener("keydown",A),()=>document.removeEventListener("keydown",A)},[t,s]);const D=b.useMemo(()=>{const A=new Set(Sn.map(I=>I.value)),F=g.filter(I=>!A.has(I.value)),q=[...Sn,...F],W=I=>{const $=I.match(/^(\d+)([smhdwmo]|t)$/);if(!$)return 0;const V=parseInt($[1]),K=$[2];return V*({s:1,m:60,h:3600,d:86400,w:604800,mo:2592e3,t:.001}[K]||0)};return q.sort((I,$)=>{const V=["seconds","minutes","hours","days","weeks","months","ticks","ticks-micro","ticks-day","ticks-k","ticks-fibo"],K=ye=>ye.startsWith("ticks-")?"ticks":ye,ne=K(I.category),ue=K($.category),le=V.indexOf(ne),je=V.indexOf(ue);if(le!==je)return le-je;if(ne==="ticks"){const ye=["ticks-micro","ticks-day","ticks-k","ticks-fibo","ticks"],ve=ye.indexOf(I.category),se=ye.indexOf($.category);if(ve!==se)return ve-se}return W(I.value)-W($.value)})},[g]),T=D.filter(A=>{const F=c===""||A.label.toLowerCase().includes(c.toLowerCase())||A.value.toLowerCase().includes(c.toLowerCase());return c!==""?F:d==="intraday"?F&&(A.category==="seconds"||A.category==="minutes"||A.category==="hours"):d==="daily"?F&&(A.category==="days"||A.category==="weeks"||A.category==="months"):d==="ticks"?F&&(A.category==="ticks"||A.category==="ticks-micro"||A.category==="ticks-day"||A.category==="ticks-k"||A.category==="ticks-fibo"):!1}),E=A=>{r(A);const F=[A,...x.filter(q=>q!==A)].slice(0,4);f(F),localStorage.setItem("timeframe-recent",JSON.stringify(F)),s()},L=(A,F)=>{F.stopPropagation();const q=m.includes(A)?m.filter(W=>W!==A):[...m,A];p(q),localStorage.setItem("timeframe-favorites",JSON.stringify(q))},U=(A,F)=>{F.stopPropagation();const q=g.filter(W=>W.value!==A);h(q),localStorage.setItem("timeframe-custom",JSON.stringify(q))},_=()=>{if(y.trim()){const A=parseInt(y);if(!isNaN(A)&&A>0){const q={seconds:60,minutes:60,hours:24,days:7,weeks:3,months:12,ticks:1e4}[v]||999;if(A>q){const K={seconds:"secondes",minutes:"minutes",hours:"heures",days:"jours",weeks:"semaines",months:"mois",ticks:"ticks"}[v]||v;alert(`Valeur maximale autorisÃ©e pour ${K}: ${q}`);return}const I=`${A}${{seconds:"s",minutes:"m",hours:"h",days:"d",weeks:"w",months:"mo",ticks:"t"}[v]}`;if(!g.find(V=>V.value===I)){let V=v;v==="ticks"&&(A<=100?V="ticks-micro":A<=1e3?V="ticks-day":A<=1e4?V="ticks-k":V="ticks-fibo");const K={value:I,label:I,category:V},ne=[...g,K];h(ne),localStorage.setItem("timeframe-custom",JSON.stringify(ne))}E(I)}}w(!1),j("")};if(!t)return null;const B=2147483647,z=e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center p-4",style:{zIndex:B},children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:s,style:{zIndex:B-1}}),e.jsxs("div",{ref:P,className:"relative w-full max-w-5xl h-[85vh] max-h-[800px] rounded-xl shadow-2xl flex flex-col",style:{backgroundColor:o.colors.surface,border:`1px solid ${o.colors.border}`,zIndex:B},children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{size:16,style:{color:o.colors.accent}}),e.jsx("h3",{className:"text-lg font-bold",style:{color:o.colors.text},children:"Timeframe/Tick"})]}),e.jsx("button",{onClick:s,className:"p-1.5 rounded-lg hover:bg-opacity-20 hover:bg-black transition-colors",style:{color:o.colors.textMuted},children:e.jsx(be,{size:16})})]}),e.jsx("div",{className:"px-6 py-2",children:e.jsx(nc,{searchQuery:c,onSearchChange:i,showCustom:S,onToggleCustom:()=>w(!S),customValue:y,onCustomValueChange:j,customType:v,onCustomTypeChange:A=>N(A),onCustomSubmit:_,theme:o,currentLanguage:a})}),e.jsx("div",{className:"px-6 py-2 border-b",style:{borderColor:o.colors.border},children:e.jsx(ac,{activeCategory:d,onCategoryChange:u,theme:o,currentLanguage:a})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"min-h-full p-2",children:c.trim()?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm font-medium mb-3",style:{color:o.colors.textMuted},children:a==="fr"?"RÃ©sultats de recherche":"Search Results"}),e.jsx("div",{className:"flex flex-wrap gap-2 content-start",children:T.map(A=>{const F=g.some(W=>W.value===A.value),q=l===A.value;return m.includes(A.value),e.jsx("div",{className:"relative group",children:e.jsxs("button",{onClick:()=>E(A.value),className:`px-3 py-1.5 text-sm rounded-md border transition-all duration-200 hover:shadow-sm ${q?"ring-2":""} ${F?"border-dashed":""}`,style:{backgroundColor:q?o.colors.accent:o.colors.card,borderColor:q||F?o.colors.accent:o.colors.border,color:q?"#ffffff":o.colors.text},title:F?"Timeframe personnalisÃ©":"",children:[A.label,F&&e.jsx("span",{className:"ml-1 text-xs",children:"â˜…"})]})},A.value)})})]}):e.jsxs("div",{className:"flex flex-col space-y-4",children:[d==="intraday"&&e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(Jt,{title:a==="fr"?"Secondes":"Seconds",options:T.filter(A=>A.category==="seconds"),customTimeframes:g,favorites:m,currentValue:l,onSelect:E,onToggleFavorite:L,onDeleteCustom:U,theme:o,currentLanguage:a}),e.jsx(Jt,{title:"Minutes",options:T.filter(A=>A.category==="minutes"),customTimeframes:g,favorites:m,currentValue:l,onSelect:E,onToggleFavorite:L,onDeleteCustom:U,theme:o,currentLanguage:a}),e.jsx(Jt,{title:a==="fr"?"Heures":"Hours",options:T.filter(A=>A.category==="hours"),customTimeframes:g,favorites:m,currentValue:l,onSelect:E,onToggleFavorite:L,onDeleteCustom:U,theme:o,currentLanguage:a})]}),d==="daily"&&e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(Jt,{title:a==="fr"?"Jours":"Days",options:T.filter(A=>A.category==="days"),customTimeframes:g,favorites:m,currentValue:l,onSelect:E,onToggleFavorite:L,onDeleteCustom:U,theme:o,currentLanguage:a}),e.jsx(Jt,{title:a==="fr"?"Semaines":"Weeks",options:T.filter(A=>A.category==="weeks"),customTimeframes:g,favorites:m,currentValue:l,onSelect:E,onToggleFavorite:L,onDeleteCustom:U,theme:o,currentLanguage:a}),e.jsx(Jt,{title:a==="fr"?"Mois":"Months",options:T.filter(A=>A.category==="months"),customTimeframes:g,favorites:m,currentValue:l,onSelect:E,onToggleFavorite:L,onDeleteCustom:U,theme:o,currentLanguage:a})]}),d==="ticks"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(Jt,{title:"Micro",options:T.filter(A=>A.category==="ticks-micro"),customTimeframes:g,favorites:m,currentValue:l,onSelect:E,onToggleFavorite:L,onDeleteCustom:U,theme:o,currentLanguage:a}),e.jsx(Jt,{title:"Day",options:T.filter(A=>A.category==="ticks-day"),customTimeframes:g,favorites:m,currentValue:l,onSelect:E,onToggleFavorite:L,onDeleteCustom:U,theme:o,currentLanguage:a}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>M(!k),className:"flex items-center gap-2 mb-2 text-xs font-semibold hover:opacity-80 transition-opacity",style:{color:o.colors.textMuted},children:[e.jsx("span",{className:`transform transition-transform ${k?"rotate-90":""}`,children:"â–¶"}),"xK"]}),k&&e.jsx("div",{className:"ml-4",children:e.jsx(Jt,{title:"",options:T.filter(A=>A.category==="ticks-k"),customTimeframes:g,favorites:m,currentValue:l,onSelect:E,onToggleFavorite:L,onDeleteCustom:U,theme:o,currentLanguage:a})})]}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>R(!C),className:"flex items-center gap-2 mb-2 text-xs font-semibold hover:opacity-80 transition-opacity",style:{color:o.colors.textMuted},children:[e.jsx("span",{className:`transform transition-transform ${C?"rotate-90":""}`,children:"â–¶"}),"Fibo"]}),C&&e.jsx("div",{className:"ml-4",children:e.jsx(Jt,{title:"",options:T.filter(A=>A.category==="ticks-fibo"),customTimeframes:g,favorites:m,currentValue:l,onSelect:E,onToggleFavorite:L,onDeleteCustom:U,theme:o,currentLanguage:a})})]})]})]})})}),e.jsx("div",{className:"px-6 py-2 border-t",style:{borderColor:o.colors.border},children:e.jsx(ic,{favorites:m,recent:x,allOptions:D,customTimeframes:g,currentValue:l,onSelect:E,onToggleFavorite:L,onDeleteCustom:U,theme:o,currentLanguage:a})})]})]});return typeof document<"u"?St.createPortal(z,document.body):z},cc=({currentDate:t,months:s,currentTheme:r,isCompact:l,isCompactView:n,headerMargin:o,buttonPadding:a,textSize:c,onPrev:i,onNext:d,onToggleView:u})=>e.jsxs("div",{className:`flex items-center justify-between ${o}`,children:[!n&&e.jsx("button",{onClick:i,className:`${l?"p-1":"p-1.5"} rounded-md transition-colors`,style:{color:r.colors.textMuted,backgroundColor:"transparent"},onMouseEnter:m=>{m.currentTarget.style.backgroundColor=r.colors.surface},onMouseLeave:m=>{m.currentTarget.style.backgroundColor="transparent"},children:e.jsx(cs,{size:l?14:16})}),e.jsxs("button",{onClick:u,className:`${a} rounded-md transition-colors flex items-center space-x-1 flex-1 justify-center`,style:{backgroundColor:r.colors.surface,color:r.colors.text},onMouseEnter:m=>{m.currentTarget.style.backgroundColor=r.colors.border+"40"},onMouseLeave:m=>{m.currentTarget.style.backgroundColor=r.colors.surface},children:[e.jsxs("span",{className:`font-medium ${c}`,children:[s[t.getMonth()]," ",t.getFullYear()]}),e.jsx(Le,{size:l?12:14,className:`transition-transform ${n?"rotate-180":""}`})]}),!n&&e.jsx("button",{onClick:d,className:`${l?"p-1":"p-1.5"} rounded-md transition-colors`,style:{color:r.colors.textMuted,backgroundColor:"transparent"},onMouseEnter:m=>{m.currentTarget.style.backgroundColor=r.colors.surface},onMouseLeave:m=>{m.currentTarget.style.backgroundColor="transparent"},children:e.jsx(Os,{size:l?14:16})})]}),dc=({currentDate:t,months:s,currentTheme:r,currentLanguage:l,onSelectMonth:n,onSelectYear:o})=>{const a=b.useRef(null),c=b.useRef(null);return b.useEffect(()=>{if(a.current){const i=a.current.children[t.getMonth()];i&&i.scrollIntoView({block:"center",behavior:"smooth"})}if(c.current){const i=t.getFullYear(),u=Array.from({length:10},(p,x)=>i-5+x).indexOf(i),m=c.current.children[u];m&&m.scrollIntoView({block:"center",behavior:"smooth"})}},[t]),e.jsx("div",{className:"mb-3 p-2 rounded-lg",style:{backgroundColor:r.colors.surface},children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium mb-2 text-center",style:{color:r.colors.textSecondary},children:l==="fr"?"Mois":"Month"}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",ref:a,children:s.map((i,d)=>e.jsx("button",{onClick:()=>n(d),className:`w-full px-2 py-1 text-xs rounded transition-colors ${d===t.getMonth()?"bg-blue-500 text-white":"hover:bg-gray-100"}`,style:{backgroundColor:d===t.getMonth()?r.colors.accent:"transparent",color:d===t.getMonth()?"#ffffff":r.colors.text},children:i},d))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium mb-2 text-center",style:{color:r.colors.textSecondary},children:l==="fr"?"AnnÃ©e":"Year"}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",ref:c,children:Array.from({length:10},(i,d)=>t.getFullYear()-5+d).map(i=>e.jsx("button",{onClick:()=>o(i),className:"w-full px-2 py-1 text-xs rounded transition-colors",style:{backgroundColor:i===t.getFullYear()?r.colors.accent:"transparent",color:i===t.getFullYear()?"#ffffff":r.colors.text},onMouseEnter:d=>{i!==t.getFullYear()&&(d.currentTarget.style.backgroundColor=r.colors.surface)},onMouseLeave:d=>{i!==t.getFullYear()&&(d.currentTarget.style.backgroundColor="transparent")},children:i},i))})]})]})})},uc=({currentDate:t,months:s,currentTheme:r,currentLanguage:l,onSelectMonth:n,onSelectYear:o})=>e.jsx("div",{className:"mb-3 p-2 rounded-lg",style:{backgroundColor:r.colors.surface},children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium mb-1",style:{color:r.colors.textSecondary},children:l==="fr"?"Mois":"Month"}),e.jsx("div",{className:"grid grid-cols-3 gap-1",children:s.map((a,c)=>e.jsx("button",{onClick:()=>n(c),className:"px-1.5 py-0.5 text-xs rounded transition-colors",style:{backgroundColor:c===t.getMonth()?r.colors.accent:"transparent",color:c===t.getMonth()?"#ffffff":r.colors.text},onMouseEnter:i=>{c!==t.getMonth()&&(i.currentTarget.style.backgroundColor=r.colors.surface)},onMouseLeave:i=>{c!==t.getMonth()&&(i.currentTarget.style.backgroundColor="transparent")},children:a},c))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium mb-1",style:{color:r.colors.textSecondary},children:l==="fr"?"AnnÃ©e":"Year"}),e.jsx("div",{className:"space-y-0.5 max-h-24 overflow-y-auto",children:Array.from({length:8},(a,c)=>t.getFullYear()-3+c).map(a=>e.jsx("button",{onClick:()=>o(a),className:`w-full px-1.5 py-0.5 text-xs rounded transition-colors ${a===t.getFullYear()?"bg-blue-500 text-white":"hover:bg-gray-100"}`,style:{backgroundColor:a===t.getFullYear()?r.colors.accent:"transparent",color:a===t.getFullYear()?"#ffffff":r.colors.text},children:a},a))})]})]})}),mc=({weekDays:t,currentTheme:s,isCompact:r})=>e.jsx("div",{className:`grid grid-cols-7 ${r?"mb-0.5":"mb-1"}`,children:t.map((l,n)=>e.jsx("div",{className:`text-center text-xs font-medium ${r?"py-0.5":"py-1"}`,style:{color:n>=5?"#ef4444":s.colors.textMuted},children:l},n))}),xc=({days:t,currentTheme:s,isCompact:r,daySize:l,dayGap:n,selectedDate:o,onDayClick:a,onMount:c})=>e.jsx("div",{className:`grid grid-cols-7 ${n}`,ref:i=>{i&&!o&&c&&c()},children:t.map((i,d)=>e.jsx("button",{onClick:()=>a(i),"data-day":i.date.getDate(),className:`${l} text-xs rounded transition-colors ${i.isSelected?"bg-blue-500 text-white":i.isCurrentMonth?"hover:bg-gray-100":"opacity-30"}`,style:{backgroundColor:i.isSelected?s.colors.accent:"transparent",color:i.isSelected?"#ffffff":i.isToday&&!i.isSelected?s.colors.accent:d%7>=5&&i.isCurrentMonth?"#ef4444":i.isCurrentMonth?s.colors.text:s.colors.textMuted},disabled:!i.isCurrentMonth,children:i.date.getDate()},d))}),fc=({currentTheme:t,currentLanguage:s,isCompact:r,buttonPadding:l,onToday:n,onClear:o})=>e.jsx("div",{className:`${r?"mt-2 pt-1.5":"mt-3 pt-2"} border-t`,style:{borderColor:t.colors.border},children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:n,className:`${l} text-xs rounded-md transition-colors hover:bg-gray-100`,style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},children:s==="fr"?"Aujourd'hui":"Today"}),e.jsx("button",{onClick:o,className:`${l} text-xs rounded-md transition-colors hover:bg-gray-100`,style:{backgroundColor:t.colors.surface,color:t.colors.text},children:s==="fr"?"Effacer":"Clear"})]})}),gs=({value:t,onChange:s,placeholder:r="jj/mm/aaaa",disabled:l=!1,className:n="",id:o,name:a,title:c,size:i="normal",style:d={}})=>{const{currentTheme:u}=ee(),{currentLanguage:m}=X(),[p,x]=b.useState(!1),[f,g]=b.useState(new Date),[h,y]=b.useState(null),[j,v]=b.useState(!1),[N,S]=b.useState(!1),[w,k]=b.useState(""),[M,C]=b.useState("left"),[R,P]=b.useState(0),[D,T]=b.useState(0),E=b.useRef(null),L=b.useRef(null);b.useEffect(()=>{if(t){const H=new Date(t);isNaN(H.getTime())||(y(H),g(H),k(U(H)))}else y(null),g(new Date),k("")},[t]),b.useEffect(()=>{const H=Q=>{const fe=Q.target;fe&&fe.closest&&fe.closest('[data-datepicker-root="1"]')||E.current&&!E.current.contains(fe)&&(x(!1),v(!1))};if(p)return document.addEventListener("mousedown",H),()=>document.removeEventListener("mousedown",H)},[p]);const U=H=>H.toLocaleDateString(m==="fr"?"fr-FR":"en-US",{day:"2-digit",month:"2-digit",year:"numeric"}),_=H=>{const Q=H.getFullYear(),fe=String(H.getMonth()+1).padStart(2,"0"),Z=String(H.getDate()).padStart(2,"0");return`${Q}-${fe}-${Z}`},B=()=>m==="fr"?["lun.","mar.","mer.","jeu.","ven.","sam.","dim."]:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],z=()=>m==="fr"?["janv.","fÃ©vr.","mars","avr.","mai","juin","juil.","aoÃ»t","sept.","oct.","nov.","dÃ©c."]:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],A=H=>{const Q=H.getFullYear(),fe=H.getMonth(),Z=[],me=(new Date(Q,fe,1).getDay()+6)%7,ge=new Date(Q,fe,1-me);for(let Pe=0;Pe<42;Pe++){const Oe=new Date(ge);Oe.setDate(ge.getDate()+Pe);const ct=Oe.getMonth()===fe,tt=h?Oe.toDateString()===h.toDateString():!1,Ct=Oe.toDateString()===new Date().toDateString();Z.push({date:Oe,isCurrentMonth:ct,isSelected:tt,isToday:Ct})}return Z},F=()=>{const H=new Date;f.getMonth()===H.getMonth()&&f.getFullYear()===H.getFullYear()&&setTimeout(()=>{const Q=document.querySelector(`[data-day="${H.getDate()}"]`);Q&&Q.scrollIntoView({block:"center",behavior:"smooth"})},100)},q=()=>{g(new Date(f.getFullYear(),f.getMonth()-1,1))},W=()=>{g(new Date(f.getFullYear(),f.getMonth()+1,1))},I=H=>{if(H.isCurrentMonth){const Q=new Date(H.date);y(Q),k(U(Q)),s(_(Q)),x(!1)}},$=H=>{g(new Date(f.getFullYear(),H,1)),v(!1)},V=H=>{g(new Date(H,f.getMonth(),1)),v(!1),S(!1)},K=()=>{S(!N),v(!1)},ne=()=>{if(!p){if(L.current){const H=L.current.getBoundingClientRect(),Q=window.innerWidth,fe=i==="compact"?260:280,Z=i==="compact"?320:380;H.left+fe>Q?C("right"):C("left");const me=window.innerHeight-H.bottom>=Z?H.bottom+8:Math.max(8,H.top-Z-8),ge=H.left+fe>Q?Math.max(8,H.right-fe):Math.max(8,H.left);P(me),T(ge)}h||g(new Date)}x(!p)};b.useEffect(()=>{if(N){const H=setTimeout(()=>{S(!1)},1e4);return()=>clearTimeout(H)}},[N]),b.useEffect(()=>{if(!p)return;const H=()=>{if(!L.current)return;const Q=L.current.getBoundingClientRect(),fe=window.innerWidth,Z=i==="compact"?260:280,oe=i==="compact"?320:380,ge=window.innerHeight-Q.bottom>=oe?Q.bottom+8:Math.max(8,Q.top-oe-8),Pe=Q.left+Z>fe?Math.max(8,Q.right-Z):Math.max(8,Q.left);P(ge),T(Pe)};return window.addEventListener("scroll",H,!0),window.addEventListener("resize",H),H(),()=>{window.removeEventListener("scroll",H,!0),window.removeEventListener("resize",H)}},[p,i]);const ue=()=>{y(null),k(""),s(""),x(!1)},le=()=>{const H=new Date;y(H),g(H),k(U(H)),s(_(H)),x(!1)},je=H=>{const Q=H.replace(/[^\d]/g,"");if(Q.length>8)return;if(!Q){y(null),s(""),k("");return}let fe="";const Z=m==="en";if(Q.length<=2?fe=Q:Q.length<=4?Z?fe=`${Q.slice(0,2)}/${Q.slice(2)}`:fe=`${Q.slice(0,2)}/${Q.slice(2)}`:Z?fe=`${Q.slice(0,2)}/${Q.slice(2,4)}/${Q.slice(4)}`:fe=`${Q.slice(0,2)}/${Q.slice(2,4)}/${Q.slice(4)}`,k(fe),Q.length>=6){let oe,me,ge;if(Z?(me=parseInt(Q.slice(0,2)),oe=parseInt(Q.slice(2,4)),ge=Q.length>=8?parseInt(Q.slice(4,8)):new Date().getFullYear()):(oe=parseInt(Q.slice(0,2)),me=parseInt(Q.slice(2,4)),ge=Q.length>=8?parseInt(Q.slice(4,8)):new Date().getFullYear()),oe>=1&&oe<=31&&me>=1&&me<=12&&ge>=1900&&ge<=2100){const Pe=new Date(ge,me-1,oe);if(!isNaN(Pe.getTime())&&Pe.getDate()===oe&&Pe.getMonth()===me-1&&Pe.getFullYear()===ge){y(Pe),g(Pe);const Oe=_(Pe);console.log("ðŸ—“ï¸ CustomDatePicker onChange triggered:",Oe),s(Oe),k(U(Pe));return}}}},ye=H=>{if(H.key==="Enter"){const Q=H.target;je(Q.value)}else H.key==="Escape"&&x(!1)},ve=()=>{const H=L.current?.value||"";if(console.log("ðŸ” onBlur triggered, currentValue:",H),H&&H.includes("/")){console.log("ðŸ” Trying to validate date:",H);const Q=H.split("/");if(Q.length===3){const fe=parseInt(Q[0]),Z=parseInt(Q[1]),oe=parseInt(Q[2]);if(fe>=1&&fe<=31&&Z>=1&&Z<=12&&oe>=1900&&oe<=2100){const me=new Date(oe,Z-1,fe);if(!isNaN(me.getTime())&&me.getDate()===fe&&me.getMonth()===Z-1&&me.getFullYear()===oe){console.log("ðŸ—“ï¸ Valid date found, triggering onChange:",_(me)),y(me),g(me),s(_(me)),k(U(me));return}}}}};b.useEffect(()=>{const H=Q=>{if(p)switch(Q.key){case"Escape":x(!1),v(!1);break;case"ArrowLeft":Q.preventDefault(),q();break;case"ArrowRight":Q.preventDefault(),W();break;case"Enter":Q.preventDefault(),j&&v(!1);break}};return document.addEventListener("keydown",H),()=>document.removeEventListener("keydown",H)},[p,j,f]);const se=A(f),Y=B(),te=z(),G=i==="compact",he=G?"p-2":"p-3",we=G?"mb-2":"mb-3",Ie=G?"w-6 h-6":"w-7 h-7",Te=G?"gap-0":"gap-0.5",ze=G?"px-2 py-1":"px-3 py-1.5",re=G?"text-xs":"text-sm";return e.jsxs("div",{className:"relative",ref:E,children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:L,id:o,name:a,type:"text",value:w||(h?U(h):""),placeholder:r,disabled:l,onClick:()=>!l&&ne(),onChange:H=>{const Q=H.target;console.log("ðŸ” onChange triggered, value:",Q.value),k(Q.value)},onKeyDown:H=>ye(H),onBlur:()=>ve(),className:`w-full pr-20 pl-4 py-2 text-base border rounded-lg focus:outline-none transition-all ${n}`,style:{backgroundColor:u.colors.surface,borderColor:u.colors.border,color:u.colors.text,WebkitAppearance:"none",MozAppearance:"textfield",...d},title:c,autoComplete:"off","data-lpignore":"true",inputMode:"text"}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center space-x-1",children:[h&&e.jsx("button",{type:"button",onClick:H=>{H.stopPropagation(),ue()},className:"p-1 rounded-md transition-colors cursor-pointer",style:{color:u.colors.textMuted,backgroundColor:"transparent"},onMouseEnter:H=>{H.currentTarget.style.backgroundColor=u.colors.surface},onMouseLeave:H=>{H.currentTarget.style.backgroundColor="transparent"},title:"Effacer",children:e.jsx(be,{size:14})}),e.jsxs("button",{type:"button",onClick:()=>!l&&x(!p),className:"p-1 rounded-md transition-colors cursor-pointer",style:{color:u.colors.accent,backgroundColor:"transparent"},onMouseEnter:H=>{H.currentTarget.style.backgroundColor=u.colors.surface},onMouseLeave:H=>{H.currentTarget.style.backgroundColor="transparent"},title:"Ouvrir le calendrier",children:[e.jsx(bt,{size:16}),e.jsx(Le,{size:12})]})]})]}),p&&typeof document<"u"&&St.createPortal(e.jsxs("div",{className:`${he} rounded-lg shadow-2xl border`,style:{position:"fixed",zIndex:9999,top:R,left:D,backgroundColor:u.colors.card,borderColor:u.colors.border,color:u.colors.text,...G?{minWidth:"240px",maxWidth:"260px"}:{minWidth:"260px",maxWidth:"280px"}},"data-datepicker-root":"1",children:[e.jsx(cc,{currentDate:f,months:te,currentTheme:u,isCompact:G,isCompactView:N,headerMargin:we,buttonPadding:ze,textSize:re,onPrev:q,onNext:W,onToggleView:K}),N&&e.jsx(dc,{currentDate:f,months:te,currentTheme:u,currentLanguage:m,onSelectMonth:$,onSelectYear:V}),j&&!N&&e.jsx(uc,{currentDate:f,months:te,currentTheme:u,currentLanguage:m,onSelectMonth:$,onSelectYear:V}),!N&&e.jsxs(e.Fragment,{children:[e.jsx(mc,{weekDays:Y,currentTheme:u,isCompact:G}),e.jsx(xc,{days:se,currentTheme:u,isCompact:G,daySize:Ie,dayGap:Te,selectedDate:h,onDayClick:I,onMount:F})]}),e.jsx(fc,{currentTheme:u,currentLanguage:m,isCompact:G,buttonPadding:ze,onToday:le,onClear:ue})]}),document.body)]})},pc=/^[A-Z]{1,3}[FGHJKMNQUVXZ]\d{1,2}$/,hc=/^[A-Z]{6}$/,gc=/(USDT|PERP|USDC|BUSD)$/i,yc=/^\^/,bc=/\//,vc=new Set(["ES","NQ","YM","RTY","CL","GC","SI","NG","ZB","ZN","ZF","ZT","ZC","ZS","ZW","KC","SB","CC","CT","LB","OJ","PA","PL","HG","HO","RB","TY","FV","TU","ED","FF","GE","JY","AD","CD","BP","SF","EC","MP","DX","VX","EMD","NKD"]),jc=new Set(["MES","MNQ","MYM","M2K","MCL","MGC","MSI","MNG"]),Nc=new Set(["SPX","NDX","RUT","DJI","VIX","IXIC","GSPC","SPY","QQQ","IWM","DIA","VXX","UVXY","TVIX","SVXY","XIV","VXXB","VXZ","VIXY"]),kc=new Set(["EURUSD","GBPUSD","USDJPY","AUDUSD","USDCAD","USDCHF","NZDUSD","EURGBP","EURJPY","GBPJPY","AUDJPY","CADJPY","CHFJPY","NZDJPY","EURAUD","EURCAD","EURCHF","EURNZD","GBPAUD","GBPCAD","GBPCHF","GBPNZD","AUDCAD","AUDCHF","AUDNZD","CADCHF","CADNZD","CHFNZD"]),wc=new Set(["AAPL","TSLA","MSFT","GOOGL","AMZN","META","NVDA","NFLX","AMD","INTC","ORCL","CRM","ADBE","PYPL","UBER","LYFT","SNAP","TWTR","SQ","ROKU","ZM","PTON","PELOTON","SPOT","SHOP","OKTA","SNOW","PLTR","COIN","RBLX","GOOG","FB","DIS","JPM","JNJ","V","PG","UNH","HD","MA","BAC","XOM","T","PFE","KO","WMT","ABBV","BRK","BRK.B","RIVN"]),Sc=new Set(["BTC","ETH","ADA","SOL","MATIC","AVAX","DOT","LINK","UNI","AAVE","SUSHI","COMP","MKR","YFI","SNX","CRV","1INCH","BAL","LRC","ZRX","BITCOIN","ETHEREUM","CARDANO","POLYGON","AVALANCHE","POLKADOT"]),Cc=["BINANCE:","COINBASE:","KRAKEN:","BITFINEX:","BITTREX:","HUOBI:","OKEX:","BYBIT:","FTX:","KUCOIN:","GATE:","MEXC:"],Pc={".r":"",".R":"",".X":"","-PERP":"","-PERPETUAL":""};function Mc(t){let s=t.trim().toUpperCase();for(const r of Cc)if(s.startsWith(r)){s=s.substring(r.length);break}for(const[r,l]of Object.entries(Pc))s.endsWith(r)&&(s=s.substring(0,s.length-r.length)+l);return s.includes(".")&&!s.includes("BRK")?s=s.replace(/\./g,""):s=s.replace(/[\/\-\s]/g,""),s}function Rl(t){const s=t,r=Mc(t);return vc.has(r)||jc.has(r)?{market:"futures",confidence:3,rule:"dict:futures",originalSymbol:s,normalizedSymbol:r}:Nc.has(r)?{market:"indices",confidence:3,rule:"dict:indices",originalSymbol:s,normalizedSymbol:r}:kc.has(r)?{market:"forex",confidence:3,rule:"dict:forex",originalSymbol:s,normalizedSymbol:r}:wc.has(r)?{market:"stocks",confidence:3,rule:"dict:stocks",originalSymbol:s,normalizedSymbol:r}:Sc.has(r)?{market:"crypto",confidence:3,rule:"dict:crypto",originalSymbol:s,normalizedSymbol:r}:pc.test(r)?{market:"futures",confidence:2,rule:"regex:futContract",originalSymbol:s,normalizedSymbol:r}:hc.test(r)?{market:"forex",confidence:2,rule:"regex:fx6",originalSymbol:s,normalizedSymbol:r}:gc.test(r)?{market:"crypto",confidence:2,rule:"regex:cryptoPair",originalSymbol:s,normalizedSymbol:r}:bc.test(s)?{market:"forex",confidence:2,rule:"slash:fx",originalSymbol:s,normalizedSymbol:r}:yc.test(s)||r==="SPX"||r==="NDX"?{market:"indices",confidence:2,rule:"prefix:index",originalSymbol:s,normalizedSymbol:r}:{market:"unknown",confidence:1,rule:"fallback",originalSymbol:s,normalizedSymbol:r}}function Rc(t,s="fr"){return{fr:{futures:"Future (CME)",forex:"Forex",stocks:"Action",indices:"Indice",crypto:"Crypto",commodities:"MatiÃ¨re premiÃ¨re",unknown:"Symbole"},en:{futures:"Future (CME)",forex:"Forex",stocks:"Stock",indices:"Index",crypto:"Crypto",commodities:"Commodity",unknown:"Symbol"}}[s][t]}const Tl="market-detection-overrides",Tc=100;function Dl(){try{const t=localStorage.getItem(Tl);if(!t)return new Map;const s=JSON.parse(t),r=new Map,l=Date.now()-720*60*60*1e3;for(const[n,o]of Object.entries(s)){const a=o;a&&typeof a.timestamp=="number"&&a.timestamp>l&&r.set(n,a)}return r}catch(t){return console.warn("Erreur lors du chargement des overrides:",t),new Map}}function Dc(t){try{const s=Array.from(t.entries()).sort((l,n)=>n[1].timestamp-l[1].timestamp).slice(0,Tc),r=Object.fromEntries(s);localStorage.setItem(Tl,JSON.stringify(r))}catch(s){console.warn("Erreur lors de la sauvegarde des overrides:",s)}}function El(t,s){return!s||t.market==="unknown"?!1:t.market!==s}function Ec(t){return Dl().get(t)||null}function Fl(t,s,r,l=!1){if(!l)return;const n=Dl();n.set(t,{symbol:t,market:s,timestamp:Date.now(),reason:r}),Dc(n)}function Al(t,s,r){const l=Ec(t);return l?l.market:s.market}function Ll(t,s,r,l="fr"){const n={fr:{futures:"future (CME)",forex:"forex",stocks:"action",indices:"indice",crypto:"crypto",commodities:"matiÃ¨re premiÃ¨re"},en:{futures:"future (CME)",forex:"forex",stocks:"stock",indices:"index",crypto:"crypto",commodities:"commodity"}},o={fr:{futures:"Futures",forex:"Forex",stocks:"Actions",indices:"Indices",crypto:"Crypto",commodities:"MatiÃ¨res premiÃ¨res"},en:{futures:"Futures",forex:"Forex",stocks:"Stocks",indices:"Indices",crypto:"Crypto",commodities:"Commodities"}},a=s.market==="unknown"?"forex":s.market,c=n[l][a],i=o[l][a],d=s.confidence===3?l==="fr"?"(haute confiance)":"(high confidence)":s.confidence===2?l==="fr"?"(confiance moyenne)":"(medium confidence)":l==="fr"?"(faible confiance)":"(low confidence)";return l==="fr"?`${t} est dÃ©tectÃ© comme ${c} ${d}.

Raison: ${s.rule}

Basculer le marchÃ© vers ${i} ?`:`${t} is detected as ${c} ${d}.

Reason: ${s.rule}

Switch market to ${i}?`}const $l=(t,s)=>{if(!s||!s.trim())return t;const r=s.toLowerCase().trim();return t.filter(l=>{const n=l.toLowerCase();return n===r||n.startsWith(r)||n.includes(r)?!0:r.split(/[\s\-_]+/).every(a=>n.includes(a))})},Qo=({suggestions:t,favoriteSymbols:s,customSymbols:r,theme:l,onSelect:n,onToggleFavorite:o,onRemoveCustom:a})=>!t||t.length===0?null:e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 rounded-lg shadow-lg z-20 max-h-48 overflow-y-auto border",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border},children:t.map((c,i)=>{const d=s.includes(c),u=r.includes(c);return e.jsxs("button",{onClick:()=>n(c),className:"w-full px-4 py-2 text-left hover:bg-opacity-10 border-b last:border-b-0 transition-colors flex items-center justify-between",style:{borderColor:l.colors.border,color:l.colors.text},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d&&e.jsx("span",{className:"text-yellow-400 text-sm",children:"â­"}),u&&e.jsx("span",{className:"text-green-400 text-xs",children:"+"}),e.jsx("span",{className:"font-medium",children:c})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[u&&e.jsx("button",{onClick:m=>{m.stopPropagation(),a(c)},className:"p-1 rounded-full hover:bg-red-500 hover:bg-opacity-20 transition-colors",title:"Supprimer ce symbole personnalisÃ©",children:e.jsx("span",{className:"text-red-400 text-xs",children:"âœ•"})}),e.jsx("button",{onClick:m=>{m.stopPropagation(),o(c)},className:"p-1 rounded-full hover:bg-yellow-500 hover:bg-opacity-20 transition-colors",title:d?"Retirer des favoris":"Ajouter aux favoris",children:e.jsx("span",{className:"text-yellow-400 text-xs",children:d?"â­":"â˜†"})})]})]},`${c}-${i}`)})}),Kr=({isOpen:t,onClose:s,theme:r,t1:l,symbolSearch:n,onChangeSearch:o,onAddCustomSymbol:a,favoriteSymbols:c,filteredFavorites:i,filteredMarketSymbols:d,filteredCustomSymbols:u,currentSelectedSymbol:m,marketLabel:p,onSelectSymbol:x,onToggleFavorite:f,onRemoveCustomSymbol:g,draggedItem:h,dragOverIndex:y,onDragStart:j,onDragOver:v,onDragLeave:N,onDrop:S,onDragEnd:w})=>{if(!t)return null;const k=2147483647,M=e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center p-4",style:{zIndex:k},children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:s,style:{zIndex:k-1}}),e.jsxs("div",{className:"relative w-[720px] max-w-4xl rounded-xl shadow-2xl overflow-hidden",style:{backgroundColor:r.colors.card||r.colors.surface,border:`1px solid ${r.colors.border}`,pointerEvents:"auto",zIndex:k},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",style:{borderColor:r.colors.border,backgroundColor:(r.colors.surface||"")+"50"},children:[e.jsx("h3",{className:"font-bold text-lg",style:{color:r.colors.text},children:l("symboles_existants")||"Symboles existants"}),e.jsx("button",{onClick:s,className:"p-1 rounded-full hover:bg-gray-100 transition-colors",style:{color:r.colors.text},children:"âœ•"})]}),e.jsx("div",{className:"p-4 border-b",style:{borderColor:r.colors.border},children:e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("input",{type:"text",value:n,onChange:C=>o(C.target.value),placeholder:l("rechercher_un_symbole")||"Rechercher un symbole... (ex: EUR, BTC, AAPL)",className:"w-full pl-10 pr-12 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:r.colors.surface,borderColor:r.colors.border,color:r.colors.text},autoFocus:!0}),n.trim()&&e.jsx("button",{onClick:()=>{a(n),o("")},className:"absolute right-3 top-1/2 transform -translate-y-1/2 px-3 py-1.5 rounded-full transition-all duration-200 hover:scale-105 active:scale-95 shadow-sm",style:{backgroundColor:r.colors.accent,color:"#ffffff"},title:`Ajouter "${n.trim()}" aux symboles personnalisÃ©s`,children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-sm font-semibold",children:"+"}),e.jsx("span",{className:"text-xs font-medium",children:"Ajouter"})]})})]})}),e.jsx("div",{className:"max-h-80 overflow-y-auto p-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-3 h-full",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-yellow-400 mr-2",children:"â­"}),e.jsx("h4",{className:"text-sm font-semibold",children:"Favoris"})]}),e.jsx("span",{className:"text-xs text-gray-400",title:"Glisser-dÃ©poser pour rÃ©organiser",children:"â‹®â‹®"})]}),e.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto",children:i.length>0?i.map((C,R)=>e.jsx("div",{draggable:!0,onDragStart:P=>j(P,C),onDragOver:P=>v(P,R),onDragLeave:N,onDrop:P=>S(P,R),onDragEnd:w,className:`w-full transition-all duration-200 ${h===C?"opacity-50 scale-95":""} ${y===R?"transform translate-y-1":""}`,children:e.jsx("button",{onClick:()=>x(C),className:`w-full px-2 py-2 text-sm rounded-lg border transition-all duration-200 hover:shadow-sm cursor-move ${m===C?"border-0 shadow-md":""} ${y===R?"border-yellow-400 border-2":""}`,style:{backgroundColor:m===C?r.colors.accent:r.colors.surface,borderColor:m===C?"transparent":y===R?"#fbbf24":r.colors.border,color:m===C?"#ffffff":r.colors.text},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-yellow-400 text-sm",children:"â­"}),e.jsx("span",{className:"font-medium text-xs",children:C}),e.jsx("span",{className:"text-gray-400 text-xs ml-1",children:"â‹®â‹®"})]}),e.jsx("button",{onClick:P=>{P.stopPropagation(),f(C)},className:"p-1 rounded-full hover:bg-red-500 hover:bg-opacity-20 transition-colors",title:"Retirer des favoris",children:e.jsx("span",{className:"text-red-400 text-sm",children:"âœ•"})})]})})},`fav-${C}`)):e.jsx("div",{className:"text-center py-4 text-xs",children:n.trim()?"Aucun favori trouvÃ©":"Aucun favori"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"text-blue-400 mr-2",children:"ðŸ“Š"}),e.jsx("h4",{className:"text-sm font-semibold",children:p})]}),e.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto",children:d.length>0?d.map(C=>e.jsx("button",{onClick:()=>x(C),className:`w-full px-2 py-2 text-sm rounded-lg border transition-all duration-200 hover:shadow-sm ${m===C?"border-0 shadow-md":""}`,style:{backgroundColor:m===C?r.colors.accent:r.colors.surface,borderColor:m===C?"transparent":r.colors.border,color:m===C?"#ffffff":r.colors.text},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-xs",children:C}),e.jsx("button",{onClick:R=>{R.stopPropagation(),f(C)},className:"p-1 rounded-full hover:bg-yellow-500 hover:bg-opacity-20 transition-colors",title:"Ajouter aux favoris",children:e.jsx("span",{className:"text-yellow-400 text-sm",children:"â˜†"})})]})},`market-${C}`)):e.jsx("div",{className:"text-center py-4 text-xs",children:n.trim()?"Aucun symbole trouvÃ©":"Aucun symbole"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"text-green-400 mr-2",children:"âž•"}),e.jsx("h4",{className:"text-sm font-semibold",children:"PersonnalisÃ©s"})]}),e.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto",children:u.length>0?u.map(C=>{const R=c.includes(C);return e.jsx("button",{onClick:()=>x(C),className:`w-full px-2 py-2 text-sm rounded-lg border transition-all duration-200 hover:shadow-sm ${m===C?"border-0 shadow-md":""}`,style:{backgroundColor:m===C?r.colors.accent:r.colors.surface,borderColor:m===C?"transparent":r.colors.border,color:m===C?"#ffffff":r.colors.text},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[R&&e.jsx("span",{className:"text-yellow-400 text-sm",children:"â­"}),e.jsx("span",{className:"font-medium text-xs",children:C})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:P=>{P.stopPropagation(),g(C)},className:"p-1 rounded-full hover:bg-red-500 hover:bg-opacity-20 transition-colors",title:"Supprimer ce symbole personnalisÃ©",children:e.jsx("span",{className:"text-red-400 text-sm",children:"âœ•"})}),e.jsx("button",{onClick:P=>{P.stopPropagation(),f(C)},className:"p-1 rounded-full hover:bg-yellow-500 hover:bg-opacity-20 transition-colors",title:R?"Retirer des favoris":"Ajouter aux favoris",children:e.jsx("span",{className:"text-yellow-400 text-sm",children:R?"â­":"â˜†"})})]})]})},`custom-${C}`)}):e.jsx("div",{className:"text-center py-4 text-xs",children:n.trim()?"Aucun symbole personnalisÃ© trouvÃ©":"Aucun symbole personnalisÃ©"})})]})]})}),e.jsx("div",{className:"px-4 py-3 text-xs text-center border-t",style:{borderColor:r.colors.border,backgroundColor:(r.colors.surface||"")+"30",color:r.colors.textMuted},children:l("alt_s_pour_ouvrir_entree_pour_selectionner_esc_pour_fermer")||"Alt+S pour ouvrir â€¢ EntrÃ©e pour sÃ©lectionner â€¢ Esc pour fermer"})]})]});return typeof document<"u"?St.createPortal(M,document.body):M},Fc=({theme:t,formData:s,onChange:r,errors:l,settings:n,translate:o,isEditMode:a=!1,fieldConfig:c,shouldShowField:i,toggleFieldVisibility:d,isObligatoryField:u,currentLanguage:m="fr"})=>{const p=[{value:"futures",label:o("futures","Futures")},{value:"forex",label:o("forex","Forex")},{value:"stocks",label:o("stocks","Actions")},{value:"indices",label:o("indices","Indices")},{value:"crypto",label:o("crypto","Crypto")},{value:"commodities",label:o("commodities","MatiÃ¨res PremiÃ¨res")}];return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:t.colors.text},children:[o("profil","Profil")," *"]}),e.jsx("div",{className:"px-3 py-2 border rounded-lg shadow-sm",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text},children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-base",children:o("profil_principal","Profil Principal")}),e.jsxs("span",{className:"text-sm mt-1",style:{color:t.colors.textMuted},children:[n.initialCapital.toLocaleString(o("fr_fr","fr-FR"))," ",n.currency]})]})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:t.colors.text},children:[o("statut","Statut")," *"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>r("status","open"),className:`flex-1 flex items-center justify-center px-2 py-1 text-sm rounded-lg border-2 transition-all duration-200 ${s.status==="open"?"border-0 shadow-md transform scale-105":"hover:shadow-sm"}`,style:{backgroundColor:s.status==="open"?t.colors.accent:t.colors.surface,color:s.status==="open"?"#ffffff":t.colors.text,borderColor:s.status==="open"?"transparent":t.colors.border},children:e.jsx("span",{className:"font-medium",children:o("ouvert","Ouvert")})}),e.jsx("button",{onClick:()=>r("status","closed"),className:`flex-1 flex items-center justify-center px-2 py-1 text-sm rounded-lg border-2 transition-all duration-200 ${s.status==="closed"?"border-0 shadow-md transform scale-105":"hover:shadow-sm"}`,style:{backgroundColor:s.status==="closed"?t.colors.accent:t.colors.surface,color:s.status==="closed"?"#ffffff":t.colors.text,borderColor:s.status==="closed"?"transparent":t.colors.border},children:e.jsx("span",{className:"font-medium",children:o("ferme","FermÃ©")})})]}),l.status&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:t.colors.danger},children:l.status})]}),i&&i("side")&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"block text-sm font-semibold",style:{color:t.colors.text},children:[o("direction","Direction")," *"]}),a&&!u?.("side")&&e.jsx("button",{type:"button",onClick:()=>d&&d("side"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:c?.hiddenFields?.includes("side")?"Afficher":"Masquer",style:{color:c?.hiddenFields?.includes("side")?t.colors.accent:t.colors.textMuted},children:c?.hiddenFields?.includes("side")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),a&&u?.("side")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:m==="fr"?"Champ obligatoire":"Required field",children:m==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>r("side","long"),className:`flex-1 flex items-center justify-center px-2 py-1 text-sm rounded-lg border-2 transition-all duration-200 ${s.side==="long"?"shadow-md transform scale-105":"hover:shadow-sm"}`,style:{backgroundColor:s.side==="long"?`${t.colors.success}40`:t.colors.surface,color:s.side==="long"?"#ffffff":t.colors.text,borderColor:s.side==="long"?t.colors.success:t.colors.border},children:e.jsx("span",{className:"font-medium",children:o("long","Long")})}),e.jsx("button",{onClick:()=>r("side","short"),className:`flex-1 flex items-center justify-center px-2 py-1 text-sm rounded-lg border-2 transition-all duration-200 ${s.side==="short"?"shadow-md transform scale-105":"hover:shadow-sm"}`,style:{backgroundColor:s.side==="short"?`${t.colors.danger}40`:t.colors.surface,color:s.side==="short"?"#ffffff":t.colors.text,borderColor:s.side==="short"?t.colors.danger:t.colors.border},children:e.jsx("span",{className:"font-medium",children:o("short","Short")})})]}),l.side&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:t.colors.danger},children:l.side})]}),i&&i("market")&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"block text-sm font-semibold",style:{color:t.colors.text},children:[o("marche","MarchÃ©")," *"]}),a&&!u?.("market")&&e.jsx("button",{type:"button",onClick:()=>d&&d("market"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:c?.hiddenFields?.includes("market")?"Afficher":"Masquer",style:{color:c?.hiddenFields?.includes("market")?t.colors.accent:t.colors.textMuted},children:c?.hiddenFields?.includes("market")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),a&&u?.("market")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:m==="fr"?"Champ obligatoire":"Required field",children:m==="fr"?"Obligatoire":"Required"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:p.map(x=>e.jsx("button",{onClick:()=>r("market",x.value),className:`w-full h-8 px-2 py-1 text-sm rounded-lg border-2 transition-all duration-200 text-center flex items-center justify-center ${s.market===x.value?"border-0 shadow-md transform scale-105":"hover:shadow-sm"}`,style:{backgroundColor:s.market===x.value?t.colors.accent:t.colors.surface,color:s.market===x.value?"#ffffff":t.colors.text,borderColor:s.market===x.value?"transparent":t.colors.border},children:e.jsx("span",{className:"font-medium",children:x.label})},x.value))}),l.market&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:t.colors.danger},children:l.market})]})]})},Il=({theme:t,formData:s,onChange:r,t1:l,currentLanguage:n,setTimeframeOverlay:o,setTimeframeButtonRef:a,isEditMode:c=!1,fieldConfig:i,shouldShowField:d,toggleFieldVisibility:u,isObligatoryField:m})=>d&&d("timeframe")?e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("label",{className:"block text-sm font-semibold",style:{color:t.colors.text},children:[l("timeframe_tick")," ",e.jsx("span",{className:"text-xs ml-1",style:{color:t.colors.textMuted},children:l("optionnel")})]}),c&&!m?.("timeframe")&&e.jsx("button",{type:"button",onClick:()=>u&&u("timeframe"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:i?.hiddenFields?.includes("timeframe")?"Afficher":"Masquer",style:{color:i?.hiddenFields?.includes("timeframe")?t.colors.accent:t.colors.textMuted},children:i?.hiddenFields?.includes("timeframe")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),c&&m?.("timeframe")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:n==="fr"?"Champ obligatoire":"Required field",children:n==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:s.timeframe||"",onChange:p=>r("timeframe",p.target.value),placeholder:"Choisir timeframe (1m, 5m, 1h...) ou tick (50t, 100t...)",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors shadow-sm",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}}),s.timeframe&&e.jsx("button",{onClick:()=>r("timeframe",""),className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1 rounded-full hover:bg-opacity-10 hover:bg-black",style:{color:t.colors.textMuted},"aria-label":"Clear timeframe",children:"Ã—"})]}),e.jsx("button",{ref:a,onClick:()=>o(!0),className:"px-3 py-2 border rounded-lg transition-all duration-200 hover:shadow-sm",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text},title:n==="fr"?"Choisir dans la liste":"Choose from list",children:e.jsx(Le,{size:16})})]}),e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:["1m","5m","15m","1h","4h","1d"].map(p=>e.jsx("button",{onClick:()=>r("timeframe",p),className:`px-4 py-2 text-sm rounded-full border transition-all duration-200 ${s.timeframe===p?"border-0 shadow-sm":"hover:shadow-sm"}`,style:{backgroundColor:s.timeframe===p?t.colors.accent:t.colors.surface,color:s.timeframe===p?"#ffffff":t.colors.text,borderColor:s.timeframe===p?"transparent":t.colors.border},children:p},p))})})]}):null,Ac=({formData:t,onChange:s,errors:r,settings:l,existingSymbols:n=[],isEditMode:o=!1,fieldConfig:a,shouldShowField:c,toggleFieldVisibility:i,isObligatoryField:d})=>{const{currentTheme:u}=ee(),{currentLanguage:m,t:p}=X(),x=(Z,oe)=>p[Z]||oe,f=Z=>x(Z,Z),[g,h]=b.useState(!1),[y,j]=b.useState(null),[v,N]=b.useState(!1),[S,w]=b.useState(!1),[k,M]=b.useState(""),[C,R]=b.useState(0),[P,D]=b.useState(null),T=n.slice(0,5),E={futures:["ES","NQ","YM","CL","GC","SI","ZB","ZN","NG","HO","RB","PL","PA","HG"],forex:["EURUSD","GBPUSD","USDJPY","AUDUSD","EURGBP","EURJPY","GBPJPY","USDCAD","NZDUSD","USDCHF"],crypto:["BTCUSD","ETHUSD","ADAUSD","SOLUSD","BTCUSDT","ETHUSDT","ADAUSDT","SOLUSDT","DOTUSD","LINKUSD"],stocks:["AAPL","MSFT","GOOGL","TSLA","AMZN","NVDA","META","NFLX","AMD","INTC"],indices:["SPX","NDX","DJI","RUT","VIX","SPY","QQQ","IWM","VXX"],commodities:["CL","GC","SI","NG","HO","RB","PL","PA","HG","ZC","ZS","ZW"]},[L,U]=b.useState(()=>JSON.parse(localStorage.getItem("favorite-symbols")||"[]")),[_,B]=b.useState(()=>JSON.parse(localStorage.getItem(`custom-symbols-${t.market}`)||"[]")),[z,A]=b.useState(null),[F,q]=b.useState(null),[W,I]=b.useState(!0);b.useEffect(()=>{const Z=JSON.parse(localStorage.getItem(`custom-symbols-${t.market}`)||"[]");B(Z)},[t.market]);const $=t.market?E[t.market]||[]:[],V=$.filter(Z=>!L.includes(Z)&&!_.includes(Z)),K=Z=>{if(!t.market||!Z.trim())return;const oe=JSON.parse(localStorage.getItem(`custom-symbols-${t.market}`)||"[]"),me=Z.trim().toUpperCase();if(!oe.includes(me)&&!$.includes(me)){const ge=[...oe,me];localStorage.setItem(`custom-symbols-${t.market}`,JSON.stringify(ge)),B(ge)}},ne=Z=>{if(!t.market)return;const me=JSON.parse(localStorage.getItem(`custom-symbols-${t.market}`)||"[]").filter(ge=>ge!==Z);localStorage.setItem(`custom-symbols-${t.market}`,JSON.stringify(me)),B(me)},ue=$l,le=ue(n,k),ye=(Z=>{if(!Z.trim())return[];if(S)return[];if(!W)return[];const oe=Z.toUpperCase(),me=[...L,...V,..._];if(me.includes(oe))return[];Z.toLowerCase().trim();const ge=[...new Set(me)];return ue(ge,Z).slice(0,5)})(t.symbol||""),ve=ue(L,k),se=ue(V,k),Y=ue(_,k),te=(Z,oe)=>{const me=Al(Z,oe,t.market);if(El(oe,t.market)){const Oe=Ll(Z,oe,t.market,m),ct=window.confirm(Oe+`

`+x("m_moriser_ce_choix_pour_ce_symbole__","MÃ©moriser ce choix pour ce symbole ?"));window.confirm(Oe)&&(s("market",me),ct&&Fl(Z,me,oe.rule,!0))}s("symbol",Z);const ge=JSON.parse(localStorage.getItem("symbol-recent")||"[]"),Pe=[Z,...ge.filter(Oe=>Oe!==Z)].slice(0,10);localStorage.setItem("symbol-recent",JSON.stringify(Pe)),w(!1),M(""),R(0)},G=b.useCallback(Z=>{const oe=Rl(Z);te(Z,oe),I(!1)},[te]),he=Z=>{const oe=JSON.parse(localStorage.getItem("favorite-symbols")||"[]"),me=oe.includes(Z);let ge;me?ge=oe.filter(Pe=>Pe!==Z):ge=[...oe,Z],localStorage.setItem("favorite-symbols",JSON.stringify(ge)),U(ge)},we=(Z,oe)=>{A(oe),Z.dataTransfer.effectAllowed="move",Z.dataTransfer.setData("text/plain",oe)},Ie=(Z,oe)=>{Z.preventDefault(),Z.dataTransfer.dropEffect="move",q(oe)},Te=()=>{q(null)},ze=(Z,oe)=>{if(Z.preventDefault(),!z)return;const me=L.indexOf(z);if(me===-1||me===oe){A(null),q(null);return}const ge=[...L],[Pe]=ge.splice(me,1);ge.splice(oe,0,Pe),localStorage.setItem("favorite-symbols",JSON.stringify(ge)),U(ge),A(null),q(null)},re=()=>{A(null),q(null)};b.useEffect(()=>{const Z=oe=>{if(oe.altKey&&oe.key==="t"&&(oe.preventDefault(),h(!0)),oe.altKey&&oe.key==="d"){oe.preventDefault();const me=document.getElementById("trade-date-input");me&&me.focus()}if(oe.altKey&&oe.key==="s"&&(oe.preventDefault(),w(!0)),oe.key==="t"&&!oe.altKey&&!oe.ctrlKey&&document.activeElement?.id==="trade-date-input"&&(oe.preventDefault(),H()),oe.key==="Escape"&&(h(!1),w(!1),fe(!1)),oe.key==="Enter"&&S&&le.length>0){oe.preventDefault();const me=le[C];me&&G(me)}if(S&&(oe.key==="ArrowDown"||oe.key==="ArrowUp"||oe.key==="ArrowLeft"||oe.key==="ArrowRight")){oe.preventDefault();const me=2;Math.ceil(le.length/me),oe.key==="ArrowDown"?R(ge=>Math.min(ge+me,le.length-1)):oe.key==="ArrowUp"?R(ge=>Math.max(ge-me,0)):oe.key==="ArrowRight"?R(ge=>Math.min(ge+1,le.length-1)):oe.key==="ArrowLeft"&&R(ge=>Math.max(ge-1,0))}};return document.addEventListener("keydown",Z),()=>document.removeEventListener("keydown",Z)},[s,S,le,C,G]);const H=()=>{s("date",new Date().toISOString().split("T")[0])},[Q,fe]=b.useState(!1);return b.useEffect(()=>{t.date&&v&&(s("entryDate",t.date),s("exitDate",t.date))},[t.date,v,s]),x("futures","Futures"),x("forex","Forex"),x("stocks","Actions"),x("indices","Indices"),x("crypto","Crypto"),x("commodities","MatiÃ¨res PremiÃ¨res"),e.jsxs("div",{className:"h-full flex flex-col animate-fadeIn",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-2 gap-10",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(Fc,{theme:u,formData:t,onChange:s,errors:r,settings:l,translate:x,isEditMode:o,fieldConfig:a,shouldShowField:c,toggleFieldVisibility:i,isObligatoryField:d,currentLanguage:m}),c&&c("symbol")&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"block text-sm font-semibold",style:{color:u.colors.textSecondary},children:[x("symbole","Symbole")," *"]}),o&&!d?.("symbol")&&e.jsx("button",{type:"button",onClick:()=>i&&i("symbol"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:a?.hiddenFields?.includes("symbol")?"Afficher":"Masquer",style:{color:a?.hiddenFields?.includes("symbol")?u.colors.warning:u.colors.textMuted},children:a?.hiddenFields?.includes("symbol")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),o&&d?.("symbol")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:u.colors.accent+"20",color:u.colors.accent,border:`1px solid ${u.colors.accent}40`},title:m==="fr"?"Champ obligatoire":"Required field",children:m==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex space-x-2 relative",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:t.symbol||"",onChange:Z=>{s("symbol",Z.target.value.toUpperCase()),I(!0)},placeholder:x("ex__es__eurusd__aapl___","Ex: EURUSD, AAPL..."),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors shadow-sm",style:{backgroundColor:u.colors.surface,borderColor:r.symbol?u.colors.danger:u.colors.border,color:u.colors.text}}),e.jsx(Qo,{suggestions:ye,favoriteSymbols:L,customSymbols:_,theme:u,onSelect:G,onToggleFavorite:he,onRemoveCustom:ne})]}),e.jsx("button",{ref:D,type:"button",onClick:()=>w(!0),className:"px-3 py-2 border rounded-lg transition-all duration-200 hover:shadow-sm flex items-center",style:{backgroundColor:u.colors.surface,borderColor:u.colors.border,color:u.colors.text},title:x("alt_s_pour_ouvrir","Alt+S pour ouvrir"),children:e.jsx(Br,{size:16})})]}),T.length>0&&t.symbol!==T[0]&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-2",style:{color:u.colors.textMuted},children:f("recents")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:T.map(Z=>e.jsx("button",{onClick:()=>s("symbol",Z),className:"px-3 py-1 text-xs rounded-full border transition-all duration-200 hover:shadow-sm",style:{backgroundColor:t.symbol===Z?u.colors.accent:u.colors.surface,borderColor:u.colors.border,color:t.symbol===Z?"#ffffff":u.colors.text},children:Z},Z))})]})]}),r.symbol&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:u.colors.danger},children:r.symbol})]})]}),e.jsxs("div",{className:"flex flex-col ml-8 h-full",children:[e.jsx(Il,{theme:u,formData:t,onChange:s,t1:f,currentLanguage:m,setTimeframeOverlay:h,setTimeframeButtonRef:j,isEditMode:o,fieldConfig:a,shouldShowField:c,toggleFieldVisibility:i,isObligatoryField:d}),c&&c("date")&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("label",{className:"block text-sm font-semibold",style:{color:u.colors.textSecondary},children:[f("date")," *"]}),o&&!d?.("date")&&e.jsx("button",{type:"button",onClick:()=>i&&i("date"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:a?.hiddenFields?.includes("date")?"Afficher":"Masquer",style:{color:a?.hiddenFields?.includes("date")?u.colors.warning:u.colors.textMuted},children:a?.hiddenFields?.includes("date")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),o&&d?.("date")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:u.colors.accent+"20",color:u.colors.accent,border:`1px solid ${u.colors.accent}40`},title:m==="fr"?"Champ obligatoire":"Required field",children:m==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx("div",{className:"relative flex-1",children:e.jsx(gs,{id:"trade-date-input",value:t.date||"",onChange:Z=>s("date",Z),placeholder:m==="fr"?"jj/mm/aaaa":"mm/dd/yyyy",title:x("alt_d_pour_focus_t_pour_aujourd_hui","Alt+D pour focus, T pour aujourd'hui"),className:"w-full",size:"compact"})})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:Z=>N(Z.target.checked),className:"rounded"}),e.jsx("span",{className:"text-sm",style:{color:u.colors.text},children:m==="fr"?"PrÃ©remplir l'entrÃ©e/sortie":"Prefill entry/exit"})]}),e.jsx("span",{className:"text-xs",style:{color:u.colors.textMuted},children:"Fuseau : Europe/Paris"})]})]})]})]})]}),e.jsx(Jr,{isOpen:g,onClose:()=>h(!1),onSelect:Z=>s("timeframe",Z),currentValue:t.timeframe}),e.jsx(Kr,{isOpen:S,onClose:()=>w(!1),theme:u,t1:f,symbolSearch:k,onChangeSearch:M,onAddCustomSymbol:K,favoriteSymbols:L,filteredFavorites:ve,filteredMarketSymbols:se,filteredCustomSymbols:Y,currentSelectedSymbol:t.symbol,marketLabel:`Symboles (${(t.market||"").charAt(0).toUpperCase()}${(t.market||"").slice(1)})`,onSelectSymbol:G,onToggleFavorite:he,onRemoveCustomSymbol:ne,draggedItem:z,dragOverIndex:F,onDragStart:we,onDragOver:Ie,onDragLeave:Te,onDrop:ze,onDragEnd:re})]})},zl=(t,s)=>{const r=t?t.split(":").map(Number):[0,0,0],[l=0,n=0,o=0]=r,a=(u,m,p)=>{const x=u.toString().padStart(2,"0"),f=m.toString().padStart(2,"0"),g=p.toString().padStart(2,"0");s("entryTime",`${x}:${f}:${g}`)};return{hours:l,minutes:n,seconds:o,updateTime:a,handleHoursChange:u=>{const m=parseInt(u.target.value)||0,p=Math.max(0,Math.min(23,m));a(p,n,o)},handleMinutesChange:u=>{const m=parseInt(u.target.value)||0,p=Math.max(0,Math.min(59,m));a(l,p,o)},handleSecondsChange:u=>{const m=parseInt(u.target.value)||0,p=Math.max(0,Math.min(59,m));a(l,n,p)}}},Lc=t=>b.useMemo(()=>{const s=parseFloat(t.entryPrice?.toString()||"0"),r=parseFloat(t.quantity?.toString()||"0"),l=parseFloat(t.tickSize?.toString()||"0"),n=parseFloat(t.tickValue?.toString()||"0"),o=parseFloat(t.stopPrice?.toString()||"0"),a=parseFloat(t.marginPerContract?.toString()||"0"),c=parseFloat(t.leverage?.toString()||"0"),i=parseFloat(t.marginRate?.toString()||"0"),d=parseFloat(t.marginUsedOverride?.toString()||"0"),u=t.market==="futures"&&l>0?n/l:1,m=t.market==="futures"?s*u*r:s*r;let p=null;t.market==="futures"?p=a>0?a*r:null:d>0?p=d:c>0?p=m/c:i>0&&(p=m*(i/100));const x=o>0?Math.abs(s-o)*u*r:null,f=o>0?Math.abs(s-o):null,g=f&&l>0&&t.market==="futures"?Math.round(f/l):null,h=o>0&&(t.side==="long"&&o>=s||t.side==="short"&&o<=s);return{valuePerPoint:u,notional:m,margeUtilisee:p,risque:x,distancePoints:f,distanceTicks:g,isStopWrongSide:h}},[t.entryPrice,t.quantity,t.tickSize,t.tickValue,t.stopPrice,t.marginPerContract,t.leverage,t.marginRate,t.marginUsedOverride,t.market,t.side]),$c=t=>{const s=b.useMemo(()=>{if(t.market!=="futures"||!t.tickSize)return!1;const l=parseFloat(t.entryPrice?.toString()||"0"),n=parseFloat(t.tickSize?.toString()||"0");return l%n!==0},[t.entryPrice,t.tickSize,t.market]),r=b.useMemo(()=>{if(t.market!=="futures"||!t.tickSize||!t.stopPrice)return!1;const l=parseFloat(t.stopPrice?.toString()||"0"),n=parseFloat(t.tickSize?.toString()||"0");return l%n!==0},[t.stopPrice,t.tickSize,t.market]);return{isPriceOutOfTick:s,isStopOutOfTick:r}},Cn={NQ:{tickSize:.25,tickValue:12.5},MNQ:{tickSize:.25,tickValue:1.25},ES:{tickSize:.25,tickValue:12.5},MES:{tickSize:.25,tickValue:1.25},YM:{tickSize:1,tickValue:5},RTY:{tickSize:.1,tickValue:5}},Ic=({show:t,isStopWrongSide:s})=>{const{currentTheme:r}=ee(),{currentLanguage:l}=X();return t?e.jsxs("div",{className:"mb-4 p-3 rounded-lg border-l-4",style:{backgroundColor:r.colors.warning+"10",borderLeftColor:r.colors.warning},children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Zt,{size:16,style:{color:r.colors.warning}}),e.jsx("span",{className:"font-medium",style:{color:r.colors.warning},children:s?l==="fr"?"Stop au mauvais cÃ´tÃ©":"Stop on wrong side":l==="fr"?"Prix hors tick":"Price out of tick"})]}),e.jsx("p",{className:"text-sm mt-1",style:{color:r.colors.textMuted},children:s?l==="fr"?"Le stop doit Ãªtre en dessous/au-dessus du prix d'entrÃ©e selon le sens.":"Stop must be below/above entry price depending on side.":l==="fr"?"Le prix d'entrÃ©e ou le stop ne respecte pas la taille de tick du marchÃ©.":"Entry price or stop does not respect the market tick size."})]}):null},Ol=({formData:t,onChange:s,errors:r,hideEntryDateLabel:l,hideEntryTimeLabel:n})=>{const{currentTheme:o}=ee(),{currentLanguage:a}=X(),[c,i]=b.useState(null),{hours:d,minutes:u,seconds:m,updateTime:p,handleHoursChange:x,handleMinutesChange:f,handleSecondsChange:g}=zl(t.entryTime,s);return b.useEffect(()=>{const h=y=>{y.target.closest(".time-dropdown-container")||i(null)};return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[]),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[!l&&e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:o.colors.textSecondary},children:[a==="fr"?"Date d'entrÃ©e":"Entry Date"," *"]}),e.jsx("div",{className:"relative",children:e.jsx(gs,{id:"entry-date-input",name:"entryDate",value:t.entryDate||"",onChange:h=>{s("entryDate",h),(t.entryTime||"").toString().trim()||s("entryTime","00:00:00")},placeholder:a==="fr"?"jj/mm/aaaa":"mm/dd/yyyy",title:a==="fr"?"Alt+D pour focus, T pour aujourd'hui":"Alt+D for focus, T for today",className:"w-full",size:"compact"})}),r.entryDate&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:o.colors.danger},children:r.entryDate})]}),e.jsxs("div",{children:[!n&&e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:o.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx($e,{size:16,className:"mr-2"}),a==="fr"?"Heure d'entrÃ©e":"Entry Time"]})}),e.jsxs("div",{className:"time-dropdown-container flex space-x-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:d.toString().padStart(2,"0"),onChange:x,onClick:()=>i(c==="hours"?null:"hours"),className:"w-full px-3 py-2 border rounded-lg text-center focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:o.colors.surface,borderColor:r.entryTime?o.colors.danger:o.colors.border,color:o.colors.text},name:"entryTime"}),d>0&&e.jsx("button",{type:"button",onClick:()=>p(0,u,m),className:"absolute right-1 top-1 px-1.5 py-0.5 text-[11px] rounded border",style:{backgroundColor:o.colors.surface,color:o.colors.text,borderColor:o.colors.border},title:a==="fr"?"RÃ©initialiser heures":"Reset hours",children:"âœ•"}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:o.colors.textMuted},children:a==="fr"?"Heures":"Hours"}),c==="hours"&&e.jsx("div",{className:"absolute z-10 mt-1 w-full theme-surface border theme-border rounded-md shadow-lg",style:{backgroundColor:o.colors.card,borderColor:o.colors.border,left:"0",maxHeight:"200px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Array.from({length:24},(h,y)=>e.jsx("button",{type:"button",onClick:()=>{p(y,u,m),i(null)},className:"px-2 py-2 text-sm rounded text-center transition-colors w-full",style:{backgroundColor:d===y?`${o.colors.accent}20`:o.colors.surface,color:d===y?o.colors.accent:o.colors.text,border:`1px solid ${d===y?o.colors.accent:"transparent"}`},children:y.toString().padStart(2,"0")},y))})})})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:u.toString().padStart(2,"0"),onChange:f,onClick:()=>i(c==="minutes"?null:"minutes"),className:"w-full px-3 py-2 border rounded-lg text-center focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:o.colors.surface,borderColor:r.entryTime?o.colors.danger:o.colors.border,color:o.colors.text},name:"entryTime"}),u>0&&e.jsx("button",{type:"button",onClick:()=>p(d,0,m),className:"absolute right-1 top-1 px-1.5 py-0.5 text-[11px] rounded border",style:{backgroundColor:o.colors.surface,color:o.colors.text,borderColor:o.colors.border},title:a==="fr"?"RÃ©initialiser minutes":"Reset minutes",children:"âœ•"}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:o.colors.textMuted},children:"Minutes"}),c==="minutes"&&e.jsx("div",{className:"absolute z-10 mt-1 w-full theme-surface border theme-border rounded-md shadow-lg",style:{backgroundColor:o.colors.card,borderColor:o.colors.border,left:"0",maxHeight:"200px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Array.from({length:60},(h,y)=>e.jsx("button",{type:"button",onClick:()=>{p(d,y,m),i(null)},className:"px-2 py-2 text-sm rounded text-center transition-colors w-full",style:{backgroundColor:u===y?`${o.colors.accent}20`:o.colors.surface,color:u===y?o.colors.accent:o.colors.text,border:`1px solid ${u===y?o.colors.accent:"transparent"}`},children:y.toString().padStart(2,"0")},y))})})})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:m.toString().padStart(2,"0"),onChange:g,onClick:()=>i(c==="seconds"?null:"seconds"),className:"w-full px-3 py-2 border rounded-lg text-center focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:o.colors.surface,borderColor:r.entryTime?o.colors.danger:o.colors.border,color:o.colors.text},name:"entryTime"}),m>0&&e.jsx("button",{type:"button",onClick:()=>p(d,u,0),className:"absolute right-1 top-1 px-1.5 py-0.5 text-[11px] rounded border",style:{backgroundColor:o.colors.surface,color:o.colors.text,borderColor:o.colors.border},title:a==="fr"?"RÃ©initialiser secondes":"Reset seconds",children:"âœ•"}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:o.colors.textMuted},children:a==="fr"?"Secondes":"Seconds"}),c==="seconds"&&e.jsx("div",{className:"absolute z-10 mt-1 w-full theme-surface border theme-border rounded-md shadow-lg",style:{backgroundColor:o.colors.card,borderColor:o.colors.border,left:"0",maxHeight:"200px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Array.from({length:60},(h,y)=>e.jsx("button",{type:"button",onClick:()=>{p(d,u,y),i(null)},className:"px-2 py-2 text-sm rounded text-center transition-colors w-full",style:{backgroundColor:m===y?`${o.colors.accent}20`:o.colors.surface,color:m===y?o.colors.accent:o.colors.text,border:`1px solid ${m===y?o.colors.accent:"transparent"}`},children:y.toString().padStart(2,"0")},y))})})})]})]}),r.entryTime&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:o.colors.danger},children:r.entryTime})]})]})})},zc=({inputValues:t,lockedFields:s,setLockedFields:r,onChange:l,handleNumericChange:n,handleNumericBlur:o,valuePerPoint:a})=>{const{currentTheme:c}=ee(),{currentLanguage:i}=X(),d=m=>{const p=Cn[m];p&&(l("tickSize",p.tickSize),l("tickValue",p.tickValue))},u=m=>{r(p=>({...p,[m]:!1}))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-md font-semibold",style:{color:c.colors.text},children:i==="fr"?"ParamÃ¨tres Futures":"Futures Parameters"}),e.jsx("div",{className:"flex space-x-2",children:Object.keys(Cn).map(m=>e.jsx("button",{onClick:()=>d(m),className:"px-2 py-1 text-xs rounded border transition-colors",style:{backgroundColor:c.colors.surface,borderColor:c.colors.border,color:c.colors.text},children:m},m))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:c.colors.textSecondary},children:["Tick Size"," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t.tickSize,onChange:m=>n("tickSize",m.target.value),onBlur:()=>o("tickSize"),placeholder:"Ex: 0.25",disabled:s.tickSize,className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all durÃ©e-200",style:{backgroundColor:s.tickSize?c.colors.surface+"80":c.colors.surface,borderColor:c.colors.border,color:c.colors.text}}),e.jsx("button",{type:"button",onClick:()=>u("tickSize"),className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:s.tickSize?e.jsx(jn,{size:14}):e.jsx(kn,{size:14})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:c.colors.textSecondary},children:[i==="fr"?"Valeur par Tick":"Tick Value"," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t.tickValue,onChange:m=>n("tickValue",m.target.value),onBlur:()=>o("tickValue"),placeholder:"Ex: 12.50",disabled:s.tickValue,className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all durÃ©e-200",style:{backgroundColor:s.tickValue?c.colors.surface+"80":c.colors.surface,borderColor:c.colors.border,color:c.colors.text}}),e.jsx("button",{type:"button",onClick:()=>u("tickValue"),className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:s.tickValue?e.jsx(jn,{size:14}):e.jsx(kn,{size:14})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-3",style:{color:c.colors.textSecondary},children:i==="fr"?"Valeur par Point":"Value per Point"}),e.jsx("input",{type:"text",value:a.toFixed(2),readOnly:!0,className:"w-full px-3 py-2 border rounded-lg shadow-sm",style:{backgroundColor:c.colors.surface+"60",borderColor:c.colors.border,color:c.colors.textMuted}})]})]})},Oc=({inputValues:t,handleNumericChange:s,handleNumericBlur:r,handleKeyDown:l,isEditMode:n=!1,fieldConfig:o,shouldShowField:a,toggleFieldVisibility:c,isObligatoryField:i,currentLanguage:d,currentTheme:u})=>{const{currentTheme:m}=ee(),{currentLanguage:p}=X(),x=u||m,f=d||p;return e.jsxs("div",{className:"space-y-4",children:[a&&a("leverage")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"block text-sm font-semibold",style:{color:x.colors.textSecondary},children:f==="fr"?"Effet de levier":"Leverage"}),n&&!i?.("leverage")&&e.jsx("button",{type:"button",onClick:()=>c&&c("leverage"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("leverage")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("leverage")?x.colors.accent:x.colors.textMuted},children:o?.hiddenFields?.includes("leverage")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),n&&i?.("leverage")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:x.colors.accent+"20",color:x.colors.accent,border:`1px solid ${x.colors.accent}40`},title:f==="fr"?"Champ obligatoire":"Required field",children:f==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t.leverage,onChange:g=>s("leverage",g.target.value),onBlur:()=>r("leverage"),onKeyDown:l,placeholder:"Ex: 10",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:x.colors.surface,borderColor:x.colors.border,color:x.colors.text}}),e.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-sm",style:{color:x.colors.textMuted},children:"x"})]})]}),a&&a("marginRate")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"block text-sm font-semibold",style:{color:x.colors.textSecondary},children:f==="fr"?"Taux de marge (%)":"Margin Rate (%)"}),n&&!i?.("marginRate")&&e.jsx("button",{type:"button",onClick:()=>c&&c("marginRate"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("marginRate")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("marginRate")?x.colors.accent:x.colors.textMuted},children:o?.hiddenFields?.includes("marginRate")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),n&&i?.("marginRate")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:x.colors.accent+"20",color:x.colors.accent,border:`1px solid ${x.colors.accent}40`},title:f==="fr"?"Champ obligatoire":"Required field",children:f==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t.marginRate,onChange:g=>s("marginRate",g.target.value),onBlur:()=>r("marginRate"),onKeyDown:l,placeholder:"Ex: 5",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:x.colors.surface,borderColor:x.colors.border,color:x.colors.text}}),e.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-sm",style:{color:x.colors.textMuted},children:"%"})]})]}),a&&a("marginUsedOverride")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"block text-sm font-semibold",style:{color:x.colors.textSecondary},children:f==="fr"?"Marge utilisÃ©e (override)":"Margin Used (Override)"}),n&&!i?.("marginUsedOverride")&&e.jsx("button",{type:"button",onClick:()=>c&&c("marginUsedOverride"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("marginUsedOverride")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("marginUsedOverride")?x.colors.accent:x.colors.textMuted},children:o?.hiddenFields?.includes("marginUsedOverride")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),n&&i?.("marginUsedOverride")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:x.colors.accent+"20",color:x.colors.accent,border:`1px solid ${x.colors.accent}40`},title:f==="fr"?"Champ obligatoire":"Required field",children:f==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t.marginUsedOverride,onChange:g=>s("marginUsedOverride",g.target.value),onBlur:()=>r("marginUsedOverride"),onKeyDown:l,placeholder:"Ex: 500.00",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:x.colors.surface,borderColor:x.colors.border,color:x.colors.text}}),e.jsx(Ke,{size:16,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:x.colors.textMuted}})]}),e.jsx("p",{className:"text-xs mt-1",style:{color:x.colors.textMuted},children:f==="fr"?"Optionnel: remplace le calcul automatique":"Optional: overrides automatic calculation"})]})]})},qc=({formData:t,onChange:s,errors:r,settings:l,isEditMode:n=!1,fieldConfig:o,shouldShowField:a,toggleFieldVisibility:c,isObligatoryField:i})=>{const{currentTheme:d}=ee(),{currentLanguage:u}=X(),[m,p]=b.useState({entryPrice:t.entryPrice?.toString()||"",quantity:t.quantity?.toString()||"",tickSize:t.tickSize?.toString()||"",tickValue:t.tickValue?.toString()||"",stopPrice:t.stopPrice?.toString()||"",takeProfitPrice:t.takeProfitPrice?.toString()||"",marginPerContract:t.marginPerContract?.toString()||"",leverage:t.leverage?.toString()||"",marginRate:t.marginRate?.toString()||"",marginUsedOverride:t.marginUsedOverride?.toString()||""}),[x,f]=b.useState({tickSize:!1,tickValue:!1}),[g,h]=b.useState(null);zl(t.entryTime,s);const y=Lc(t),{isPriceOutOfTick:j,isStopOutOfTick:v}=$c(t),N=(M,C)=>{const R=C.replace(",",".");p(D=>({...D,[M]:R}));const P=parseFloat(R);isNaN(P)||s(M,P)},S=M=>{const C=parseFloat(m[M]);if(!isNaN(C))s(M,C);else{const R=t[M];p(P=>({...P,[M]:R?.toString()||""}))}},w=M=>{const C=["Backspace","Delete","Tab","Escape","Enter","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"],R=/[0-9]/.test(M.key),P=M.key==="."||M.key===",",D=C.includes(M.key);!R&&!P&&!D&&M.preventDefault()},k=()=>{switch(t.market){case"futures":return u==="fr"?"Contrats":"Contracts";case"stocks":return u==="fr"?"Actions":"Shares";case"crypto":return u==="fr"?"UnitÃ©s":"Units";case"forex":return"Lots";default:return u==="fr"?"UnitÃ©s":"Units"}};return e.jsxs("div",{className:"h-full flex flex-col animate-fadeIn",children:[e.jsx(Ic,{show:j||v||y.isStopWrongSide,isStopWrongSide:!!y.isStopWrongSide}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-2 gap-10",children:[e.jsxs("div",{className:"flex flex-col space-y-6",children:[e.jsx(Ol,{formData:t,onChange:s,errors:r}),a&&a("entryPrice")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"block text-sm font-semibold",style:{color:d.colors.textSecondary},children:[u==="fr"?"Prix d'entrÃ©e":"Entry Price",(localStorage.getItem("trade-modal-pnl-input-mode")||"detailed")==="detailed"?" *":" (optionnel)"]}),n&&!i?.("entryPrice")&&e.jsx("button",{type:"button",onClick:()=>c&&c("entryPrice"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("entryPrice")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("entryPrice")?d.colors.warning:d.colors.textMuted},children:o?.hiddenFields?.includes("entryPrice")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),n&&i?.("entryPrice")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:d.colors.accent+"20",color:d.colors.accent,border:`1px solid ${d.colors.accent}40`},title:u==="fr"?"Champ obligatoire":"Required field",children:u==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:m.entryPrice,onChange:M=>N("entryPrice",M.target.value),onBlur:()=>S("entryPrice"),onKeyDown:w,placeholder:"Ex: 4250.50",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:d.colors.surface,borderColor:r.entryPrice?d.colors.danger:d.colors.border,color:d.colors.text},name:"entryPrice"}),e.jsx(Ke,{size:16,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:d.colors.textMuted}})]}),r.entryPrice&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:d.colors.danger},children:r.entryPrice}),(localStorage.getItem("trade-modal-pnl-input-mode")||"detailed")==="direct"&&e.jsx("p",{className:"mt-2 text-xs",style:{color:d.colors.textMuted},children:u==="fr"?"Optionnel en mode P&L direct - calculÃ© automatiquement si possible":"Optional in direct P&L mode - calculated automatically if possible"})]}),a&&a("quantity")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"block text-sm font-semibold",style:{color:d.colors.textSecondary},children:[u==="fr"?"Taille":"Size"," *"]}),n&&!i?.("quantity")&&e.jsx("button",{type:"button",onClick:()=>c&&c("quantity"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("quantity")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("quantity")?d.colors.warning:d.colors.textMuted},children:o?.hiddenFields?.includes("quantity")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),n&&i?.("quantity")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:d.colors.accent+"20",color:d.colors.accent,border:`1px solid ${d.colors.accent}40`},title:u==="fr"?"Champ obligatoire":"Required field",children:u==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",value:m.quantity,onChange:M=>N("quantity",M.target.value),onBlur:()=>S("quantity"),onKeyDown:w,placeholder:"Ex: 1",className:"w-full px-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:d.colors.surface,borderColor:r.quantity?d.colors.danger:d.colors.border,color:d.colors.text}}),r.quantity&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:d.colors.danger},children:r.quantity})]}),e.jsx("div",{children:e.jsx("div",{className:"w-full px-3 py-2 border rounded-lg shadow-sm flex items-center justify-center",style:{backgroundColor:d.colors.surface+"60",borderColor:d.colors.border,color:d.colors.textMuted},children:k()})})]})]}),t.market==="futures"&&e.jsx(zc,{inputValues:{tickSize:m.tickSize,tickValue:m.tickValue},lockedFields:x,setLockedFields:f,onChange:s,handleNumericChange:N,handleNumericBlur:S,valuePerPoint:y.valuePerPoint})]}),e.jsxs("div",{className:"flex flex-col space-y-6",children:[a&&(a("stopPrice")||a("takeProfitPrice"))&&e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a&&a("stopPrice")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-semibold",style:{color:d.colors.textSecondary},children:u==="fr"?"Stop prÃ©vu":"Planned Stop"}),n&&!i?.("stopPrice")&&e.jsx("button",{type:"button",onClick:()=>c&&c("stopPrice"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("stopPrice")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("stopPrice")?d.colors.warning:d.colors.textMuted},children:o?.hiddenFields?.includes("stopPrice")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),n&&i?.("stopPrice")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:d.colors.accent+"20",color:d.colors.accent,border:`1px solid ${d.colors.accent}40`},title:u==="fr"?"Champ obligatoire":"Required field",children:u==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:m.stopPrice,onChange:M=>N("stopPrice",M.target.value),onBlur:()=>S("stopPrice"),placeholder:"Ex: 4200.00",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.text}}),e.jsx(Me,{size:16,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:d.colors.textMuted}})]})]}),a&&a("takeProfitPrice")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-semibold",style:{color:d.colors.textSecondary},children:u==="fr"?"Take Profit prÃ©vu":"Planned Take Profit"}),n&&!i?.("takeProfitPrice")&&e.jsx("button",{type:"button",onClick:()=>c&&c("takeProfitPrice"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("takeProfitPrice")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("takeProfitPrice")?d.colors.warning:d.colors.textMuted},children:o?.hiddenFields?.includes("takeProfitPrice")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),n&&i?.("takeProfitPrice")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:d.colors.accent+"20",color:d.colors.accent,border:`1px solid ${d.colors.accent}40`},title:u==="fr"?"Champ obligatoire":"Required field",children:u==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:m.takeProfitPrice,onChange:M=>N("takeProfitPrice",M.target.value),onBlur:()=>S("takeProfitPrice"),placeholder:"Ex: 4300.00",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.text}}),e.jsx(Ee,{size:16,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:d.colors.textMuted}})]})]})]})}),t.market==="futures"?a&&a("marginPerContract")?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-semibold",style:{color:d.colors.textSecondary},children:u==="fr"?"Marge par contrat":"Margin per Contract"}),n&&!i?.("marginPerContract")&&e.jsx("button",{type:"button",onClick:()=>c&&c("marginPerContract"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("marginPerContract")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("marginPerContract")?d.colors.warning:d.colors.textMuted},children:o?.hiddenFields?.includes("marginPerContract")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),n&&i?.("marginPerContract")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:d.colors.accent+"20",color:d.colors.accent,border:`1px solid ${d.colors.accent}40`},title:u==="fr"?"Champ obligatoire":"Required field",children:u==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:m.marginPerContract,onChange:M=>N("marginPerContract",M.target.value),onBlur:()=>S("marginPerContract"),onKeyDown:w,placeholder:"Ex: 1000.00",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.text}}),e.jsx(Ke,{size:16,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:d.colors.textMuted}})]})]}):null:a&&(a("leverage")||a("marginRate")||a("marginUsedOverride"))?e.jsx(Oc,{inputValues:{leverage:m.leverage,marginRate:m.marginRate,marginUsedOverride:m.marginUsedOverride},handleNumericChange:N,handleNumericBlur:S,handleKeyDown:w,isEditMode:n,fieldConfig:o,shouldShowField:a,toggleFieldVisibility:c,isObligatoryField:i,currentLanguage:u,currentTheme:d}):null]})]})]})},Uc=({show:t,currentTheme:s,currentLanguage:r})=>t?e.jsxs("div",{className:"mb-4 p-3 rounded-lg border-l-4",style:{backgroundColor:s.colors.warning+"10",borderLeftColor:s.colors.warning},children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Zt,{size:16,style:{color:s.colors.warning}}),e.jsx("span",{className:"font-medium",style:{color:s.colors.warning},children:r==="fr"?"Prix de sortie hors tick":"Exit price out of tick"})]}),e.jsx("p",{className:"text-sm mt-1",style:{color:s.colors.textMuted},children:r==="fr"?"Le prix de sortie ne respecte pas la taille de tick du marchÃ©.":"Exit price does not respect the market tick size."})]}):null,Zo=({currentTheme:t,currentLanguage:s,errors:r,hours:l,minutes:n,seconds:o,active:a,setActive:c,updateTime:i,hideExitTimeLabel:d})=>e.jsxs("div",{children:[!d&&e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:t.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx($e,{size:16,className:"mr-2"}),s==="fr"?"Heure de sortie":"Exit Time"]})}),e.jsxs("div",{className:"time-dropdown-container flex space-x-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:l.toString().padStart(2,"0"),onChange:u=>i(Math.max(0,Math.min(23,parseInt(u.target.value)||0)),n,o),onClick:()=>c(a==="hours"?null:"hours"),className:"w-full px-3 py-2 border rounded-lg text-center focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:t.colors.surface,borderColor:r.exitTime?t.colors.danger:t.colors.border,color:t.colors.text}}),l>0&&e.jsx("button",{type:"button",onClick:()=>i(0,n,o),className:"absolute right-1 top-1 px-1.5 py-0.5 text-[11px] rounded border",style:{backgroundColor:t.colors.surface,color:t.colors.text,borderColor:t.colors.border},title:s==="fr"?"RÃ©initialiser heures":"Reset hours",children:"âœ•"}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:t.colors.textMuted},children:s==="fr"?"Heures":"Hours"}),a==="hours"&&e.jsx("div",{className:"absolute z-10 mt-1 w-full theme-surface border theme-border rounded-md shadow-lg",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,left:"0",maxHeight:"200px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Array.from({length:24},(u,m)=>e.jsx("button",{type:"button",onClick:()=>{i(m,n,o),c(null)},className:"px-2 py-2 text-sm rounded text-center transition-colors w-full",style:{backgroundColor:l===m?`${t.colors.accent}20`:t.colors.surface,color:l===m?t.colors.accent:t.colors.text,border:`1px solid ${l===m?t.colors.accent:"transparent"}`},children:m.toString().padStart(2,"0")},m))})})})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:n.toString().padStart(2,"0"),onChange:u=>i(l,Math.max(0,Math.min(59,parseInt(u.target.value)||0)),o),onClick:()=>c(a==="minutes"?null:"minutes"),className:"w-full px-3 py-2 border rounded-lg text-center focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:t.colors.surface,borderColor:r.exitTime?t.colors.danger:t.colors.border,color:t.colors.text}}),n>0&&e.jsx("button",{type:"button",onClick:()=>i(l,0,o),className:"absolute right-1 top-1 px-1.5 py-0.5 text-[11px] rounded border",style:{backgroundColor:t.colors.surface,color:t.colors.text,borderColor:t.colors.border},title:s==="fr"?"RÃ©initialiser minutes":"Reset minutes",children:"âœ•"}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:t.colors.textMuted},children:"Minutes"}),a==="minutes"&&e.jsx("div",{className:"absolute z-10 mt-1 w-full theme-surface border theme-border rounded-md shadow-lg",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,left:"0",maxHeight:"200px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Array.from({length:60},(u,m)=>e.jsx("button",{type:"button",onClick:()=>{i(l,m,o),c(null)},className:"px-2 py-2 text-sm rounded text-center transition-colors w-full",style:{backgroundColor:n===m?`${t.colors.accent}20`:t.colors.surface,color:n===m?t.colors.accent:t.colors.text,border:`1px solid ${n===m?t.colors.accent:"transparent"}`},children:m.toString().padStart(2,"0")},m))})})})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:o.toString().padStart(2,"0"),onChange:u=>i(l,n,Math.max(0,Math.min(59,parseInt(u.target.value)||0))),onClick:()=>c(a==="seconds"?null:"seconds"),className:"w-full px-3 py-2 border rounded-lg text-center focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:t.colors.surface,borderColor:r.exitTime?t.colors.danger:t.colors.border,color:t.colors.text}}),o>0&&e.jsx("button",{type:"button",onClick:()=>i(l,n,0),className:"absolute right-1 top-1 px-1.5 py-0.5 text-[11px] rounded border",style:{backgroundColor:t.colors.surface,color:t.colors.text,borderColor:t.colors.border},title:s==="fr"?"RÃ©initialiser secondes":"Reset seconds",children:"âœ•"}),e.jsx("p",{className:"text-xs mt-1 text-center",style:{color:t.colors.textMuted},children:s==="fr"?"Secondes":"Seconds"}),a==="seconds"&&e.jsx("div",{className:"absolute z-10 mt-1 w-full theme-surface border theme-border rounded-md shadow-lg",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,left:"0",maxHeight:"200px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Array.from({length:60},(u,m)=>e.jsx("button",{type:"button",onClick:()=>{i(l,n,m),c(null)},className:"px-2 py-2 text-sm rounded text-center transition-colors w-full",style:{backgroundColor:o===m?`${t.colors.accent}20`:t.colors.surface,color:o===m?t.colors.accent:t.colors.text,border:`1px solid ${o===m?t.colors.accent:"transparent"}`},children:m.toString().padStart(2,"0")},m))})})})]})]}),r.exitTime&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:t.colors.danger},children:r.exitTime})]}),ql=({currentTheme:t,currentLanguage:s,pnlBrut:r,totalFees:l,pnlNet:n,accountPercentage:o,formatCurrency:a})=>e.jsxs("div",{className:"p-6 rounded-lg border",style:{backgroundColor:t.colors.card,borderColor:t.colors.border},children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Wo,{size:20,className:"mr-2",style:{color:t.colors.accent}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:t.colors.text},children:s==="fr"?"RÃ©sumÃ© P&L":"P&L Summary"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ee,{size:16,className:"mr-2",style:{color:r&&r>=0?t.colors.success:t.colors.danger}}),e.jsx("span",{style:{color:t.colors.textSecondary},children:s==="fr"?"P&L Brut (avant frais)":"Gross P&L (before fees)"})]}),e.jsx("span",{className:"font-bold",style:{color:r&&r>=0?t.colors.success:t.colors.danger},children:r!==null?(r>=0?"+":"")+a(r):"--"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ke,{size:16,className:"mr-2",style:{color:t.colors.warning}}),e.jsx("span",{style:{color:t.colors.textSecondary},children:s==="fr"?"Frais Totaux":"Total Fees"})]}),e.jsxs("span",{className:"font-bold",style:{color:t.colors.warning},children:[l>=0?"+":"",a(l)]})]}),e.jsx("div",{className:"border-t my-2",style:{borderColor:t.colors.border}}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ot,{size:16,className:"mr-2",style:{color:n&&n>=0?t.colors.success:t.colors.danger}}),e.jsx("span",{className:"font-medium",style:{color:t.colors.text},children:s==="fr"?"P&L Net (aprÃ¨s frais)":"Net P&L (after fees)"})]}),e.jsx("span",{className:"text-lg font-bold",style:{color:n&&n>=0?t.colors.success:t.colors.danger},children:n!==null?(n>=0?"+":"")+a(n):"--"})]}),o!==null&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(us,{size:16,className:"mr-2",style:{color:t.colors.accent}}),e.jsx("span",{style:{color:t.colors.textSecondary},children:s==="fr"?"Pourcentage du compte":"Account Percentage"})]}),e.jsxs("span",{className:"font-bold",style:{color:o>=0?t.colors.success:t.colors.danger},children:[o>=0?"+":"",o.toFixed(2),"%"]})]})]})]}),_c=({currentTheme:t,currentLanguage:s,errors:r,values:l,onChange:n,isEditMode:o=!1,fieldConfig:a,shouldShowField:c,toggleFieldVisibility:i,isObligatoryField:d})=>{const u=m=>m==null?"":String(m);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(gi,{size:20,style:{color:t.colors.accent}}),e.jsx("h3",{className:"text-lg font-semibold",style:{color:t.colors.text},children:s==="fr"?"Frais (optionnels)":"Fees (optional)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c&&c("commission")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",style:{color:t.colors.textSecondary},children:"Commission"}),o&&!d?.("commission")&&e.jsx("button",{type:"button",onClick:()=>i&&i("commission"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:a?.hiddenFields?.includes("commission")?"Afficher":"Masquer",style:{color:a?.hiddenFields?.includes("commission")?t.colors.warning:t.colors.textMuted},children:a?.hiddenFields?.includes("commission")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),o&&d?.("commission")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:u(l.commission),onChange:m=>n("fees.commission",m.target.value),placeholder:"-2.5",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}}),e.jsx(Ke,{size:14,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:t.colors.textMuted}})]})]}),c&&c("spread_slippage")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",style:{color:t.colors.textSecondary},children:"Spread/Slippage"}),o&&!d?.("spread_slippage")&&e.jsx("button",{type:"button",onClick:()=>i&&i("spread_slippage"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:a?.hiddenFields?.includes("spread_slippage")?"Afficher":"Masquer",style:{color:a?.hiddenFields?.includes("spread_slippage")?t.colors.warning:t.colors.textMuted},children:a?.hiddenFields?.includes("spread_slippage")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),o&&d?.("spread_slippage")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:u(l.spread_slippage),onChange:m=>n("fees.spread_slippage",m.target.value),placeholder:"-1.2",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}}),e.jsx(Ke,{size:14,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:t.colors.textMuted}})]})]}),c&&c("swap_overnight")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",style:{color:t.colors.textSecondary},children:"Swap/Overnight"}),o&&!d?.("swap_overnight")&&e.jsx("button",{type:"button",onClick:()=>i&&i("swap_overnight"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:a?.hiddenFields?.includes("swap_overnight")?"Afficher":"Masquer",style:{color:a?.hiddenFields?.includes("swap_overnight")?t.colors.warning:t.colors.textMuted},children:a?.hiddenFields?.includes("swap_overnight")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),o&&d?.("swap_overnight")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:u(l.swap_overnight),onChange:m=>n("fees.swap_overnight",m.target.value),placeholder:"-0.5",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}}),e.jsx(Ke,{size:14,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:t.colors.textMuted}})]})]}),c&&c("other")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",style:{color:t.colors.textSecondary},children:s==="fr"?"Autres frais":"Other fees"}),o&&!d?.("other")&&e.jsx("button",{type:"button",onClick:()=>i&&i("other"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:a?.hiddenFields?.includes("other")?"Afficher":"Masquer",style:{color:a?.hiddenFields?.includes("other")?t.colors.warning:t.colors.textMuted},children:a?.hiddenFields?.includes("other")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),o&&d?.("other")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:u(l.other),onChange:m=>n("fees.other",m.target.value),placeholder:"-0.25",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all durÃ©e-200",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}}),e.jsx(Ke,{size:14,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:t.colors.textMuted}})]})]})]})]})},Ul=({mode:t,onModeChange:s,disabled:r=!1})=>{const{currentTheme:l}=ee(),{currentLanguage:n}=X();return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",style:{color:l.colors.textSecondary},children:n==="fr"?"Saisie :":"Input:"}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsxs("button",{onClick:()=>s("percentage"),disabled:r,className:`flex items-center space-x-1 px-3 py-1 text-sm rounded-lg border-2 transition-all duration-200 ${t==="percentage"?"border-0 shadow-md transform scale-105":"hover:shadow-sm"} ${r?"opacity-50 cursor-not-allowed":""}`,style:{backgroundColor:t==="percentage"?l.colors.accent:l.colors.surface,color:t==="percentage"?"#ffffff":l.colors.text,borderColor:t==="percentage"?"transparent":l.colors.border},children:[e.jsx(us,{size:14}),e.jsx("span",{children:"%"})]}),e.jsxs("button",{onClick:()=>s("absolute"),disabled:r,className:`flex items-center space-x-1 px-3 py-1 text-sm rounded-lg border-2 transition-all duration-200 ${t==="absolute"?"border-0 shadow-md transform scale-105":"hover:shadow-sm"} ${r?"opacity-50 cursor-not-allowed":""}`,style:{backgroundColor:t==="absolute"?l.colors.accent:l.colors.surface,color:t==="absolute"?"#ffffff":l.colors.text,borderColor:t==="absolute"?"transparent":l.colors.border},children:[e.jsx(rr,{size:14}),e.jsx("span",{children:"P&L"})]})]})]})},Wc=({formData:t,onChange:s,errors:r,settings:l,isEditMode:n=!1,fieldConfig:o,shouldShowField:a,toggleFieldVisibility:c,isObligatoryField:i})=>{const{currentTheme:d}=ee(),{currentLanguage:u}=X(),m=localStorage.getItem("trade-modal-pnl-input-mode")||"detailed",[p,x]=b.useState("percentage"),[f,g]=b.useState({exitPrice:t.exitPrice?.toString()||"",commission:t.fees?.commission!==void 0?t.fees.commission.toString():"",spreadSlippage:t.fees?.spread_slippage!==void 0?t.fees.spread_slippage.toString():"",swapOvernight:t.fees?.swap_overnight!==void 0?t.fees.swap_overnight.toString():"",other:t.fees?.other!==void 0?t.fees.other.toString():""}),[h,y]=b.useState(null),j=t.exitTime?t.exitTime.split(":").map(Number):[0,0,0],[v=0,N=0,S=0]=j,w=(F,q,W)=>{const I=F.toString().padStart(2,"0"),$=q.toString().padStart(2,"0"),V=W.toString().padStart(2,"0");s("exitTime",`${I}:${$}:${V}`)};b.useEffect(()=>{const F=q=>{q.target.closest(".time-dropdown-container")||y(null)};return document.addEventListener("mousedown",F),()=>document.removeEventListener("mousedown",F)},[]);const k=(F,q)=>{const W=q.replace(",",".");if(g(I=>({...I,[F]:W})),F.startsWith("fees.")){const I=F.split(".")[1],$={...t.fees||{}};$[I]=W,s("fees",$)}else s(F,W)},M=F=>{if(F==null||F==="")return 0;if(typeof F=="number")return F;const q=String(F).replace(",","."),W=parseFloat(q);return isNaN(W)?0:W},C=F=>{},R=F=>{},P=b.useMemo(()=>{const F=parseFloat(t.entryPrice?.toString()||"0"),q=parseFloat(t.exitPrice?.toString()||"0"),W=parseFloat(t.quantity?.toString()||"0"),I=parseFloat(t.tickSize?.toString()||"0"),$=parseFloat(t.tickValue?.toString()||"0"),V=t.side==="long"?1:-1,K=t.market==="futures"&&I>0?$/I:1;let ne=null;if(t.entryDate&&t.entryTime&&t.exitDate&&t.exitTime){const Te=new Date(`${t.entryDate}T${t.entryTime}`),re=new Date(`${t.exitDate}T${t.exitTime}`).getTime()-Te.getTime();if(re>0){const H=Math.floor(re/36e5),Q=Math.floor(re%(1e3*60*60)/(1e3*60)),fe=Math.floor(re%(1e3*60)/1e3);ne={hours:H,minutes:Q,seconds:fe}}}let ue=null;F>0&&q>0&&W>0&&(t.market==="futures"?ue=(q-F)*K*W*V:ue=(q-F)*W*V);const le=t.fees||{},je=M(le.commission),ye=M(le.spread_slippage),ve=M(le.swap_overnight),se=M(le.other),Y=je+ye+ve+se;let te=null;ue!==null&&(te=ue+Y);let G=null;te!==null&&l?.equity&&l.equity>0&&(G=te/l.equity*100);let he=null,we=null;t.market==="futures"&&F>0&&q>0&&(he=(q-F)*V,I>0&&(we=he/I));const Ie=t.market==="futures"&&I>0&&q>0&&Math.abs(q%I)>1e-9;return{duration:ne,pnlBrut:ue,totalFees:Y,pnlNet:te,accountPercentage:G,movePoints:he,moveTicks:we,isExitPriceOutOfTick:Ie}},[t.entryDate,t.entryTime,t.exitDate,t.exitTime,t.entryPrice,t.exitPrice,t.quantity,t.tickSize,t.tickValue,t.market,t.side,t.fees,l?.equity]),{duration:D,pnlBrut:T,totalFees:E,pnlNet:L,accountPercentage:U,movePoints:_,moveTicks:B,isExitPriceOutOfTick:z}=P,A=F=>new Intl.NumberFormat(u==="fr"?"fr-FR":"en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(F);return t.status!=="closed"?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center",children:[e.jsx($e,{size:48,style:{color:d.colors.textMuted},className:"mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:d.colors.text},children:u==="fr"?"Trade en cours":"Trade in progress"}),e.jsx("p",{className:"text-sm",style:{color:d.colors.textMuted},children:u==="fr"?"Cette Ã©tape n'est disponible que pour les trades fermÃ©s.":"This step is only available for closed trades."})]}):e.jsxs("div",{className:"h-full flex flex-col animate-fadeIn",children:[e.jsx(Uc,{show:!!P.isExitPriceOutOfTick,currentTheme:d,currentLanguage:u}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-2 gap-10",children:[e.jsxs("div",{className:"flex flex-col space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:d.colors.textSecondary},children:[u==="fr"?"Date de sortie":"Exit Date"," *"]}),e.jsx("div",{className:"relative",children:e.jsx(gs,{id:"exit-date-input",name:"exitDate",value:t.exitDate||"",onChange:F=>s("exitDate",F),placeholder:u==="fr"?"jj/mm/aaaa":"mm/dd/yyyy",title:u==="fr"?"Alt+D pour focus, T pour aujourd'hui":"Alt+D for focus, T for today",className:"w-full",size:"compact"})}),r.exitDate&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:d.colors.danger},children:r.exitDate})]}),e.jsx(Zo,{currentTheme:d,currentLanguage:u,errors:r,hours:v,minutes:N,seconds:S,active:h,setActive:y,updateTime:w})]})}),m==="detailed"?e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:d.colors.textSecondary},children:[u==="fr"?"Prix de sortie":"Exit Price"," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:f.exitPrice,onChange:F=>k("exitPrice",F.target.value),onBlur:()=>C(),onKeyDown:R,placeholder:"Ex: 4250.50",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:d.colors.surface,borderColor:r.exitPrice?d.colors.danger:d.colors.border,color:d.colors.text},name:"exitPrice"}),e.jsx(Ke,{size:16,className:"absolute right-3 top-1/2 transform -translate-y-1/2",style:{color:d.colors.textMuted}})]}),r.exitPrice&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:d.colors.danger},children:r.exitPrice})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"block text-sm font-semibold",style:{color:d.colors.textSecondary},children:["P&L"," *"]}),e.jsx(Ul,{mode:p,onModeChange:x})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:p==="percentage"?t.pnlPercentage?.toString()||"":t.pnl?.toString()||"",onChange:F=>{const q=parseFloat(F.target.value)||0;s(p==="percentage"?"pnlPercentage":"pnl",q)},placeholder:p==="percentage"?"Ex: 2.5":"Ex: 250",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:d.colors.surface,borderColor:r.pnl?d.colors.danger:d.colors.border,color:d.colors.text},name:p==="percentage"?"pnlPercentage":"pnl"}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:p==="percentage"?e.jsx(us,{size:16,style:{color:d.colors.textMuted}}):e.jsx(rr,{size:16,style:{color:d.colors.textMuted}})})]}),e.jsx("p",{className:"text-xs",style:{color:d.colors.textMuted},children:u==="fr"?"Prix d'entrÃ©e et sortie optionnels - calculÃ©s automatiquement si possible":"Entry and exit prices optional - calculated automatically if possible"})]}),a&&(a("commission")||a("spread_slippage")||a("swap_overnight")||a("other"))&&e.jsx(_c,{currentTheme:d,currentLanguage:u,errors:r,values:{commission:t.fees?.commission,spread_slippage:t.fees?.spread_slippage,swap_overnight:t.fees?.swap_overnight,other:t.fees?.other},onChange:(F,q)=>k(F,q),isEditMode:n,fieldConfig:o,shouldShowField:a,toggleFieldVisibility:c,isObligatoryField:i})]}),e.jsx("div",{className:"flex flex-col space-y-6",children:e.jsx(ql,{currentTheme:d,currentLanguage:u,pnlBrut:T,totalFees:E,pnlNet:L,accountPercentage:U,formatCurrency:A})})]})]})},Vc=["Cassure","Rebond","Divergence","Support/RÃ©sistance","Tendance","Range","Momentum","Retournement","Double Top","Double Bottom","Triple Top","Triple Bottom","Head & Shoulders","Inverse H&S","Bull Flag","Bear Flag","Triangle Ascendant","Triangle Descendant","Triangle SymÃ©trique","Wedge","Faux Breakout","Pullback"],Bc=["Breakout Trading","Scalping","Momentum","Reversal Trading","Range Trading","Trend Following","Support/Resistance","Mean Reversion","Gap Trading","News Trading","Order Flow","Pullback Trading"];function _l(t,s){const r=[...Vc];return s.forEach(l=>{r.includes(l)||r.push(l)}),t?r.filter(l=>l.toLowerCase().includes(t.toLowerCase())):r}function Wl(t,s=5){const r=[],l=new Set;for(const n of t)!l.has(n)&&r.length<s&&(l.add(n),r.push(n));return r}function Hc(t,s){const r=[...Bc];return s.forEach(l=>{r.includes(l)||r.push(l)}),t?r.filter(l=>l.toLowerCase().includes(t.toLowerCase())):r}const Eo=({currentTheme:t,currentLanguage:s,value:r,onChange:l,isEditMode:n=!1,fieldConfig:o,toggleFieldVisibility:a,isObligatoryField:c,hideLabel:i})=>{const d=[{key:"tp",label:"TP",color:"success"},{key:"be",label:"BE",color:"warning"},{key:"sl",label:"SL",color:"danger"}];return e.jsxs("div",{children:[(!i||n)&&e.jsxs("div",{className:`flex items-center justify-between ${i?"mb-1":"mb-3"}`,children:[!i&&e.jsx("label",{className:"block text-sm font-semibold",style:{color:t.colors.textSecondary},children:s==="fr"?"RÃ©sultat du trade":"Trade Result"}),n&&!c?.("tradeResult")&&e.jsx("button",{type:"button",onClick:()=>a&&a("tradeResult"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("tradeResult")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("tradeResult")?t.colors.warning:t.colors.textMuted},children:o?.hiddenFields?.includes("tradeResult")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),n&&c?.("tradeResult")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"})]}),e.jsx("div",{className:"flex items-center space-x-4",children:d.map(u=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-1 rounded transition-all duration-200 hover:bg-opacity-10",onClick:()=>l(r===u.key?"":u.key),style:{backgroundColor:r===u.key?`${t.colors[u.color]}10`:"transparent"},children:[e.jsx("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all duration-200 hover:scale-110",style:{backgroundColor:r===u.key?t.colors[u.color]:t.colors.surface,borderColor:r===u.key?t.colors[u.color]:t.colors.border},children:r===u.key&&e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.colors.surface}})}),e.jsx("span",{className:"text-sm font-medium",style:{color:t.colors.text},children:u.label})]},u.key))})]})},Vl=({currentTheme:t,currentLanguage:s,value:r,onChange:l,isEditMode:n=!1,fieldConfig:o,toggleFieldVisibility:a,isObligatoryField:c,hideLabel:i})=>e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center justify-between ${i?"mb-1":"mb-3"}`,children:[!i&&e.jsx("label",{className:"block text-sm font-semibold",style:{color:t.colors.textSecondary},children:s==="fr"?"Ratio R:R":"R:R Ratio"}),n&&!c?.("riskReward")&&e.jsx("button",{type:"button",onClick:()=>a&&a("riskReward"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("riskReward")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("riskReward")?t.colors.warning:t.colors.textMuted},children:o?.hiddenFields?.includes("riskReward")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),n&&c?.("riskReward")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:r?.toString()||"",onChange:d=>l(d.target.value),placeholder:"Ex: 2.5",className:"w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}}),e.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-sm font-medium",style:{color:t.colors.textMuted},children:":1"})]}),e.jsx("p",{className:"text-xs mt-1",style:{color:t.colors.textMuted},children:s==="fr"?"CalculÃ© automatiquement si SL et TP sont renseignÃ©s dans les Ã©tapes prÃ©cÃ©dentes":"Auto-calculated if SL and TP are filled in previous steps"})]}),Fo=({currentTheme:t,currentLanguage:s,value:r,onChange:l,isEditMode:n=!1,fieldConfig:o,toggleFieldVisibility:a,isObligatoryField:c,hideLabel:i})=>{const d=[{value:"bullish",label:s==="fr"?"Haussier":"Bullish",icon:Ee,color:"success"},{value:"bearish",label:s==="fr"?"Baissier":"Bearish",icon:Ot,color:"danger"},{value:"range",label:"Range",icon:kl,color:"warning"}];return e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center justify-between ${i?"mb-1":"mb-3"}`,children:[!i&&e.jsx("label",{className:"block text-sm font-semibold",style:{color:t.colors.textSecondary},children:s==="fr"?"Tendance":"Trend"}),n&&!c?.("trend")&&e.jsx("button",{type:"button",onClick:()=>a&&a("trend"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:o?.hiddenFields?.includes("trend")?"Afficher":"Masquer",style:{color:o?.hiddenFields?.includes("trend")?t.colors.warning:t.colors.textMuted},children:o?.hiddenFields?.includes("trend")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),n&&c?.("trend")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:d.map(u=>{const m=u.icon,p=r===u.value;return e.jsxs("button",{type:"button",onClick:()=>l(u.value),className:`w-full p-2 rounded-lg border-2 transition-all duration-200 flex flex-col items-center space-y-1 ${p?"ring-2":""}`,style:{backgroundColor:p?`${t.colors[u.color]}20`:t.colors.surface,borderColor:p?t.colors[u.color]:t.colors.border,color:p?t.colors[u.color]:t.colors.text,boxShadow:p?`0 0 0 2px ${t.colors[u.color]}`:"none"},children:[e.jsx(m,{size:16}),e.jsx("span",{className:"text-xs font-medium",children:u.label})]},u.value)})})]})},en=({currentTheme:t,currentLanguage:s,value:r,onChange:l,onSelect:n,filteredStrategies:o,previousStrategies:a,favoriteNames:c,error:i,showDropdown:d,setShowDropdown:u,onOpenModal:m,isEditMode:p=!1,fieldConfig:x,toggleFieldVisibility:f,isObligatoryField:g,hideLabel:h})=>e.jsxs("div",{children:[(!h||p)&&e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[!h&&e.jsx("label",{className:"block text-sm font-semibold",style:{color:t.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Me,{size:16,className:"mr-2"}),s==="fr"?"StratÃ©gie":"Strategy"]})}),p&&!g?.("strategy")&&e.jsx("button",{type:"button",onClick:()=>f&&f("strategy"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:x?.hiddenFields?.includes("strategy")?"Afficher":"Masquer",style:{color:x?.hiddenFields?.includes("strategy")?t.colors.warning:t.colors.textMuted},children:x?.hiddenFields?.includes("strategy")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),p&&g?.("strategy")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",value:r||"",onChange:y=>{l(y.target.value),d||u(!0)},onFocus:()=>u(!0),placeholder:"Ex: Scalping, Momentum...",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors shadow-sm",style:{backgroundColor:t.colors.surface,borderColor:i?t.colors.danger:t.colors.border,color:t.colors.text}}),d&&e.jsx("div",{className:"absolute z-10 mt-1 left-0 right-0 rounded-lg shadow-lg overflow-hidden",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,border:`1px solid ${t.colors.border}`,maxHeight:"150px",overflowY:"auto"},children:e.jsx("div",{className:"p-1",children:e.jsxs("div",{className:"grid grid-cols-1 gap-0.5",children:[o.slice(0,8).map(y=>e.jsx("button",{type:"button",onClick:()=>n(y),className:"px-2 py-1 text-xs rounded-lg text-left transition-colors",style:{backgroundColor:r===y?t.colors.accent+"30":t.colors.surface,color:r===y?t.colors.accent:t.colors.text,border:`1px solid ${r===y?t.colors.accent:"transparent"}`},children:y},y)),o.length>8&&e.jsx("button",{type:"button",onClick:m,className:"px-2 py-1 text-xs text-center italic",style:{color:t.colors.textMuted},children:s==="fr"?`+ ${o.length-8} autres...`:`+ ${o.length-8} more...`})]})})})]}),e.jsx("button",{type:"button",onClick:m,className:"px-3 py-2 border rounded-lg transition-all duration-200 hover:shadow-sm flex items-center",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text},title:s==="fr"?"Choisir une stratÃ©gie":"Choose a strategy",children:e.jsx(Br,{size:16})})]}),a.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-2",style:{color:t.colors.textMuted},children:s==="fr"?"RÃ©centes":"Recent"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.slice(0,5).map(y=>e.jsx("button",{onClick:()=>n(y),className:"px-3 py-1 text-xs rounded-lg border transition-all duration-200 hover:shadow-sm",style:{backgroundColor:r===y?t.colors.accent:t.colors.surface,borderColor:t.colors.border,color:r===y?"#ffffff":t.colors.text},children:y},y))})]}),c.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs mb-2",style:{color:t.colors.textMuted},children:s==="fr"?"Favoris":"Favorites"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(y=>e.jsx("button",{onClick:()=>n(y),className:"px-3 py-1 text-xs rounded-lg border transition-all duration-200 hover:shadow-sm",style:{backgroundColor:r===y?t.colors.accent:t.colors.surface,borderColor:t.colors.border,color:r===y?"#ffffff":t.colors.text},children:y},y))})]}),i&&e.jsx("p",{className:"text-xs mt-1",style:{color:t.colors.danger},children:i})]})]}),tn=({currentTheme:t,currentLanguage:s,value:r,onChange:l,search:n,setSearch:o,filteredSetups:a,quickSetups:c,error:i,showDropdown:d,setShowDropdown:u,isEditMode:m=!1,fieldConfig:p,toggleFieldVisibility:x,isObligatoryField:f,hideLabel:g})=>e.jsxs("div",{children:[(!g||m)&&e.jsxs("div",{className:`flex items-center justify-between ${g?"mb-1":"mb-3"}`,children:[!g&&e.jsx("label",{className:"block text-sm font-semibold",style:{color:t.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Me,{size:16,className:"mr-2"}),"Setup"]})}),m&&!f?.("setup")&&e.jsx("button",{type:"button",onClick:()=>x&&x("setup"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:p?.hiddenFields?.includes("setup")?"Afficher":"Masquer",style:{color:p?.hiddenFields?.includes("setup")?t.colors.warning:t.colors.textMuted},children:p?.hiddenFields?.includes("setup")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),m&&f?.("setup")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>u(!d),className:"w-full flex items-center justify-between px-3 py-2 border rounded-md focus:outline-none transition-colors",style:{backgroundColor:t.colors.surface,borderColor:i?t.colors.danger:t.colors.border,color:r?t.colors.text:t.colors.textMuted,boxShadow:"none"},children:[e.jsx("span",{children:r||(s==="fr"?"SÃ©lectionner un setup...":"Select a setup...")}),e.jsx(Le,{size:16,className:`transition-transform ${d?"rotate-180":""}`})]}),d&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md shadow-lg overflow-hidden",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,border:`1px solid ${t.colors.border}`},children:e.jsx("div",{className:"max-h-60 overflow-y-auto",children:e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("input",{type:"text",value:n,onChange:h=>{o(h.target.value),l(h.target.value)},placeholder:s==="fr"?"Rechercher ou saisir...":"Search or type...",className:"w-full px-3 py-2 pl-9 border rounded-md",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}}),e.jsx(jt,{size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2",style:{color:t.colors.textMuted}})]}),e.jsx("div",{className:"grid grid-cols-1 gap-1",children:a.map(h=>e.jsx("button",{type:"button",onClick:()=>{l(h),u(!1)},className:"px-3 py-2 text-sm rounded text-left transition-colors",style:{backgroundColor:r===h?t.colors.accent+"30":t.colors.surface,color:r===h?t.colors.accent:t.colors.text,border:`1px solid ${r===h?t.colors.accent:"transparent"}`},children:h},h))})]})})}),i&&e.jsx("p",{className:"text-xs mt-1",style:{color:t.colors.danger},children:i})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:c.slice(0,5).map(h=>e.jsx("button",{type:"button",onClick:()=>l(h),className:"px-2 py-1 text-xs rounded-lg transition-colors",style:{backgroundColor:r===h?t.colors.accent:t.colors.surface,color:r===h?"#ffffff":t.colors.text,border:`1px solid ${r===h?t.colors.accent:t.colors.border}`},children:h},h))})]}),Gc=({currentTheme:t,currentLanguage:s,value:r,error:l,newTag:n,setNewTag:o,onAdd:a,onRemove:c,showDropdown:i,setShowDropdown:d,previousTags:u,existingTrades:m,onSelectFromDropdown:p,onKeyDown:x,onCleanupUnusedTags:f,onOpenManagementModal:g,isEditMode:h=!1,fieldConfig:y,toggleFieldVisibility:j,isObligatoryField:v})=>{const[N,S]=b.useState(""),w=b.useMemo(()=>N.trim()?u.filter(R=>R.toLowerCase().includes(N.toLowerCase())):u,[u,N]),k=b.useMemo(()=>{const R=new Set;return m.forEach(P=>{P.tags&&Array.isArray(P.tags)&&P.tags.forEach(D=>R.add(D))}),u.filter(P=>!R.has(P))},[u,m]),M=R=>{p(R),S("")},C=R=>{const P=R.target.value;S(P),o(P),P.trim()&&d(!0)};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-semibold",style:{color:t.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ms,{size:16,className:"mr-2"}),"Tags"]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[h&&!v?.("tags")&&e.jsx("button",{type:"button",onClick:()=>j&&j("tags"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:y?.hiddenFields?.includes("tags")?"Afficher":"Masquer",style:{color:y?.hiddenFields?.includes("tags")?t.colors.warning:t.colors.textMuted},children:y?.hiddenFields?.includes("tags")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),h&&v?.("tags")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent,border:`1px solid ${t.colors.accent}40`},title:s==="fr"?"Champ obligatoire":"Required field",children:s==="fr"?"Obligatoire":"Required"}),g&&e.jsxs("button",{type:"button",onClick:g,className:"px-3 py-1.5 rounded-md flex items-center space-x-2 text-sm transition-colors hover:opacity-80",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,border:`1px solid ${t.colors.border}`,color:t.colors.text},title:s==="fr"?"GÃ©rer les tags":"Manage tags",children:[e.jsx(ss,{size:14}),e.jsx("span",{children:s==="fr"?"GÃ©rer":"Manage"})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:r.map(R=>e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 rounded-full",style:{backgroundColor:t.colors.accent+"20",borderColor:t.colors.accent,border:`1px solid ${t.colors.accent}40`},children:[e.jsx("span",{className:"text-sm",style:{color:t.colors.text},children:R}),e.jsx("button",{type:"button",onClick:()=>c(R),className:"rounded-full p-0.5 hover:bg-opacity-80 transition-colors",style:{backgroundColor:t.colors.accent+"30"},children:e.jsx(be,{size:12,style:{color:t.colors.text}})})]},R))}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(jt,{size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2",style:{color:t.colors.textMuted}}),e.jsx("input",{type:"text",value:n,onChange:C,onKeyDown:x,placeholder:s==="fr"?"Rechercher ou ajouter un tag...":"Search or add a tag...",className:"w-full pl-10 pr-3 py-2 border rounded-l-md focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:t.colors.surface,borderColor:l?t.colors.danger:t.colors.border,color:t.colors.text}})]}),e.jsx("button",{type:"button",onClick:()=>d(!i),className:"px-3 py-2 border-t border-r border-b rounded-r-md",style:{backgroundColor:t.colors.surface,borderColor:l?t.colors.danger:t.colors.border,color:t.colors.text},children:e.jsx(Le,{size:16,className:`transition-transform ${i?"rotate-180":""}`})})]}),i&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md shadow-lg overflow-hidden",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,border:`1px solid ${t.colors.border}`},children:e.jsx("div",{className:"max-h-60 overflow-y-auto",children:e.jsx("div",{className:"p-2",children:N.trim()?e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold mb-2 px-2 py-1 rounded",style:{backgroundColor:t.colors.surface,color:t.colors.textMuted},children:s==="fr"?"RÃ©sultats de recherche":"Search results"}),e.jsx("div",{className:"grid grid-cols-1 gap-1",children:w.length>0?w.map(R=>{const P=m.reduce((D,T)=>D+(T.tags?.filter(E=>E===R).length||0),0);return e.jsxs("button",{type:"button",onClick:()=>M(R),className:"px-3 py-2 text-sm rounded text-left transition-colors flex items-center justify-between",style:{backgroundColor:r.includes(R)?t.colors.accent+"30":t.colors.surface,color:r.includes(R)?t.colors.accent:t.colors.text,border:`1px solid ${r.includes(R)?t.colors.accent:"transparent"}`},children:[e.jsx("span",{children:R}),P>0&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent},children:P})]},R)}):e.jsx("div",{className:"px-3 py-2 text-sm text-center",style:{color:t.colors.textMuted},children:s==="fr"?"Aucun tag trouvÃ©":"No tags found"})})]}):e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold mb-2 px-2 py-1 rounded",style:{backgroundColor:t.colors.surface,color:t.colors.textMuted},children:s==="fr"?"Tags existants":"Existing tags"}),e.jsx("div",{className:"grid grid-cols-1 gap-1",children:u.map(R=>{const P=m.reduce((D,T)=>D+(T.tags?.filter(E=>E===R).length||0),0);return e.jsxs("button",{type:"button",onClick:()=>M(R),className:"px-3 py-2 text-sm rounded text-left transition-colors flex items-center justify-between",style:{backgroundColor:r.includes(R)?t.colors.accent+"30":t.colors.surface,color:r.includes(R)?t.colors.accent:t.colors.text,border:`1px solid ${r.includes(R)?t.colors.accent:"transparent"}`},children:[e.jsx("span",{children:R}),P>0&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent},children:P})]},R)})})]})})})})]}),e.jsx("button",{type:"button",onClick:a,className:"px-3 py-2 rounded-md transition-colors",style:{backgroundColor:t.colors.accent,color:"#ffffff"},children:"+"})]}),k.length>0&&f&&e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-md",style:{backgroundColor:t.colors.surface+"50",border:`1px solid ${t.colors.border}`},children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(es,{size:14,style:{color:t.colors.textMuted}}),e.jsx("span",{className:"text-sm",style:{color:t.colors.textMuted},children:s==="fr"?`${k.length} tag(s) non utilisÃ©(s)`:`${k.length} unused tag(s)`})]}),e.jsx("button",{type:"button",onClick:f,className:"px-2 py-1 text-xs rounded transition-colors hover:opacity-80",style:{backgroundColor:t.colors.danger+"20",color:t.colors.danger},children:s==="fr"?"Nettoyer":"Clean up"})]})]})]})},Bl=({isOpen:t,onClose:s,currentTheme:r,currentLanguage:l,allTags:n,existingTrades:o,onDeleteTag:a,onRenameTag:c,onCleanupUnusedTags:i})=>{const[d,u]=b.useState(""),[m,p]=b.useState(null),[x,f]=b.useState(""),g=b.useMemo(()=>{const k=new Map;return n.forEach(M=>{let C=0,R=null;o.forEach(P=>{if(P.tags&&P.tags.includes(M)){C++;const D=new Date(P.date||P.entryDate);(!R||D>R)&&(R=D)}}),k.set(M,{count:C,lastUsed:R})}),k},[n,o]),h=b.useMemo(()=>d.trim()?n.filter(k=>k.toLowerCase().includes(d.toLowerCase())):n,[n,d]),y=b.useMemo(()=>[...h].sort((k,M)=>{const C=g.get(k)||{count:0};return(g.get(M)||{count:0}).count-C.count}),[h,g]),j=b.useMemo(()=>n.filter(k=>{const M=g.get(k);return!M||M.count===0}),[n,g]),v=k=>{p(k),f(k)},N=()=>{m&&x.trim()&&x!==m&&c(m,x.trim()),p(null),f("")},S=()=>{p(null),f("")},w=k=>{if(!k)return l==="fr"?"Jamais":"Never";const C=Math.floor((new Date().getTime()-k.getTime())/(1e3*60*60*24));return C===0?l==="fr"?"Aujourd'hui":"Today":C===1?l==="fr"?"Hier":"Yesterday":C<7?l==="fr"?`Il y a ${C} jours`:`${C} days ago`:C<30?l==="fr"?`Il y a ${Math.floor(C/7)} semaines`:`${Math.floor(C/7)} weeks ago`:l==="fr"?`Il y a ${Math.floor(C/30)} mois`:`${Math.floor(C/30)} months ago`};return t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},children:e.jsxs("div",{className:"w-full max-w-3xl max-h-[90vh] rounded-lg shadow-2xl flex flex-col",style:{backgroundColor:r.colors.card},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",style:{borderColor:r.colors.border},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ms,{size:24,style:{color:r.colors.accent}}),e.jsx("h2",{className:"text-2xl font-bold",style:{color:r.colors.text},children:l==="fr"?"Gestion des Tags":"Tags Management"})]}),e.jsx("button",{onClick:s,className:"p-2 rounded-full hover:bg-opacity-10 transition-colors",style:{backgroundColor:r.colors.textMuted+"10"},children:e.jsx(be,{size:24,style:{color:r.colors.textMuted}})})]}),e.jsxs("div",{className:"p-6 border-b grid grid-cols-3 gap-4",style:{borderColor:r.colors.border},children:[e.jsxs("div",{className:"text-center p-4 rounded-lg",style:{backgroundColor:r.colors.surface},children:[e.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:r.colors.accent},children:n.length}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"Tags totaux":"Total tags"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg",style:{backgroundColor:r.colors.surface},children:[e.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:r.colors.success},children:n.length-j.length}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"Tags utilisÃ©s":"Used tags"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg",style:{backgroundColor:r.colors.surface},children:[e.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:r.colors.danger},children:j.length}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"Tags inutilisÃ©s":"Unused tags"})]})]}),e.jsxs("div",{className:"p-6 border-b space-y-4",style:{borderColor:r.colors.border},children:[e.jsxs("div",{className:"relative",children:[e.jsx(jt,{size:18,className:"absolute left-3 top-1/2 transform -translate-y-1/2",style:{color:r.colors.textMuted}}),e.jsx("input",{type:"text",value:d,onChange:k=>u(k.target.value),placeholder:l==="fr"?"Rechercher un tag...":"Search for a tag...",className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:r.colors.surface,borderColor:r.colors.border,color:r.colors.text}})]}),j.length>0&&e.jsxs("button",{onClick:i,className:"w-full px-4 py-2 rounded-lg flex items-center justify-center space-x-2 transition-colors hover:opacity-80",style:{backgroundColor:r.colors.danger+"20",color:r.colors.danger},children:[e.jsx(es,{size:16}),e.jsx("span",{children:l==="fr"?`Nettoyer ${j.length} tag(s) inutilisÃ©(s)`:`Clean up ${j.length} unused tag(s)`})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:y.length===0?e.jsxs("div",{className:"text-center py-12",style:{color:r.colors.textMuted},children:[e.jsx(ms,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:l==="fr"?"Aucun tag trouvÃ©":"No tags found"})]}):e.jsx("div",{className:"space-y-2",children:y.map(k=>{const M=g.get(k)||{count:0,lastUsed:null},C=m===k;return e.jsx("div",{className:"p-4 rounded-lg border transition-colors",style:{backgroundColor:M.count===0?r.colors.danger+"10":r.colors.surface,borderColor:M.count===0?r.colors.danger+"40":r.colors.border},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:C?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:x,onChange:R=>f(R.target.value),onKeyDown:R=>{R.key==="Enter"&&N(),R.key==="Escape"&&S()},className:"px-3 py-1 border rounded focus:outline-none focus:ring-2",style:{backgroundColor:r.colors.card,borderColor:r.colors.border,color:r.colors.text},autoFocus:!0}),e.jsx("button",{onClick:N,className:"px-3 py-1 rounded text-sm transition-colors",style:{backgroundColor:r.colors.success,color:"#ffffff"},children:l==="fr"?"Sauver":"Save"}),e.jsx("button",{onClick:S,className:"px-3 py-1 rounded text-sm transition-colors",style:{backgroundColor:r.colors.textMuted+"20",color:r.colors.textMuted},children:l==="fr"?"Annuler":"Cancel"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-lg font-semibold",style:{color:r.colors.text},children:k}),e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium",style:{backgroundColor:M.count>0?r.colors.accent+"20":r.colors.danger+"20",color:M.count>0?r.colors.accent:r.colors.danger},children:M.count===0?l==="fr"?"InutilisÃ©":"Unused":`${M.count} trade(s)`})]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm",style:{color:r.colors.textMuted},children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ee,{size:14}),e.jsxs("span",{children:[M.count," ",l==="fr"?"utilisations":"uses"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(bt,{size:14}),e.jsx("span",{children:w(M.lastUsed)})]})]})]})}),!C&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>v(k),className:"p-2 rounded hover:bg-opacity-10 transition-colors",style:{backgroundColor:r.colors.accent+"10"},title:l==="fr"?"Renommer":"Rename",children:e.jsx(wl,{size:16,style:{color:r.colors.accent}})}),e.jsx("button",{onClick:()=>a(k),className:"p-2 rounded hover:bg-opacity-10 transition-colors",style:{backgroundColor:r.colors.danger+"10"},title:l==="fr"?"Supprimer":"Delete",children:e.jsx(es,{size:16,style:{color:r.colors.danger}})})]})]})},k)})})}),e.jsx("div",{className:"p-6 border-t flex justify-end",style:{borderColor:r.colors.border},children:e.jsx("button",{onClick:s,className:"px-6 py-2 rounded-lg transition-colors",style:{backgroundColor:r.colors.accent,color:"#ffffff"},children:l==="fr"?"Fermer":"Close"})})]})}):null},Jc=({formData:t,onChange:s,errors:r,settings:l,existingTrades:n=[],onOpenStrategyModal:o,isEditMode:a=!1,fieldConfig:c,shouldShowField:i,toggleFieldVisibility:d,isObligatoryField:u})=>{const{currentTheme:m}=ee(),{currentLanguage:p}=X(),{getFavoritePresets:x}=Yo(),[f,g]=b.useState(!1),[h,y]=b.useState(""),[j,v]=b.useState(["Retest","Confluence","Squeeze","Expansion","Consolidation"]),N=b.useRef(null),[S,w]=b.useState(!1),[k,M]=b.useState(""),[C,R]=b.useState(["Swing Trading","Position Trading","Arbitrage","Hedging","Grid Trading"]),P=b.useRef(null),[D,T]=b.useState(""),[E,L]=b.useState(!1),[U,_]=b.useState([]),[B,z]=b.useState(!1),A=b.useRef(null),q=_l(h,j),W=()=>Wl(j,5),$=Hc(k,C),V=se=>{s("strategy",se);const Y=[se,...C.filter(te=>te!==se)].slice(0,5);R(Y);try{localStorage.setItem("strategy-recent",JSON.stringify(Y))}catch(te){console.error("Failed to save recent strategies to localStorage",te)}};b.useEffect(()=>{try{const se=localStorage.getItem("strategy-recent");if(se){const Y=JSON.parse(se);Array.isArray(Y)&&Y.length>0&&R(Y)}}catch(se){console.error("Failed to load recent strategies from localStorage",se)}},[]);const K=()=>{if(D.trim()&&!t.tags?.includes(D.trim())){const se=t.tags||[];if(s("tags",[...se,D.trim()]),T(""),!U.includes(D.trim())){const Y=[D.trim(),...U].slice(0,10);_(Y);try{localStorage.setItem("tags-recent",JSON.stringify(Y))}catch(te){console.error("Failed to save recent tags to localStorage",te)}}}},ne=se=>{const Y=t.tags||[];s("tags",Y.filter(te=>te!==se))},ue=se=>{const Y=t.tags||[];Y.includes(se)||s("tags",[...Y,se]),L(!1)},le=se=>{se.key==="Enter"&&(se.preventDefault(),K())},je=()=>{const se=new Set;n.forEach(te=>{te.tags&&Array.isArray(te.tags)&&te.tags.forEach(G=>se.add(G))});const Y=U.filter(te=>se.has(te));_(Y);try{localStorage.setItem("tags-recent",JSON.stringify(Y))}catch(te){console.error("Failed to save cleaned tags to localStorage",te)}},ye=se=>{const Y=U.filter(G=>G!==se);_(Y);const te=t.tags||[];te.includes(se)&&s("tags",te.filter(G=>G!==se));try{localStorage.setItem("tags-recent",JSON.stringify(Y))}catch(G){console.error("Failed to save tags to localStorage",G)}},ve=(se,Y)=>{if(se===Y||!Y.trim())return;const te=U.map(he=>he===se?Y.trim():he);_(te);const G=t.tags||[];G.includes(se)&&s("tags",G.map(he=>he===se?Y.trim():he));try{localStorage.setItem("tags-recent",JSON.stringify(te))}catch(he){console.error("Failed to save tags to localStorage",he)}};return b.useEffect(()=>{const se=Y=>{N.current&&!N.current.contains(Y.target)&&g(!1),P.current&&!P.current.contains(Y.target)&&w(!1),A.current&&!A.current.contains(Y.target)&&L(!1)};return document.addEventListener("mousedown",se),()=>{document.removeEventListener("mousedown",se)}},[]),b.useEffect(()=>{const se=new Set;n.length>0&&n.forEach(te=>{te.tags&&Array.isArray(te.tags)&&te.tags.forEach(G=>se.add(G))});try{const te=localStorage.getItem("tags-recent");if(te){const G=JSON.parse(te);Array.isArray(G)&&G.length>0&&G.forEach(he=>se.add(he))}}catch(te){console.error("Failed to load recent tags from localStorage",te)}const Y=Array.from(se);if(n.length>0){const te=Y.reduce((G,he)=>{const we=n.reduce((Ie,Te)=>Ie+(Te.tags?.filter(ze=>ze===he).length||0),0);return G[he]=we,G},{});Y.sort((G,he)=>te[he]-te[G])}_(Y)},[n]),b.useEffect(()=>{if(t.entryPrice&&t.exitPrice){const se=Number(t.entryPrice),Y=Number(t.exitPrice);if(se&&Y){const G=Math.abs(Y-se)/se;t.riskReward!==G&&s("riskReward",G.toFixed(2))}}},[t.entryPrice,t.exitPrice,t.riskReward,s]),e.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-2 gap-10",children:[e.jsxs("div",{className:"flex flex-col space-y-6",children:[i&&i("tradeResult")&&e.jsx(Eo,{currentTheme:m,currentLanguage:p,value:t.tradeResult,onChange:se=>s("tradeResult",se),isEditMode:a,fieldConfig:c,toggleFieldVisibility:d,isObligatoryField:u}),i&&i("riskReward")&&e.jsx(Vl,{currentTheme:m,currentLanguage:p,value:t.riskReward,onChange:se=>s("riskReward",se),isEditMode:a,fieldConfig:c,toggleFieldVisibility:d,isObligatoryField:u}),i&&i("trend")&&e.jsx(Fo,{currentTheme:m,currentLanguage:p,value:t.trend,onChange:se=>s("trend",se),isEditMode:a,fieldConfig:c,toggleFieldVisibility:d,isObligatoryField:u}),i&&i("strategy")&&e.jsx("div",{ref:P,children:e.jsx(en,{currentTheme:m,currentLanguage:p,value:t.strategy,onChange:se=>{s("strategy",se),M(se)},onSelect:se=>V(se),filteredStrategies:$,previousStrategies:C,favoriteNames:x().slice(0,5).map(se=>se.name),error:r.strategy,showDropdown:S,setShowDropdown:w,onOpenModal:o,isEditMode:a,fieldConfig:c,toggleFieldVisibility:d,isObligatoryField:u})})]}),e.jsxs("div",{className:"flex flex-col",children:[i&&i("setup")&&e.jsx("div",{ref:N,className:"mb-6",children:e.jsx(tn,{currentTheme:m,currentLanguage:p,value:t.setup,onChange:se=>s("setup",se),search:h,setSearch:y,filteredSetups:q,quickSetups:W(),error:r.setup,showDropdown:f,setShowDropdown:g,isEditMode:a,fieldConfig:c,toggleFieldVisibility:d,isObligatoryField:u})}),i&&i("tags")&&e.jsx("div",{ref:A,className:"mt-20",children:e.jsx(Gc,{currentTheme:m,currentLanguage:p,value:t.tags||[],error:r.tags,newTag:D,setNewTag:T,onAdd:K,onRemove:ne,showDropdown:E,setShowDropdown:L,previousTags:U,existingTrades:n,onSelectFromDropdown:ue,onKeyDown:le,onCleanupUnusedTags:je,onOpenManagementModal:()=>z(!0),isEditMode:a,fieldConfig:c,toggleFieldVisibility:d,isObligatoryField:u})})]}),e.jsx(Bl,{isOpen:B,onClose:()=>z(!1),currentTheme:m,currentLanguage:p,allTags:U,existingTrades:n,onDeleteTag:ye,onRenameTag:ve,onCleanupUnusedTags:()=>{je(),z(!1)}})]})},Kc=({screenshots:t,imageNames:s,currentImageIndex:r,setCurrentImageIndex:l,comparisonMode:n,setComparisonMode:o,selectedImages:a,toggleImageSelection:c,hideHUD:i,setHideHUD:d,getScreenshotUrl:u,goToPrevImage:m,goToNextImage:p,currentLanguage:x,currentTheme:f,setLightboxOpen:g,getComparisonLayout:h,handleComparisonDragStart:y,handleComparisonDragOver:j,handleComparisonDragLeave:v,handleComparisonDrop:N,draggedImageIndex:S,dragOverIndex:w})=>e.jsxs("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-95 flex items-center justify-center",children:[e.jsxs("div",{className:"absolute top-4 left-4 right-4 flex items-center justify-between z-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h3",{className:"text-white text-lg font-medium",children:s[r]||`Screenshot ${r+1}`}),e.jsxs("span",{className:"text-white/70 text-sm",children:[r+1," / ",t.length]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!n&&t.length>1&&e.jsx("button",{onClick:()=>{const k=[];for(let M=0;M<Math.min(4,t.length);M++)k.push((r+M)%t.length);a&&a.length,o(!0)},className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",title:x==="fr"?"Mode comparaison":"Comparison mode",children:e.jsx(He,{size:20,className:"text-white"})}),n&&e.jsx("button",{onClick:()=>o(!1),className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",title:x==="fr"?"Vue simple":"Single view",children:e.jsx(Vo,{size:20,className:"text-white"})}),e.jsx("button",{onClick:()=>d(!i),className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",title:x==="fr"?i?"Afficher les contrÃ´les":"Masquer les contrÃ´les":i?"Show controls":"Hide controls",children:i?e.jsx(Re,{size:20,className:"text-white"}):e.jsx(ke,{size:20,className:"text-white"})}),e.jsx("button",{onClick:()=>{g(!1),o(!1)},className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:e.jsx(be,{size:20,className:"text-white"})})]})]}),!n&&t.length>1&&e.jsx("button",{onClick:m,className:"absolute left-4 top-1/2 transform -translate-y-1/2 p-3 bg-white/20 hover:bg-white/30 rounded-full transition-colors z-10",children:e.jsx(pl,{size:24,className:"text-white"})}),!n&&t.length>1&&e.jsx("button",{onClick:p,className:"absolute right-4 top-1/2 transform -translate-y-1/2 p-3 bg-white/20 hover:bg-white/30 rounded-full transition-colors z-10",children:e.jsx(hl,{size:24,className:"text-white"})}),e.jsx("div",{className:`w-full h-full flex flex-col ${i?"p-2":"p-6"}`,children:n&&a.length>=2?e.jsxs(e.Fragment,{children:[!i&&e.jsxs("div",{className:"text-white text-center mb-2 flex-shrink-0",children:[e.jsx("h3",{className:"text-base font-medium",children:x==="fr"?`Comparaison de ${a.length} images`:`Comparing ${a.length} images`}),e.jsx("p",{className:"text-xs opacity-60 mt-1",children:x==="fr"?"Glissez-dÃ©posez pour rÃ©organiser â€¢ Cliquez pour vue simple":"Drag & drop to reorder â€¢ Click for single view"})]}),e.jsx("div",{className:"flex-1 min-h-0 w-full max-w-none",children:(()=>{const k=h(a.length),M=(C,R="",P="")=>{const D=S===C,T=w===C;return e.jsxs("div",{className:`
                        flex flex-col min-h-0 ${R} 
                        ${D?"opacity-50 scale-95":""}
                        ${T?"ring-2 ring-blue-400 ring-opacity-70":""}
                        transition-all duration-200
                      `,draggable:!0,onDragStart:E=>y(E,C),onDragOver:E=>j(E,C),onDragLeave:v,onDrop:E=>N(E,C),children:[e.jsxs("div",{className:"text-white text-center mb-2 text-sm font-medium flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-xs opacity-60",children:"::"}),s[C]||`Screenshot ${C+1}`,e.jsx("span",{className:"text-xs opacity-60",children:"::"})]}),e.jsx("div",{className:`
                        flex-1 flex items-center justify-center min-h-0 bg-black/20 rounded-lg p-2 ${P}
                        ${T?"bg-blue-900/30":""}
                        transition-colors duration-200
                      `,children:e.jsx("img",{src:u(t[C]),alt:s[C]||`Screenshot ${C+1}`,className:"max-w-full max-h-full object-contain rounded shadow-xl cursor-move hover:scale-105 transition-transform duration-200",onClick:()=>{l(C),o(!1)}})})]},C)};return k.type==="three-asymmetric"?e.jsx("div",{className:"grid grid-cols-3 gap-3 h-full",children:a.map(C=>M(C,"","h-full"))}):k.type==="four-asymmetric"?e.jsx("div",{className:"grid grid-cols-2 gap-3 h-full",children:a.map(C=>M(C,"","h-full"))}):k.type==="five-asymmetric"?e.jsxs("div",{className:"w-full h-full flex flex-col gap-2",children:[e.jsxs("div",{className:"h-1/2 w-full flex gap-2",children:[e.jsx("div",{className:"flex-1",children:M(a[0],"","h-full")}),e.jsx("div",{className:"flex-1",children:M(a[1],"","h-full")}),e.jsx("div",{className:"flex-1",children:M(a[2],"","h-full")})]}),e.jsxs("div",{className:"h-1/2 w-full flex gap-2 px-72",children:[e.jsx("div",{className:"flex-1",children:M(a[3],"","h-full")}),e.jsx("div",{className:"flex-1",children:M(a[4],"","h-full")})]})]}):e.jsx("div",{className:`grid ${k.gridClass} gap-3 h-full`,children:a.map(C=>M(C,"","h-full"))})})()})]}):e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx("img",{src:u(t[r]),alt:s[r]||`Screenshot ${r+1}`,className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl"})})}),t.length>1&&!i&&e.jsx("div",{className:"absolute bottom-2 left-4 right-4 flex justify-center",children:e.jsxs("div",{className:"flex gap-1 p-1.5 bg-black/60 rounded-lg max-w-2xl overflow-x-auto",children:[n&&e.jsx("div",{className:"text-white text-xs px-1.5 py-0.5 bg-white/10 rounded mr-1 flex items-center",children:x==="fr"?`Clic +/- (${a.length}/6 max)`:`Click +/- (${a.length}/6 max)`}),t.map((k,M)=>{const C=n&&a.includes(M),R=M===r,P=!n||C||a.length<6;return e.jsxs("button",{onClick:()=>{if(n){if(!a.includes(M)&&a.length>=6)return;c(M)}else l(M)},className:`
                    relative flex-shrink-0 w-12 h-12 rounded overflow-hidden border-2 transition-all duration-200
                    ${n?C?"border-blue-500 ring-2 ring-blue-400 ring-opacity-50":P?"border-white/30 hover:border-blue-400":"border-red-400/50 opacity-50 cursor-not-allowed":R?"border-white":"border-white/30 hover:border-white/60"}
                    ${n&&P?"hover:scale-105":""}
                  `,title:n?C?x==="fr"?"Retirer de la comparaison":"Remove from comparison":P?x==="fr"?"Ajouter Ã  la comparaison":"Add to comparison":x==="fr"?"Limite de 6 images atteinte":"Limit of 6 images reached":s[M]||`Screenshot ${M+1}`,children:[e.jsx("img",{src:u(k),alt:`Screenshot ${M+1}`,className:"w-full h-full object-cover"}),n&&C&&e.jsx("div",{className:"absolute top-0.5 right-0.5 w-3 h-3 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(_t,{size:8,className:"text-white"})}),n&&C&&e.jsx("div",{className:"absolute bottom-0.5 left-0.5 w-3 h-3 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:a.indexOf(M)+1})]},M)})]})})]}),Yc=({currentTheme:t,currentLanguage:s,screenshots:r,imageNames:l,selectedImages:n,isDragOver:o,isUploading:a,fileInputRef:c,handleFileInputChange:i,handleDropZoneClick:d,handleDragOver:u,handleDragLeave:m,handleDrop:p,getScreenshotUrl:x,openLightbox:f,toggleImageSelection:g,removeScreenshot:h,editingNameIndex:y,editingNameValue:j,setEditingNameIndex:v,setEditingNameValue:N,updateImageName:S,startEditing:w,isDraggingImage:k,galleryDraggedIndex:M,galleryDragOverIndex:C,handleImageMouseDown:R,handleImageDragStart:P,handleImageDragOver:D,handleImageDragLeave:T,handleImageDrop:E,handleImageDragEnd:L,enterComparisonMode:U,clearSelection:_})=>r.length===0?e.jsxs("div",{onClick:d,onDragOver:u,onDragLeave:m,onDrop:p,className:`
          border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-all duration-200
          ${o?"border-blue-400 bg-blue-50 dark:bg-blue-900/20":""}
          ${a?"opacity-50 pointer-events-none":""}
        `,style:{borderColor:o?t.colors.accent:t.colors.border,backgroundColor:o?`${t.colors.accent}10`:"transparent",minHeight:"200px"},children:[e.jsx("input",{ref:c,type:"file",accept:"image/*",multiple:!0,onChange:i,className:"hidden"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Rr,{size:48,className:"mx-auto",style:{color:t.colors.textMuted}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium mb-1",style:{color:t.colors.text},children:o?s==="fr"?"DÃ©posez vos images ici":"Drop your images here":s==="fr"?"Ajoutez vos screenshots":"Add your screenshots"}),e.jsx("p",{className:"text-sm",style:{color:t.colors.textMuted},children:s==="fr"?"Cliquez ou glissez-dÃ©posez des images":"Click or drag & drop images"})]}),e.jsx("p",{className:"text-xs",style:{color:t.colors.textMuted},children:s==="fr"?"PNG, JPG, WebP (max 5MB chacun)":"PNG, JPG, WebP (max 5MB each)"})]})]}):e.jsxs("div",{onDragOver:k?void 0:u,onDragLeave:k?void 0:m,onDrop:k?void 0:p,className:`
        relative rounded-lg transition-all duration-200
        ${o&&!k?"bg-blue-50 dark:bg-blue-900/20":""}
        ${a?"opacity-50 pointer-events-none":""}
      `,style:{backgroundColor:o&&!k?`${t.colors.accent}15`:"transparent"},children:[e.jsx("input",{ref:c,type:"file",accept:"image/*",multiple:!0,onChange:i,className:"hidden"}),o&&!k&&e.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center bg-black bg-opacity-50 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Rr,{size:32,className:"mx-auto mb-2 text-white"}),e.jsx("p",{className:"text-white font-medium",children:s==="fr"?"DÃ©posez pour ajouter":"Drop to add"})]})}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("p",{className:"text-sm font-medium",style:{color:t.colors.text},children:["Screenshots"," (",r.length,")"]}),r.length>1&&e.jsx("span",{className:"text-xs px-2 py-1 rounded-full transition-all duration-200",style:{backgroundColor:k?t.colors.accent+"20":t.colors.textMuted+"20",color:k?t.colors.accent:t.colors.textMuted},children:k?s==="fr"?"ðŸ”„ Mode rÃ©organisation":"ðŸ”„ Reorder mode":s==="fr"?"Clic long pour rÃ©organiser":"Long press to reorder"}),n.length>0&&e.jsxs("span",{className:"text-xs px-2 py-1 rounded-full",style:{backgroundColor:t.colors.accent+"20",color:t.colors.accent},children:[n.length,"/6 ",s==="fr"?"sÃ©lectionnÃ©e(s)":"selected"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[n.length>=2&&e.jsxs("button",{onClick:U,className:"flex items-center gap-1 px-3 py-1.5 text-xs rounded-lg transition-all duration-200 hover:scale-105",style:{backgroundColor:t.colors.success,color:"#ffffff"},children:[e.jsx(He,{size:14}),s==="fr"?"Comparer":"Compare"]}),n.length>0&&e.jsxs("button",{onClick:_,className:"flex items-center gap-1 px-3 py-1.5 text-xs rounded-lg transition-all duration-200 hover:scale-105",style:{backgroundColor:t.colors.textMuted,color:"#ffffff"},children:[e.jsx(be,{size:14}),s==="fr"?"Annuler":"Cancel"]}),e.jsxs("button",{onClick:d,className:"flex items-center gap-1 px-3 py-1.5 text-xs rounded-lg transition-all duration-200 hover:scale-105",style:{backgroundColor:t.colors.accent,color:"#ffffff"},children:[e.jsx(Ye,{size:14}),s==="fr"?"Ajouter":"Add"]})]})]}),e.jsx("div",{className:"gap-3",style:{display:"grid",gridTemplateColumns:r.length===1?"1fr":r.length===2?"repeat(2, 1fr)":"repeat(auto-fit, minmax(180px, 1fr))"},children:r.map((B,z)=>{const A=n.includes(z),F=l[z]||`Screenshot ${z+1}`,q=M===z,W=C===z;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{draggable:!0,onMouseDown:()=>R(z),onDragStart:I=>P(I,z),onDragOver:I=>D(I,z),onDragLeave:T,onDrop:I=>E(I,z),onDragEnd:L,className:`
                  relative group rounded-lg overflow-hidden border cursor-pointer 
                  transition-all duration-300 ease-out
                  hover:scale-[1.02] hover:shadow-lg
                  ${r.length===1?"aspect-video":"aspect-square"}
                  ${A?"ring-2 ring-offset-2":""}
                  ${q?"opacity-50 scale-95":""}
                  ${W&&k?"ring-2 ring-blue-400 ring-opacity-70":""}
                `,style:{borderColor:A?t.colors.accent:t.colors.border,transform:"translateZ(0)",...A&&{boxShadow:`0 0 0 2px ${t.colors.accent}40, 0 0 0 4px ${t.colors.accent}`},...W&&k&&{backgroundColor:`${t.colors.accent}15`}},onClick:()=>{k||f(z)},children:[e.jsx("img",{src:x(B),alt:F,className:"w-full h-full object-cover transition-transform duration-300 ease-out"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300 ease-out flex items-center justify-center",children:e.jsx("div",{className:"transform translate-y-2 group-hover:translate-y-0 transition-transform duration-300 ease-out",children:e.jsx(Vo,{size:r.length===1?32:24,className:"text-white drop-shadow-lg"})})}),e.jsx("button",{onClick:I=>{I.stopPropagation(),g(z)},className:`
                    absolute top-2 left-2 w-6 h-6 rounded-full border-2 flex items-center justify-center
                    transition-all duration-300
                    ${A?"bg-blue-500 border-blue-500":"bg-black/50 border-white/50 hover:bg-black/70"}
                  `,children:A&&e.jsx(_t,{size:12,className:"text-white"})}),e.jsxs("div",{className:"absolute top-2 right-10 px-2 py-1 bg-black/50 text-white text-xs rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[z+1,"/",r.length]}),e.jsx("button",{onClick:I=>{I.stopPropagation(),h(z)},className:"absolute top-2 right-2 p-1.5 rounded-full bg-red-500/90 text-white opacity-0 group-hover:opacity-100 transition-all duration-300 hover:scale-110 hover:bg-red-600 shadow-lg",children:e.jsx(be,{size:12})})]}),e.jsx("div",{className:"px-1",children:y===z?e.jsx("input",{type:"text",value:j,onChange:I=>N(I.target.value),onBlur:()=>{S(z,j),v(null),N("")},onKeyDown:I=>{I.key==="Enter"&&(S(z,j),v(null),N("")),I.key==="Escape"&&(v(null),N(""))},className:"w-full text-xs px-2 py-1 rounded border",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text},autoFocus:!0}):e.jsx("button",{onClick:()=>{w?w(z,l[z]||`Screenshot ${z+1}`):v(z),N(l[z]||`Screenshot ${z+1}`)},className:"w-full text-left text-xs px-2 py-1 rounded hover:bg-opacity-50 transition-colors truncate",style:{color:t.colors.textMuted,backgroundColor:"transparent"},title:s==="fr"?"Cliquer pour renommer":"Click to rename",children:l[z]||`Screenshot ${z+1}`})})]},z)})})]}),Xc=({currentTheme:t,currentLanguage:s,marginTop:r="95px",intensity:l,emotion:n,planRespected:o,showEmotion:a=!0,showIntensity:c=!0,showPlanRespected:i=!0,isEditMode:d=!1,toggleFieldVisibility:u,isObligatoryField:m,getEmotionDisplay:p,setIsEmotionModalOpen:x,handleEmotionClear:f,handleIntensityChange:g,handlePlanRespectedChange:h})=>e.jsx("div",{className:"border-t pt-3",style:{borderColor:t.colors.border+"40",marginTop:r},children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a&&e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 mb-3 text-sm font-medium",style:{color:t.colors.text},children:[e.jsx(bl,{size:16}),s==="fr"?"Ã‰tat Ã©motionnel":"Emotional State",d&&e.jsx("button",{type:"button",onClick:()=>u&&u("emotion"),className:"ml-2 p-1 rounded",title:m?.("emotion")?s==="fr"?"Obligatoire":"Required":s==="fr"?"Masquer":"Hide",style:{color:m?.("emotion")?t.colors.accent:t.colors.textMuted},disabled:!!m?.("emotion"),children:m?.("emotion")?"ðŸ”’":"ðŸ™ˆ"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>x(!0),className:"flex-1 p-3 rounded-lg border text-left font-medium transition-all duration-200 hover:scale-105 flex items-center justify-between",style:{borderColor:t.colors.border,backgroundColor:t.colors.surface,color:t.colors.text},children:[e.jsx("span",{className:"flex items-center gap-2",children:(()=>{const y=p();return y?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:y.emoji}),e.jsx("span",{children:y.label})]}):e.jsx("span",{style:{color:t.colors.textMuted},children:s==="fr"?"SÃ©lectionner un Ã©tat":"Select state"})})()}),e.jsx(Ye,{size:16})]}),n&&e.jsx("button",{onClick:f,className:"p-3 rounded-lg border transition-all duration-200 hover:scale-105 flex items-center justify-center",style:{borderColor:t.colors.border,backgroundColor:t.colors.surface,color:t.colors.textMuted},title:s==="fr"?"Effacer":"Clear",children:e.jsx(be,{size:16})})]})]}),c&&e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 mb-3 text-sm font-medium",style:{color:t.colors.text},children:[e.jsx(it,{size:16}),s==="fr"?"IntensitÃ© Ã©motionnelle":"Emotional Intensity",d&&e.jsx("button",{type:"button",onClick:()=>u&&u("intensity"),className:"ml-2 p-1 rounded",title:m?.("intensity")?s==="fr"?"Obligatoire":"Required":s==="fr"?"Masquer":"Hide",style:{color:m?.("intensity")?t.colors.accent:t.colors.textMuted},disabled:!!m?.("intensity"),children:m?.("intensity")?"ðŸ”’":"ðŸ™ˆ"})]}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(y=>e.jsx("button",{onClick:()=>g(y),className:`p-2 rounded-lg transition-all duration-200 ${l>=y?"text-yellow-500":"text-gray-300 hover:text-yellow-400"}`,style:{backgroundColor:l>=y?`${t.colors.warning}20`:"transparent"},children:e.jsx(it,{size:20,fill:l>=y?"currentColor":"none"})},y))}),e.jsxs("p",{className:"text-xs mt-1",style:{color:t.colors.textMuted},children:[l===0&&(s==="fr"?"SÃ©lectionnez une intensitÃ©":"Select intensity"),l===1&&(s==="fr"?"TrÃ¨s calme":"Very calm"),l===2&&(s==="fr"?"Calme":"Calm"),l===3&&(s==="fr"?"ModÃ©rÃ©":"Moderate"),l===4&&"Intense",l===5&&(s==="fr"?"TrÃ¨s intense":"Very intense")]})]}),i&&e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 mb-3 text-sm font-medium",style:{color:t.colors.text},children:[e.jsx(Vr,{size:16}),s==="fr"?"Ai-je respectÃ© mon plan ?":"Did I follow my plan?",d&&e.jsx("button",{type:"button",onClick:()=>u&&u("planRespected"),className:"ml-2 p-1 rounded",title:m?.("planRespected")?s==="fr"?"Obligatoire":"Required":s==="fr"?"Masquer":"Hide",style:{color:m?.("planRespected")?t.colors.accent:t.colors.textMuted},disabled:!!m?.("planRespected"),children:m?.("planRespected")?"ðŸ”’":"ðŸ™ˆ"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>h(!0),className:"flex-1 p-3 rounded-lg border-2 font-medium transition-all duration-200 hover:scale-105",style:{borderColor:o===!0?t.colors.success:t.colors.border,backgroundColor:o===!0?`${t.colors.success}20`:t.colors.surface,color:o===!0?t.colors.success:t.colors.text},children:["âœ… ",s==="fr"?"Oui":"Yes"]}),e.jsxs("button",{onClick:()=>h(!1),className:"flex-1 p-3 rounded-lg border-2 font-medium transition-all duration-200 hover:scale-105",style:{borderColor:o===!1?t.colors.danger:t.colors.border,backgroundColor:o===!1?`${t.colors.danger}20`:t.colors.surface,color:o===!1?t.colors.danger:t.colors.text},children:["âŒ ",s==="fr"?"Non":"No"]})]})]})]})}),Qc=({open:t,onClose:s,currentTheme:r,currentLanguage:l,emotionalStates:n,handleEmotionChange:o,handleRemoveCustomState:a,customEmotion:c,setCustomEmotion:i,customEmoji:d,setCustomEmoji:u,showCustomInput:m,setShowCustomInput:p,showEmojiMenu:x,setShowEmojiMenu:f,emojiMenuRef:g,handleEmojiSelect:h,handleCustomEmotionAdd:y,handleAddToPredefined:j})=>t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:s}),e.jsx("div",{className:"relative w-full max-w-md rounded-lg shadow-lg",style:{backgroundColor:r.colors.card,borderColor:r.colors.border},children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:r.colors.text},children:l==="fr"?"Ã‰tat Ã©motionnel":"Emotional State"}),e.jsx("button",{onClick:s,className:"p-1 rounded-lg hover:bg-opacity-10 transition-colors",style:{color:r.colors.textMuted},children:e.jsx(be,{size:20})})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("p",{className:"text-sm font-medium",style:{color:r.colors.text},children:l==="fr"?"Ã‰tats prÃ©dÃ©finis":"Predefined states"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:n.map(v=>{const N=v.value.startsWith("custom_");return e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:()=>o(v.value),className:"w-full p-3 rounded-lg border text-left font-medium transition-all duration-200 hover:scale-105 flex items-center gap-2",style:{borderColor:r.colors.border,backgroundColor:r.colors.surface,color:r.colors.text},children:[e.jsx("span",{children:v.emoji}),e.jsx("span",{className:"flex-1",children:v.label})]}),N&&e.jsx("button",{onClick:()=>a(v.value),className:"absolute -top-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:scale-110",style:{backgroundColor:r.colors.danger,color:r.colors.surface},title:l==="fr"?"Supprimer cet Ã©tat":"Remove this state",children:e.jsx(be,{size:12})})]},v.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",style:{color:r.colors.text},children:l==="fr"?"Ã‰tat personnalisÃ©":"Custom state"}),m?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:r.colors.text},children:"Emoji"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:d||"ðŸ¤”"}),e.jsx("span",{className:"text-sm",style:{color:r.colors.textMuted},children:d||(l==="fr"?"SÃ©lectionner un emoji":"Select emoji")})]}),e.jsxs("div",{className:"relative",ref:g,children:[e.jsx("button",{onClick:()=>f(!x),className:"p-2 rounded-lg border transition-all duration-200 hover:scale-105",style:{backgroundColor:r.colors.surface,borderColor:r.colors.border,color:r.colors.text},title:l==="fr"?"Choisir un emoji":"Choose emoji",children:e.jsx(Ye,{size:16})}),x&&e.jsx("div",{className:"absolute top-10 right-0 z-50 p-3 rounded-lg shadow-lg border max-h-48 overflow-y-auto",style:{backgroundColor:r.colors.card,borderColor:r.colors.border,minWidth:"200px"},children:e.jsx("div",{className:"flex flex-wrap gap-2",children:["ðŸ˜„","ðŸ˜°","ðŸ˜«","ðŸ˜Œ","ðŸ˜´","ðŸ¤”","ðŸ˜Š","ðŸ˜¢","ðŸ˜¡","ðŸ˜±","ðŸ˜","ðŸ˜Ž","ðŸ¤—","ðŸ˜¤","ðŸ˜‡","ðŸ¥º","ðŸ¤¯","ðŸ˜µ","ðŸ¤¢","ðŸ¤®","ðŸ˜ˆ","ðŸ‘»","ðŸ¤–","ðŸ’€","ðŸ‘½"].map(v=>e.jsx("button",{onClick:()=>h(v),className:"w-8 h-8 flex items-center justify-center rounded-lg text-xl transition-all hover:scale-110",children:v},v))})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:r.colors.text},children:l==="fr"?"Nom de l'Ã©tat":"State name"}),e.jsx("input",{type:"text",value:c,onChange:v=>i(v.target.value),placeholder:l==="fr"?"Nom de votre Ã©tat...":"Name your state...",className:"w-full p-3 rounded-lg border",style:{borderColor:r.colors.border,backgroundColor:r.colors.surface,color:r.colors.text},onKeyPress:v=>v.key==="Enter"&&y()})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:y,disabled:!c.trim(),className:"flex-1 p-2 rounded-lg font-medium transition-all duration-200 disabled:opacity-50",style:{backgroundColor:r.colors.accent,color:r.colors.surface},children:l==="fr"?"Utiliser":"Use"}),e.jsxs("button",{onClick:j,disabled:!c.trim(),className:"p-2 rounded-lg border font-medium transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",style:{borderColor:r.colors.accent,backgroundColor:r.colors.accent+"10",color:r.colors.accent},title:l==="fr"?"Ajouter aux Ã©tats prÃ©dÃ©finis":"Add to predefined states",children:[e.jsx(Ye,{size:14}),l==="fr"?"Sauvegarder":"Save"]}),e.jsx("button",{onClick:()=>{p(!1),i(""),u("")},className:"flex-1 p-2 rounded-lg border font-medium transition-all duration-200",style:{borderColor:r.colors.border,backgroundColor:r.colors.surface,color:r.colors.text},children:l==="fr"?"Annuler":"Cancel"})]})]}):e.jsxs("button",{onClick:()=>p(!0),className:"w-full p-3 rounded-lg border-2 border-dashed transition-all duration-200 hover:scale-105 flex items-center justify-center gap-2",style:{borderColor:r.colors.accent,color:r.colors.accent},children:[e.jsx(Ye,{size:16}),l==="fr"?"Ajouter un Ã©tat personnalisÃ©":"Add custom state"]})]})]})})]}):null,Zc=({currentTheme:t,currentLanguage:s,notes:r,onNotesChange:l,mentalSummary:n,onMentalSummaryChange:o,errors:a,showNotes:c=!0,showMentalSummary:i=!0})=>e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[c&&e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 mb-2 text-sm font-medium",style:{color:t.colors.text},children:[e.jsx(ji,{size:16}),s==="fr"?"Note contextuelle":"Contextual Note"]}),e.jsx("textarea",{value:r,onChange:d=>l(d.target.value),placeholder:s==="fr"?"DÃ©crivez le contexte de votre trade, l'analyse technique, le setup...":"Describe your trade context, technical analysis, setup...",className:"w-full p-3 rounded-lg border resize-none",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text,minHeight:"120px"},rows:5}),a.notes&&e.jsx("p",{className:"text-sm mt-1",style:{color:t.colors.danger},children:a.notes})]}),i&&e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 mb-2 text-sm font-medium",style:{color:t.colors.text},children:[e.jsx(ci,{size:16}),s==="fr"?"RÃ©sumÃ© mental":"Mental Summary"]}),e.jsx("textarea",{value:n,onChange:d=>o(d.target.value),placeholder:s==="fr"?"Insights clÃ©s, points d'attention, leÃ§ons apprises...":"Key insights, points to watch, lessons learned...",className:"w-full p-3 rounded-lg border resize-none",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text,minHeight:"80px"},rows:3})]})]}),ed=t=>{const[s,r]=b.useState(null),[l,n]=b.useState("");return{editingNameIndex:s,editingNameValue:l,setEditingNameIndex:r,setEditingNameValue:n,startEditing:(i,d)=>{r(i),n(d)},commitEditing:i=>{t(i,l),r(null),n("")},cancelEditing:()=>{r(null),n("")}}},td=t=>{const[s,r]=b.useState(null),[l,n]=b.useState(null),[o,a]=b.useState(null),[c,i]=b.useState(!1),d=h=>a(Date.now()),u=(h,y)=>{const j=Date.now();if(!o||j-o<300){h.preventDefault();return}i(!0),r(y),h.dataTransfer.effectAllowed="move"},m=(h,y)=>{c&&(h.preventDefault(),h.stopPropagation(),n(y))},p=h=>{c&&n(null)},x=(h,y)=>{if(c){if(h.preventDefault(),h.stopPropagation(),s===null||s===y){g();return}t(s,y),g()}},f=()=>g(),g=()=>{r(null),n(null),i(!1),a(null)};return{galleryDraggedIndex:s,galleryDragOverIndex:l,dragStartTime:o,isDraggingImage:c,handleImageMouseDown:d,handleImageDragStart:u,handleImageDragOver:m,handleImageDragLeave:p,handleImageDrop:x,handleImageDragEnd:f}},sd=(t,s)=>{const[r,l]=b.useState(!1),[n,o]=b.useState(!1),a=b.useRef(null),c=b.useCallback(async x=>{if(x.length===0)return;o(!0);const f=[];for(let h=0;h<x.length;h++){const y=x[h];if(y.type.startsWith("image/")&&!(y.size>5*1024*1024))try{const j=await new Promise((v,N)=>{const S=new FileReader;S.onload=()=>v(S.result),S.onerror=N,S.readAsDataURL(y)});f.push(j)}catch{}}const g=t.screenshots||[];s("screenshots",[...g,...f]),o(!1)},[t.screenshots,s]);return{isDragOver:r,isUploading:n,fileInputRef:a,handleFileUpload:c,handleFileInputChange:x=>{const f=x.target.files;f&&c(f)},handleDropZoneClick:()=>{a.current?.click()},handleDragOver:x=>{x.preventDefault(),l(!0)},handleDragLeave:x=>{x.preventDefault(),l(!1)},handleDrop:x=>{x.preventDefault(),l(!1);const f=x.dataTransfer.files;f&&c(f)}}},rd=()=>{const[t,s]=b.useState([]),[r,l]=b.useState(!1);return{selectedImages:t,setSelectedImages:s,comparisonMode:r,setComparisonMode:l,toggleImageSelection:c=>{s(i=>{if(i.includes(c)){if(r&&i.length<=2)return i;const d=i.filter(u=>u!==c);return r&&d.length<2&&l(!1),d}return i.length<6?[...i,c]:i})},enterComparisonMode:()=>{t.length>=2&&l(!0)},clearSelection:()=>s([])}},od=({formData:t,onChange:s,errors:r,settings:l,existingSymbols:n,isEditMode:o=!1,fieldConfig:a,shouldShowField:c,toggleFieldVisibility:i,isObligatoryField:d})=>{const{currentTheme:u}=ee(),{currentLanguage:m,t:p}=X(),x=(ie,Fe)=>s(ie,Fe),{isDragOver:f,isUploading:g,fileInputRef:h,handleFileInputChange:y,handleDropZoneClick:j,handleDragOver:v,handleDragLeave:N,handleDrop:S}=sd(t,x),[w,k]=b.useState(!1),[M,C]=b.useState(0),{selectedImages:R,setSelectedImages:P,comparisonMode:D,setComparisonMode:T,toggleImageSelection:E,clearSelection:L}=rd(),U=()=>{R.length>=2&&(T(!0),C(R[0]),k(!0))},[_,B]=b.useState([]),{editingNameIndex:z,editingNameValue:A,setEditingNameIndex:F,setEditingNameValue:q,startEditing:W,commitEditing:I}=ed((ie,Fe)=>{const Ge=[..._];Ge[ie]=Fe,B(Ge)}),[$,V]=b.useState(null),[K,ne]=b.useState(null),[ue,le]=b.useState(!1),{galleryDraggedIndex:je,galleryDragOverIndex:ye,isDraggingImage:ve,handleImageMouseDown:se,handleImageDragStart:Y,handleImageDragOver:te,handleImageDragLeave:G,handleImageDrop:he,handleImageDragEnd:we}=td((ie,Fe)=>{const wt=[...t.screenshots||[]],Lt=[..._];[wt[ie],wt[Fe]]=[wt[Fe],wt[ie]],[Lt[ie],Lt[Fe]]=[Lt[Fe],Lt[ie]],s("screenshots",wt),B(Lt),P(Vs=>Vs.map(io=>io===ie?Fe:io===Fe?ie:io))}),[Ie,Te]=b.useState(!1),[ze,re]=b.useState(""),[H,Q]=b.useState(!1),[fe,Z]=b.useState(!1),[oe,me]=b.useState(""),ge=b.useRef(null);O.useEffect(()=>{const ie=Fe=>{ge.current&&!ge.current.contains(Fe.target)&&Z(!1)};return document.addEventListener("mousedown",ie),()=>{document.removeEventListener("mousedown",ie)}},[]);const Pe=ie=>{s("notes",ie)},Oe=ie=>{s("mentalSummary",ie)},ct=ie=>{s("emotionIntensity",ie)},tt=ie=>{s("emotion",ie),Te(!1)},Ct=()=>{ze.trim()&&(tt(`custom:${oe||"ðŸ¤”"}:${ze.trim()}`),re(""),me(""),Q(!1))},qt=()=>{if(ze.trim()){const ie=oe||"ðŸ¤”",Fe={value:`custom_${Date.now()}`,emoji:ie,label:ze.trim()},Ge=JSON.parse(localStorage.getItem("customEmotionalStates")||"[]");Ge.push(Fe),localStorage.setItem("customEmotionalStates",JSON.stringify(Ge)),Ue(Ge),tt(`custom:${ie}:${ze.trim()}`),re(""),me(""),Q(!1)}},Ht=()=>{s("emotion","")},Pt=ie=>{const Ge=JSON.parse(localStorage.getItem("customEmotionalStates")||"[]").filter(wt=>wt.value!==ie);localStorage.setItem("customEmotionalStates",JSON.stringify(Ge)),Ue(Ge)},Gt=ie=>{me(ie),Z(!1)},rs=ie=>{s("planRespected",ie)},Ut=()=>t.mentalSummary||"",Ve=()=>{if(typeof t.emotionIntensity=="number")return t.emotionIntensity;const ie=t.tags?.find(Fe=>Fe.startsWith("intensity:"));return ie?parseInt(ie.replace("intensity:","")):0},de=()=>{if(t.emotion)return t.emotion;const ie=t.tags?.find(Fe=>Fe.startsWith("emotion:"));return ie?ie.replace("emotion:",""):""},ce=()=>{const ie=de();if(ie.startsWith("custom:")){const Ge=ie.split(":"),wt=Ge[1]||"ðŸ¤”",Lt=Ge[2]||ie.replace("custom:","");return{emoji:wt,label:Lt,isCustom:!0}}const Fe=Se.find(Ge=>Ge.value===ie);return Fe?{...Fe,isCustom:Fe.value.startsWith("custom_")}:null},pe=()=>{if(typeof t.planRespected<"u")return t.planRespected;const ie=t.tags?.find(Fe=>Fe.startsWith("plan:"));return ie?ie.replace("plan:","")==="true":null},De=ie=>{const Ge=(t.screenshots||[]).filter((Lt,Vs)=>Vs!==ie),wt=_.filter((Lt,Vs)=>Vs!==ie);s("screenshots",Ge),B(wt)},_e=(ie,Fe)=>I(ie),Be=ie=>{C(ie),k(!0)},Et=()=>{C(ie=>(ie+1)%kt.length)},Je=()=>{C(ie=>(ie-1+kt.length)%kt.length)},gt=ie=>ie===1?{type:"single",gridClass:"grid-cols-1"}:ie===2?{type:"two",gridClass:"grid-cols-1 lg:grid-cols-2"}:ie===3?{type:"three-asymmetric",gridClass:""}:ie===4?{type:"four-asymmetric",gridClass:""}:ie===5?{type:"five-asymmetric",gridClass:""}:{type:"regular",gridClass:"grid-cols-2 md:grid-cols-3 lg:grid-cols-3"},ot=(ie,Fe)=>{V(Fe),ie.dataTransfer.effectAllowed="move"},dt=(ie,Fe)=>{ie.preventDefault(),ie.dataTransfer.dropEffect="move",ne(Fe)},Ft=()=>{ne(null)},At=(ie,Fe)=>{if(ie.preventDefault(),$===null||$===Fe){V(null),ne(null);return}const Ge=[...R],wt=Ge.indexOf($),Lt=Ge.indexOf(Fe);[Ge[wt],Ge[Lt]]=[Ge[Lt],Ge[wt]],P(Ge),V(null),ne(null)},Mt=ie=>typeof ie=="string"?ie:ie.url,kt=t.screenshots||[],ys=Ut(),no=Ve(),lo=de(),ao=pe(),J=[{value:"euphoria",label:"Euphorie",emoji:"ðŸ˜„"},{value:"fomo",label:"FOMO",emoji:"ðŸ˜°"},{value:"stress",label:"Stress",emoji:"ðŸ˜«"},{value:"calm",label:"Calme",emoji:"ðŸ˜Œ"},{value:"fatigue",label:"Fatigue",emoji:"ðŸ˜´"}],[xe,Ue]=b.useState(()=>{try{return JSON.parse(localStorage.getItem("customEmotionalStates")||"[]")}catch{return[]}}),Se=[...J,...xe];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6",children:[c&&(c("notes")||c("mentalSummary"))&&e.jsx(Zc,{currentTheme:u,currentLanguage:m,notes:t.notes||"",onNotesChange:Pe,mentalSummary:ys,onMentalSummaryChange:Oe,errors:r,showNotes:c("notes"),showMentalSummary:c("mentalSummary")}),c&&c("screenshots")&&e.jsxs("div",{className:"lg:col-span-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",style:{color:u.colors.text},children:[e.jsx(Vo,{size:16}),"Screenshots"]}),o&&!d?.("screenshots")&&e.jsx("button",{type:"button",onClick:()=>i&&i("screenshots"),className:"p-1 rounded hover:bg-gray-100 transition-colors",title:a?.hiddenFields?.includes("screenshots")?"Afficher":"Masquer",style:{color:a?.hiddenFields?.includes("screenshots")?u.colors.warning:u.colors.textMuted},children:a?.hiddenFields?.includes("screenshots")?e.jsx(ke,{size:16}):e.jsx(Re,{size:16})}),o&&d?.("screenshots")&&e.jsx("div",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:u.colors.accent+"20",color:u.colors.accent,border:`1px solid ${u.colors.accent}40`},title:m==="fr"?"Champ obligatoire":"Required field",children:m==="fr"?"Obligatoire":"Required"})]}),e.jsx(Yc,{currentTheme:u,currentLanguage:m,screenshots:kt,imageNames:_,selectedImages:R,isDragOver:f,isUploading:g,fileInputRef:h,handleFileInputChange:y,handleDropZoneClick:j,handleDragOver:v,handleDragLeave:N,handleDrop:S,getScreenshotUrl:Mt,openLightbox:Be,toggleImageSelection:E,removeScreenshot:De,editingNameIndex:z,editingNameValue:A,setEditingNameIndex:F,setEditingNameValue:q,updateImageName:_e,startEditing:W,isDraggingImage:ve,galleryDraggedIndex:je,galleryDragOverIndex:ye,handleImageMouseDown:se,handleImageDragStart:Y,handleImageDragOver:te,handleImageDragLeave:G,handleImageDrop:he,handleImageDragEnd:we,enterComparisonMode:U,clearSelection:L})]})]}),Ie&&e.jsx(Qc,{open:Ie,onClose:()=>Te(!1),currentTheme:u,currentLanguage:m,emotionalStates:Se,handleEmotionChange:tt,handleRemoveCustomState:Pt,customEmotion:ze,setCustomEmotion:re,customEmoji:oe,setCustomEmoji:me,showCustomInput:H,setShowCustomInput:Q,showEmojiMenu:fe,setShowEmojiMenu:Z,emojiMenuRef:ge,handleEmojiSelect:Gt,handleCustomEmotionAdd:Ct,handleAddToPredefined:qt}),c&&(c("emotion")||c("intensity")||c("planRespected"))&&e.jsx(Xc,{currentTheme:u,currentLanguage:m,showEmotion:c("emotion"),showIntensity:c("intensity"),showPlanRespected:c("planRespected"),isEditMode:!!o,toggleFieldVisibility:i,isObligatoryField:d,intensity:no,emotion:lo,planRespected:ao,getEmotionDisplay:ce,setIsEmotionModalOpen:Te,handleEmotionClear:Ht,handleIntensityChange:ct,handlePlanRespectedChange:rs}),w&&kt.length>0&&e.jsx(Kc,{screenshots:kt,imageNames:_,currentImageIndex:M,setCurrentImageIndex:C,comparisonMode:D,setComparisonMode:T,selectedImages:R,toggleImageSelection:E,hideHUD:ue,setHideHUD:le,getScreenshotUrl:Mt,goToPrevImage:Je,goToNextImage:Et,currentLanguage:m,currentTheme:u,setLightboxOpen:k,getComparisonLayout:gt,handleComparisonDragStart:ot,handleComparisonDragOver:dt,handleComparisonDragLeave:Ft,handleComparisonDrop:At,draggedImageIndex:$,dragOverIndex:K})]})},nd=({formData:t,onChange:s,settings:r})=>{const{currentTheme:l}=ee(),{currentLanguage:n}=X();return t.market!=="futures"?null:e.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:l.colors.surface+"50",borderColor:l.colors.border},children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(Me,{size:14,style:{color:l.colors.textMuted}}),e.jsx("span",{className:"text-sm font-medium",style:{color:l.colors.textSecondary},children:n==="fr"?"Mode Ticks (Optionnel)":"Ticks Mode (Optional)"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",style:{color:l.colors.textMuted},children:"Ticks"}),e.jsx("input",{type:"number",step:"0.25",value:t.ticksGained||"",onChange:o=>{const a=o.target.value;if(a==="")s("ticksGained",void 0);else{const c=parseFloat(a);isNaN(c)||s("ticksGained",c)}},placeholder:"Ex: 12.5",className:"w-full px-2 py-1 text-sm border rounded focus:outline-none focus:ring-1 transition-colors",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",style:{color:l.colors.textMuted},children:n==="fr"?"Valeur/Tick":"Value/Tick"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",value:t.tickValue||"",onChange:o=>{const a=o.target.value;if(a==="")s("tickValue",void 0);else{const c=parseFloat(a);isNaN(c)||s("tickValue",c)}},placeholder:"Ex: 12.5",className:"w-full px-2 py-1 pr-8 text-sm border rounded focus:outline-none focus:ring-1 transition-colors",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text}}),e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs",style:{color:l.colors.textMuted},children:r?.currency||"EUR"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",style:{color:l.colors.textMuted},children:n==="fr"?"Contrats engagÃ©s":"Contracts engaged"}),e.jsx("input",{type:"number",step:"1",min:"1",value:t.contracts||"",onChange:o=>{const a=o.target.value;if(a==="")s("contracts",void 0);else{const c=parseInt(a,10);isNaN(c)||s("contracts",c)}},placeholder:"1",className:"w-full px-2 py-1 text-sm border rounded focus:outline-none focus:ring-1 transition-colors",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text}})]})]}),t.ticksGained!==void 0&&t.tickValue!==void 0&&e.jsx("div",{className:"mt-3 text-xs p-2 rounded border",style:{backgroundColor:l.colors.accent+"10",borderColor:l.colors.accent+"30",color:l.colors.accent},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:n==="fr"?"CalculÃ©:":"Calculated:"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium",children:new Intl.NumberFormat(n==="fr"?"fr-FR":"en-US",{style:"currency",currency:r?.currency||"EUR"}).format(t.ticksGained*t.tickValue*(t.contracts||1))}),e.jsxs("div",{className:"text-xs opacity-75",children:[(t.ticksGained*t.tickValue*(t.contracts||1)/(r?.initialCapital||1e4)*100).toFixed(2),"%"]})]})]})})]})},ld=({formData:t,onChange:s,settings:r,t1:l,currentLanguage:n,setTimeframeOverlay:o,setTimeframeButtonRef:a})=>{const{currentTheme:c}=ee();return e.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:c.colors.surface,borderColor:c.colors.border},children:[e.jsx("h4",{className:"font-medium mb-3",style:{color:c.colors.text},children:n==="fr"?"Informations ComplÃ©mentaires":"Additional Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:c.colors.textSecondary},children:l("date")}),e.jsx(gs,{id:"quick-mode-date-input",value:t.date||"",onChange:i=>s("date",i),placeholder:n==="fr"?"jj/mm/aaaa":"mm/dd/yyyy",className:"w-full",size:"compact"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:c.colors.textSecondary},children:l("heure")}),e.jsx("input",{type:"time",value:t.time||"",onChange:i=>s("time",i.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors shadow-sm",style:{backgroundColor:c.colors.surface,borderColor:c.colors.border,color:c.colors.text}})]})]}),e.jsx("div",{children:e.jsx(Il,{theme:c,formData:t,onChange:s,t1:l,currentLanguage:n,setTimeframeOverlay:o,setTimeframeButtonRef:a})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",style:{color:c.colors.textSecondary},children:[n==="fr"?"StratÃ©gie":"Strategy"," ",e.jsxs("span",{className:"text-xs",children:["(",n==="fr"?"optionnel":"optional",")"]})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsx("input",{type:"text",value:t.strategy||"",onChange:i=>s("strategy",i.target.value),placeholder:"Ex: Scalping, Swing...",className:"flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors shadow-sm",style:{backgroundColor:c.colors.surface,borderColor:c.colors.border,color:c.colors.text}})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",style:{color:c.colors.textSecondary},children:["Notes"," ",e.jsxs("span",{className:"text-xs",children:["(",n==="fr"?"optionnel":"optional",")"]})]}),e.jsx("textarea",{value:t.notes||"",onChange:i=>s("notes",i.target.value),placeholder:n==="fr"?"Observations, points clÃ©s...":"Observations, key points...",rows:3,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors shadow-sm resize-none",style:{backgroundColor:c.colors.surface,borderColor:c.colors.border,color:c.colors.text}})]})]})]})},ad=({formData:t,onChange:s,errors:r,settings:l,existingSymbols:n=[],pnlInputMode:o,setPnlInputMode:a,calculatePnL:c,onOpenStrategyModal:i})=>{const{currentTheme:d}=ee(),{currentLanguage:u,t:m}=X(),p=(re,H)=>m[re]||H,x=re=>p(re,re),[f,g]=b.useState(!1),[h,y]=b.useState(!1),[j,v]=b.useState(null),[N,S]=b.useState(!1),[w,k]=b.useState(""),[M,C]=b.useState(!0),[R,P]=b.useState(()=>JSON.parse(localStorage.getItem("favorite-symbols")||"[]")),[D,T]=b.useState(()=>JSON.parse(localStorage.getItem(`custom-symbols-${t.market}`)||"[]")),[E,L]=b.useState(null),[U,_]=b.useState(null),[B,z]=b.useState(0),A=n.slice(0,5),F={futures:["ES","NQ","YM","CL","GC","SI","ZB","ZN","NG","HO","RB","PL","PA","HG"],forex:["EURUSD","GBPUSD","USDJPY","AUDUSD","EURGBP","EURJPY","GBPJPY","USDCAD","NZDUSD","USDCHF"],crypto:["BTCUSD","ETHUSD","ADAUSD","SOLUSD","BTCUSDT","ETHUSDT","ADAUSDT","SOLUSDT","DOTUSD","LINKUSD"],stocks:["AAPL","MSFT","GOOGL","TSLA","AMZN","NVDA","META","NFLX","AMD","INTC"],indices:["SPX","NDX","DJI","RUT","VIX","SPY","QQQ","IWM","VXX"],commodities:["CL","GC","SI","NG","HO","RB","PL","PA","HG","ZC","ZS","ZW"],unknown:[]};b.useEffect(()=>{const re=JSON.parse(localStorage.getItem(`custom-symbols-${t.market}`)||"[]");T(re)},[t.market]);const q=t.market?F[t.market]||[]:[],W=q.filter(re=>!R.includes(re)&&!D.includes(re)),I=$l,V=(re=>{if(!re.trim())return[];if(N)return[];if(!M)return[];const H=re.toUpperCase(),Q=[...R,...W,...D];if(Q.includes(H))return[];const fe=[...new Set(Q)];return I(fe,re).slice(0,5)})(t.symbol||""),K=I(n,w),ne=I(R,w),ue=I(W,w),le=I(D,w),je=t.market?`${p("symboles","Symboles")} (${Rc(t.market,u)})`:p("symboles","Symboles"),ye=re=>{if(!t.market||!re.trim())return;const H=JSON.parse(localStorage.getItem(`custom-symbols-${t.market}`)||"[]"),Q=re.trim().toUpperCase();if(!H.includes(Q)&&!q.includes(Q)){const fe=[...H,Q];localStorage.setItem(`custom-symbols-${t.market}`,JSON.stringify(fe)),T(fe)}},ve=re=>{if(!t.market)return;const Q=JSON.parse(localStorage.getItem(`custom-symbols-${t.market}`)||"[]").filter(fe=>fe!==re);localStorage.setItem(`custom-symbols-${t.market}`,JSON.stringify(Q)),T(Q)},se=re=>{const H=JSON.parse(localStorage.getItem("favorite-symbols")||"[]"),fe=H.includes(re)?H.filter(Z=>Z!==re):[...H,re];localStorage.setItem("favorite-symbols",JSON.stringify(fe)),P(fe)},Y=(re,H)=>{L(H),re.dataTransfer.effectAllowed="move",re.dataTransfer.setData("text/plain",H)},te=(re,H)=>{re.preventDefault(),re.dataTransfer.dropEffect="move",_(H)},G=()=>{_(null)},he=(re,H)=>{if(re.preventDefault(),!E)return;const Q=R.indexOf(E);if(Q===-1||Q===H){L(null),_(null);return}const fe=[...R],[Z]=fe.splice(Q,1);fe.splice(H,0,Z),localStorage.setItem("favorite-symbols",JSON.stringify(fe)),P(fe),L(null),_(null)},we=()=>{L(null),_(null)};b.useEffect(()=>{const re=H=>{if(H.altKey&&H.key.toLowerCase()==="s"){H.preventDefault(),S(!0);return}if(H.key==="Escape"){S(!1);return}if(N){if(H.key==="Enter"&&K.length>0){H.preventDefault();const Q=K[B];Q&&Te(Q);return}if(["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(H.key)){H.preventDefault();const Q=2,fe=K.length;if(fe===0)return;z(Z=>H.key==="ArrowDown"?Math.min(Z+Q,fe-1):H.key==="ArrowUp"?Math.max(Z-Q,0):H.key==="ArrowRight"?Math.min(Z+1,fe-1):H.key==="ArrowLeft"?Math.max(Z-1,0):Z)}}};return document.addEventListener("keydown",re),()=>document.removeEventListener("keydown",re)},[N,K,B]);const Ie=(re,H)=>{const Q=Al(re,H,t.market);if(El(H,t.market)){const oe=Ll(re,H,t.market,u),me=window.confirm(oe+`

`+p("m_moriser_ce_choix_pour_ce_symbole__","MÃ©moriser ce choix pour ce symbole ?"));window.confirm(oe)&&(s("market",Q),me&&Fl(re,Q,H.rule,!0))}s("symbol",re);const fe=JSON.parse(localStorage.getItem("symbol-recent")||"[]"),Z=[re,...fe.filter(oe=>oe!==re)].slice(0,10);localStorage.setItem("symbol-recent",JSON.stringify(Z)),S(!1),k(""),C(!1),z(0)},Te=b.useCallback(re=>{const H=Rl(re);Ie(re,H)},[]),ze=re=>{if(re===void 0){s("pnlPercentage",void 0),s("pnl",void 0);return}if(o==="percentage"){s("pnlPercentage",re);const H=c(re,"percentage");s("pnl",H)}else if(s("pnl",re),t.entryPrice&&t.quantity){const H=t.entryPrice*t.quantity,Q=re/H*100;s("pnlPercentage",Q)}};return e.jsxs("div",{className:"h-full flex flex-col animate-fadeIn",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:d.colors.textSecondary},children:[p("marche","MarchÃ©")," *"]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-6 gap-2",children:[{id:"futures",label:p("futures","Futures")},{id:"stocks",label:p("stocks","Actions")},{id:"forex",label:p("forex","Forex")},{id:"crypto",label:p("crypto","Crypto")},{id:"indices",label:p("indices","Indices")},{id:"commodities",label:p("commodities","MatiÃ¨res PremiÃ¨res")}].map(re=>e.jsx("button",{type:"button",onClick:()=>s("market",re.id),className:`px-2 py-2 rounded-lg border-2 text-xs font-medium transition-all text-center leading-tight ${t.market===re.id?"shadow-md":"hover:shadow-sm"}`,style:{backgroundColor:t.market===re.id?d.colors.accent:d.colors.surface,color:t.market===re.id?"#ffffff":d.colors.text,borderColor:t.market===re.id?d.colors.accent:d.colors.border,minHeight:"40px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{className:"break-words hyphens-auto",children:re.label})},re.id))}),r.market&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:d.colors.danger},children:r.market})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:d.colors.textSecondary},children:[p("symbole","Symbole")," *"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex space-x-2 relative",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:t.symbol||"",onChange:re=>{s("symbol",re.target.value.toUpperCase()),C(!0)},placeholder:p("ex__es__eurusd__aapl___","Ex: EURUSD, AAPL..."),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors shadow-sm",style:{backgroundColor:d.colors.surface,borderColor:r.symbol?d.colors.danger:d.colors.border,color:d.colors.text}}),e.jsx(Qo,{suggestions:V,favoriteSymbols:R,customSymbols:D,theme:d,onSelect:Te,onToggleFavorite:se,onRemoveCustom:ve})]}),e.jsx("button",{type:"button",onClick:()=>{S(!0),k("")},className:"px-3 py-2 border rounded-lg transition-all duration-200 hover:shadow-sm flex items-center",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.text},title:p("alt_s_pour_ouvrir","Alt+S pour ouvrir"),children:e.jsx(Br,{size:16})})]}),A.length>0&&t.symbol!==A[0]&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-2",style:{color:d.colors.textMuted},children:x("recents")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:A.map(re=>e.jsx("button",{type:"button",onClick:()=>Te(re),className:"px-3 py-1 text-xs rounded-full border transition-all duration-200 hover:shadow-sm",style:{backgroundColor:t.symbol===re?d.colors.accent:d.colors.surface,borderColor:d.colors.border,color:t.symbol===re?"#ffffff":d.colors.text},children:re},re))})]})]}),r.symbol&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:d.colors.danger},children:r.symbol})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:d.colors.textSecondary},children:[p("direction","Direction")," *"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>s("side","long"),className:`px-3 py-2 rounded-lg border-2 text-sm font-medium transition-all ${t.side==="long"?"shadow-md":"hover:shadow-sm"}`,style:{backgroundColor:t.side==="long"?d.colors.success:d.colors.surface,color:t.side==="long"?"#ffffff":d.colors.text,borderColor:t.side==="long"?d.colors.success:d.colors.border},children:p("long","Long")}),e.jsx("button",{type:"button",onClick:()=>s("side","short"),className:`px-3 py-2 rounded-lg border-2 text-sm font-medium transition-all ${t.side==="short"?"shadow-md":"hover:shadow-sm"}`,style:{backgroundColor:t.side==="short"?d.colors.danger:d.colors.surface,color:t.side==="short"?"#ffffff":d.colors.text,borderColor:t.side==="short"?d.colors.danger:d.colors.border},children:p("short","Short")})]}),r.side&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:d.colors.danger},children:r.side})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"block text-sm font-semibold",style:{color:d.colors.textSecondary},children:[u==="fr"?"Gain/Perte":"Gain/Loss"," *"]}),e.jsx(Ul,{mode:o,onModeChange:a,disabled:!1})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",value:o==="percentage"?t.pnlPercentage||"":t.pnl||"",onChange:re=>{const H=re.target.value;if(H==="")ze(void 0);else{const Q=parseFloat(H);isNaN(Q)||ze(Q)}},placeholder:o==="percentage"?u==="fr"?"Ex: 2.5 (pour +2.5%)":"Ex: 2.5 (for +2.5%)":u==="fr"?"Ex: 150 (pour +150â‚¬)":"Ex: 150 (for +150â‚¬)",className:"w-full px-3 py-2 pr-24 border rounded-lg focus:outline-none focus:ring-2 transition-colors shadow-sm",style:{backgroundColor:d.colors.surface,borderColor:r.pnl||r.pnlPercentage?d.colors.danger:d.colors.border,color:d.colors.text}}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center gap-2 text-sm font-medium",style:{color:d.colors.textMuted},children:[(o==="percentage"?t.pnlPercentage:t.pnl)!==void 0&&(o==="percentage"?t.pnlPercentage:t.pnl)!==0&&((o==="percentage"?t.pnlPercentage:t.pnl)>0?e.jsx(Ee,{size:16,style:{color:d.colors.success}}):e.jsx(Ot,{size:16,style:{color:d.colors.danger}})),e.jsx("span",{children:o==="percentage"?"%":l?.currency||"EUR"})]})]}),(r.pnl||r.pnlPercentage)&&e.jsx("p",{className:"text-sm font-medium",style:{color:d.colors.danger},children:r.pnl||r.pnlPercentage}),o==="percentage"&&t.pnlPercentage!==void 0&&e.jsx("div",{className:"text-xs p-3 rounded-lg border",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.textMuted},children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(us,{size:12}),e.jsx("span",{children:u==="fr"?`AperÃ§u: ${t.pnlPercentage>0?"+":""}${t.pnlPercentage}% = ${new Intl.NumberFormat("fr-FR",{style:"currency",currency:l?.currency||"EUR"}).format((l?.initialCapital||1e4)*t.pnlPercentage/100)}`:`Preview: ${t.pnlPercentage>0?"+":""}${t.pnlPercentage}% = ${new Intl.NumberFormat("en-US",{style:"currency",currency:l?.currency||"EUR"}).format((l?.initialCapital||1e4)*t.pnlPercentage/100)}`})]})})]})]}),e.jsx(nd,{formData:t,onChange:s,settings:l})]}),e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx("div",{children:e.jsx("button",{type:"button",onClick:()=>g(re=>!re),className:"text-sm px-3 py-2 rounded-lg border transition-colors",style:{backgroundColor:d.colors.surface,color:d.colors.text,borderColor:d.colors.border},children:f?u==="fr"?"- dÃ©tails":"- details":u==="fr"?"+ dÃ©tails":"+ details"})}),f&&e.jsx(ld,{formData:t,onChange:s,settings:l,t1:x,currentLanguage:u,setTimeframeOverlay:y,setTimeframeButtonRef:v}),f&&t.market!=="futures"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:d.colors.textSecondary},children:[p("quantite","QuantitÃ©")," *"]}),e.jsx("input",{type:"number",step:"0.01",value:t.quantity||"",onChange:re=>s("quantity",parseFloat(re.target.value)||void 0),placeholder:p("ex__1__10___","Ex: 1, 10..."),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors shadow-sm",style:{backgroundColor:d.colors.surface,borderColor:r.quantity?d.colors.danger:d.colors.border,color:d.colors.text}}),r.quantity&&e.jsx("p",{className:"mt-2 text-sm font-medium",style:{color:d.colors.danger},children:r.quantity})]})]})]}),e.jsx(Kr,{isOpen:N,onClose:()=>S(!1),theme:d,t1:x,symbolSearch:w,onChangeSearch:k,onAddCustomSymbol:ye,favoriteSymbols:R,filteredFavorites:ne,filteredMarketSymbols:ue,filteredCustomSymbols:le,currentSelectedSymbol:t.symbol,marketLabel:je,onSelectSymbol:Te,onToggleFavorite:se,onRemoveCustomSymbol:ve,draggedItem:E,dragOverIndex:U,onDragStart:Y,onDragOver:te,onDragLeave:G,onDrop:he,onDragEnd:we}),e.jsx(Jr,{isOpen:h,onClose:()=>y(!1),onSelect:re=>s("timeframe",re),currentValue:t.timeframe})]})},id=({currentStep:t,isQuickMode:s,formData:r,onChange:l,errors:n,settings:o,existingSymbols:a,existingTrades:c,pnlInputMode:i,setPnlInputMode:d,calculatePnL:u,onOpenStrategyModal:m,theme:p,language:x,isEditMode:f,fieldConfig:g,shouldShowField:h,toggleFieldVisibility:y,isObligatoryField:j})=>{if(s)return e.jsx(ad,{formData:r,onChange:l,errors:n,settings:o,existingSymbols:a,pnlInputMode:i,setPnlInputMode:d,calculatePnL:u,onOpenStrategyModal:m});switch(t){case"instrument-context":return e.jsx(Ac,{formData:r,onChange:l,errors:n,settings:o,existingSymbols:a,isEditMode:f,fieldConfig:g,shouldShowField:h,toggleFieldVisibility:y,isObligatoryField:j});case"position-entry":return e.jsx(qc,{formData:r,onChange:l,errors:n,settings:o,existingSymbols:a,isEditMode:f,fieldConfig:g,shouldShowField:h,toggleFieldVisibility:y,isObligatoryField:j});case"position-exit":return e.jsx(Wc,{formData:r,onChange:l,errors:n,settings:o,existingSymbols:a,isEditMode:f,fieldConfig:g,shouldShowField:h,toggleFieldVisibility:y,isObligatoryField:j});case"risk-reward":return e.jsx(Jc,{formData:r,onChange:l,errors:n,settings:o,existingSymbols:a,existingTrades:c,onOpenStrategyModal:m,isEditMode:f,fieldConfig:g,shouldShowField:h,toggleFieldVisibility:y,isObligatoryField:j});case"notes-screenshots":return e.jsx(od,{formData:r,onChange:l,errors:n,settings:o,existingSymbols:a,isEditMode:f,fieldConfig:g,shouldShowField:h,toggleFieldVisibility:y,isObligatoryField:j});default:return e.jsx("div",{className:"p-6 text-center",style:{color:p.colors.textMuted},children:x==="fr"?"Ã‰tape en cours de dÃ©veloppement":"Step under development"})}},cd=({isQuickMode:t,onToggle:s})=>{const{currentTheme:r}=ee(),{currentLanguage:l}=X();return e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("button",{onClick:s,className:`flex items-center space-x-2 px-3 py-2 rounded-lg border-2 transition-all duration-200 hover:shadow-sm ${t?"border-0 shadow-md transform scale-105":"hover:shadow-sm"}`,style:{backgroundColor:t?r.colors.accent:r.colors.surface,color:t?"#ffffff":r.colors.text,borderColor:t?"transparent":r.colors.border},children:[e.jsx(dr,{size:16,style:{color:t?"#ffffff":r.colors.textMuted}}),e.jsx("span",{className:"text-sm font-medium",children:l==="fr"?"Mode Rapide":"Quick Mode"})]})})},dd=({isOpen:t,name:s,onNameChange:r,onCancel:l,onSubmit:n,theme:o,language:a})=>t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-[90]",children:e.jsxs("div",{className:"rounded-lg shadow-xl max-w-md w-full",style:{backgroundColor:o.colors.card},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",style:{borderColor:o.colors.border},children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:o.colors.text},children:a==="fr"?"CrÃ©er une stratÃ©gie":"Create a strategy"}),e.jsx("button",{onClick:l,className:"p-2 rounded-lg hover:theme-surface",title:a==="fr"?"Fermer":"Close",children:e.jsx(be,{size:18})})]}),e.jsxs("form",{onSubmit:c=>{c.preventDefault(),n()},className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:o.colors.text},children:a==="fr"?"Nom de la stratÃ©gie *":"Strategy Name *"}),e.jsx("input",{type:"text",value:s,onChange:c=>r(c.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent",style:{backgroundColor:o.colors.surface,borderColor:o.colors.border,color:o.colors.text},autoFocus:!0})]}),e.jsx("div",{children:e.jsx("p",{className:"text-sm",style:{color:o.colors.textMuted},children:a==="fr"?"Vous allez crÃ©er une nouvelle stratÃ©gie personnalisÃ©e et pourrez immÃ©diatement la configurer (timeframes, symboles, etc.).":"You are about to create a new custom strategy and will be able to configure it immediately (timeframes, symbols, etc.)."})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",style:{borderColor:o.colors.border},children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 rounded-lg hover:bg-opacity-80 transition-colors",style:{backgroundColor:o.colors.surface,color:o.colors.text},children:a==="fr"?"Annuler":"Cancel"}),e.jsxs("button",{type:"submit",className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:o.colors.accent,color:"#ffffff"},children:[e.jsx(Ye,{size:16}),e.jsx("span",{children:a==="fr"?"CrÃ©er et Configurer":"Create and Configure"})]})]})]})]})}):null,ud=({isOpen:t,preset:s,stats:r,theme:l,language:n,onClose:o,onOpenHistory:a})=>!t||!s?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-[90]",children:e.jsxs("div",{className:"rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",style:{backgroundColor:l.colors.card},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b sticky top-0 bg-inherit",style:{borderColor:l.colors.border},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-2xl",children:s.emoji||"ðŸ“Š"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:l.colors.text},children:s.name}),e.jsx("p",{className:"text-sm",style:{color:l.colors.textMuted},children:s.description||(n==="fr"?"Aucune description":"No description")})]})]}),e.jsx("button",{onClick:o,className:"p-2 rounded-full transition-colors hover:bg-opacity-10",style:{color:l.colors.textMuted,backgroundColor:`${l.colors.textMuted}10`},children:e.jsx(be,{size:20})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{backgroundColor:l.colors.surface},children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(He,{size:20,style:{color:l.colors.accent}})}),e.jsx("div",{className:"text-2xl font-bold mb-1",style:{color:l.colors.text},children:r?.totalTrades||0}),e.jsx("div",{className:"text-xs",style:{color:l.colors.textMuted},children:"Trades"})]}),e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{backgroundColor:l.colors.surface},children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(Ee,{size:20,style:{color:"#10b981"}})}),e.jsx("div",{className:"text-2xl font-bold mb-1",style:{color:l.colors.text},children:r?`${r.winRate.toFixed(1)}%`:"0%"}),e.jsx("div",{className:"text-xs",style:{color:l.colors.textMuted},children:"Win Rate"})]}),e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{backgroundColor:l.colors.surface},children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(it,{size:20,style:{color:"#f59e0b"}})}),e.jsx("div",{className:"text-2xl font-bold mb-1",style:{color:r&&r.totalPnL>=0?"#10b981":"#ef4444"},children:r?`${r.totalPnL>=0?"+":""}${r.totalPnL.toFixed(2)}â‚¬`:"0â‚¬"}),e.jsx("div",{className:"text-xs",style:{color:l.colors.textMuted},children:n==="fr"?"P&L Total":"Total P&L"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",style:{borderColor:l.colors.border},children:[e.jsx("button",{onClick:o,className:"px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:l.colors.surface,color:l.colors.text,border:`1px solid ${l.colors.border}`},children:n==="fr"?"Fermer":"Close"}),r&&r.totalTrades>0?e.jsxs("button",{onClick:a,className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors hover:opacity-90",style:{backgroundColor:l.colors.accent,color:"#ffffff"},children:[e.jsx(ds,{size:16}),e.jsx("span",{children:n==="fr"?"Voir l'historique des trades":"View Trade History"})]}):e.jsxs("div",{className:"flex items-center space-x-2 px-4 py-2 rounded-lg",style:{backgroundColor:l.colors.surface,color:l.colors.textMuted,border:`1px solid ${l.colors.border}`},children:[e.jsx(ds,{size:16}),e.jsx("span",{className:"text-sm",children:n==="fr"?"Aucun trade avec cette stratÃ©gie":"No trades with this strategy"})]})]})]})]})}),md=({preset:t,onSave:s,onCancel:r,currentTheme:l,currentLanguage:n,onSelect:o})=>{const[a,c]=b.useState({name:t.name,description:t.description||"",category:t.category,riskLevel:t.riskLevel||"medium",complexity:t.complexity||"intermediate",timeframes:t.timeframes||[],markets:t.markets||[],emoji:t.emoji||"âš™ï¸",preferredSymbols:t.preferredSymbols||[]}),[i,d]=b.useState(t.timeframes||[]),[u,m]=b.useState(""),[p,x]=b.useState(""),[f,g]=b.useState(!1);b.useEffect(()=>{c(j=>({...j,timeframes:i}))},[i]),b.useEffect(()=>{const j=v=>{if(f){const N=v.target,S=document.querySelector("[data-emoji-menu]");S&&!S.contains(N)&&g(!1)}};return f&&document.addEventListener("mousedown",j),()=>{document.removeEventListener("mousedown",j)}},[f]);const h=j=>{j.preventDefault(),s(a)},y=()=>{const j=u.trim().toUpperCase();j&&!a.preferredSymbols.includes(j)&&(c(v=>({...v,preferredSymbols:[...v.preferredSymbols,j]})),m(""))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-[80]",onClick:j=>j.stopPropagation(),children:e.jsxs("div",{className:"rounded-lg shadow-xl max-w-md w-full max-h-[90vh] flex flex-col",style:{backgroundColor:l.colors.card},onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b flex-shrink-0",style:{borderColor:l.colors.border},children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:l.colors.text},children:n==="fr"?"Modifier la StratÃ©gie":"Edit Strategy"}),e.jsx("button",{onClick:r,className:"transition-colors",style:{color:l.colors.textMuted},children:e.jsx(be,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("form",{onSubmit:h,className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:l.colors.text},children:n==="fr"?"Nom de la stratÃ©gie *":"Strategy Name *"}),e.jsx("input",{type:"text",value:a.name,onChange:j=>c(v=>({...v,name:j.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},placeholder:n==="fr"?"Ma stratÃ©gie personnalisÃ©e":"My custom strategy",required:!0,disabled:t.isDefault})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:l.colors.text},children:n==="fr"?"Description (optionnel)":"Description (optional)"}),e.jsx("textarea",{value:a.description,onChange:j=>c(v=>({...v,description:j.target.value})),rows:3,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},placeholder:n==="fr"?"Description de votre stratÃ©gie...":"Description of your strategy..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:l.colors.text},children:n==="fr"?"CatÃ©gorie":"Category"}),e.jsx("select",{value:a.category,onChange:j=>c(v=>({...v,category:j.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},disabled:t.isDefault,children:Hr.map(j=>e.jsx("option",{value:j.id,children:j.name},j.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:l.colors.text},children:n==="fr"?"Niveau de risque":"Risk Level"}),e.jsx("select",{value:a.riskLevel,onChange:j=>c(v=>({...v,riskLevel:j.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},children:Gr.map(j=>e.jsx("option",{value:j.id,children:j.name},j.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:l.colors.text},children:n==="fr"?"Emoji personnalisÃ©":"Custom Emoji"}),e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"text",value:a.emoji,onChange:j=>c(v=>({...v,emoji:j.target.value})),className:"w-16 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent text-center text-xl",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},maxLength:4}),e.jsx("div",{className:"ml-3 flex-1 flex items-center",children:e.jsxs("div",{className:"flex flex-wrap gap-2 relative",children:[["ðŸ“ˆ","ðŸ“‰","ðŸ“Š","ðŸ’¹","âš¡","ðŸ”","ðŸŽ¯","ðŸ”„","âš™ï¸","ðŸŒŠ","ðŸ””","ðŸ’°"].map(j=>e.jsx("button",{onClick:v=>{v.stopPropagation(),v.preventDefault(),c(N=>({...N,emoji:j})),g(!1)},className:`w-8 h-8 flex items-center justify-center rounded-lg text-xl transition-all ${a.emoji===j?"ring-2":""}`,style:{backgroundColor:a.emoji===j?`${l.colors.accent}20`:l.colors.surface,borderColor:a.emoji===j?l.colors.accent:l.colors.border},children:j},j)),e.jsx("button",{onClick:j=>{j.stopPropagation(),j.preventDefault(),g(!f)},className:"w-8 h-8 flex items-center justify-center rounded-lg text-sm font-bold transition-all hover:scale-110",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},title:n==="fr"?"Plus d'emojis":"More emojis",children:"+"}),f&&e.jsx("div",{"data-emoji-menu":!0,className:"absolute top-10 left-0 z-50 p-3 rounded-lg shadow-lg border max-h-48 overflow-y-auto",style:{backgroundColor:l.colors.card,borderColor:l.colors.border,minWidth:"200px"},children:e.jsx("div",{className:"flex flex-wrap gap-2",children:["ðŸš€","ðŸ’Ž","ðŸ”¥","â­","ðŸ’ª","ðŸŽ²","ðŸ†","ðŸŒŸ","ðŸ’¡","âš”ï¸","ðŸŽ¨","ðŸŽ­","ðŸŽ¸","ðŸŽ¹","ðŸŽº","ðŸŽ»","ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰","ðŸ…","ðŸŽ–ï¸"].map(j=>e.jsx("button",{onClick:v=>{v.stopPropagation(),v.preventDefault(),c(N=>({...N,emoji:j})),g(!1)},className:`w-8 h-8 flex items-center justify-center rounded-lg text-xl transition-all hover:scale-110 ${a.emoji===j?"ring-2":""}`,style:{backgroundColor:a.emoji===j?`${l.colors.accent}20`:l.colors.surface,borderColor:a.emoji===j?l.colors.accent:l.colors.border},children:j},j))})})]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:l.colors.text},children:"Timeframes"}),e.jsxs("div",{className:"border rounded-lg p-3",style:{borderColor:l.colors.border,backgroundColor:l.colors.surface},children:[e.jsx("div",{className:"mb-1 text-xs",style:{color:l.colors.textMuted},children:n==="fr"?"SÃ©lectionnez ou ajoutez des timeframes adaptÃ©s Ã  cette stratÃ©gie":"Select or add timeframes suitable for this strategy"}),e.jsxs("div",{className:"flex mb-3",children:[e.jsx("input",{type:"text",value:p,onChange:j=>x(j.target.value),className:"flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent text-sm",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},placeholder:n==="fr"?"Ajouter un timeframe (ex: 2h, 50t, 1w)...":"Add timeframe (ex: 2h, 50t, 1w)..."}),e.jsx("button",{type:"button",onClick:()=>{p.trim()&&!i.includes(p.trim())&&(d(j=>[...j,p.trim()]),x(""))},className:"ml-2 px-3 py-2 rounded-lg transition-colors",style:{backgroundColor:l.colors.accent,color:"#ffffff"},disabled:!p.trim()||i.includes(p.trim()),children:e.jsx(Ye,{size:16})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:["5s","15s","30s","1m","5m","15m","30m","1h","4h","1d","1w"].map(j=>e.jsx("button",{type:"button",onClick:()=>{i.includes(j)?d(v=>v.filter(N=>N!==j)):d(v=>[...v,j])},className:"px-2 py-1 rounded-lg text-xs font-medium transition-colors",style:{backgroundColor:i.includes(j)?l.colors.accent:l.colors.surface,color:i.includes(j)?"#ffffff":l.colors.text,border:`1px solid ${i.includes(j)?l.colors.accent:l.colors.border}`},children:j},j))}),i.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",style:{color:l.colors.textMuted},children:n==="fr"?"Timeframes sÃ©lectionnÃ©s :":"Selected timeframes:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(j=>e.jsxs("div",{className:"flex items-center px-2 py-1 rounded-lg text-xs",style:{backgroundColor:l.colors.accent+"20",border:`1px solid ${l.colors.accent}`},children:[e.jsx("span",{style:{color:l.colors.text},children:j}),e.jsx("button",{type:"button",onClick:()=>{d(v=>v.filter(N=>N!==j))},className:"ml-1 p-0.5 rounded-full",style:{color:l.colors.textMuted},children:e.jsx(be,{size:12})})]},j))})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:l.colors.text},children:n==="fr"?"Symboles prÃ©fÃ©rÃ©s":"Preferred Symbols"}),e.jsxs("div",{className:"border rounded-lg p-3",style:{borderColor:l.colors.border,backgroundColor:l.colors.surface},children:[e.jsxs("div",{className:"flex mb-1",children:[e.jsx("input",{type:"text",value:u,onChange:j=>m(j.target.value),onKeyPress:j=>{j.key==="Enter"&&(j.preventDefault(),y())},className:"flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent text-sm",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},placeholder:n==="fr"?"Ajouter un symbole...":"Add a symbol..."}),e.jsx("button",{type:"button",onClick:y,className:"ml-2 px-3 py-2 rounded-lg transition-colors",style:{backgroundColor:l.colors.accent,color:"#ffffff"},disabled:!u.trim(),children:e.jsx(Ye,{size:16})})]}),a.preferredSymbols.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:a.preferredSymbols.map(j=>e.jsxs("div",{className:"flex items-center px-2 py-1 rounded-lg text-xs",style:{backgroundColor:l.colors.surface,border:`1px solid ${l.colors.border}`},children:[j,e.jsx("button",{type:"button",onClick:()=>{c(v=>({...v,preferredSymbols:v.preferredSymbols.filter(N=>N!==j)}))},className:"ml-1 p-0.5 rounded-full",style:{color:l.colors.textMuted},children:e.jsx(be,{size:12})})]},j))}):e.jsx("div",{className:"text-xs italic",style:{color:l.colors.textMuted},children:n==="fr"?"Aucun symbole ajoutÃ©":"No symbols added"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",style:{borderColor:l.colors.border},children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 rounded-lg hover:bg-opacity-80 transition-colors",style:{backgroundColor:l.colors.surface,color:l.colors.text},children:n==="fr"?"Annuler":"Cancel"}),e.jsxs("button",{type:"submit",className:"flex items-center px-5 py-2.5 rounded-lg transition-colors font-medium text-base",style:{backgroundColor:l.colors.accent,color:"#ffffff"},children:[e.jsx(Dt,{size:18,className:"mr-1"}),n==="fr"?"Enregistrer":"Save"]})]})]})})]})})},xd=({isOpen:t,preset:s,theme:r,language:l,onSave:n,onCancel:o,onSelect:a})=>!t||!s?null:e.jsx(md,{preset:s,onSave:n,onCancel:o,onSelect:a,currentTheme:r,currentLanguage:l}),fd=({theme:t,language:s,searchQuery:r,canCreate:l,onCreate:n,onClose:o})=>e.jsxs("div",{className:"flex justify-between items-center p-6 border-t flex-shrink-0",style:{borderColor:t.colors.border,backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"text-sm",style:{color:t.colors.textMuted},children:["ðŸ’¡ ",s==="fr"?"Tapez le nom d'une nouvelle stratÃ©gie pour la crÃ©er rapidement":"Type a new strategy name to create it quickly"]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 border rounded-lg hover:bg-opacity-80 transition-colors",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text},children:s==="fr"?"Fermer":"Close"}),l&&e.jsxs("button",{onClick:n,className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:t.colors.accent,color:"#ffffff"},children:[e.jsx(Ye,{size:16}),e.jsx("span",{children:s==="fr"?`CrÃ©er "${r.slice(0,20)}${r.length>20?"...":""}"`:`Create "${r.slice(0,20)}${r.length>20?"...":""}"`})]})]})]}),pd=({isOpen:t,theme:s,language:r,name:l,onCancel:n,onConfirm:o})=>t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-[95]",children:e.jsxs("div",{className:"rounded-lg shadow-xl w-full max-w-sm",style:{backgroundColor:s.colors.card},children:[e.jsx("div",{className:"px-5 py-4 border-b",style:{borderColor:s.colors.border},children:e.jsx("h3",{className:"text-base font-semibold",style:{color:s.colors.text},children:r==="fr"?"Supprimer la stratÃ©gie ?":"Delete strategy?"})}),e.jsx("div",{className:"px-5 py-4",style:{color:s.colors.text},children:r==="fr"?`Voulez-vous vraiment supprimer "${l}" ?`:`Do you really want to delete "${l}"?`}),e.jsxs("div",{className:"px-5 py-4 border-t flex justify-end gap-2",style:{borderColor:s.colors.border},children:[e.jsx("button",{onClick:n,className:"px-3 py-1.5 rounded border",style:{backgroundColor:s.colors.surface,color:s.colors.text,borderColor:s.colors.border},children:r==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:o,className:"px-3 py-1.5 rounded",style:{backgroundColor:s.colors.danger,color:"#fff"},children:r==="fr"?"Supprimer":"Delete"})]})]})}):null,hd=({createPreset:t,updatePreset:s,deletePreset:r,toggleFavorite:l,setShowCreateForm:n})=>{const[o,a]=b.useState(!1),[c,i]=b.useState(null),[d,u]=b.useState(null),m=b.useCallback(j=>{i(j),a(!0)},[]),p=b.useCallback(()=>{a(!1),i(null)},[]),x=b.useCallback(j=>{const v=t({name:j,description:"",category:"custom",riskLevel:"medium",complexity:"intermediate",timeframes:[],markets:[],emoji:"âš™ï¸",preferredSymbols:[],isFavorite:!1});i(v),n(!1),a(!0)},[t,n]),f=b.useCallback(j=>{d===j.id?(r(j.id),u(null)):(u(j.id),setTimeout(()=>{u(v=>v===j.id?null:v)},3e3))},[d,r]),g=b.useCallback(()=>u(null),[]),h=b.useCallback(j=>{r(j.id),u(null)},[r]),y=b.useCallback(j=>{l(j)},[l]);return{showEditForm:o,editingPreset:c,openEdit:m,closeEdit:p,createAndEdit:x,deleteConfirmId:d,handleDelete:f,resetDeleteConfirm:g,forceDelete:h,onToggleFavorite:y}};ws.set({precision:40,rounding:ws.ROUND_HALF_UP});function Ce(t){if(typeof t!="string")throw new Error(`toDecimal: expected string, got ${typeof t}`);if(t.trim()==="")throw new Error("toDecimal: empty string is not a valid decimal");try{const s=new ws(t);if(!s.isFinite())throw new Error(`toDecimal: "${t}" is not a finite number`);return s}catch(s){throw s instanceof Error?new Error(`toDecimal: invalid decimal string "${t}": ${s.message}`):new Error(`toDecimal: invalid decimal string "${t}"`)}}function Rt(t,s){return Xr(t,s,"dAdd"),t.add(s)}function Yr(t,s){return Xr(t,s,"dSub"),t.sub(s)}function ft(t,s){return Xr(t,s,"dMul"),t.mul(s)}function vs(t,s){if(Xr(t,s,"dDiv"),s.isZero())throw new Error("dDiv: division by zero is not allowed");return t.div(s)}function gd(t,s){if(!(t instanceof ws))throw new Error(`dRound: expected Decimal, got ${typeof t}`);if(typeof s!="number"||s<0||!Number.isInteger(s))throw new Error(`dRound: decimals must be a non-negative integer, got ${s}`);return t.toDecimalPlaces(s,ws.ROUND_HALF_UP)}function Xr(t,s,r){if(!(t instanceof ws))throw new Error(`${r}: first argument must be a Decimal, got ${typeof t}`);if(!(s instanceof ws))throw new Error(`${r}: second argument must be a Decimal, got ${typeof s}`);if(!t.isFinite())throw new Error(`${r}: first argument is not finite`);if(!s.isFinite())throw new Error(`${r}: second argument is not finite`)}function os(t){return Ce(t===void 0?"0":String(t))}function yd(t){const s=os(t.commission),r=os(t.exchange),l=os(t.spread),n=os(t.swap);return Rt(Rt(s,r),Rt(l,n))}function bd(t,s){return Rt(t,s)}function vd(t,s){const{base:r,decimals:l=2}=s;if(r.isZero())return Ce("0");const n=ft(vs(t,r),Ce("100"));return gd(n,l)}function Dr(t,s,r="equity",l=2){const n=os(t.pnl??0),o=yd({commission:t.fees?.commission??t.commission??0,exchange:t.fees?.exchangeFees??0,spread:t.fees?.spread??0,swap:t.fees?.swapOvernight??0}),a=bd(n,o);let c;if(r==="equity")c=os(s.initialCapital);else{const d=os(t.entryPrice??0),u=os(t.quantity??0),m=ft(d,u);c=m.isZero()?os(s.initialCapital):m.abs()}const i=vd(a,{base:c,decimals:l});return{gross:n,totalFees:o,net:a,percent:i}}const jd=(t,s)=>{if(t.pnlPercentage!==void 0&&t.pnlPercentage!==0)return{pnl:s.initialCapital*t.pnlPercentage/100,pnlPercentage:t.pnlPercentage};if(!t.exitPrice||t.exitPrice===0)return{pnl:0,pnlPercentage:0};let r;t.side==="long"?r=(t.exitPrice-t.entryPrice)*t.quantity:r=(t.entryPrice-t.exitPrice)*t.quantity;const l=r,n=l/s.initialCapital*100;return{pnl:l,pnlPercentage:n}};function Nd(t){const s=new Date(t);return["january","february","march","april","may","june","july","august","september","october","november","december"][s.getMonth()]}function Pn(t){if(!t)return-1;const s=parseInt(t.split(":")[0]);return isNaN(s)?-1:s}function kd(t){const s=new Date(t);return["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][s.getDay()]}function wd(t){return t>=0&&t<8?"asia":t>=8&&t<14?"eu":t>=14&&t<16?"overlap":t>=16&&t<21?"us":t>=21&&t<24?"close":"asia"}const Sd=(t,s)=>t.filter(r=>{if(s.dateRange?.start&&s.dateRange?.end){const l=new Date(r.date),n=new Date(s.dateRange.start),o=new Date(s.dateRange.end);if(l<n||l>o)return!1}if(s.timeRange?.start&&s.timeRange?.end&&r.time){const l=r.time,n=s.timeRange.start,o=s.timeRange.end;if(n<=o){if(l<n||l>o)return!1}else if(l<n&&l>o)return!1}if(s.weekdays&&s.weekdays.length>0){const l=kd(r.date);if(!s.weekdays.includes(l))return!1}if(s.months&&s.months.length>0){const l=Nd(r.date);if(!s.months.includes(l))return!1}if(s.hours&&s.hours.length>0){const l=Pn(r.time);if(l===-1||!s.hours.includes(l))return!1}if(s.sessions&&s.sessions.length>0&&r.time){const l=Pn(r.time);if(l===-1)return!1;const n=wd(l);if(!s.sessions.includes(n))return!1}if(s.pnlRange){let l;s.pnlUnit==="percent"?l=r.pnlPercentage||0:l=r.pnl||0;const n=s.pnlRange.min!==void 0?s.pnlRange.min:-1/0,o=s.pnlRange.max!==void 0?s.pnlRange.max:1/0;if(l<n||l>o)return!1}if(s.durationRange&&r.duration!==void 0){const l=s.durationUnit||"minutes",{toSecondsInterval:n}=require("../utils/durationValidation"),{minSeconds:o,maxSeconds:a}=n(s.durationRange.min,s.durationRange.max,l);if(o!==void 0&&r.duration<o||a!==void 0&&r.duration>a)return!1}if(s.ticksRange&&r.ticksGained!==void 0){const l=s.ticksRange.min!==void 0?s.ticksRange.min:-1/0,n=s.ticksRange.max!==void 0?s.ticksRange.max:1/0;if(r.ticksGained<l||r.ticksGained>n)return!1}if(s.feesRange){const l=r.fees?.total||r.commission||0,n=s.feesRange.min!==void 0?s.feesRange.min:-1/0,o=s.feesRange.max!==void 0?s.feesRange.max:1/0;if(l<n||l>o)return!1}if(s.lotsRange&&r.numberOfLots!==void 0){const l=s.lotsRange.min!==void 0?s.lotsRange.min:0,n=s.lotsRange.max!==void 0?s.lotsRange.max:1/0;if(r.numberOfLots<l||r.numberOfLots>n)return!1}if(s.tradeResult){const{takeProfit:l,stopLoss:n,breakEven:o}=s.tradeResult;if(l&&r.tradeResult!=="tp"||n&&r.tradeResult!=="sl"||o&&r.tradeResult!=="be")return!1}if(s.market){if(Array.isArray(s.market)){if(s.market.length>0&&!s.market.includes(r.market))return!1}else if(s.market!=="all"&&r.market!==s.market)return!1}if(s.trend&&s.trend.length>0&&!s.trend.includes(r.trend))return!1;if(s.strategy){if(Array.isArray(s.strategy)){if(s.strategy.length>0&&!s.strategy.includes(r.strategy))return!1}else if(s.strategy!=="all"&&r.strategy!==s.strategy)return!1}if(s.status){if(Array.isArray(s.status)){if(s.status.length>0&&!s.status.includes(r.status))return!1}else if(s.status!=="all"&&r.status!==s.status)return!1}if(s.side){if(Array.isArray(s.side)){if(s.side.length>0&&!s.side.includes(r.side))return!1}else if(s.side!=="all"&&r.side!==s.side)return!1}if(s.symbol){if(Array.isArray(s.symbol)){if(s.symbol.length>0&&!s.symbol.some(l=>r.symbol.toLowerCase().indexOf(l.toLowerCase())!==-1))return!1}else if(r.symbol.toLowerCase().indexOf(s.symbol.toLowerCase())===-1)return!1}return!(s.tags&&s.tags.length>0&&!s.tags.some(n=>r.tags.some(o=>o.toLowerCase().includes(n.toLowerCase()))))}),Hl=t=>{let s=0;return t.dateRange?.start&&t.dateRange?.end&&s++,t.timeRange?.start&&t.timeRange?.end&&s++,t.sessions&&t.sessions.length>0&&s++,t.months&&t.months.length>0&&s++,t.weekdays&&t.weekdays.length>0&&s++,t.hours&&t.hours.length>0&&s++,t.symbol&&s++,t.strategy&&s++,t.trend&&t.trend.length>0&&s++,t.side&&s++,t.status&&s++,t.market&&t.market!=="all"&&s++,(t.pnlRange?.min!==void 0||t.pnlRange?.max!==void 0)&&s++,(t.durationRange?.min!==void 0||t.durationRange?.max!==void 0)&&s++,(t.tradeResult?.takeProfit||t.tradeResult?.stopLoss||t.tradeResult?.breakEven)&&s++,(t.feesRange?.min!==void 0||t.feesRange?.max!==void 0)&&s++,(t.contractsRange?.min!==void 0||t.contractsRange?.max!==void 0)&&s++,(t.lotsRange?.min!==void 0||t.lotsRange?.max!==void 0)&&s++,(t.ticksRange?.min!==void 0||t.ticksRange?.max!==void 0)&&s++,t.tags&&t.tags.length>0&&s++,s},Gl=(t,s)=>{const r=[];if(t.dateRange?.start&&t.dateRange?.end){const l=new Date(t.dateRange.start).toLocaleDateString("fr-FR"),n=new Date(t.dateRange.end).toLocaleDateString("fr-FR");r.push({category:"time",section:"dateRange",value:`${l} â†’ ${n}`,description:"Plage de dates"})}if(t.timeRange?.start&&t.timeRange?.end&&r.push({category:"time",section:"timeRange",value:`${t.timeRange.start} â†’ ${t.timeRange.end}`,description:"Plage horaire"}),t.sessions&&t.sessions.length>0){const l={asia:"Session Asie",eu:"Session EU",overlap:"Overlap EU-US",us:"Session US",close:"Session Fermeture"},n=t.sessions.map(o=>l[o]||o).join(", ");r.push({category:"time",section:"sessions",value:n,description:"Sessions de trading"})}if(t.months&&t.months.length>0){const l={january:"Janvier",february:"FÃ©vrier",march:"Mars",april:"Avril",may:"Mai",june:"Juin",july:"Juillet",august:"AoÃ»t",september:"Septembre",october:"Octobre",november:"Novembre",december:"DÃ©cembre"},n=t.months.map(o=>l[o]||o).join(", ");r.push({category:"time",section:"months",value:n,description:"Mois"})}if(t.weekdays&&t.weekdays.length>0){const l={monday:"Lundi",tuesday:"Mardi",wednesday:"Mercredi",thursday:"Jeudi",friday:"Vendredi",saturday:"Samedi",sunday:"Dimanche"},n=t.weekdays.map(o=>l[o]||o).join(", ");r.push({category:"time",section:"weekdays",value:n,description:"Jours de la semaine"})}if(t.hours&&t.hours.length>0){const l=t.hours.map(n=>`${n}h`).join(", ");r.push({category:"time",section:"hours",value:l,description:"Heures"})}if(t.symbol){const l=Array.isArray(t.symbol)?t.symbol.join(", "):t.symbol;r.push({category:"market",section:"symbol",value:l,description:"Symbole"})}if(t.strategy){const l=Array.isArray(t.strategy)?t.strategy.join(", "):t.strategy;r.push({category:"market",section:"strategy",value:l,description:s&&s.strategy||"StratÃ©gie"})}if(t.trend&&t.trend.length>0){const l={bullish:"HaussiÃ¨re",bearish:"BaissiÃ¨re",sideways:"LatÃ©rale"},n=t.trend.map(o=>l[o]||o).join(", ");r.push({category:"market",section:"trend",value:n,description:"Tendance"})}if(t.side){const l={long:"Long",short:"Short"},n=Array.isArray(t.side)?t.side.map(o=>l[o]||o).join(", "):l[t.side]||t.side;r.push({category:"market",section:"side",value:n,description:"Direction"})}if(t.status){const l={open:"Ouvert",closed:"FermÃ©"},n=Array.isArray(t.status)?t.status.map(o=>l[o]||o).join(", "):l[t.status]||t.status;r.push({category:"market",section:"status",value:n,description:"Statut"})}if(t.market&&(Array.isArray(t.market)?t.market.length>0:t.market!=="all")){const l={forex:"Forex",futures:"Futures",crypto:"Crypto",stocks:"Actions",indices:"Indices",commodities:"MatiÃ¨res PremiÃ¨res"},n=Array.isArray(t.market)?t.market.map(o=>l[o]||o).join(", "):l[t.market]||t.market;r.push({category:"market",section:"market",value:n,description:"Type de marchÃ©"})}if(t.pnlRange?.min!==void 0||t.pnlRange?.max!==void 0){let l="";t.pnlRange.min!==void 0&&t.pnlRange.max!==void 0?l=`${t.pnlRange.min}â‚¬ â†’ ${t.pnlRange.max}â‚¬`:t.pnlRange.min!==void 0?l=`> ${t.pnlRange.min}â‚¬`:t.pnlRange.max!==void 0&&(l=`< ${t.pnlRange.max}â‚¬`),r.push({category:"performance",section:"pnlRange",value:l,description:`P&L (${t.pnlUnit==="percent"?"%":"â‚¬"})`})}if(t.durationRange?.min!==void 0||t.durationRange?.max!==void 0){let l="";t.durationRange.min!==void 0&&t.durationRange.max!==void 0?l=`${t.durationRange.min} â†’ ${t.durationRange.max} ${t.durationUnit||"minutes"}`:t.durationRange.min!==void 0?l=`> ${t.durationRange.min} ${t.durationUnit||"minutes"}`:t.durationRange.max!==void 0&&(l=`< ${t.durationRange.max} ${t.durationUnit||"minutes"}`),r.push({category:"performance",section:"durationRange",value:l,description:"DurÃ©e"})}if(t.tradeResult?.takeProfit||t.tradeResult?.stopLoss||t.tradeResult?.breakEven){const l=[];t.tradeResult.takeProfit&&l.push("TP"),t.tradeResult.stopLoss&&l.push("SL"),t.tradeResult.breakEven&&l.push("BE"),r.push({category:"performance",section:"tradeResult",value:l.join(", "),description:"RÃ©sultat du trade"})}if(t.feesRange?.min!==void 0||t.feesRange?.max!==void 0){let l="";t.feesRange.min!==void 0&&t.feesRange.max!==void 0?l=`${t.feesRange.min}â‚¬ â†’ ${t.feesRange.max}â‚¬`:t.feesRange.min!==void 0?l=`> ${t.feesRange.min}â‚¬`:t.feesRange.max!==void 0&&(l=`< ${t.feesRange.max}â‚¬`),r.push({category:"performance",section:"feesRange",value:l,description:"Frais"})}if(t.contractsRange?.min!==void 0||t.contractsRange?.max!==void 0){let l="";t.contractsRange.min!==void 0&&t.contractsRange.max!==void 0?l=`${t.contractsRange.min} â†’ ${t.contractsRange.max}`:t.contractsRange.min!==void 0?l=`> ${t.contractsRange.min}`:t.contractsRange.max!==void 0&&(l=`< ${t.contractsRange.max}`),r.push({category:"exposition",section:"contractsRange",value:l,description:"Contrats engagÃ©s"})}if(t.lotsRange?.min!==void 0||t.lotsRange?.max!==void 0){let l="";t.lotsRange.min!==void 0&&t.lotsRange.max!==void 0?l=`${t.lotsRange.min} â†’ ${t.lotsRange.max}`:t.lotsRange.min!==void 0?l=`> ${t.lotsRange.min}`:t.lotsRange.max!==void 0&&(l=`< ${t.lotsRange.max}`),r.push({category:"exposition",section:"lotsRange",value:l,description:"Lots"})}if(t.ticksRange?.min!==void 0||t.ticksRange?.max!==void 0){let l="";t.ticksRange.min!==void 0&&t.ticksRange.max!==void 0?l=`${t.ticksRange.min} â†’ ${t.ticksRange.max}`:t.ticksRange.min!==void 0?l=`> ${t.ticksRange.min}`:t.ticksRange.max!==void 0&&(l=`< ${t.ticksRange.max}`),r.push({category:"exposition",section:"ticksRange",value:l,description:"Ticks"})}return t.tags&&t.tags.length>0&&r.push({category:"tags",section:"tags",value:t.tags.join(", "),description:"Tags"}),r},Jl=jd,sn=(t,s)=>{const r=t.filter(J=>J.status==="closed").map(J=>{if(J.pnl!==void 0&&J.pnlPercentage!==void 0)return J;const{pnl:xe,pnlPercentage:Ue}=Jl(J,s);return{...J,pnl:xe,pnlPercentage:Ue}}).filter(J=>J.pnl!==void 0&&J.pnlPercentage!==void 0);if(r.length===0)return{totalTrades:0,winningTrades:0,losingTrades:0,winRate:0,totalPnL:0,totalPnLPercentage:0,averageWin:0,averageLoss:0,averageWinPercentage:0,averageLossPercentage:0,profitFactor:0,largestWin:0,largestLoss:0,largestWinPercentage:0,largestLossPercentage:0,averageRiskReward:0,currentCapital:s.initialCapital,initialCapital:s.initialCapital,totalReturn:0,averageDuration:0,shortestTrade:0,longestTrade:0,averageWinDuration:0,averageLossDuration:0,totalTicks:0,averageTicksPerTrade:0,averageWinTicks:0,averageLossTicks:0,bestTickCapture:0,worstTickCapture:0,tickEfficiency:0,totalFees:0,averageFeesPerTrade:0,feesAsPercentageOfPnL:0,totalCommissions:0,totalSpreads:0,totalSwapFees:0,feesImpactOnProfitability:0,totalLots:0,averageLotsPerTrade:0,maxLotsInSingleTrade:0,averageLotsWinningTrades:0,averageLotsLosingTrades:0,maxDrawdown:0,maxDrawdownPercentage:0,tradesPerDay:0,sharpeRatio:0,monthlyReturn:0,consistencyScore:0,calmarRatio:0,recoveryFactor:0,expectancy:0,expectancyPercentage:0,averageTradesPerMonth:0,bestMonth:0,worstMonth:0,consecutiveWins:0,consecutiveLosses:0,maxConsecutiveWins:0,maxConsecutiveLosses:0,tpCount:0,slCount:0,beCount:0,tpWinRate:0,slWinRate:0,beWinRate:0};const l=J=>Dr(J,s,"equity",2).net.toNumber(),n=J=>Dr(J,s,"equity",2).percent.toNumber(),o=r.map(J=>({...J,netPnL:l(J),netPnLPercentage:n(J)})),a=o.filter(J=>J.netPnL>0),c=o.filter(J=>J.netPnL<0),i=o.reduce((J,xe)=>J+xe.netPnL,0),d=o.reduce((J,xe)=>J+xe.netPnLPercentage,0),u=a.reduce((J,xe)=>J+xe.netPnL,0),m=Math.abs(c.reduce((J,xe)=>J+xe.netPnL,0)),p=a.reduce((J,xe)=>J+xe.netPnLPercentage,0);Math.abs(c.reduce((J,xe)=>J+xe.netPnLPercentage,0));const x=a.length>0?u/a.length:0,f=c.length>0?c.reduce((J,xe)=>J+xe.netPnL,0)/c.length:0,g=a.length>0?p/a.length:0,h=c.length>0?c.reduce((J,xe)=>J+xe.netPnLPercentage,0)/c.length:0,y=m>0?u/m:u>0?1/0:0,j=a.length>0?Math.max(...a.map(J=>J.netPnL)):0,v=c.length>0?Math.min(...c.map(J=>J.netPnL)):0,N=a.length>0?Math.max(...a.map(J=>J.netPnLPercentage)):0,S=c.length>0?Math.min(...c.map(J=>J.netPnLPercentage)):0,w=r.filter(J=>J.riskReward&&J.riskReward>0),k=w.length>0?w.reduce((J,xe)=>J+(xe.riskReward||0),0)/w.length:0,M=s.initialCapital+i,C=s.initialCapital!==0?i/s.initialCapital*100:0,R=r.filter(J=>J.duration&&J.duration>0);let P=0,D=0,T=0,E=0,L=0;if(R.length>0){const J=R.map(Se=>Se.duration);P=J.reduce((Se,ie)=>Se+ie,0)/J.length,D=Math.min(...J),T=Math.max(...J);const xe=a.filter(Se=>Se.duration&&Se.duration>0);xe.length>0&&(E=xe.reduce((Se,ie)=>Se+(ie.duration||0),0)/xe.length);const Ue=c.filter(Se=>Se.duration&&Se.duration>0);Ue.length>0&&(L=Ue.reduce((Se,ie)=>Se+(ie.duration||0),0)/Ue.length)}const U=r.filter(J=>J.ticksGained!==void 0&&J.ticksGained!==0);let _=0,B=0,z=0,A=0,F=0,q=0,W=0;if(U.length>0){_=U.reduce((Se,ie)=>Se+(ie.ticksGained||0),0),B=_/U.length;const J=a.filter(Se=>Se.ticksGained!==void 0&&Se.ticksGained>0);J.length>0&&(z=J.reduce((Se,ie)=>Se+(ie.ticksGained||0),0)/J.length,F=Math.max(...J.map(Se=>Se.ticksGained||0)));const xe=c.filter(Se=>Se.ticksGained!==void 0&&Se.ticksGained<0);xe.length>0&&(A=xe.reduce((Se,ie)=>Se+(ie.ticksGained||0),0)/xe.length,q=Math.min(...xe.map(Se=>Se.ticksGained||0))),W=U.filter(Se=>(Se.ticksGained||0)>0).length/U.length*100}const I=r.reduce((J,xe)=>J+(xe.fees?.total||xe.commission||0),0),$=r.length>0?I/r.length:0,V=i-I,K=V!==0?Math.abs(I/V*100):0,ne=r.reduce((J,xe)=>J+(xe.fees?.commission||xe.commission||0),0),ue=r.reduce((J,xe)=>J+(xe.fees?.spread||0),0),le=r.reduce((J,xe)=>J+(xe.fees?.swapOvernight||0),0),je=Math.abs(I/s.initialCapital*100),ye=r.filter(J=>J.numberOfLots&&J.numberOfLots>0);let ve=0,se=0,Y=0,te=0,G=0;if(ye.length>0){ve=ye.reduce((Ue,Se)=>Ue+(Se.numberOfLots||0),0),se=ve/ye.length,Y=Math.max(...ye.map(Ue=>Ue.numberOfLots||0));const J=a.filter(Ue=>Ue.numberOfLots&&Ue.numberOfLots>0);J.length>0&&(te=J.reduce((Ue,Se)=>Ue+(Se.numberOfLots||0),0)/J.length);const xe=c.filter(Ue=>Ue.numberOfLots&&Ue.numberOfLots>0);xe.length>0&&(G=xe.reduce((Ue,Se)=>Ue+(Se.numberOfLots||0),0)/xe.length)}let he=0,we=0,Ie=s.initialCapital,Te=s.initialCapital;const ze=[...r].sort((J,xe)=>new Date(J.date+" "+(J.time||"00:00")).getTime()-new Date(xe.date+" "+(xe.time||"00:00")).getTime());ze.forEach(J=>{const xe=l(J);Te+=xe,Te>Ie&&(Ie=Te);const Ue=Ie-Te,Se=Ue/Ie*100;Ue>he&&(he=Ue,we=Se)}),he=-Math.abs(he),we=-Math.abs(we);const re=new Set(r.map(J=>J.date)).size,H=re>0?r.length/re:0,Q=o.map(J=>J.netPnLPercentage),fe=Q.reduce((J,xe)=>J+xe,0)/Q.length,Z=Q.reduce((J,xe)=>J+Math.pow(xe-fe,2),0)/Q.length,oe=Math.sqrt(Z),me=oe>0?fe/oe*Math.sqrt(252):0,ge=new Set(r.map(J=>{const xe=new Date(J.date);return`${xe.getFullYear()}-${xe.getMonth()}`})).size,Pe=ge>0?i/s.initialCapital*100/ge:0,Oe=new Map;r.forEach(J=>{const xe=J.date;l(J),Oe.set(xe,(Oe.get(xe)||0)+n(J))});const ct=Array.from(Oe.values()),tt=ct.filter(J=>J>0).length,Ct=ct.length>0?tt/ct.length*100:0,qt=Math.abs(we)>0?d/Math.abs(we):0,Ht=Math.abs(he)>0?i/Math.abs(he):0,Pt=a.length/r.length*100,Gt=Pt/100*x+(100-Pt)/100*f,rs=Pt/100*g+(100-Pt)/100*h,Ut=new Set(r.map(J=>{const xe=new Date(J.date);return`${xe.getFullYear()}-${xe.getMonth()}`})).size,Ve=Ut>0?r.length/Ut:0,de=new Map;r.forEach(J=>{const xe=new Date(J.date),Ue=`${xe.getFullYear()}-${xe.getMonth()}`;l(J),de.set(Ue,(de.get(Ue)||0)+n(J))});const ce=Array.from(de.values()),pe=ce.length>0?Math.max(...ce):0,De=ce.length>0?Math.min(...ce):0;let _e=0,Be=0,Et=0,Je=0,gt=0,ot=0;ze.forEach(J=>{const xe=l(J);xe>0?(gt++,ot=0,Et=Math.max(Et,gt)):xe<0&&(ot++,gt=0,Je=Math.max(Je,ot))}),_e=gt,Be=ot;const dt=r.filter(J=>J.tradeResult==="tp"),Ft=r.filter(J=>J.tradeResult==="sl"),At=r.filter(J=>J.tradeResult==="be"),Mt=dt.length,kt=Ft.length,ys=At.length,no=dt.length>0?dt.filter(J=>(J.pnl||0)>0).length/dt.length*100:0,lo=Ft.length>0?Ft.filter(J=>(J.pnl||0)>0).length/Ft.length*100:0,ao=At.length>0?At.filter(J=>(J.pnl||0)>0).length/At.length*100:0;return{totalTrades:r.length,winningTrades:a.length,losingTrades:c.length,winRate:a.length/r.length*100,totalPnL:i,totalPnLPercentage:d,averageWin:x,averageLoss:f,averageWinPercentage:g,averageLossPercentage:h,profitFactor:y,largestWin:j,largestLoss:v,largestWinPercentage:N,largestLossPercentage:S,averageRiskReward:k,currentCapital:M,initialCapital:s.initialCapital,totalReturn:C,averageDuration:P,shortestTrade:D,longestTrade:T,averageWinDuration:E,averageLossDuration:L,totalTicks:_,averageTicksPerTrade:B,averageWinTicks:z,averageLossTicks:A,bestTickCapture:F,worstTickCapture:q,tickEfficiency:W,totalFees:I,averageFeesPerTrade:$,feesAsPercentageOfPnL:K,totalCommissions:ne,totalSpreads:ue,totalSwapFees:le,feesImpactOnProfitability:je,totalLots:ve,averageLotsPerTrade:se,maxLotsInSingleTrade:Y,averageLotsWinningTrades:te,averageLotsLosingTrades:G,maxDrawdown:he,maxDrawdownPercentage:we,tradesPerDay:H,sharpeRatio:me,monthlyReturn:Pe,consistencyScore:Ct,calmarRatio:qt,recoveryFactor:Ht,expectancy:Gt,expectancyPercentage:rs,averageTradesPerMonth:Ve,bestMonth:pe,worstMonth:De,consecutiveWins:_e,consecutiveLosses:Be,maxConsecutiveWins:Et,maxConsecutiveLosses:Je,tpCount:Mt,slCount:kt,beCount:ys,tpWinRate:no,slWinRate:lo,beWinRate:ao}},Cd=Sd,Mn=Object.freeze(Object.defineProperty({__proto__:null,calculatePnL:Jl,calculateTradeStats:sn,countActiveFilters:Hl,filterTrades:Cd,getActiveFiltersList:Gl},Symbol.toStringTag,{value:"Module"})),Pd=t=>{const s=new Set(t.map(r=>r.strategy).filter(Boolean));return Array.from(s).map(r=>({id:`trade-${r}`,name:r,description:`StratÃ©gie utilisÃ©e dans ${t.filter(l=>l.strategy===r).length} trade(s)`,category:"custom",riskLevel:"medium",complexity:"intermediate",isDefault:!1,isFavorite:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),emoji:"ðŸ“Š",timeframes:[],preferredSymbols:[]}))},Md=({searchQuery:t,selectedCategory:s,hideDefaultStrategies:r,allAvailableStrategies:l,favoritePresets:n})=>{let o;if(t.trim()){const a=t.toLowerCase();o=l.filter(c=>c.name.toLowerCase().includes(a)||(c.description?.toLowerCase().includes(a)??!1))}else s==="all"?o=l:s==="favorites"?o=n:s==="custom"?o=l.filter(a=>a.category==="custom"&&!a.isDefault&&!String(a.id).startsWith("trade-")):o=l.filter(a=>a.category===s);return r&&(o=o.filter(a=>!a.isDefault)),o},Rd=({allAvailableStrategies:t,favoritePresets:s,hideDefaultStrategies:r,language:l})=>{const n=r?t.filter(a=>!a.isDefault):t,o=r?s.filter(a=>!a.isDefault):s;return[{id:"all",name:l==="fr"?"Toutes":"All",icon:"ðŸ“‹",count:n.length},{id:"favorites",name:l==="fr"?"Favoris":"Favorites",icon:"â­",count:o.length},{id:"scalping",name:"Scalping",icon:"âš¡",count:n.filter(a=>a.category==="scalping").length},{id:"daytrading",name:"Day Trading",icon:"ðŸ“ˆ",count:n.filter(a=>a.category==="daytrading").length},{id:"swingtrading",name:"Swing Trading",icon:"ðŸŒŠ",count:n.filter(a=>a.category==="swingtrading").length},{id:"custom",name:l==="fr"?"PersonnalisÃ©":"Custom",icon:"âš™ï¸",count:n.filter(a=>a.category==="custom"&&!a.isDefault&&!String(a.id).startsWith("trade-")).length}]},Td=({allPresets:t,favoritePresets:s,allAvailableStrategies:r,initialHideDefault:l,language:n})=>{const[o,a]=b.useState(""),[c,i]=b.useState("all"),[d,u]=b.useState(l),m=b.useMemo(()=>Md({searchQuery:o,selectedCategory:c,hideDefaultStrategies:d,allAvailableStrategies:r,favoritePresets:s}),[o,c,d,r,s]),p=b.useMemo(()=>Rd({allAvailableStrategies:r,favoritePresets:s,hideDefaultStrategies:d,language:n}),[r,s,d,n]);return{searchQuery:o,setSearchQuery:a,selectedCategory:c,setSelectedCategory:i,hideDefaultStrategies:d,setHideDefaultStrategies:u,filteredStrategies:m,categories:p}},Dd=({title:t,countBadge:s,onClose:r,onCreate:l,hideDefault:n,onToggleHideDefault:o,language:a,theme:c})=>e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",style:{borderColor:c?.colors.border||"var(--theme-border)"},children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:c?.colors.text||"var(--theme-text)"},children:t}),o&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{type:"button",onClick:o,className:"relative inline-flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2",style:{"--tw-ring-color":c?.colors.accent||"#3b82f6"},children:[e.jsx("span",{className:"sr-only",children:a==="fr"?"Masquer les stratÃ©gies par dÃ©faut":"Hide default strategies"}),e.jsx("div",{className:"relative inline-flex h-5 w-9 items-center rounded-full transition-colors duration-200 ease-in-out",style:{backgroundColor:n?c?.colors.accent||"#3b82f6":c?.colors.border||"#d1d5db"},children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white shadow transition duration-200 ease-in-out ${n?"translate-x-4":"translate-x-0.5"}`})})]}),e.jsx("span",{className:"text-xs font-medium",style:{color:c?.colors.text||"var(--theme-text)"},children:a==="fr"?"Masquer les stratÃ©gies par dÃ©faut":"Hide default strategies"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-sm px-3 py-1 rounded-full",style:{backgroundColor:c?.colors.surface||"var(--theme-surface)",color:c?.colors.textMuted||"var(--theme-text-muted)",border:`1px solid ${c?.colors.border||"var(--theme-border)"}`},children:s}),l&&e.jsx("button",{onClick:l,className:"px-3 py-2 rounded-lg transition-colors",style:{backgroundColor:c?.colors.accent||"var(--theme-accent)",color:"#ffffff"},children:e.jsx(Ye,{size:16})}),e.jsx("button",{onClick:r,className:"p-2 rounded-full transition-colors",style:{backgroundColor:c?.colors.surface||"var(--theme-surface)",color:c?.colors.textMuted||"var(--theme-text-muted)",border:`1px solid ${c?.colors.border||"var(--theme-border)"}`},children:e.jsx(be,{size:20})})]})]}),Ed=({value:t,onChange:s,placeholder:r})=>e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t,onChange:l=>s(l.target.value),className:"w-full pl-10 pr-8 py-3 text-sm border rounded-lg focus:outline-none focus:ring-2",placeholder:r}),e.jsx(jt,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 theme-text-muted"}),t&&e.jsx("button",{onClick:()=>s(""),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 rounded",children:e.jsx(be,{size:16})})]}),Fd=({value:t,onChange:s,onCreate:r,canCreate:l,theme:n,language:o})=>e.jsx("div",{className:"px-6 py-3 border-b flex-shrink-0",style:{borderColor:n.colors.border},children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Ed,{value:t,onChange:s,placeholder:o==="fr"?"CrÃ©er ou rechercher une stratÃ©gie...":"Create or search for a strategy..."})}),l&&e.jsxs("button",{onClick:r,className:"flex items-center space-x-1 px-3 py-2 text-sm rounded-lg transition-colors whitespace-nowrap",style:{backgroundColor:n.colors.accent,color:"#ffffff"},children:[e.jsx(Ye,{size:14}),e.jsx("span",{children:o==="fr"?`Ajouter "${t.slice(0,10)}${t.length>10?"...":""}"`:`Add "${t.slice(0,10)}${t.length>10?"...":""}"`})]})]})}),Ad=({categories:t,selectedCategory:s,onSelectCategory:r,theme:l,language:n})=>e.jsx("div",{className:"px-6 py-2 border-b flex-shrink-0",style:{borderColor:l.colors.border},children:e.jsx("div",{className:"flex flex-wrap gap-1.5 justify-between",children:e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.map(o=>e.jsxs("button",{onClick:()=>r(o.id),className:"flex items-center px-3 py-1 rounded-lg text-xs font-medium transition-colors",style:{backgroundColor:s===o.id?l.colors.accent:l.colors.surface,color:s===o.id?"#ffffff":l.colors.text,boxShadow:s===o.id?"var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)":"none"},children:[e.jsx("span",{className:"mr-1",children:o.icon}),o.name,e.jsx("span",{className:"ml-1.5 px-1.5 py-0.5 rounded-full text-xs",style:{backgroundColor:s===o.id?"rgba(255, 255, 255, 0.2)":l.colors.surface,color:s===o.id?"#ffffff":l.colors.textMuted},children:o.count})]},o.id))})})}),Ao=({preset:t,isActive:s,onSelect:r,onToggleFavorite:l,theme:n,language:o,onEdit:a,onDelete:c,onDetails:i,isDeleteConfirm:d,availableTrades:u=[],tradingSettings:m,gridIndex:p=0})=>{const x=Hr.find(S=>S.id===t.category),f=Gr.find(S=>S.id===t.riskLevel),g=Cl.find(S=>S.id===t.complexity),h=u.filter(S=>S.strategy===t.name&&S.status==="closed"),y=h.length>0?{totalTrades:h.length,winRate:Math.round(h.filter(S=>(S.pnl||0)>0).length/h.length*100),totalPnL:h.reduce((S,w)=>S+(w.pnl||0),0),totalPnLPercentage:h.reduce((S,w)=>S+(w.pnlPercentage||0),0)}:null,j={hasStats:!!y,stats:y,timeframes:t.timeframes||[],preferredSymbols:t.preferredSymbols||[],category:x?.name||"",riskLevel:f?.name||"",complexity:g?.name||""},N=(p+1)%3===0?{position:"left",className:"absolute top-1/2 right-full transform -translate-y-1/2 mr-2",arrowClass:"absolute top-1/2 right-0 transform -translate-y-1/2 translate-x-1 w-0 h-0 border-t-4 border-b-4 border-l-4 border-transparent",arrowStyle:{borderLeftColor:n.colors.card}}:{position:"right",className:"absolute top-1/2 left-full transform -translate-y-1/2 ml-2",arrowClass:"absolute top-1/2 left-0 transform -translate-y-1/2 -translate-x-1 w-0 h-0 border-t-4 border-b-4 border-r-4 border-transparent",arrowStyle:{borderRightColor:n.colors.card}};return e.jsxs("div",{className:"h-36 p-3 text-left rounded-lg border transition-all hover:shadow-md relative flex flex-col group",style:{borderColor:s?n.colors.accent:n.colors.border,backgroundColor:s?`${n.colors.accent}10`:n.colors.surface,color:n.colors.text},title:"",children:[e.jsx("div",{className:`${N.className} opacity-0 group-hover:opacity-100 transition-all duration-300 pointer-events-none z-50 w-64`,style:{filter:"drop-shadow(0 8px 20px rgba(0, 0, 0, 0.12))"},children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:N.arrowClass,style:N.arrowStyle}),e.jsxs("div",{className:"rounded-xl shadow-xl border-2 overflow-hidden",style:{backgroundColor:n.colors.card,borderColor:n.colors.border,borderWidth:"2px"},children:[e.jsx("div",{className:"px-3 py-2 border-b-2",style:{backgroundColor:n.colors.surface+"50",borderColor:n.colors.border+"60"},children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:t.emoji||x?.icon||"ðŸ“Š"}),e.jsx("div",{className:"font-semibold text-xs truncate",style:{color:n.colors.text},children:t.name})]})}),e.jsxs("div",{className:"px-3 py-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-1 h-3 rounded-full",style:{backgroundColor:n.colors.accent}}),e.jsx("h4",{className:"font-medium text-xs",style:{color:n.colors.text},children:"Performance"})]}),j.hasStats&&j.stats?e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-bold",style:{color:n.colors.text},children:j.stats.totalTrades}),e.jsx("div",{className:"text-[10px]",style:{color:n.colors.textMuted},children:"Trades"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-sm font-bold",style:{color:n.colors.accent},children:[j.stats.winRate,"%"]}),e.jsx("div",{className:"text-[10px]",style:{color:n.colors.textMuted},children:"Win"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-sm font-bold",style:{color:j.stats.totalPnL>=0?"#10b981":"#ef4444"},children:[j.stats.totalPnL>=0?"+":"",j.stats.totalPnL.toFixed(1)]}),e.jsx("div",{className:"text-[10px]",style:{color:n.colors.textMuted},children:"P&L"})]})]}):e.jsx("div",{className:"text-center py-2",children:e.jsx("div",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"Aucun trade":"No trades"})})]}),(j.timeframes.length>0||j.preferredSymbols.length>0)&&e.jsxs("div",{className:"px-3 pb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-1 h-3 rounded-full",style:{backgroundColor:n.colors.accent}}),e.jsx("h4",{className:"font-medium text-xs",style:{color:n.colors.text},children:o==="fr"?"DÃ©tails":"Details"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[j.timeframes.slice(0,2).map((S,w)=>e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px]",style:{backgroundColor:n.colors.surface+"80",color:n.colors.text},children:S},w)),j.timeframes.length>2&&e.jsxs("span",{className:"px-1.5 py-0.5 rounded text-[10px]",style:{backgroundColor:n.colors.surface+"80",color:n.colors.textMuted},children:["+",j.timeframes.length-2]}),j.preferredSymbols.slice(0,2).map((S,w)=>e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px]",style:{backgroundColor:n.colors.surface+"80",color:n.colors.text},children:S},w)),j.preferredSymbols.length>2&&e.jsxs("span",{className:"px-1.5 py-0.5 rounded text-[10px]",style:{backgroundColor:n.colors.surface+"80",color:n.colors.textMuted},children:["+",j.preferredSymbols.length-2]})]})]})]})]})}),e.jsx("button",{onClick:S=>{S.stopPropagation(),S.preventDefault(),l()},className:"absolute top-2 right-2 p-1 rounded-full transition-colors z-10",style:{backgroundColor:t.isFavorite?`${n.colors.accent}20`:"transparent",color:t.isFavorite?"#ff4757":n.colors.textMuted},title:o==="fr"?"Ajouter aux favoris":"Add to favorites",children:e.jsx(bl,{size:16,fill:t.isFavorite?"#ff4757":"none"})}),e.jsx("div",{className:"relative group pr-8 flex-shrink-0 h-10",children:e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx("span",{className:"text-base",children:t.emoji||x?.icon||"ðŸ“Š"}),e.jsx("div",{className:"font-medium text-sm truncate",children:t.name})]})}),e.jsxs("div",{onClick:r,className:"flex-1 overflow-hidden cursor-pointer",children:[t.description&&e.jsx("p",{className:"text-xs mb-2 line-clamp-2",style:{color:n.colors.textMuted},children:t.description}),e.jsxs("div",{className:"flex items-center flex-wrap gap-1.5",children:[x&&e.jsx("span",{className:"px-1.5 py-0.5 text-xs rounded-full font-medium",style:{backgroundColor:`${x.color}15`,color:x.color,border:`1px solid ${x.color}30`},children:x.name}),f&&e.jsx("span",{className:"px-1.5 py-0.5 text-xs rounded-full font-medium",style:{backgroundColor:`${f.color}15`,color:f.color,border:`1px solid ${f.color}30`},children:f.name}),t.timeframes&&t.timeframes.length>0&&e.jsxs("div",{className:"flex items-center space-x-1 px-1.5 py-0.5 rounded-full",style:{backgroundColor:n.colors.surface},children:[e.jsx($e,{size:10,style:{color:n.colors.textMuted}}),e.jsxs("span",{className:"text-xs",style:{color:n.colors.textMuted},children:[t.timeframes.slice(0,2).join(", "),t.timeframes.length>2&&` +${t.timeframes.length-2}`]})]}),t.preferredSymbols&&t.preferredSymbols.length>0&&e.jsxs("div",{className:"flex items-center space-x-1 px-1.5 py-0.5 rounded-full",style:{backgroundColor:n.colors.surface},children:[e.jsx(Ee,{size:10,style:{color:n.colors.textMuted}}),e.jsxs("span",{className:"text-xs",style:{color:n.colors.textMuted},children:[t.preferredSymbols.slice(0,3).join(", "),t.preferredSymbols.length>3&&` +${t.preferredSymbols.length-3}`]})]})]})]}),e.jsxs("div",{className:"flex-shrink-0 h-8 flex items-center justify-between border-t pt-2",style:{borderColor:n.colors.border+"40"},children:[e.jsx("div",{className:"h-5 flex items-center",children:t.isDefault&&e.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium rounded-full border",style:{backgroundColor:n.colors.accent,color:"#ffffff",borderColor:n.colors.accent},children:o==="fr"?"Par dÃ©faut":"Default"})}),e.jsxs("div",{className:"flex items-center space-x-1",children:[i&&e.jsx("button",{onClick:i,className:"p-1 text-xs rounded hover:theme-surface",title:o==="fr"?"DÃ©tails":"Details",children:e.jsx(As,{size:14})}),a&&e.jsx("button",{onClick:a,className:"p-1 text-xs rounded hover:theme-surface",title:o==="fr"?"Modifier":"Edit",children:e.jsx(wl,{size:14})}),c&&e.jsxs("button",{onClick:c,className:"p-1 text-xs rounded hover:theme-surface relative",title:o==="fr"?d?"Confirmer":"Supprimer":d?"Confirm":"Delete",children:[e.jsx(es,{size:14}),d&&e.jsx("span",{className:"absolute -top-6 right-0 text-[10px] px-1.5 py-0.5 rounded",style:{backgroundColor:"#ef4444",color:"#fff"},children:o==="fr"?"Confirmer":"Confirm"})]})]})]})]})},Ld=({mostUsed:t,isCollapsed:s,onToggle:r,onSelect:l,currentValue:n,theme:o,language:a,availableTrades:c=[],tradingSettings:i,allStrategies:d=[]})=>t.length===0?null:e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:r,className:"w-full flex items-center justify-between p-3 rounded-lg transition-colors hover:bg-opacity-10",style:{backgroundColor:s?"transparent":`${o.colors.surface}50`,color:o.colors.text},children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center",style:{color:o.colors.text},children:[e.jsx(it,{size:20,className:"mr-2",style:{color:"#FFC107"}}),a==="fr"?"StratÃ©gies utilisÃ©es":"Used Strategies",e.jsx("span",{className:"ml-2 px-2 py-1 text-xs rounded-full",style:{backgroundColor:o.colors.accent,color:"#ffffff"},children:t.length})]}),s?e.jsx(Os,{size:20,style:{color:o.colors.textMuted}}):e.jsx(Le,{size:20,style:{color:o.colors.textMuted}})]}),!s&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mt-4",children:t.slice(0,6).map((u,m)=>{const p=d.find(x=>x.name===u.name||x.name.toLowerCase()===u.name.toLowerCase()||x.name.toLowerCase().trim()===u.name.toLowerCase().trim());if(!p){const x=u.name.toLowerCase().includes("scalping")||u.name.toLowerCase().includes("trading")||u.name.toLowerCase().includes("momentum")||u.name.toLowerCase().includes("range")||u.name.toLowerCase().includes("news")||u.name.toLowerCase().includes("swing")||u.name.toLowerCase().includes("breakout"),f={id:`orphan-${u.name.toLowerCase().replace(/\s+/g,"-")}`,name:u.name,description:a==="fr"?`StratÃ©gie utilisÃ©e ${u.count} fois`:`Strategy used ${u.count} times`,category:x?"scalping":"custom",isDefault:x,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),emoji:"ðŸ“Š"};return e.jsx(Ao,{preset:f,isActive:n===u.name,onSelect:()=>l(u.name),onToggleFavorite:()=>{},theme:o,language:a,availableTrades:c,tradingSettings:i,gridIndex:m},m)}return e.jsx(Ao,{preset:p,isActive:n===u.name,onSelect:()=>l(u.name),onToggleFavorite:()=>{},theme:o,language:a,availableTrades:c,tradingSettings:i,gridIndex:m},m)})})]}),$d=({title:t,countLabel:s,theme:r})=>e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:r.colors.text},children:t}),e.jsx("span",{className:"text-sm px-3 py-1 rounded-full",style:{backgroundColor:r.colors.surface,color:r.colors.textMuted},children:s})]}),Id=({strategies:t,currentValue:s,theme:r,language:l,onSelect:n,onToggleFavorite:o,onEdit:a,onDelete:c,onDetails:i,deleteConfirmId:d,availableTrades:u=[],tradingSettings:m})=>e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:t.map((p,x)=>e.jsx(Ao,{preset:p,isActive:s===p.name,onSelect:()=>n(p.name),onToggleFavorite:()=>o(p.id),theme:r,language:l,onEdit:a?()=>a(p):void 0,onDelete:c?()=>c(p):void 0,onDetails:i?()=>i(p):void 0,isDeleteConfirm:d===p.id,availableTrades:u,tradingSettings:m,gridIndex:x},`${p.id}-${x}`))}),zd=({searchQuery:t,filteredStrategies:s,currentValue:r,theme:l,language:n,hasMostUsed:o,onCreate:a,canCreate:c,onSelect:i,onToggleFavorite:d,onEdit:u,onDelete:m,onDetails:p,deleteConfirmId:x,availableTrades:f,tradingSettings:g})=>{const h=t?n==="fr"?`RÃ©sultats pour "${t}"`:`Results for "${t}"`:o?n==="fr"?"Autres stratÃ©gies":"Other Strategies":n==="fr"?"Toutes les stratÃ©gies":"All Strategies",y=`${s.length} ${n==="fr"?`stratÃ©gie${s.length>1?"s":""}`:`strateg${s.length>1?"ies":"y"}`}`;return e.jsxs("div",{children:[e.jsx($d,{title:h,countLabel:y,theme:l}),s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mb-4",children:e.jsx(jt,{size:48,className:"mx-auto",style:{color:l.colors.textMuted}})}),e.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:l.colors.text},children:t?n==="fr"?"Aucune stratÃ©gie trouvÃ©e":"No strategies found":n==="fr"?"Aucune stratÃ©gie disponible":"No strategies available"}),e.jsx("p",{className:"mb-6",style:{color:l.colors.textMuted},children:t?n==="fr"?`Aucune stratÃ©gie ne correspond Ã  "${t}"`:`No strategies match "${t}"`:n==="fr"?"Il n'y a pas de stratÃ©gies dans cette catÃ©gorie":"There are no strategies in this category"}),t&&c&&e.jsxs("button",{onClick:a,className:"inline-flex items-center space-x-2 px-6 py-3 rounded-lg transition-colors",style:{backgroundColor:l.colors.accent,color:"#ffffff"},children:[e.jsx(jt,{size:16}),e.jsx("span",{children:n==="fr"?`CrÃ©er la stratÃ©gie "${t}"`:`Create strategy "${t}"`})]})]}):e.jsx(Id,{strategies:s,currentValue:r,theme:l,language:n,onSelect:i,onToggleFavorite:d,onEdit:u,onDelete:m,onDetails:p,deleteConfirmId:x,availableTrades:f,tradingSettings:g})]})},Od=t=>{try{const s=new CustomEvent("open-filters-for-strategy",{detail:{strategy:t}});window.dispatchEvent(s)}catch{}},rn=({onSelect:t,onClose:s,currentValue:r,availableTrades:l=[],tradingSettings:n={initialCapital:1e4,riskPerTrade:1,currency:"EUR"}})=>{const{currentTheme:o}=ee(),{currentLanguage:a}=X(),[c,i]=b.useState(!1),[d,u]=xs("trading-journal-hide-default-strategies",!1),[m,p]=b.useState(!1),[x,f]=b.useState(null),[g,h]=xs("trading-journal-most-used-collapsed",!1),[y,j]=b.useState(""),{getMostUsedStrategies:v,allPresets:N,createPreset:S,updatePreset:w,deletePreset:k,toggleFavorite:M,getFavoritePresets:C}=Yo(),R=b.useMemo(()=>Pd(l),[l]),P=b.useMemo(()=>{const G=new Set(N.map(we=>we.name.toLowerCase())),he=R.filter(we=>!G.has(we.name.toLowerCase()));return[...N,...he]},[N,R]),D=v(l),T=b.useMemo(()=>C(),[C,N]),E=b.useMemo(()=>{if(!x||l.length===0)return null;const G=l.filter(we=>we.strategy===x.name&&we.status==="closed");if(G.length===0)return{totalTrades:0,winRate:0,totalPnL:0,totalPnLPercentage:0};const he=sn(G,n);return{totalTrades:he.totalTrades,winRate:he.winRate,totalPnL:he.totalPnL,totalPnLPercentage:he.totalPnLPercentage}},[x,l,n]),{searchQuery:L,setSearchQuery:U,selectedCategory:_,setSelectedCategory:B,hideDefaultStrategies:z,setHideDefaultStrategies:A,filteredStrategies:F,categories:q}=Td({allPresets:N,favoritePresets:T,allAvailableStrategies:P,initialHideDefault:!!d,language:a==="fr"?"fr":"en"});b.useEffect(()=>{u(z)},[z,u]);const W=G=>{t(G),s()},I=G=>{f(G),p(!0)},{showEditForm:$,editingPreset:V,openEdit:K,closeEdit:ne,deleteConfirmId:ue,handleDelete:le,resetDeleteConfirm:je,forceDelete:ye}=hd({createPreset:G=>S(G),updatePreset:w,deletePreset:k,toggleFavorite:M,setShowCreateForm:i}),ve=G=>{M(G)};b.useEffect(()=>{je()},[L,_]);const se=()=>{L.trim()&&(j(L),i(!0))},te=e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4",style:{zIndex:2147483647},children:[e.jsxs("div",{className:"rounded-lg shadow-xl max-w-5xl w-full h-[85vh] flex flex-col",style:{backgroundColor:o.colors.card,color:o.colors.text},children:[e.jsx(Dd,{title:a==="fr"?"SÃ©lectionner une StratÃ©gie":"Select a Strategy",countBadge:a==="fr"?`(${z?P.filter(G=>!G.isDefault).length:P.length} stratÃ©gies disponibles)`:`(${z?P.filter(G=>!G.isDefault).length:P.length} strategies available)`,onClose:s,hideDefault:z,onToggleHideDefault:()=>A(!z),language:a==="fr"?"fr":"en",theme:o}),e.jsx(Fd,{value:L,onChange:U,onCreate:se,canCreate:!!(L.trim()&&!P.find(G=>G.name.toLowerCase()===L.toLowerCase())),theme:o,language:a==="fr"?"fr":"en"}),e.jsx(Ad,{categories:q,selectedCategory:_,onSelectCategory:B,theme:o,language:a==="fr"?"fr":"en"}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[!L&&D.length>0&&e.jsx(Ld,{mostUsed:D,isCollapsed:g,onToggle:()=>h(!g),onSelect:W,currentValue:r,theme:o,language:a==="fr"?"fr":"en",availableTrades:l,tradingSettings:n,allStrategies:N}),e.jsx(zd,{searchQuery:L,filteredStrategies:F,currentValue:r,theme:o,language:a==="fr"?"fr":"en",hasMostUsed:D.length>0,onCreate:se,canCreate:!!(L.trim()&&!P.find(G=>G.name.toLowerCase()===L.toLowerCase())),onSelect:W,onToggleFavorite:ve,onEdit:K,onDelete:G=>le(G),onDetails:I,deleteConfirmId:ue,availableTrades:l,tradingSettings:n})]}),e.jsx(fd,{theme:o,language:a==="fr"?"fr":"en",searchQuery:L,canCreate:!!(L.trim()&&!P.find(G=>G.name.toLowerCase()===L.toLowerCase())),onCreate:se,onClose:s})]}),c&&e.jsx(dd,{isOpen:c,name:y,onNameChange:j,onCancel:()=>i(!1),onSubmit:()=>{if(!y.trim()||P.find(he=>he.name.toLowerCase()===y.toLowerCase()))return;const G=S({name:y,description:"",category:"custom",riskLevel:"medium",complexity:"intermediate",timeframes:[],markets:[],emoji:"âš™ï¸",preferredSymbols:[]});i(!1),K(G)},theme:o,language:a==="fr"?"fr":"en"}),e.jsx(xd,{isOpen:!!($&&V),preset:V,theme:o,language:a,onSave:G=>{V&&(V.isDefault?S({name:G.name||V.name,description:G.description||V.description||"",category:G.category||V.category,riskLevel:G.riskLevel||V.riskLevel||"medium",complexity:G.complexity||V.complexity||"intermediate",timeframes:G.timeframes||V.timeframes||[],markets:G.markets||V.markets||[],emoji:G.emoji||V.emoji||"âš™ï¸",preferredSymbols:G.preferredSymbols||V.preferredSymbols||[]}):w(V.id,G),ne())},onCancel:()=>{ne()},onSelect:G=>{W(G),ne()}}),e.jsx(pd,{isOpen:!!ue,theme:o,language:a==="fr"?"fr":"en",name:F.find(G=>G.id===ue)?.name||"",onCancel:je,onConfirm:()=>{const G=F.find(he=>he.id===ue);G&&ye(G)}}),e.jsx(ud,{isOpen:!!(m&&x),preset:x,stats:E,theme:o,language:a==="fr"?"fr":"en",onClose:()=>p(!1),onOpenHistory:()=>{x&&(Od(x.name),p(!1),s())}})]});return typeof document<"u"?St.createPortal(te,document.body):te},qd=({initialName:t,onSave:s,onClose:r,existingNames:l})=>{const{currentTheme:n}=ee(),{currentLanguage:o}=X(),[a,c]=b.useState(t),[i,d]=b.useState(!1),[u,m]=b.useState(""),[p,x]=b.useState(!1),f=b.useRef(null);b.useEffect(()=>{f.current&&(f.current.focus(),f.current.select())},[]),b.useEffect(()=>{if(!a.trim()){m(o==="fr"?"Le nom est requis":"Name is required");return}if(a.trim().length<2){m(o==="fr"?"Le nom doit faire au moins 2 caractÃ¨res":"Name must be at least 2 characters");return}if(a.trim().length>50){m(o==="fr"?"Le nom ne peut pas dÃ©passer 50 caractÃ¨res":"Name cannot exceed 50 characters");return}if(l.some(j=>j.toLowerCase()===a.trim().toLowerCase())){m(o==="fr"?"Ce nom existe dÃ©jÃ ":"This name already exists");return}m("")},[a,l,o]);const g=async()=>{u||!a.trim()||(x(!0),setTimeout(()=>{s(a.trim(),i),x(!1)},300))},h=j=>{j.key==="Enter"&&!u&&a.trim()?(j.preventDefault(),g()):j.key==="Escape"&&(j.preventDefault(),r())},y=j=>{j.target===j.currentTarget&&r()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",onClick:y,children:e.jsxs("div",{className:"w-full max-w-md rounded-xl shadow-2xl overflow-hidden animate-fadeIn",style:{backgroundColor:n.colors.card,border:`1px solid ${n.colors.border}`},onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",style:{borderColor:n.colors.border,background:`linear-gradient(135deg, ${n.colors.surface} 0%, ${n.colors.card} 100%)`},children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Dt,{size:20,className:"mr-3",style:{color:n.colors.accent}}),e.jsx("h3",{className:"font-bold text-lg",style:{color:n.colors.text},children:o==="fr"?"Nouveau Preset":"New Preset"})]}),e.jsx("button",{onClick:r,className:"p-2 rounded-full hover:bg-opacity-10 hover:bg-black transition-colors",style:{color:n.colors.textMuted},children:e.jsx(be,{size:18})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:n.colors.textSecondary},children:[o==="fr"?"Nom du preset":"Preset name"," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:f,type:"text",value:a,onChange:j=>c(j.target.value),onKeyDown:h,placeholder:"Ex: Scalping ES 5min",className:"w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 transition-all duration-200",style:{backgroundColor:n.colors.surface,borderColor:u?n.colors.danger:n.colors.border,color:n.colors.text},maxLength:50}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-xs",style:{color:n.colors.textMuted},children:[a.length,"/50"]})]}),u&&e.jsxs("div",{className:"flex items-center mt-2 text-sm",style:{color:n.colors.danger},children:[e.jsx(Zt,{size:14,className:"mr-2"}),u]}),!u&&a.trim()&&a.trim().length>=2&&e.jsxs("div",{className:"flex items-center mt-2 text-sm",style:{color:n.colors.success},children:[e.jsx(_t,{size:14,className:"mr-2"}),o==="fr"?"Nom valide":"Valid name"]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:j=>d(j.target.checked),className:"sr-only"}),e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-all duration-200 ${i?"border-0":""}`,style:{backgroundColor:i?n.colors.accent:"transparent",borderColor:i?n.colors.accent:n.colors.border},children:i&&e.jsx(_t,{size:12,color:"#ffffff"})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(it,{size:16,className:"mr-2",style:{color:"#F59E0B"}}),e.jsx("span",{className:"font-medium",style:{color:n.colors.text},children:o==="fr"?"Ajouter aux favoris":"Add to favorites"})]}),e.jsx("p",{className:"text-sm mt-1",style:{color:n.colors.textMuted},children:o==="fr"?"AccÃ¨s rapide dans le dropdown":"Quick access in dropdown"})]})]})})]}),e.jsxs("div",{className:"flex justify-between items-center px-6 py-4 border-t",style:{borderColor:n.colors.border,backgroundColor:n.colors.surface+"30"},children:[e.jsx("div",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"EntrÃ©e pour sauvegarder â€¢ Ã‰chap pour annuler":"Enter to save â€¢ Esc to cancel"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 rounded-lg transition-all duration-200 hover:shadow-sm",style:{backgroundColor:n.colors.surface,color:n.colors.text,border:`1px solid ${n.colors.border}`},children:o==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:g,disabled:!!u||!a.trim()||p,className:`flex items-center px-4 py-2 rounded-lg transition-all duration-200 ${u||!a.trim()?"opacity-50 cursor-not-allowed":"hover:shadow-md"}`,style:{backgroundColor:n.colors.accent,color:"#ffffff"},children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),o==="fr"?"Sauvegarde...":"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Dt,{size:16,className:"mr-2"}),o==="fr"?"CrÃ©er":"Create"]})})]})]})]})})};function Ud(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];return b.useMemo(()=>l=>{s.forEach(n=>n(l))},s)}const Qr=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function qs(t){const s=Object.prototype.toString.call(t);return s==="[object Window]"||s==="[object global]"}function on(t){return"nodeType"in t}function Nt(t){var s,r;return t?qs(t)?t:on(t)&&(s=(r=t.ownerDocument)==null?void 0:r.defaultView)!=null?s:window:window}function nn(t){const{Document:s}=Nt(t);return t instanceof s}function ur(t){return qs(t)?!1:t instanceof Nt(t).HTMLElement}function Kl(t){return t instanceof Nt(t).SVGElement}function Us(t){return t?qs(t)?t.document:on(t)?nn(t)?t:ur(t)||Kl(t)?t.ownerDocument:document:document:document}const Vt=Qr?b.useLayoutEffect:b.useEffect;function Zr(t){const s=b.useRef(t);return Vt(()=>{s.current=t}),b.useCallback(function(){for(var r=arguments.length,l=new Array(r),n=0;n<r;n++)l[n]=arguments[n];return s.current==null?void 0:s.current(...l)},[])}function _d(){const t=b.useRef(null),s=b.useCallback((l,n)=>{t.current=setInterval(l,n)},[]),r=b.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[s,r]}function or(t,s){s===void 0&&(s=[t]);const r=b.useRef(t);return Vt(()=>{r.current!==t&&(r.current=t)},s),r}function mr(t,s){const r=b.useRef();return b.useMemo(()=>{const l=t(r.current);return r.current=l,l},[...s])}function Er(t){const s=Zr(t),r=b.useRef(null),l=b.useCallback(n=>{n!==r.current&&s?.(n,r.current),r.current=n},[]);return[r,l]}function Fr(t){const s=b.useRef();return b.useEffect(()=>{s.current=t},[t]),s.current}let go={};function xr(t,s){return b.useMemo(()=>{if(s)return s;const r=go[t]==null?0:go[t]+1;return go[t]=r,t+"-"+r},[t,s])}function Yl(t){return function(s){for(var r=arguments.length,l=new Array(r>1?r-1:0),n=1;n<r;n++)l[n-1]=arguments[n];return l.reduce((o,a)=>{const c=Object.entries(a);for(const[i,d]of c){const u=o[i];u!=null&&(o[i]=u+t*d)}return o},{...s})}}const Ls=Yl(1),Ar=Yl(-1);function Wd(t){return"clientX"in t&&"clientY"in t}function eo(t){if(!t)return!1;const{KeyboardEvent:s}=Nt(t.target);return s&&t instanceof s}function Vd(t){if(!t)return!1;const{TouchEvent:s}=Nt(t.target);return s&&t instanceof s}function Lr(t){if(Vd(t)){if(t.touches&&t.touches.length){const{clientX:s,clientY:r}=t.touches[0];return{x:s,y:r}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:s,clientY:r}=t.changedTouches[0];return{x:s,y:r}}}return Wd(t)?{x:t.clientX,y:t.clientY}:null}const ts=Object.freeze({Translate:{toString(t){if(!t)return;const{x:s,y:r}=t;return"translate3d("+(s?Math.round(s):0)+"px, "+(r?Math.round(r):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;const{scaleX:s,scaleY:r}=t;return"scaleX("+s+") scaleY("+r+")"}},Transform:{toString(t){if(t)return[ts.Translate.toString(t),ts.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:s,duration:r,easing:l}=t;return s+" "+r+"ms "+l}}}),Rn="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Bd(t){return t.matches(Rn)?t:t.querySelector(Rn)}const Hd={display:"none"};function Gd(t){let{id:s,value:r}=t;return O.createElement("div",{id:s,style:Hd},r)}function Jd(t){let{id:s,announcement:r,ariaLiveType:l="assertive"}=t;const n={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return O.createElement("div",{id:s,style:n,role:"status","aria-live":l,"aria-atomic":!0},r)}function Kd(){const[t,s]=b.useState("");return{announce:b.useCallback(l=>{l!=null&&s(l)},[]),announcement:t}}const Xl=b.createContext(null);function Yd(t){const s=b.useContext(Xl);b.useEffect(()=>{if(!s)throw new Error("useDndMonitor must be used within a children of <DndContext>");return s(t)},[t,s])}function Xd(){const[t]=b.useState(()=>new Set),s=b.useCallback(l=>(t.add(l),()=>t.delete(l)),[t]);return[b.useCallback(l=>{let{type:n,event:o}=l;t.forEach(a=>{var c;return(c=a[n])==null?void 0:c.call(a,o)})},[t]),s]}const Qd={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Zd={onDragStart(t){let{active:s}=t;return"Picked up draggable item "+s.id+"."},onDragOver(t){let{active:s,over:r}=t;return r?"Draggable item "+s.id+" was moved over droppable area "+r.id+".":"Draggable item "+s.id+" is no longer over a droppable area."},onDragEnd(t){let{active:s,over:r}=t;return r?"Draggable item "+s.id+" was dropped over droppable area "+r.id:"Draggable item "+s.id+" was dropped."},onDragCancel(t){let{active:s}=t;return"Dragging was cancelled. Draggable item "+s.id+" was dropped."}};function eu(t){let{announcements:s=Zd,container:r,hiddenTextDescribedById:l,screenReaderInstructions:n=Qd}=t;const{announce:o,announcement:a}=Kd(),c=xr("DndLiveRegion"),[i,d]=b.useState(!1);if(b.useEffect(()=>{d(!0)},[]),Yd(b.useMemo(()=>({onDragStart(m){let{active:p}=m;o(s.onDragStart({active:p}))},onDragMove(m){let{active:p,over:x}=m;s.onDragMove&&o(s.onDragMove({active:p,over:x}))},onDragOver(m){let{active:p,over:x}=m;o(s.onDragOver({active:p,over:x}))},onDragEnd(m){let{active:p,over:x}=m;o(s.onDragEnd({active:p,over:x}))},onDragCancel(m){let{active:p,over:x}=m;o(s.onDragCancel({active:p,over:x}))}}),[o,s])),!i)return null;const u=O.createElement(O.Fragment,null,O.createElement(Gd,{id:l,value:n.draggable}),O.createElement(Jd,{id:c,announcement:a}));return r?St.createPortal(u,r):u}var Ze;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(Ze||(Ze={}));function $r(){}function nr(t,s){return b.useMemo(()=>({sensor:t,options:s??{}}),[t,s])}function ln(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];return b.useMemo(()=>[...s].filter(l=>l!=null),[...s])}const Bt=Object.freeze({x:0,y:0});function tu(t,s){return Math.sqrt(Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2))}function su(t,s){const r=Lr(t);if(!r)return"0 0";const l={x:(r.x-s.left)/s.width*100,y:(r.y-s.top)/s.height*100};return l.x+"% "+l.y+"%"}function ru(t,s){let{data:{value:r}}=t,{data:{value:l}}=s;return r-l}function ou(t,s){let{data:{value:r}}=t,{data:{value:l}}=s;return l-r}function nu(t,s){if(!t||t.length===0)return null;const[r]=t;return r[s]}function Tn(t,s,r){return s===void 0&&(s=t.left),r===void 0&&(r=t.top),{x:s+t.width*.5,y:r+t.height*.5}}const Ir=t=>{let{collisionRect:s,droppableRects:r,droppableContainers:l}=t;const n=Tn(s,s.left,s.top),o=[];for(const a of l){const{id:c}=a,i=r.get(c);if(i){const d=tu(Tn(i),n);o.push({id:c,data:{droppableContainer:a,value:d}})}}return o.sort(ru)};function lu(t,s){const r=Math.max(s.top,t.top),l=Math.max(s.left,t.left),n=Math.min(s.left+s.width,t.left+t.width),o=Math.min(s.top+s.height,t.top+t.height),a=n-l,c=o-r;if(l<n&&r<o){const i=s.width*s.height,d=t.width*t.height,u=a*c,m=u/(i+d-u);return Number(m.toFixed(4))}return 0}const au=t=>{let{collisionRect:s,droppableRects:r,droppableContainers:l}=t;const n=[];for(const o of l){const{id:a}=o,c=r.get(a);if(c){const i=lu(c,s);i>0&&n.push({id:a,data:{droppableContainer:o,value:i}})}}return n.sort(ou)};function iu(t,s,r){return{...t,scaleX:s&&r?s.width/r.width:1,scaleY:s&&r?s.height/r.height:1}}function Ql(t,s){return t&&s?{x:t.left-s.left,y:t.top-s.top}:Bt}function cu(t){return function(r){for(var l=arguments.length,n=new Array(l>1?l-1:0),o=1;o<l;o++)n[o-1]=arguments[o];return n.reduce((a,c)=>({...a,top:a.top+t*c.y,bottom:a.bottom+t*c.y,left:a.left+t*c.x,right:a.right+t*c.x}),{...r})}}const du=cu(1);function Zl(t){if(t.startsWith("matrix3d(")){const s=t.slice(9,-1).split(/, /);return{x:+s[12],y:+s[13],scaleX:+s[0],scaleY:+s[5]}}else if(t.startsWith("matrix(")){const s=t.slice(7,-1).split(/, /);return{x:+s[4],y:+s[5],scaleX:+s[0],scaleY:+s[3]}}return null}function uu(t,s,r){const l=Zl(s);if(!l)return t;const{scaleX:n,scaleY:o,x:a,y:c}=l,i=t.left-a-(1-n)*parseFloat(r),d=t.top-c-(1-o)*parseFloat(r.slice(r.indexOf(" ")+1)),u=n?t.width/n:t.width,m=o?t.height/o:t.height;return{width:u,height:m,top:d,right:i+u,bottom:d+m,left:i}}const mu={ignoreTransform:!1};function _s(t,s){s===void 0&&(s=mu);let r=t.getBoundingClientRect();if(s.ignoreTransform){const{transform:d,transformOrigin:u}=Nt(t).getComputedStyle(t);d&&(r=uu(r,d,u))}const{top:l,left:n,width:o,height:a,bottom:c,right:i}=r;return{top:l,left:n,width:o,height:a,bottom:c,right:i}}function Dn(t){return _s(t,{ignoreTransform:!0})}function xu(t){const s=t.innerWidth,r=t.innerHeight;return{top:0,left:0,right:s,bottom:r,width:s,height:r}}function fu(t,s){return s===void 0&&(s=Nt(t).getComputedStyle(t)),s.position==="fixed"}function pu(t,s){s===void 0&&(s=Nt(t).getComputedStyle(t));const r=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(n=>{const o=s[n];return typeof o=="string"?r.test(o):!1})}function an(t,s){const r=[];function l(n){if(s!=null&&r.length>=s||!n)return r;if(nn(n)&&n.scrollingElement!=null&&!r.includes(n.scrollingElement))return r.push(n.scrollingElement),r;if(!ur(n)||Kl(n)||r.includes(n))return r;const o=Nt(t).getComputedStyle(n);return n!==t&&pu(n,o)&&r.push(n),fu(n,o)?r:l(n.parentNode)}return t?l(t):r}function ea(t){const[s]=an(t,1);return s??null}function yo(t){return!Qr||!t?null:qs(t)?t:on(t)?nn(t)||t===Us(t).scrollingElement?window:ur(t)?t:null:null}function ta(t){return qs(t)?t.scrollX:t.scrollLeft}function sa(t){return qs(t)?t.scrollY:t.scrollTop}function Lo(t){return{x:ta(t),y:sa(t)}}var st;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(st||(st={}));function ra(t){return!Qr||!t?!1:t===document.scrollingElement}function oa(t){const s={x:0,y:0},r=ra(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},l={x:t.scrollWidth-r.width,y:t.scrollHeight-r.height},n=t.scrollTop<=s.y,o=t.scrollLeft<=s.x,a=t.scrollTop>=l.y,c=t.scrollLeft>=l.x;return{isTop:n,isLeft:o,isBottom:a,isRight:c,maxScroll:l,minScroll:s}}const hu={x:.2,y:.2};function gu(t,s,r,l,n){let{top:o,left:a,right:c,bottom:i}=r;l===void 0&&(l=10),n===void 0&&(n=hu);const{isTop:d,isBottom:u,isLeft:m,isRight:p}=oa(t),x={x:0,y:0},f={x:0,y:0},g={height:s.height*n.y,width:s.width*n.x};return!d&&o<=s.top+g.height?(x.y=st.Backward,f.y=l*Math.abs((s.top+g.height-o)/g.height)):!u&&i>=s.bottom-g.height&&(x.y=st.Forward,f.y=l*Math.abs((s.bottom-g.height-i)/g.height)),!p&&c>=s.right-g.width?(x.x=st.Forward,f.x=l*Math.abs((s.right-g.width-c)/g.width)):!m&&a<=s.left+g.width&&(x.x=st.Backward,f.x=l*Math.abs((s.left+g.width-a)/g.width)),{direction:x,speed:f}}function yu(t){if(t===document.scrollingElement){const{innerWidth:o,innerHeight:a}=window;return{top:0,left:0,right:o,bottom:a,width:o,height:a}}const{top:s,left:r,right:l,bottom:n}=t.getBoundingClientRect();return{top:s,left:r,right:l,bottom:n,width:t.clientWidth,height:t.clientHeight}}function na(t){return t.reduce((s,r)=>Ls(s,Lo(r)),Bt)}function bu(t){return t.reduce((s,r)=>s+ta(r),0)}function vu(t){return t.reduce((s,r)=>s+sa(r),0)}function la(t,s){if(s===void 0&&(s=_s),!t)return;const{top:r,left:l,bottom:n,right:o}=s(t);ea(t)&&(n<=0||o<=0||r>=window.innerHeight||l>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const ju=[["x",["left","right"],bu],["y",["top","bottom"],vu]];class cn{constructor(s,r){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const l=an(r),n=na(l);this.rect={...s},this.width=s.width,this.height=s.height;for(const[o,a,c]of ju)for(const i of a)Object.defineProperty(this,i,{get:()=>{const d=c(l),u=n[o]-d;return this.rect[i]+u},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Qs{constructor(s){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(r=>{var l;return(l=this.target)==null?void 0:l.removeEventListener(...r)})},this.target=s}add(s,r,l){var n;(n=this.target)==null||n.addEventListener(s,r,l),this.listeners.push([s,r,l])}}function Nu(t){const{EventTarget:s}=Nt(t);return t instanceof s?t:Us(t)}function bo(t,s){const r=Math.abs(t.x),l=Math.abs(t.y);return typeof s=="number"?Math.sqrt(r**2+l**2)>s:"x"in s&&"y"in s?r>s.x&&l>s.y:"x"in s?r>s.x:"y"in s?l>s.y:!1}var It;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(It||(It={}));function En(t){t.preventDefault()}function ku(t){t.stopPropagation()}var qe;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})(qe||(qe={}));const aa={start:[qe.Space,qe.Enter],cancel:[qe.Esc],end:[qe.Space,qe.Enter,qe.Tab]},wu=(t,s)=>{let{currentCoordinates:r}=s;switch(t.code){case qe.Right:return{...r,x:r.x+25};case qe.Left:return{...r,x:r.x-25};case qe.Down:return{...r,y:r.y+25};case qe.Up:return{...r,y:r.y-25}}};class to{constructor(s){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=s;const{event:{target:r}}=s;this.props=s,this.listeners=new Qs(Us(r)),this.windowListeners=new Qs(Nt(r)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(It.Resize,this.handleCancel),this.windowListeners.add(It.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(It.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:s,onStart:r}=this.props,l=s.node.current;l&&la(l),r(Bt)}handleKeyDown(s){if(eo(s)){const{active:r,context:l,options:n}=this.props,{keyboardCodes:o=aa,coordinateGetter:a=wu,scrollBehavior:c="smooth"}=n,{code:i}=s;if(o.end.includes(i)){this.handleEnd(s);return}if(o.cancel.includes(i)){this.handleCancel(s);return}const{collisionRect:d}=l.current,u=d?{x:d.left,y:d.top}:Bt;this.referenceCoordinates||(this.referenceCoordinates=u);const m=a(s,{active:r,context:l.current,currentCoordinates:u});if(m){const p=Ar(m,u),x={x:0,y:0},{scrollableAncestors:f}=l.current;for(const g of f){const h=s.code,{isTop:y,isRight:j,isLeft:v,isBottom:N,maxScroll:S,minScroll:w}=oa(g),k=yu(g),M={x:Math.min(h===qe.Right?k.right-k.width/2:k.right,Math.max(h===qe.Right?k.left:k.left+k.width/2,m.x)),y:Math.min(h===qe.Down?k.bottom-k.height/2:k.bottom,Math.max(h===qe.Down?k.top:k.top+k.height/2,m.y))},C=h===qe.Right&&!j||h===qe.Left&&!v,R=h===qe.Down&&!N||h===qe.Up&&!y;if(C&&M.x!==m.x){const P=g.scrollLeft+p.x,D=h===qe.Right&&P<=S.x||h===qe.Left&&P>=w.x;if(D&&!p.y){g.scrollTo({left:P,behavior:c});return}D?x.x=g.scrollLeft-P:x.x=h===qe.Right?g.scrollLeft-S.x:g.scrollLeft-w.x,x.x&&g.scrollBy({left:-x.x,behavior:c});break}else if(R&&M.y!==m.y){const P=g.scrollTop+p.y,D=h===qe.Down&&P<=S.y||h===qe.Up&&P>=w.y;if(D&&!p.x){g.scrollTo({top:P,behavior:c});return}D?x.y=g.scrollTop-P:x.y=h===qe.Down?g.scrollTop-S.y:g.scrollTop-w.y,x.y&&g.scrollBy({top:-x.y,behavior:c});break}}this.handleMove(s,Ls(Ar(m,this.referenceCoordinates),x))}}}handleMove(s,r){const{onMove:l}=this.props;s.preventDefault(),l(r)}handleEnd(s){const{onEnd:r}=this.props;s.preventDefault(),this.detach(),r()}handleCancel(s){const{onCancel:r}=this.props;s.preventDefault(),this.detach(),r()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}to.activators=[{eventName:"onKeyDown",handler:(t,s,r)=>{let{keyboardCodes:l=aa,onActivation:n}=s,{active:o}=r;const{code:a}=t.nativeEvent;if(l.start.includes(a)){const c=o.activatorNode.current;return c&&t.target!==c?!1:(t.preventDefault(),n?.({event:t.nativeEvent}),!0)}return!1}}];function Fn(t){return!!(t&&"distance"in t)}function An(t){return!!(t&&"delay"in t)}class dn{constructor(s,r,l){var n;l===void 0&&(l=Nu(s.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=s,this.events=r;const{event:o}=s,{target:a}=o;this.props=s,this.events=r,this.document=Us(a),this.documentListeners=new Qs(this.document),this.listeners=new Qs(l),this.windowListeners=new Qs(Nt(a)),this.initialCoordinates=(n=Lr(o))!=null?n:Bt,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:s,props:{options:{activationConstraint:r,bypassActivationConstraint:l}}}=this;if(this.listeners.add(s.move.name,this.handleMove,{passive:!1}),this.listeners.add(s.end.name,this.handleEnd),s.cancel&&this.listeners.add(s.cancel.name,this.handleCancel),this.windowListeners.add(It.Resize,this.handleCancel),this.windowListeners.add(It.DragStart,En),this.windowListeners.add(It.VisibilityChange,this.handleCancel),this.windowListeners.add(It.ContextMenu,En),this.documentListeners.add(It.Keydown,this.handleKeydown),r){if(l!=null&&l({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(An(r)){this.timeoutId=setTimeout(this.handleStart,r.delay),this.handlePending(r);return}if(Fn(r)){this.handlePending(r);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(s,r){const{active:l,onPending:n}=this.props;n(l,s,this.initialCoordinates,r)}handleStart(){const{initialCoordinates:s}=this,{onStart:r}=this.props;s&&(this.activated=!0,this.documentListeners.add(It.Click,ku,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(It.SelectionChange,this.removeTextSelection),r(s))}handleMove(s){var r;const{activated:l,initialCoordinates:n,props:o}=this,{onMove:a,options:{activationConstraint:c}}=o;if(!n)return;const i=(r=Lr(s))!=null?r:Bt,d=Ar(n,i);if(!l&&c){if(Fn(c)){if(c.tolerance!=null&&bo(d,c.tolerance))return this.handleCancel();if(bo(d,c.distance))return this.handleStart()}if(An(c)&&bo(d,c.tolerance))return this.handleCancel();this.handlePending(c,d);return}s.cancelable&&s.preventDefault(),a(i)}handleEnd(){const{onAbort:s,onEnd:r}=this.props;this.detach(),this.activated||s(this.props.active),r()}handleCancel(){const{onAbort:s,onCancel:r}=this.props;this.detach(),this.activated||s(this.props.active),r()}handleKeydown(s){s.code===qe.Esc&&this.handleCancel()}removeTextSelection(){var s;(s=this.document.getSelection())==null||s.removeAllRanges()}}const Su={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class fr extends dn{constructor(s){const{event:r}=s,l=Us(r.target);super(s,Su,l)}}fr.activators=[{eventName:"onPointerDown",handler:(t,s)=>{let{nativeEvent:r}=t,{onActivation:l}=s;return!r.isPrimary||r.button!==0?!1:(l?.({event:r}),!0)}}];const Cu={move:{name:"mousemove"},end:{name:"mouseup"}};var $o;(function(t){t[t.RightClick=2]="RightClick"})($o||($o={}));class Pu extends dn{constructor(s){super(s,Cu,Us(s.event.target))}}Pu.activators=[{eventName:"onMouseDown",handler:(t,s)=>{let{nativeEvent:r}=t,{onActivation:l}=s;return r.button===$o.RightClick?!1:(l?.({event:r}),!0)}}];const vo={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Mu extends dn{constructor(s){super(s,vo)}static setup(){return window.addEventListener(vo.move.name,s,{capture:!1,passive:!1}),function(){window.removeEventListener(vo.move.name,s)};function s(){}}}Mu.activators=[{eventName:"onTouchStart",handler:(t,s)=>{let{nativeEvent:r}=t,{onActivation:l}=s;const{touches:n}=r;return n.length>1?!1:(l?.({event:r}),!0)}}];var Zs;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(Zs||(Zs={}));var zr;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})(zr||(zr={}));function Ru(t){let{acceleration:s,activator:r=Zs.Pointer,canScroll:l,draggingRect:n,enabled:o,interval:a=5,order:c=zr.TreeOrder,pointerCoordinates:i,scrollableAncestors:d,scrollableAncestorRects:u,delta:m,threshold:p}=t;const x=Du({delta:m,disabled:!o}),[f,g]=_d(),h=b.useRef({x:0,y:0}),y=b.useRef({x:0,y:0}),j=b.useMemo(()=>{switch(r){case Zs.Pointer:return i?{top:i.y,bottom:i.y,left:i.x,right:i.x}:null;case Zs.DraggableRect:return n}},[r,n,i]),v=b.useRef(null),N=b.useCallback(()=>{const w=v.current;if(!w)return;const k=h.current.x*y.current.x,M=h.current.y*y.current.y;w.scrollBy(k,M)},[]),S=b.useMemo(()=>c===zr.TreeOrder?[...d].reverse():d,[c,d]);b.useEffect(()=>{if(!o||!d.length||!j){g();return}for(const w of S){if(l?.(w)===!1)continue;const k=d.indexOf(w),M=u[k];if(!M)continue;const{direction:C,speed:R}=gu(w,M,j,s,p);for(const P of["x","y"])x[P][C[P]]||(R[P]=0,C[P]=0);if(R.x>0||R.y>0){g(),v.current=w,f(N,a),h.current=R,y.current=C;return}}h.current={x:0,y:0},y.current={x:0,y:0},g()},[s,N,l,g,o,a,JSON.stringify(j),JSON.stringify(x),f,d,S,u,JSON.stringify(p)])}const Tu={x:{[st.Backward]:!1,[st.Forward]:!1},y:{[st.Backward]:!1,[st.Forward]:!1}};function Du(t){let{delta:s,disabled:r}=t;const l=Fr(s);return mr(n=>{if(r||!l||!n)return Tu;const o={x:Math.sign(s.x-l.x),y:Math.sign(s.y-l.y)};return{x:{[st.Backward]:n.x[st.Backward]||o.x===-1,[st.Forward]:n.x[st.Forward]||o.x===1},y:{[st.Backward]:n.y[st.Backward]||o.y===-1,[st.Forward]:n.y[st.Forward]||o.y===1}}},[r,s,l])}function Eu(t,s){const r=s!=null?t.get(s):void 0,l=r?r.node.current:null;return mr(n=>{var o;return s==null?null:(o=l??n)!=null?o:null},[l,s])}function Fu(t,s){return b.useMemo(()=>t.reduce((r,l)=>{const{sensor:n}=l,o=n.activators.map(a=>({eventName:a.eventName,handler:s(a.handler,l)}));return[...r,...o]},[]),[t,s])}var Is;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})(Is||(Is={}));var Io;(function(t){t.Optimized="optimized"})(Io||(Io={}));const Ln=new Map;function Au(t,s){let{dragging:r,dependencies:l,config:n}=s;const[o,a]=b.useState(null),{frequency:c,measure:i,strategy:d}=n,u=b.useRef(t),m=h(),p=or(m),x=b.useCallback(function(y){y===void 0&&(y=[]),!p.current&&a(j=>j===null?y:j.concat(y.filter(v=>!j.includes(v))))},[p]),f=b.useRef(null),g=mr(y=>{if(m&&!r)return Ln;if(!y||y===Ln||u.current!==t||o!=null){const j=new Map;for(let v of t){if(!v)continue;if(o&&o.length>0&&!o.includes(v.id)&&v.rect.current){j.set(v.id,v.rect.current);continue}const N=v.node.current,S=N?new cn(i(N),N):null;v.rect.current=S,S&&j.set(v.id,S)}return j}return y},[t,o,r,m,i]);return b.useEffect(()=>{u.current=t},[t]),b.useEffect(()=>{m||x()},[r,m]),b.useEffect(()=>{o&&o.length>0&&a(null)},[JSON.stringify(o)]),b.useEffect(()=>{m||typeof c!="number"||f.current!==null||(f.current=setTimeout(()=>{x(),f.current=null},c))},[c,m,x,...l]),{droppableRects:g,measureDroppableContainers:x,measuringScheduled:o!=null};function h(){switch(d){case Is.Always:return!1;case Is.BeforeDragging:return r;default:return!r}}}function un(t,s){return mr(r=>t?r||(typeof s=="function"?s(t):t):null,[s,t])}function Lu(t,s){return un(t,s)}function $u(t){let{callback:s,disabled:r}=t;const l=Zr(s),n=b.useMemo(()=>{if(r||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(l)},[l,r]);return b.useEffect(()=>()=>n?.disconnect(),[n]),n}function so(t){let{callback:s,disabled:r}=t;const l=Zr(s),n=b.useMemo(()=>{if(r||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(l)},[r]);return b.useEffect(()=>()=>n?.disconnect(),[n]),n}function Iu(t){return new cn(_s(t),t)}function $n(t,s,r){s===void 0&&(s=Iu);const[l,n]=b.useState(null);function o(){n(i=>{if(!t)return null;if(t.isConnected===!1){var d;return(d=i??r)!=null?d:null}const u=s(t);return JSON.stringify(i)===JSON.stringify(u)?i:u})}const a=$u({callback(i){if(t)for(const d of i){const{type:u,target:m}=d;if(u==="childList"&&m instanceof HTMLElement&&m.contains(t)){o();break}}}}),c=so({callback:o});return Vt(()=>{o(),t?(c?.observe(t),a?.observe(document.body,{childList:!0,subtree:!0})):(c?.disconnect(),a?.disconnect())},[t]),l}function zu(t){const s=un(t);return Ql(t,s)}const In=[];function Ou(t){const s=b.useRef(t),r=mr(l=>t?l&&l!==In&&t&&s.current&&t.parentNode===s.current.parentNode?l:an(t):In,[t]);return b.useEffect(()=>{s.current=t},[t]),r}function qu(t){const[s,r]=b.useState(null),l=b.useRef(t),n=b.useCallback(o=>{const a=yo(o.target);a&&r(c=>c?(c.set(a,Lo(a)),new Map(c)):null)},[]);return b.useEffect(()=>{const o=l.current;if(t!==o){a(o);const c=t.map(i=>{const d=yo(i);return d?(d.addEventListener("scroll",n,{passive:!0}),[d,Lo(d)]):null}).filter(i=>i!=null);r(c.length?new Map(c):null),l.current=t}return()=>{a(t),a(o)};function a(c){c.forEach(i=>{const d=yo(i);d?.removeEventListener("scroll",n)})}},[n,t]),b.useMemo(()=>t.length?s?Array.from(s.values()).reduce((o,a)=>Ls(o,a),Bt):na(t):Bt,[t,s])}function zn(t,s){s===void 0&&(s=[]);const r=b.useRef(null);return b.useEffect(()=>{r.current=null},s),b.useEffect(()=>{const l=t!==Bt;l&&!r.current&&(r.current=t),!l&&r.current&&(r.current=null)},[t]),r.current?Ar(t,r.current):Bt}function Uu(t){b.useEffect(()=>{if(!Qr)return;const s=t.map(r=>{let{sensor:l}=r;return l.setup==null?void 0:l.setup()});return()=>{for(const r of s)r?.()}},t.map(s=>{let{sensor:r}=s;return r}))}function _u(t,s){return b.useMemo(()=>t.reduce((r,l)=>{let{eventName:n,handler:o}=l;return r[n]=a=>{o(a,s)},r},{}),[t,s])}function ia(t){return b.useMemo(()=>t?xu(t):null,[t])}const On=[];function Wu(t,s){s===void 0&&(s=_s);const[r]=t,l=ia(r?Nt(r):null),[n,o]=b.useState(On);function a(){o(()=>t.length?t.map(i=>ra(i)?l:new cn(s(i),i)):On)}const c=so({callback:a});return Vt(()=>{c?.disconnect(),a(),t.forEach(i=>c?.observe(i))},[t]),n}function ca(t){if(!t)return null;if(t.children.length>1)return t;const s=t.children[0];return ur(s)?s:t}function Vu(t){let{measure:s}=t;const[r,l]=b.useState(null),n=b.useCallback(d=>{for(const{target:u}of d)if(ur(u)){l(m=>{const p=s(u);return m?{...m,width:p.width,height:p.height}:p});break}},[s]),o=so({callback:n}),a=b.useCallback(d=>{const u=ca(d);o?.disconnect(),u&&o?.observe(u),l(u?s(u):null)},[s,o]),[c,i]=Er(a);return b.useMemo(()=>({nodeRef:c,rect:r,setRef:i}),[r,c,i])}const Bu=[{sensor:fr,options:{}},{sensor:to,options:{}}],Hu={current:{}},Pr={draggable:{measure:Dn},droppable:{measure:Dn,strategy:Is.WhileDragging,frequency:Io.Optimized},dragOverlay:{measure:_s}};class er extends Map{get(s){var r;return s!=null&&(r=super.get(s))!=null?r:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(s=>{let{disabled:r}=s;return!r})}getNodeFor(s){var r,l;return(r=(l=this.get(s))==null?void 0:l.node.current)!=null?r:void 0}}const Gu={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new er,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:$r},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Pr,measureDroppableContainers:$r,windowRect:null,measuringScheduled:!1},da={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:$r,draggableNodes:new Map,over:null,measureDroppableContainers:$r},pr=b.createContext(da),ua=b.createContext(Gu);function Ju(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new er}}}function Ku(t,s){switch(s.type){case Ze.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:s.initialCoordinates,active:s.active}};case Ze.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:s.coordinates.x-t.draggable.initialCoordinates.x,y:s.coordinates.y-t.draggable.initialCoordinates.y}}};case Ze.DragEnd:case Ze.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Ze.RegisterDroppable:{const{element:r}=s,{id:l}=r,n=new er(t.droppable.containers);return n.set(l,r),{...t,droppable:{...t.droppable,containers:n}}}case Ze.SetDroppableDisabled:{const{id:r,key:l,disabled:n}=s,o=t.droppable.containers.get(r);if(!o||l!==o.key)return t;const a=new er(t.droppable.containers);return a.set(r,{...o,disabled:n}),{...t,droppable:{...t.droppable,containers:a}}}case Ze.UnregisterDroppable:{const{id:r,key:l}=s,n=t.droppable.containers.get(r);if(!n||l!==n.key)return t;const o=new er(t.droppable.containers);return o.delete(r),{...t,droppable:{...t.droppable,containers:o}}}default:return t}}function Yu(t){let{disabled:s}=t;const{active:r,activatorEvent:l,draggableNodes:n}=b.useContext(pr),o=Fr(l),a=Fr(r?.id);return b.useEffect(()=>{if(!s&&!l&&o&&a!=null){if(!eo(o)||document.activeElement===o.target)return;const c=n.get(a);if(!c)return;const{activatorNode:i,node:d}=c;if(!i.current&&!d.current)return;requestAnimationFrame(()=>{for(const u of[i.current,d.current]){if(!u)continue;const m=Bd(u);if(m){m.focus();break}}})}},[l,s,n,a,o]),null}function ma(t,s){let{transform:r,...l}=s;return t!=null&&t.length?t.reduce((n,o)=>o({transform:n,...l}),r):r}function Xu(t){return b.useMemo(()=>({draggable:{...Pr.draggable,...t?.draggable},droppable:{...Pr.droppable,...t?.droppable},dragOverlay:{...Pr.dragOverlay,...t?.dragOverlay}}),[t?.draggable,t?.droppable,t?.dragOverlay])}function Qu(t){let{activeNode:s,measure:r,initialRect:l,config:n=!0}=t;const o=b.useRef(!1),{x:a,y:c}=typeof n=="boolean"?{x:n,y:n}:n;Vt(()=>{if(!a&&!c||!s){o.current=!1;return}if(o.current||!l)return;const d=s?.node.current;if(!d||d.isConnected===!1)return;const u=r(d),m=Ql(u,l);if(a||(m.x=0),c||(m.y=0),o.current=!0,Math.abs(m.x)>0||Math.abs(m.y)>0){const p=ea(d);p&&p.scrollBy({top:m.y,left:m.x})}},[s,a,c,l,r])}const ro=b.createContext({...Bt,scaleX:1,scaleY:1});var ps;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(ps||(ps={}));const Or=b.memo(function(s){var r,l,n,o;let{id:a,accessibility:c,autoScroll:i=!0,children:d,sensors:u=Bu,collisionDetection:m=au,measuring:p,modifiers:x,...f}=s;const g=b.useReducer(Ku,void 0,Ju),[h,y]=g,[j,v]=Xd(),[N,S]=b.useState(ps.Uninitialized),w=N===ps.Initialized,{draggable:{active:k,nodes:M,translate:C},droppable:{containers:R}}=h,P=k!=null?M.get(k):null,D=b.useRef({initial:null,translated:null}),T=b.useMemo(()=>{var Ve;return k!=null?{id:k,data:(Ve=P?.data)!=null?Ve:Hu,rect:D}:null},[k,P]),E=b.useRef(null),[L,U]=b.useState(null),[_,B]=b.useState(null),z=or(f,Object.values(f)),A=xr("DndDescribedBy",a),F=b.useMemo(()=>R.getEnabled(),[R]),q=Xu(p),{droppableRects:W,measureDroppableContainers:I,measuringScheduled:$}=Au(F,{dragging:w,dependencies:[C.x,C.y],config:q.droppable}),V=Eu(M,k),K=b.useMemo(()=>_?Lr(_):null,[_]),ne=Ut(),ue=Lu(V,q.draggable.measure);Qu({activeNode:k!=null?M.get(k):null,config:ne.layoutShiftCompensation,initialRect:ue,measure:q.draggable.measure});const le=$n(V,q.draggable.measure,ue),je=$n(V?V.parentElement:null),ye=b.useRef({activatorEvent:null,active:null,activeNode:V,collisionRect:null,collisions:null,droppableRects:W,draggableNodes:M,draggingNode:null,draggingNodeRect:null,droppableContainers:R,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),ve=R.getNodeFor((r=ye.current.over)==null?void 0:r.id),se=Vu({measure:q.dragOverlay.measure}),Y=(l=se.nodeRef.current)!=null?l:V,te=w?(n=se.rect)!=null?n:le:null,G=!!(se.nodeRef.current&&se.rect),he=zu(G?null:le),we=ia(Y?Nt(Y):null),Ie=Ou(w?ve??V:null),Te=Wu(Ie),ze=ma(x,{transform:{x:C.x-he.x,y:C.y-he.y,scaleX:1,scaleY:1},activatorEvent:_,active:T,activeNodeRect:le,containerNodeRect:je,draggingNodeRect:te,over:ye.current.over,overlayNodeRect:se.rect,scrollableAncestors:Ie,scrollableAncestorRects:Te,windowRect:we}),re=K?Ls(K,C):null,H=qu(Ie),Q=zn(H),fe=zn(H,[le]),Z=Ls(ze,Q),oe=te?du(te,ze):null,me=T&&oe?m({active:T,collisionRect:oe,droppableRects:W,droppableContainers:F,pointerCoordinates:re}):null,ge=nu(me,"id"),[Pe,Oe]=b.useState(null),ct=G?ze:Ls(ze,fe),tt=iu(ct,(o=Pe?.rect)!=null?o:null,le),Ct=b.useRef(null),qt=b.useCallback((Ve,de)=>{let{sensor:ce,options:pe}=de;if(E.current==null)return;const De=M.get(E.current);if(!De)return;const _e=Ve.nativeEvent,Be=new ce({active:E.current,activeNode:De,event:_e,options:pe,context:ye,onAbort(Je){if(!M.get(Je))return;const{onDragAbort:ot}=z.current,dt={id:Je};ot?.(dt),j({type:"onDragAbort",event:dt})},onPending(Je,gt,ot,dt){if(!M.get(Je))return;const{onDragPending:At}=z.current,Mt={id:Je,constraint:gt,initialCoordinates:ot,offset:dt};At?.(Mt),j({type:"onDragPending",event:Mt})},onStart(Je){const gt=E.current;if(gt==null)return;const ot=M.get(gt);if(!ot)return;const{onDragStart:dt}=z.current,Ft={activatorEvent:_e,active:{id:gt,data:ot.data,rect:D}};St.unstable_batchedUpdates(()=>{dt?.(Ft),S(ps.Initializing),y({type:Ze.DragStart,initialCoordinates:Je,active:gt}),j({type:"onDragStart",event:Ft}),U(Ct.current),B(_e)})},onMove(Je){y({type:Ze.DragMove,coordinates:Je})},onEnd:Et(Ze.DragEnd),onCancel:Et(Ze.DragCancel)});Ct.current=Be;function Et(Je){return async function(){const{active:ot,collisions:dt,over:Ft,scrollAdjustedTranslate:At}=ye.current;let Mt=null;if(ot&&At){const{cancelDrop:kt}=z.current;Mt={activatorEvent:_e,active:ot,collisions:dt,delta:At,over:Ft},Je===Ze.DragEnd&&typeof kt=="function"&&await Promise.resolve(kt(Mt))&&(Je=Ze.DragCancel)}E.current=null,St.unstable_batchedUpdates(()=>{y({type:Je}),S(ps.Uninitialized),Oe(null),U(null),B(null),Ct.current=null;const kt=Je===Ze.DragEnd?"onDragEnd":"onDragCancel";if(Mt){const ys=z.current[kt];ys?.(Mt),j({type:kt,event:Mt})}})}}},[M]),Ht=b.useCallback((Ve,de)=>(ce,pe)=>{const De=ce.nativeEvent,_e=M.get(pe);if(E.current!==null||!_e||De.dndKit||De.defaultPrevented)return;const Be={active:_e};Ve(ce,de.options,Be)===!0&&(De.dndKit={capturedBy:de.sensor},E.current=pe,qt(ce,de))},[M,qt]),Pt=Fu(u,Ht);Uu(u),Vt(()=>{le&&N===ps.Initializing&&S(ps.Initialized)},[le,N]),b.useEffect(()=>{const{onDragMove:Ve}=z.current,{active:de,activatorEvent:ce,collisions:pe,over:De}=ye.current;if(!de||!ce)return;const _e={active:de,activatorEvent:ce,collisions:pe,delta:{x:Z.x,y:Z.y},over:De};St.unstable_batchedUpdates(()=>{Ve?.(_e),j({type:"onDragMove",event:_e})})},[Z.x,Z.y]),b.useEffect(()=>{const{active:Ve,activatorEvent:de,collisions:ce,droppableContainers:pe,scrollAdjustedTranslate:De}=ye.current;if(!Ve||E.current==null||!de||!De)return;const{onDragOver:_e}=z.current,Be=pe.get(ge),Et=Be&&Be.rect.current?{id:Be.id,rect:Be.rect.current,data:Be.data,disabled:Be.disabled}:null,Je={active:Ve,activatorEvent:de,collisions:ce,delta:{x:De.x,y:De.y},over:Et};St.unstable_batchedUpdates(()=>{Oe(Et),_e?.(Je),j({type:"onDragOver",event:Je})})},[ge]),Vt(()=>{ye.current={activatorEvent:_,active:T,activeNode:V,collisionRect:oe,collisions:me,droppableRects:W,draggableNodes:M,draggingNode:Y,draggingNodeRect:te,droppableContainers:R,over:Pe,scrollableAncestors:Ie,scrollAdjustedTranslate:Z},D.current={initial:te,translated:oe}},[T,V,me,oe,M,Y,te,W,R,Pe,Ie,Z]),Ru({...ne,delta:C,draggingRect:oe,pointerCoordinates:re,scrollableAncestors:Ie,scrollableAncestorRects:Te});const Gt=b.useMemo(()=>({active:T,activeNode:V,activeNodeRect:le,activatorEvent:_,collisions:me,containerNodeRect:je,dragOverlay:se,draggableNodes:M,droppableContainers:R,droppableRects:W,over:Pe,measureDroppableContainers:I,scrollableAncestors:Ie,scrollableAncestorRects:Te,measuringConfiguration:q,measuringScheduled:$,windowRect:we}),[T,V,le,_,me,je,se,M,R,W,Pe,I,Ie,Te,q,$,we]),rs=b.useMemo(()=>({activatorEvent:_,activators:Pt,active:T,activeNodeRect:le,ariaDescribedById:{draggable:A},dispatch:y,draggableNodes:M,over:Pe,measureDroppableContainers:I}),[_,Pt,T,le,y,A,M,Pe,I]);return O.createElement(Xl.Provider,{value:v},O.createElement(pr.Provider,{value:rs},O.createElement(ua.Provider,{value:Gt},O.createElement(ro.Provider,{value:tt},d)),O.createElement(Yu,{disabled:c?.restoreFocus===!1})),O.createElement(eu,{...c,hiddenTextDescribedById:A}));function Ut(){const Ve=L?.autoScrollEnabled===!1,de=typeof i=="object"?i.enabled===!1:i===!1,ce=w&&!Ve&&!de;return typeof i=="object"?{...i,enabled:ce}:{enabled:ce}}}),Zu=b.createContext(null),qn="button",em="Draggable";function tm(t){let{id:s,data:r,disabled:l=!1,attributes:n}=t;const o=xr(em),{activators:a,activatorEvent:c,active:i,activeNodeRect:d,ariaDescribedById:u,draggableNodes:m,over:p}=b.useContext(pr),{role:x=qn,roleDescription:f="draggable",tabIndex:g=0}=n??{},h=i?.id===s,y=b.useContext(h?ro:Zu),[j,v]=Er(),[N,S]=Er(),w=_u(a,s),k=or(r);Vt(()=>(m.set(s,{id:s,key:o,node:j,activatorNode:N,data:k}),()=>{const C=m.get(s);C&&C.key===o&&m.delete(s)}),[m,s]);const M=b.useMemo(()=>({role:x,tabIndex:g,"aria-disabled":l,"aria-pressed":h&&x===qn?!0:void 0,"aria-roledescription":f,"aria-describedby":u.draggable}),[l,x,g,h,f,u.draggable]);return{active:i,activatorEvent:c,activeNodeRect:d,attributes:M,isDragging:h,listeners:l?void 0:w,node:j,over:p,setNodeRef:v,setActivatorNodeRef:S,transform:y}}function xa(){return b.useContext(ua)}const sm="Droppable",rm={timeout:25};function om(t){let{data:s,disabled:r=!1,id:l,resizeObserverConfig:n}=t;const o=xr(sm),{active:a,dispatch:c,over:i,measureDroppableContainers:d}=b.useContext(pr),u=b.useRef({disabled:r}),m=b.useRef(!1),p=b.useRef(null),x=b.useRef(null),{disabled:f,updateMeasurementsFor:g,timeout:h}={...rm,...n},y=or(g??l),j=b.useCallback(()=>{if(!m.current){m.current=!0;return}x.current!=null&&clearTimeout(x.current),x.current=setTimeout(()=>{d(Array.isArray(y.current)?y.current:[y.current]),x.current=null},h)},[h]),v=so({callback:j,disabled:f||!a}),N=b.useCallback((M,C)=>{v&&(C&&(v.unobserve(C),m.current=!1),M&&v.observe(M))},[v]),[S,w]=Er(N),k=or(s);return b.useEffect(()=>{!v||!S.current||(v.disconnect(),m.current=!1,v.observe(S.current))},[S,v]),b.useEffect(()=>(c({type:Ze.RegisterDroppable,element:{id:l,key:o,disabled:r,node:S,rect:p,data:k}}),()=>c({type:Ze.UnregisterDroppable,key:o,id:l})),[l]),b.useEffect(()=>{r!==u.current.disabled&&(c({type:Ze.SetDroppableDisabled,id:l,key:o,disabled:r}),u.current.disabled=r)},[l,o,r,c]),{active:a,rect:p,isOver:i?.id===l,node:S,over:i,setNodeRef:w}}function nm(t){let{animation:s,children:r}=t;const[l,n]=b.useState(null),[o,a]=b.useState(null),c=Fr(r);return!r&&!l&&c&&n(c),Vt(()=>{if(!o)return;const i=l?.key,d=l?.props.id;if(i==null||d==null){n(null);return}Promise.resolve(s(d,o)).then(()=>{n(null)})},[s,l,o]),O.createElement(O.Fragment,null,r,l?b.cloneElement(l,{ref:a}):null)}const lm={x:0,y:0,scaleX:1,scaleY:1};function am(t){let{children:s}=t;return O.createElement(pr.Provider,{value:da},O.createElement(ro.Provider,{value:lm},s))}const im={position:"fixed",touchAction:"none"},cm=t=>eo(t)?"transform 250ms ease":void 0,dm=b.forwardRef((t,s)=>{let{as:r,activatorEvent:l,adjustScale:n,children:o,className:a,rect:c,style:i,transform:d,transition:u=cm}=t;if(!c)return null;const m=n?d:{...d,scaleX:1,scaleY:1},p={...im,width:c.width,height:c.height,top:c.top,left:c.left,transform:ts.Transform.toString(m),transformOrigin:n&&l?su(l,c):void 0,transition:typeof u=="function"?u(l):u,...i};return O.createElement(r,{className:a,style:p,ref:s},o)}),um=t=>s=>{let{active:r,dragOverlay:l}=s;const n={},{styles:o,className:a}=t;if(o!=null&&o.active)for(const[c,i]of Object.entries(o.active))i!==void 0&&(n[c]=r.node.style.getPropertyValue(c),r.node.style.setProperty(c,i));if(o!=null&&o.dragOverlay)for(const[c,i]of Object.entries(o.dragOverlay))i!==void 0&&l.node.style.setProperty(c,i);return a!=null&&a.active&&r.node.classList.add(a.active),a!=null&&a.dragOverlay&&l.node.classList.add(a.dragOverlay),function(){for(const[i,d]of Object.entries(n))r.node.style.setProperty(i,d);a!=null&&a.active&&r.node.classList.remove(a.active)}},mm=t=>{let{transform:{initial:s,final:r}}=t;return[{transform:ts.Transform.toString(s)},{transform:ts.Transform.toString(r)}]},xm={duration:250,easing:"ease",keyframes:mm,sideEffects:um({styles:{active:{opacity:"0"}}})};function fm(t){let{config:s,draggableNodes:r,droppableContainers:l,measuringConfiguration:n}=t;return Zr((o,a)=>{if(s===null)return;const c=r.get(o);if(!c)return;const i=c.node.current;if(!i)return;const d=ca(a);if(!d)return;const{transform:u}=Nt(a).getComputedStyle(a),m=Zl(u);if(!m)return;const p=typeof s=="function"?s:pm(s);return la(i,n.draggable.measure),p({active:{id:o,data:c.data,node:i,rect:n.draggable.measure(i)},draggableNodes:r,dragOverlay:{node:a,rect:n.dragOverlay.measure(d)},droppableContainers:l,measuringConfiguration:n,transform:m})})}function pm(t){const{duration:s,easing:r,sideEffects:l,keyframes:n}={...xm,...t};return o=>{let{active:a,dragOverlay:c,transform:i,...d}=o;if(!s)return;const u={x:c.rect.left-a.rect.left,y:c.rect.top-a.rect.top},m={scaleX:i.scaleX!==1?a.rect.width*i.scaleX/c.rect.width:1,scaleY:i.scaleY!==1?a.rect.height*i.scaleY/c.rect.height:1},p={x:i.x-u.x,y:i.y-u.y,...m},x=n({...d,active:a,dragOverlay:c,transform:{initial:i,final:p}}),[f]=x,g=x[x.length-1];if(JSON.stringify(f)===JSON.stringify(g))return;const h=l?.({active:a,dragOverlay:c,...d}),y=c.node.animate(x,{duration:s,easing:r,fill:"forwards"});return new Promise(j=>{y.onfinish=()=>{h?.(),j()}})}}let Un=0;function hm(t){return b.useMemo(()=>{if(t!=null)return Un++,Un},[t])}const mn=O.memo(t=>{let{adjustScale:s=!1,children:r,dropAnimation:l,style:n,transition:o,modifiers:a,wrapperElement:c="div",className:i,zIndex:d=999}=t;const{activatorEvent:u,active:m,activeNodeRect:p,containerNodeRect:x,draggableNodes:f,droppableContainers:g,dragOverlay:h,over:y,measuringConfiguration:j,scrollableAncestors:v,scrollableAncestorRects:N,windowRect:S}=xa(),w=b.useContext(ro),k=hm(m?.id),M=ma(a,{activatorEvent:u,active:m,activeNodeRect:p,containerNodeRect:x,draggingNodeRect:h.rect,over:y,overlayNodeRect:h.rect,scrollableAncestors:v,scrollableAncestorRects:N,transform:w,windowRect:S}),C=un(p),R=fm({config:l,draggableNodes:f,droppableContainers:g,measuringConfiguration:j}),P=C?h.setRef:void 0;return O.createElement(am,null,O.createElement(nm,{animation:R},m&&k?O.createElement(dm,{key:k,id:m.id,ref:P,as:c,activatorEvent:u,adjustScale:s,className:i,transition:o,rect:C,style:{zIndex:d,...n},transform:M},r):null))}),zo=t=>{let{transform:s}=t;return{...s,x:0}};function Cs(t,s,r){const l=t.slice();return l.splice(r<0?l.length+r:r,0,l.splice(s,1)[0]),l}function gm(t,s){return t.reduce((r,l,n)=>{const o=s.get(l);return o&&(r[n]=o),r},Array(t.length))}function yr(t){return t!==null&&t>=0}function ym(t,s){if(t===s)return!0;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==s[r])return!1;return!0}function bm(t){return typeof t=="boolean"?{draggable:t,droppable:t}:t}const xn=t=>{let{rects:s,activeIndex:r,overIndex:l,index:n}=t;const o=Cs(s,l,r),a=s[n],c=o[n];return!c||!a?null:{x:c.left-a.left,y:c.top-a.top,scaleX:c.width/a.width,scaleY:c.height/a.height}},br={scaleX:1,scaleY:1},qr=t=>{var s;let{activeIndex:r,activeNodeRect:l,index:n,rects:o,overIndex:a}=t;const c=(s=o[r])!=null?s:l;if(!c)return null;if(n===r){const d=o[a];return d?{x:0,y:r<a?d.top+d.height-(c.top+c.height):d.top-c.top,...br}:null}const i=vm(o,n,r);return n>r&&n<=a?{x:0,y:-c.height-i,...br}:n<r&&n>=a?{x:0,y:c.height+i,...br}:{x:0,y:0,...br}};function vm(t,s,r){const l=t[s],n=t[s-1],o=t[s+1];return l?r<s?n?l.top-(n.top+n.height):o?o.top-(l.top+l.height):0:o?o.top-(l.top+l.height):n?l.top-(n.top+n.height):0:0}const fa="Sortable",pa=O.createContext({activeIndex:-1,containerId:fa,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:xn,disabled:{draggable:!1,droppable:!1}});function lr(t){let{children:s,id:r,items:l,strategy:n=xn,disabled:o=!1}=t;const{active:a,dragOverlay:c,droppableRects:i,over:d,measureDroppableContainers:u}=xa(),m=xr(fa,r),p=c.rect!==null,x=b.useMemo(()=>l.map(w=>typeof w=="object"&&"id"in w?w.id:w),[l]),f=a!=null,g=a?x.indexOf(a.id):-1,h=d?x.indexOf(d.id):-1,y=b.useRef(x),j=!ym(x,y.current),v=h!==-1&&g===-1||j,N=bm(o);Vt(()=>{j&&f&&u(x)},[j,x,f,u]),b.useEffect(()=>{y.current=x},[x]);const S=b.useMemo(()=>({activeIndex:g,containerId:m,disabled:N,disableTransforms:v,items:x,overIndex:h,useDragOverlay:p,sortedRects:gm(x,i),strategy:n}),[g,m,N.draggable,N.droppable,v,x,h,i,p,n]);return O.createElement(pa.Provider,{value:S},s)}const jm=t=>{let{id:s,items:r,activeIndex:l,overIndex:n}=t;return Cs(r,l,n).indexOf(s)},Nm=t=>{let{containerId:s,isSorting:r,wasDragging:l,index:n,items:o,newIndex:a,previousItems:c,previousContainerId:i,transition:d}=t;return!d||!l||c!==o&&n===a?!1:r?!0:a!==n&&s===i},km={duration:200,easing:"ease"},ha="transform",wm=ts.Transition.toString({property:ha,duration:0,easing:"linear"}),Sm={roleDescription:"sortable"};function Cm(t){let{disabled:s,index:r,node:l,rect:n}=t;const[o,a]=b.useState(null),c=b.useRef(r);return Vt(()=>{if(!s&&r!==c.current&&l.current){const i=n.current;if(i){const d=_s(l.current,{ignoreTransform:!0}),u={x:i.left-d.left,y:i.top-d.top,scaleX:i.width/d.width,scaleY:i.height/d.height};(u.x||u.y)&&a(u)}}r!==c.current&&(c.current=r)},[s,r,l,n]),b.useEffect(()=>{o&&a(null)},[o]),o}function fn(t){let{animateLayoutChanges:s=Nm,attributes:r,disabled:l,data:n,getNewIndex:o=jm,id:a,strategy:c,resizeObserverConfig:i,transition:d=km}=t;const{items:u,containerId:m,activeIndex:p,disabled:x,disableTransforms:f,sortedRects:g,overIndex:h,useDragOverlay:y,strategy:j}=b.useContext(pa),v=Pm(l,x),N=u.indexOf(a),S=b.useMemo(()=>({sortable:{containerId:m,index:N,items:u},...n}),[m,n,N,u]),w=b.useMemo(()=>u.slice(u.indexOf(a)),[u,a]),{rect:k,node:M,isOver:C,setNodeRef:R}=om({id:a,data:S,disabled:v.droppable,resizeObserverConfig:{updateMeasurementsFor:w,...i}}),{active:P,activatorEvent:D,activeNodeRect:T,attributes:E,setNodeRef:L,listeners:U,isDragging:_,over:B,setActivatorNodeRef:z,transform:A}=tm({id:a,data:S,attributes:{...Sm,...r},disabled:v.draggable}),F=Ud(R,L),q=!!P,W=q&&!f&&yr(p)&&yr(h),I=!y&&_,$=I&&W?A:null,K=W?$??(c??j)({rects:g,activeNodeRect:T,activeIndex:p,overIndex:h,index:N}):null,ne=yr(p)&&yr(h)?o({id:a,items:u,activeIndex:p,overIndex:h}):N,ue=P?.id,le=b.useRef({activeId:ue,items:u,newIndex:ne,containerId:m}),je=u!==le.current.items,ye=s({active:P,containerId:m,isDragging:_,isSorting:q,id:a,index:N,items:u,newIndex:le.current.newIndex,previousItems:le.current.items,previousContainerId:le.current.containerId,transition:d,wasDragging:le.current.activeId!=null}),ve=Cm({disabled:!ye,index:N,node:M,rect:k});return b.useEffect(()=>{q&&le.current.newIndex!==ne&&(le.current.newIndex=ne),m!==le.current.containerId&&(le.current.containerId=m),u!==le.current.items&&(le.current.items=u)},[q,ne,m,u]),b.useEffect(()=>{if(ue===le.current.activeId)return;if(ue!=null&&le.current.activeId==null){le.current.activeId=ue;return}const Y=setTimeout(()=>{le.current.activeId=ue},50);return()=>clearTimeout(Y)},[ue]),{active:P,activeIndex:p,attributes:E,data:S,rect:k,index:N,newIndex:ne,items:u,isOver:C,isSorting:q,isDragging:_,listeners:U,node:M,overIndex:h,over:B,setNodeRef:F,setActivatorNodeRef:z,setDroppableNodeRef:R,setDraggableNodeRef:L,transform:ve??K,transition:se()};function se(){if(ve||je&&le.current.newIndex===N)return wm;if(!(I&&!eo(D)||!d)&&(q||ye))return ts.Transition.toString({...d,property:ha})}}function Pm(t,s){var r,l;return typeof t=="boolean"?{draggable:t,droppable:!1}:{draggable:(r=t?.draggable)!=null?r:s.draggable,droppable:(l=t?.droppable)!=null?l:s.droppable}}qe.Down,qe.Right,qe.Up,qe.Left;const Ur=({preset:t,listName:s,theme:r,language:l,onLoad:n,rightAdornment:o,onAfterSelect:a})=>{const{attributes:c,listeners:i,setNodeRef:d,transform:u,transition:m,isDragging:p}=fn({id:t.id,data:{containerId:s}}),x={transform:ts.Transform.toString(u),transition:m,opacity:p?.6:void 0};return e.jsx("div",{ref:d,style:x,children:e.jsxs("button",{"data-preset-id":t.id,onClick:()=>{n(t.id),a&&a()},className:`relative w-full p-2 pr-8 rounded-lg border transition-all duration-200 text-left flex items-center ${p?"opacity-60":"hover:shadow-sm"}`,style:{backgroundColor:r.colors.surface+"50",borderColor:r.colors.border,color:r.colors.text},children:[e.jsx("span",{className:"text-lg",children:t.emoji||"âš™ï¸"}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",title:t.name,children:t.name}),e.jsx("div",{className:"text-xs opacity-75 truncate",title:[t.formData.symbol,t.formData.timeframe,t.formData.strategy].filter(Boolean).join(" â€¢ ")||"â€”",children:[t.formData.symbol,t.formData.timeframe,t.formData.strategy].filter(Boolean).join(" â€¢ ")||"â€”"})]}),o,e.jsx("div",{className:"w-5 flex-shrink-0 flex items-center justify-center absolute right-2 top-1/2 -translate-y-1/2 z-10",children:e.jsx("span",{className:"text-xs select-none",style:{color:r.colors.textMuted,cursor:"grab"},...c,...i,title:l==="fr"?"Glisser pour rÃ©organiser":"Drag to reorder",children:"â‹®â‹®"})})]})})};function Mm(t,s){const[r,l]=b.useState(null),n=ln(nr(fr,{activationConstraint:{delay:150,tolerance:5}}),nr(to)),o=b.useMemo(()=>t.filter(p=>p.isFavorite).sort((p,x)=>(p.sortIndex??0)-(x.sortIndex??0)),[t]),a=b.useMemo(()=>t.filter(p=>p.lastUsed&&!p.isFavorite).sort((p,x)=>(p.sortIndex??0)-(x.sortIndex??0)),[t]),c=b.useMemo(()=>t.filter(p=>!p.isFavorite&&!p.lastUsed).sort((p,x)=>(p.sortIndex??0)-(x.sortIndex??0)),[t]),i=b.useMemo(()=>[...a,...c],[a,c]);return{sensors:n,activeId:r,favoritePresets:o,recentPresets:a,otherPresets:c,getPresetById:p=>t.find(x=>x.id===p),handleDragStart:p=>{l(p.active.id)},handleDragEnd:p=>{const{active:x,over:f}=p;if(l(null),!f||x.id===f.id||!s)return;const g=x.data.current?.containerId,h=f.data.current?.containerId;if(!g||!h||g!==h)return;let y=o.map(N=>N.id),j=i.map(N=>N.id);if(g==="favorites"){const N=y.indexOf(x.id),S=y.indexOf(f.id);N!==-1&&S!==-1&&(y=Cs(y,N,S))}if(g==="others"){const N=j.indexOf(x.id),S=j.indexOf(f.id);N!==-1&&S!==-1&&(j=Cs(j,N,S))}const v=[...y,...j];s(v)}}}const Rm=({favoritePresets:t,recentPresets:s,otherPresets:r,theme:l,language:n,onLoadPreset:o,onCloseDropdown:a})=>{const c=l.colors.textSecondary,i=l.colors.textMuted;return e.jsxs("div",{className:"flex",style:{maxHeight:"600px"},children:[e.jsx("div",{className:"flex-1 border-r",style:{borderColor:l.colors.border},children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(it,{size:14,className:"mr-2",style:{color:"#F59E0B"}}),e.jsxs("span",{className:"text-xs font-semibold",style:{color:c},children:[n==="fr"?"Favoris":"Favorites"," (",t.length,")"]})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:e.jsx(lr,{items:t.map(d=>d.id),strategy:qr,children:t.map(d=>e.jsx(Ur,{preset:d,listName:"favorites",onLoad:o,rightAdornment:e.jsx(it,{size:12,className:"ml-2",style:{color:"#F59E0B"}}),theme:l,language:n,onAfterSelect:a},d.id))})})]})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(ss,{size:14,className:"mr-2",style:{color:i}}),e.jsxs("span",{className:"text-xs font-semibold",style:{color:c},children:[n==="fr"?"Autres":"Others"," (",s.length+r.length,")"]})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:(()=>{const d=new Set(s.map(m=>m.id)),u=[...s,...r];return e.jsx(lr,{items:u.map(m=>m.id),strategy:qr,children:u.map(m=>e.jsx(Ur,{preset:m,listName:"others",onLoad:o,rightAdornment:d.has(m.id)?e.jsx($e,{size:12,className:"ml-2 pointer-events-none",style:{color:"#10B981"}}):void 0,theme:l,language:n,onAfterSelect:a},m.id))})})()})]})})]})},ga=({formData:t,presets:s,onLoadPreset:r,onSavePreset:l,onDeletePreset:n,onToggleFavorite:o,onManagePresets:a,onReorderPresets:c})=>{const{currentTheme:i}=ee(),{currentLanguage:d}=X(),[u,m]=b.useState(!1),[p,x]=b.useState(!1),[f,g]=b.useState("bottom"),[h,y]=b.useState(0),[j,v]=b.useState(0),N=b.useRef(null),S=b.useRef(null),w=b.useRef();b.useEffect(()=>{const z=A=>{const F=A.target,q=N.current?.contains(F),W=S.current?.contains(F);q||W||m(!1)};return document.addEventListener("mousedown",z),()=>document.removeEventListener("mousedown",z)},[]);const k=()=>{w.current&&clearTimeout(w.current);const z=N.current?.querySelector("button")?.getBoundingClientRect();if(z){const A=window.innerHeight-z.bottom,F=z.top,q=A<400&&F>A?"top":"bottom";g(q),y(q==="top"?window.innerHeight-z.top+8:z.bottom+8);const W=z.left+z.width/2,I=d==="en"?Math.min(150,Math.max(80,Math.round(window.innerWidth*.05))):0;v(W+I)}m(!0)},M=()=>{w.current=setTimeout(()=>{m(!1)},200)},C=()=>{const z=[];return t.strategy&&z.push(t.strategy),t.symbol&&z.push(t.symbol),t.timeframe&&z.push(t.timeframe),z.length===0?d==="fr"?"Nouveau Preset":"New Preset":z.join(" ")},R=z=>{if(z.stopPropagation(),z.shiftKey){const A=C();l(A,t,!1),m(!1);return}x(!0),m(!1)},{sensors:P,activeId:D,favoritePresets:T,recentPresets:E,otherPresets:L,getPresetById:U,handleDragStart:_,handleDragEnd:B}=Mm(s,c);return e.jsxs("div",{className:"relative",ref:N,style:{overflow:"visible"},children:[e.jsxs("button",{onMouseEnter:k,onMouseLeave:M,className:"flex items-center px-3 py-2 rounded-lg transition-all duration-200 hover:shadow-md",style:{backgroundColor:u?i.colors.accent+"20":i.colors.surface,color:u?i.colors.accent:i.colors.text,border:`1px solid ${i.colors.border}`},children:[e.jsx(Dt,{size:16,className:"mr-2"}),e.jsx("span",{className:"font-medium",children:"Presets"}),e.jsx(Le,{size:14,className:`ml-2 transition-transform duration-200 ${u?"rotate-180":""}`})]}),u&&(typeof document<"u"?St.createPortal(e.jsxs("div",{ref:S,onMouseEnter:k,onMouseLeave:M,className:`fixed ${f==="top"?"bottom-auto":"top-auto"} -translate-x-1/2 transform w-[48rem] max-w-[calc(100vw-2rem)] rounded-xl shadow-2xl border z-[9999] overflow-hidden`,style:{backgroundColor:i.colors.card,borderColor:i.colors.accent+"60",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",minHeight:"59vh",maxHeight:"none",overflowY:"auto",left:`${j}px`,...f==="top"?{bottom:`${h}px`}:{top:`${h}px`}},children:[e.jsx("div",{className:"px-3 py-2 border-b",style:{borderColor:i.colors.border,background:`linear-gradient(135deg, ${i.colors.surface} 0%, ${i.colors.card} 100%)`},children:e.jsx("h3",{className:"font-bold text-sm",style:{color:i.colors.text},children:"Presets"})}),T.length>0&&(E.length>0||L.length>0)?e.jsx(Or,{sensors:P,collisionDetection:Ir,modifiers:[zo],onDragStart:_,onDragEnd:B,children:e.jsx(Rm,{favoritePresets:T,recentPresets:E,otherPresets:L,theme:i,language:d,onLoadPreset:r,onCloseDropdown:()=>m(!1)})}):e.jsxs(Or,{sensors:P,collisionDetection:Ir,modifiers:[zo],onDragStart:_,onDragEnd:B,children:[e.jsx("div",{className:"p-3",style:{maxHeight:"600px"},children:e.jsxs("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:[T.map(z=>e.jsx(Ur,{preset:z,listName:"favorites",onLoad:r,rightAdornment:e.jsx(it,{size:12,className:"ml-2",style:{color:"#F59E0B"}}),theme:i,language:d,onAfterSelect:()=>m(!1)},z.id)),E.map(z=>e.jsxs("button",{"data-preset-id":z.id,onClick:()=>{r(z.id),m(!1)},className:"relative w-full p-2 pr-8 rounded-lg border transition-all duration-200 text-left flex items-center hover:shadow-sm",style:{backgroundColor:i.colors.surface+"50",borderColor:i.colors.border,color:i.colors.text},children:[e.jsx("span",{className:"text-lg",children:z.emoji||"âš™ï¸"}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",title:z.name,children:z.name}),e.jsx("div",{className:"text-xs opacity-75 truncate",title:[z.formData.symbol,z.formData.timeframe,z.formData.strategy].filter(Boolean).join(" â€¢ ")||"â€”",children:[z.formData.symbol,z.formData.timeframe,z.formData.strategy].filter(Boolean).join(" â€¢ ")||"â€”"})]}),e.jsx($e,{size:12,className:"ml-2 relative z-0 pointer-events-none",style:{color:"#10B981"}})]},z.id)),L.map(z=>e.jsx(Ur,{preset:z,listName:"others",onLoad:r,theme:i,language:d,onAfterSelect:()=>m(!1)},z.id))]})}),St.createPortal(e.jsx(mn,{adjustScale:!1,dropAnimation:null,children:D?(()=>{const z=U(D);return z?e.jsxs("div",{className:"p-2 rounded-lg border text-left flex items-center",style:{backgroundColor:i.colors.surface+"70",borderColor:i.colors.border,color:i.colors.text,pointerEvents:"none",boxShadow:"0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1)"},children:[e.jsx("span",{className:"text-lg",children:z.emoji||"âš™ï¸"}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",children:z.name}),e.jsx("div",{className:"text-xs opacity-75 truncate",children:[z.formData.symbol,z.formData.timeframe,z.formData.strategy].filter(Boolean).join(" â€¢ ")||"â€”"})]})]}):null})():null}),document.body)]}),s.length===0&&e.jsxs("div",{className:"p-6 text-center",style:{color:i.colors.textMuted},children:[e.jsx(Dt,{size:24,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:d==="fr"?"Aucun preset sauvegardÃ©":"No presets saved"})]}),e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("button",{onClick:R,className:"w-full flex items-center justify-between px-2 py-1.5 rounded-lg transition-all duration-200 hover:shadow-md text-sm",style:{backgroundColor:i.colors.accent+"20",color:i.colors.accent,border:`1px solid ${i.colors.accent}40`},children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Dt,{size:14,className:"mr-1.5"}),e.jsx("span",{className:"font-medium",children:d==="fr"?"ðŸ’¾ Sauvegarder":"ðŸ’¾ Save"})]}),e.jsx("span",{className:"text-xs opacity-75 text-white",children:d==="fr"?'Shift + clic "Sauvegarder" pour une sauvegarde rapide':'Shift + click "Save" for quick save'})]}),e.jsxs("button",{onClick:()=>{a(),m(!1)},className:"w-full flex items-center px-2 py-1.5 rounded-lg transition-all duration-200 hover:shadow-sm text-sm",style:{backgroundColor:i.colors.surface,color:i.colors.text,border:`1px solid ${i.colors.border}`},children:[e.jsx(ss,{size:14,className:"mr-1.5"}),e.jsx("span",{children:d==="fr"?"âš™ï¸ GÃ©rer":"âš™ï¸ Manage"})]})]})]}),document.body):null),p&&e.jsx(qd,{initialName:C(),onSave:(z,A)=>{l(z,t,A),x(!1)},onClose:()=>x(!1),existingNames:s.map(z=>z.name)})]})},Tm=({isOpen:t,preset:s,onSave:r,onClose:l})=>{const{currentTheme:n}=ee(),{currentLanguage:o}=X(),[a,c]=b.useState({name:"",emoji:""}),[i,d]=b.useState(!1),u=["ðŸ“ˆ","ðŸ“‰","ðŸ“Š","ðŸ’¹","âš¡","ðŸ”","ðŸŽ¯","ðŸ”„","âš™ï¸","ðŸŒŠ","ðŸ””","ðŸ’°"],m=["ðŸš€","ðŸ’Ž","ðŸ”¥","â­","ðŸ’ª","ðŸŽ²","ðŸ†","ðŸŒŸ","ðŸ’¡","âš”ï¸","ðŸŽ¨","ðŸŽ­","ðŸŽ¸","ðŸŽ¹","ðŸŽº","ðŸŽ»","ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰","ðŸ…","ðŸŽ–ï¸"];b.useEffect(()=>{s&&c({name:s.name,emoji:s.emoji||""})},[s]),b.useEffect(()=>{const f=g=>{if(i){const h=g.target,y=document.querySelector("[data-emoji-menu]");y&&!y.contains(h)&&d(!1)}};return i&&document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[i]);const p=f=>{f.preventDefault(),s&&a.name.trim()&&(r(s.id,{name:a.name.trim(),emoji:a.emoji}),l())},x=()=>{d(!1),l()};return!t||!s?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"w-full max-w-lg rounded-xl shadow-2xl border overflow-hidden",style:{backgroundColor:n.colors.card,borderColor:n.colors.border,minHeight:"400px"},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",style:{borderColor:n.colors.border},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-xl",children:a.emoji}),e.jsx("h2",{className:"text-lg font-bold",style:{color:n.colors.text},children:o==="fr"?"Modifier le Preset":"Edit Preset"})]}),e.jsx("button",{onClick:x,className:"p-1 rounded-full hover:bg-opacity-10 hover:bg-black transition-colors",style:{color:n.colors.textMuted},children:e.jsx(be,{size:20})})]}),e.jsxs("form",{onSubmit:p,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",style:{color:n.colors.textSecondary},children:[o==="fr"?"Nom":"Name"," *"]}),e.jsx("input",{type:"text",value:a.name,onChange:f=>c(g=>({...g,name:f.target.value})),placeholder:o==="fr"?"Nom du preset...":"Preset name...",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:n.colors.surface,borderColor:n.colors.border,color:n.colors.text},autoFocus:!0,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:n.colors.textSecondary},children:"Emoji"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"text",value:a.emoji,onChange:f=>c(g=>({...g,emoji:f.target.value})),placeholder:"Ex:ðŸš€",className:"w-20 px-2 py-3 border rounded-lg text-center text-2xl focus:outline-none focus:ring-2 transition-colors",style:{backgroundColor:n.colors.surface,borderColor:n.colors.border,color:n.colors.text},maxLength:4}),e.jsx("div",{className:"flex-1 flex items-center",children:e.jsxs("div",{className:"flex flex-wrap gap-2 relative",children:[u.map(f=>e.jsx("button",{type:"button",onClick:g=>{g.stopPropagation(),g.preventDefault(),c(h=>({...h,emoji:f})),d(!1)},className:`w-8 h-8 flex items-center justify-center rounded-lg text-xl transition-all ${a.emoji===f?"ring-2":""}`,style:{backgroundColor:a.emoji===f?`${n.colors.accent}20`:n.colors.surface,borderColor:a.emoji===f?n.colors.accent:n.colors.border},children:f},f)),e.jsx("button",{type:"button",onClick:f=>{f.stopPropagation(),f.preventDefault(),d(!i)},className:"w-8 h-8 flex items-center justify-center rounded-lg text-sm font-bold transition-all hover:scale-110",style:{backgroundColor:n.colors.surface,borderColor:n.colors.border,color:n.colors.text},title:o==="fr"?"Plus d'emojis":"More emojis",children:"+"}),i&&e.jsx("div",{"data-emoji-menu":!0,className:"absolute top-10 left-0 z-50 p-3 rounded-lg shadow-lg border max-h-48 overflow-y-auto",style:{backgroundColor:n.colors.card,borderColor:n.colors.border,minWidth:"200px"},children:e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(f=>e.jsx("button",{type:"button",onClick:g=>{g.stopPropagation(),g.preventDefault(),c(h=>({...h,emoji:f})),d(!1)},className:`w-8 h-8 flex items-center justify-center rounded-lg text-xl transition-all hover:scale-110 ${a.emoji===f?"ring-2":""}`,style:{backgroundColor:a.emoji===f?`${n.colors.accent}20`:n.colors.surface,borderColor:a.emoji===f?n.colors.accent:n.colors.border},children:f},f))})})]})})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 rounded-lg border transition-colors",style:{backgroundColor:n.colors.surface,borderColor:n.colors.border,color:n.colors.text},children:o==="fr"?"Annuler":"Cancel"}),e.jsxs("button",{type:"submit",className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:n.colors.accent,color:"#ffffff"},disabled:!a.name.trim(),children:[e.jsx(Dt,{size:16}),e.jsx("span",{children:o==="fr"?"Sauvegarder":"Save"})]})]})]})]})})},Dm=({currentTheme:t,currentLanguage:s,searchQuery:r,setSearchQuery:l,filterType:n,setFilterType:o,selectedCategory:a,setSelectedCategory:c,categories:i,showCategoryFilter:d=!0})=>e.jsxs("div",{className:"p-6 border-b space-y-4",style:{borderColor:t.colors.border},children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(jt,{size:20,className:"absolute left-3 top-1/2 transform -translate-y-1/2",style:{color:t.colors.textMuted}}),e.jsx("input",{type:"text",placeholder:s==="fr"?"Rechercher des presets...":"Search presets...",value:r,onChange:u=>l(u.target.value),className:"w-full pl-10 pr-4 py-3 rounded-lg border",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}})]}),e.jsx("div",{className:"flex gap-2",children:[{key:"all",label:s==="fr"?"Tous":"All"},{key:"favorites",label:s==="fr"?"Favoris":"Favorites"},{key:"recent",label:s==="fr"?"RÃ©cents":"Recent"},{key:"category",label:s==="fr"?"CatÃ©gorie":"Category"}].map(u=>e.jsx("button",{onClick:()=>{o(u.key),c("")},className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${n===u.key?"text-white":""}`,style:{backgroundColor:n===u.key?t.colors.accent:t.colors.surface,color:n===u.key?"white":t.colors.text,border:`1px solid ${t.colors.border}`},children:u.label},u.key))})]}),n==="category"&&d&&e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{onClick:()=>c(""),className:`px-3 py-1 rounded-full text-xs ${a===""?"text-white":""}`,style:{backgroundColor:a===""?t.colors.accent:t.colors.surface,color:a===""?"white":t.colors.text,border:`1px solid ${t.colors.border}`},children:s==="fr"?"Toutes":"All"}),i.map(u=>e.jsx("button",{onClick:()=>c(u||""),className:`px-3 py-1 rounded-full text-xs ${a===u?"text-white":""}`,style:{backgroundColor:a===u?t.colors.accent:t.colors.surface,color:a===u?"white":t.colors.text,border:`1px solid ${t.colors.border}`},children:u},u))]})]}),Em=({activeId:t,getItemById:s,theme:r})=>{const l=t?s(t):void 0;return e.jsx(mn,{adjustScale:!1,dropAnimation:null,children:l?e.jsxs("div",{className:"p-2 rounded-lg border text-left flex items-center",style:{backgroundColor:r.colors.surface+"70",borderColor:r.colors.border,color:r.colors.text,pointerEvents:"none",boxShadow:"0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1)"},children:[e.jsx("span",{className:"text-lg",children:l.emoji||"âš™ï¸"}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",children:l.name}),e.jsx("div",{className:"text-xs opacity-75 truncate",children:l.formData.symbol||l.formData.market||"â€”"})]})]}):null})};function Fm(t,s){const[r,l]=b.useState(null),n=ln(nr(fr,{activationConstraint:{delay:150,tolerance:5}}),nr(to)),o=b.useMemo(()=>t.filter(u=>u.isFavorite).sort((u,m)=>(u.sortIndex??0)-(m.sortIndex??0)),[t]),a=b.useMemo(()=>t.filter(u=>!u.isFavorite).sort((u,m)=>(u.sortIndex??0)-(m.sortIndex??0)),[t]);return{sensors:n,activeId:r,favoritesSorted:o,othersSorted:a,getPresetById:u=>t.find(m=>m.id===u),handleDragStart:u=>{l(u.active.id)},handleDragEnd:u=>{const{active:m,over:p}=u;if(l(null),!p||m.id===p.id||!s)return;const x=m.data.current?.containerId,f=p.data.current?.containerId;if(!x||!f||x!==f)return;let g=o.map(j=>j.id),h=a.map(j=>j.id);if(x==="favorites"){const j=g.indexOf(m.id),v=g.indexOf(p.id);j!==-1&&v!==-1&&(g=Cs(g,j,v))}if(x==="others"){const j=h.indexOf(m.id),v=h.indexOf(p.id);j!==-1&&v!==-1&&(h=Cs(h,j,v))}const y=[...g,...h];s(y)}}}const _n=({preset:t,listName:s,theme:r,language:l})=>{const{attributes:n,listeners:o,setNodeRef:a,transform:c,transition:i,isDragging:d}=fn({id:t.id,data:{containerId:s}}),u={transform:ts.Transform.toString(c),transition:i,opacity:d?.6:void 0};return e.jsxs("div",{ref:a,className:"grid grid-cols-12 gap-4 p-3 rounded-lg border bg-opacity-60",style:{...u,backgroundColor:r.colors.surface+"40",borderColor:r.colors.border,color:r.colors.text},children:[e.jsx("div",{className:"col-span-1 flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:t.emoji||"âš™ï¸"})}),e.jsxs("div",{className:"col-span-7 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:t.name}),e.jsx("div",{className:"text-xs opacity-75 truncate",children:t.formData.symbol||t.formData.market||"â€”"})]}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsx("span",{className:"px-2 py-1 rounded-full text-xs",style:{backgroundColor:r.colors.accent+"20",color:r.colors.accent},children:t.category||"â€”"})}),e.jsx("div",{className:"col-span-2 flex items-center justify-end",children:e.jsx("span",{className:"text-xs select-none",style:{color:r.colors.text,opacity:.6,cursor:"grab"},...n,...o,title:l==="fr"?"Glisser pour rÃ©organiser":"Drag to reorder",children:"â‹®â‹®"})})]})},Am=({favorites:t,others:s,theme:r,language:l})=>e.jsxs("div",{className:"p-6 grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(it,{size:14,className:"mr-2",style:{color:"#F59E0B"}}),e.jsxs("span",{className:"text-xs font-semibold",style:{color:r.colors.textSecondary},children:[l==="fr"?"Favoris":"Favorites"," (",t.length,")"]})]}),e.jsx("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto",children:e.jsx(lr,{items:t.map(n=>n.id),strategy:qr,children:t.map(n=>e.jsx(_n,{preset:n,listName:"favorites",theme:r,language:l},n.id))})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(ds,{size:14,className:"mr-2",style:{color:r.colors.textMuted}}),e.jsxs("span",{className:"text-xs font-semibold",style:{color:r.colors.textSecondary},children:[l==="fr"?"Autres":"Others"," (",s.length,")"]})]}),e.jsx("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto",children:e.jsx(lr,{items:s.map(n=>n.id),strategy:qr,children:s.map(n=>e.jsx(_n,{preset:n,listName:"others",theme:r,language:l},n.id))})})]})]}),Lm=({currentTheme:t,currentLanguage:s,displayedCount:r,onSelectMostRecent:l,onClose:n,disabledSelectMostRecent:o})=>e.jsx("div",{className:"p-6 border-t",style:{borderColor:t.colors.border},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm",style:{color:t.colors.textMuted},children:s==="fr"?`${r} preset(s) affichÃ©(s)`:`${r} preset(s) displayed`}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:l,className:"px-4 py-2 rounded-lg font-medium transition-colors",style:{backgroundColor:t.colors.surface,color:t.colors.text,border:`1px solid ${t.colors.border}`},disabled:o,children:s==="fr"?"SÃ©lectionner le plus rÃ©cent":"Select most recent"}),e.jsx("button",{onClick:n,className:"px-6 py-2 rounded-lg font-medium transition-colors",style:{backgroundColor:t.colors.accent,color:"white"},children:s==="fr"?"Fermer":"Close"})]})]})}),ya=({presets:t,onClose:s,onDeletePreset:r,onToggleFavorite:l,onUpdatePreset:n,onLoadPreset:o,onReorderPresets:a})=>{const{currentTheme:c}=ee(),{currentLanguage:i}=X(),[d,u]=b.useState(""),[m,p]=b.useState("updatedAt"),[x,f]=b.useState("desc"),[g,h]=b.useState("all"),[y,j]=b.useState(""),[v,N]=b.useState(null),[S,w]=b.useState(!1),{sensors:k,activeId:M,favoritesSorted:C,othersSorted:R,getPresetById:P,handleDragStart:D,handleDragEnd:T}=Fm(t,a),E=b.useMemo(()=>{const z=t.map(A=>A.category).filter(A=>!!A);return[...new Set(z)]},[t]),L=b.useMemo(()=>{let z=t;switch(g){case"favorites":z=z.filter(A=>A.isFavorite);break;case"recent":z=z.filter(A=>A.lastUsed).sort((A,F)=>new Date(F.lastUsed).getTime()-new Date(A.lastUsed).getTime()).slice(0,10);break;case"category":y&&(z=z.filter(A=>A.category===y));break}if(d.trim()){const A=d.toLowerCase();z=z.filter(F=>F.name.toLowerCase().includes(A)||F.category?.toLowerCase().includes(A)||F.tags?.some(q=>q.toLowerCase().includes(A))||F.formData.symbol?.toLowerCase().includes(A)||F.formData.strategy?.toLowerCase().includes(A))}return z.sort((A,F)=>{let q,W;switch(m){case"name":q=A.name.toLowerCase(),W=F.name.toLowerCase();break;case"createdAt":q=new Date(A.createdAt).getTime(),W=new Date(F.createdAt).getTime();break;case"updatedAt":q=new Date(A.updatedAt).getTime(),W=new Date(F.updatedAt).getTime();break;case"lastUsed":q=A.lastUsed?new Date(A.lastUsed).getTime():0,W=F.lastUsed?new Date(F.lastUsed).getTime():0;break;case"usageCount":q=A.usageCount||0,W=F.usageCount||0;break;default:q=A.name.toLowerCase(),W=F.name.toLowerCase()}return x==="asc"?q>W?1:-1:q<W?1:-1}),z},[t,d,m,x,g,y]),U=z=>{N(z)},_=z=>{m===z?f(x==="asc"?"desc":"asc"):(p(z),f("asc"))},B=b.useMemo(()=>{const z=t.length,A=t.filter(W=>W.isFavorite).length,F=t.filter(W=>W.lastUsed).length,q=[...new Set(t.map(W=>W.category).filter(Boolean))].length;return{total:z,favorites:A,recentlyUsed:F,categories:q}},[t]);return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"w-full max-w-6xl h-full max-h-[90vh] rounded-2xl shadow-2xl overflow-hidden flex flex-col",style:{backgroundColor:c.colors.card},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",style:{borderColor:c.colors.border},children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:c.colors.text},children:i==="fr"?"Gestion des Presets":"Preset Management"}),e.jsx("p",{className:"text-sm mt-1",style:{color:c.colors.textMuted},children:i==="fr"?`${B.total} presets â€¢ ${B.favorites} favoris â€¢ ${B.recentlyUsed} rÃ©cents`:`${B.total} presets â€¢ ${B.favorites} favorites â€¢ ${B.recentlyUsed} recent`})]}),e.jsx("button",{onClick:s,className:"p-2 rounded-full hover:bg-opacity-10 hover:bg-black transition-colors",style:{color:c.colors.textMuted},children:e.jsx(be,{size:24})})]}),e.jsx("div",{className:"p-6 border-b space-y-4",style:{borderColor:c.colors.border},children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>w(z=>!z),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${S?"text-white":""}`,style:{backgroundColor:S?c.colors.accent:c.colors.surface,color:S?"white":c.colors.text,border:`1px solid ${c.colors.border}`},children:S?i==="fr"?"Terminer la rÃ©organisation":"Finish reordering":i==="fr"?"RÃ©organiser":"Reorder"}),e.jsx("div",{className:"flex-1",children:e.jsx(Dm,{currentTheme:c,currentLanguage:i,searchQuery:d,setSearchQuery:u,filterType:g,setFilterType:h,selectedCategory:y,setSelectedCategory:j,categories:E,showCategoryFilter:!S})})]})}),e.jsx("div",{className:"px-6 py-3 border-b bg-opacity-50",style:{borderColor:c.colors.border,backgroundColor:c.colors.surface},children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 text-sm font-semibold",children:[e.jsx("div",{className:"col-span-1"}),e.jsxs("button",{onClick:()=>_("name"),className:"col-span-3 flex items-center gap-2 text-left",style:{color:c.colors.textSecondary},children:[i==="fr"?"Nom":"Name",m==="name"&&(x==="asc"?e.jsx(fo,{size:14}):e.jsx(xo,{size:14}))]}),e.jsx("div",{className:"col-span-2 flex items-center gap-2 text-left",style:{color:c.colors.textSecondary},children:i==="fr"?"CatÃ©gorie":"Category"}),e.jsxs("button",{onClick:()=>_("updatedAt"),className:"col-span-2 flex items-center gap-2 text-left",style:{color:c.colors.textSecondary},children:[i==="fr"?"ModifiÃ©":"Modified",m==="updatedAt"&&(x==="asc"?e.jsx(fo,{size:14}):e.jsx(xo,{size:14}))]}),e.jsxs("button",{onClick:()=>_("usageCount"),className:"col-span-2 flex items-center gap-2 text-left",style:{color:c.colors.textSecondary},children:[i==="fr"?"Utilisations":"Usage",m==="usageCount"&&(x==="asc"?e.jsx(fo,{size:14}):e.jsx(xo,{size:14}))]}),e.jsx("div",{className:"col-span-2 text-center",style:{color:c.colors.textSecondary},children:"Actions"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:S?e.jsxs(Or,{sensors:k,collisionDetection:Ir,modifiers:[zo],onDragStart:D,onDragEnd:T,children:[e.jsx(Am,{favorites:C,others:R,theme:c,language:i}),St.createPortal(e.jsx(Em,{activeId:M,getItemById:P,theme:c}),document.body)]}):L.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-8",children:[e.jsx(jt,{size:48,className:"mb-4 opacity-50",style:{color:c.colors.textMuted}}),e.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:c.colors.text},children:i==="fr"?"Aucun preset trouvÃ©":"No presets found"}),e.jsx("p",{style:{color:c.colors.textMuted},children:i==="fr"?"Essayez de modifier vos critÃ¨res de recherche":"Try adjusting your search criteria"})]}):e.jsx("div",{className:"p-6 space-y-2",children:L.map(z=>e.jsxs("div",{className:"grid grid-cols-12 gap-4 p-4 rounded-lg border hover:shadow-md transition-all cursor-pointer",style:{backgroundColor:c.colors.surface+"30",borderColor:c.colors.border},onDoubleClick:()=>{o(z.id),s()},title:i==="fr"?"Double-clic pour sÃ©lectionner":"Double-click to select",children:[e.jsx("div",{className:"col-span-1 flex items-center justify-center",children:e.jsx("span",{className:"text-xl",children:z.emoji||"âš™ï¸"})}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",style:{color:c.colors.text},children:z.name}),e.jsx("div",{className:"text-xs mt-1",style:{color:c.colors.textMuted},children:z.formData.symbol||z.formData.market||"â€”"})]})}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsx("span",{className:"px-2 py-1 rounded-full text-xs",style:{backgroundColor:c.colors.accent+"20",color:c.colors.accent},children:z.category||"â€”"})}),e.jsxs("div",{className:"col-span-2 flex items-center text-sm",style:{color:c.colors.textMuted},children:[e.jsx(bt,{size:14,className:"mr-1"}),new Date(z.updatedAt).toLocaleDateString()]}),e.jsxs("div",{className:"col-span-2 flex items-center text-sm",style:{color:c.colors.textMuted},children:[e.jsx($e,{size:14,className:"mr-1"}),z.usageCount||0]}),e.jsxs("div",{className:"col-span-2 flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>{o(z.id),s()},className:"p-1 rounded hover:bg-opacity-10 transition-colors",style:{color:c.colors.accent},title:i==="fr"?"SÃ©lectionner ce preset":"Select this preset",children:"âœ“"}),e.jsx("button",{onClick:()=>l(z.id),className:"p-1 rounded hover:bg-opacity-10 transition-colors",style:{color:z.isFavorite?"#F59E0B":c.colors.textMuted},title:z.isFavorite?i==="fr"?"Retirer des favoris":"Remove from favorites":i==="fr"?"Ajouter aux favoris":"Add to favorites",children:z.isFavorite?e.jsx(it,{size:16}):e.jsx(vi,{size:16})}),e.jsx("button",{onClick:()=>U(z),className:"p-1 rounded hover:bg-opacity-10 transition-colors",style:{color:c.colors.textMuted},title:i==="fr"?"Modifier":"Edit",children:e.jsx(Go,{size:16})}),e.jsx("button",{onClick:()=>{confirm(i==="fr"?`Supprimer le preset "${z.name}" ?`:`Delete preset "${z.name}"?`)&&r(z.id)},className:"p-1 rounded hover:bg-opacity-10 transition-colors",style:{color:"#EF4444"},title:i==="fr"?"Supprimer":"Delete",children:e.jsx(es,{size:16})})]})]},z.id))})}),e.jsx(Lm,{currentTheme:c,currentLanguage:i,displayedCount:L.length,disabledSelectMostRecent:L.length===0,onSelectMostRecent:()=>{const z=L.sort((A,F)=>new Date(F.updatedAt).getTime()-new Date(A.updatedAt).getTime())[0];z&&(o(z.id),s())},onClose:s})]}),e.jsx(Tm,{isOpen:!!v,preset:v,onSave:(z,A)=>{n(z,A),N(null)},onClose:()=>N(null)})]})},$m=()=>{const[t,s]=xs("trading-journal-wizard-presets",[]),[r,l]=b.useState(!1),n=t.map(g=>({...g,isFavorite:g.isFavorite??!1})),o=b.useCallback(async(g,h,y=!1)=>{l(!0);try{const j=Im(h),v={id:`wizard-preset-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,name:g.trim(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),formData:j,isFavorite:y,category:zm(j),tags:Om(j),sortIndex:t.length};return s(N=>[...N,v]),v}finally{l(!1)}},[s]),a=b.useCallback(g=>{const h=t.find(y=>y.id===g);return h?(u(g),h.formData):null},[t]),c=b.useCallback(g=>{s(h=>h.filter(y=>y.id!==g))},[s]),i=b.useCallback(g=>{s(h=>h.map(y=>y.id===g?{...y,isFavorite:!y.isFavorite,updatedAt:new Date().toISOString()}:y))},[s]),d=b.useCallback((g,h)=>{s(y=>y.map(j=>j.id===g?{...j,...h,updatedAt:new Date().toISOString()}:j))},[s]),u=b.useCallback(g=>{s(h=>h.map(y=>y.id===g?{...y,lastUsed:new Date().toISOString(),usageCount:(y.usageCount||0)+1}:y))},[s]),m=b.useCallback(()=>t.filter(g=>g.isFavorite).sort((g,h)=>new Date(h.updatedAt).getTime()-new Date(g.updatedAt).getTime()),[t]),p=b.useCallback((g=5)=>t.sort((h,y)=>{const j=new Date(h.lastUsed||h.updatedAt).getTime();return new Date(y.lastUsed||y.updatedAt).getTime()-j}).slice(0,g),[t]),x=b.useCallback(g=>{if(!g.trim())return t;const h=g.toLowerCase();return t.filter(y=>y.name.toLowerCase().includes(h)||y.category?.toLowerCase().includes(h)||y.tags?.some(j=>j.toLowerCase().includes(h))||y.formData.symbol?.toLowerCase().includes(h)||y.formData.strategy?.toLowerCase().includes(h))},[t]),f=b.useCallback(()=>({total:t.length,favorites:t.filter(g=>g.isFavorite).length,categories:[...new Set(t.map(g=>g.category).filter(Boolean))].length,mostUsed:t.sort((g,h)=>(h.usageCount||0)-(g.usageCount||0)).slice(0,3)}),[t]);return{presets:n,isLoading:r,savePreset:o,loadPreset:a,deletePreset:c,toggleFavorite:i,updatePreset:d,reorderPresets:g=>{s(h=>{const y=new Map(h.map(v=>[v.id,v])),j=[];return g.forEach((v,N)=>{const S=y.get(v);S&&(j.push({...S,sortIndex:N,updatedAt:new Date().toISOString()}),y.delete(v))}),h.forEach(v=>{y.has(v.id)&&j.push({...v,sortIndex:j.length})}),j})},getFavoritePresets:m,getRecentPresets:p,searchPresets:x,getPresetStats:f}};function Im(t){const{id:s,createdAt:r,updatedAt:l,date:n,time:o,entryDate:a,entryTime:c,exitDate:i,exitTime:d,pnl:u,pnlPercentage:m,duration:p,screenshots:x,...f}=t,g={};return Object.entries(f).forEach(([h,y])=>{y!=null&&y!==""&&(g[h]=y)}),g}function zm(t){if(t.market)switch(t.market){case"futures":return"Futures";case"forex":return"Forex";case"crypto":return"Crypto";case"stocks":return"Actions";case"indices":return"Indices";case"commodities":return"MatiÃ¨res PremiÃ¨res";default:return"GÃ©nÃ©ral"}return"GÃ©nÃ©ral"}function Om(t){const s=[];return t.market&&s.push(t.market),t.side&&s.push(t.side),t.strategy&&s.push(t.strategy),t.timeframe&&(["1m","5m","15m"].includes(t.timeframe)?s.push("scalping"):["1h","4h"].includes(t.timeframe)?s.push("intraday"):["1d","1w"].includes(t.timeframe)&&s.push("swing")),[...new Set(s)]}const qm=({theme:t,language:s,progress:r,currentStep:l,isQuickMode:n,onPrev:o,onNext:a,onClose:c,onSubmit:i})=>e.jsxs("div",{className:`flex justify-between items-center ${r.padding||""} py-3 border-t`,style:{borderColor:t.colors.border,background:`linear-gradient(0deg, ${t.colors.card} 0%, ${t.colors.surface} 100%)`,borderTop:`1px solid ${t.colors.border}`},children:[e.jsxs("button",{onClick:o,disabled:l==="instrument-context",className:`flex items-center px-4 py-2 rounded-lg transition-all duration-200 ${l==="instrument-context"?"opacity-50 cursor-not-allowed":"hover:shadow-md"}`,style:{backgroundColor:t.colors.surface,color:t.colors.text,border:`1px solid ${t.colors.border}`},children:[e.jsx(pl,{size:16,className:"mr-2"}),s==="fr"?"PrÃ©cÃ©dent":"Previous"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-1 rounded-full text-sm",style:{backgroundColor:r.percent===100?t.colors.success+"20":t.colors.surface,color:r.percent===100?t.colors.success:t.colors.text,border:`1px solid ${r.percent===100?t.colors.success:t.colors.border}`},children:[e.jsxs("span",{children:[r.done,"/",r.total]}),r.percent===100&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â†’"}),e.jsx("span",{className:"font-medium",children:s==="fr"?"âœ“ PrÃªt Ã  100%":"âœ“ Ready 100%"})]})]}),e.jsx("button",{onClick:c,className:"px-4 py-2 rounded-lg transition-all duration-200 hover:shadow-md",style:{backgroundColor:t.colors.surface,color:t.colors.text,border:`1px solid ${t.colors.border}`},children:s==="fr"?"Annuler":"Cancel"}),n||l==="notes-screenshots"?e.jsxs("button",{onClick:i,className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-all duration-200 hover:shadow-md",style:{backgroundColor:t.colors.accent,color:"#ffffff",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)"},children:[e.jsx(Dt,{size:16}),e.jsxs("span",{className:"font-medium",children:[s==="fr"?"Sauvegarder":"Save",n&&` (${s==="fr"?"Mode Rapide":"Quick Mode"})`]})]}):e.jsxs("button",{onClick:a,className:"flex items-center px-4 py-2 rounded-lg transition-all duration-200 hover:shadow-md",style:{backgroundColor:t.colors.accent,color:"#ffffff",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)"},children:[e.jsx("span",{className:"font-medium",children:s==="fr"?"Suivant":"Next"}),e.jsx(hl,{size:16,className:"ml-2"})]})]})]}),Um=(t,s)=>{const[r,l]=b.useState([]);b.useEffect(()=>{const o=["instrument-context","position-entry","position-exit","risk-reward","notes-screenshots"],a=o.indexOf(t);l(o.slice(0,a))},[t]);const n=b.useMemo(()=>s.status==="open"?["position-exit"]:[],[s.status]);return{completedSteps:r,disabledSteps:n}},_m=()=>{const[t,s]=b.useState({width:typeof window<"u"?window.innerWidth:1920,height:typeof window<"u"?window.innerHeight:1080});return b.useEffect(()=>{const r=()=>{s({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),t},Wm=t=>(()=>{const{width:r,height:l}=t;return r<1024?{width:Math.min(r*.95,1100),maxHeight:l*.92,padding:"p-4",summaryWidth:220}:r<1440?{width:Math.min(r*.88,1400),maxHeight:l*.88,padding:"p-6",summaryWidth:240}:{width:Math.min(r*.8,1600),maxHeight:l*.85,padding:"p-8",summaryWidth:260}})(),tr={nextStep:"Alt+ArrowRight",prevStep:"Alt+ArrowLeft",submit:"Ctrl+Enter",openSettings:"Alt+S",closeModal:"Escape",focusNextMissing:"Alt+M",focusPrevMissing:"Alt+Shift+M",focusNextField:"Ctrl+ArrowDown",focusPrevField:"Ctrl+ArrowUp"};function Vm(){try{const t=localStorage.getItem("wizard-keybindings");if(!t)return tr;const s=JSON.parse(t);return{...tr,...s}}catch{return tr}}function Wn(t){localStorage.setItem("wizard-keybindings",JSON.stringify(t))}const Bm=[{id:"nextStep",labelFr:"Aller Ã  l'Ã©tape suivante",labelEn:"Go to next step"},{id:"prevStep",labelFr:"Aller Ã  l'Ã©tape prÃ©cÃ©dente",labelEn:"Go to previous step"},{id:"submit",labelFr:"Soumettre / enregistrer",labelEn:"Submit / Save"},{id:"openSettings",labelFr:"Ouvrir paramÃ¨tres",labelEn:"Open settings"},{id:"closeModal",labelFr:"Fermer le modal courant",labelEn:"Close current modal"},{id:"focusNextMissing",labelFr:"Champ manquant suivant",labelEn:"Next missing field"},{id:"focusPrevMissing",labelFr:"Champ manquant prÃ©cÃ©dent",labelEn:"Previous missing field"},{id:"focusNextField",labelFr:"Champ suivant",labelEn:"Next field"},{id:"focusPrevField",labelFr:"Champ prÃ©cÃ©dent",labelEn:"Previous field"}];function Hm(t){const s=[];t.ctrlKey&&s.push("Ctrl"),t.altKey&&s.push("Alt"),t.metaKey&&s.push("Meta"),t.shiftKey&&s.push("Shift");const r=t.key;if(!r)return null;const l=r.length===1?r.toUpperCase():r;return["Shift","Control","Alt","Meta"].includes(l)?null:s.length?`${s.join("+")}+${l}`:l}const Gm=({isOpen:t,onClose:s})=>{const{currentTheme:r}=ee(),{currentLanguage:l}=X(),[n,o]=b.useState(Vm()),[a,c]=b.useState(null),i=b.useRef(null);b.useEffect(()=>{if(!t)return;const u=m=>{if(!a)return;m.preventDefault(),m.stopPropagation();const p=Hm(m);p&&(o(x=>({...x,[a]:p})),c(null))};return document.addEventListener("keydown",u,{capture:!0}),()=>document.removeEventListener("keydown",u,{capture:!0})},[a,t]);const d=(u,m)=>l==="fr"?u:m;return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-[60]",children:e.jsxs("div",{className:"w-full max-w-3xl max-h-[85vh] rounded-lg shadow-2xl overflow-hidden flex flex-col",style:{backgroundColor:r.colors.card,color:r.colors.text,border:`1px solid ${r.colors.border}`},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",style:{borderColor:r.colors.border,backgroundColor:r.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(jl,{size:18,style:{color:r.colors.accent}}),e.jsx("h3",{className:"text-lg font-semibold",children:d("Raccourcis clavier","Keyboard shortcuts")})]}),e.jsx("button",{onClick:s,className:"p-2 rounded-full hover:bg-opacity-10 hover:bg-black transition-colors",style:{color:r.colors.textMuted},children:e.jsx(be,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsx("div",{ref:i,className:"text-xs px-3 py-2 rounded",style:{backgroundColor:r.colors.surface,color:r.colors.textMuted,border:`1px dashed ${r.colors.border}`},children:a?d("Appuyez sur une combinaison de touchesâ€¦","Press a key combinationâ€¦"):d("Cliquez sur 'Modifier' puis pressez la combinaison souhaitÃ©e.","Click 'Change' then press the desired combo.")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Bm.map(u=>e.jsxs("div",{className:"flex items-center justify-between gap-3 p-3 rounded border",style:{borderColor:r.colors.border,backgroundColor:r.colors.surface},children:[e.jsx("div",{className:"text-sm",style:{color:r.colors.text},children:d(u.labelFr,u.labelEn)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 rounded text-xs font-mono",style:{backgroundColor:r.colors.card,border:`1px solid ${r.colors.border}`,color:r.colors.text},children:n[u.id]}),e.jsx("button",{onClick:()=>c(u.id),className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:r.colors.card,color:r.colors.accent,borderColor:r.colors.accent},children:d("Modifier","Change")})]})]},u.id))})]}),e.jsxs("div",{className:"px-4 py-3 border-t flex items-center justify-between",style:{borderColor:r.colors.border,backgroundColor:r.colors.surface},children:[e.jsx("button",{onClick:()=>{o(tr),Wn(tr)},className:"px-3 py-1.5 text-sm rounded border",style:{color:r.colors.text,borderColor:r.colors.border},children:d("RÃ©initialiser","Reset")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>s(),className:"px-3 py-1.5 text-sm rounded border",style:{color:r.colors.text,borderColor:r.colors.border},children:d("Annuler","Cancel")}),e.jsx("button",{onClick:()=>{Wn(n),s()},className:"px-3 py-1.5 text-sm rounded border",style:{backgroundColor:r.colors.accent,color:"#fff",borderColor:r.colors.accent},children:d("Enregistrer","Save")})]})]})]})}):null},ba=({isOpen:t,onClose:s,activeProfileId:r,onOpenEditMode:l})=>{const{currentTheme:n}=ee(),{currentLanguage:o}=X(),[a,c]=b.useState("detailed"),[i,d]=b.useState(!0),[u,m]=b.useState(""),[p,x]=b.useState(!1),[f,g]=b.useState([]),[h,y]=b.useState(!1),[j,v]=b.useState(!0);b.useEffect(()=>{const M=yt.getString("pnlEntryMode"),C=yt.getBoolean("autoSave"),R=yt.getString("defaultPreset");M&&c(M),C!==null&&d(!!C),R&&m(R),N()},[]);const N=()=>{try{const M=yt.getJSON("presets");M&&g(M.map(C=>({id:C.id,name:C.name})))}catch(M){console.error("Erreur lors du chargement des presets:",M)}},S=M=>{c(M),yt.setString("pnlEntryMode",M)},w=M=>{d(M),yt.setBoolean("autoSave",M)},k=M=>{m(M),yt.setString("defaultPreset",M)};return t?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50",children:[e.jsxs("div",{className:"rounded-lg shadow-xl w-full max-w-7xl h-[95vh] flex flex-col",style:{backgroundColor:n.colors.card,color:n.colors.text,border:`1px solid ${n.colors.border}`},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",style:{borderColor:n.colors.border,backgroundColor:n.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Jo,{size:18,style:{color:n.colors.accent}}),e.jsx("h3",{className:"text-lg font-semibold",children:o==="fr"?"ParamÃ¨tres du formulaire":"Form settings"})]}),e.jsx("button",{onClick:s,className:"p-2 rounded-full hover:bg-opacity-10 hover:bg-black transition-colors",style:{color:n.colors.textMuted},title:o==="fr"?"Fermer":"Close",children:e.jsx(be,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b",style:{borderColor:n.colors.border},children:[e.jsx(ss,{size:20,style:{color:n.colors.accent}}),e.jsx("h3",{className:"font-semibold text-lg",style:{color:n.colors.text},children:o==="fr"?"Comportement par dÃ©faut":"Default Behavior"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium",style:{color:n.colors.textSecondary},children:o==="fr"?"Raccourcis clavier":"Keyboard shortcuts"}),e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center space-x-2 px-4 py-2 text-sm rounded-lg border-2 transition-all duration-200 hover:shadow-sm",style:{backgroundColor:n.colors.surface,color:n.colors.text,borderColor:n.colors.border},children:[e.jsx(jl,{size:16}),e.jsx("span",{children:o==="fr"?"Configurer les raccourcis":"Configure shortcuts"})]}),e.jsx("p",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"Assignez vos propres touches pour naviguer plus vite.":"Assign your own keys to navigate faster."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium",style:{color:n.colors.textSecondary},children:o==="fr"?"Mode de saisie P&L":"P&L Input Mode"}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsxs("button",{onClick:()=>S("detailed"),className:`flex items-center space-x-2 px-4 py-2 text-sm rounded-lg border-2 transition-all duration-200 ${a==="detailed"?"border-0 shadow-md":"hover:shadow-sm"}`,style:{backgroundColor:a==="detailed"?n.colors.accent:n.colors.surface,color:a==="detailed"?"#ffffff":n.colors.text,borderColor:a==="detailed"?"transparent":n.colors.border},children:[e.jsx(Wo,{size:16}),e.jsx("span",{children:o==="fr"?"Prix dÃ©taillÃ©s":"Detailed Prices"})]}),e.jsxs("button",{onClick:()=>S("direct"),className:`flex items-center space-x-2 px-4 py-2 text-sm rounded-lg border-2 transition-all duration-200 ${a==="direct"?"border-0 shadow-md":"hover:shadow-sm"}`,style:{backgroundColor:a==="direct"?n.colors.accent:n.colors.surface,color:a==="direct"?"#ffffff":n.colors.text,borderColor:a==="direct"?"transparent":n.colors.border},children:[e.jsx(dr,{size:16}),e.jsx("span",{children:o==="fr"?"P&L direct":"Direct P&L"})]})]}),e.jsx("p",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?a==="detailed"?"Saisie des prix d'entrÃ©e et sortie, calcul automatique du P&L":"Saisie directe du P&L, prix optionnels":a==="detailed"?"Enter entry and exit prices, automatic P&L calculation":"Direct P&L input, prices optional"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium",style:{color:n.colors.text},children:o==="fr"?"Preset par dÃ©faut":"Default preset"}),e.jsxs("select",{value:u,onChange:M=>k(M.target.value),className:"w-full px-3 py-2 text-sm rounded-lg border-2 transition-colors",style:{backgroundColor:n.colors.surface,color:n.colors.text,borderColor:n.colors.border},children:[e.jsx("option",{value:"",children:o==="fr"?"Aucun preset":"No preset"}),f.map(M=>e.jsx("option",{value:M.id,children:M.name},M.id))]}),e.jsx("p",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"Preset Ã  charger automatiquement Ã  l'ouverture du modal":"Preset to load automatically when opening the modal"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:M=>w(M.target.checked),className:"w-4 h-4 rounded border-2",style:{backgroundColor:i?n.colors.accent:"transparent",borderColor:n.colors.border}}),e.jsx("span",{className:"text-sm font-medium",style:{color:n.colors.text},children:o==="fr"?"Auto-sauvegarde":"Auto-save"})]}),e.jsx("p",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"Sauvegarder automatiquement pendant la saisie":"Automatically save during input"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b",style:{borderColor:n.colors.border},children:[e.jsx(Ho,{size:20,style:{color:n.colors.accent}}),e.jsx("h3",{className:"font-semibold text-lg",style:{color:n.colors.text},children:"Interface"})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium",style:{color:n.colors.textSecondary},children:o==="fr"?"Personnalisation des champs":"Field customization"}),e.jsxs("button",{onClick:()=>{s(),l?.()},className:"flex items-center space-x-2 px-4 py-2 text-sm rounded-lg border-2 transition-all duration-200 hover:shadow-sm",style:{backgroundColor:n.colors.surface,color:n.colors.text,borderColor:n.colors.border},children:[e.jsx(Go,{size:16}),e.jsx("span",{children:o==="fr"?"Configurer les champs":"Configure fields"})]}),e.jsx("p",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"Masquer/afficher les champs selon vos prÃ©fÃ©rences":"Hide/show fields according to your preferences"})]})})]})]})})]}),p&&e.jsx(Gm,{isOpen:p,onClose:()=>x(!1)})]}):null},va=({isOpen:t,onClose:s,currentHiddenFields:r,isRequired:l,order:n,onApply:o,onReset:a})=>{const{currentTheme:c}=ee(),{currentLanguage:i}=X();if(!t)return null;const d=(k,M)=>i==="fr"?k:M,[u,m]=O.useState(""),[p,x]=O.useState(r);O.useEffect(()=>{x(r)},[r]);const f=k=>!p.includes(k),g=k=>{l(k)||x(M=>M.includes(k)?M.filter(C=>C!==k):[...M,k])},h=k=>({date:d("Date","Date"),time:d("Heure","Time"),market:d("MarchÃ©","Market"),symbol:d("Symbole","Symbol"),side:d("Direction","Side"),quantity:d("Taille","Quantity"),pnl:"P&L",timeframe:"Timeframe",strategy:d("StratÃ©gie","Strategy"),setup:"Setup",trend:d("Tendance","Trend"),notes:d("Notes","Notes"),tags:"Tags",screenshots:"Screenshots",entryDate:d("Date d'entrÃ©e","Entry Date"),entryTime:d("Heure d'entrÃ©e","Entry Time"),entryPrice:d("Prix d'entrÃ©e","Entry Price"),exitDate:d("Date de sortie","Exit Date"),exitTime:d("Heure de sortie","Exit Time"),exitPrice:d("Prix de sortie","Exit Price"),stopPrice:d("Stop prÃ©vu","Planned Stop"),takeProfitPrice:d("TP prÃ©vu","Planned Take Profit"),riskReward:"R:R",tradeResult:d("RÃ©sultat","Result"),fees_commission:d("Commission","Commission"),fees_spread:"Spread/Slippage",fees_swap:"Swap/Overnight",fees_exchange:d("Frais d'Ã©change","Exchange fees"),fees_regulatory:d("Frais rÃ©glementaires","Regulatory fees"),fees_other:d("Autres frais","Other fees"),tickSize:"Tick Size",tickValue:"Tick Value",marginPerContract:d("Marge par contrat","Margin per Contract"),leverage:"Leverage",marginRate:d("Taux de marge","Margin rate"),marginUsedOverride:d("Marge utilisÃ©e (override)","Margin used override"),emotion:d("Ã‰motion","Emotion"),emotionIntensity:d("IntensitÃ© Ã©motionnelle","Emotion intensity"),planRespected:d("Plan respectÃ©","Plan respected")})[k]||k,y=[{id:"core",title:d("Essentiels","Essentials"),fields:["date","market","symbol","side","quantity","pnl","time","timeframe"]},{id:"context",title:d("Contexte & StratÃ©gie","Context & Strategy"),fields:["strategy","setup","trend"]},{id:"entry",title:d("EntrÃ©e","Entry"),fields:["entryDate","entryTime","entryPrice"]},{id:"exit",title:d("Sortie","Exit"),fields:["exitDate","exitTime","exitPrice","tradeResult"]},{id:"risk",title:d("Gestion du risque","Risk management"),fields:["stopPrice","takeProfitPrice","riskReward"]},{id:"fees",title:d("Frais","Fees"),fields:["fees_commission","fees_spread","fees_swap","fees_exchange","fees_regulatory","fees_other"]},{id:"futures",title:d("Futures & Ticks","Futures & Ticks"),fields:["tickSize","tickValue"]},{id:"margin",title:d("Marge / Levier","Margin / Leverage"),fields:["marginPerContract","leverage","marginRate","marginUsedOverride"]},{id:"psychology",title:d("Psychologie","Psychology"),fields:["emotion","emotionIntensity","planRespected"]},{id:"notes",title:d("Notes & PiÃ¨ces jointes","Notes & Attachments"),fields:["notes","tags","screenshots"]}],[j,v]=O.useState(()=>{const k={};return y.forEach(M=>{k[M.id]=!0}),k}),N=k=>v(M=>({...M,[k]:!M[k]})),S=k=>{const M=[...p];k.forEach(C=>{if(l(C))return;const R=M.indexOf(C);R!==-1&&M.splice(R,1)}),x(M)},w=k=>{const M=[...p];k.forEach(C=>{l(C)||M.includes(C)||M.push(C)}),x(M)};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4",children:e.jsxs("div",{className:"w-full max-w-3xl rounded-lg shadow-xl",style:{backgroundColor:c.colors.card,color:c.colors.text,border:`1px solid ${c.colors.border}`,maxHeight:"85vh",display:"grid",gridTemplateRows:"auto auto 1fr auto"},children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",style:{borderColor:c.colors.border},children:[e.jsx("h3",{className:"text-lg font-semibold",children:i==="fr"?"Configurer les champs":"Configure fields"}),e.jsx("button",{onClick:s,className:"px-3 py-1 rounded-md",style:{backgroundColor:c.colors.surface,color:c.colors.text,border:`1px solid ${c.colors.border}`},children:i==="fr"?"Fermer":"Close"})]}),e.jsx("div",{className:"px-6 py-3 border-b",style:{borderColor:c.colors.border},children:e.jsx("input",{value:u,onChange:k=>m(k.target.value),placeholder:d("Rechercher un champâ€¦","Search fieldâ€¦"),className:"w-full px-3 py-2 rounded-md border",style:{backgroundColor:c.colors.surface,color:c.colors.text,borderColor:c.colors.border}})}),e.jsx("div",{className:"p-6 space-y-4 overflow-y-auto",children:y.map(k=>{const M=n.filter(D=>k.fields.includes(D));if(M.length===0)return null;const C=M.filter(D=>h(D).toLowerCase().includes(u.toLowerCase()));if(C.length===0)return null;const R=C.filter(D=>f(D)).length,P=M.length;return e.jsxs("div",{className:"rounded-lg border",style:{borderColor:c.colors.border},children:[e.jsxs("button",{type:"button",onClick:()=>N(k.id),className:"w-full flex items-center justify-between px-4 py-3",style:{backgroundColor:c.colors.surface,color:c.colors.text},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-semibold",children:k.title}),e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full",style:{backgroundColor:c.colors.accent+"20",color:c.colors.accent,border:`1px solid ${c.colors.accent}40`},children:[R,"/",P]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:D=>{D.stopPropagation(),S(C)},className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:c.colors.card,color:c.colors.text,borderColor:c.colors.border},title:i==="fr"?"Tout sÃ©lectionner":"Select all",children:i==="fr"?"Tout":"All"}),e.jsx("button",{type:"button",onClick:D=>{D.stopPropagation(),w(C)},className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:c.colors.card,color:c.colors.text,borderColor:c.colors.border},title:i==="fr"?"Tout dÃ©sÃ©lectionner":"Deselect all",children:i==="fr"?"Aucun":"None"}),e.jsx(Le,{size:16,className:`transition-transform ${j[k.id]?"rotate-180":""}`})]})]}),j[k.id]&&e.jsx("div",{className:"p-3 grid grid-cols-1 md:grid-cols-2 gap-2",children:C.map(D=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-md border",style:{backgroundColor:c.colors.surface,borderColor:c.colors.border},children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:f(D),onChange:()=>g(D),disabled:l(D)}),e.jsxs("span",{className:"text-sm",children:[h(D),l(D)?" *":""]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>{},className:"px-2 py-1 text-xs rounded-md border",style:{backgroundColor:c.colors.card,borderColor:c.colors.border,color:c.colors.text},children:"â†‘"}),e.jsx("button",{onClick:()=>{},className:"px-2 py-1 text-xs rounded-md border",style:{backgroundColor:c.colors.card,borderColor:c.colors.border,color:c.colors.text},children:"â†“"})]})]},D))})]},k.id)})}),e.jsxs("div",{className:"px-6 py-3 border-t flex items-center justify-end gap-2",style:{borderColor:c.colors.border},children:[e.jsx("button",{onClick:a,className:"px-3 py-2 text-sm rounded-md border",style:{backgroundColor:c.colors.surface,color:c.colors.text,borderColor:c.colors.border},children:d("Restaurer par dÃ©faut","Restore defaults")}),e.jsx("button",{onClick:()=>s(),className:"px-3 py-2 text-sm rounded-md border",style:{backgroundColor:c.colors.surface,color:c.colors.text,border:`1px solid ${c.colors.border}`},children:d("Annuler","Cancel")}),e.jsx("button",{onClick:()=>o(p),className:"px-3 py-2 text-sm rounded-md",style:{backgroundColor:c.colors.accent,color:"#ffffff"},children:d("Appliquer","Apply")})]})]})})},Jm=({isOpen:t,onClose:s,formData:r,settings:l,missingFields:n,currentStep:o})=>{const{currentTheme:a}=ee(),{currentLanguage:c}=X();return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"w-full max-w-3xl max-h-[85vh] rounded-lg shadow-2xl overflow-hidden flex flex-col",style:{backgroundColor:a.colors.card,color:a.colors.text,border:`1px solid ${a.colors.border}`},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",style:{borderColor:a.colors.border,backgroundColor:a.colors.surface},children:[e.jsx("h3",{className:"text-lg font-semibold",children:c==="fr"?"RÃ©sumÃ© du Trade":"Trade Summary"}),e.jsx("button",{onClick:s,className:"p-2 rounded-full hover:bg-opacity-10 hover:bg-black transition-colors",style:{color:a.colors.textMuted},title:c==="fr"?"Fermer":"Close",children:e.jsx(be,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3",children:e.jsx(Xo,{formData:r,settings:l,missingFields:n,currentStep:o,headerClickable:!1,disableRingClick:!0})})]})}):null};function Km(t){const{enabled:s=!0,currentStep:r,stepsOrder:l,onNextStep:n,onPrevStep:o,onGoToStep:a,onSubmit:c,onOpenSettings:i,onCloseTopModal:d,onFocusNextMissing:u,onFocusPrevMissing:m,onFocusNextField:p,onFocusPrevField:x}=t;b.useEffect(()=>{if(!s)return;const f=N=>{const S=N;if(!S)return!1;const w=S.tagName?.toLowerCase(),k=S.getAttribute?.("contenteditable");return w==="input"||w==="textarea"||w==="select"||k==="true"},g=()=>{try{const N=localStorage.getItem("wizard-keybindings");return N?JSON.parse(N):null}catch{return null}},h=N=>N.length===1?N.toUpperCase():N==="Esc"?"Escape":N,y=N=>{const S=N.split("+").map(k=>k.trim()),w={ctrl:!1,alt:!1,shift:!1,meta:!1,key:""};for(const k of S){const M=k.toLowerCase();M==="ctrl"||M==="control"?w.ctrl=!0:M==="alt"?w.alt=!0:M==="shift"?w.shift=!0:M==="meta"||M==="cmd"||M==="command"?w.meta=!0:w.key=h(k)}return w},j=(N,S)=>{const w=y(S),k=h(N.key);return!(w.key&&k!==w.key||w.ctrl!==!!N.ctrlKey||w.alt!==!!N.altKey||w.shift!==!!N.shiftKey||w.meta!==!!N.metaKey)},v=N=>{const S=f(N.target),w=N.altKey||N.ctrlKey||N.metaKey||N.shiftKey;if(N.key==="Escape"){N.preventDefault(),d();return}const k=g(),C={...{nextStep:"Alt+ArrowRight",prevStep:"Alt+ArrowLeft",submit:"Ctrl+Enter",openSettings:"Alt+S",focusNextMissing:"Alt+M",focusPrevMissing:"Alt+Shift+M",focusNextField:"Ctrl+ArrowDown",focusPrevField:"Ctrl+ArrowUp"},...k};if(!(j(N,C.nextStep)||j(N,C.prevStep)||j(N,C.submit)||j(N,C.openSettings)||j(N,C.focusNextMissing)||j(N,C.focusPrevMissing)||j(N,C.focusNextField)||j(N,C.focusPrevField))){if(S&&!w)return}if(j(N,C.nextStep)){N.preventDefault(),n();return}if(j(N,C.prevStep)){N.preventDefault(),o();return}if(j(N,C.submit)){N.preventDefault(),c();return}if(j(N,C.openSettings)){N.preventDefault(),i();return}if(j(N,C.focusNextMissing)){N.preventDefault(),u&&u();return}if(j(N,C.focusPrevMissing)){N.preventDefault(),m&&m();return}if(j(N,C.focusNextField)){N.preventDefault(),p&&p();return}if(j(N,C.focusPrevField)){N.preventDefault(),x&&x();return}if(N.altKey&&/[1-9]/.test(N.key)){const P=parseInt(N.key,10)-1;P>=0&&P<l.length&&(N.preventDefault(),a(l[P]));return}};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[s,r,l,n,o,a,c,i,d,u,m,p,x])}function Gs(t){const s=t.querySelectorAll('[data-error="true"], .ring-danger, .border-danger');if(s.length>0){const n=s[0];n.focus(),n.scrollIntoView({behavior:"smooth",block:"center"});return}const r=['[name="symbol"]:invalid','[name="market"]:invalid','[name="side"]:invalid','[name="date"]:invalid','[name="entryDate"]:invalid','[name="entryTime"]:invalid','[name="entryPrice"]:invalid','[name="quantity"]:invalid','[name="exitDate"]:invalid','[name="exitTime"]:invalid','[name="exitPrice"]:invalid'];for(const n of r){const o=t.querySelector(n);if(o){o.focus(),o.scrollIntoView({behavior:"smooth",block:"center"});return}}const l=t.querySelector('input, select, textarea, button, [tabindex]:not([tabindex="-1"])');l&&(l.focus(),l.scrollIntoView({behavior:"smooth",block:"center"}))}const Ym=({trade:t,onSubmit:s,onClose:r,settings:l,existingSymbols:n,existingTrades:o,activeProfileId:a,onOpenGlobalSettings:c})=>{const{currentTheme:i}=ee(),{currentLanguage:d}=X(),u=_m(),{currentStep:m,formData:p,errors:x,handleChange:f,goToNextStep:g,goToPreviousStep:h,goToStep:y,setErrors:j,getMissingFieldsForROI:v,validateStep:N,isQuickMode:S,pnlInputMode:w,setPnlInputMode:k,toggleQuickMode:M,calculatePnL:C,validateQuickMode:R,isEditMode:P,setIsEditMode:D,fieldConfig:T,shouldShowField:E,toggleFieldVisibility:L,resetFieldConfig:U,isObligatoryField:_,applyFieldConfig:B}=Qi(t,l),[z,A]=b.useState(!1),[F,q]=b.useState(!1),[W,I]=b.useState(!1),[$,V]=b.useState(!1),K=()=>{D(!0)},{completedSteps:ne,disabledSteps:ue}=Um(m,p),le={},je=!1,[ye,ve]=b.useState(!1);b.useEffect(()=>{ye||ve(!0)},[ye]);const{presets:se,savePreset:Y,loadPreset:te,deletePreset:G,toggleFavorite:he,updatePreset:we,reorderPresets:Ie}=$m(),Te=Wm(u),ze=["date","time","market","symbol","side","timeframe","entryDate","entryTime","entryPrice","quantity","exitDate","exitTime","exitPrice","pnl","pnlPercentage","tradeResult","strategy","setup","trend","riskReward","tickSize","tickValue","marginPerContract","leverage","marginRate","marginUsedOverride","notes","tags","screenshots","stopPrice","takeProfitPrice"],re=de=>{switch(de){case"instrument-context":return["status","side","market","symbol","timeframe","date","time"];case"position-entry":return["entryDate","entryTime","entryPrice","quantity","tickValue","tickSize","stopPrice","takeProfitPrice","marginPerContract","leverage","marginRate","marginUsedOverride"];case"position-exit":return["exitDate","exitTime","exitPrice","pnl","pnlPercentage","tradeResult"];case"risk-reward":return["strategy","setup","trend","riskReward"];case"notes-screenshots":return["notes","tags","screenshots"];default:return[]}},H=(()=>{const de=new Set(re(m));return(T?.hiddenFields||[]).filter(pe=>de.has(pe)).length})(),fe=(()=>{let de=[];switch(m){case"instrument-context":de=["status","side","market","symbol","timeframe","date"];break;case"position-entry":de=["entryDate","entryTime","entryPrice","quantity"];break;case"position-exit":de=["exitDate","exitTime","exitPrice","pnl"];break;case"risk-reward":de=["strategy","setup","trend","tradeResult"];break;case"notes-screenshots":de=["notes"];break;default:de=["status","side","market","symbol","timeframe","date"]}const ce=de.filter(_e=>{const Be=p[_e];return Be!=null&&Be!==""}).length,pe=de.length,De=ce/pe*100;return{done:ce,total:pe,percent:De}})(),[Z,oe]=b.useState(!1),me=()=>{const de=N(m),ce=Object.keys(de)[0];if(ce){const pe=document.querySelector(`[name="${ce}"]`);pe&&(pe.scrollIntoView({behavior:"smooth",block:"center"}),pe.focus())}},ge=()=>{const de=document.querySelector('[data-wizard-content="true"]');if(!de)return;const ce=Array.from(de.querySelectorAll('input, select, textarea, button, [tabindex]:not([tabindex="-1"])')).filter(Be=>!Be.hasAttribute("disabled")&&Be.offsetParent!==null),pe=document.activeElement,De=pe?ce.indexOf(pe):-1,_e=ce[Math.min(De+1,ce.length-1)]||ce[0];_e?.focus(),_e?.scrollIntoView({behavior:"smooth",block:"center"})},Pe=()=>{const de=document.querySelector('[data-wizard-content="true"]');if(!de)return;const ce=Array.from(de.querySelectorAll('input, select, textarea, button, [tabindex]:not([tabindex="-1"])')).filter(Be=>!Be.hasAttribute("disabled")&&Be.offsetParent!==null),pe=document.activeElement,De=pe?ce.indexOf(pe):-1,_e=ce[Math.max(De-1,0)]||ce[0];_e?.focus(),_e?.scrollIntoView({behavior:"smooth",block:"center"})};let Oe=0;const ct=()=>{const de=N(m);return Object.keys(de)},tt=()=>{const de=ct();if(de.length===0)return;Oe=Math.min(Oe+1,de.length-1);const ce=de[Oe],pe=document.querySelector(`[name="${ce}"]`);pe?.focus(),pe?.scrollIntoView({behavior:"smooth",block:"center"})},Ct=()=>{const de=ct();if(de.length===0)return;Oe=Math.max(Oe-1,0);const ce=de[Oe],pe=document.querySelector(`[name="${ce}"]`);pe?.focus(),pe?.scrollIntoView({behavior:"smooth",block:"center"})};b.useEffect(()=>{},[]);const qt=()=>{let de={};return S?de=R():(p.symbol||(de.symbol=d==="fr"?"Le symbole est requis":"Symbol is required"),p.entryPrice||(de.entryPrice=d==="fr"?"Le prix d'entrÃ©e est requis":"Entry price is required"),p.quantity||(de.quantity=d==="fr"?"La quantitÃ© est requise":"Quantity is required"),p.status==="closed"&&!p.exitPrice&&(de.exitPrice=d==="fr"?"Le prix de sortie est requis pour un trade fermÃ©":"Exit price is required for a closed trade")),j(de),Object.keys(de).length===0},Ht=()=>{qt()&&s(p)};Km({currentStep:m,stepsOrder:["instrument-context","position-entry","position-exit","risk-reward","notes-screenshots"],onNextStep:()=>{const de=N(m);if(console.log("ðŸ” Validation Ã©tape:",m,"Erreurs:",de),Object.keys(de).length>0){j(de);const ce=document.querySelector('[data-wizard-content="true"]');ce&&Gs(ce);return}g(),setTimeout(()=>{const ce=document.querySelector('[data-wizard-content="true"]');ce&&Gs(ce)},50)},onPrevStep:()=>{h(),setTimeout(()=>{const de=document.querySelector('[data-wizard-content="true"]');de&&Gs(de)},50)},onGoToStep:de=>{const ce=N(m);if(Object.keys(ce).length>0){j(ce);const pe=document.querySelector('[data-wizard-content="true"]');pe&&Gs(pe);return}y(de),setTimeout(()=>{const pe=document.querySelector('[data-wizard-content="true"]');pe&&Gs(pe)},50)},onSubmit:()=>Ht(),onFocusNextMissing:tt,onFocusPrevMissing:Ct,onFocusNextField:ge,onFocusPrevField:Pe,onOpenSettings:()=>I(!0),onCloseTopModal:()=>{if(Z)return oe(!1);if(F)return q(!1);if(z)return A(!1);if(W)return I(!1);r()}});const Pt=de=>{f("strategy",de),A(!1)},Gt=de=>{const ce=te(de);ce&&Object.entries(ce).forEach(([pe,De])=>{De!=null&&De!==""&&f(pe,De)})},rs=async(de,ce,pe=!1)=>{try{await Y(de,ce,pe)}catch(De){console.error("Erreur lors de la sauvegarde du preset:",De)}},Ut=()=>{q(!0)},Ve=()=>e.jsx(id,{currentStep:m,isQuickMode:S,isCustomMode:je,formData:p,onChange:f,errors:x,settings:l,existingSymbols:n,existingTrades:o,pnlInputMode:w,setPnlInputMode:k,calculatePnL:C,onOpenStrategyModal:()=>A(!0),theme:i,language:d,customVisibleFields:le.visibleFields,customOrder:le.order,isEditMode:P,fieldConfig:T,shouldShowField:E,toggleFieldVisibility:L,isObligatoryField:_});return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4 overflow-y-auto",children:[e.jsxs("div",{className:"rounded-lg shadow-2xl flex flex-col",style:{width:`${Te.width}px`,height:`${Te.maxHeight}px`,backgroundColor:i.colors.card,color:i.colors.text,border:`1px solid ${i.colors.accent}30`,overflow:"hidden"},children:[e.jsxs("div",{className:`flex items-center justify-between ${Te.padding} py-3 border-b`,style:{borderColor:i.colors.border,background:`linear-gradient(180deg, ${i.colors.card} 0%, ${i.colors.surface} 100%)`,borderBottom:`1px solid ${i.colors.border}`},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>I(!0),className:"p-2 rounded-md hover:shadow-sm transition-colors",style:{border:`1px solid ${i.colors.border}`,backgroundColor:i.colors.surface,color:i.colors.accent},title:d==="fr"?"ParamÃ¨tres du formulaire":"Form settings",children:e.jsx(Jo,{size:16})}),e.jsx("button",{onClick:()=>D(!P),className:"px-2 py-1 rounded-md text-xs border transition-colors",style:{backgroundColor:P?i.colors.warning:i.colors.surface,color:P?"#000000":i.colors.text,border:`1px solid ${i.colors.border}`},title:d==="fr"?"Basculer le mode Ã©dition":"Toggle edit mode",children:d==="fr"?"Ã‰dition":"Edit"}),P&&e.jsx("button",{onClick:()=>V(!0),className:"p-2 rounded-md hover:shadow-sm transition-colors",style:{border:`1px solid ${i.colors.border}`,backgroundColor:i.colors.surface,color:i.colors.accent},title:d==="fr"?"Configurer les champs":"Configure fields",children:"Cf"})]}),e.jsx("h2",{className:"text-xl font-bold",style:{color:i.colors.text},children:t?d==="fr"?"Modifier le Trade":"Edit Trade":d==="fr"?"Ajouter un Trade":"Add Trade"}),e.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium",style:{backgroundColor:i.colors.accent+"20",color:i.colors.accent,border:`1px solid ${i.colors.accent}40`},children:"Wizard V2"}),P&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium",style:{backgroundColor:i.colors.warning+"20",color:i.colors.warning,border:`1px solid ${i.colors.warning}40`},children:d==="fr"?"Mode Ã‰dition":"Edit Mode"}),e.jsx("button",{onClick:U,className:"px-2 py-1 text-xs rounded border transition-colors hover:bg-gray-100",style:{backgroundColor:i.colors.surface,color:i.colors.text,borderColor:i.colors.border},title:d==="fr"?"RÃ©initialiser tous les champs":"Reset all fields",children:"Reset"}),e.jsx("button",{onClick:()=>D(!1),className:"px-2 py-1 text-xs rounded border transition-colors hover:bg-gray-100",style:{backgroundColor:i.colors.surface,color:i.colors.text,borderColor:i.colors.border},title:d==="fr"?"Terminer l'Ã©dition":"Finish editing",children:d==="fr"?"Terminer":"Finish"})]}),e.jsx(cd,{isQuickMode:S,onToggle:M}),e.jsx(ga,{formData:p,presets:se,onLoadPreset:Gt,onSavePreset:rs,onDeletePreset:G,onToggleFavorite:he,onManagePresets:Ut,onReorderPresets:Ie})]}),e.jsx("button",{onClick:r,className:"p-2 rounded-full hover:bg-opacity-10 hover:bg-black transition-colors",style:{color:i.colors.textMuted},children:e.jsx(be,{size:24})})]}),!S&&e.jsxs("div",{className:"px-4 py-1 border-b",style:{borderColor:i.colors.border,backgroundColor:i.colors.surface+"50"},children:[e.jsx(Zi,{currentStep:m,completedSteps:ne,onStepClick:y,disabledSteps:ue,formData:p}),H>0&&e.jsx("div",{className:"mt-1 text-xs inline-flex items-center gap-2",children:e.jsx("span",{className:"px-2 py-0.5 rounded-full",style:{backgroundColor:i.colors.accent+"20",color:i.colors.accent,border:`1px solid ${i.colors.accent}40`},children:d==="fr"?`${H} champs masquÃ©s`:`${H} hidden fields`})})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"flex-1 overflow-y-auto",style:{borderRight:`1px solid ${i.colors.border}`,backgroundColor:i.colors.card},children:e.jsx("div",{className:`${Te.padding} max-w-7xl mx-auto`,"data-wizard-content":"true",children:Ve()})}),e.jsx("div",{className:"overflow-y-auto",style:{width:`${Te.summaryWidth}px`,backgroundColor:i.colors.surface,borderLeft:`1px solid ${i.colors.border}`},children:e.jsx(Xo,{formData:p,settings:l,missingFields:v(),onProgressClick:me,currentStep:m,onOpenModal:()=>oe(!0),headerClickable:!0,disableRingClick:!0})})]}),e.jsx(qm,{theme:i,language:d,progress:{...fe,padding:Te.padding},currentStep:m,isQuickMode:S,onPrev:h,onNext:g,onClose:r,onSubmit:Ht})]}),z&&e.jsx(rn,{onSelect:Pt,onClose:()=>A(!1),currentValue:p.strategy||"",availableTrades:o||[],tradingSettings:l}),F&&e.jsx(ya,{presets:se,onClose:()=>q(!1),onDeletePreset:G,onToggleFavorite:he,onUpdatePreset:we,onLoadPreset:Gt,onReorderPresets:Ie}),e.jsx(ba,{isOpen:W,onClose:()=>I(!1),activeProfileId:a,onOpenEditMode:K}),e.jsx(va,{isOpen:$,onClose:()=>V(!1),currentHiddenFields:T?.hiddenFields||[],isRequired:de=>_(de)||!1,order:ze,onApply:de=>{B(de),V(!1)},onReset:()=>{U()}}),e.jsx(Jm,{isOpen:Z,onClose:()=>oe(!1),formData:p,settings:l,missingFields:v(),currentStep:m})]})},Xm=({currentTheme:t,currentLanguage:s,globalMetrics:r,formatCurrency:l,formatPercentage:n,formatDuration:o})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg shadow-sm border",style:{backgroundColor:t.colors.card,borderColor:t.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium",style:{color:t.colors.text},children:"Performance"}),e.jsx(Tt,{size:20,style:{color:t.colors.accent}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:"P&L:"}),e.jsx("span",{className:`text-sm font-bold ${r.totalPnLPercentage>=0?"text-green-600":"text-red-500"}`,children:n(r.totalPnLPercentage)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Win Rate:"}),e.jsxs("span",{className:"text-sm font-bold",style:{color:t.colors.text},children:[r.winRate.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Trades:"}),e.jsx("span",{className:"text-sm font-bold",style:{color:t.colors.text},children:r.totalTrades})]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg shadow-sm border",style:{backgroundColor:t.colors.card,borderColor:t.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium",style:{color:t.colors.text},children:s==="fr"?"Consistance":"Consistency"}),e.jsx(Me,{size:20,style:{color:t.colors.success}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Score:"}),e.jsxs("span",{className:"text-sm font-bold",style:{color:t.colors.text},children:[r.consistencyScore.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:s==="fr"?"Jours:":"Days:"}),e.jsx("span",{className:"text-sm font-bold",style:{color:t.colors.text},children:r.tradingDays})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:s==="fr"?"Meilleur:":"Best:"}),e.jsx("span",{className:"text-sm font-bold text-green-600",children:n(r.bestDay)})]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg shadow-sm border",style:{backgroundColor:t.colors.card,borderColor:t.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium",style:{color:t.colors.text},children:"Risk/Reward"}),e.jsx(dr,{size:20,style:{color:t.colors.danger}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:s==="fr"?"Gain moy:":"Avg Win:"}),e.jsx("span",{className:"text-sm font-bold text-green-600",children:l(r.avgWin)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:s==="fr"?"Perte moy:":"Avg Loss:"}),e.jsx("span",{className:"text-sm font-bold text-red-500",children:l(r.avgLoss)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:"Ratio:"}),e.jsxs("span",{className:"text-sm font-bold",style:{color:t.colors.text},children:["1:",Math.abs(r.avgLoss)>0?(r.avgWin/Math.abs(r.avgLoss)).toFixed(2):"âˆž"]})]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg shadow-sm border",style:{backgroundColor:t.colors.card,borderColor:t.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium",style:{color:t.colors.text},children:"Timing"}),e.jsx($e,{size:20,style:{color:t.colors.warning}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:s==="fr"?"DurÃ©e:":"Duration:"}),e.jsx("span",{className:"text-sm font-bold",style:{color:t.colors.text},children:o(r.avgDuration)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:s==="fr"?"Trades/j:":"Trades/d:"}),e.jsx("span",{className:"text-sm font-bold",style:{color:t.colors.text},children:(r.totalTrades/Math.max(r.tradingDays,1)).toFixed(1)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:s==="fr"?"Avec durÃ©e:":"With dur:"}),e.jsx("span",{className:"text-sm font-bold",style:{color:t.colors.text}})]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg shadow-sm border",style:{backgroundColor:t.colors.card,borderColor:t.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium",style:{color:t.colors.text},children:s==="fr"?"RÃ©sultats":"Results"}),e.jsx(Me,{size:20,style:{color:t.colors.warning}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:"TP:"}),e.jsxs("span",{className:"text-sm font-bold text-green-600",children:[r.tpCount," (",r.tpWinRate.toFixed(1),"%)"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:"SL:"}),e.jsxs("span",{className:"text-sm font-bold text-red-500",children:[r.slCount," (",r.slWinRate.toFixed(1),"%)"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textSecondary},children:"BE:"}),e.jsxs("span",{className:"text-sm font-bold text-yellow-600",children:[r.beCount," (",r.beWinRate.toFixed(1),"%)"]})]})]})]})]}),Qm=({selectedPeriod:t,onChange:s,currentTheme:r,currentLanguage:l})=>{const n=[{key:"7d",label:l==="fr"?"7 jours":"7 days"},{key:"30d",label:l==="fr"?"30 jours":"30 days"},{key:"90d",label:l==="fr"?"90 jours":"90 days"},{key:"all",label:l==="fr"?"Tout":"All"}];return e.jsx("div",{className:"flex space-x-1 p-1 rounded-lg",style:{backgroundColor:r.colors.surface},children:n.map(({key:o,label:a})=>e.jsx("button",{onClick:()=>s(o),className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${t===o?"shadow-sm":""}`,style:{backgroundColor:t===o?r.colors.card:"transparent",color:t===o?r.colors.accent:r.colors.textSecondary},children:a},o))})},Zm=({trendAnalysis:t,currentTheme:s,currentLanguage:r})=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-bold",style:{color:s.colors.text},children:r==="fr"?"Tendances":"Trends"}),e.jsxs("div",{className:"p-6 rounded-lg shadow-sm border",style:{backgroundColor:s.colors.card,borderColor:s.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium",style:{color:s.colors.text},children:r==="fr"?"Tendance Taux de RÃ©ussite":"Win Rate Trend"}),e.jsx(Ee,{size:24,style:{color:s.colors.accent}})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-3xl font-bold ${t.winRateTrend>=0?"text-green-600":"text-red-500"}`,children:[t.winRateTrend>=0?"+":"",t.winRateTrend.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:r==="fr"?"Ã‰volution rÃ©cente":"Recent evolution"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold",style:{color:s.colors.text},children:[t.recentWinRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs",style:{color:s.colors.textSecondary},children:r==="fr"?"RÃ©cent (10)":"Recent (10)"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold",style:{color:s.colors.text},children:[t.olderWinRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs",style:{color:s.colors.textSecondary},children:r==="fr"?"Ancien":"Older"})]})]})]})]}),e.jsxs("div",{className:"p-6 rounded-lg shadow-sm border",style:{backgroundColor:s.colors.card,borderColor:s.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium",style:{color:s.colors.text},children:r==="fr"?"Tendance P&L":"P&L Trend"}),e.jsx(He,{size:24,style:{color:s.colors.accent}})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-3xl font-bold ${t.pnlTrend>=0?"text-green-600":"text-red-500"}`,children:[t.pnlTrend>=0?"+":"",t.pnlTrend.toFixed(2),"%"]}),e.jsx("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:r==="fr"?"Ã‰volution P&L":"P&L evolution"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold",style:{color:s.colors.text},children:[t.recentAvgPnL.toFixed(2),"%"]}),e.jsx("p",{className:"text-xs",style:{color:s.colors.textSecondary},children:r==="fr"?"RÃ©cent (10)":"Recent (10)"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold",style:{color:s.colors.text},children:[t.olderAvgPnL.toFixed(2),"%"]}),e.jsx("p",{className:"text-xs",style:{color:s.colors.textSecondary},children:r==="fr"?"Ancien":"Older"})]})]})]})]})]}),ex=t=>{switch(t){case"success":return{backgroundColor:"rgba(34, 197, 94, 0.2)",borderColor:"rgb(34, 197, 94)",color:"rgb(134, 239, 172)"};case"warning":return{backgroundColor:"rgba(234, 179, 8, 0.2)",borderColor:"rgb(234, 179, 8)",color:"rgb(253, 224, 71)"};case"danger":return{backgroundColor:"rgba(239, 68, 68, 0.2)",borderColor:"rgb(239, 68, 68)",color:"rgb(252, 165, 165)"};case"info":return{backgroundColor:"rgba(59, 130, 246, 0.2)",borderColor:"rgb(59, 130, 246)",color:"rgb(147, 197, 253)"};default:return{}}},tx=({insights:t,currentTheme:s})=>e.jsx("div",{className:"space-y-4",children:t.map((r,l)=>{const n=r.icon;return e.jsx("div",{className:"p-4 rounded-lg border",style:ex(r.type),children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(n,{size:24,className:"flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-lg mb-1",children:r.title}),e.jsx("p",{className:"text-sm opacity-90",children:r.message})]})]})},l)})}),sx=({patternAnalysis:t,currentTheme:s,currentLanguage:r,formatPercentage:l})=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-bold",style:{color:s.colors.text},children:"Patterns"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.bestStrategy&&e.jsxs("div",{className:"p-6 rounded-lg shadow-sm border",style:{backgroundColor:s.colors.card,borderColor:s.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium",style:{color:s.colors.text},children:r==="fr"?"Meilleure StratÃ©gie":"Best Strategy"}),e.jsx(Me,{size:24,style:{color:s.colors.success}})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-2xl font-bold",style:{color:s.colors.accent},children:t.bestStrategy.name})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:s.colors.textSecondary},children:"P&L:"}),e.jsx("span",{className:"font-bold text-green-600",children:l(t.bestStrategy.pnl)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:s.colors.textSecondary},children:"Trades:"}),e.jsx("span",{className:"font-bold",style:{color:s.colors.text},children:t.bestStrategy.trades})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:s.colors.textSecondary},children:"Win Rate:"}),e.jsxs("span",{className:"font-bold",style:{color:s.colors.text},children:[t.bestStrategy.winRate.toFixed(1),"%"]})]})]})]}),t.bestTimeframe&&e.jsxs("div",{className:"p-6 rounded-lg shadow-sm border",style:{backgroundColor:s.colors.card,borderColor:s.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium",style:{color:s.colors.text},children:r==="fr"?"Meilleur Timeframe":"Best Timeframe"}),e.jsx($e,{size:24,style:{color:s.colors.info}})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-2xl font-bold",style:{color:s.colors.accent},children:t.bestTimeframe.name})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:s.colors.textSecondary},children:"P&L:"}),e.jsx("span",{className:"font-bold text-green-600",children:l(t.bestTimeframe.pnl)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:s.colors.textSecondary},children:"Trades:"}),e.jsx("span",{className:"font-bold",style:{color:s.colors.text},children:t.bestTimeframe.trades})]})]})]}),t.bestDay&&e.jsxs("div",{className:"p-6 rounded-lg shadow-sm border",style:{backgroundColor:s.colors.card,borderColor:s.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium",style:{color:s.colors.text},children:r==="fr"?"Meilleur Jour":"Best Day"}),e.jsx(bt,{size:24,style:{color:s.colors.info}})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-2xl font-bold",style:{color:s.colors.accent},children:t.bestDay.name})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:s.colors.textSecondary},children:"P&L:"}),e.jsx("span",{className:"font-bold text-green-600",children:l(t.bestDay.pnl)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:s.colors.textSecondary},children:"Trades:"}),e.jsx("span",{className:"font-bold",style:{color:s.colors.text},children:t.bestDay.trades})]})]})]})]})]}),rx=({trades:t,settings:s})=>{const{currentTheme:r}=ee(),{currentLanguage:l}=X(),[n,o]=b.useState("30d"),a=b.useMemo(()=>{const f=new Date;let g;switch(n){case"7d":g=co(f,7);break;case"30d":g=co(f,30);break;case"90d":g=co(f,90);break;default:return t.filter(h=>h.status==="closed")}return t.filter(h=>h.status==="closed"&&Xa(new Date(h.date),{start:g,end:f}))},[t,n]),c=b.useMemo(()=>{const f=a;if(f.length===0)return null;const g=f.reduce((q,W)=>q+(W.pnl||0),0),h=f.reduce((q,W)=>q+(W.pnlPercentage||0),0),y=f.filter(q=>(q.pnl||0)>0),j=f.filter(q=>(q.pnl||0)<0),v=y.length/f.length*100,N=y.length>0?y.reduce((q,W)=>q+(W.pnl||0),0)/y.length:0,S=j.length>0?j.reduce((q,W)=>q+(W.pnl||0),0)/j.length:0,w=Math.abs(S)>0?N/Math.abs(S):N>0?1/0:0,k=f.filter(q=>q.duration&&q.duration>0),M=k.length>0?k.reduce((q,W)=>q+(W.duration||0),0)/k.length:0,C=new Map;f.forEach(q=>{const W=q.date;C.set(W,(C.get(W)||0)+(q.pnlPercentage||0))});const R=Array.from(C.values()),P=R.filter(q=>q>0).length,D=R.length>0?P/R.length*100:0,T=f.filter(q=>q.tradeResult==="tp"),E=f.filter(q=>q.tradeResult==="sl"),L=f.filter(q=>q.tradeResult==="be"),U=T.length,_=E.length,B=L.length,z=T.length>0?T.filter(q=>(q.pnl||0)>0).length/T.length*100:0,A=E.length>0?E.filter(q=>(q.pnl||0)>0).length/E.length*100:0,F=L.length>0?L.filter(q=>(q.pnl||0)>0).length/L.length*100:0;return{totalTrades:f.length,totalPnL:g,totalPnLPercentage:h,winRate:v,profitFactor:w,avgDuration:M,consistencyScore:D,avgWin:N,avgLoss:S,bestDay:Math.max(...R,0),worstDay:Math.min(...R,0),tradingDays:R.length,tpCount:U,slCount:_,beCount:B,tpWinRate:z,slWinRate:A,beWinRate:F}},[a]),i=b.useMemo(()=>{if(!c||a.length<10)return null;const f=a.slice(-10),g=a.slice(0,-10),h=f.filter(N=>(N.pnl||0)>0).length/f.length*100,y=g.length>0?g.filter(N=>(N.pnl||0)>0).length/g.length*100:0,j=f.reduce((N,S)=>N+(S.pnlPercentage||0),0)/f.length,v=g.length>0?g.reduce((N,S)=>N+(S.pnlPercentage||0),0)/g.length:0;return{winRateTrend:h-y,pnlTrend:j-v,isImproving:h>y&&j>v,recentWinRate:h,olderWinRate:y,recentAvgPnL:j,olderAvgPnL:v}},[a,c]),d=b.useMemo(()=>{if(a.length===0)return null;const f=new Map;a.forEach(S=>{const w=S.strategy,k=f.get(w)||{trades:0,pnl:0,winRate:0};k.trades++,k.pnl+=S.pnlPercentage||0,f.set(w,k)}),f.forEach((S,w)=>{const k=a.filter(C=>C.strategy===w),M=k.filter(C=>(C.pnl||0)>0).length;S.winRate=M/k.length*100});const g=Array.from(f.entries()).sort((S,w)=>w[1].pnl-S[1].pnl)[0],h=new Map;a.forEach(S=>{const w=S.timeframe||"unknown",k=h.get(w)||{trades:0,pnl:0};k.trades++,k.pnl+=S.pnlPercentage||0,h.set(w,k)});const y=Array.from(h.entries()).sort((S,w)=>w[1].pnl-S[1].pnl)[0],j=new Map;a.forEach(S=>{const w=new Date(S.date).getDay(),k=j.get(w)||{trades:0,pnl:0};k.trades++,k.pnl+=S.pnlPercentage||0,j.set(w,k)});const v=Array.from(j.entries()).sort((S,w)=>w[1].pnl-S[1].pnl)[0],N=l==="fr"?["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"]:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return{bestStrategy:g?{name:g[0],...g[1]}:null,bestTimeframe:y?{name:y[0],...y[1]}:null,bestDay:v?{name:N[v[0]],day:v[0],...v[1]}:null,totalStrategies:f.size,totalTimeframes:h.size}},[a,l]),u=b.useMemo(()=>{if(!c||!i||!d)return[];const f=[];return c.winRate>=60?f.push({type:"success",title:l==="fr"?"Excellent taux de rÃ©ussite":"Excellent win rate",message:l==="fr"?`Votre taux de rÃ©ussite de ${c.winRate.toFixed(1)}% est excellent. Continuez sur cette voie !`:`Your win rate of ${c.winRate.toFixed(1)}% is excellent. Keep up the good work!`,icon:Vr}):c.winRate<40&&f.push({type:"danger",title:l==="fr"?"Taux de rÃ©ussite faible":"Low win rate",message:l==="fr"?`Votre taux de rÃ©ussite de ${c.winRate.toFixed(1)}% nÃ©cessite une rÃ©vision de votre stratÃ©gie.`:`Your win rate of ${c.winRate.toFixed(1)}% requires a revision of your strategy.`,icon:Pi}),c.profitFactor>=2?f.push({type:"success",title:"Excellent Profit Factor",message:l==="fr"?`Votre profit factor de ${c.profitFactor.toFixed(2)} indique une gestion des risques optimale.`:`Your profit factor of ${c.profitFactor.toFixed(2)} indicates optimal risk management.`,icon:Rs}):c.profitFactor<1.2&&f.push({type:"warning",title:l==="fr"?"Profit Factor Ã  amÃ©liorer":"Profit Factor needs improvement",message:l==="fr"?`Votre profit factor de ${c.profitFactor.toFixed(2)} suggÃ¨re d'optimiser votre ratio risque/rÃ©compense.`:`Your profit factor of ${c.profitFactor.toFixed(2)} suggests optimizing your risk/reward ratio.`,icon:Zt}),i.isImproving?f.push({type:"success",title:l==="fr"?"Progression positive":"Positive progression",message:l==="fr"?`Vos performances s'amÃ©liorent ! Taux de rÃ©ussite rÃ©cent : ${i.recentWinRate.toFixed(1)}%`:`Your performance is improving! Recent win rate: ${i.recentWinRate.toFixed(1)}%`,icon:Ee}):i.winRateTrend<-10&&f.push({type:"warning",title:l==="fr"?"Baisse de performance":"Performance decline",message:l==="fr"?`Attention : votre taux de rÃ©ussite a baissÃ© de ${Math.abs(i.winRateTrend).toFixed(1)}% rÃ©cemment.`:`Warning: your win rate has decreased by ${Math.abs(i.winRateTrend).toFixed(1)}% recently.`,icon:Ot}),d.bestStrategy&&f.push({type:"info",title:l==="fr"?"StratÃ©gie performante":"High-performing strategy",message:l==="fr"?`Votre stratÃ©gie "${d.bestStrategy.name}" gÃ©nÃ¨re ${d.bestStrategy.pnl.toFixed(2)}% de profit.`:`Your strategy "${d.bestStrategy.name}" generates ${d.bestStrategy.pnl.toFixed(2)}% profit.`,icon:Me}),c.consistencyScore>=70?f.push({type:"success",title:l==="fr"?"Trading consistant":"Consistent trading",message:l==="fr"?`${c.consistencyScore.toFixed(1)}% de vos journÃ©es sont profitables. Excellente rÃ©gularitÃ© !`:`${c.consistencyScore.toFixed(1)}% of your days are profitable. Excellent consistency!`,icon:Tt}):c.consistencyScore<50&&f.push({type:"warning",title:l==="fr"?"Manque de consistance":"Lack of consistency",message:l==="fr"?`Seulement ${c.consistencyScore.toFixed(1)}% de vos journÃ©es sont profitables. Travaillez la rÃ©gularitÃ©.`:`Only ${c.consistencyScore.toFixed(1)}% of your days are profitable. Work on consistency.`,icon:Zt}),f},[c,i,d,l]),m=f=>new Intl.NumberFormat(l==="fr"?"fr-FR":"en-US",{style:"currency",currency:s.currency,minimumFractionDigits:0,maximumFractionDigits:0}).format(f),p=f=>`${f>=0?"+":""}${f.toFixed(2)}%`,x=f=>{if(f===0)return"0s";const g=Math.floor(f/3600),h=Math.floor(f%3600/60);return g>0?`${g}h ${h}m`:h>0?`${h}m`:`${f}s`};return c?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:e.jsx(Qm,{selectedPeriod:n,onChange:f=>o(f),currentTheme:r,currentLanguage:l})}),e.jsx(Xm,{currentTheme:r,currentLanguage:l,globalMetrics:{totalPnLPercentage:c.totalPnLPercentage,winRate:c.winRate,totalTrades:c.totalTrades,consistencyScore:c.consistencyScore,tradingDays:c.tradingDays,bestDay:c.bestDay,avgWin:c.avgWin,avgLoss:c.avgLoss,avgDuration:c.avgDuration,tpCount:c.tpCount,slCount:c.slCount,beCount:c.beCount,tpWinRate:c.tpWinRate,slWinRate:c.slWinRate,beWinRate:c.beWinRate},formatCurrency:m,formatPercentage:p,formatDuration:x}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[i&&e.jsx(Zm,{trendAnalysis:i,currentTheme:r,currentLanguage:l}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(tx,{insights:u,currentTheme:r,currentLanguage:l}),u.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ke,{size:48,className:"mx-auto mb-4",style:{color:r.colors.textMuted}}),e.jsx("p",{style:{color:r.colors.textSecondary},children:l==="fr"?"Continuez Ã  trader pour obtenir plus d'insights personnalisÃ©s":"Continue trading to get more personalized insights"})]})]})]}),d&&e.jsx(sx,{patternAnalysis:d,currentTheme:r,currentLanguage:l,formatPercentage:p})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ke,{size:64,className:"mx-auto mb-4",style:{color:r.colors.textMuted}}),e.jsx("h3",{className:"text-xl font-bold mb-2",style:{color:r.colors.text},children:l==="fr"?"Pas assez de donnÃ©es":"Not enough data"}),e.jsx("p",{style:{color:r.colors.textSecondary},children:l==="fr"?"Ajoutez plus de trades fermÃ©s pour voir votre vue d'ensemble":"Add more closed trades to see your overview"})]})},ox=({trades:t,settings:s})=>e.jsx(rx,{trades:t,settings:s}),Vn=t=>{let s;const r=new Set,l=(d,u)=>{const m=typeof d=="function"?d(s):d;if(!Object.is(m,s)){const p=s;s=u??(typeof m!="object"||m===null)?m:Object.assign({},s,m),r.forEach(x=>x(s,p))}},n=()=>s,c={setState:l,getState:n,getInitialState:()=>i,subscribe:d=>(r.add(d),()=>r.delete(d))},i=s=t(l,n,c);return c},nx=(t=>t?Vn(t):Vn),lx=t=>t;function ax(t,s=lx){const r=O.useSyncExternalStore(t.subscribe,O.useCallback(()=>s(t.getState()),[t,s]),O.useCallback(()=>s(t.getInitialState()),[t,s]));return O.useDebugValue(r),r}const Bn=t=>{const s=nx(t),r=l=>ax(s,l);return Object.assign(r,s),r},oo=(t=>t?Bn(t):Bn);function $t(t){return t==null||t===""?"0":String(t)}const Hn=new Map;function Gn(t,s){const r=t,l=[r.market,r.side,r.entryPrice,r.exitPrice,r.tickSize,r.tickValue,r.quantity,r.pnl,r.pnlPercentage,r.fees_commission,r.fees_spread_slippage,r.fees_swap_overnight,r.fees_other,s.equity];return JSON.stringify(l)}function ja(t,s={}){try{const w=Gn(t,s),k=Hn.get(w);if(k)return k}catch{}const r=t.side==="short"?Ce("-1"):Ce("1"),l=t.market==="futures",n=Ce($t(t.entryPrice)),o=Ce($t(t.exitPrice)),a=Ce($t(t.quantity)),c=Ce($t(t.tickSize)),i=Ce($t(t.tickValue)),d=Yr(o,n),u=ft(d,r),m=l&&!c.isZero()?vs(u,c):Ce("0");let p=null;if(a.gt(0))if(l){const w=c.isZero()?Ce("0"):vs(i,c);p=ft(ft(u,w),a)}else p=ft(u,a);const x=Ce($t(t.fees?.commission??t.fees_commission)),f=Ce($t(t.fees?.spread_slippage??t.fees_spread_slippage)),g=Ce($t(t.fees?.swap_overnight??t.fees_swap_overnight)),h=Ce($t(t.fees?.other??t.fees_other)),y=Rt(Rt(x,f),Rt(g,h)),j=p?Rt(p,y):null,v=Ce($t(s.equity)),N=j&&!v.isZero()?ft(vs(j,v),Ce("100")):null;if(t.pnl!==void 0||t.pnlPercentage!==void 0){const w=t.pnl!==void 0?Ce($t(t.pnl)):null,k=t.pnlPercentage!==void 0?Ce($t(t.pnlPercentage)):null;return{pnlBrut:w,totalFees:y,pnlNet:w?Rt(w,y):null,pnlPct:k??(w&&!v.isZero()?ft(vs(w,v),Ce("100")):null),movePoints:u,moveTicks:m}}const S={pnlBrut:p,totalFees:y,pnlNet:j,pnlPct:N,movePoints:u,moveTicks:m};try{Hn.set(Gn(t,s),S)}catch{}return S}let jo=null,Jn=0;function ix(){return typeof window>"u"?null:(jo||(jo=new Worker(new URL(""+new URL("computeMetrics.worker-BFmWPcxV.js",import.meta.url).href,import.meta.url),{type:"module"})),jo)}function No(t,s){const r=ix(),l=()=>{const{formData:c,settings:i}=t();s({computed:ja(c,i)})};if(!r)return l();const n=++Jn,{formData:o,settings:a}=t();r.onmessage=c=>{const{id:i,result:d}=c.data||{};i===Jn&&s({computed:d})};try{r.postMessage({id:n,formData:o,settings:t().settings})}catch{l()}}const zt=oo((t,s)=>({formData:{pnlEntryMode:"direct",pnlMode:"absolute"},settings:{equity:1e4},computed:{},updateField:(r,l)=>{t(n=>({formData:{...n.formData,[r]:l}})),No(s,t)},updateFields:r=>{t(l=>({formData:{...l.formData,...r}})),No(s,t)},setSettings:r=>{t(l=>({settings:typeof r=="function"?r(l.settings):r})),No(s,t)},reset:()=>{t({formData:{},settings:{equity:1e4},computed:{}})}}));function Na({children:t}){return e.jsx(e.Fragment,{children:t})}function fs(){const t=zt(a=>a.formData),s=zt(a=>a.computed),r=zt(a=>a.settings),l=zt(a=>a.updateField),n=zt(a=>a.updateFields),o=zt(a=>a.setSettings);return{formData:t,computed:s,settings:r,updateField:l,updateFields:n,setSettings:o}}const ht={sections:[{id:"instrument-context",label:"Contexte du trade",fields:[{id:"status",type:"toggle",component:"StatusToggleFieldWrapper",label:"Statut",required:!0,visibleIf:!0},{id:"side",type:"toggle",component:"SideToggleFieldWrapper",label:"Direction",required:!0,visibleIf:!0},{id:"market",type:"buttons-grid",component:"MarketSelectorFieldWrapper",label:"MarchÃ©",required:!0,visibleIf:!0},{id:"timeframe",type:"overlay",component:"TimeframeFieldWrapper",label:"Timeframe",visibleIf:!0},{id:"symbol",type:"text+overlay",component:"SymbolFieldWrapper",label:"Symbole",required:!0,visibleIf:!0,modals:["SymbolsOverlay"]}]},{id:"position-entry",label:"EntrÃ©e de position",fields:[{id:"entryDateTime",type:"composite",component:"EntryDateTimeSectionWrapper",label:"Date/Heure d'entrÃ©e",visibleIf:!0},{id:"entryPrice",type:"number",component:"EntryPriceFieldWrapper",label:"Prix d'entrÃ©e",requiredIf:t=>t.pnlEntryMode!=="direct",visibleIf:!0},{id:"quantity",type:"number",component:"QuantityFieldWrapper",label:"QuantitÃ©",requiredIf:t=>t.pnlEntryMode!=="direct",visibleIf:!0},{id:"futuresParams",type:"composite",component:"FuturesParamsSectionWrapper",label:"ParamÃ¨tres Futures",visibleIf:t=>t.market==="futures"},{id:"leverageMargin",type:"composite",component:"LeverageMarginSectionWrapper",label:"",visibleIf:!0},{id:"stopPrice",type:"number",component:"StopPriceFieldWrapper",label:"Stop prÃ©vu"},{id:"takeProfitPrice",type:"number",component:"TakeProfitPriceFieldWrapper",label:"TP prÃ©vu"}]},{id:"position-exit",label:"Sortie de position",fields:[{id:"exitDateTime",type:"composite",component:"ExitDateTimeSectionWrapper",label:"Date/Heure de sortie",visibleIf:!0},{id:"ticksQuick",type:"composite",component:"TicksQuickWidgetWrapper",label:"Ticks",visibleIf:!0},{id:"exitPrice",type:"number",component:"ExitPriceFieldWrapper",label:"Prix de sortie",requiredIf:t=>t.status==="closed"&&t.pnlEntryMode!=="direct",visibleIf:!0},{id:"pnl",type:"number",component:"PnlFieldWrapper",label:"PnL",visibleIf:t=>t.pnlEntryMode==="direct"&&t.pnlMode==="absolute",requiredIf:t=>t.pnlEntryMode==="direct"&&t.pnlMode==="absolute"},{id:"pnlPercentage",type:"number",component:"PnlPercentageFieldWrapper",label:"PnL %",visibleIf:t=>t.pnlEntryMode==="direct"&&t.pnlMode==="percentage",requiredIf:t=>t.pnlEntryMode==="direct"&&t.pnlMode==="percentage"},{id:"fees_commission",type:"number",component:"FeesCommissionFieldWrapper",label:"Commission"},{id:"fees_spread_slippage",type:"number",component:"FeesSpreadSlippageFieldWrapper",label:"Spread/Slippage"},{id:"fees_swap_overnight",type:"number",component:"FeesSwapOvernightFieldWrapper",label:"Swap/Overnight"},{id:"fees_other",type:"number",component:"FeesOtherFieldWrapper",label:"Autres frais"}]}]};ht.sections.push({id:"risk-reward",label:"Performance & StratÃ©gie",fields:[{id:"tradeResult",type:"enum",component:"TradeResultFieldWrapper",label:"RÃ©sultat",visibleIf:!0,placeholder:"",help:""},{id:"strategy",type:"text",component:"StrategyFieldWrapper",label:"StratÃ©gie",visibleIf:!0,placeholder:"Ex: Scalping, Momentum...",help:""},{id:"setup",type:"text",component:"SetupFieldWrapper",label:"Setup",visibleIf:!0,placeholder:"SÃ©lectionner un setup...",help:""},{id:"trend",type:"enum",component:"TrendFieldWrapper",label:"Tendance",visibleIf:!0,placeholder:"",help:""},{id:"riskReward",type:"number",component:"RiskRewardInputWrapper",label:"R:R",visibleIf:!0,placeholder:"Ex: 2.5",help:"CalculÃ© automatiquement si SL/TP"},{id:"tags",type:"tags",component:"TagsFieldWrapper",label:"Tags",visibleIf:!0}]},{id:"trade-summary",label:"RÃ©sumÃ© du trade",fields:[{id:"summaryPanel",type:"composite",component:"SummaryPanelWrapper",label:"RÃ©sumÃ©",visibleIf:!0}]},{id:"notes-screenshots",label:"Notes & Psychologie",fields:[{id:"notesAndPsycho",type:"composite",component:"NotesAndScreenshotsStepWrapper",visibleIf:!0}]});const ka=({headerClickable:t,onOpenModal:s,currentStepId:r})=>{const{formData:l}=fs(),{currentTheme:n}=ee(),{currentLanguage:o}=X(),a=O.useMemo(()=>({currency:"EUR",initialCapital:1e4,currentCapital:1e4}),[]),c=O.useMemo(()=>{switch(r){case"instrument-context":return"instrument-context-v3";case"position-entry":return"position-entry-v3";case"position-exit":return"position-exit-v3";case"risk-reward":return"risk-reward";case"notes-screenshots":return"notes-screenshots";default:return"instrument-context-v3"}},[r]);return e.jsx("div",{className:"rounded border",style:{borderColor:n.colors.border},children:e.jsx(Xo,{formData:l,settings:a,missingFields:[],currentStep:c,headerClickable:!!t,onOpenModal:s})})},wa=()=>{const{currentTheme:t}=ee(),{currentLanguage:s}=X(),{formData:r}=fs(),l=O.useCallback(i=>{try{return new Intl.NumberFormat(s==="fr"?"fr-FR":"en-US",{style:"currency",currency:"EUR"}).format(i)}catch{return String(i??0)}},[s]),{pnlBrut:n,totalFees:o,pnlNet:a,accountPercentage:c}=O.useMemo(()=>{const i=parseFloat(r.entryPrice?.toString()||"0"),d=parseFloat(r.exitPrice?.toString()||"0"),u=parseFloat(r.quantity?.toString()||"0"),m=parseFloat(r.tickSize?.toString()||"0"),p=parseFloat(r.tickValue?.toString()||"0"),x=r.side,f=r.market,g=x==="short"?-1:1;let h=null;if(i>0&&d>0&&u>0)if(f==="futures"&&m>0){const R=p/m;h=(d-i)*R*u*g}else h=(d-i)*u*g;const y=r||{},j=parseFloat((y.fees_commission??0).toString()),v=parseFloat((y.fees_spread_slippage??0).toString()),N=parseFloat((y.fees_swap_overnight??0).toString()),S=parseFloat((y.fees_other??0).toString()),w=j+v+N+S,k=h!==null?h+w:null,C=k!==null?k/1e4*100:null;return{pnlBrut:h,totalFees:w,pnlNet:k,accountPercentage:C}},[r]);return e.jsx(ql,{currentTheme:t,currentLanguage:s,pnlBrut:n,totalFees:o,pnlNet:a,accountPercentage:c,formatCurrency:l})};function We(t){const s=zt(O.useCallback(n=>n.formData[t],[t])),r=zt(n=>n.updateField),l=O.useCallback(n=>r(t,n),[r,t]);return[s,l]}const cx=()=>{const{currentTheme:t}=ee(),{currentLanguage:s}=X(),[r,l]=We("ticksGained"),[n,o]=We("tickValue"),[a,c]=We("quantity"),[i,d]=We("pnl"),[u,m]=We("pnlPercentage"),[p]=We("pnlEntryMode"),[x]=We("pnlMode"),f=zt(w=>w.settings?.equity),g=(w,k=.01)=>M=>{const C=M.target.value.replace(",",".");if(C.trim()==="")return w("");const R=Number(C);Number.isNaN(R)||w(R)},h=w=>{try{return new Intl.NumberFormat(s==="fr"?"fr-FR":"en-US",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(w)}catch{return String(w??0)}},y=typeof r=="number"?r:Number(r),j=typeof n=="number"?n:Number(n),v=typeof a=="number"?a:Number(a),N=Number.isFinite(y)&&Number.isFinite(j)&&Number.isFinite(v)&&String(r??"").toString()!==""&&String(n??"").toString()!==""&&String(a??"").toString()!=="",S=(y||0)*(j||0)*(v||0);return O.useEffect(()=>{if(N&&p==="direct"&&x==="absolute"&&S!==(typeof i=="number"?i:Number(i))&&d(S),N&&p==="direct"&&x==="percentage"){const w=Number(f);if(Number.isFinite(w)&&w!==0){const k=S/w*100;k!==(typeof u=="number"?u:Number(u))&&m(k)}}},[N,S,p,x]),e.jsxs("div",{className:"rounded-lg border p-2",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-0.5",style:{color:t.colors.textMuted},children:"Ticks"}),e.jsx("input",{type:"number",step:"0.25",value:r??"",onChange:g(l,.25),placeholder:"Ex: 12.5",className:"w-full px-2 py-0.5 text-sm border rounded focus:outline-none focus:ring-1 transition-colors",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-0.5",style:{color:t.colors.textMuted},children:s==="fr"?"Valeur/Tick":"Value/Tick"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",value:n??"",onChange:g(o,.01),placeholder:"Ex: 12.5",className:"w-full px-2 py-0.5 pr-8 text-sm border rounded focus:outline-none focus:ring-1 transition-colors",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}}),e.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs",style:{color:t.colors.textMuted},children:"EUR"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-0.5",style:{color:t.colors.textMuted},children:s==="fr"?"QuantitÃ©":"Quantity"}),e.jsx("input",{type:"number",step:"1",value:a??"",onChange:g(c,1),placeholder:"Ex: 1",className:"w-full px-2 py-0.5 text-sm border rounded focus:outline-none focus:ring-1 transition-colors",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}})]})]}),N&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg leading-tight",style:{backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs",style:{color:t.colors.textMuted},children:[s==="fr"?"Valeur totale des ticks":"Total ticks value",":"]}),e.jsx("span",{className:"font-bold",style:{color:(S||0)>=0?t.colors.success:t.colors.danger},children:h(S)})]}),e.jsx("div",{className:"text-xs mt-0.5 leading-tight",style:{color:t.colors.textMuted},children:s==="fr"?`Calcul: ${y} ticks Ã— ${j} EUR Ã— ${v||0} contrat${(v||0)>1?"s":""}`:`Calculation: ${y} ticks Ã— ${j} EUR Ã— ${v||0} contract${(v||0)>1?"s":""}`})]})]})},dx=({formData:t,updateFieldGlobal:s})=>{const{currentTheme:r}=ee(),{currentLanguage:l}=X(),[n,o]=O.useState(null),a=m=>{const[p="0",x="0",f="0"]=(m||"").split(":"),g=(h,y)=>{const j=parseInt(h,10);return Number.isNaN(j)?0:Math.max(0,Math.min(y,j))};return{hours:g(p,23),minutes:g(x,59),seconds:g(f,59)}},{hours:c,minutes:i,seconds:d}=a(t?.exitTime),u=(m,p,x)=>{const f=String(Math.max(0,Math.min(23,m))).padStart(2,"0"),g=String(Math.max(0,Math.min(59,p))).padStart(2,"0"),h=String(Math.max(0,Math.min(59,x))).padStart(2,"0");s&&s("exitTime",`${f}:${g}:${h}`)};return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx("div",{className:"relative",children:e.jsx(gs,{id:"exit-date-input",name:"exitDate",value:t?.exitDate||"",onChange:m=>s&&s("exitDate",m),placeholder:l==="fr"?"jj/mm/aaaa":"mm/dd/yyyy",className:"w-full",size:"compact"})})}),e.jsx("div",{children:e.jsx(Zo,{currentTheme:r,currentLanguage:l,errors:{},hours:c,minutes:i,seconds:d,active:n,setActive:o,updateTime:u,hideExitTimeLabel:!0})})]})},ux=O.createContext(null);function hr(){const t=O.useContext(ux);return t||{register:(s,r)=>()=>{},open:s=>{try{const r=window.__v3OverlayOpeners;if(r&&typeof r[s]=="function")return r[s](),!0;const l=new CustomEvent("v3-open-overlay",{detail:{fieldId:s}});return window.dispatchEvent(l),!0}catch{}return!1}}}const Sa="v3_form_preferences";function mx(){try{const t=localStorage.getItem(Sa);if(!t)return{isEditMode:!1,hiddenFields:{},hiddenSections:[],sectionPrefs:{}};const s=JSON.parse(t);return{isEditMode:!!s.isEditMode,hiddenFields:s.hiddenFields||{},hiddenSections:s.hiddenSections||[],sectionPrefs:s.sectionPrefs||{}}}catch{return{isEditMode:!1,hiddenFields:{},hiddenSections:[],sectionPrefs:{}}}}let vr=null;function xx(t){try{vr!==null&&typeof window<"u"&&window.clearTimeout(vr),vr=typeof window<"u"?window.setTimeout(()=>{try{localStorage.setItem(Sa,JSON.stringify(t))}catch{}vr=null},200):null}catch{}}const Qe=oo((t,s)=>{const r=mx(),l=n=>{const o={isEditMode:n.isEditMode??s().isEditMode,hiddenFields:n.hiddenFields??s().hiddenFields,hiddenSections:n.hiddenSections??s().hiddenSections,sectionPrefs:n.sectionPrefs??s().sectionPrefs};xx(o)};return{isEditMode:r.isEditMode,hiddenFields:r.hiddenFields,hiddenSections:r.hiddenSections,sectionPrefs:r.sectionPrefs,setEditMode:n=>{t({isEditMode:n}),l({isEditMode:n})},isFieldHidden:(n,o)=>(s().hiddenFields[n]||[]).includes(String(o)),toggleFieldHidden:(n,o)=>{t(a=>{const c={...a.hiddenFields},i=new Set(c[n]||[]),d=String(o);i.has(d)?i.delete(d):i.add(d),c[n]=Array.from(i);const u={hiddenFields:c};return l(u),u})},isSectionHidden:n=>s().hiddenSections.includes(n),toggleSectionHidden:n=>{t(o=>{const a=new Set(o.hiddenSections);a.has(n)?a.delete(n):a.add(n);const c={hiddenSections:Array.from(a)};return l(c),c})},unhideAllFieldsInSection:n=>{t(o=>{const a={...o.hiddenFields};a[n]&&delete a[n];const c={hiddenFields:a};return l(c),c})},unhideAllFields:()=>{t(()=>{const n={hiddenFields:{}};return l(n),n})},resetPreferences:()=>{t({hiddenFields:{},hiddenSections:[],sectionPrefs:{},isEditMode:!1}),l({hiddenFields:{},hiddenSections:[],sectionPrefs:{},isEditMode:!1})},getSectionPref:(n,o,a)=>{const c=s().sectionPrefs[n];if(!c)return a;const i=c[o];return i===void 0?a:i},setSectionPref:(n,o,a)=>{t(c=>{const i={...c.sectionPrefs},d={...i[n]||{}};d[o]=a,i[n]=d;const u={sectionPrefs:i};return l(u),u})}}}),Ca="trading-journal-trades";function Pa(){try{const t=window.localStorage.getItem(Ca);return t?JSON.parse(t):[]}catch{return[]}}function fx(t){try{window.localStorage.setItem(Ca,JSON.stringify(t))}catch{}}function px(t){const s=Pa();s.push(t),fx(s)}function js(){return Pa()}const hx=()=>{const{currentTheme:t}=ee(),{currentLanguage:s,t:r}=X(),[l,n]=We("symbol"),o=zt(T=>T.formData.market),[a,c]=O.useState(!1),[i,d]=O.useState(""),{register:u}=hr();O.useEffect(()=>u("symbol",()=>c(!0)),[u]);const m=O.useRef(null),p=O.useMemo(()=>({futures:["ES","NQ","YM","CL","GC","SI","ZB","ZN","NG","HO","RB","PL","PA","HG"],forex:["EURUSD","GBPUSD","USDJPY","AUDUSD","EURGBP","EURJPY","GBPJPY","USDCAD","NZDUSD","USDCHF"],crypto:["BTCUSD","ETHUSD","ADAUSD","SOLUSD","BTCUSDT","ETHUSDT","ADAUSDT","SOLUSDT","DOTUSD","LINKUSD"],stocks:["AAPL","MSFT","GOOGL","TSLA","AMZN","NVDA","META","NFLX","AMD","INTC"],indices:["SPX","NDX","DJI","RUT","VIX","SPY","QQQ","IWM","VXX"],commodities:["CL","GC","SI","NG","HO","RB","PL","PA","HG","ZC","ZS","ZW"]}),[]),[x,f]=O.useState(()=>{try{return JSON.parse(localStorage.getItem("favorite-symbols")||"[]")}catch{return[]}}),[g,h]=O.useState(()=>{try{return JSON.parse(localStorage.getItem(`custom-symbols-${o}`)||"[]")}catch{return[]}});O.useEffect(()=>{try{h(JSON.parse(localStorage.getItem(`custom-symbols-${o}`)||"[]"))}catch{h([])}},[o]);const y=O.useMemo(()=>(o?p[o]||[]:[]).filter(E=>!x.includes(E)&&!g.includes(E)),[o,p,x,g]),j=O.useMemo(()=>{try{const T=js()||[],E=String(o||""),L=[],U=new Set;for(let A=T.length-1;A>=0&&L.length<5;A--){const F=T[A]||{},q=String(F.symbol||"").toUpperCase();q&&(E&&F.market&&String(F.market).toLowerCase()!==E.toLowerCase()||U.has(q)||(U.add(q),L.push(q)))}let _=[];try{_=JSON.parse(localStorage.getItem("symbol-recent")||"[]")||[]}catch{_=[]}const B=o&&p[o]||[],z=_.map(A=>String(A||"").toUpperCase()).filter(A=>!!A).filter(A=>!U.has(A)).filter(A=>o?B.includes(A)||g.includes(A):!0);for(const A of z){if(L.length>=5)break;U.add(A),L.push(A)}return L}catch{return[]}},[o,g,p]),v=O.useMemo(()=>{const T=o&&p[o]||[],E=x.filter(U=>T.includes(U)||g.includes(U));return(E.length>0?E:x).slice(0,5)},[x,o,p,g]),N=O.useCallback((T,E)=>{const L=(E||"").trim().toLowerCase();return L?T.filter(U=>U.toLowerCase().includes(L)):T},[]),S=O.useMemo(()=>N(x,i),[x,i,N]),w=O.useMemo(()=>N(y,i),[y,i,N]),k=O.useMemo(()=>N(g,i),[g,i,N]),M=T=>{n(T),c(!1),d("")},C=T=>{const E=x.includes(T)?x.filter(L=>L!==T):[...x,T];f(E);try{localStorage.setItem("favorite-symbols",JSON.stringify(E))}catch{}},R=T=>{const E=(T||"").trim().toUpperCase();if(!E||g.includes(E))return;const L=[...g,E];h(L);try{localStorage.setItem(`custom-symbols-${o}`,JSON.stringify(L))}catch{}},P=T=>{const E=g.filter(L=>L!==T);h(E);try{localStorage.setItem(`custom-symbols-${o}`,JSON.stringify(E))}catch{}},D=O.useMemo(()=>`Symboles (${{futures:"Futures",forex:"Forex",stocks:s==="fr"?"Actions":"Stocks",indices:"Indices",crypto:"Crypto",commodities:s==="fr"?"MatiÃ¨res PremiÃ¨res":"Commodities"}[String(o)]||o||"Market"})`,[o,s]);return e.jsxs("div",{ref:m,className:"w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:l||"",onChange:T=>n(T.target.value.toUpperCase()),placeholder:"Ex: EURUSD, AAPL...",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}}),e.jsx("button",{type:"button",onClick:()=>c(!0),className:"px-3 py-2 border rounded-lg",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text},"data-overlay-trigger":"true",children:"â€¦"})]}),(v.length>0||j.length>0)&&e.jsxs("div",{className:"mt-2 space-y-2",children:[v.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] font-medium",style:{color:t.colors.textMuted},children:s==="fr"?"Favoris":"Favorites"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:v.slice(0,5).map(T=>e.jsx("button",{type:"button",onMouseDown:E=>{E.preventDefault(),M(T)},className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text},title:s==="fr"?"Favori":"Favorite",children:T},`fav-${T}`))})]}),j.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] font-medium",style:{color:t.colors.textMuted},children:s==="fr"?"RÃ©cents":"Recent"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j.slice(0,5).map(T=>e.jsx("button",{type:"button",onMouseDown:E=>{E.preventDefault(),M(T)},className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text},title:s==="fr"?"RÃ©cent":"Recent",children:T},`rec-${T}`))})]})]}),e.jsx(Kr,{isOpen:a,onClose:()=>c(!1),theme:t,t1:T=>r&&r[T]||T.replace(/_/g," "),symbolSearch:i,onChangeSearch:d,onAddCustomSymbol:R,favoriteSymbols:x,filteredFavorites:S,filteredMarketSymbols:w,filteredCustomSymbols:k,currentSelectedSymbol:l,marketLabel:D,onSelectSymbol:M,onToggleFavorite:C,onRemoveCustomSymbol:P,draggedItem:null,dragOverIndex:null,onDragStart:()=>{},onDragOver:()=>{},onDragLeave:()=>{},onDrop:()=>{},onDragEnd:()=>{}})]})},gx=()=>{const{currentTheme:t}=ee(),{currentLanguage:s}=X(),[r,l]=We("timeframe"),[n,o]=O.useState(!1),{register:a}=hr();O.useEffect(()=>a("timeframe",()=>o(!0)),[a]);const[c,i]=O.useState(()=>{try{return JSON.parse(localStorage.getItem("timeframe-favorites")||"[]")}catch{return[]}}),[d,u]=O.useState(0),m=O.useMemo(()=>{try{const x=new Set,f=[],g=js()||[];for(let y=g.length-1;y>=0&&f.length<5;y--){const j=g[y]||{},v=String(j.timeframe||"").trim();if(!v)continue;const N=v.toLowerCase();x.has(N)||(x.add(N),f.push(v))}let h=[];try{h=JSON.parse(localStorage.getItem("timeframe-recent")||"[]")}catch{h=[]}for(const y of h){if(f.length>=5)break;const j=String(y||"").trim();if(!j)continue;const v=j.toLowerCase();x.has(v)||(x.add(v),f.push(j))}return f}catch{return[]}},[d]),p=O.useRef(n);return O.useEffect(()=>{if(p.current&&!n){try{const x=JSON.parse(localStorage.getItem("timeframe-favorites")||"[]");i(Array.isArray(x)?x:[])}catch{i([])}u(x=>x+1)}p.current=n},[n]),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:r||"",onChange:x=>l(x.target.value),placeholder:"1m, 5m, 1h, 50t...",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text}}),e.jsx("button",{type:"button",onClick:()=>o(!0),className:"px-3 py-2 border rounded-lg",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text},title:s==="fr"?"Choisir dans la liste":"Choose from list","data-overlay-trigger":"true",children:"â€¦"})]}),(c.length>0||m.length>0)&&e.jsxs("div",{className:"mt-2 space-y-2",children:[c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] font-medium",style:{color:t.colors.textMuted},children:s==="fr"?"Favoris":"Favorites"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.slice(0,5).map(x=>e.jsx("button",{type:"button",onMouseDown:f=>{f.preventDefault(),l(x)},className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text},title:s==="fr"?"Favori":"Favorite",children:x},`tf-fav-${x}`))})]}),m.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] font-medium",style:{color:t.colors.textMuted},children:s==="fr"?"RÃ©cents":"Recent"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.slice(0,5).map(x=>e.jsx("button",{type:"button",onMouseDown:f=>{f.preventDefault(),l(x)},className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:t.colors.surface,borderColor:t.colors.border,color:t.colors.text},title:s==="fr"?"RÃ©cent":"Recent",children:x},`tf-rec-${x}`))})]})]}),e.jsx(Jr,{isOpen:n,onClose:()=>o(!1),onSelect:x=>{l(x),o(!1)},currentValue:r})]})},yx=()=>{const{currentTheme:t}=ee(),{currentLanguage:s}=X(),[r,l]=We("strategy"),[n,o]=O.useState(!1),[a,c]=O.useState(!1),{register:i}=hr();return O.useEffect(()=>i("strategy",()=>{c(!0),o(!0)}),[i]),e.jsxs(e.Fragment,{children:[e.jsx(en,{currentTheme:t,currentLanguage:s,value:r,onChange:d=>l(d),onSelect:d=>l(d),filteredStrategies:[],previousStrategies:[],favoriteNames:[],error:void 0,showDropdown:n,setShowDropdown:o,onOpenModal:()=>c(!0),hideLabel:!0}),a&&e.jsx(rn,{onSelect:d=>{l(d),c(!1)},onClose:()=>c(!1),currentValue:r||""})]})},bx=()=>{const{currentTheme:t}=ee(),{currentLanguage:s}=X(),[r,l]=We("setup"),[n,o]=O.useState(""),[a,c]=O.useState(!1),{register:i}=hr();O.useEffect(()=>i("setup",()=>c(!0)),[i]);const d=O.useMemo(()=>{try{const p=js()||[],x=new Set;for(let f=p.length-1;f>=0;f--){const g=String(p[f]?.setup||"").trim();g&&x.add(g)}return Array.from(x)}catch{return[]}},[]),u=O.useMemo(()=>_l(n,d),[n,d]),m=O.useMemo(()=>Wl(d,5),[d]);return e.jsx(tn,{currentTheme:t,currentLanguage:s,value:r,onChange:p=>l(p),search:n,setSearch:o,filteredSetups:u,quickSetups:m,error:void 0,showDropdown:a,setShowDropdown:c,hideLabel:!0})},vx=()=>{const[t,s]=We("entryPrice"),{currentLanguage:r}=X(),[l,n]=O.useState(()=>t===""||t==null?"":String(t));O.useEffect(()=>{if((t===""||t==null)&&l!=="")n("");else if(typeof t=="number"){const i=String(t);l!==i&&!l.endsWith(".")&&n(i)}},[t]);const o=i=>{const d=i.replace(",",".");if(d.trim()===""){s("");return}if(/^-?\d+(\.\d+)?$/.test(d)){const u=Number(d);Number.isNaN(u)||s(u)}},a=i=>{const d=i.target.value;n(d),o(d)},c=()=>{const i=l.replace(",",".").replace(/\.$/,"");if(n(i),i.trim()==="")s("");else{const d=Number(i);Number.isNaN(d)||s(d)}};return e.jsx("input",{type:"text",value:l,onChange:a,onBlur:c,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",placeholder:"Ex: 4250.50"})},jx=()=>{const[t,s]=We("quantity"),{currentLanguage:r}=X(),l=n=>{const o=n.target.value.replace(/[^0-9]/g,"");if(o==="")return s("");const a=Number(o);Number.isNaN(a)||s(a)};return e.jsx("input",{type:"text",value:t??"",onChange:l,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",inputMode:"numeric",placeholder:"Ex: 1"})},Nx=()=>{const[t,s]=We("exitPrice"),{currentLanguage:r}=X(),[l,n]=O.useState(()=>t===""||t==null?"":String(t));O.useEffect(()=>{if((t===""||t==null)&&l!=="")n("");else if(typeof t=="number"){const i=String(t);l!==i&&!l.endsWith(".")&&n(i)}},[t]);const o=i=>{const d=i.replace(",",".");if(d.trim()===""){s("");return}if(/^-?\d+(\.\d+)?$/.test(d)){const u=Number(d);Number.isNaN(u)||s(u)}},a=i=>{const d=i.target.value;n(d),o(d)},c=()=>{const i=l.replace(",",".").replace(/\.$/,"");if(n(i),i.trim()==="")s("");else{const d=Number(i);Number.isNaN(d)||s(d)}};return e.jsx("input",{type:"text",value:l,onChange:a,onBlur:c,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",placeholder:"Ex: 4300.50"})},kx=()=>{const[t,s]=We("stopPrice"),{currentLanguage:r}=X(),[l,n]=O.useState(()=>t===""||t==null?"":String(t));O.useEffect(()=>{if((t===""||t==null)&&l!=="")n("");else if(typeof t=="number"){const i=String(t);l!==i&&!l.endsWith(".")&&n(i)}},[t]);const o=i=>{const d=i.replace(",",".");if(d.trim()===""){s("");return}if(/^-?\d+(\.\d+)?$/.test(d)){const u=Number(d);Number.isNaN(u)||s(u)}},a=i=>{const d=i.target.value;n(d),o(d)},c=()=>{const i=l.replace(",",".").replace(/\.$/,"");if(n(i),i.trim()==="")s("");else{const d=Number(i);Number.isNaN(d)||s(d)}};return e.jsx("input",{type:"text",value:l,onChange:a,onBlur:c,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",placeholder:"Ex: 4200.00"})},wx=()=>{const[t,s]=We("takeProfitPrice"),{currentLanguage:r}=X(),[l,n]=O.useState(()=>t===""||t==null?"":String(t));O.useEffect(()=>{if((t===""||t==null)&&l!=="")n("");else if(typeof t=="number"){const i=String(t);l!==i&&!l.endsWith(".")&&n(i)}},[t]);const o=i=>{const d=i.replace(",",".");if(d.trim()===""){s("");return}if(/^-?\d+(\.\d+)?$/.test(d)){const u=Number(d);Number.isNaN(u)||s(u)}},a=i=>{const d=i.target.value;n(d),o(d)},c=()=>{const i=l.replace(",",".").replace(/\.$/,"");if(n(i),i.trim()==="")s("");else{const d=Number(i);Number.isNaN(d)||s(d)}};return e.jsx("input",{type:"text",value:l,onChange:a,onBlur:c,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",placeholder:"Ex: 4300.00"})},Sx=()=>{const[t,s]=We("pnl"),[r,l]=We("pnlMode"),{currentLanguage:n}=X(),{currentTheme:o}=ee(),a=zt(p=>p.settings?.equity),[c,i]=O.useState(()=>t===""||t==null?"":String(t));O.useEffect(()=>{if((t===""||t==null)&&c!=="")i("");else if(typeof t=="number"){const p=String(t);c!==p&&!c.endsWith(".")&&i(p)}},[t]);const d=p=>{const x=p.replace(",",".");if(x.trim()===""){s("");return}if(/^-?\d+(\.\d+)?$/.test(x)){const f=Number(x);Number.isNaN(f)||s(f)}},u=p=>{const x=p.target.value;i(x),d(x)},m=()=>{const p=c.replace(",",".").replace(/\.$/,"");if(i(p),p.trim()==="")s("");else{const x=Number(p);Number.isNaN(x)||s(x)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:c,onChange:u,onBlur:m,className:"w-full px-3 py-2 pr-16 border rounded-lg focus:outline-none focus:ring-2",placeholder:"Ex: 150"}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>l("absolute"),className:"px-2 py-0.5 text-xs rounded border",style:{backgroundColor:r==="absolute"?o.colors.accent:o.colors.surface,color:r==="absolute"?"#ffffff":o.colors.text,borderColor:o.colors.border},title:n==="fr"?"Montant (â‚¬)":"Amount (â‚¬)",children:"â‚¬"}),e.jsx("button",{type:"button",onClick:()=>l("percentage"),className:"px-2 py-0.5 text-xs rounded border",style:{backgroundColor:r==="percentage"?o.colors.accent:o.colors.surface,color:r==="percentage"?"#ffffff":o.colors.text,borderColor:o.colors.border},title:n==="fr"?"Pourcentage (%)":"Percentage (%)",children:"%"})]})]}),(()=>{const p=Number(a),x=typeof t=="number"?t:NaN;if(!Number.isFinite(x)||!Number.isFinite(p)||p<=0)return null;const f=x/p*100,g=f>=0?o.colors.success:o.colors.danger,h=f>0?"+":"";return e.jsx("div",{className:"mt-1 text-xs",style:{color:g},children:`${h}${f.toFixed(2)}%`})})()]})},Cx=()=>{const[t,s]=We("pnlPercentage"),[r,l]=We("pnlMode"),{currentLanguage:n}=X(),{currentTheme:o}=ee(),a=zt(p=>p.settings?.equity),[c,i]=O.useState(()=>t===""||t==null?"":String(t));O.useEffect(()=>{if((t===""||t==null)&&c!=="")i("");else if(typeof t=="number"){const p=String(t);c!==p&&!c.endsWith(".")&&i(p)}},[t]);const d=p=>{const x=p.replace(",",".");if(x.trim()===""){s("");return}if(/^-?\d+(\.\d+)?$/.test(x)){const f=Number(x);Number.isNaN(f)||s(f)}},u=p=>{const x=p.target.value;i(x),d(x)},m=()=>{const p=c.replace(",",".").replace(/\.$/,"");if(i(p),p.trim()==="")s("");else{const x=Number(p);Number.isNaN(x)||s(x)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:c,onChange:u,onBlur:m,className:"w-full px-3 py-2 pr-16 border rounded-lg focus:outline-none focus:ring-2",placeholder:"Ex: 2.5"}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>l("absolute"),className:"px-2 py-0.5 text-xs rounded border",style:{backgroundColor:r==="absolute"?o.colors.accent:o.colors.surface,color:r==="absolute"?"#ffffff":o.colors.text,borderColor:o.colors.border},title:n==="fr"?"Montant (â‚¬)":"Amount (â‚¬)",children:"â‚¬"}),e.jsx("button",{type:"button",onClick:()=>l("percentage"),className:"px-2 py-0.5 text-xs rounded border",style:{backgroundColor:r==="percentage"?o.colors.accent:o.colors.surface,color:r==="percentage"?"#ffffff":o.colors.text,borderColor:o.colors.border},title:n==="fr"?"Pourcentage (%)":"Percentage (%)",children:"%"})]})]}),(()=>{const p=Number(a),x=typeof t=="number"?t:NaN;if(!Number.isFinite(x)||!Number.isFinite(p))return null;const f=p*x/100,g=f>=0?o.colors.success:o.colors.danger;try{const h=new Intl.NumberFormat(n==="fr"?"fr-FR":"en-US",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(f);return e.jsx("div",{className:"mt-1 text-xs",style:{color:g},children:h})}catch{return e.jsx("div",{className:"mt-1 text-xs",style:{color:g},children:String(f)})}})()]})},Px=()=>{const[t,s]=We("fees_commission"),{currentLanguage:r}=X(),l=n=>{const o=n.target.value.replace(",",".");if(o.trim()==="")return s("");const a=Number(o);Number.isNaN(a)||s(a)};return e.jsx("input",{type:"text",value:t??"",onChange:l,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",placeholder:"-2.5"})},Mx=()=>{const[t,s]=We("fees_spread_slippage"),{currentLanguage:r}=X(),l=n=>{const o=n.target.value.replace(",",".");if(o.trim()==="")return s("");const a=Number(o);Number.isNaN(a)||s(a)};return e.jsx("input",{type:"text",value:t??"",onChange:l,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",placeholder:"-1.2"})},Rx=()=>{const[t,s]=We("fees_swap_overnight"),{currentLanguage:r}=X(),l=n=>{const o=n.target.value.replace(",",".");if(o.trim()==="")return s("");const a=Number(o);Number.isNaN(a)||s(a)};return e.jsx("input",{type:"text",value:t??"",onChange:l,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",placeholder:"-0.5"})},Tx=()=>{const[t,s]=We("fees_other"),{currentLanguage:r}=X(),l=n=>{const o=n.target.value.replace(",",".");if(o.trim()==="")return s("");const a=Number(o);Number.isNaN(a)||s(a)};return e.jsx("input",{type:"text",value:t??"",onChange:l,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",placeholder:"-0.25"})},Dx=({value:t,onChange:s,className:r,size:l})=>{const{currentLanguage:n}=X();return e.jsx(gs,{id:"v3-date-input",value:t||"",onChange:o=>s(o),placeholder:n==="fr"?"jj/mm/aaaa":"mm/dd/yyyy",className:r||"w-full",size:l||"compact"})},Ex=({value:t,onChange:s})=>e.jsx("input",{type:"text",value:t??"",onChange:r=>{const l=r.target.value.replace(",",".");if(l.trim()==="")return s("");const n=Number(l);Number.isNaN(n)||s(n)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2"}),Fx=({value:t,onChange:s})=>{const r=typeof t=="string"?t:"",l=n=>{const o=n.split(":").map(p=>p.padStart(2,"0")).slice(0,3);for(;o.length<3;)o.push("00");const[a,c,i]=o.map(p=>p.replace(/[^0-9]/g,"")),d=String(Math.min(23,parseInt(a||"0"))).padStart(2,"0"),u=String(Math.min(59,parseInt(c||"0"))).padStart(2,"0"),m=String(Math.min(59,parseInt(i||"0"))).padStart(2,"0");return`${d}:${u}:${m}`};return e.jsx("input",{type:"text",value:r,placeholder:"HH:mm:ss",onChange:n=>s(l(n.target.value)),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2"})},Ax=({value:t,onChange:s})=>e.jsx("input",{type:"text",value:t??"",onChange:r=>s(r.target.value),className:"w-full px-3 py-2 border rounded"}),Lx=({value:t,onChange:s})=>e.jsx("textarea",{value:t??"",onChange:r=>s(r.target.value),className:"w-full px-3 py-2 border rounded min-h-[100px]"}),$x=({value:t,onChange:s})=>e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!t,onChange:r=>s(r.target.checked)}),e.jsx("span",{children:"Oui"})]}),Ix=({value:t=[],onChange:s})=>{const{currentTheme:r}=ee(),{currentLanguage:l}=X(),n=C=>(C||[]).join(", "),o=C=>C.split(/[,\n\s]+/).map(R=>R.trim()).filter(Boolean),[a,c]=O.useState(n(t)),[i,d]=O.useState(!1);O.useEffect(()=>{c(n(t))},[t]);const[u,m]=O.useState(()=>{try{const C=JSON.parse(localStorage.getItem("tags-recent")||"[]");if(Array.isArray(C)&&C.length)return C}catch{}try{const C=js()||[],R=new Set;for(const D of C){const T=D.tags;if(Array.isArray(T))for(const E of T){const L=String(E||"").trim();L&&R.add(L)}}const P=Array.from(R).slice(0,50);try{localStorage.setItem("tags-recent",JSON.stringify(P))}catch{}return P}catch{return[]}}),p=O.useRef(null),[x,f]=O.useState(!1),[g,h]=O.useState(0),y=O.useMemo(()=>{const C=(a||"").split(/[,\n\s]+/).map(R=>R.trim()).filter(Boolean);return C[C.length-1]||""},[a]),j=O.useMemo(()=>{const C=new Set(t||[]),R=(y||"").toLowerCase(),P=(u||[]).filter(T=>!C.has(T));return(R?P.filter(T=>T.toLowerCase().includes(R)):P).slice(0,8)},[u,t,y]),v=O.useMemo(()=>{try{return js()||[]}catch{return[]}},[]),N=O.useMemo(()=>{const C={};for(const R of v){const P=R.tags;if(Array.isArray(P))for(const D of P){const T=String(D||"").trim();T&&(C[T]=(C[T]||0)+1)}}return C},[v]);O.useEffect(()=>{const C=R=>{const P=p.current;P&&!P.contains(R.target)&&f(!1)};return document.addEventListener("mousedown",C,!0),()=>document.removeEventListener("mousedown",C,!0)},[]);const S=C=>{const R=C.target.value;c(R),s&&s(o(R)),f(!0),h(0)},w=C=>{if(!s)return;const R=new Set(t||[]);R.add(C);const P=Array.from(R);s(P),c(n(P))},k=()=>{const C=(a||"").split(/[,\n\s]+/).map(P=>P.trim()).filter(Boolean),R=C[C.length-1];if(R&&s){const P=new Set(t||[]);P.add(R);const D=Array.from(P);s(D),c(n(D));try{const T=JSON.parse(localStorage.getItem("tags-recent")||"[]"),E=Array.isArray(T)?Array.from(new Set([R,...T])).slice(0,50):[R];localStorage.setItem("tags-recent",JSON.stringify(E)),m(E)}catch{}}},M=C=>{if(!x&&(C.key==="ArrowDown"||C.key==="ArrowUp")){f(!0);return}if(C.key==="ArrowDown")C.preventDefault(),h(R=>Math.min(R+1,Math.max(0,j.length-1)));else if(C.key==="ArrowUp")C.preventDefault(),h(R=>Math.max(R-1,0));else if(C.key==="Enter")if(x&&j.length>0){C.preventDefault();const R=j[Math.max(0,Math.min(g,j.length-1))];R&&(w(R),f(!1))}else C.preventDefault(),k();else C.key==="Escape"&&f(!1)};return e.jsxs("div",{children:[e.jsxs("div",{ref:p,className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:a,onChange:S,onFocus:()=>f(!0),onKeyDown:M,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",style:{backgroundColor:r.colors.surface,borderColor:r.colors.border,color:r.colors.text},placeholder:"tag1, tag2"}),e.jsx("button",{type:"button",onClick:k,className:"px-3 py-2 rounded-lg text-sm",style:{backgroundColor:r.colors.accent,color:"#ffffff"},title:l==="fr"?"Ajouter":"Add",children:"+"}),e.jsx(zx,{onOpen:()=>d(!0),currentTheme:r,currentLanguage:l})]}),x&&j.length>0&&e.jsx("div",{className:"absolute z-20 mt-2 w-full rounded-md shadow-lg border",style:{backgroundColor:r.colors.card,borderColor:r.colors.border},children:e.jsx("div",{className:"max-h-60 overflow-y-auto py-1",children:j.map((C,R)=>{const P=R===g,D=N[C]||0;return e.jsxs("button",{type:"button",onMouseDown:T=>{T.preventDefault(),w(C),f(!1)},onMouseEnter:()=>h(R),className:"w-full text-left px-3 py-2 text-sm flex items-center justify-between",style:{backgroundColor:P?r.colors.surface:r.colors.card,color:r.colors.text,borderBottom:`1px solid ${r.colors.border}`},children:[e.jsx("span",{children:C}),D>0&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded-full",style:{backgroundColor:r.colors.accent+"20",color:r.colors.accent},children:D})]},C)})})})]}),u.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:u.map(C=>e.jsx("button",{type:"button",onMouseDown:R=>{R.preventDefault(),w(C)},className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:r.colors.surface,borderColor:r.colors.border,color:r.colors.text},children:C},C))}),i&&e.jsx(Bl,{isOpen:i,onClose:()=>{d(!1);try{const C=JSON.parse(localStorage.getItem("tags-recent")||"[]");Array.isArray(C)&&m(C)}catch{}},currentTheme:r,currentLanguage:l,allTags:u,existingTrades:js(),onDeleteTag:C=>{const R=u.filter(P=>P!==C);m(R);try{localStorage.setItem("tags-recent",JSON.stringify(R))}catch{}s&&(t||[]).includes(C)&&s((t||[]).filter(P=>P!==C))},onRenameTag:(C,R)=>{const P=(R||"").trim();if(!P||P===C)return;const D=Array.from(new Set(u.map(T=>T===C?P:T)));m(D);try{localStorage.setItem("tags-recent",JSON.stringify(D))}catch{}s&&(t||[]).includes(C)&&s((t||[]).map(T=>T===C?P:T))},onCleanupUnusedTags:()=>{const C=new Set;for(const P of js()){const D=P.tags;Array.isArray(D)&&D.forEach(T=>C.add(String(T)))}const R=u.filter(P=>C.has(P));m(R);try{localStorage.setItem("tags-recent",JSON.stringify(R))}catch{}}})]})},zx=({onOpen:t,currentTheme:s,currentLanguage:r})=>e.jsx("button",{type:"button",onClick:t,className:"px-3 py-2 border rounded-lg text-xs",style:{backgroundColor:s.colors.surface,borderColor:s.colors.border,color:s.colors.text},title:r==="fr"?"GÃ©rer les tags":"Manage tags",children:r==="fr"?"GÃ©rer":"Manage"}),Ox=({value:t=[],onChange:s})=>e.jsx("textarea",{value:(t??[]).join(`
`),onChange:r=>s&&s(r.target.value.split(`
`).map(l=>l.trim()).filter(Boolean)),className:"w-full px-3 py-2 border rounded min-h-[120px]",placeholder:`https://...
https://...`}),qx=O.lazy(()=>ns(()=>import("./NotesAndScreenshotsStep-BrkDteei.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),Ux=O.lazy(()=>ns(()=>import("./V3LeverageMarginSection-CECNOeYD.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url)),_x=O.lazy(()=>ns(()=>import("./V3FuturesParamsSection-CLGXK843.js"),__vite__mapDeps([6,1,2,3,4]),import.meta.url)),Wx=({value:t,onChange:s,formData:r})=>{const{currentTheme:l}=ee(),{currentLanguage:n}=X(),[o,a]=O.useState(!1),[c,i]=O.useState(""),d=[],u=[],m=[],p=[],x=[],f=g=>{s(g),a(!1),i("")};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:t||"",onChange:g=>s(g.target.value.toUpperCase()),placeholder:"Ex: EURUSD, AAPL...",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text}}),e.jsx("div",{className:"w-0 h-0 overflow-visible",children:e.jsx(Qo,{suggestions:x,favoriteSymbols:d,customSymbols:p,theme:l,onSelect:f,onToggleFavorite:()=>{},onRemoveCustom:()=>{}})}),e.jsx("button",{type:"button",onClick:()=>a(!0),className:"px-3 py-2 border rounded-lg",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},"data-overlay-trigger":"true",children:"â€¦"}),e.jsx(Kr,{isOpen:o,onClose:()=>a(!1),theme:l,t1:g=>g,symbolSearch:c,onChangeSearch:i,onAddCustomSymbol:()=>{},favoriteSymbols:d,filteredFavorites:u,filteredMarketSymbols:m,filteredCustomSymbols:p,currentSelectedSymbol:t,marketLabel:r?.market||"Market",onSelectSymbol:f,onToggleFavorite:()=>{},onRemoveCustomSymbol:()=>{},draggedItem:null,dragOverIndex:null,onDragStart:()=>{},onDragOver:()=>{},onDragLeave:()=>{},onDrop:()=>{},onDragEnd:()=>{}})]})},Vx=({value:t,onChange:s,formData:r})=>{const{currentTheme:l}=ee(),{currentLanguage:n}=X(),[o,a]=O.useState(!1),{register:c}=hr();return O.useEffect(()=>c("timeframe",()=>a(!0)),[c]),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:t||"",onChange:i=>s(i.target.value),placeholder:"1m, 5m, 1h, 50t...",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text}}),e.jsx("button",{type:"button",onClick:()=>a(!0),className:"px-3 py-2 border rounded-lg",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},title:n==="fr"?"Choisir dans la liste":"Choose from list","data-overlay-trigger":"true",children:"â€¦"}),e.jsx(Jr,{isOpen:o,onClose:()=>a(!1),onSelect:i=>{s(i),a(!1)},currentValue:t})]})},Oo={SymbolInputWrapper:Wx,TimeframeOverlayWrapper:Vx,DatePickerWrapper:Dx,NumberInput:Ex,TimeInputWrapper:Fx,EntryPriceFieldWrapper:vx,SymbolFieldWrapper:hx,TimeframeFieldWrapper:gx,TagsFieldWrapper:Ix,QuantityFieldWrapper:jx,ExitPriceFieldWrapper:Nx,StopPriceFieldWrapper:kx,TakeProfitPriceFieldWrapper:wx,PnlFieldWrapper:Sx,PnlPercentageFieldWrapper:Cx,FeesCommissionFieldWrapper:Px,FeesSpreadSlippageFieldWrapper:Mx,FeesSwapOvernightFieldWrapper:Rx,FeesOtherFieldWrapper:Tx,SectionTitle:({label:t})=>{const{currentTheme:s}=ee(),r=b.useMemo(()=>String(t||""),[t]);return e.jsx("div",{className:"mb-1",children:e.jsx("div",{className:"text-sm font-semibold",style:{color:s.colors.text},children:r})})},ExitDateTimeSectionWrapper:({formData:t,updateFieldGlobal:s})=>e.jsx(dx,{formData:t||{},updateFieldGlobal:s}),TextInputWrapper:Ax,TextAreaWrapper:Lx,CheckboxWrapper:$x,TradeResultSelectWrapper:({value:t,onChange:s})=>e.jsxs("select",{value:t??"",onChange:r=>s(r.target.value),className:"w-full px-3 py-2 border rounded",children:[e.jsx("option",{value:"",children:"â€”"}),e.jsx("option",{value:"win",children:"Win"}),e.jsx("option",{value:"loss",children:"Loss"}),e.jsx("option",{value:"be",children:"Break-even"})]}),TrendSelectWrapper:({value:t,onChange:s})=>e.jsxs("select",{value:t??"",onChange:r=>s(r.target.value),className:"w-full px-3 py-2 border rounded",children:[e.jsx("option",{value:"",children:"â€”"}),e.jsx("option",{value:"up",children:"Up"}),e.jsx("option",{value:"down",children:"Down"}),e.jsx("option",{value:"sideways",children:"Sideways"})]}),EmotionSelectWrapper:({value:t,onChange:s})=>e.jsxs("select",{value:t??"",onChange:r=>s(r.target.value),className:"w-full px-3 py-2 border rounded",children:[e.jsx("option",{value:"",children:"â€”"}),e.jsx("option",{value:"euphoria",children:"Euphorie"}),e.jsx("option",{value:"stress",children:"Stress"}),e.jsx("option",{value:"calm",children:"Calme"}),e.jsx("option",{value:"fatigue",children:"Fatigue"})]}),IntensitySliderWrapper:({value:t,onChange:s})=>e.jsx("input",{type:"range",min:0,max:10,value:Number(t??0),onChange:r=>s(Number(r.target.value)),className:"w-full"}),ScreenshotsListWrapper:Ox,EntryDateTimeSectionWrapper:({formData:t,updateFieldGlobal:s})=>{const r={},l=(n,o)=>s&&s(n,o);return e.jsx(Ol,{formData:t||{},onChange:l,errors:r,hideEntryDateLabel:!0,hideEntryTimeLabel:!0})},NotesAndScreenshotsStepWrapper:({formData:t,updateFieldGlobal:s})=>{const r={},l=(g,h)=>s&&s(g,h),n=Qe(g=>g.isEditMode),o=Qe(g=>g.hiddenFields),a=Qe(g=>g.toggleFieldHidden),c=g=>Array.isArray(g)?g:typeof g=="string"?g.split(/[,\n]/).map(h=>h.trim()).filter(Boolean):[],i=g=>Array.isArray(g)?g:[],d={...t||{},tags:c((t||{}).tags),screenshots:i((t||{}).screenshots)},u="notes-screenshots",m=o&&o[u]||[],p=g=>!m.includes(String(g)),x=g=>{typeof a=="function"&&a(u,String(g))},f=g=>!1;return e.jsx(O.Suspense,{fallback:e.jsx("div",{className:"h-24 rounded border"}),children:e.jsx(qx,{formData:d,onChange:l,errors:r,shouldShowField:p,toggleFieldVisibility:x,isObligatoryField:f,isEditMode:!!n})})},TradeResultSelectorWrapper:({value:t,onChange:s})=>{const{currentTheme:r}=ee(),{currentLanguage:l}=X();return e.jsx(Eo,{currentTheme:r,currentLanguage:l,value:t,onChange:n=>s(n),hideLabel:!0})},TradeResultFieldWrapper:()=>{const{currentTheme:t}=ee(),{currentLanguage:s}=X(),[r,l]=We("tradeResult");return e.jsx(Eo,{currentTheme:t,currentLanguage:s,value:r,onChange:n=>l(n),hideLabel:!0})},TrendSelectorWrapper:({value:t,onChange:s})=>{const{currentTheme:r}=ee(),{currentLanguage:l}=X();return e.jsx(Fo,{currentTheme:r,currentLanguage:l,value:t,onChange:n=>s(n),hideLabel:!0})},TrendFieldWrapper:()=>{const{currentTheme:t}=ee(),{currentLanguage:s}=X(),[r,l]=We("trend");return e.jsx(Fo,{currentTheme:t,currentLanguage:s,value:r,onChange:n=>l(n),hideLabel:!0})},RiskRewardInputWrapper:({value:t,onChange:s})=>{const{currentTheme:r}=ee(),{currentLanguage:l}=X();return e.jsx(Vl,{currentTheme:r,currentLanguage:l,value:t,onChange:n=>s(n),isEditMode:!1,hideLabel:!0})},StrategySelectorWrapper:({value:t,onChange:s})=>{const{currentTheme:r}=ee(),{currentLanguage:l}=X(),[n,o]=O.useState(!1),[a,c]=O.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(en,{currentTheme:r,currentLanguage:l,value:t,onChange:i=>s(i),onSelect:i=>s(i),filteredStrategies:[],previousStrategies:[],favoriteNames:[],error:void 0,showDropdown:n,setShowDropdown:o,onOpenModal:()=>c(!0),hideLabel:!0}),a&&e.jsx(rn,{onSelect:i=>{s(i),c(!1)},onClose:()=>c(!1),currentValue:t||""})]})},StrategyFieldWrapper:yx,SetupSelectorWrapper:({value:t,onChange:s})=>{const{currentTheme:r}=ee(),{currentLanguage:l}=X(),[n,o]=O.useState(""),[a,c]=O.useState(!1);return e.jsx(tn,{currentTheme:r,currentLanguage:l,value:t,onChange:i=>s(i),search:n,setSearch:o,filteredSetups:[],quickSetups:[],error:void 0,showDropdown:a,setShowDropdown:c,hideLabel:!0})},SetupFieldWrapper:bx,ExitTimeSelectorWrapper:({value:t,onChange:s})=>{const{currentTheme:r}=ee(),{currentLanguage:l}=X(),[n,o]=O.useState(null),a=m=>{const[p="0",x="0",f="0"]=(m||"").split(":"),g=(h,y)=>{const j=parseInt(h,10);return Number.isNaN(j)?0:Math.max(0,Math.min(y,j))};return{hours:g(p,23),minutes:g(x,59),seconds:g(f,59)}},{hours:c,minutes:i,seconds:d}=a(t),u=(m,p,x)=>{const f=String(Math.max(0,Math.min(23,m))).padStart(2,"0"),g=String(Math.max(0,Math.min(59,p))).padStart(2,"0"),h=String(Math.max(0,Math.min(59,x))).padStart(2,"0");s(`${f}:${g}:${h}`)};return e.jsx(Zo,{currentTheme:r,currentLanguage:l,errors:{},hours:c,minutes:i,seconds:d,active:n,setActive:o,updateTime:u,hideExitTimeLabel:!0})},SummaryPanelWrapper:()=>e.jsx(ka,{}),PnLSummaryWrapper:()=>e.jsx(wa,{}),TicksQuickWidgetWrapper:()=>e.jsx(cx,{}),LeverageMarginSectionWrapper:()=>e.jsx(O.Suspense,{fallback:e.jsx("div",{className:"h-24 rounded border"}),children:e.jsx(Ux,{})}),FuturesParamsSectionWrapper:()=>e.jsx(O.Suspense,{fallback:e.jsx("div",{className:"h-24 rounded border"}),children:e.jsx(_x,{})}),StatusToggleFieldWrapper:()=>{const{currentTheme:t}=ee(),{currentLanguage:s}=X(),[r,l]=We("status"),n=t.colors.accent,o=t.colors.surface,a=t.colors.text,c=t.colors.border;return e.jsx("div",{className:"flex gap-2",children:["open","closed"].map(i=>e.jsx("button",{onClick:()=>l(i),className:"gpu-btn flex-1 px-2 py-1 text-sm rounded-lg border",style:{backgroundColor:r===i?n:o,color:r===i?"#ffffff":a,borderColor:r===i?n:c},children:i==="open"?s==="fr"?"Ouvert":"Open":s==="fr"?"FermÃ©":"Closed"},i))})},SideToggleFieldWrapper:()=>{const{currentTheme:t}=ee(),{currentLanguage:s}=X(),[r,l]=We("side"),n=t.colors.accent,o=t.colors.surface,a=t.colors.text,c=t.colors.border;return e.jsx("div",{className:"flex gap-2",children:["long","short"].map(i=>e.jsx("button",{onClick:()=>l(i),className:"gpu-btn flex-1 px-2 py-1 text-sm rounded-lg border",style:{backgroundColor:r===i?n:o,color:r===i?"#ffffff":a,borderColor:r===i?n:c},children:i==="long"?"Long":"Short"},i))})},MarketSelectorFieldWrapper:()=>{const{currentTheme:t}=ee(),{currentLanguage:s}=X(),[r,l]=We("market"),n=["futures","forex","stocks","indices","crypto","commodities"],o=u=>({futures:"Futures",forex:"Forex",stocks:s==="fr"?"Actions":"Stocks",indices:"Indices",crypto:"Crypto",commodities:s==="fr"?"MatiÃ¨res PremiÃ¨res":"Commodities"})[u]||u,a=t.colors.accent,c=t.colors.surface,i=t.colors.text,d=t.colors.border;return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:n.map(u=>e.jsx("button",{onClick:()=>l(u),className:"gpu-btn w-full h-12 px-2 text-sm rounded-lg border text-center flex items-center justify-center",style:{backgroundColor:r===u?a:c,color:r===u?"#ffffff":i,borderColor:r===u?a:d,whiteSpace:"normal",wordBreak:"break-word",lineHeight:1.1},children:o(u)},u))})}},Ds=new Map;function Bx(t){return typeof t=="function"?`fn:${t.toString()}`:typeof t=="boolean"?`bool:${t}`:`str:${t??"undefined"}`}function et(t){if(t===void 0)return()=>!0;if(typeof t=="boolean")return()=>t;if(typeof t=="function")return u=>t(u);const s=Bx(t),r=Ds.get(s);if(r)return r;const l=String(t).trim();if(l.length===0||l.length>200){const u=()=>!0;return Ds.set(s,u),u}if(/[^\w\s\._'"=<>!&|()\-]/.test(l)){const u=()=>!0;return Ds.set(s,u),u}if(/(\bwindow\b|\bglobalThis\b|\bdocument\b|\bself\b|\bFunction\b|\beval\b|\bconstructor\b|\bthis\b|\bXMLHttpRequest\b|\bfetch\b|\bprocess\b|\brequire\b|\bimport\b|\bmodule\b|\bexports\b|\bsetTimeout\b|\bsetInterval\b|\bDate\b)/.test(l)){const u=()=>!0;return Ds.set(s,u),u}const c=(l.match(/\(/g)||[]).length,i=(l.match(/\)/g)||[]).length;if(c!==i){const u=()=>!0;return Ds.set(s,u),u}const d=u=>{try{const m=Object.keys(u),p=m.map(f=>u[f]);return!!new Function(...m,`return (${l});`)(...p)}catch{return!0}};return Ds.set(s,d),d}function Hx(t){const s=new Map;return r=>{const l=JSON.stringify(r);if(s.has(l))return s.get(l);const n=!!t(r);return s.set(l,n),n}}const Gx=({title:t,currentTheme:s,currentLanguage:r,layout:l,collapsed:n,onToggleCollapse:o,onOpenOptions:a})=>e.jsxs("div",{className:"flex items-center justify-between mb-3 relative",children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:s.colors.text},children:t}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:a,className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:s.colors.surface,borderColor:s.colors.border,color:s.colors.text},title:r==="fr"?"Options de section":"Section options",children:e.jsx(ss,{size:14})}),l!=="landscape"&&e.jsx("button",{type:"button",onClick:o,className:"gpu-btn px-2 py-1 text-xs rounded border",style:{backgroundColor:s.colors.surface,borderColor:s.colors.border,color:s.colors.text},children:n?r==="fr"?"DÃ©plier":"Expand":r==="fr"?"Replier":"Collapse"})]})]});function Jx(t){return t==null?!0:typeof t=="string"?t.trim()==="":typeof t=="number"?Number.isNaN(t):Array.isArray(t)?t.length===0:!1}const Ma=({fid:t,label:s,required:r,value:l,onReset:n,isEditMode:o,isProtected:a,isHidden:c,onToggleHidden:i,children:d})=>{const{currentTheme:u}=ee(),{currentLanguage:m}=X();return e.jsxs("div",{"data-field-container":t,children:[s&&e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("label",{className:"block text-sm font-semibold",style:{color:u.colors.text},children:s}),!Jx(l)&&e.jsx("button",{type:"button",onClick:n,className:"px-1.5 py-0.5 text-[11px] rounded border",style:{backgroundColor:u.colors.surface,color:u.colors.text,borderColor:u.colors.border},title:m==="fr"?"RÃ©initialiser":"Reset",children:"âœ•"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o&&e.jsx("button",{type:"button",onClick:()=>i&&i(),className:"px-1.5 py-0.5 text-[10px] rounded border",title:m==="fr"?"Masquer/Afficher":"Hide/Show",style:{backgroundColor:u.colors.surface,borderColor:u.colors.border,color:u.colors.text},children:c?"ðŸ™ˆ":"ðŸ‘ï¸"}),r&&e.jsx("span",{className:"px-2 py-0.5 text-[10px] rounded-full border",style:{backgroundColor:u.colors.accent+"20",color:u.colors.accent,borderColor:u.colors.accent+"40"},children:m==="fr"?"Requis":"Required"})]})]}),d]})},Kx=({isOpen:t,onClose:s,section:r,currentTheme:l,currentLanguage:n,formData:o,updateField:a,sectionPrefs:c,setSectionPref:i,compiledByFieldId:d,deferredFormData:u,hiddenFields:m,toggleFieldHidden:p,unhideAllFieldsInSection:x})=>t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0",style:{backgroundColor:"rgba(0,0,0,0.5)"},onClick:s}),e.jsxs("div",{className:"relative w-full max-w-lg rounded-lg border shadow-xl p-4",style:{backgroundColor:l.colors.card,borderColor:l.colors.border,color:l.colors.text},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-sm font-semibold",children:n==="fr"?"Options de section":"Section options"}),e.jsx("button",{onClick:s,className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text},"aria-label":"Close options",children:"âœ•"})]}),r.id==="position-entry"&&e.jsxs("div",{className:"rounded-md border mb-3 p-3",style:{borderColor:l.colors.border},children:[e.jsx("div",{className:"text-sm font-semibold mb-2",style:{color:l.colors.text},children:n==="fr"?"Saisie du PnL":"PnL Entry"}),(()=>{const f=v=>{if(o.pnlEntryMode!==v)if(v==="direct"){if((!!o.entryPrice||!!o.exitPrice||!!o.quantity)&&!window.confirm(n==="fr"?"Passer en saisie manuelle du PnL ? Les champs prix/quantitÃ© pourront Ãªtre ignorÃ©s.":"Switch to manual PnL entry? Price/quantity fields may be ignored."))return;a("pnlEntryMode","direct")}else{if((!!o.pnl||!!o.pnlPercentage)&&!window.confirm(n==="fr"?"Passer en PnL calculÃ© ? Les champs PnL manuel pourront Ãªtre ignorÃ©s.":"Switch to calculated PnL? Manual PnL fields may be ignored."))return;a("pnlEntryMode","detailed")}},g=v=>{o.pnlMode!==v&&a("pnlMode",v)},h=o.pnlEntryMode==="direct",y=!h,j=o.pnlMode!=="absolute";return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",style:{color:l.colors.textMuted},children:n==="fr"?"Mode de saisie":"Entry mode"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>f("detailed"),className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:y?l.colors.accent:l.colors.surface,color:y?"#fff":l.colors.text,borderColor:y?"transparent":l.colors.border},children:n==="fr"?"CalculÃ© (prix)":"Calculated (prices)"}),e.jsx("button",{type:"button",onClick:()=>f("direct"),className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:h?l.colors.accent:l.colors.surface,color:h?"#fff":l.colors.text,borderColor:h?"transparent":l.colors.border},children:n==="fr"?"Manuel":"Manual"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",style:{color:l.colors.textMuted},children:n==="fr"?"UnitÃ© du PnL":"PnL unit"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>g("percentage"),className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:j?l.colors.accent:l.colors.surface,color:j?"#fff":l.colors.text,borderColor:j?"transparent":l.colors.border},children:n==="fr"?"Pourcentage":"Percentage"}),e.jsx("button",{type:"button",onClick:()=>g("absolute"),className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:j?l.colors.surface:l.colors.accent,color:j?l.colors.text:"#fff",borderColor:j?l.colors.border:"transparent"},children:n==="fr"?"Absolu (devise)":"Absolute (currency)"})]})]})]})})()]}),r.id==="position-entry"&&e.jsxs("div",{className:"rounded-md border mb-3 p-3",style:{borderColor:l.colors.border},children:[e.jsx("div",{className:"text-sm font-semibold mb-2",style:{color:l.colors.text},children:"Suggestions"}),(()=>{const f=c?.["position-entry"]?.suggestExitDateFromEntry??!0,g=()=>i("position-entry","suggestExitDateFromEntry",!f);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs",style:{color:l.colors.text},children:n==="fr"?"SuggÃ©rer la date de sortie depuis la date dâ€™entrÃ©e":"Suggest exit date from entry date"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-xs",style:{color:l.colors.text},children:[e.jsx("input",{type:"checkbox",checked:f,onChange:g}),e.jsx("span",{children:f?n==="fr"?"ActivÃ©":"On":n==="fr"?"DÃ©sactivÃ©":"Off"})]})]})})()]}),e.jsxs("div",{className:"mb-3 text-xs",style:{color:l.colors.textMuted},children:[e.jsx("span",{style:{color:l.colors.text},children:r.label})," ","â€”"," ",n==="fr"?"Configurer lâ€™affichage des champs":"Configure field display"]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto pr-1",children:(()=>{const f=N=>{switch(N){case"instrument-context":return new Set(["status","market","symbol"]);case"position-entry":return new Set(["entryDateTime","entryPrice","quantity"]);case"position-exit":return new Set(["exitDateTime","exitPrice"]);case"risk-reward":return new Set(["tradeResult","strategy","setup"]);case"notes-screenshots":return new Set(["notesAndScreenshots"]);default:return new Set}},g=N=>{const S=String(N.id),w=d.get(S);let k=w?w.visibleIf(u):!0,M=!!(N.required||w?.requiredIf&&w.requiredIf(u));const C=w?.rules;if(Array.isArray(C))for(const P of C)(P?.when?P.when(u):!0)&&(typeof P.visible=="boolean"&&(k=P.visible),typeof P.require=="boolean"&&(M=P.require));const R=Array.isArray(m?.[r.id])&&m[r.id].includes(S);return e.jsx("div",{className:"rounded-md border",style:{borderColor:l.colors.border,opacity:k?1:.6},children:e.jsxs("details",{children:[e.jsx("summary",{className:"list-none cursor-pointer select-none",children:e.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"text-sm font-medium truncate",style:{color:l.colors.text},children:N.label||S}),M&&e.jsx("span",{className:"px-2 py-0.5 text-[10px] rounded-full border",style:{backgroundColor:l.colors.accent+"20",color:l.colors.accent,borderColor:l.colors.accent+"40"},children:n==="fr"?"Requis":"Required"}),!k&&e.jsx("span",{className:"px-2 py-0.5 text-[10px] rounded-full border",style:{backgroundColor:l.colors.surface,color:l.colors.textMuted,borderColor:l.colors.border},children:n==="fr"?"MasquÃ© par rÃ¨gle":"Hidden by rule"})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsx("button",{type:"button",onClick:P=>{P.preventDefault(),p(r.id,S)},className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:R?l.colors.accent+"20":l.colors.surface,color:R?l.colors.accent:l.colors.text,borderColor:R?l.colors.accent:l.colors.border},title:n==="fr"?R?"RÃ©afficher":"Masquer":R?"Show":"Hide",children:n==="fr"?R?"Afficher":"Masquer":R?"Show":"Hide"})})]})}),e.jsx("div",{className:"px-3 pb-3 text-xs",style:{color:l.colors.textMuted},children:n==="fr"?"Options Ã  venir pour ce champ.":"More options coming soon for this field."})]})},S)},h=r.id==="notes-screenshots"?[...[{id:"notes",label:n==="fr"?"Note contextuelle":"Contextual Note"},{id:"mentalSummary",label:n==="fr"?"RÃ©sumÃ© mental":"Mental Summary"},{id:"screenshots",label:"Screenshots"},{id:"emotion",label:n==="fr"?"Ã‰tat Ã©motionnel":"Emotional State"},{id:"intensity",label:n==="fr"?"IntensitÃ© Ã©motionnelle":"Emotional Intensity"},{id:"planRespected",label:n==="fr"?"Ai-je respectÃ© mon plan ?":"Did I follow my plan?"}]]:r.fields,y=f(r.id);let j,v;if(r.id==="notes-screenshots"){const N=Math.ceil(h.length/2);j=h.slice(0,N),v=h.slice(N)}else if(y.size>0)j=h.filter(N=>y.has(String(N.id))),v=h.filter(N=>!y.has(String(N.id)));else{const N=Math.ceil(h.length/2);j=h.slice(0,N),v=h.slice(N)}return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("div",{className:"space-y-2",children:j.map(g)}),e.jsx("div",{className:"space-y-2",children:v.map(g)})]})})()}),e.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{x(r.id)},className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:l.colors.surface,color:l.colors.text,borderColor:l.colors.border},children:n==="fr"?"RÃ©afficher tout":"Unhide all"}),e.jsx("button",{type:"button",onClick:s,className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:l.colors.accent,color:"#fff",borderColor:"transparent"},children:n==="fr"?"Fermer":"Close"})]})]})]}):null;function Yx(t,s,r){let l=t?t.visibleIf(r):!0,n=!!(s||t?.requiredIf&&t.requiredIf(r));const o=t?.rules;if(Array.isArray(o))for(const a of o)(a?.when?a.when(r):!0)&&(typeof a.visible=="boolean"&&(l=a.visible),typeof a.require=="boolean"&&(n=a.require));return{visible:l,required:n}}function Xx(t){return t==null?!0:typeof t=="string"?t.trim()==="":typeof t=="number"?Number.isNaN(t):Array.isArray(t)?t.length===0:!1}const jr=["fees_commission","fees_spread_slippage","fees_swap_overnight","fees_other"],Qx=({sectionId:t,compiledByFieldId:s,deferredFormData:r,formData:l,fieldRegistry:n,updateField:o,startTransition:a,currentTheme:c,currentLanguage:i,handleClearField:d})=>{const u=m=>{const p=s.get(m),x={id:m,label:m,component:m==="fees_commission"?"FeesCommissionFieldWrapper":m==="fees_spread_slippage"?"FeesSpreadSlippageFieldWrapper":m==="fees_swap_overnight"?"FeesSwapOvernightFieldWrapper":"FeesOtherFieldWrapper"},{visible:f,required:g}=Yx(p,!!x.required,r);if(!f)return null;const h=r[m],y=n[x.component];return e.jsxs(Ma,{fid:m,label:(()=>{switch(m){case"fees_commission":return"Commission";case"fees_spread_slippage":return"Spread/Slippage";case"fees_swap_overnight":return"Swap/Overnight";case"fees_other":return i==="fr"?"Autres frais":"Other fees";default:return m}})(),required:g,value:h,onReset:()=>d(m),isEditMode:!1,children:[y?e.jsx(y,{value:r[m],onChange:j=>a(()=>o(m,j))}):e.jsx("input",{type:"number",value:String(l[m]??""),onChange:j=>o(m,j.target.value),className:"w-full px-3 py-2 border rounded-lg",style:{backgroundColor:c.colors.surface,borderColor:c.colors.border,color:c.colors.text}}),g&&Xx(h)&&e.jsx("div",{className:"mt-1 text-xs",style:{color:c.colors.danger},children:i==="fr"?"Champ requis":"Required field"})]},m)};return e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u(jr[0]),u(jr[1]),u(jr[2]),u(jr[3])]})})};function Nr(t){return t==null?!0:typeof t=="string"?t.trim()==="":typeof t=="number"?Number.isNaN(t):Array.isArray(t)?t.length===0:!1}const Zx=({section:t,layout:s,compiledByFieldId:r,deferredFormData:l,formData:n,currentTheme:o,currentLanguage:a,isEditMode:c,hiddenFields:i,toggleFieldHidden:d,handleClearField:u,updateField:m,startTransition:p,renderBuiltin:x})=>{const f=N=>N==="fees_commission"||N==="fees_spread_slippage"||N==="fees_swap_overnight"||N==="fees_other";let g=!1;const h=new Set;let y=0;const j=t.fields.map(N=>{const S=s==="landscape"&&(N.type==="composite"&&N.component!=="TicksQuickWidgetWrapper"&&N.component!=="ExitDateTimeSectionWrapper"||t.id==="notes-screenshots"||N.component==="NotesAndScreenshotsStepWrapper"||N.component==="FuturesParamsSectionWrapper"||N.component==="LeverageMarginSectionWrapper"||N.component==="PnLSummaryWrapper"||N.component==="SummaryPanelWrapper"||N.component==="EntryDateTimeSectionWrapper");if(s==="landscape"&&t.id==="position-exit"){const L=String(N.id);if(h.has(L))return null;if(!g&&f(L))return g=!0,["fees_commission","fees_spread_slippage","fees_swap_overnight","fees_other"].forEach(U=>h.add(U)),e.jsx(Qx,{sectionId:t.id,compiledByFieldId:r,deferredFormData:l,formData:n,fieldRegistry:Oo,updateField:(U,_)=>m(U,_),startTransition:p,currentTheme:o,currentLanguage:a,handleClearField:u},"__fees_group__")}const w=r.get(String(N.id));let k=w?w.visibleIf(l):!0,M=!!(N.required||w?.requiredIf&&w.requiredIf(l));const C=w?.rules;if(Array.isArray(C))for(const L of C)(L?.when?L.when(l):!0)&&(typeof L.visible=="boolean"&&(k=L.visible),typeof L.require=="boolean"&&(M=L.require));if(!k)return null;if(Array.isArray(i?.[t.id])&&i[t.id].includes(String(N.id)))return e.jsx("div",{className:S?"md:col-span-2":"","data-field-container":String(N.id),children:c?e.jsxs("div",{className:"flex items-center justify-between text-xs opacity-70",children:[e.jsx("span",{className:"italic",children:a==="fr"?"Champ masquÃ© (mode Ã©dition)":"Field hidden (edit mode)"}),e.jsx("button",{type:"button",onClick:()=>d(t.id,String(N.id)),className:"px-1.5 py-0.5 rounded border",style:{backgroundColor:o.colors.surface,borderColor:o.colors.border,color:o.colors.text},children:a==="fr"?"RÃ©afficher":"Show"})]}):null},String(N.id));const P=l[N.id],D=M&&Nr(P);D&&(y+=1);const T=x(N,M);if(T){const L=s==="landscape"&&N.component==="MarketSelector";return e.jsxs("div",{className:L?"md:col-span-2":"",children:[T,e.jsx("div",{className:"mt-1 text-xs",style:{color:o.colors.danger,opacity:D?1:0,transition:"opacity 120ms ease-out"},children:a==="fr"?"Champ requis":"Required field"})]},String(N.id))}const E=Oo[N.component];return E?e.jsxs("div",{className:S?"md:col-span-2":"","data-field-container":String(N.id),children:[N.label&&e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("label",{className:"block text-sm font-semibold",style:{color:o.colors.text},children:N.label}),!Nr(P)&&e.jsx("button",{type:"button",onClick:()=>u(String(N.id)),className:"px-1.5 py-0.5 text-[11px] rounded border",style:{backgroundColor:o.colors.surface,color:o.colors.text,borderColor:o.colors.border},title:a==="fr"?"RÃ©initialiser":"Reset",children:"âœ•"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c&&e.jsx("button",{type:"button",onClick:()=>d(t.id,String(N.id)),className:"px-1.5 py-0.5 text-[10px] rounded border",title:a==="fr"?"Masquer/Afficher":"Hide/Show",style:{backgroundColor:o.colors.surface,borderColor:o.colors.border,color:o.colors.text},children:Array.isArray(i?.[t.id])&&i[t.id].includes(String(N.id))?"ðŸ™ˆ":"ðŸ‘ï¸"}),M&&e.jsx("span",{className:"px-2 py-0.5 text-[10px] rounded-full border",style:{backgroundColor:o.colors.accent+"20",color:o.colors.accent,borderColor:o.colors.accent+"40"},children:a==="fr"?"Requis":"Required"})]})]}),e.jsx(E,{value:l[N.id],onChange:L=>p(()=>m(N.id,L)),...N.type==="composite"?{formData:l,updateFieldGlobal:(L,U)=>p(()=>m(L,U))}:{}}),e.jsx("div",{className:"mt-1 text-xs",style:{color:o.colors.danger,opacity:D?1:0,transition:"opacity 120ms ease-out"},children:a==="fr"?"Champ requis":"Required field"})]},String(N.id)):e.jsxs("div",{className:S?"md:col-span-2":"","data-field-container":String(N.id),children:[N.label&&e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("label",{className:"block text-sm font-semibold",style:{color:o.colors.text},children:N.label}),!Nr(l[N.id])&&e.jsx("button",{type:"button",onClick:()=>u(String(N.id)),className:"px-1.5 py-0.5 text-[11px] rounded border",style:{backgroundColor:o.colors.surface,color:o.colors.text,borderColor:o.colors.border},title:a==="fr"?"RÃ©initialiser":"Reset",children:"âœ•"})]}),M&&e.jsx("span",{className:"px-2 py-0.5 text-[10px] rounded-full border",style:{backgroundColor:o.colors.accent+"20",color:o.colors.accent,borderColor:o.colors.accent+"40"},children:a==="fr"?"Requis":"Required"})]}),e.jsx("input",{type:"text",value:String(n[N.id]??""),onChange:L=>m(N.id,L.target.value),className:"w-full px-3 py-2 border rounded-lg",style:{backgroundColor:o.colors.surface,borderColor:o.colors.border,color:o.colors.text}}),M&&Nr(n[N.id])&&e.jsx("div",{className:"mt-1 text-xs",style:{color:o.colors.danger},children:a==="fr"?"Champ requis":"Required field"})]},String(N.id))}),v=e.jsxs("div",{className:s==="landscape"?"md:col-span-2":"",children:[t.fields.filter(N=>{if(!et(N.visibleIf)(n))return!1;const w=!!(N.required||N.requiredIf!==void 0&&et(N.requiredIf)(n)),k=N.id==="side"||N.id==="market"||N.id==="symbol"||w;return!(Array.isArray(i?.[t.id])&&i[t.id].includes(String(N.id))&&!k)}).length<2&&e.jsx("div",{className:"text-xs",style:{color:o.colors.textMuted},children:a==="fr"?"Cette section a peu de champs visibles.":"This section has few visible fields."}),y>0&&e.jsx("div",{className:"text-xs mt-1",style:{color:o.colors.danger},children:a==="fr"?`${y} champ(s) requis manquant(s)`:`${y} required field(s) missing`})]},"__section_hint__");return e.jsx(e.Fragment,{children:j.concat([v])})},ef=({sectionId:t="instrument-context",layout:s="vertical",focusFieldId:r})=>{const l=O.useMemo(()=>ht.sections.find(P=>P.id===t),[t]),n=O.useMemo(()=>{const P=new Map;if(!l)return P;for(const D of l.fields||[]){const T={visibleIf:et(D.visibleIf),requiredIf:D.requiredIf!==void 0?et(D.requiredIf):void 0,rules:Array.isArray(D.rules)?D.rules.map(E=>({when:et(E?.when),visible:E?.visible,require:E?.require})):void 0};P.set(String(D.id),T)}return P},[l]),{currentTheme:o}=ee(),{currentLanguage:a}=X(),{formData:c,updateField:i}=fs(),[d,u]=O.useTransition(),m=O.useDeferredValue(c),p=Qe(P=>P.isEditMode),x=Qe(P=>P.hiddenFields),f=Qe(P=>P.toggleFieldHidden),g=Qe(P=>P.sectionPrefs),h=Qe(P=>P.setSectionPref);Qe(P=>P.toggleSectionHidden);const y=Qe(P=>P.unhideAllFieldsInSection),[j,v]=O.useState(!1),[N,S]=O.useState(!1);if(O.useEffect(()=>{const P=D=>{D.key==="Escape"&&S(!1)};return window.addEventListener("keydown",P),()=>window.removeEventListener("keydown",P)},[]),O.useCallback(()=>{if(l){for(const P of l.fields||[])P.type!=="composite"&&u(()=>i(P.id,""));S(!1)}},[l,i,u]),!l)return null;const w=O.useCallback(P=>{if(P==="entryDateTime"){i("entryDate",""),i("entryTime","");return}if(P==="exitDateTime"){i("exitDate",""),i("exitTime","");return}const D=c[P],T=Array.isArray(D)?[]:"";i(P,T)},[c,i]);if(!O.useMemo(()=>et(l.visibleIf)(m),[l?.visibleIf,m]))return null;const M=P=>P==null?!0:typeof P=="string"?P.trim()==="":typeof P=="number"?Number.isNaN(P):Array.isArray(P)?P.length===0:!1,C=(P,D)=>{const T={color:o.colors.text},E=o.colors.border,L=o.colors.surface,U=o.colors.text,_=o.colors.accent;if(P.component==="StatusToggle")return e.jsxs("div",{className:"mb-3","data-field-container":"status",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("label",{className:"block text-sm font-semibold",style:T,children:a==="fr"?"Statut":"Status"}),!M(c.status)&&e.jsx("button",{type:"button",onClick:()=>w("status"),className:"px-1.5 py-0.5 text-[11px] rounded border",style:{backgroundColor:L,color:U,borderColor:E},title:a==="fr"?"RÃ©initialiser":"Reset",children:"âœ•"})]}),D&&e.jsx("span",{className:"px-2 py-0.5 text-[10px] rounded-full border",style:{backgroundColor:_+"20",color:_,borderColor:_+"40"},children:a==="fr"?"Requis":"Required"})]}),e.jsx("div",{className:"flex gap-2",children:["open","closed"].map(B=>e.jsx("button",{onClick:()=>i("status",B),className:`flex-1 px-2 py-1 text-sm rounded-lg border-2 transition-all duration-200 ${c.status===B?"border-0 shadow-md":"hover:shadow-sm"}`,style:{backgroundColor:c.status===B?_:L,color:c.status===B?"#ffffff":U,borderColor:c.status===B?"transparent":E},children:B==="open"?a==="fr"?"Ouvert":"Open":a==="fr"?"FermÃ©":"Closed"},B))})]});if(P.component==="SideToggle")return e.jsxs("div",{className:"mb-3","data-field-container":"side",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("label",{className:"block text-sm font-semibold",style:T,children:a==="fr"?"Direction":"Side"}),!M(c.side)&&e.jsx("button",{type:"button",onClick:()=>w("side"),className:"px-1.5 py-0.5 text-[11px] rounded border",style:{backgroundColor:L,color:U,borderColor:E},title:a==="fr"?"RÃ©initialiser":"Reset",children:"âœ•"})]}),D&&e.jsx("span",{className:"px-2 py-0.5 text-[10px] rounded-full border",style:{backgroundColor:_+"20",color:_,borderColor:_+"40"},children:a==="fr"?"Requis":"Required"})]}),e.jsx("div",{className:"flex gap-2",children:["long","short"].map(B=>e.jsx("button",{onClick:()=>i("side",B),className:`flex-1 px-2 py-1 text-sm rounded-lg border-2 transition-all duration-200 ${c.side===B?"border-0 shadow-md":"hover:shadow-sm"}`,style:{backgroundColor:c.side===B?_:L,color:c.side===B?"#ffffff":U,borderColor:c.side===B?"transparent":E},children:B==="long"?"Long":"Short"},B))})]});if(P.component==="MarketSelector"){const B=["futures","forex","stocks","indices","crypto","commodities"],z=A=>({futures:"Futures",forex:"Forex",stocks:a==="fr"?"Actions":"Stocks",indices:"Indices",crypto:"Crypto",commodities:a==="fr"?"MatiÃ¨res PremiÃ¨res":"Commodities"})[A]||A;return e.jsxs("div",{className:"mb-3","data-field-container":"market",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("label",{className:"block text-sm font-semibold",style:T,children:a==="fr"?"MarchÃ©":"Market"}),!M(c.market)&&e.jsx("button",{type:"button",onClick:()=>w("market"),className:"px-1.5 py-0.5 text-[11px] rounded border",style:{backgroundColor:L,color:U,borderColor:E},title:a==="fr"?"RÃ©initialiser":"Reset",children:"âœ•"})]}),D&&e.jsx("span",{className:"px-2 py-0.5 text-[10px] rounded-full border",style:{backgroundColor:_+"20",color:_,borderColor:_+"40"},children:a==="fr"?"Requis":"Required"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:B.map(A=>e.jsx("button",{onClick:()=>i("market",A),className:`w-full h-8 px-2 py-1 text-sm rounded-lg border-2 transition-all duration-200 ${c.market===A?"border-0 shadow-md":"hover:shadow-sm"}`,style:{backgroundColor:c.market===A?_:L,color:c.market===A?"#ffffff":U,borderColor:c.market===A?"transparent":E},children:z(A)},A))})]})}return null},R=O.useRef(null);return O.useEffect(()=>{if(!r)return;const P=R.current;if(!P)return;const D=P.querySelector(`[data-field-container="${r}"]`);if(D){const T=D.querySelector("input, select, textarea, button");if(T&&typeof T.focus=="function"){T.focus();try{T.scrollIntoView({block:"center",behavior:"smooth"})}catch{}try{const L=new CustomEvent("v3-open-overlay",{detail:{fieldId:r}});window.dispatchEvent(L)}catch{}try{const L=window.__v3OverlayOpeners;L&&typeof L[r]=="function"&&setTimeout(()=>{try{L[r]()}catch{}},80)}catch{}const E=D.querySelector('[data-overlay-trigger="true"]');E&&typeof E.click=="function"?setTimeout(()=>{try{E.click()}catch{}},50):setTimeout(()=>{try{T.click?.()}catch{}},60)}}},[r]),e.jsxs("div",{ref:R,children:[e.jsx(Gx,{title:l.label,currentTheme:o,currentLanguage:a,layout:s,collapsed:j,onToggleCollapse:()=>v(!j),onOpenOptions:()=>S(!0)}),!j&&e.jsx("div",{className:s==="landscape"?"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4":"space-y-4",children:(()=>{if(s==="landscape"&&l.id==="position-entry"){const P=new Map(l.fields.map(T=>[String(T.id),T])),D=T=>{const E=P.get(T);if(!E)return null;const L=n.get(String(E.id));let U=L?L.visibleIf(m):!0,_=!!(E.required||L?.requiredIf&&L.requiredIf(m));const B=L?.rules;if(Array.isArray(B))for(const $ of B)($?.when?$.when(m):!0)&&(typeof $.visible=="boolean"&&(U=$.visible),typeof $.require=="boolean"&&(_=$.require));if(!U)return null;const z=m[E.id],A=_&&M(z),F=Oo[E.component],q=String(E.id),W=!1;return Array.isArray(x?.[l.id])&&x[l.id].includes(q)?null:e.jsxs(Ma,{fid:q,label:E.label,required:_,value:z,onReset:()=>w(q),isEditMode:p,isProtected:W,isHidden:Array.isArray(x?.[l.id])&&x[l.id].includes(q),onToggleHidden:()=>f(l.id,q),children:[F?e.jsx(F,{value:m[E.id],onChange:$=>u(()=>i(E.id,$)),...E.type==="composite"?{formData:m,updateFieldGlobal:($,V)=>u(()=>i($,V))}:{}}):e.jsx("input",{type:"text",value:String(c[E.id]??""),onChange:$=>i(E.id,$.target.value),className:"w-full px-3 py-2 border rounded-lg",style:{backgroundColor:o.colors.surface,borderColor:o.colors.border,color:o.colors.text}}),A&&e.jsx("div",{className:"mt-1 text-xs",style:{color:o.colors.danger},children:a==="fr"?"Champ requis":"Required field"})]},q)};return e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[D("entryDateTime"),D("entryPrice"),D("quantity"),D("futuresParams")]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[D("stopPrice"),D("takeProfitPrice")]}),D("leverageMargin")]})]})},"__entry_layout__")}return e.jsx(Zx,{section:l,layout:s,compiledByFieldId:n,deferredFormData:m,formData:c,currentTheme:o,currentLanguage:a,isEditMode:p,hiddenFields:x,toggleFieldHidden:f,handleClearField:w,updateField:(P,D)=>i(P,D),startTransition:u,renderBuiltin:C})})()}),N&&(typeof document<"u"?St.createPortal(e.jsx(Kx,{isOpen:N,onClose:()=>S(!1),section:l,currentTheme:o,currentLanguage:a,formData:c,updateField:(P,D)=>u(()=>i(P,D)),sectionPrefs:g,setSectionPref:h,compiledByFieldId:n,deferredFormData:m,hiddenFields:x,toggleFieldHidden:f,unhideAllFieldsInSection:y}),document.body):null)]})},Xe=O.memo(ef),Ra=Object.freeze(Object.defineProperty({__proto__:null,SectionRenderer:Xe},Symbol.toStringTag,{value:"Module"})),Ta="v3-form-mode";function tf(){try{const t=localStorage.getItem(Ta);if(!t)return null;const s=JSON.parse(t);return!s||typeof s!="object"?null:{mode:s.mode||"deck",deckLayout:s.deckLayout}}catch{return null}}let kr=null;function sf(t){try{kr!==null&&typeof window<"u"&&window.clearTimeout(kr),kr=typeof window<"u"?window.setTimeout(()=>{try{localStorage.setItem(Ta,JSON.stringify(t))}catch{}kr=null},250):null}catch{}}const ko={order:["context","entry","exit","performance","notes"],hidden:[]},Fs=oo()((t,s)=>{const r=typeof window<"u"?tf():null,l=r?.mode||"wizard",n=r?.deckLayout||ko,o=a=>{const c={mode:a.mode??s().mode,deckLayout:a.deckLayout??s().deckLayout};sf(c)};return{mode:l,deckLayout:n,setMode:a=>{t({mode:a}),o({mode:a})},setDeckLayout:a=>{t({deckLayout:a}),o({deckLayout:a})},toggleHidden:a=>{const{deckLayout:c}=s(),i=c.hidden.includes(a)?c.hidden.filter(u=>u!==a):[...c.hidden,a],d={...c,hidden:i};t({deckLayout:d}),o({deckLayout:d})},reorder:a=>{const{deckLayout:c}=s(),i={...c,order:a};t({deckLayout:i}),o({deckLayout:i})},resetLayout:()=>{t({deckLayout:ko}),o({deckLayout:ko})}}});function Da(t){return t==null?!0:typeof t=="string"?t.trim()==="":typeof t=="number"?Number.isNaN(t):Array.isArray(t)?t.length===0:!1}function rf(t){const s=[];for(const r of ht.sections)if(Hx(et(r.visibleIf))(t))for(const n of r.fields){const o=et(n.visibleIf),a=n.requiredIf!==void 0?et(n.requiredIf):void 0;let c=o(t),i=!!n.required||(a?a(t):!1);const d=n.rules;if(Array.isArray(d))for(const m of d)et(m?.when)(t)&&(typeof m.visible=="boolean"&&(c=m.visible),typeof m.require=="boolean"&&(i=m.require));if(!c||!i)continue;const u=t[n.id];Da(u)&&s.push({sectionId:r.id,fieldId:String(n.id),label:n.label,message:"required"})}return s}function Ps(t,s){const r=[],l=new Set(s);for(const n of ht.sections)if(!(!l.has(n.id)||!et(n.visibleIf)(t)))for(const a of n.fields){const c=et(a.visibleIf),i=a.requiredIf!==void 0?et(a.requiredIf):void 0;let d=c(t),u=!!a.required||(i?i(t):!1);const m=a.rules;if(Array.isArray(m))for(const x of m)et(x?.when)(t)&&(typeof x.visible=="boolean"&&(d=x.visible),typeof x.require=="boolean"&&(u=x.require));if(!d||!u)continue;const p=t[a.id];Da(p)&&r.push({sectionId:n.id,fieldId:String(a.id),label:a.label,message:"required"})}return r}function Kn(t,s){const r=ht.sections.find(i=>i.id===t);if(!r)return{filled:0,total:0,percentage:0};const l=i=>i==null?!0:typeof i=="string"?i.trim()==="":typeof i=="number"?Number.isNaN(i):Array.isArray(i)?i.length===0:!1,o=(r.fields||[]).filter(i=>i.type==="composite"?!1:et(i.visibleIf)(s)).filter(i=>!!(i.required||i.requiredIf!==void 0&&et(i.requiredIf)(s))),a=o.length,c=o.filter(i=>!l(s[i.id])).length;return{filled:c,total:a,percentage:a>0?Math.round(c/a*100):0}}function wr(t){switch(t){case"instrument-context":return"context";case"position-entry":return"entry";case"position-exit":return"exit";case"risk-reward":return"performance";case"notes-screenshots":return"notes";default:return null}}function bs(t){switch(t){case"context":return"instrument-context";case"entry":return"position-entry";case"exit":return"position-exit";case"performance":return"risk-reward";case"notes":return"notes-screenshots"}}const Ea=()=>{const{currentTheme:t}=ee(),{currentLanguage:s}=X(),r=Fs($=>$.deckLayout),l=Fs($=>$.toggleHidden),n=Fs($=>$.resetLayout),o=Fs($=>$.reorder),{formData:a,updateField:c}=fs(),i=Qe($=>$.isEditMode),d=Qe($=>$.setEditMode),u=Qe($=>$.unhideAllFields),m=Qe($=>$.hiddenFields);Qe($=>$.unhideAllFieldsInSection);const p=Qe($=>$.hiddenSections),[x,f]=O.useState(null),[g,h]=O.useState("normal"),y=O.useCallback($=>f(V=>V===$?null:$),[]),[j,v]=O.useState(!1),[N,S]=O.useState(null);O.useEffect(()=>{if(x){v(!1);const $=setTimeout(()=>v(!0),150);return S(w),()=>clearTimeout($)}S(null)},[x]);const w=O.useDeferredValue(a),k=O.useMemo(()=>new Set((p||[]).map($=>wr($)).filter(Boolean)),[p]),M=O.useMemo(()=>new Set([...r.hidden,...Array.from(k)]),[r.hidden,k]),C=O.useMemo(()=>r.order.filter($=>!M.has($)),[r.order,M]),R=O.useMemo(()=>C.map(bs),[C]),P=O.useMemo(()=>x?Ps(w,[x]):Ps(w,R),[w,x,R]),D=O.useMemo(()=>new Set(P.map($=>$.sectionId)),[P]),[T,E]=O.useState({}),L=O.useRef(null);O.useEffect(()=>{const $=K=>{const ne={};for(const ue of K)ne[ue]=Kn(ue,w);E(ue=>({...ue,...ne}))},V=x?[x]:R;return L.current&&window.clearTimeout(L.current),L.current=window.setTimeout(()=>$(V),80),()=>{L.current&&window.clearTimeout(L.current)}},[w,x,R]);const U=O.useCallback(($,V)=>Kn($,V),[]),_=$=>{const V=ht.sections.find(ne=>ne.id===$);if(!V)return;const K={entryDateTime:["entryDate","entryTime"],futuresParams:["tickSize","tickValue"],leverageMargin:["leverage","marginRatePercent","marginUsed"],pnlSummary:[],summaryPanel:[],notesAndPsycho:["notes","screenshots"]};V.fields?.forEach(ne=>{ne.type==="composite"?(K[String(ne.id)]||[]).forEach(le=>c(le,"")):c(ne.id,"")})},B=ln(nr(fr,{activationConstraint:{distance:15}}));O.useEffect(()=>{try{ns(()=>Promise.resolve().then(()=>Ra),void 0,import.meta.url)}catch{}},[]),O.useEffect(()=>{const $=V=>{if(!x)return;const K=document.activeElement,ne=K?.tagName==="INPUT"||K?.tagName==="TEXTAREA"||K?.tagName==="SELECT",ue=new Set(r.hidden),le=r.order.filter(ve=>!ue.has(ve)),je=wr(x);if(!je)return;const ye=le.indexOf(je);if(V.key==="Tab"&&!ne)if(V.preventDefault(),V.shiftKey){const ve=(ye-1+le.length)%le.length;f(bs(le[ve]))}else{const ve=(ye+1)%le.length;f(bs(le[ve]))}else V.key==="Escape"&&f(null)};return window.addEventListener("keydown",$),()=>window.removeEventListener("keydown",$)},[x,r.hidden,r.order]);const[z,A]=O.useState(null),F=$=>{A($.active.id)},q=$=>{A(null)},W=$=>{const{active:V,over:K}=$;if(A(null),!K||V.id===K.id)return;const ne=new Set(r.hidden),ue=r.order.filter(Y=>!ne.has(Y)),le=ue.indexOf(V.id),je=ue.indexOf(K.id);if(le===-1||je===-1)return;const ye=Cs(ue,le,je),ve=r.order.filter(Y=>ne.has(Y)),se=[...ye,...ve];o(se)},I=O.useMemo(()=>({compact:"grid-cols-1 md:grid-cols-3 xl:grid-cols-4",normal:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3",comfortable:"grid-cols-1 md:grid-cols-2"})[g],[g]);return e.jsx(Ga,{children:e.jsxs("div",{className:"space-y-4",children:[!x&&e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(),className:"px-3 py-1.5 rounded border text-xs hover:shadow-sm transition-all",style:{backgroundColor:t.colors.surface,color:t.colors.text,borderColor:t.colors.border},children:s==="fr"?"RÃ©initialiser":"Reset"}),e.jsx("button",{onClick:()=>d(!i),className:"px-3 py-1.5 rounded border text-xs hover:shadow-sm transition-all",style:{backgroundColor:i?t.colors.accent+"20":t.colors.surface,color:i?t.colors.accent:t.colors.text,borderColor:i?t.colors.accent:t.colors.border},children:s==="fr"?i?"âœ“ Mode Ã©dition":"Mode Ã©dition":i?"âœ“ Edit mode":"Edit mode"}),i&&e.jsx("button",{onClick:()=>u(),className:"px-3 py-1.5 rounded border text-xs hover:shadow-sm transition-all",style:{backgroundColor:t.colors.surface,color:t.colors.text,borderColor:t.colors.border},title:s==="fr"?"Tout rÃ©afficher":"Show all",children:s==="fr"?"Tout rÃ©afficher":"Show all"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs",style:{color:t.colors.textMuted},children:s==="fr"?"Grille:":"Grid:"}),["compact","normal","comfortable"].map($=>e.jsx("button",{onClick:()=>h($),className:"px-2 py-1 rounded text-xs transition-all",style:{backgroundColor:g===$?t.colors.accent+"20":t.colors.surface,color:g===$?t.colors.accent:t.colors.text,borderWidth:"1px",borderStyle:"solid",borderColor:g===$?t.colors.accent:t.colors.border},children:$==="compact"?"â–«â–«â–«":$==="normal"?"â–«â–«":"â–«"},$))]})]}),x&&e.jsx(hn,{children:e.jsx(Ys.div,{initial:{opacity:0},animate:{opacity:.5},exit:{opacity:0},transition:{duration:.12},className:"fixed inset-0 bg-black/60 z-40",onClick:()=>f(null),style:{willChange:"opacity"}},"deck-overlay")}),x?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(()=>{const $=new Set(r.hidden),V=wr(x);return r.order.filter(ne=>!$.has(ne)&&ne!==V).map(ne=>{const ue=bs(ne),le=ht.sections.find(je=>je.id===ue);return le?e.jsxs("div",{className:"rounded-xl border opacity-50",style:{backgroundColor:t.colors.card,borderColor:t.colors.border},children:[e.jsx("div",{className:"px-4 py-3 border-b",style:{borderColor:t.colors.border},children:e.jsx("div",{className:"text-sm",style:{color:t.colors.text},children:le.label})}),e.jsx("div",{className:"px-4 py-3 text-xs",style:{color:t.colors.textMuted},children:Fa(ne,N||{},s)})]},ne):null})})()}):e.jsx(Or,{sensors:B,collisionDetection:Ir,measuring:{droppable:{strategy:Is.BeforeDragging}},onDragStart:F,onDragCancel:q,onDragEnd:W,children:(()=>{const $=Qe.getState().hiddenSections,V=new Set($.map(ue=>wr(ue)).filter(Boolean)),K=new Set([...r.hidden,...Array.from(V)]),ne=r.order.filter(ue=>!K.has(ue));return e.jsxs(e.Fragment,{children:[e.jsx(lr,{items:ne,strategy:xn,children:e.jsx("div",{className:`grid ${I} gap-4 transition-all duration-300`,style:{pointerEvents:x?"none":"auto"},children:ne.map(ue=>{const le=bs(ue),je=ht.sections.find(te=>te.id===le);if(!je)return null;const ye=x===le,ve=T[le]||U(le,w),se=D.has(le),Y=lf(ue,w);return e.jsx(of,{id:ue,disabled:!!x,children:te=>e.jsx(nf,{keyId:ue,sectionId:le,schemaSection:je,isOpen:ye,currentTheme:t,currentLanguage:s,isEditMode:i,hiddenFieldsPref:m,gridSize:g,hasIssues:se,progress:ve,previewData:Y,onResetSection:_,onToggleHidden:G=>{const he=bs(G);he&&Qe.getState().toggleSectionHidden(he),l(G)},onOpen:y,dragProps:te})},ue)})})}),e.jsx(mn,{children:z?(()=>{const ue=bs(z),le=ht.sections.find(je=>je.id===ue);return le?e.jsx("div",{className:"rounded-lg border shadow-sm px-4 py-3",style:{backgroundColor:t.colors.card,borderColor:t.colors.border},children:e.jsx("div",{className:"text-sm font-medium",style:{color:t.colors.text},children:le.label})}):null})():null})]})})()}),e.jsx(hn,{children:x&&e.jsx(Ys.div,{className:"fixed inset-0 z-50 flex items-center justify-center p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},onClick:()=>f(null),style:{willChange:"opacity"},children:e.jsxs(Ys.div,{layoutId:`deck-card-${x}`,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.12,ease:"easeOut"},className:"rounded-xl border shadow-xl overflow-hidden",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,width:"90vw",maxWidth:"1300px",height:"90vh",maxHeight:"950px",willChange:"opacity",contain:"layout paint style"},onClick:$=>$.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",style:{borderColor:t.colors.border},children:[e.jsx("div",{className:"text-base font-semibold",style:{color:t.colors.text},children:ht.sections.find($=>$.id===x)?.label}),e.jsx("button",{onClick:()=>f(null),className:"px-2 py-1 text-xs rounded border",style:{backgroundColor:t.colors.surface,color:t.colors.text,borderColor:t.colors.border},children:s==="fr"?"Fermer":"Close"})]}),e.jsx("div",{className:"p-4 h-[calc(100%-56px)] overflow-y-auto",children:j?e.jsx(Xe,{sectionId:x,layout:"landscape"}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-6 w-48 rounded",style:{backgroundColor:t.colors.surface}}),e.jsx("div",{className:"h-4 w-full rounded",style:{backgroundColor:t.colors.surface}}),e.jsx("div",{className:"h-4 w-full rounded",style:{backgroundColor:t.colors.surface}}),e.jsx("div",{className:"h-4 w-2/3 rounded",style:{backgroundColor:t.colors.surface}})]})})]})},"deck-centered-modal")})]})})},of=({id:t,children:s,disabled:r})=>{const{attributes:l,listeners:n,setNodeRef:o,transform:a,transition:c,isDragging:i}=fn({id:t,disabled:r}),d={transform:ts.Transform.toString(a),transition:c,opacity:i?.85:1,cursor:r?"default":"grab"};return e.jsx("div",{ref:o,style:d,children:s(r?{}:{...l,...n})})},nf=O.memo(({keyId:t,sectionId:s,schemaSection:r,isOpen:l,currentTheme:n,currentLanguage:o,isEditMode:a,hiddenFieldsPref:c,gridSize:i,hasIssues:d,progress:u,previewData:m,onResetSection:p,onToggleHidden:x,onOpen:f,dragProps:g})=>{const[h,y]=O.useState(!1),[j,v]=O.useState(!1),N=O.useRef(null);O.useEffect(()=>{const k=N.current;if(!k||typeof IntersectionObserver>"u"){y(!0);return}const M=new IntersectionObserver(C=>{for(const R of C)if(R.isIntersecting){y(!0),M.disconnect();break}},{root:null,threshold:.1});return M.observe(k),()=>M.disconnect()},[]);const S=u.percentage===100&&!d,w=l||j;return e.jsxs(Ys.div,{ref:N,layout:"position",transition:{layout:{duration:.25,ease:"easeInOut"}},layoutId:`deck-card-${s}`,className:`relative rounded-xl border-2 transition-all cursor-pointer flex flex-col ${l?"z-50 shadow-md scale-105":S?"border-green-500/30 hover:border-green-500/50 opacity-95 hover:opacity-100 hover:shadow-sm":d?"border-orange-500/25 hover:border-orange-500/40 opacity-90 hover:opacity-100 hover:shadow-sm":"opacity-85 hover:opacity-100 hover:shadow-sm"}`,style:{backgroundColor:n.colors.card,borderColor:S?"rgba(34, 197, 94, 0.3)":d?"rgba(249, 115, 22, 0.25)":n.colors.border,willChange:"transform, opacity",contain:"layout paint style",minHeight:i==="compact"?"180px":i==="normal"?"200px":"220px"},onClick:()=>{l||f(s)},onMouseEnter:()=>{ns(()=>Promise.resolve().then(()=>Ra),void 0,import.meta.url),v(!0)},onMouseLeave:()=>v(!1),children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 rounded-t-xl overflow-hidden",style:{backgroundColor:n.colors.surface},children:w?e.jsx(Ys.div,{initial:{width:0},animate:{width:`${u.percentage}%`},transition:{duration:.4,ease:"easeOut"},className:"h-full",style:{backgroundColor:S?"rgba(34, 197, 94, 0.9)":d?"rgba(249, 115, 22, 0.85)":n.colors.accent}}):e.jsx("div",{className:"h-full",style:{width:`${u.percentage}%`,backgroundColor:S?"rgba(34, 197, 94, 0.9)":d?"rgba(249, 115, 22, 0.85)":n.colors.accent}})}),e.jsxs("div",{className:"pt-3 px-4 pb-2 flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"p-1 cursor-grab select-none hover:bg-white/5 rounded",title:o==="fr"?"DÃ©placer":"Drag",...g,children:e.jsx("span",{className:"text-sm opacity-50",children:"â‰¡"})}),e.jsx("h3",{className:"text-sm font-semibold truncate",style:{color:n.colors.text},children:r.label})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[a&&Array.isArray(c?.[s])&&c[s].length>0&&e.jsx("button",{onClick:k=>{k.stopPropagation(),Qe.getState().unhideAllFieldsInSection(s)},className:"p-1 text-xs rounded hover:bg-white/10 transition-colors",style:{color:n.colors.textMuted},title:o==="fr"?"RÃ©afficher tous les champs de la section":"Show all fields in section",children:"âŸ³"}),S?e.jsx("span",{className:"px-1.5 py-0.5 text-[10px] rounded-full",style:{backgroundColor:"rgba(34, 197, 94, 0.2)",color:"rgb(34, 197, 94)"},children:"âœ“"}):d?e.jsx("span",{className:"px-1.5 py-0.5 text-[10px] rounded-full",style:{backgroundColor:"rgba(249, 115, 22, 0.2)",color:"rgb(249, 115, 22)"},children:"âš "}):null,e.jsx("button",{onClick:k=>{k.stopPropagation(),p(s)},className:"p-1 text-xs rounded hover:bg-white/10 transition-colors",style:{color:n.colors.textMuted},title:o==="fr"?"RÃ©initialiser":"Reset",children:"â†»"}),e.jsx("button",{onClick:k=>{k.stopPropagation(),x(t)},className:"p-1 text-xs rounded hover:bg-white/10 transition-colors",style:{color:n.colors.textMuted},title:o==="fr"?"Masquer":"Hide",children:"Ã—"})]})]}),e.jsx("div",{className:"space-y-1.5 text-[11px] flex-1 overflow-hidden",style:{color:n.colors.textMuted},children:h?Fa(t,m,o):null}),e.jsxs("div",{className:"mt-auto pt-2 border-t flex items-center justify-between flex-shrink-0",style:{borderColor:n.colors.border},children:[e.jsxs("span",{className:"text-[10px]",style:{color:n.colors.textMuted},children:[u.filled,"/",u.total," ",o==="fr"?"champs":"fields"]}),e.jsxs("span",{className:"text-[10px] font-medium",style:{color:n.colors.text},children:[u.percentage,"%"]})]})]})]})});function Fa(t,s,r){const l=(n,o="â€”")=>n!=null&&n!==""?String(n):o;switch(t){case"context":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:r==="fr"?"Symbole:":"Symbol:"}),e.jsx("span",{className:"font-medium",children:l(s.symbol)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:r==="fr"?"MarchÃ©:":"Market:"}),e.jsx("span",{children:l(s.market)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:"Direction:"}),e.jsx("span",{children:l(s.side,"â€”")})]})]});case"entry":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:"Date:"}),e.jsx("span",{className:"font-medium",children:l(s.entryDate)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:r==="fr"?"Prix:":"Price:"}),e.jsx("span",{children:l(s.entryPrice)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:r==="fr"?"QuantitÃ©:":"Quantity:"}),e.jsx("span",{children:l(s.quantity)})]})]});case"exit":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:r==="fr"?"Statut:":"Status:"}),e.jsx("span",{className:"font-medium",children:l(s.status,r==="fr"?"En cours":"Pending")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:r==="fr"?"Prix:":"Price:"}),e.jsx("span",{children:l(s.exitPrice)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:"P&L:"}),e.jsx("span",{className:s.pnl&&parseFloat(s.pnl)>0?"text-green-500":s.pnl&&parseFloat(s.pnl)<0?"text-red-500":"",children:l(s.pnl)})]})]});case"performance":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:r==="fr"?"StratÃ©gie:":"Strategy:"}),e.jsx("span",{className:"font-medium truncate",children:l(s.strategy)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:r==="fr"?"RÃ©sultat:":"Result:"}),e.jsx("span",{children:l(s.result)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:"R:R:"}),e.jsx("span",{children:l(s.riskReward)})]})]});case"notes":const n=s.notes||"",o=Array.isArray(s.screenshots)?s.screenshots.length:0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:"Note:"}),e.jsx("span",{className:"truncate",children:n?n.substring(0,30)+(n.length>30?"...":""):"â€”"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-60",children:"Screenshots:"}),e.jsx("span",{children:o>0?o:"â€”"})]})]});default:return e.jsx("span",{className:"opacity-50",children:r==="fr"?"Aucune donnÃ©e":"No data"})}}function lf(t,s){switch(t){case"context":return{symbol:s.symbol,market:s.market,side:s.side};case"entry":return{entryDate:s.entryDate,entryPrice:s.entryPrice,quantity:s.quantity};case"exit":return{status:s.status,exitPrice:s.exitPrice,pnl:s.pnl};case"performance":return{strategy:s.strategy,result:s.result,riskReward:s.riskReward};case"notes":return{notes:s.notes,screenshots:s.screenshots};default:return{}}}const af=({currentStepId:t,onStepClick:s,disabledSteps:r=[],stepIds:l})=>{const{currentTheme:n}=ee(),{currentLanguage:o,t:a}=X(),{formData:c}=fs(),i=O.useDeferredValue(c),d=O.useMemo(()=>(l&&l.length>0?l:["instrument-context","position-entry","position-exit","risk-reward","notes-screenshots"]).filter(g=>!!ht.sections.find(h=>h.id===g)),[l]),u=O.useMemo(()=>d.map(g=>({id:g,label:(()=>{switch(g){case"instrument-context":return a.instrument___contexte||(o==="fr"?"Instrument & Contexte":"Instrument & Context");case"position-entry":return a.position__entr_e_||(o==="fr"?"EntrÃ©e":"Entry");case"position-exit":return a.sortie___frais||(o==="fr"?"Sortie & Frais":"Exit & Fees");case"risk-reward":return a.setup___risque||(o==="fr"?"Setup & Risque":"Setup & Risk");case"notes-screenshots":return a.notes___screenshots||"Notes & Screenshots";default:return g}})()})),[d,o,a]),[m,p]=O.useState(new Set),x=O.useRef(null);O.useEffect(()=>(x.current&&window.clearTimeout(x.current),x.current=window.setTimeout(()=>{const g=new Set(d.filter(h=>Ps(i,[h]).length===0));p(g),x.current=null},50),()=>{x.current&&window.clearTimeout(x.current)}),[i,d]);const f=Math.max(0,d.indexOf(t));return e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:"flex-1 rounded-full h-3",style:{backgroundColor:n.colors.border+"40"},children:e.jsx("div",{className:"h-3 rounded-full gpu-progress",style:{backgroundColor:n.colors.accent,transform:`scaleX(${Math.max(0,Math.min(1,(f+1)/u.length))})`}})})}),e.jsx("div",{className:"flex flex-wrap items-center mt-2",style:{gap:"16px"},children:u.map((g,h)=>{const y=m.has(g.id),j=t===g.id,v=r.includes(g.id);return e.jsxs("div",{className:"relative flex items-center",children:[e.jsxs("button",{onClick:()=>{v||s(g.id)},disabled:v,className:`gpu-btn flex items-center px-4 py-2.5 text-base font-medium ${j?"shadow-md":y?"hover:opacity-100":"hover:opacity-90"} ${v?"cursor-not-allowed opacity-40":"cursor-pointer"}`,style:{backgroundColor:j?`${n.colors.accent}20`:"transparent",color:j?"#ffffff":y?n.colors.accent:n.colors.textSecondary,border:`2px solid ${j?n.colors.accent:y?n.colors.accent+"40":n.colors.border}`,clipPath:"polygon(8px 0, 100% 0, calc(100% - 8px) 100%, 0 100%)",position:"relative"},children:[e.jsx("div",{className:"mr-2.5",children:y?e.jsx("span",{style:{color:n.colors.accent},children:"âœ“"}):e.jsx("div",{className:"w-4 h-4 rounded-full border-2",style:{borderColor:n.colors.border,backgroundColor:n.colors.surface}})}),e.jsx("span",{children:g.label})]}),h<u.length-1&&e.jsx("div",{className:"flex items-center justify-center",style:{width:"20px",height:"28px",color:j?n.colors.accent:y?n.colors.accent+"40":n.colors.border,fontSize:"36px",fontWeight:"bold"},children:"â†’"})]},g.id)})})]})},cf=O.memo(af),Aa=({isFullscreen:t})=>{const{currentTheme:s}=ee(),{currentLanguage:r}=X(),{formData:l}=fs(),n=O.useDeferredValue(l),o=O.useMemo(()=>["instrument-context","position-entry","position-exit","risk-reward","notes-screenshots"].filter(M=>!!ht.sections.find(C=>C.id===M)),[]),a=O.useMemo(()=>o.map(M=>ht.sections.find(C=>C.id===M)),[o]),[c,i]=O.useState(0),d=a[c],u=a[c+1],[m,p]=O.useState(null),x=Qe(M=>M.hiddenFields);O.useEffect(()=>{if(!u)return;const M={NotesAndScreenshotsStepWrapper:()=>ns(()=>import("./NotesAndScreenshotsStep-BrkDteei.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),LeverageMarginSectionWrapper:()=>ns(()=>import("./V3LeverageMarginSection-CECNOeYD.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url),FuturesParamsSectionWrapper:()=>ns(()=>import("./V3FuturesParamsSection-CLGXK843.js"),__vite__mapDeps([6,1,2,3,4]),import.meta.url)};try{for(const C of u.fields||[]){const R=M[C.component];R&&R()}}catch{}},[c,u]);const g=O.useMemo(()=>Ps(n,[d.id]),[n,d.id]).length===0,[h,y]=O.useState(()=>{try{const M=localStorage.getItem("v3-wizard-show-summary");return M?JSON.parse(M):!0}catch{return!0}});O.useEffect(()=>{try{localStorage.setItem("v3-wizard-show-summary",JSON.stringify(h))}catch{}},[h]);const[j,v]=O.useState(0),N=O.useRef(null);O.useEffect(()=>{const M=()=>{const C=o.reduce((R,P)=>R+(Ps(l,[P]).length===0?1:0),0);v(C)};return N.current&&window.clearTimeout(N.current),N.current=window.setTimeout(M,100),()=>{N.current&&window.clearTimeout(N.current)}},[n,o]);const S=M=>{M<0||M>=a.length||(i(M),requestAnimationFrame(()=>{const C=document.getElementById("v3-wizard-scroll");C&&(C.scrollTop=0)}))},w=()=>{c<a.length-1&&S(c+1)},k=()=>{c>0&&S(c-1)};return O.useEffect(()=>{const M=C=>{if(C.key==="ArrowDown"&&(C.ctrlKey||C.metaKey)){const D=E=>E==null?!0:typeof E=="string"?E.trim()==="":typeof E=="number"?Number.isNaN(E):Array.isArray(E)?E.length===0:!1,T=[];for(const E of o){const L=ht.sections.find(B=>B.id===E);if(!L||!et(L.visibleIf)(l))continue;const _=(()=>{if(L.id!=="instrument-context")return L.fields;const B=[...L.fields],z=B.findIndex(F=>String(F.id)==="symbol"),A=B.findIndex(F=>String(F.id)==="timeframe");if(z!==-1&&A!==-1&&z>A){const[F]=B.splice(z,1),q=B.findIndex(W=>String(W.id)==="timeframe");B.splice(q,0,F)}return B})();for(const B of _){const z=String(B.id);if(B.type==="composite"&&z!=="entryDateTime"&&z!=="exitDateTime"||Array.isArray(x?.[E])&&x[E].includes(z))continue;let F=et(B.visibleIf)(l);const q=B.rules;if(Array.isArray(q))for(const W of q)et(W?.when)(l)&&typeof W.visible=="boolean"&&(F=W.visible);F&&T.push({sectionId:E,fieldId:z})}}for(const E of T){let L=!1;if(E.fieldId==="entryDateTime"?L=D(l.entryDate)||D(l.entryTime):E.fieldId==="exitDateTime"?L=D(l.exitDate)||D(l.exitTime):L=D(l[E.fieldId]),L){const U=a.findIndex(_=>_.id===E.sectionId);if(U!==-1){C.preventDefault(),C.stopPropagation(),p({sectionId:E.sectionId,fieldId:E.fieldId}),S(U),window.setTimeout(()=>{try{const _=window.__v3OverlayOpeners;if(_&&typeof _[E.fieldId]=="function"){_[E.fieldId]();return}const B=document.querySelector(`[data-field-container="${E.fieldId}"]`);if(!B)return;const z=B.querySelector('[data-overlay-trigger="true"]');z&&typeof z.click=="function"&&z.click()}catch{}},180);return}}}}const R=(document.activeElement?.tagName||"").toLowerCase();R==="input"||R==="textarea"||R==="select"||(C.key==="ArrowRight"&&(C.preventDefault(),w()),C.key==="ArrowLeft"&&(C.preventDefault(),k()),C.key==="Enter"&&(C.preventDefault(),g&&w()))};return window.addEventListener("keydown",M,!0),()=>window.removeEventListener("keydown",M,!0)},[g,c,a.length,o,l]),O.useEffect(()=>{if(m&&m.sectionId===d.id){const M=window.setTimeout(()=>p(null),600);return()=>window.clearTimeout(M)}},[m,d.id]),e.jsxs("div",{className:"grid h-full gap-4",style:{color:s.colors.text,gridTemplateColumns:h?`minmax(0,1fr) ${t?"520px":"340px"}`:"1fr"},children:[e.jsxs("div",{className:"flex flex-col min-w-0 relative",children:[e.jsx("div",{className:"mb-4",children:e.jsx(cf,{currentStepId:d.id,onStepClick:M=>{const C=o.indexOf(M);C!==-1&&S(C)},stepIds:o})}),e.jsxs("div",{id:"v3-wizard-scroll",className:"flex-1 overflow-y-auto rounded-lg border p-4",style:{borderColor:s.colors.border,backgroundColor:s.colors.card},children:[e.jsx(Xe,{sectionId:d.id,layout:"landscape",focusFieldId:m?.sectionId===d.id?m.fieldId:void 0},d.id),u?e.jsx("div",{style:{display:"none"},"aria-hidden":!0,children:e.jsx(Xe,{sectionId:u.id,layout:"landscape"},`preload-${u.id}`)}):null]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx("button",{onClick:k,disabled:c===0,className:"gpu-btn px-3 py-1.5 rounded border text-sm",style:{backgroundColor:s.colors.surface,color:s.colors.text,borderColor:s.colors.border,opacity:c===0?.5:1},children:r==="fr"?"Retour":"Back"}),e.jsx("button",{onClick:w,disabled:!g||c===a.length-1,className:"gpu-btn px-3 py-1.5 rounded border text-sm",style:{backgroundColor:g?s.colors.accent:s.colors.surface,color:g?"#fff":s.colors.text,borderColor:g?"transparent":s.colors.border,opacity:c===a.length-1?.5:1},children:r==="fr"?"Suivant":"Next"})]}),!h&&e.jsx("button",{onClick:()=>y(!0),className:"absolute right-0 top-1/2 px-2 py-1 text-xs rounded-l border",style:{transform:"translateY(-50%)",backgroundColor:s.colors.surface,color:s.colors.text,borderColor:s.colors.border},title:r==="fr"?"Afficher le rÃ©sumÃ©":"Show summary",children:"â–¶"})]}),h&&e.jsx("div",{className:"flex flex-col gap-4 min-w-0",children:e.jsxs("div",{className:"sticky top-0 relative space-y-4",children:[e.jsx("button",{onClick:()=>y(!1),className:"absolute -left-3 top-1/2 px-2 py-1 text-xs rounded-r border",style:{transform:"translateY(-50%)",backgroundColor:s.colors.surface,color:s.colors.text,borderColor:s.colors.border},title:r==="fr"?"Masquer le rÃ©sumÃ©":"Hide summary",children:"â—€"}),e.jsxs("div",{className:"rounded-lg border p-3",style:{borderColor:s.colors.border,backgroundColor:s.colors.card},children:[e.jsx("h4",{className:"text-sm font-semibold mb-3",style:{color:s.colors.text},children:r==="fr"?"RÃ©sumÃ©":"Summary"}),e.jsx(ka,{currentStepId:d.id})]}),e.jsxs("div",{className:"rounded-lg border p-3",style:{borderColor:s.colors.border,backgroundColor:s.colors.card},children:[e.jsx("div",{className:"text-xs font-medium mb-2",style:{color:s.colors.textMuted},children:r==="fr"?"RÃ©sumÃ© P&L":"PnL Summary"}),e.jsx(wa,{})]})]})})]})},df=()=>{const{currentTheme:t}=ee(),{currentLanguage:s}=X(),{formData:r}=fs(),n=["instrument-context","position-entry","position-exit","risk-reward","notes-screenshots"].map(d=>ht.sections.find(u=>u.id===d)).filter(Boolean),[o,a]=O.useState({"notes-screenshots":!0}),c=d=>{a(u=>({...u,[d]:!u[d]}))},i=d=>Ps(r,[d]).length===0?"complete":"incomplete";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:[n[0]&&e.jsx(Js,{section:n[0],status:i(n[0].id),collapsed:o[n[0].id],onToggle:()=>c(n[0].id),currentTheme:t,currentLanguage:s}),n[1]&&e.jsx(Js,{section:n[1],status:i(n[1].id),collapsed:o[n[1].id],onToggle:()=>c(n[1].id),currentTheme:t,currentLanguage:s}),n[2]&&e.jsx(Js,{section:n[2],status:i(n[2].id),collapsed:o[n[2].id],onToggle:()=>c(n[2].id),currentTheme:t,currentLanguage:s})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[n[3]&&e.jsx(Js,{section:n[3],status:i(n[3].id),collapsed:o[n[3].id],onToggle:()=>c(n[3].id),currentTheme:t,currentLanguage:s}),n[4]&&e.jsx(Js,{section:n[4],status:i(n[4].id),collapsed:o[n[4].id],onToggle:()=>c(n[4].id),currentTheme:t,currentLanguage:s})]})]})},Js=({section:t,status:s,collapsed:r,onToggle:l,currentTheme:n,currentLanguage:o})=>{const a=s==="complete";return e.jsxs("div",{className:"rounded-xl border-2 transition-all",style:{backgroundColor:n.colors.card,borderColor:a?"rgba(34, 197, 94, 0.3)":n.colors.border},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b cursor-pointer",style:{borderColor:n.colors.border},onClick:l,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold",style:{color:n.colors.text},children:t.label}),a&&e.jsx("span",{className:"text-xs",style:{color:"rgb(34, 197, 94)"},children:"âœ“"})]}),e.jsx("button",{type:"button",className:"text-xs px-2 py-1 rounded",style:{color:n.colors.textMuted},children:r?"â–¼":"â–²"})]}),!r&&e.jsx("div",{className:"p-4",children:e.jsx(Xe,{sectionId:t.id})})]})},uf=()=>{const{currentTheme:t}=ee(),{currentLanguage:s}=X(),{formData:r,computed:l,settings:n,setSettings:o,updateField:a,updateFields:c}=fs(),{mode:i,setMode:d}=Fs(),[u,m]=O.useState(!0);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:`p-4 grid ${u?"grid-cols-1 lg:grid-cols-2":"grid-cols-1"} gap-6`,style:{color:t.colors.text},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm",style:{color:t.colors.textMuted},children:"Mode:"}),e.jsxs("select",{value:i,onChange:p=>d(p.target.value),className:"px-2 py-1 rounded border text-sm",style:{backgroundColor:t.colors.surface,color:t.colors.text,borderColor:t.colors.border},children:[e.jsx("option",{value:"add",children:"Add"}),e.jsx("option",{value:"form",children:"Form"}),e.jsx("option",{value:"deck",children:"Deck"}),e.jsx("option",{value:"wizard",children:"Wizard"})]}),e.jsx("button",{className:"px-2 py-1 rounded border text-xs",style:{backgroundColor:t.colors.surface,color:t.colors.text,borderColor:t.colors.border},onClick:()=>m(p=>!p),title:s==="fr"?u?"Masquer Debug":"Afficher Debug":u?"Hide Debug":"Show Debug",children:s==="fr"?u?"Masquer Debug":"Afficher Debug":u?"Hide Debug":"Show Debug"})]}),i==="add"?e.jsx(df,{}):i==="deck"?e.jsx(Ea,{}):i==="wizard"?e.jsx(Aa,{}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"V3 Demo â€” Instrument & Contexte"}),e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:t.colors.border,backgroundColor:t.colors.card},children:e.jsx(Xe,{sectionId:"instrument-context"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"V3 Demo â€” EntrÃ©e de position"}),e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:t.colors.border,backgroundColor:t.colors.card},children:e.jsx(Xe,{sectionId:"position-entry"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"V3 Demo â€” Sortie de position"}),e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:t.colors.border,backgroundColor:t.colors.card},children:e.jsx(Xe,{sectionId:"position-exit"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"V3 Demo â€” Performance & StratÃ©gie"}),e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:t.colors.border,backgroundColor:t.colors.card},children:e.jsx(Xe,{sectionId:"risk-reward"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"V3 Demo â€” Notes & Psychologie"}),e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:t.colors.border,backgroundColor:t.colors.card},children:e.jsx(Xe,{sectionId:"notes-screenshots"})})]})]}),u&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Debug / MÃ©triques"}),e.jsxs("div",{className:"rounded-lg border p-3 text-sm space-y-3",style:{borderColor:t.colors.border,backgroundColor:t.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm",style:{color:t.colors.text},children:"Capital (equity):"}),e.jsx("input",{type:"number",className:"px-2 py-1 border rounded",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,color:t.colors.text},value:Number(n.equity??1e4),onChange:p=>o(x=>({...x,equity:Number(p.target.value||0)}))})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm",style:{color:t.colors.text},children:"PnL Entry Mode:"}),e.jsxs("select",{className:"px-2 py-1 border rounded",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,color:t.colors.text},value:r.pnlEntryMode??"detailed",onChange:p=>a("pnlEntryMode",p.target.value),children:[e.jsx("option",{value:"detailed",children:"detailed"}),e.jsx("option",{value:"direct",children:"direct"})]}),e.jsx("label",{className:"text-sm",style:{color:t.colors.text},children:"PnL Mode:"}),e.jsxs("select",{className:"px-2 py-1 border rounded",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,color:t.colors.text},value:r.pnlMode??"percentage",onChange:p=>a("pnlMode",p.target.value),children:[e.jsx("option",{value:"percentage",children:"percentage"}),e.jsx("option",{value:"absolute",children:"absolute"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("button",{className:"px-3 py-1 rounded border",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,color:t.colors.text},onClick:()=>{const x=new Date().toISOString().split("T")[0];c({status:"closed",side:"long",market:"futures",symbol:"ES",date:x,entryDate:x,entryTime:"09:00:00",entryPrice:4200,quantity:1,tickSize:.25,tickValue:5,exitDate:x,exitTime:"10:00:00",exitPrice:4202,fees_commission:-2.5,pnlEntryMode:"detailed",pnlMode:"percentage"})},children:"Prefill (Futures / Long)"}),e.jsx("button",{className:"px-3 py-1 rounded border",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,color:t.colors.text},onClick:()=>{const x=new Date().toISOString().split("T")[0];c({status:"closed",side:"short",market:"stocks",symbol:"AAPL",date:x,entryDate:x,entryTime:"09:30:00",entryPrice:180,quantity:10,exitDate:x,exitTime:"15:45:00",exitPrice:178.5,fees_commission:-1.2,pnlEntryMode:"detailed",pnlMode:"percentage"})},children:"Prefill (Spot / Short)"}),e.jsx("button",{className:"px-3 py-1 rounded border",style:{backgroundColor:t.colors.card,borderColor:t.colors.border,color:t.colors.text},onClick:()=>{c({}),o({equity:1e4})},children:"Reset"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs opacity-70",children:"formData"}),e.jsx("pre",{className:"text-xs overflow-auto p-2 rounded",style:{backgroundColor:t.colors.card,border:`1px solid ${t.colors.border}`},children:JSON.stringify(r,null,2)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs opacity-70",children:"computed"}),e.jsx("pre",{className:"text-xs overflow-auto p-2 rounded",style:{backgroundColor:t.colors.card,border:`1px solid ${t.colors.border}`},children:JSON.stringify(l,null,2)})]})]})]})]})]})})},Yn=()=>e.jsx(Na,{children:e.jsx(uf,{})});var mf={lessThanXSeconds:{one:"moins dâ€™une seconde",other:"moins de {{count}} secondes"},xSeconds:{one:"1 seconde",other:"{{count}} secondes"},halfAMinute:"30 secondes",lessThanXMinutes:{one:"moins dâ€™une minute",other:"moins de {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"environ 1 heure",other:"environ {{count}} heures"},xHours:{one:"1 heure",other:"{{count}} heures"},xDays:{one:"1 jour",other:"{{count}} jours"},aboutXWeeks:{one:"environ 1 semaine",other:"environ {{count}} semaines"},xWeeks:{one:"1 semaine",other:"{{count}} semaines"},aboutXMonths:{one:"environ 1 mois",other:"environ {{count}} mois"},xMonths:{one:"1 mois",other:"{{count}} mois"},aboutXYears:{one:"environ 1 an",other:"environ {{count}} ans"},xYears:{one:"1 an",other:"{{count}} ans"},overXYears:{one:"plus dâ€™un an",other:"plus de {{count}} ans"},almostXYears:{one:"presquâ€™un an",other:"presque {{count}} ans"}},xf=function(s,r,l){var n,o=mf[s];return typeof o=="string"?n=o:r===1?n=o.one:n=o.other.replace("{{count}}",String(r)),l!=null&&l.addSuffix?l.comparison&&l.comparison>0?"dans "+n:"il y a "+n:n},ff={full:"EEEE d MMMM y",long:"d MMMM y",medium:"d MMM y",short:"dd/MM/y"},pf={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},hf={full:"{{date}} 'Ã ' {{time}}",long:"{{date}} 'Ã ' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},gf={date:uo({formats:ff,defaultWidth:"full"}),time:uo({formats:pf,defaultWidth:"full"}),dateTime:uo({formats:hf,defaultWidth:"full"})},yf={lastWeek:"eeee 'dernier Ã ' p",yesterday:"'hier Ã ' p",today:"'aujourdâ€™hui Ã ' p",tomorrow:"'demain Ã ' p'",nextWeek:"eeee 'prochain Ã ' p",other:"P"},bf=function(s,r,l,n){return yf[s]},vf={narrow:["av. J.-C","ap. J.-C"],abbreviated:["av. J.-C","ap. J.-C"],wide:["avant JÃ©sus-Christ","aprÃ¨s JÃ©sus-Christ"]},jf={narrow:["T1","T2","T3","T4"],abbreviated:["1er trim.","2Ã¨me trim.","3Ã¨me trim.","4Ã¨me trim."],wide:["1er trimestre","2Ã¨me trimestre","3Ã¨me trimestre","4Ã¨me trimestre"]},Nf={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["janv.","fÃ©vr.","mars","avr.","mai","juin","juil.","aoÃ»t","sept.","oct.","nov.","dÃ©c."],wide:["janvier","fÃ©vrier","mars","avril","mai","juin","juillet","aoÃ»t","septembre","octobre","novembre","dÃ©cembre"]},kf={narrow:["D","L","M","M","J","V","S"],short:["di","lu","ma","me","je","ve","sa"],abbreviated:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],wide:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]},wf={narrow:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"mat.",afternoon:"ap.m.",evening:"soir",night:"mat."},abbreviated:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"matin",afternoon:"aprÃ¨s-midi",evening:"soir",night:"matin"},wide:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"du matin",afternoon:"de lâ€™aprÃ¨s-midi",evening:"du soir",night:"du matin"}},Sf=function(s,r){var l=Number(s),n=r?.unit;if(l===0)return"0";var o=["year","week","hour","minute","second"],a;return l===1?a=n&&o.includes(n)?"Ã¨re":"er":a="Ã¨me",l+a},Cf={ordinalNumber:Sf,era:Bs({values:vf,defaultWidth:"wide"}),quarter:Bs({values:jf,defaultWidth:"wide",argumentCallback:function(s){return s-1}}),month:Bs({values:Nf,defaultWidth:"wide"}),day:Bs({values:kf,defaultWidth:"wide"}),dayPeriod:Bs({values:wf,defaultWidth:"wide"})},Pf=/^(\d+)(iÃ¨me|Ã¨re|Ã¨me|er|e)?/i,Mf=/\d+/i,Rf={narrow:/^(av\.J\.C|ap\.J\.C|ap\.J\.-C)/i,abbreviated:/^(av\.J\.-C|av\.J-C|apr\.J\.-C|apr\.J-C|ap\.J-C)/i,wide:/^(avant JÃ©sus-Christ|aprÃ¨s JÃ©sus-Christ)/i},Tf={any:[/^av/i,/^ap/i]},Df={narrow:/^T?[1234]/i,abbreviated:/^[1234](er|Ã¨me|e)? trim\.?/i,wide:/^[1234](er|Ã¨me|e)? trimestre/i},Ef={any:[/1/i,/2/i,/3/i,/4/i]},Ff={narrow:/^[jfmasond]/i,abbreviated:/^(janv|fÃ©vr|mars|avr|mai|juin|juill|juil|aoÃ»t|sept|oct|nov|dÃ©c)\.?/i,wide:/^(janvier|fÃ©vrier|mars|avril|mai|juin|juillet|aoÃ»t|septembre|octobre|novembre|dÃ©cembre)/i},Af={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^av/i,/^ma/i,/^juin/i,/^juil/i,/^ao/i,/^s/i,/^o/i,/^n/i,/^d/i]},Lf={narrow:/^[lmjvsd]/i,short:/^(di|lu|ma|me|je|ve|sa)/i,abbreviated:/^(dim|lun|mar|mer|jeu|ven|sam)\.?/i,wide:/^(dimanche|lundi|mardi|mercredi|jeudi|vendredi|samedi)/i},$f={narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^di/i,/^lu/i,/^ma/i,/^me/i,/^je/i,/^ve/i,/^sa/i]},If={narrow:/^(a|p|minuit|midi|mat\.?|ap\.?m\.?|soir|nuit)/i,any:/^([ap]\.?\s?m\.?|du matin|de l'aprÃ¨s[-\s]midi|du soir|de la nuit)/i},zf={any:{am:/^a/i,pm:/^p/i,midnight:/^min/i,noon:/^mid/i,morning:/mat/i,afternoon:/ap/i,evening:/soir/i,night:/nuit/i}},Of={ordinalNumber:Qa({matchPattern:Pf,parsePattern:Mf,valueCallback:function(s){return parseInt(s)}}),era:Hs({matchPatterns:Rf,defaultMatchWidth:"wide",parsePatterns:Tf,defaultParseWidth:"any"}),quarter:Hs({matchPatterns:Df,defaultMatchWidth:"wide",parsePatterns:Ef,defaultParseWidth:"any",valueCallback:function(s){return s+1}}),month:Hs({matchPatterns:Ff,defaultMatchWidth:"wide",parsePatterns:Af,defaultParseWidth:"any"}),day:Hs({matchPatterns:Lf,defaultMatchWidth:"wide",parsePatterns:$f,defaultParseWidth:"any"}),dayPeriod:Hs({matchPatterns:If,defaultMatchWidth:"any",parsePatterns:zf,defaultParseWidth:"any"})},at={code:"fr",formatDistance:xf,formatLong:gf,formatRelative:bf,localize:Cf,match:Of,options:{weekStartsOn:1,firstWeekContainsDate:4}};const La=({trade:t,onClose:s})=>{const[r,l]=b.useState(0),[n,o]=b.useState(!1),{currentLanguage:a}=X(),{currentTheme:c}=ee(),i=b.useRef(null),d=(t.screenshots||[]).map(y=>typeof y=="string"?{url:y,caption:""}:y);if(d.length===0)return null;const u=()=>{l(y=>(y+1)%d.length)},m=()=>{l(y=>(y-1+d.length)%d.length)},p=()=>{const y=document.createElement("a");y.href=d[r].url,y.download=`${t.symbol}_${t.date}_${r+1}.png`,y.click()},x=()=>{o(!n)},f=()=>{window.open(d[r].url,"_blank")},g=d[r];b.useEffect(()=>{const y=i.current;y&&y.focus()},[]);const h=y=>{y.key==="Escape"&&(y.stopPropagation(),s())};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-50",role:"dialog","aria-modal":"true","aria-labelledby":"screenshot-modal-title",tabIndex:-1,ref:i,onKeyDown:h,children:e.jsxs("div",{className:`relative ${n?"w-full h-full":"max-w-6xl max-h-full w-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 theme-surface rounded-t-lg",children:[e.jsxs("div",{className:"theme-text",children:[e.jsxs("h3",{id:"screenshot-modal-title",className:"text-lg font-semibold flex items-center",children:[t.symbol," - ",t.date&&!isNaN(new Date(t.date).getTime())?lt(new Date(t.date),"dd/MM/yyyy",{locale:at}):"N/A",g.caption&&e.jsx("span",{className:"ml-4 px-3 py-1 theme-surface rounded-lg text-sm",children:g.caption})]}),e.jsxs("p",{className:"text-sm theme-text-muted",children:[t.strategy," â€¢ ",t.side==="long"?"Long":"Short"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:x,className:"p-2 theme-text hover:theme-surface rounded-lg transition-colors","aria-label":n?a==="fr"?"Quitter le plein Ã©cran":"Exit fullscreen":a==="fr"?"Plein Ã©cran":"Fullscreen",title:n?a==="fr"?"Quitter le plein Ã©cran":"Exit fullscreen":a==="fr"?"Plein Ã©cran":"Fullscreen",children:e.jsx(mi,{size:20})}),e.jsx("button",{onClick:f,className:"p-2 theme-text hover:theme-surface rounded-lg transition-colors","aria-label":a==="fr"?"Ouvrir dans un nouvel onglet":"Open in new tab",title:a==="fr"?"Ouvrir dans un nouvel onglet":"Open in new tab",children:e.jsx(di,{size:20})}),e.jsx("button",{onClick:p,className:"p-2 theme-text hover:theme-surface rounded-lg transition-colors","aria-label":a==="fr"?"TÃ©lÃ©charger":"Download",title:a==="fr"?"TÃ©lÃ©charger":"Download",children:e.jsx(cr,{size:20})}),e.jsx("button",{onClick:s,className:"p-2 theme-text hover:theme-surface rounded-lg transition-colors","aria-label":a==="fr"?"Fermer":"Close",title:a==="fr"?"Fermer":"Close",children:e.jsx(be,{size:20})})]})]}),e.jsxs("div",{className:"relative bg-gray-800",children:[e.jsx("img",{src:g.url,alt:g.caption||`Screenshot ${r+1}`,className:"w-full h-auto max-h-[70vh] object-contain"}),d.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:m,className:"absolute left-4 top-1/2 transform -translate-y-1/2 p-2 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-all","aria-label":a==="fr"?"Image prÃ©cÃ©dente":"Previous image",children:e.jsx(cs,{size:24})}),e.jsx("button",{onClick:u,className:"absolute right-4 top-1/2 transform -translate-y-1/2 p-2 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-all","aria-label":a==="fr"?"Image suivante":"Next image",children:e.jsx(Os,{size:24})})]}),d.length>1&&e.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 px-3 py-1 bg-black bg-opacity-50 text-white rounded-full text-sm",children:[r+1," / ",d.length]})]}),d.length>1&&e.jsx("div",{className:"flex justify-center space-x-2 p-4 bg-gray-900 rounded-b-lg",children:d.map((y,j)=>e.jsx("button",{onClick:()=>l(j),className:`w-16 h-16 rounded-lg overflow-hidden border-2 transition-all ${j===r?"border-2":"theme-border hover:theme-border"}`,style:{borderColor:j===r?c.colors.accent:"var(--theme-border)"},title:y.caption||`Screenshot ${j+1}`,children:e.jsx("img",{src:y.url,alt:y.caption||`Thumbnail ${j+1}`,className:"w-full h-full object-cover"})},j))})]})})},Ts=()=>{const{currentLanguage:t}=X();return{formatCurrency:(a,c="EUR")=>{const i=t==="fr"?"fr-FR":"en-US",d=t==="fr"?c:c==="EUR"?"USD":c;return new Intl.NumberFormat(i,{style:"currency",currency:d,minimumFractionDigits:2,maximumFractionDigits:2}).format(a)},formatPercentage:a=>`${a>=0?"+":""}${a.toFixed(2)}%`,formatDate:a=>{const c=t==="fr"?"fr-FR":"en-US";return(typeof a=="string"?new Date(a):a).toLocaleDateString(c,{year:"numeric",month:"short",day:"numeric"})},formatNumber:(a,c=2)=>{const i=t==="fr"?"fr-FR":"en-US";return new Intl.NumberFormat(i,{minimumFractionDigits:c,maximumFractionDigits:c}).format(a)},formatDuration:a=>{if(!a||a===0)return"-";const c=Math.floor(a/3600),i=Math.floor(a%3600/60);return c>0?`${c}h ${i}m`:i>0?`${i}m`:`${a}s`}}},Ws=({trade:t,settings:s,onClose:r,onEdit:l,onDelete:n})=>{const{currentTheme:o}=ee(),{currentLanguage:a}=X(),{formatCurrency:c,formatPercentage:i,formatDuration:d}=Ts(),[u,m]=b.useState("info"),[p,x]=b.useState(!1),f=O.useMemo(()=>Dr(t,s,"equity",2),[t,s]),h=(()=>{if(!t.tradeResult)return{label:"-",color:o.colors.text};switch(t.tradeResult){case"tp":return{label:"Take Profit",color:o.colors.success,bgColor:"var(--theme-success)"};case"sl":return{label:"Stop Loss",color:o.colors.danger,bgColor:"var(--theme-danger)"};case"be":return{label:"Break Even",color:o.colors.warning,bgColor:"var(--theme-warning)"};default:return{label:"-",color:o.colors.text,bgColor:"var(--theme-surface)"}}})(),y=()=>t.market==="futures"?`${t.quantity||0} ${a==="fr"?"contrats":"contracts"}`:t.numberOfLots!==void 0&&t.numberOfLots!==null?`${t.numberOfLots} lots`:`${t.quantity||0} lots`,j=(t.screenshots||[]).map(v=>typeof v=="string"?{url:v,caption:""}:v);return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50",children:[e.jsxs("div",{className:"theme-surface rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col",style:{backgroundColor:o.colors.card,color:o.colors.text},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",style:{borderColor:o.colors.border},children:[e.jsxs("h2",{className:"text-xl font-semibold",style:{color:o.colors.text},children:[a==="fr"?"DÃ©tails du Trade":"Trade Details"," - ",t.symbol," - ",t.date&&!isNaN(new Date(t.date).getTime())?lt(new Date(t.date),"dd/MM/yyyy",{locale:a==="fr"?at:xt}):"N/A"]}),e.jsx("button",{onClick:r,className:"theme-text-muted hover:theme-text transition-colors",children:e.jsx(be,{size:24})})]}),e.jsxs("div",{className:"flex border-b",style:{borderColor:o.colors.border},children:[e.jsx("button",{onClick:()=>m("info"),className:`px-6 py-3 text-sm font-medium transition-colors ${u==="info"?"border-b-2":"border-b-2 border-transparent"}`,style:{color:u==="info"?o.colors.accent:o.colors.textSecondary,borderBottomColor:u==="info"?o.colors.accent:"transparent"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(As,{size:16,className:"mr-2"}),a==="fr"?"Informations":"Information"]})}),e.jsx("button",{onClick:()=>m("notes"),className:`px-6 py-3 text-sm font-medium transition-colors ${u==="notes"?"border-b-2":"border-b-2 border-transparent"}`,style:{color:u==="notes"?o.colors.accent:o.colors.textSecondary,borderBottomColor:u==="notes"?o.colors.accent:"transparent"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ss,{size:16,className:"mr-2"}),"Notes"]})}),e.jsx("button",{onClick:()=>m("screenshots"),className:`px-6 py-3 text-sm font-medium transition-colors ${u==="screenshots"?"border-b-2":"border-b-2 border-transparent"}`,style:{color:u==="screenshots"?o.colors.accent:o.colors.textSecondary,borderBottomColor:u==="screenshots"?o.colors.accent:"transparent"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(vl,{size:16,className:"mr-2"}),"Screenshots",j.length>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs rounded-full",style:{backgroundColor:o.colors.accent+"20",color:o.colors.accent},children:j.length})]})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[u==="info"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:o.colors.text},children:a==="fr"?"Informations de base":"Basic Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"Date & Heure:":"Date & Time:"}),e.jsxs("span",{className:"font-medium",style:{color:o.colors.text},children:[t.date&&!isNaN(new Date(t.date).getTime())?lt(new Date(t.date),"dd/MM/yyyy",{locale:a==="fr"?at:xt}):"N/A"," ",t.time]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"Symbole:":"Symbol:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:t.symbol})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:"Direction:"}),e.jsx("span",{className:"font-medium",style:{color:t.side==="long"?o.colors.success:o.colors.danger,fontWeight:o.id==="ultra-dark"?"600":"500"},children:t.side==="long"?"Long":"Short"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"Prix d'entrÃ©e:":"Entry Price:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:t.entryPrice})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"Prix de sortie:":"Exit Price:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:t.exitPrice||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"QuantitÃ©:":"Quantity:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:y()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"MarchÃ©:":"Market:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:t.market==="futures"?"Futures":t.market==="forex"?"Forex":t.market==="crypto"?"Crypto":t.market==="stocks"?a==="fr"?"Actions":"Stocks":t.market==="indices"?"Indices":a==="fr"?"MatiÃ¨res premiÃ¨res":"Commodities"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"Tendance:":"Trend:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:t.trend==="bullish"?a==="fr"?"HaussiÃ¨re":"Bullish":t.trend==="bearish"?a==="fr"?"BaissiÃ¨re":"Bearish":a==="fr"?"LatÃ©rale":"Sideways"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:o.colors.text},children:"Performance"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"P&L Brut:":"Gross P&L:"}),e.jsx("span",{className:"font-medium",style:{color:f.gross.greaterThanOrEqualTo(0)?o.colors.success:o.colors.danger},children:c(f.gross.toNumber(),s.currency)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:"P&L %:"}),e.jsx("span",{className:"font-medium",style:{color:f.percent.greaterThanOrEqualTo(0)?o.colors.success:o.colors.danger},children:i(f.percent.toNumber())})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:f.totalFees.greaterThanOrEqualTo(0)?"Rebate:":a==="fr"?"Frais:":"Fees:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.warning},children:c(f.totalFees.toNumber(),s.currency)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"P&L Net:":"Net P&L:"}),e.jsx("span",{className:"font-medium",style:{color:f.net.greaterThanOrEqualTo(0)?o.colors.success:o.colors.danger},children:c(f.net.toNumber(),s.currency)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"P&L Net %:":"Net P&L %:"}),e.jsx("span",{className:"font-medium",style:{color:f.percent.greaterThanOrEqualTo(0)?o.colors.success:o.colors.danger},children:i(f.percent.toNumber())})]}),t.riskReward!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:"Risk/Reward:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:t.riskReward.toFixed(2)})]}),t.duration!==void 0&&t.duration>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"DurÃ©e:":"Duration:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:d(t.duration)})]}),t.ticksGained!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:"Ticks:"}),e.jsxs("span",{className:"font-medium",style:{color:(t.ticksGained||0)>=0?o.colors.success:o.colors.danger},children:[t.ticksGained>0?"+":"",t.ticksGained," ticks"]})]}),t.tradeResult&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"RÃ©sultat:":"Result:"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:h.bgColor}}),e.jsx("span",{className:"font-medium",style:{color:h.color},children:h.label})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:o.colors.text},children:a==="fr"?"StratÃ©gie & Setup":"Strategy & Setup"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"StratÃ©gie:":"Strategy:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:t.strategy})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:"Setup:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:t.setup||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:"Timeframe:"}),e.jsx("span",{className:"font-medium",style:{color:o.colors.text},children:t.timeframe||"-"})]}),t.tags&&t.tags.length>0&&e.jsxs("div",{children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:"Tags:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:t.tags.map((v,N)=>e.jsx("span",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:o.colors.accent+"20",color:o.colors.accent},children:v},N))})]})]})]}),t.fees&&Object.values(t.fees).some(v=>v!==void 0&&v!==0)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:o.colors.text},children:a==="fr"?"Frais DÃ©taillÃ©s":"Detailed Fees"}),e.jsxs("div",{className:"space-y-3",children:[t.fees.commission!==void 0&&t.fees.commission!==0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:"Commission:"}),e.jsx("span",{className:"font-medium",style:{color:"var(--theme-warning)"},children:c(t.fees.commission,s.currency)})]}),t.fees.spread!==void 0&&t.fees.spread!==0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:"Spread:"}),e.jsx("span",{className:"font-medium",style:{color:"var(--theme-warning)"},children:c(t.fees.spread,s.currency)})]}),t.fees.swapOvernight!==void 0&&t.fees.swapOvernight!==0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"Swap Overnight:":"Overnight Swap:"}),e.jsx("span",{className:"font-medium",style:{color:"var(--theme-warning)"},children:c(t.fees.swapOvernight,s.currency)})]}),t.fees.exchangeFees!==void 0&&t.fees.exchangeFees!==0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"Frais d'Ã‰change:":"Exchange Fees:"}),e.jsx("span",{className:"font-medium",style:{color:"var(--theme-warning)"},children:c(t.fees.exchangeFees,s.currency)})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t",style:{borderColor:o.colors.border},children:[e.jsx("span",{style:{color:o.colors.textSecondary},children:a==="fr"?"Total des Frais:":"Total Fees:"}),e.jsx("span",{className:"font-medium",style:{color:"var(--theme-warning)"},children:c(t.fees.total||0,s.currency)})]})]})]})]}),u==="notes"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:o.colors.text},children:a==="fr"?"Notes & Commentaires":"Notes & Comments"}),t.notes?e.jsx("div",{className:"p-4 rounded-lg whitespace-pre-wrap",style:{backgroundColor:o.colors.surface,color:o.colors.textSecondary},children:t.notes}):e.jsx("div",{className:"p-4 rounded-lg text-center",style:{backgroundColor:o.colors.surface,color:o.colors.textMuted},children:a==="fr"?"Aucune note pour ce trade. Modifiez le trade pour ajouter des notes.":"No notes for this trade. Edit the trade to add notes."})]}),u==="screenshots"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:o.colors.text},children:a==="fr"?"Screenshots du Trade":"Trade Screenshots"}),j.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:j.map((v,N)=>e.jsxs("div",{className:"border rounded-lg overflow-hidden cursor-pointer",style:{borderColor:o.colors.border},onClick:()=>x(!0),children:[e.jsx("img",{src:v.url,alt:v.caption||`Screenshot ${N+1}`,className:"w-full h-48 object-cover"}),v.caption&&e.jsx("div",{className:"p-3 border-t",style:{borderColor:o.colors.border,backgroundColor:o.colors.surface},children:e.jsx("p",{className:"text-sm",style:{color:o.colors.textSecondary},children:v.caption})})]},N))}):e.jsx("div",{className:"p-4 rounded-lg text-center",style:{backgroundColor:o.colors.surface,color:o.colors.textMuted},children:a==="fr"?"Aucun screenshot pour ce trade. Modifiez le trade pour ajouter des screenshots.":"No screenshots for this trade. Edit the trade to add screenshots."})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t",style:{borderColor:o.colors.border},children:[e.jsxs("button",{onClick:()=>{window.confirm(a==="fr"?"ÃŠtes-vous sÃ»r de vouloir supprimer ce trade ?":"Are you sure you want to delete this trade?")&&(n(t.id),r())},className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:o.colors.danger,color:"#ffffff"},children:[e.jsx(es,{size:16}),e.jsx("span",{children:a==="fr"?"Supprimer":"Delete"})]}),e.jsxs("button",{onClick:()=>{l(t),r()},className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:o.colors.accent,color:"#ffffff"},children:[e.jsx(Go,{size:16}),e.jsx("span",{children:a==="fr"?"Modifier":"Edit"})]}),e.jsx("button",{onClick:r,className:"px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:o.colors.surface,color:o.colors.text,border:`1px solid ${o.colors.border}`},children:a==="fr"?"Fermer":"Close"})]})]}),p&&e.jsx(La,{trade:t,onClose:()=>x(!1)})]})},qf=t=>{const[s,r]=b.useState("date"),[l,n]=b.useState("desc"),o=b.useCallback(c=>{r(i=>i===c?(n(d=>d==="asc"?"desc":"asc"),i):(n("desc"),c))},[]),a=b.useMemo(()=>[...t].sort((i,d)=>{let u=i[s],m=d[s];return s==="date"?(u=new Date(i.date+" "+(i.time||"00:00")).getTime(),m=new Date(d.date+" "+(d.time||"00:00")).getTime()):s==="pnl"?(u=i.pnl||0,m=d.pnl||0):s==="pnlPercentage"?(u=i.pnlPercentage||0,m=d.pnlPercentage||0):s==="duration"?(u=i.duration||0,m=d.duration||0):s==="ticksGained"?(u=i.ticksGained||0,m=d.ticksGained||0):s==="fees"?(u=i.fees?.total||i.commission||0,m=d.fees?.total||d.commission||0):typeof u=="string"&&typeof m=="string"&&(u=u.toLowerCase(),m=m.toLowerCase()),l==="asc"?u>m?1:-1:u<m?1:-1}),[t,s,l]);return{sortField:s,sortDirection:l,handleSort:o,sortedTrades:a}},Uf=t=>{if(!t||t.length===0)return{symbols:["ES","RTY","NQ","YM","EURUSD","GBPUSD"],strategies:["Scalping","Swing","Breakout"],markets:["Futures","Forex","Crypto"],tags:["Matin","Breakout","Support"],pnlSuggestions:[">100",">500","<-100"],timeframes:["5s","15s","30s","1m","5m"],quantities:["1","2","3"],durations:["Court","Moyen","Long"],ticksSuggestions:[">10",">20","<-5","<-10"],setups:["Breakout","Support","Resistance","News"]};const s=t.reduce((w,k)=>(k.symbol&&(w[k.symbol]=(w[k.symbol]||0)+1),w),{}),r=Object.entries(s).sort(([,w],[,k])=>k-w).slice(0,8).map(([w])=>w),l=t.reduce((w,k)=>(k.strategy&&(w[k.strategy]=(w[k.strategy]||0)+1),w),{}),n=Object.entries(l).sort(([,w],[,k])=>k-w).slice(0,6).map(([w])=>w),o=t.reduce((w,k)=>(k.market&&(w[k.market]=(w[k.market]||0)+1),w),{}),a=Object.entries(o).sort(([,w],[,k])=>k-w).slice(0,4).map(([w])=>w),i=t.flatMap(w=>w.tags||[]).reduce((w,k)=>(w[k]=(w[k]||0)+1,w),{}),d=Object.entries(i).sort(([,w],[,k])=>k-w).slice(0,6).map(([w])=>w),u=t.reduce((w,k)=>(k.timeframe&&(w[k.timeframe]=(w[k.timeframe]||0)+1),w),{}),m=Object.entries(u).sort(([,w],[,k])=>k-w).slice(0,6).map(([w])=>w),p=t.reduce((w,k)=>(k.quantity&&(w[k.quantity.toString()]=(w[k.quantity.toString()]||0)+1),w),{}),x=Object.entries(p).sort(([,w],[,k])=>k-w).slice(0,4).map(([w])=>w),f=t.map(w=>w.duration||0).filter(w=>w>0).sort((w,k)=>w-k),g=[];if(f.length>0){const w=f.reduce((M,C)=>M+C,0)/f.length,k=Math.max(...f);w<60&&g.push("Court"),w>=60&&w<300&&g.push("Moyen"),k>=300&&g.push("Long")}const h=t.map(w=>w.ticksGained||0).filter(w=>w!==0).sort((w,k)=>w-k),y=[];if(h.length>0){const w=Math.max(...h),k=Math.min(...h);w>10&&y.push(">10"),w>20&&y.push(">20"),w>50&&y.push(">50"),k<-5&&y.push("<-5"),k<-10&&y.push("<-10"),k<-20&&y.push("<-20")}const j=t.reduce((w,k)=>(k.setup&&(w[k.setup]=(w[k.setup]||0)+1),w),{}),v=Object.entries(j).sort(([,w],[,k])=>k-w).slice(0,6).map(([w])=>w),N=t.map(w=>w.pnl||0).filter(w=>w!==0).sort((w,k)=>w-k),S=[];if(N.length>0){const w=Math.min(...N),k=Math.max(...N),M=N[Math.trunc(N.length/2)];k>50&&S.push(">50"),k>100&&S.push(">100"),k>200&&S.push(">200"),k>500&&S.push(">500"),k>1e3&&S.push(">1000"),w<-50&&S.push("<-50"),w<-100&&S.push("<-100"),w<-200&&S.push("<-200"),M>0&&S.push(`>${Math.trunc(M)}`)}return{symbols:r.length>0?r:["ES","RTY","NQ"],strategies:n.length>0?n:["Scalping","Swing"],markets:a.length>0?a:["Futures","Forex"],tags:d.length>0?d:["Matin","Breakout"],pnlSuggestions:S.length>0?S:[">100","<-100"],timeframes:m.length>0?m:["5s","15s","30s","1m"],quantities:x.length>0?x:["1","2"],durations:g.length>0?g:["Court","Moyen","Long"],ticksSuggestions:y.length>0?y:[">10","<-5"],setups:v.length>0?v:["Breakout","Support","News"]}},_f=(t,s,r)=>{const l=s.toLowerCase();if(r.symbols.includes(s))return!!(t.symbol&&t.symbol.toLowerCase()===l);if(r.strategies.includes(s))return!!(t.strategy&&t.strategy.toLowerCase()===l);if(r.markets.includes(s))return!!(t.market&&t.market.toLowerCase()===l);if(r.tags.includes(s))return!!(t.tags&&t.tags.some(n=>n.toLowerCase()===l));if(r.timeframes.includes(s))return!!(t.timeframe&&t.timeframe.toLowerCase()===l);if(r.quantities.includes(s))return!!(t.quantity&&t.quantity.toString()===s);if(r.durations.includes(s)){const n=t.duration||0;return s==="Court"?n<60:s==="Moyen"?n>=60&&n<300:s==="Long"?n>=300:!1}if(r.ticksSuggestions.includes(s)){const n=t.ticksGained||0;if(s.startsWith(">")){const o=s.slice(1),a=Number.parseFloat(o);return Number.isFinite(a)&&n>a}if(s.startsWith("<")){const o=s.slice(1),a=Number.parseFloat(o);return Number.isFinite(a)&&n<a}}if(r.setups.includes(s))return!!(t.setup&&t.setup.toLowerCase()===l);if(s.startsWith(">")||s.startsWith("<")){const n=t.pnl||0;if(s.startsWith(">")){const o=s.slice(1),a=Number.parseFloat(o);return Number.isFinite(a)&&n>a}if(s.startsWith("<")){const o=s.slice(1),a=Number.parseFloat(o);return Number.isFinite(a)&&n<a}}return l==="gagnant"?(t.pnl||0)>0:l==="perdant"?(t.pnl||0)<0:l==="long"?t.side==="long":l==="short"?t.side==="short":l==="open"||l==="ouvert"?t.status==="open":l==="closed"||l==="fermÃ©"?t.status==="closed":t.symbol&&t.symbol.toLowerCase().includes(l)||t.strategy&&t.strategy.toLowerCase().includes(l)||t.market&&t.market.toLowerCase().includes(l)||t.notes&&t.notes.toLowerCase().includes(l)||t.tags&&t.tags.some(n=>n.toLowerCase().includes(l))||t.date&&t.date.toLowerCase().includes(l)||t.time&&t.time.toLowerCase().includes(l)||t.side&&t.side.toLowerCase().includes(l)||t.status&&t.status.toLowerCase().includes(l)},Wf=t=>{const[s,r]=b.useState(""),[l,n]=b.useState(!1),[o,a]=b.useState([]),c=b.useMemo(()=>Uf(t),[t]),i=b.useMemo(()=>o.length===0?0:t.filter(u=>o.some(m=>_f(u,m,c))).length,[t,o,c]),d=b.useCallback(()=>{o.length>0&&(r(o.join(" ")),a([]),n(!1))},[o]);return{searchTerm:s,setSearchTerm:r,showSuggestionsModal:l,setShowSuggestionsModal:n,selectedSuggestions:o,setSelectedSuggestions:a,dynamicSuggestions:c,matchingTradesCount:i,applySelectedSuggestions:d}},Vf=()=>{const[t,s]=b.useState(null),[r,l]=b.useState(null),[n,o]=b.useState(null),a=b.useCallback(d=>{s(u=>u===d?null:d)},[]),c=b.useCallback((d,u,m)=>{m.stopPropagation(),o(d)},[]),i=b.useCallback((d,u)=>{d.stopPropagation(),u()},[]);return{expandedTrade:t,showScreenshots:r,selectedTrade:n,setShowScreenshots:l,setSelectedTrade:o,toggleExpand:a,handleRowClick:c,handleActionClick:i}},Bf=({title:t,countText:s,searchTerm:r,onSearchChange:l,onOpenSuggestions:n})=>e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("h3",{className:"text-lg font-medium theme-text",children:[t,e.jsx("span",{className:"text-sm ml-2 theme-text-muted",children:s})]})}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",placeholder:"ðŸ” Rechercher dans les trades... (symbole, stratÃ©gie, notes, >100, gagnant, etc.)",value:r,onChange:o=>l(o.target.value),className:"w-full pl-10 pr-4 py-3 text-sm border rounded-lg focus:outline-none focus:ring-2 transition-all"}),e.jsx(jt,{size:18,className:"absolute left-3 top-1/2 transform -translate-y-1/2 theme-text-muted"}),r&&e.jsx("button",{onClick:()=>l(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 p-1 rounded-full hover:theme-surface transition-colors",title:"Effacer la recherche",children:e.jsx(be,{size:16,className:"theme-text-muted hover:theme-text"})})]}),e.jsxs("button",{onClick:n,className:"px-4 py-3 text-sm theme-surface theme-text-secondary border theme-border rounded-lg hover:theme-surface transition-colors cursor-pointer flex items-center space-x-2",title:"Voir toutes les suggestions de recherche",children:[e.jsx(Nl,{size:16}),e.jsx("span",{children:"Suggestions"})]})]})})]}),Hf=({trade:t,index:s,trades:r,settings:l,locale:n,colors:o,formatCurrency:a,formatPercentage:c,formatDuration:i,onRowClick:d,onEdit:u,onDelete:m,onActionClick:p,netPnL:x,netPnLPercentage:f})=>e.jsxs("tr",{className:"border-b transition-colors hover:theme-surface",style:{borderColor:o.border,cursor:"pointer"},tabIndex:0,onClick:g=>d(t,s,g),onKeyDown:g=>{(g.key==="Enter"||g.key===" ")&&(g.preventDefault(),d(t,s,g))},children:[e.jsxs("td",{className:"px-4 py-3",style:{color:o.text},children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(bt,{size:16,className:"mr-2",style:{color:o.textMuted}}),t.date&&!isNaN(new Date(t.date).getTime())?lt(new Date(t.date),"dd/MM/yyyy",{locale:n==="fr"?at:xt}):"N/A"]}),e.jsx("div",{className:"text-xs",style:{color:o.textMuted},children:t.time})]}),e.jsxs("td",{className:"px-4 py-3",style:{color:o.text},children:[e.jsx("div",{className:"font-medium",children:t.symbol}),e.jsx("div",{className:"text-xs",style:{color:o.textMuted},children:t.market==="futures"?"Futures":t.market==="forex"?"Forex":t.market==="crypto"?"Crypto":t.market==="stocks"?n==="fr"?"Actions":"Stocks":t.market==="indices"?"Indices":n==="fr"?"MatiÃ¨res premiÃ¨res":"Commodities"})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsxs("div",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",style:{backgroundColor:t.side==="long"?`${o.success}20`:`${o.danger}20`,color:t.side==="long"?o.success:o.danger},children:[t.side==="long"?e.jsx(Xs,{size:12,className:"mr-1"}):e.jsx(fl,{size:12,className:"mr-1"}),t.side==="long"?"Long":"Short"]}),t.tradeResult&&e.jsx("div",{className:"mt-1 flex justify-center",children:e.jsx("span",{className:x>0?"text-green-500":x<0?"text-red-500":"theme-text-muted",children:"â—"})})]}),e.jsx("td",{className:"px-4 py-3",style:{color:o.text},children:e.jsx("div",{className:"font-medium",children:t.market==="futures"?`${t.quantity||0} ${n==="fr"?"contrats":"contracts"}`:`${t.numberOfLots||0} lots`})}),e.jsx("td",{className:"px-4 py-3",style:{color:o.text},children:e.jsx("div",{className:"font-medium",children:t.timeframe||"-"})}),e.jsx("td",{className:"px-4 py-3",style:{color:o.text},children:e.jsx("div",{className:"font-medium",children:i(t.duration||0)})}),e.jsxs("td",{className:"px-4 py-3",style:{color:o.text},children:[t.ticksGained!==void 0?e.jsxs("div",{className:`font-medium ${t.ticksGained>=0?"text-green-400":"text-red-400"}`,children:[t.ticksGained>0?"+":"",t.ticksGained," ticks"]}):e.jsx("div",{className:"text-xs",style:{color:o.textMuted},children:"-"}),t.tickValue!==void 0&&e.jsxs("div",{className:"text-xs",style:{color:o.textMuted},children:[t.tickValue," ",l.currency,"/tick"]})]}),e.jsx("td",{className:"px-4 py-3",style:{color:o.text},children:t.fees?.total||t.commission?e.jsx("div",{className:"font-medium text-orange-600 dark:text-orange-400",children:a(t.fees?.total!==void 0?t.fees.total:t.commission||0,l.currency)}):e.jsx("div",{className:"text-xs",style:{color:o.textMuted},children:"-"})}),e.jsxs("td",{className:"px-4 py-3",style:{color:o.text},children:[e.jsx("div",{className:"font-medium",children:t.strategy}),e.jsx("div",{className:"text-xs",style:{color:o.textMuted},children:t.setup||"-"})]}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("div",{className:`font-medium ${f>=0?"text-green-400":"text-red-400"}`,children:c(f)}),e.jsx("div",{className:`text-xs ${x>=0?"text-green-400":"text-red-400"}`,children:a(x,l.currency)}),e.jsxs("div",{className:"flex items-center justify-end space-x-1 mt-1",children:[e.jsx("button",{onClick:g=>p(g,()=>u(t)),className:"p-1 rounded transition-colors opacity-0 group-hover:opacity-100",title:n==="fr"?"Modifier":"Edit",children:"âœŽ"}),e.jsx("button",{onClick:g=>p(g,()=>m(t.id)),className:"p-1 rounded transition-colors opacity-0 group-hover:opacity-100",title:n==="fr"?"Supprimer":"Delete",children:"ðŸ—‘"})]})]})]},t.id),Gf=({trades:t,sortedTrades:s,settings:r,sortField:l,sortDirection:n,onSort:o,colors:a,locale:c,formatCurrency:i,formatPercentage:d,formatDuration:u,onRowClick:m,onEdit:p,onDelete:x,onActionClick:f})=>e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"var(--theme-surface)"},children:[e.jsx("th",{className:"px-4 py-2 text-left cursor-pointer",onClick:()=>o("date"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(bt,{size:16,className:"mr-2"}),e.jsx("span",{children:"Date"}),l==="date"&&(n==="asc"?e.jsx(mt,{size:16,className:"ml-1"}):e.jsx(Le,{size:16,className:"ml-1"}))]})}),e.jsx("th",{className:"px-4 py-2 text-left cursor-pointer",onClick:()=>o("symbol"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Me,{size:16,className:"mr-2"}),e.jsx("span",{children:"Symbol"}),l==="symbol"&&(n==="asc"?e.jsx(mt,{size:16,className:"ml-1"}):e.jsx(Le,{size:16,className:"ml-1"}))]})}),e.jsx("th",{className:"px-4 py-2 text-left cursor-pointer",onClick:()=>o("side"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(He,{size:16,className:"mr-2"}),e.jsx("span",{children:"Direction"}),l==="side"&&(n==="asc"?e.jsx(mt,{size:16,className:"ml-1"}):e.jsx(Le,{size:16,className:"ml-1"}))]})}),e.jsx("th",{className:"px-4 py-2 text-left cursor-pointer",onClick:()=>o("quantity"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Quantity"}),l==="quantity"&&(n==="asc"?e.jsx(mt,{size:16,className:"ml-1"}):e.jsx(Le,{size:16,className:"ml-1"}))]})}),e.jsx("th",{className:"px-4 py-2 text-left cursor-pointer",onClick:()=>o("timeframe"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Timeframe"}),l==="timeframe"&&(n==="asc"?e.jsx(mt,{size:16,className:"ml-1"}):e.jsx(Le,{size:16,className:"ml-1"}))]})}),e.jsx("th",{className:"px-4 py-2 text-left cursor-pointer",onClick:()=>o("duration"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Duration"}),l==="duration"&&(n==="asc"?e.jsx(mt,{size:16,className:"ml-1"}):e.jsx(Le,{size:16,className:"ml-1"}))]})}),e.jsx("th",{className:"px-4 py-2 text-left cursor-pointer",onClick:()=>o("ticksGained"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Ticks"}),l==="ticksGained"&&(n==="asc"?e.jsx(mt,{size:16,className:"ml-1"}):e.jsx(Le,{size:16,className:"ml-1"}))]})}),e.jsx("th",{className:"px-4 py-2 text-left cursor-pointer",onClick:()=>o("fees"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Fees"}),l==="fees"&&(n==="asc"?e.jsx(mt,{size:16,className:"ml-1"}):e.jsx(Le,{size:16,className:"ml-1"}))]})}),e.jsx("th",{className:"px-4 py-2 text-left cursor-pointer",onClick:()=>o("strategy"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Strategy"}),l==="strategy"&&(n==="asc"?e.jsx(mt,{size:16,className:"ml-1"}):e.jsx(Le,{size:16,className:"ml-1"}))]})}),e.jsx("th",{className:"px-4 py-2 text-right cursor-pointer",onClick:()=>o("pnl"),children:e.jsxs("div",{className:"flex items-center justify-end",children:[e.jsx("span",{children:"P&L"}),l==="pnl"&&(n==="asc"?e.jsx(mt,{size:16,className:"ml-1"}):e.jsx(Le,{size:16,className:"ml-1"}))]})})]})}),e.jsx("tbody",{children:s.map(g=>{const h=t.findIndex(N=>N.id===g.id),y=Dr(g,r,"equity",2),j=y.net.toNumber(),v=y.percent.toNumber();return e.jsx(Hf,{trade:g,index:h,trades:t,settings:r,locale:c,colors:a,formatCurrency:i,formatPercentage:d,formatDuration:u,onRowClick:m,onEdit:p,onDelete:x,onActionClick:f,netPnL:j,netPnLPercentage:v},g.id)})})]}),Jf=({isOpen:t,onClose:s,selected:r,setSelected:l,suggestions:n,matchingCount:o,totalTrades:a,onApply:c})=>{if(!t)return null;const i=d=>{l(r.includes(d)?r.filter(u=>u!==d):[...r,d])};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"theme-surface rounded-lg shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b theme-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Nl,{size:24,className:"theme-text-secondary"}),e.jsx("h2",{className:"text-xl font-bold theme-text",children:"Suggestions de recherche rapide"})]}),e.jsx("button",{onClick:s,className:"p-2 rounded-lg hover:theme-surface transition-colors",title:"Fermer",children:e.jsx(be,{size:20})})]}),r.length>0&&e.jsxs("div",{className:"mb-4 p-3 theme-surface border theme-border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(jt,{size:16,className:"theme-text-secondary"}),e.jsx("span",{className:"text-sm font-medium theme-text-secondary",children:"Trades correspondants :"})]}),e.jsx("span",{className:"text-lg font-bold theme-text-secondary",children:o})]}),e.jsxs("div",{className:"mt-2 text-xs theme-text-muted",children:['Recherche : "',r.join(" "),'"']})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 theme-text-muted hover:theme-text transition-colors border theme-border rounded hover:theme-surface",children:"Annuler"}),e.jsxs("button",{onClick:c,disabled:r.length===0,className:`px-6 py-2 rounded-lg font-medium transition-colors ${r.length>0?"theme-accent theme-text hover:theme-accent-hover shadow-sm":"theme-surface theme-text-muted cursor-not-allowed"}`,children:["Appliquer (",r.length,")"]})]})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[Kf("Symboles",n.symbols,i,r),Kt("StratÃ©gies",n.strategies,i,r,e.jsx(He,{size:18})),Kt("P&L",n.pnlSuggestions,i,r,e.jsx(Ke,{size:18})),Kt("Direction & Statut",["long","short","open","closed"],i,r,e.jsx(He,{size:18})),Kt("MarchÃ©s",n.markets,i,r,e.jsx(Me,{size:18})),Kt("Tags",n.tags,i,r,e.jsx(Me,{size:18})),Kt("Timeframes",n.timeframes,i,r,e.jsx($e,{size:18})),Kt("QuantitÃ©s",n.quantities,i,r,e.jsx(He,{size:18})),Kt("DurÃ©es",n.durations,i,r,e.jsx($e,{size:18})),Kt("Ticks",n.ticksSuggestions,i,r,e.jsx(Me,{size:18})),Kt("Setups",n.setups,i,r,e.jsx(Me,{size:18}))]}),e.jsxs("div",{className:"mt-8 p-4 theme-surface rounded-lg",children:[e.jsx("h4",{className:"text-md font-semibold mb-2 theme-text",children:"ðŸ“Š BasÃ© sur vos donnÃ©es"}),e.jsxs("div",{className:"text-sm theme-text-muted",children:["Suggestions gÃ©nÃ©rÃ©es Ã  partir de ",a," trades"]})]})]})]})})},Kf=(t,s,r,l)=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold theme-text flex items-center space-x-2",children:e.jsx("span",{children:t})}),e.jsx("div",{className:"space-y-2",children:s.map(n=>e.jsx("button",{onClick:()=>r(n),className:`w-full text-left px-3 py-2 text-sm rounded border transition-all cursor-pointer ${l.includes(n)?"theme-surface theme-text border-2":"theme-surface theme-text theme-border hover:theme-surface"}`,style:{borderColor:l.includes(n)?"var(--theme-accent)":void 0},children:n},n))})]}),Kt=(t,s,r,l,n)=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-lg font-semibold theme-text flex items-center space-x-2",children:[n,e.jsx("span",{children:t})]}),e.jsx("div",{className:"space-y-2",children:s.map(o=>e.jsx("button",{onClick:()=>r(o),className:`w-full text-left px-3 py-2 text-sm rounded border transition-all cursor-pointer ${l.includes(o)?"theme-surface theme-text border-2":"theme-surface theme-text theme-border hover:theme-surface"}`,style:{borderColor:l.includes(o)?"var(--theme-accent)":void 0},children:o},o))})]}),$a=({trades:t,onEdit:s,onDelete:r,settings:l,hideHeader:n=!1})=>{const{currentTheme:o}=ee(),{currentLanguage:a}=X(),{formatCurrency:c,formatPercentage:i,formatDuration:d}=Ts(),{sortField:u,sortDirection:m,handleSort:p,sortedTrades:x}=qf(t),{searchTerm:f,setSearchTerm:g,showSuggestionsModal:h,setShowSuggestionsModal:y,selectedSuggestions:j,setSelectedSuggestions:v,dynamicSuggestions:N,matchingTradesCount:S,applySelectedSuggestions:w}=Wf(t),{showScreenshots:k,setShowScreenshots:M,selectedTrade:C,setSelectedTrade:R,handleRowClick:P,handleActionClick:D}=Vf();return t.length===0?e.jsx("div",{className:"text-center py-8",style:{color:o.colors.textMuted},children:e.jsx("p",{children:"No trades match the filter criteria"})}):e.jsxs("div",{className:"overflow-x-auto",children:[!n&&e.jsx(Bf,{title:a==="fr"?"Liste des Trades":"Trades List",countText:f?`${x.length} trades (recherche) sur ${t.length} filtrÃ©s`:`${t.length} trades`,searchTerm:f,onSearchChange:g,onOpenSuggestions:()=>y(!0)}),e.jsx(Gf,{trades:t,sortedTrades:x,settings:l,sortField:u,sortDirection:m,onSort:p,colors:{text:o.colors.text,textMuted:o.colors.textMuted,border:o.colors.border,success:o.colors.success,danger:o.colors.danger},locale:a==="fr"?"fr":"en",formatCurrency:c,formatPercentage:i,formatDuration:d,onRowClick:P,onEdit:s,onDelete:r,onActionClick:D}),k&&e.jsx(La,{trade:k,onClose:()=>M(null)}),C&&e.jsx(Ws,{trade:C,settings:l,onClose:()=>R(null),onEdit:s,onDelete:r}),e.jsx(Jf,{isOpen:h,onClose:()=>{v([]),y(!1)},selected:j,setSelected:v,suggestions:N,matchingCount:S,totalTrades:t.length,onApply:w})]})},Ne=({title:t,value:s,icon:r,color:l,subtitle:n,compact:o=!1})=>{const{currentTheme:a}=ee(),c={primary:a.colors.accent,success:a.colors.success,danger:a.colors.danger,warning:a.colors.warning,info:a.colors.info},i=o?"p-4":"p-6",d=o?"space-y-1":"space-y-2";return e.jsx("div",{className:`rounded-lg shadow-sm border ${i}`,style:{backgroundColor:a.colors.card,borderColor:a.colors.border},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:d,children:[e.jsx("p",{className:"text-sm font-medium",style:{color:a.colors.textSecondary},children:t}),e.jsx("p",{className:`${o?"text-xl":"text-2xl"} font-bold mt-1`,style:{color:a.colors.text},children:s}),n&&e.jsx("p",{className:"text-sm mt-1",style:{color:a.colors.textMuted},children:n})]}),e.jsx("div",{className:`${o?"p-2":"p-3"} rounded-full border`,style:{backgroundColor:c[l]+"20",borderColor:c[l]+"40",color:c[l]},children:r})]})})},Yf=({stats:t,settings:s,theme:r,language:l,formatCurrency:n,formatPercentage:o,compact:a})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(Ne,{title:l==="fr"?"Capital Initial":"Initial Capital",value:n(t.initialCapital,s.currency),icon:e.jsx(Ci,{size:24}),color:"primary",compact:a}),e.jsx(Ne,{title:l==="fr"?"Capital Actuel":"Current Capital",value:n(t.currentCapital,s.currency),icon:e.jsx(Ke,{size:24}),color:t.currentCapital>=t.initialCapital?"success":"danger",subtitle:`${t.currentCapital>=t.initialCapital?"Gain":l==="fr"?"Perte":"Loss"} ${n(Math.abs(t.currentCapital-t.initialCapital),s.currency)}`,compact:a}),e.jsx(Ne,{title:l==="fr"?"Rendement Total":"Total Return",value:o(t.totalReturn),icon:e.jsx(ls,{size:24}),color:t.totalReturn>=0?"success":"danger",subtitle:`${n(t.totalPnL,s.currency)} ${l==="fr"?"de P&L":"P&L"}`,compact:a})]}),Xf=({stats:t,theme:s,language:r,formatPercentage:l,formatNumber:n,formatCurrency:o,currency:a,compact:c})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(Ne,{title:"Total Trades",value:t.totalTrades,icon:e.jsx(Me,{size:24}),color:"primary",compact:c}),e.jsx(Ne,{title:r==="fr"?"Taux de RÃ©ussite":"Win Rate",value:l(t.winRate),icon:e.jsx(us,{size:24}),color:t.winRate>=50?"success":"danger",subtitle:`${t.winningTrades} ${r==="fr"?"gagnants":"winning"} / ${t.losingTrades} ${r==="fr"?"perdants":"losing"}`,compact:c}),e.jsx(Ne,{title:"Profit Factor",value:n(t.profitFactor,2),icon:e.jsx(Rs,{size:24}),color:t.profitFactor>=1.5?"success":t.profitFactor>=1?"warning":"danger",compact:c}),e.jsx(Ne,{title:r==="fr"?"R/R Moyen":"Avg R/R",value:n(t.averageRiskReward,2),icon:e.jsx(Me,{size:24}),color:t.averageRiskReward>=2?"success":t.averageRiskReward>=1?"warning":"danger",compact:c}),e.jsx(Ne,{title:r==="fr"?"Gain Moyen":"Average Win",value:l(t.averageWinPercentage),icon:e.jsx(Ee,{size:24}),color:"success",subtitle:o(t.averageWin,a),compact:c}),e.jsx(Ne,{title:r==="fr"?"Perte Moyenne":"Average Loss",value:l(t.averageLossPercentage),icon:e.jsx(Ot,{size:24}),color:"danger",subtitle:o(t.averageLoss,a),compact:c}),e.jsx(Ne,{title:r==="fr"?"Plus Gros Gain":"Largest Win",value:l(t.largestWinPercentage),icon:e.jsx(Ee,{size:24}),color:"success",subtitle:o(t.largestWin,a),compact:c}),e.jsx(Ne,{title:r==="fr"?"Plus Grosse Perte":"Largest Loss",value:l(t.largestLossPercentage),icon:e.jsx(Ot,{size:24}),color:"danger",subtitle:o(t.largestLoss,a),compact:c})]}),Qf=({stats:t,settings:s,theme:r,language:l,formatPercentage:n})=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center",style:{color:r.colors.text},children:[e.jsx("div",{className:"mr-2",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:r.colors.success}}),e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:r.colors.danger}}),e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:r.colors.warning}})]})}),l==="fr"?"RÃ©sultats des Trades (TP/SL/BE)":"Trade Results (TP/SL/BE)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"p-6 rounded-lg shadow-sm border relative",style:{backgroundColor:r.colors.card,borderColor:r.colors.border},children:[e.jsx("div",{className:"absolute top-6 right-6",children:e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center border-2",style:{backgroundColor:`${r.colors.success}20`,borderColor:r.colors.success},children:e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:r.colors.success}})})}),e.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:r.colors.text},children:"Take Profit"}),e.jsxs("div",{className:"text-3xl font-bold mb-1",style:{color:r.colors.text},children:[t.tpCount," ","trades"]}),e.jsxs("div",{style:{color:r.colors.textSecondary},children:[n(t.tpWinRate)," ",l==="fr"?"de rÃ©ussite":"win rate"]})]}),e.jsxs("div",{className:"p-6 rounded-lg shadow-sm border relative",style:{backgroundColor:r.colors.card,borderColor:r.colors.border},children:[e.jsx("div",{className:"absolute top-6 right-6",children:e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center border-2",style:{backgroundColor:`${r.colors.danger}20`,borderColor:r.colors.danger},children:e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:r.colors.danger}})})}),e.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:r.colors.text},children:"Stop Loss"}),e.jsxs("div",{className:"text-3xl font-bold mb-1",style:{color:r.colors.text},children:[t.slCount," ","trades"]}),e.jsxs("div",{style:{color:r.colors.textSecondary},children:[n(t.slWinRate)," ",l==="fr"?"de rÃ©ussite":"win rate"]})]}),e.jsxs("div",{className:"p-6 rounded-lg shadow-sm border relative",style:{backgroundColor:r.colors.card,borderColor:r.colors.border},children:[e.jsx("div",{className:"absolute top-6 right-6",children:e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center border-2",style:{backgroundColor:`${r.colors.warning}20`,borderColor:r.colors.warning},children:e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:r.colors.warning}})})}),e.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:r.colors.text},children:"Break Even"}),e.jsxs("div",{className:"text-3xl font-bold mb-1",style:{color:r.colors.text},children:[t.beCount," ","trades"]}),e.jsxs("div",{style:{color:r.colors.textSecondary},children:[n(t.beWinRate)," ",l==="fr"?"de rÃ©ussite":"win rate"]})]})]})]}),Zf=({stats:t,settings:s,theme:r,language:l,formatNumber:n,formatPercentage:o,formatCurrency:a,compact:c})=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center",style:{color:r.colors.text},children:[e.jsx(Tt,{size:20,className:"mr-2"}),l==="fr"?"MÃ©triques AvancÃ©es":"Advanced Metrics"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(Ne,{title:l==="fr"?"Drawdown Max":"Max Drawdown",value:o(t.maxDrawdownPercentage),icon:e.jsx(Ot,{size:24}),color:"danger",subtitle:a(t.maxDrawdown,s.currency),compact:c}),e.jsx(Ne,{title:l==="fr"?"Ratio de Sharpe":"Sharpe Ratio",value:n(t.sharpeRatio,2),icon:e.jsx(bi,{size:24}),color:t.sharpeRatio>=1?"success":t.sharpeRatio>=.5?"warning":"danger",subtitle:l==="fr"?"Rendement ajustÃ© au risque":"Risk-adjusted return",compact:c}),e.jsx(Ne,{title:l==="fr"?"Score de Consistance":"Consistency Score",value:o(t.consistencyScore),icon:e.jsx(Tt,{size:24}),color:t.consistencyScore>=70?"success":t.consistencyScore>=50?"warning":"danger",subtitle:l==="fr"?"% de jours profitables":"% of profitable days",compact:c}),e.jsx(Ne,{title:l==="fr"?"Ratio de Calmar":"Calmar Ratio",value:n(t.calmarRatio,2),icon:e.jsx(Rs,{size:24}),color:t.calmarRatio>=1?"success":t.calmarRatio>=.5?"warning":"danger",subtitle:l==="fr"?"Rendement/Drawdown":"Return/Drawdown",compact:c}),e.jsx(Ne,{title:"Expectancy",value:a(t.expectancy,s.currency),icon:e.jsx(Me,{size:24}),color:t.expectancy>=0?"success":"danger",subtitle:o(t.expectancyPercentage),compact:c}),e.jsx(Ne,{title:l==="fr"?"Facteur de RÃ©cupÃ©ration":"Recovery Factor",value:n(t.recoveryFactor,2),icon:e.jsx(Xs,{size:24}),color:t.recoveryFactor>=2?"success":t.recoveryFactor>=1?"warning":"danger",subtitle:l==="fr"?"Profit/Drawdown max":"Profit/Max drawdown",compact:c}),e.jsx(Ne,{title:l==="fr"?"Trades/Jour":"Trades/Day",value:n(t.tradesPerDay,1),icon:e.jsx(bt,{size:24}),color:"info",subtitle:`${n(t.averageTradesPerMonth,1)} ${l==="fr"?"par mois":"per month"}`,compact:c}),e.jsx(Ne,{title:l==="fr"?"Meilleur/Pire Mois":"Best/Worst Month",value:`${o(t.bestMonth)} / ${o(t.worstMonth)}`,icon:e.jsx(ls,{size:24}),color:"primary",subtitle:l==="fr"?"Performance mensuelle":"Monthly performance",compact:c})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-6",children:[e.jsx(Ne,{title:l==="fr"?"SÃ©rie Actuelle":"Current Streak",value:t.consecutiveWins>0?`${t.consecutiveWins} ${l==="fr"?"gains":"wins"}`:t.consecutiveLosses>0?`${t.consecutiveLosses} ${l==="fr"?"pertes":"losses"}`:l==="fr"?"Aucune":"None",icon:e.jsx(yi,{size:24}),color:t.consecutiveWins>0?"success":t.consecutiveLosses>0?"danger":"info",subtitle:l==="fr"?"SÃ©rie en cours":"Current streak",compact:c}),e.jsx(Ne,{title:l==="fr"?"Plus Longue SÃ©rie de Gains":"Longest Win Streak",value:`${t.maxConsecutiveWins} trades`,icon:e.jsx(Xs,{size:24}),color:"success",subtitle:l==="fr"?"Record de gains consÃ©cutifs":"Record of consecutive wins",compact:c}),e.jsx(Ne,{title:l==="fr"?"Plus Longue SÃ©rie de Pertes":"Longest Loss Streak",value:`${t.maxConsecutiveLosses} trades`,icon:e.jsx(Xs,{size:24}),color:"danger",subtitle:l==="fr"?"Record de pertes consÃ©cutives":"Record of consecutive losses",compact:c}),e.jsx(Ne,{title:l==="fr"?"Rendement Mensuel":"Monthly Return",value:o(t.monthlyReturn),icon:e.jsx(bt,{size:24}),color:t.monthlyReturn>=0?"success":"danger",subtitle:l==="fr"?"Performance mensuelle moyenne":"Average monthly performance",compact:c})]})]}),ep=({stats:t,theme:s,language:r,formatDuration:l,compact:n})=>t.averageDuration<=0?null:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center",style:{color:s.colors.text},children:[e.jsx($e,{size:20,className:"mr-2"}),r==="fr"?"Statistiques de DurÃ©e":"Duration Statistics"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(Ne,{title:r==="fr"?"DurÃ©e Moyenne":"Average Duration",value:l(t.averageDuration),icon:e.jsx(ki,{size:24}),color:"info",subtitle:`${Math.round(t.averageDuration)} ${r==="fr"?"secondes":"seconds"}`,compact:n}),e.jsx(Ne,{title:r==="fr"?"Trade le Plus Court":"Shortest Trade",value:l(t.shortestTrade),icon:e.jsx(dr,{size:24}),color:"warning",subtitle:`${Math.round(t.shortestTrade)} ${r==="fr"?"secondes":"seconds"}`,compact:n}),e.jsx(Ne,{title:r==="fr"?"Trade le Plus Long":"Longest Trade",value:l(t.longestTrade),icon:e.jsx($e,{size:24}),color:"primary",subtitle:`${Math.round(t.longestTrade)} ${r==="fr"?"secondes":"seconds"}`,compact:n}),e.jsx(Ne,{title:r==="fr"?"DurÃ©e Gagnants vs Perdants":"Winners vs Losers Duration",value:`${l(t.averageWinDuration)} / ${l(t.averageLossDuration)}`,icon:e.jsx(Me,{size:24}),color:t.averageWinDuration<t.averageLossDuration?"success":"warning",subtitle:r==="fr"?"Gagnants / Perdants":"Winners / Losers",compact:n})]})]}),tp=({stats:t,settings:s,theme:r,language:l,formatCurrency:n,formatPercentage:o,formatNumber:a,compact:c})=>{const i=`${t.totalFees<0?l==="fr"?"CoÃ»t":"Cost":l==="fr"?"CrÃ©dit":"Credit"} ${o(t.feesImpactOnProfitability)} ${l==="fr"?"du capital initial":"of initial capital"}`;return e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center",style:{color:r.colors.text},children:[e.jsx(Ke,{size:20,className:"mr-2"}),l==="fr"?"Analyse des Frais et Commissions":"Fees and Commissions Analysis"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(Ne,{title:l==="fr"?"Total des Frais":"Total Fees",value:n(t.totalFees,s.currency),icon:e.jsx(Ke,{size:24}),color:"warning",subtitle:i,compact:c}),e.jsx(Ne,{title:l==="fr"?"Frais Moyens par Trade":"Average Fees per Trade",value:n(Math.abs(t.averageFeesPerTrade),s.currency),icon:e.jsx(Me,{size:24}),color:"info",subtitle:l==="fr"?"CoÃ»t moyen par position":"Average cost per position",compact:c}),e.jsx(Ne,{title:l==="fr"?"Impact sur le P&L":"Impact on P&L",value:t.feesAsPercentageOfPnL>0?`${a(t.feesAsPercentageOfPnL,2)}%`:"N/A",icon:e.jsx(us,{size:24}),color:t.feesAsPercentageOfPnL>0?t.feesAsPercentageOfPnL<10?"success":t.feesAsPercentageOfPnL<25?"warning":"danger":"info",subtitle:t.feesAsPercentageOfPnL>0?l==="fr"?"% du P&L brut":"% of gross P&L":l==="fr"?"P&L = frais":"P&L = fees",compact:c}),e.jsx(Ne,{title:l==="fr"?"Commissions vs Autres":"Commissions vs Others",value:`${n(Math.abs(t.totalCommissions),s.currency)} / ${n(Math.abs(t.totalFees-t.totalCommissions),s.currency)}`,icon:e.jsx(ls,{size:24}),color:"primary",subtitle:l==="fr"?"Commissions / Autres frais":"Commissions / Other fees",compact:c})]}),t.totalFees>0&&(t.totalSpreads>0||t.totalSwapFees>0)&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.totalSpreads>0&&e.jsx(Ne,{title:"Total Spreads",value:n(Math.abs(t.totalSpreads),s.currency),icon:e.jsx(ls,{size:24}),color:"info",subtitle:l==="fr"?"CoÃ»t des spreads":"Cost of spreads",compact:c}),t.totalSwapFees>0&&e.jsx(Ne,{title:l==="fr"?"Frais de Financement":"Financing Fees",value:n(Math.abs(t.totalSwapFees),s.currency),icon:e.jsx($e,{size:24}),color:t.totalSwapFees>=0?"success":"danger",subtitle:l==="fr"?"Swaps overnight":"Overnight swaps",compact:c}),e.jsx(Ne,{title:l==="fr"?"EfficacitÃ© des CoÃ»ts":"Cost Efficiency",value:`${a(t.totalPnL/(t.totalPnL+t.totalFees)*100,1)}%`,icon:e.jsx(Rs,{size:24}),color:t.totalPnL>t.totalFees?"success":"danger",subtitle:l==="fr"?"P&L net vs brut":"Net vs gross P&L",compact:c})]}),t.totalFees===0&&e.jsx("div",{className:"mt-4 p-4 rounded-lg border",style:{backgroundColor:`${r.colors.accent}10`,borderColor:r.colors.accent},children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ke,{size:20,style:{color:r.colors.accent}}),e.jsx("span",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"Aucun frais enregistrÃ© dans vos trades. Les statistiques de frais s'afficheront automatiquement dÃ¨s que vous ajouterez des frais Ã  vos trades.":"No fees recorded in your trades. Fee statistics will automatically appear once you add fees to your trades."})]})}),t.totalFees>0&&e.jsx("div",{className:"mt-4 p-4 rounded-lg border",style:{backgroundColor:`${r.colors.warning}10`,borderColor:r.colors.warning},children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ke,{size:20,style:{color:r.colors.warning}}),e.jsx("span",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?`Vos frais totaux de ${n(t.totalFees,s.currency)} reprÃ©sentent ${o(t.feesImpactOnProfitability)} de votre capital initial. ${t.feesAsPercentageOfPnL>0?`Ils reprÃ©sentent ${a(t.feesAsPercentageOfPnL,2)}% de votre P&L brut.`:"Ils sont Ã©gaux Ã  votre P&L brut, ce qui signifie que vos gains sont entiÃ¨rement absorbÃ©s par les frais."}`:`Your total fees of ${n(t.totalFees,s.currency)} represent ${o(t.feesImpactOnProfitability)} of your initial capital. ${t.feesAsPercentageOfPnL>0?`They represent ${a(t.feesAsPercentageOfPnL,2)}% of your gross P&L.`:"They are equal to your gross P&L, which means your gains are entirely absorbed by fees."}`})]})})]})},sp=({stats:t,theme:s,language:r,formatNumber:l,formatPercentage:n,compact:o})=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center",style:{color:s.colors.text},children:[e.jsx(Me,{size:20,className:"mr-2"}),r==="fr"?"Statistiques de Ticks (Scalping)":"Tick Statistics (Scalping)"]}),t.totalTicks!==0?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(Ne,{title:"Total Ticks",value:l(t.totalTicks,1),icon:e.jsx(Me,{size:24}),color:t.totalTicks>=0?"success":"danger",subtitle:r==="fr"?"Ticks capturÃ©s au total":"Total captured ticks",compact:o}),e.jsx(Ne,{title:r==="fr"?"Ticks Moyens par Trade":"Average Ticks per Trade",value:l(t.averageTicksPerTrade,2),icon:e.jsx(ls,{size:24}),color:"info",subtitle:r==="fr"?"Capture moyenne":"Average capture",compact:o}),e.jsx(Ne,{title:r==="fr"?"EfficacitÃ© des Ticks":"Tick Efficiency",value:n(t.tickEfficiency),icon:e.jsx(Rs,{size:24}),color:t.tickEfficiency>=60?"success":t.tickEfficiency>=40?"warning":"danger",subtitle:r==="fr"?"% de trades avec ticks positifs":"% of trades with positive ticks",compact:o}),e.jsx(Ne,{title:r==="fr"?"Meilleure/Pire Capture":"Best/Worst Capture",value:`+${Math.round(t.bestTickCapture)} / ${Math.round(t.worstTickCapture)}`,icon:e.jsx(Ee,{size:24}),color:"primary",subtitle:r==="fr"?"Ticks max gagnÃ©s/perdus":"Max ticks gained/lost",compact:o}),e.jsx(Ne,{title:r==="fr"?"Ticks Gagnants Moyens":"Average Winning Ticks",value:l(t.averageWinTicks,2),icon:e.jsx(Ee,{size:24}),color:"success",subtitle:r==="fr"?"Capture moyenne des gains":"Average winning capture",compact:o}),e.jsx(Ne,{title:r==="fr"?"Ticks Perdants Moyens":"Average Losing Ticks",value:l(Math.abs(t.averageLossTicks),2),icon:e.jsx(Ot,{size:24}),color:"danger",subtitle:r==="fr"?"Perte moyenne en ticks":"Average loss in ticks",compact:o})]}):e.jsxs("div",{className:"p-6 rounded-lg border text-center",style:{backgroundColor:s.colors.surface,borderColor:s.colors.border},children:[e.jsx(Me,{size:48,className:"mx-auto mb-4",style:{color:s.colors.textMuted}}),e.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:s.colors.text},children:r==="fr"?"Aucune donnÃ©e de ticks":"No tick data"}),e.jsx("p",{style:{color:s.colors.textSecondary},children:r==="fr"?"Ajoutez des informations de ticks Ã  vos trades pour voir ces statistiques.":"Add tick information to your trades to see these statistics."}),e.jsx("p",{className:"text-sm mt-2",style:{color:s.colors.textMuted},children:r==="fr"?"Les ticks sont particuliÃ¨rement utiles pour le scalping et le trading haute frÃ©quence.":"Ticks are particularly useful for scalping and high-frequency trading."})]})]}),rp=({stats:t,theme:s,language:r,formatNumber:l,compact:n})=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center",style:{color:s.colors.text},children:[e.jsx(ls,{size:20,className:"mr-2"}),r==="fr"?"Statistiques de Lots":"Lot Statistics"]}),t.totalLots>0?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(Ne,{title:r==="fr"?"Total Lots TradÃ©s":"Total Lots Traded",value:l(t.totalLots,2),icon:e.jsx(ls,{size:24}),color:"primary",subtitle:r==="fr"?"Volume total en lots":"Total volume in lots",compact:n}),e.jsx(Ne,{title:r==="fr"?"Lots Moyens par Trade":"Average Lots per Trade",value:l(t.averageLotsPerTrade,2),icon:e.jsx(Me,{size:24}),color:"info",subtitle:r==="fr"?"Taille moyenne des positions":"Average position size",compact:n}),e.jsx(Ne,{title:r==="fr"?"Plus Grosse Position":"Largest Position",value:`${Math.round(t.maxLotsInSingleTrade)} lots`,icon:e.jsx(Ee,{size:24}),color:"warning",subtitle:r==="fr"?"Position la plus importante":"Most significant position",compact:n}),e.jsx(Ne,{title:r==="fr"?"Lots Gagnants vs Perdants":"Winning vs Losing Lots",value:`${l(t.averageLotsWinningTrades,2)} / ${l(t.averageLotsLosingTrades,2)}`,icon:e.jsx(Rs,{size:24}),color:t.averageLotsWinningTrades>t.averageLotsLosingTrades?"success":"warning",subtitle:r==="fr"?"Moyenne gagnants / perdants":"Average winners / losers",compact:n})]}):e.jsxs("div",{className:"p-6 rounded-lg border text-center",style:{backgroundColor:s.colors.surface,borderColor:s.colors.border},children:[e.jsx(ls,{size:48,className:"mx-auto mb-4",style:{color:s.colors.textMuted}}),e.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:s.colors.text},children:r==="fr"?"Aucune donnÃ©e de lots":"No lot data"}),e.jsx("p",{style:{color:s.colors.textSecondary},children:r==="fr"?"Ajoutez des informations sur le nombre de lots Ã  vos trades pour voir ces statistiques.":"Add information about the number of lots to your trades to see these statistics."}),e.jsx("p",{className:"text-sm mt-2",style:{color:s.colors.textMuted},children:r==="fr"?"Le nombre de lots vous aide Ã  analyser la taille de vos positions et votre gestion du risque.":"The number of lots helps you analyze your position size and risk management."})]})]}),op=({stats:t,settings:s,onOpenPreferences:r})=>{const{currentTheme:l}=ee(),{currentLanguage:n}=X(),{formatCurrency:o,formatPercentage:a,formatNumber:c,formatDuration:i}=Ts();t.totalFees<0,`${a(t.feesImpactOnProfitability)}`;const d=s.statsDisplay||{showDurationStats:!0,showTicksStats:!0,showFeesStats:!0,showLotsStats:!0,showAdvancedMetrics:!1,compactView:!1};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Yf,{stats:t,settings:s,theme:l,language:n,formatCurrency:o,formatPercentage:a,compact:!!d.compactView}),e.jsx(Xf,{stats:t,theme:l,language:n,formatPercentage:a,formatNumber:c,formatCurrency:o,currency:s.currency,compact:!!d.compactView}),e.jsx(Qf,{stats:t,settings:s,theme:l,language:n,formatPercentage:a}),d.showAdvancedMetrics&&e.jsx(Zf,{stats:t,settings:s,theme:l,language:n,formatNumber:c,formatPercentage:a,formatCurrency:o,compact:!!d.compactView}),d.showDurationStats&&e.jsx(ep,{stats:t,theme:l,language:n,formatDuration:i,compact:!!d.compactView}),d.showFeesStats&&e.jsx(tp,{stats:t,settings:s,theme:l,language:n,formatCurrency:o,formatPercentage:a,formatNumber:c,compact:!!d.compactView}),d.showTicksStats&&e.jsx(sp,{stats:t,theme:l,language:n,formatNumber:c,formatPercentage:a,compact:!!d.compactView}),d.showLotsStats&&e.jsx(rp,{stats:t,theme:l,language:n,formatNumber:c,compact:!!d.compactView})]})},np=({stats:t,settings:s,recentTrades:r,onEdit:l,onDelete:n,onOpenPreferences:o,title:a})=>e.jsxs("div",{children:[e.jsx(op,{stats:t,settings:s,onOpenPreferences:o}),r.length>0&&e.jsxs("div",{className:"card rounded-lg shadow-sm p-6 mt-6",children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 theme-text",children:[a," (",Math.min(r.length,10),")"]}),e.jsx($a,{trades:r.slice(0,10),onEdit:l,onDelete:c=>n(typeof c=="string"?c:c.id),settings:s,hideHeader:!0})]})]}),Qt=({active:t,payload:s,label:r,coordinate:l})=>{const{currentTheme:n}=ee(),{currentLanguage:o}=X();if(!t||!s||!s.length)return null;const a=s[0].payload,i=(()=>{const v={backgroundColor:n.colors.card,border:`2px solid ${n.colors.border}`,color:n.colors.text,boxShadow:"0 5px 20px rgba(0,0,0,0.3)",accentColor:n.colors.accent,sectionColors:{primary:n.colors.accent,success:n.colors.success,info:n.colors.info,warning:n.colors.warning,analysis:n.colors.accent}};return n.id==="ultra-dark"?{...v,backgroundColor:"#000000",border:"2px solid #00ff88",color:"#ffffff",boxShadow:"0 0 20px rgba(0,255,136,0.6), 0 5px 20px rgba(0,0,0,0.8)",accentColor:"#00ff88",sectionColors:{primary:"#4fc3f7",success:"#4caf50",info:"#2196f3",warning:"#ff9800",analysis:"#00ff88"}}:n.isDark?{...v,backgroundColor:"#1a1a1a",border:"2px solid #ffffff",color:"#ffffff",boxShadow:"0 5px 20px rgba(255,255,255,0.2)",accentColor:"#ffffff",sectionColors:{primary:"#4fc3f7",success:"#4caf50",info:"#2196f3",warning:"#ff9800",analysis:"#ffffff"}}:{...v,backgroundColor:"#ffffff",border:"2px solid #000000",color:"#000000",boxShadow:"0 5px 20px rgba(0,0,0,0.3)",accentColor:"#000000",sectionColors:{primary:"#1976d2",success:"#388e3c",info:"#1565c0",warning:"#f57c00",analysis:"#000000"}}})(),d=v=>{const N=v!==void 0?v:0;return new Intl.NumberFormat(o==="fr"?"fr-FR":"en-US",{style:"currency",currency:o==="fr"?"EUR":"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(N)},u=v=>{const N=v!==void 0?v:0;return`${N>=0?"+":""}${N.toFixed(2)}%`},m=v=>{if(!v||v===0)return"-";const N=Math.floor(v/3600),S=Math.floor(v%3600/60);return N>0?`${N}h ${S}m`:S>0?`${S}m`:`${v}s`},p=()=>{if(!l)return{};const v=280,N=350,S=40,w=document.querySelector(".recharts-wrapper");if(!w)return{position:"fixed",left:l.x+S,top:l.y-N/2,transform:"none",pointerEvents:"none",zIndex:999999};const k=w.getBoundingClientRect(),M=k.width,C=k.left,R=k.right,D=l.x-C<M/2;let T,E;D?(T=l.x+S,T+v>R-20&&(T=l.x-v-S)):(T=l.x-v-S,T<C+20&&(T=l.x+S)),E=l.y-N/2;const L=window.innerWidth,U=window.innerHeight,_=15;return T<_?T=_:T+v>L-_&&(T=L-v-_),E<_?E=_:E+N>U-_&&(E=U-N-_),{position:"fixed",left:T,top:E,transform:"none",pointerEvents:"none",zIndex:999999}},x=({title:v,color:N,children:S})=>e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("div",{style:{color:N,fontSize:"11px",fontWeight:"700",marginBottom:"4px",borderBottom:`1px solid ${N}40`,paddingBottom:"2px"},children:v}),e.jsx("div",{style:{paddingLeft:"4px"},children:S})]}),f=({label:v,value:N,valueColor:S})=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px",fontSize:"12px"},children:[e.jsxs("span",{style:{color:i.color+"cc"},children:[v,":"]}),e.jsx("span",{style:{fontWeight:"700",color:S||i.color,marginLeft:"8px"},children:N})]}),h=(v=>{const N=[];if(v.winRate!==void 0&&(v.winRate>=80?N.push(o==="fr"?"ðŸ”¥ Performance Exceptionnelle":"ðŸ”¥ Exceptional Performance"):v.winRate>=70?N.push(o==="fr"?"âœ… Performance Solide":"âœ… Solid Performance"):v.winRate>=60?N.push(o==="fr"?"ðŸ‘ Performance Correcte":"ðŸ‘ Good Performance"):v.winRate>=50?N.push(o==="fr"?"âš ï¸ Performance Moyenne":"âš ï¸ Average Performance"):N.push(o==="fr"?"âŒ Performance Faible":"âŒ Poor Performance"),v.windowPnLPercentage!==void 0&&(v.windowPnLPercentage>=5?N.push(o==="fr"?"ðŸ’° FenÃªtre TrÃ¨s Profitable":"ðŸ’° Highly Profitable Window"):v.windowPnLPercentage>=2?N.push(o==="fr"?"ðŸ’š FenÃªtre Profitable":"ðŸ’š Profitable Window"):v.windowPnLPercentage>=0?N.push(o==="fr"?"ðŸŸ¡ FenÃªtre Ã‰quilibrÃ©e":"ðŸŸ¡ Balanced Window"):v.windowPnLPercentage>=-2?N.push(o==="fr"?"ðŸŸ  FenÃªtre en DifficultÃ©":"ðŸŸ  Struggling Window"):N.push(o==="fr"?"ðŸ”´ FenÃªtre ProblÃ©matique":"ðŸ”´ Problematic Window"))),v.drawdown!==void 0){const S=Math.abs(v.drawdown??0);S<=2?N.push(o==="fr"?"ðŸ›¡ï¸ Drawdown Excellent":"ðŸ›¡ï¸ Excellent Drawdown"):S<=5?N.push(o==="fr"?"âœ… Drawdown Acceptable":"âœ… Acceptable Drawdown"):S<=10?N.push(o==="fr"?"âš ï¸ Drawdown ModÃ©rÃ©":"âš ï¸ Moderate Drawdown"):S<=20?N.push(o==="fr"?"ðŸŸ  Drawdown Ã‰levÃ©":"ðŸŸ  High Drawdown"):N.push(o==="fr"?"ðŸ”´ Drawdown Critique":"ðŸ”´ Critical Drawdown"),(v.capital??0)>(v.peak??0)*.98?N.push(o==="fr"?"ðŸ“ˆ Proche du Peak":"ðŸ“ˆ Near Peak"):(v.capital??0)>(v.peak??0)*.95&&N.push(o==="fr"?"ðŸŽ¯ RÃ©cupÃ©ration en Cours":"ðŸŽ¯ Recovery in Progress")}if(v.cumulativePercentage!==void 0&&(v.tradeNumber??0)>0&&(v.cumulativePercentage>=20?N.push(o==="fr"?"ðŸš€ Croissance Exceptionnelle":"ðŸš€ Exceptional Growth"):v.cumulativePercentage>=10?N.push(o==="fr"?"ðŸ’ª Croissance Solide":"ðŸ’ª Solid Growth"):v.cumulativePercentage>=5?N.push(o==="fr"?"ðŸ“Š Progression Positive":"ðŸ“Š Positive Progression"):v.cumulativePercentage>=0?N.push(o==="fr"?"ðŸŸ¡ Ã‰quilibre Maintenu":"ðŸŸ¡ Balance Maintained"):v.cumulativePercentage>=-5?N.push(o==="fr"?"âš ï¸ LÃ©ger Recul":"âš ï¸ Slight Decline"):N.push(o==="fr"?"ðŸ”´ Correction NÃ©cessaire":"ðŸ”´ Correction Needed"),v.tradePercentage!==void 0&&(v.tradePercentage>=2?N.push("ðŸŽ¯ Excellent Trade"):v.tradePercentage>=1?N.push(o==="fr"?"âœ… Bon Trade":"âœ… Good Trade"):v.tradePercentage>=0?N.push(o==="fr"?"ðŸ‘ Trade Positif":"ðŸ‘ Positive Trade"):v.tradePercentage>=-1?N.push(o==="fr"?"ðŸŸ  Perte ContrÃ´lÃ©e":"ðŸŸ  Controlled Loss"):N.push(o==="fr"?"ðŸ”´ Perte Importante":"ðŸ”´ Significant Loss"))),v.range&&v.percentage!==void 0&&(v.percentage>=30?N.push(o==="fr"?"ðŸŽ¯ Tranche Dominante":"ðŸŽ¯ Dominant Range"):v.percentage>=20?N.push(o==="fr"?"ðŸ“Š Tranche Importante":"ðŸ“Š Important Range"):v.percentage>=10?N.push(o==="fr"?"ðŸ‘ Tranche Significative":"ðŸ‘ Significant Range"):N.push(o==="fr"?"ðŸ“ˆ Tranche Mineure":"ðŸ“ˆ Minor Range"),(v.totalPnLPercentage??0)>=5?N.push(o==="fr"?"ðŸ’° Tranche TrÃ¨s Profitable":"ðŸ’° Highly Profitable Range"):(v.totalPnLPercentage??0)>=0?N.push(o==="fr"?"âœ… Tranche Profitable":"âœ… Profitable Range"):N.push(o==="fr"?"âš ï¸ Tranche DÃ©ficitaire":"âš ï¸ Loss-Making Range")),v.fullStrategy&&v.winRate!==void 0&&(v.winRate>=70&&(v.profitFactor??0)>=2?N.push(o==="fr"?"ðŸ† StratÃ©gie d'Elite":"ðŸ† Elite Strategy"):v.winRate>=60&&(v.profitFactor??0)>=1.5?N.push(o==="fr"?"â­ StratÃ©gie Solide":"â­ Solid Strategy"):v.winRate>=50&&(v.profitFactor??0)>=1.2?N.push(o==="fr"?"ðŸ‘ StratÃ©gie Viable":"ðŸ‘ Viable Strategy"):(v.profitFactor??0)>=1?N.push(o==="fr"?"ðŸŸ¡ StratÃ©gie Marginale":"ðŸŸ¡ Marginal Strategy"):N.push(o==="fr"?"ðŸ”´ StratÃ©gie Ã  Revoir":"ðŸ”´ Strategy to Review"),(v.trades??0)>=20?N.push(o==="fr"?"ðŸ“Š Ã‰chantillon Significatif":"ðŸ“Š Significant Sample"):(v.trades??0)>=10?N.push(o==="fr"?"ðŸ“ˆ Ã‰chantillon Correct":"ðŸ“ˆ Adequate Sample"):N.push(o==="fr"?"âš ï¸ Ã‰chantillon LimitÃ©":"âš ï¸ Limited Sample")),v.cumulativeTicks!==void 0&&(v.tradeNumber??0)>0&&(v.cumulativeTicks>=100?N.push(o==="fr"?"ðŸŽ¯ Capture Exceptionnelle":"ðŸŽ¯ Exceptional Capture"):v.cumulativeTicks>=50?N.push(o==="fr"?"âœ… Capture Solide":"âœ… Solid Capture"):v.cumulativeTicks>=0?N.push(o==="fr"?"ðŸ‘ Capture Positive":"ðŸ‘ Positive Capture"):v.cumulativeTicks>=-25?N.push(o==="fr"?"âš ï¸ Capture DÃ©ficitaire":"âš ï¸ Deficit Capture"):N.push(o==="fr"?"ðŸ”´ Capture ProblÃ©matique":"ðŸ”´ Problematic Capture"),(v.tradeTicks??0)>0&&(v.tradeTicks??0)>=10?N.push(o==="fr"?"ðŸš€ Trade Excellent":"ðŸš€ Excellent Trade"):(v.tradeTicks??0)>0&&N.push(o==="fr"?"âœ… Trade Positif":"âœ… Positive Trade")),v.pnl!==void 0&&v.trades!==void 0&&!v.cumulativePercentage&&!v.winRate){(v.percentage??0)>=5?N.push(o==="fr"?"ðŸš€ PÃ©riode Exceptionnelle":"ðŸš€ Exceptional Period"):(v.percentage??0)>=2?N.push(o==="fr"?"ðŸ’° PÃ©riode TrÃ¨s Profitable":"ðŸ’° Highly Profitable Period"):(v.percentage??0)>=1?N.push(o==="fr"?"âœ… PÃ©riode Profitable":"âœ… Profitable Period"):(v.percentage??0)>=0?N.push(o==="fr"?"ðŸŸ¡ PÃ©riode Ã‰quilibrÃ©e":"ðŸŸ¡ Balanced Period"):(v.percentage??0)>=-1?N.push(o==="fr"?"âš ï¸ PÃ©riode Difficile":"âš ï¸ Difficult Period"):(v.percentage??0)>=-3?N.push(o==="fr"?"ðŸŸ  PÃ©riode ProblÃ©matique":"ðŸŸ  Problematic Period"):N.push(o==="fr"?"ðŸ”´ PÃ©riode Critique":"ðŸ”´ Critical Period"),(v.trades??0)>=10?N.push(o==="fr"?"ðŸ“Š Volume Ã‰levÃ©":"ðŸ“Š High Volume"):(v.trades??0)>=5?N.push(o==="fr"?"ðŸ“ˆ Volume ModÃ©rÃ©":"ðŸ“ˆ Moderate Volume"):(v.trades??0)>=2?N.push(o==="fr"?"ðŸ“‰ Volume Faible":"ðŸ“‰ Low Volume"):N.push(o==="fr"?"âš ï¸ Volume TrÃ¨s Faible":"âš ï¸ Very Low Volume");const S=(v.percentage??0)/Math.max(v.trades??1,1);S>=1?N.push(o==="fr"?"ðŸŽ¯ EfficacitÃ© Excellente":"ðŸŽ¯ Excellent Efficiency"):S>=.5?N.push(o==="fr"?"âœ… EfficacitÃ© Correcte":"âœ… Good Efficiency"):S>=0?N.push(o==="fr"?"ðŸ‘ EfficacitÃ© Positive":"ðŸ‘ Positive Efficiency"):N.push(o==="fr"?"ðŸ”´ EfficacitÃ© NÃ©gative":"ðŸ”´ Negative Efficiency");const w=(v.pnl??0)/1e4*100;Math.abs(w)>=2?N.push(o==="fr"?"ðŸ’¥ Impact Capital Majeur":"ðŸ’¥ Major Capital Impact"):Math.abs(w)>=1?N.push(o==="fr"?"ðŸ“Š Impact Capital Significatif":"ðŸ“Š Significant Capital Impact"):Math.abs(w)>=.5?N.push(o==="fr"?"ðŸ“ˆ Impact Capital ModÃ©rÃ©":"ðŸ“ˆ Moderate Capital Impact"):N.push(o==="fr"?"ðŸ“‰ Impact Capital Mineur":"ðŸ“‰ Minor Capital Impact")}return v.day&&v.winRate!==void 0&&(v.winRate>=80?N.push(o==="fr"?"ðŸ”¥ Jour Exceptionnel":"ðŸ”¥ Exceptional Day"):v.winRate>=65?N.push(o==="fr"?"âœ… Jour TrÃ¨s Performant":"âœ… Very Performant Day"):v.winRate>=50?N.push(o==="fr"?"ðŸ‘ Jour Positif":"ðŸ‘ Positive Day"):v.winRate>=35?N.push(o==="fr"?"âš ï¸ Jour Difficile":"âš ï¸ Challenging Day"):N.push(o==="fr"?"ðŸ”´ Jour ProblÃ©matique":"ðŸ”´ Problematic Day"),(v.trades??0)>=15?N.push(o==="fr"?"ðŸ“Š Volume Important":"ðŸ“Š High Volume"):(v.trades??0)<=3&&N.push(o==="fr"?"âš ï¸ Ã‰chantillon LimitÃ©":"âš ï¸ Limited Sample")),v.session&&v.winRate!==void 0&&(v.winRate>=75?N.push(o==="fr"?"ðŸ”¥ Session Exceptionnelle":"ðŸ”¥ Exceptional Session"):v.winRate>=60?N.push(o==="fr"?"âœ… Session Performante":"âœ… Performant Session"):v.winRate>=50?N.push(o==="fr"?"ðŸ‘ Session Positive":"ðŸ‘ Positive Session"):v.winRate>=40?N.push(o==="fr"?"âš ï¸ Session Difficile":"âš ï¸ Challenging Session"):N.push(o==="fr"?"ðŸ”´ Session Ã  Ã‰viter":"ðŸ”´ Session to Avoid"),(v.trades??0)>=20?N.push(o==="fr"?"ðŸ“Š Session TrÃ¨s Active":"ðŸ“Š Very Active Session"):(v.trades??0)<=5&&N.push(o==="fr"?"âš ï¸ ActivitÃ© LimitÃ©e":"âš ï¸ Limited Activity"),(v.pnlPercentage??0)>=5?N.push(o==="fr"?"ðŸ’° Session TrÃ¨s Profitable":"ðŸ’° Highly Profitable Session"):(v.pnlPercentage??0)<=-3&&N.push(o==="fr"?"ðŸ”´ Session CoÃ»teuse":"ðŸ”´ Costly Session")),N})(a),j=a.day&&a.dayNumber!==void 0?"weekday":a.session&&a.sessionId!==void 0?"session":a.winRate!==void 0&&a.trades!==void 0?"winrate":a.cumulativePercentage!==void 0&&(a.tradeNumber??0)>0?"pnl":a.capital!==void 0&&a.drawdown!==void 0?"equity":a.cumulativeTicks!==void 0&&(a.tradeNumber??0)>0?"ticks":a.range&&a.count!==void 0?"distribution":a.fullStrategy&&a.trades!==void 0?"performance":a.pnl!==void 0&&!a.cumulativePercentage&&!a.winRate?"periodic":"fallback";return e.jsxs("div",{className:"custom-tooltip",style:{...p(),backgroundColor:i.backgroundColor,border:i.border,borderRadius:"8px",padding:"12px",boxShadow:i.boxShadow,color:i.color,fontWeight:"600",fontSize:"12px",minWidth:"200px",maxWidth:"280px",fontFamily:"Inter, system-ui, sans-serif",lineHeight:"1.4"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"800",marginBottom:"8px",textAlign:"center",color:i.color},children:(a.tradeNumber??0)>0?`${r} â€¢ Trade #${a.tradeNumber}`:r}),j==="winrate"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{title:o==="fr"?"FenÃªtre Mobile (20 trades):":"Moving Window (20 trades):",color:i.sectionColors.primary,children:[e.jsx(f,{label:o==="fr"?"Taux de RÃ©ussite":"Win Rate",value:`${(a.winRate??0).toFixed(1)}%`,valueColor:"#4caf50"}),e.jsx(f,{label:o==="fr"?"RÃ©partition":"Distribution",value:`${a.wins||0} ${o==="fr"?"gagnants":"winners"} / ${a.losses||0} ${o==="fr"?"perdants":"losers"}`})]}),e.jsxs(x,{title:o==="fr"?"Performance de la FenÃªtre:":"Window Performance:",color:i.sectionColors.success,children:[e.jsx(f,{label:o==="fr"?"P&L Total":"Total P&L",value:u(a.windowPnLPercentage),valueColor:(a.windowPnLPercentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"En EUR":"In EUR",value:d(a.windowPnL),valueColor:(a.windowPnL??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"Moyenne/Trade":"Average/Trade",value:u(a.avgPercentagePerTrade)})]}),a.currentTrade&&e.jsxs(x,{title:o==="fr"?"Trade Actuel:":"Current Trade:",color:i.sectionColors.info,children:[e.jsx(f,{label:a.currentTrade.symbol,value:`${a.currentTrade.side==="long"?"ðŸ“ˆ Long":"ðŸ“‰ Short"}`}),e.jsx(f,{label:o==="fr"?"StratÃ©gie":"Strategy",value:a.currentTrade.strategy}),e.jsx(f,{label:o==="fr"?"RÃ©sultat":"Result",value:u(a.currentTrade.pnlPercentage),valueColor:(a.currentTrade.pnlPercentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:"Timeframe",value:a.currentTrade.timeframe}),e.jsx(f,{label:"Ticks",value:`${a.currentTrade.ticksGained||0} ticks`})]}),e.jsxs(x,{title:o==="fr"?"Analyse de la FenÃªtre:":"Window Analysis:",color:i.sectionColors.warning,children:[e.jsx(f,{label:o==="fr"?"StratÃ©gies":"Strategies",value:`${a.strategiesCount||0}`}),e.jsx(f,{label:o==="fr"?"Symboles":"Symbols",value:`${a.symbolsCount||0}`}),e.jsx(f,{label:o==="fr"?"Top StratÃ©gie":"Top Strategy",value:a.topStrategy||"-"}),e.jsx(f,{label:o==="fr"?"Top Symboles":"Top Symbols",value:Array.isArray(a.topSymbols)&&(a.topSymbols||[]).join(", ")||"-"}),e.jsx(f,{label:o==="fr"?"DurÃ©e Moyenne":"Average Duration",value:m(a.avgDuration)}),e.jsx(f,{label:o==="fr"?"Ticks Moyens":"Average Ticks",value:`${(a.avgTicks??0).toFixed(1)}`})]})]}),j==="weekday"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{title:o==="fr"?"Jour de Trading:":"Trading Day:",color:i.sectionColors.primary,children:[e.jsx(f,{label:o==="fr"?"Jour":"Day",value:a.day}),e.jsx(f,{label:o==="fr"?"Taux de RÃ©ussite":"Win Rate",value:`${(a.winRate??0).toFixed(1)}%`,valueColor:(a.winRate??0)>=50?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"RÃ©partition":"Distribution",value:`${a.wins||0} ${o==="fr"?"gagnants":"winners"} / ${a.losses||0} ${o==="fr"?"perdants":"losers"}`})]}),e.jsxs(x,{title:"Performance:",color:i.sectionColors.success,children:[e.jsx(f,{label:o==="fr"?"P&L Total":"Total P&L",value:u(a.pnlPercentage),valueColor:(a.pnlPercentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"En EUR":"In EUR",value:d(a.pnl),valueColor:(a.pnl??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"Moyenne/Trade":"Average/Trade",value:u(a.avgPnLPercentage)}),e.jsx(f,{label:o==="fr"?"Nombre de Trades":"Number of Trades",value:`${a.trades}`})]})]}),j==="session"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{title:o==="fr"?"Session de Trading:":"Trading Session:",color:i.sectionColors.primary,children:[e.jsx(f,{label:"Session",value:a.session}),e.jsx(f,{label:o==="fr"?"Taux de RÃ©ussite":"Win Rate",value:`${(a.winRate??0).toFixed(1)}%`,valueColor:(a.winRate??0)>=50?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"RÃ©partition":"Distribution",value:`${a.wins||0} ${o==="fr"?"gagnants":"winners"} / ${a.losses||0} ${o==="fr"?"perdants":"losers"}`})]}),e.jsxs(x,{title:"Performance:",color:i.sectionColors.success,children:[e.jsx(f,{label:o==="fr"?"P&L Total":"Total P&L",value:u(a.pnlPercentage),valueColor:(a.pnlPercentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"En EUR":"In EUR",value:d(a.pnl),valueColor:(a.pnl??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"Moyenne/Trade":"Average/Trade",value:u(a.avgPnLPercentage)}),e.jsx(f,{label:o==="fr"?"Nombre de Trades":"Number of Trades",value:`${a.trades}`})]}),e.jsxs(x,{title:o==="fr"?"Analyse de Session:":"Session Analysis:",color:i.sectionColors.info,children:[e.jsx(f,{label:o==="fr"?"ActivitÃ©":"Activity",value:(a.trades??0)>=20?o==="fr"?"TrÃ¨s Ã‰levÃ©e":"Very High":(a.trades??0)>=10?o==="fr"?"Ã‰levÃ©e":"High":(a.trades??0)>=5?o==="fr"?"ModÃ©rÃ©e":"Moderate":o==="fr"?"Faible":"Low"}),e.jsx(f,{label:o==="fr"?"QualitÃ©":"Quality",value:(a.winRate??0)>=70?o==="fr"?"Excellente":"Excellent":(a.winRate??0)>=55?o==="fr"?"Bonne":"Good":(a.winRate??0)>=45?o==="fr"?"Moyenne":"Average":o==="fr"?"Faible":"Poor",valueColor:(a.winRate??0)>=55?"#4caf50":(a.winRate??0)>=45?"#ff9800":"#f44336"}),e.jsx(f,{label:"Contribution",value:`${((a.trades??0)/(a.totalClosedTradesCount||1)*100).toFixed(0)}%`})]})]}),(j==="pnl"||j==="equity")&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{title:o==="fr"?"Performance Globale:":"Overall Performance:",color:i.sectionColors.success,children:[a.cumulativePercentage!==void 0&&e.jsx(f,{label:o==="fr"?"P&L CumulÃ©":"Cumulative P&L",value:u(a.cumulativePercentage),valueColor:(a.cumulativePercentage??0)>=0?"#4caf50":"#f44336"}),a.cumulativePnL!==void 0&&e.jsx(f,{label:o==="fr"?"En EUR":"In EUR",value:d(a.cumulativePnL),valueColor:(a.cumulativePnL??0)>=0?"#4caf50":"#f44336"}),a.capital&&e.jsx(f,{label:o==="fr"?"Capital Actuel":"Current Capital",value:d(a.capital),valueColor:i.sectionColors.primary})]}),e.jsxs(x,{title:o==="fr"?"Trade Actuel:":"Current Trade:",color:i.sectionColors.info,children:[e.jsx(f,{label:a.symbol,value:`${a.side==="long"?"ðŸ“ˆ Long":"ðŸ“‰ Short"}`}),e.jsx(f,{label:o==="fr"?"StratÃ©gie":"Strategy",value:a.strategy}),e.jsx(f,{label:o==="fr"?"RÃ©sultat":"Result",value:u(a.tradePercentage),valueColor:(a.tradePercentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"En EUR":"In EUR",value:d(a.tradePnL),valueColor:(a.tradePnL??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:"Timeframe",value:a.timeframe}),e.jsx(f,{label:o==="fr"?"DurÃ©e":"Duration",value:m(a.duration)}),a.ticksGained!==void 0&&a.ticksGained!==0&&e.jsx(f,{label:"Ticks",value:`${a.ticksGained>0?"+":""}${a.ticksGained} ticks`,valueColor:a.ticksGained>0?"#4caf50":"#f44336"}),(a.fees??0)>0&&e.jsx(f,{label:o==="fr"?"Frais":"Fees",value:d(a.fees),valueColor:"#ff9800"})]}),a.peak&&e.jsxs(x,{title:o==="fr"?"Analyse Drawdown:":"Drawdown Analysis:",color:i.sectionColors.warning,children:[e.jsx(f,{label:o==="fr"?"Peak Historique":"Historical Peak",value:d(a.peak),valueColor:"#4caf50"}),e.jsx(f,{label:"Drawdown",value:u(a.drawdown),valueColor:"#f44336"})]})]}),j==="distribution"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{title:o==="fr"?"Tranche de Performance:":"Performance Range:",color:i.sectionColors.primary,children:[e.jsx(f,{label:o==="fr"?"Tranche":"Range",value:a.range}),e.jsx(f,{label:"Trades",value:`${a.count}`}),e.jsx(f,{label:o==="fr"?"Pourcentage":"Percentage",value:`${(a.percentage??0).toFixed(1)}%`})]}),e.jsxs(x,{title:o==="fr"?"Performance de la Tranche:":"Range Performance:",color:i.sectionColors.success,children:[e.jsx(f,{label:o==="fr"?"P&L Total":"Total P&L",value:u(a.totalPnLPercentage),valueColor:(a.totalPnLPercentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"En EUR":"In EUR",value:d(a.totalPnL),valueColor:(a.totalPnL??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"P&L Moyen":"Average P&L",value:u(a.avgPnLPercentage)}),e.jsx(f,{label:o==="fr"?"Impact Portfolio":"Portfolio Impact",value:d(a.portfolioImpact)})]}),e.jsxs(x,{title:o==="fr"?"Analyse de la Tranche:":"Range Analysis:",color:i.sectionColors.info,children:[e.jsx(f,{label:o==="fr"?"DurÃ©e Moyenne":"Average Duration",value:m(a.avgDuration)}),e.jsx(f,{label:o==="fr"?"Ticks Moyens":"Average Ticks",value:`${(a.avgTicks??0).toFixed(1)}`}),e.jsx(f,{label:o==="fr"?"StratÃ©gies":"Strategies",value:`${a.strategiesCount}`}),e.jsx(f,{label:o==="fr"?"Symboles":"Symbols",value:`${a.symbolsCount}`})]})]}),j==="performance"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{title:o==="fr"?"StratÃ©gie:":"Strategy:",color:i.sectionColors.primary,children:[e.jsx(f,{label:o==="fr"?"Nom":"Name",value:a.fullStrategy||a.strategy||"-"}),e.jsx(f,{label:"Trades",value:`${a.trades||0}`}),e.jsx(f,{label:o==="fr"?"Taux de RÃ©ussite":"Win Rate",value:`${(a.winRate||0).toFixed(1)}%`,valueColor:(a.winRate||0)>=50?"#4caf50":"#f44336"})]}),e.jsxs(x,{title:"Performance:",color:i.sectionColors.success,children:[e.jsx(f,{label:o==="fr"?"P&L Total":"Total P&L",value:u(a.totalPercentage),valueColor:(a.totalPercentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"En EUR":"In EUR",value:d(a.totalPnL),valueColor:(a.totalPnL??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"P&L Moyen":"Average P&L",value:u(a.avgPercentage)}),e.jsx(f,{label:"Profit Factor",value:(a.profitFactor||0)===1/0?"âˆž":(a.profitFactor||0).toFixed(2)})]}),e.jsxs(x,{title:o==="fr"?"Analyse DÃ©taillÃ©e:":"Detailed Analysis:",color:i.sectionColors.info,children:[e.jsx(f,{label:o==="fr"?"Gain Moyen":"Average Win",value:d(a.avgWin),valueColor:"#4caf50"}),e.jsx(f,{label:o==="fr"?"Perte Moyenne":"Average Loss",value:d(a.avgLoss),valueColor:"#f44336"}),e.jsx(f,{label:o==="fr"?"DurÃ©e Moyenne":"Average Duration",value:m(a.avgDuration)}),e.jsx(f,{label:o==="fr"?"Ticks Moyens":"Average Ticks",value:`${(a.avgTicks??0).toFixed(1)}`}),e.jsx(f,{label:o==="fr"?"Frais Totaux":"Total Fees",value:d(a.totalFees),valueColor:"#ff9800"})]}),e.jsxs(x,{title:o==="fr"?"Performance de la FenÃªtre:":"Window Performance:",color:i.sectionColors.warning,children:[e.jsx(f,{label:o==="fr"?"P&L Total":"Total P&L",value:u(a.windowPnLPercentage),valueColor:(a.windowPnLPercentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"En EUR":"In EUR",value:d(a.windowPnL),valueColor:(a.windowPnL??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"Moyenne/Trade":"Average/Trade",value:u(a.avgPercentagePerTrade)}),e.jsx(f,{label:o==="fr"?"StratÃ©gies":"Strategies",value:`${a.strategiesCount||0}`}),e.jsx(f,{label:o==="fr"?"Symboles":"Symbols",value:`${a.symbolsCount||0}`}),e.jsx(f,{label:o==="fr"?"Top StratÃ©gie":"Top Strategy",value:a.topStrategy||"-"}),e.jsx(f,{label:o==="fr"?"Top Symboles":"Top Symbols",value:Array.isArray(a.topSymbols)&&(a.topSymbols||[]).join(", ")||"-"})]})]}),j==="ticks"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{title:o==="fr"?"Ticks CumulÃ©s:":"Cumulative Ticks:",color:i.sectionColors.success,children:[e.jsx(f,{label:"Total Ticks",value:`${(a.cumulativeTicks??0)>0?"+":""}${a.cumulativeTicks??0}`,valueColor:(a.cumulativeTicks??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"Ce Trade":"This Trade",value:`${(a.tradeTicks??0)>0?"+":""}${a.tradeTicks??0} ticks`,valueColor:(a.tradeTicks??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"Valeur CumulÃ©e":"Cumulative Value",value:d(a.cumulativeValue),valueColor:(a.cumulativeValue??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"Valeur ce Trade":"This Trade Value",value:d(a.tradeValue),valueColor:(a.tradeValue??0)>=0?"#4caf50":"#f44336"})]}),e.jsxs(x,{title:o==="fr"?"Trade Actuel:":"Current Trade:",color:i.sectionColors.info,children:[e.jsx(f,{label:a.symbol,value:`${a.side==="long"?"ðŸ“ˆ Long":"ðŸ“‰ Short"}`}),e.jsx(f,{label:o==="fr"?"StratÃ©gie":"Strategy",value:a.strategy}),e.jsx(f,{label:o==="fr"?"Valeur/Tick":"Value/Tick",value:d(a.tickValue)}),e.jsx(f,{label:"Timeframe",value:a.timeframe}),e.jsx(f,{label:o==="fr"?"DurÃ©e":"Duration",value:m(a.duration)}),e.jsx(f,{label:o==="fr"?"P&L Trade":"Trade P&L",value:u(a.pnlPercentage),valueColor:(a.pnlPercentage??0)>=0?"#4caf50":"#f44336"}),(a.fees??0)>0&&e.jsx(f,{label:o==="fr"?"Frais":"Fees",value:d(a.fees),valueColor:"#ff9800"})]})]}),j==="periodic"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{title:o==="fr"?"PÃ©riode AnalysÃ©e:":"Analyzed Period:",color:i.sectionColors.primary,children:[e.jsx(f,{label:"Date",value:r||""}),e.jsx(f,{label:o==="fr"?"Nombre de Trades":"Number of Trades",value:`${a.trades||0}`}),e.jsx(f,{label:o==="fr"?"FrÃ©quence":"Frequency",value:(a.trades??0)>=10?o==="fr"?"Ã‰levÃ©e":"High":(a.trades??0)>=5?o==="fr"?"ModÃ©rÃ©e":"Moderate":(a.trades??0)>=2?o==="fr"?"Faible":"Low":o==="fr"?"TrÃ¨s Faible":"Very Low"})]}),e.jsxs(x,{title:o==="fr"?"Performance de la PÃ©riode:":"Period Performance:",color:i.sectionColors.success,children:[e.jsx(f,{label:o==="fr"?"P&L PÃ©riode":"Period P&L",value:u(a.percentage),valueColor:(a.percentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"En EUR":"In EUR",value:d(a.pnl),valueColor:(a.pnl??0)>=0?"#4caf50":"#f44336"}),e.jsx(f,{label:o==="fr"?"P&L Moyen/Trade":"Average P&L/Trade",value:u((a.percentage??0)/Math.max(a.trades??1,1))}),e.jsx(f,{label:o==="fr"?"Impact Capital":"Capital Impact",value:`${((a.pnl??0)/1e4*100).toFixed(2)}%`,valueColor:(a.pnl??0)>=0?"#4caf50":"#f44336"})]}),e.jsxs(x,{title:o==="fr"?"Analyse de Performance:":"Performance Analysis:",color:i.sectionColors.info,children:[e.jsx(f,{label:o==="fr"?"EfficacitÃ©":"Efficiency",value:(a.trades??0)>0?`${((a.percentage??0)/(a.trades??1)).toFixed(2)}% ${o==="fr"?"par trade":"per trade"}`:"N/A",valueColor:(a.trades??0)>0&&(a.percentage??0)/(a.trades??1)>=.5?"#4caf50":"#ff9800"}),e.jsx(f,{label:o==="fr"?"IntensitÃ© Trading":"Trading Intensity",value:(a.trades??0)>=10?o==="fr"?"TrÃ¨s Active":"Very Active":(a.trades??0)>=5?"Active":(a.trades??0)>=2?o==="fr"?"ModÃ©rÃ©e":"Moderate":o==="fr"?"Faible":"Low",valueColor:(a.trades??0)>=5?"#4caf50":(a.trades??0)>=2?"#ff9800":"#f44336"}),e.jsx(f,{label:o==="fr"?"QualitÃ© PÃ©riode":"Period Quality",value:(a.percentage??0)>=2?o==="fr"?"Excellente":"Excellent":(a.percentage??0)>=1?o==="fr"?"Bonne":"Good":(a.percentage??0)>=0?o==="fr"?"Correcte":"Fair":(a.percentage??0)>=-1?o==="fr"?"Difficile":"Difficult":o==="fr"?"ProblÃ©matique":"Problematic",valueColor:(a.percentage??0)>=1?"#4caf50":(a.percentage??0)>=0?"#ff9800":"#f44336"})]}),e.jsxs(x,{title:o==="fr"?"Contexte de Trading:":"Trading Context:",color:i.sectionColors.warning,children:[e.jsx(f,{label:o==="fr"?"Volume Relatif":"Relative Volume",value:(a.trades??0)>=10?o==="fr"?"Ã‰levÃ© (>10)":"High (>10)":(a.trades??0)>=5?"Normal (5-10)":(a.trades??0)>=2?o==="fr"?"Faible (2-4)":"Low (2-4)":o==="fr"?"TrÃ¨s Faible (<2)":"Very Low (<2)"}),e.jsx(f,{label:o==="fr"?"Contribution Portfolio":"Portfolio Contribution",value:Math.abs(a.percentage??0)>=2?o==="fr"?"Majeure":"Major":Math.abs(a.percentage??0)>=1?o==="fr"?"Significative":"Significant":Math.abs(a.percentage??0)>=.5?o==="fr"?"ModÃ©rÃ©e":"Moderate":o==="fr"?"Mineure":"Minor"}),e.jsx(f,{label:o==="fr"?"Risque PÃ©riode":"Period Risk",value:Math.abs(a.percentage??0)>=3?o==="fr"?"Ã‰levÃ©":"High":Math.abs(a.percentage??0)>=1.5?o==="fr"?"ModÃ©rÃ©":"Moderate":o==="fr"?"Faible":"Low",valueColor:Math.abs(a.percentage??0)>=3?"#f44336":Math.abs(a.percentage??0)>=1.5?"#ff9800":"#4caf50"})]})]}),j==="fallback"&&e.jsx(x,{title:o==="fr"?"DonnÃ©es:":"Data:",color:i.sectionColors.primary,children:s.map((v,N)=>e.jsx(f,{label:v.name||v.dataKey,value:typeof v.value=="number"?v.value>1e3?d(v.value):v.value.toFixed(2):String(v.value||"-"),valueColor:v.color||i.sectionColors.primary},N))}),h.length>0&&e.jsx(x,{title:o==="fr"?"ðŸ§  Analyse Intelligente:":"ðŸ§  Intelligent Analysis:",color:i.sectionColors.analysis,children:h.map((v,N)=>e.jsx("div",{style:{fontSize:"11px",fontWeight:"700",marginBottom:"4px",padding:"3px 6px",borderRadius:"4px",backgroundColor:i.sectionColors.analysis+"20",color:i.sectionColors.analysis,textAlign:"center"},children:v},N))})]})},lp=({trades:t,settings:s,viewMode:r,onEditTrade:l,onDeleteTrade:n})=>{const{currentTheme:o}=ee(),{currentLanguage:a}=X(),[c,i]=b.useState(!0),[d,u]=b.useState(!0),[m,p]=b.useState(null),[x,f]=b.useState(null),g=O.useMemo(()=>{const C=t.filter(E=>E.status==="closed");if(C.length===0)return[];const R=[...C].sort((E,L)=>new Date(E.date+" "+(E.time||"00:00")).getTime()-new Date(L.date+" "+(L.time||"00:00")).getTime());let P=0,D=0,T=s.initialCapital;return[{date:a==="fr"?"DÃ©but":"Start",cumulativePnL:0,cumulativePercentage:0,capital:s.initialCapital,tradeNumber:0,tradePnL:0,tradePercentage:0,symbol:"",strategy:"",side:"",timeframe:"",duration:0,ticksGained:void 0,fees:0},...R.map((E,L)=>{const U=E.pnl||0,_=E.pnlPercentage||0;return P+=U,D+=_,T+=U,{date:E.date&&!isNaN(new Date(E.date).getTime())?lt(new Date(E.date),"dd/MM/yyyy",{locale:a==="fr"?at:xt}):"N/A",cumulativePnL:P,cumulativePercentage:D,capital:T,tradeNumber:L+1,tradePnL:U,tradePercentage:_,symbol:E.symbol,strategy:E.strategy,side:E.side,timeframe:E.timeframe||"",duration:E.duration||0,ticksGained:E.ticksGained,fees:E.fees?.total||E.commission||0,tradeId:E.id,originalTrade:E}})]},[t,s.initialCapital,a]),h=C=>new Intl.NumberFormat(a==="fr"?"fr-FR":"en-US",{style:"currency",currency:s.currency,minimumFractionDigits:0,maximumFractionDigits:0}).format(C),y=C=>`${C>=0?"+":""}${C.toFixed(2)}%`,j=()=>{if(r==="percentage"){const C=g.map(E=>E.cumulativePercentage),R=Math.min(...C),P=Math.max(...C),D=P-R,T=Math.max(D*.1,1);return{percentageDomain:[R-T,P+T],currencyDomain:"dataMin"}}else{const C=g.map(E=>E.capital),R=Math.min(...C),P=Math.max(...C),D=P-R,T=Math.max(D*.1,100);return{currencyDomain:[R-T,P+T],percentageDomain:"dataMin"}}},{percentageDomain:v,currencyDomain:N}=j(),S=C=>{if(C&&C.activePayload&&C.activePayload.length>0){const R=C.activePayload[0].payload;R.originalTrade&&p(R.originalTrade)}},w=C=>{if(C&&C.activePayload&&C.activePayload.length>0){const R=C.activePayload[0].payload;R.tradeId&&(f(R.tradeId),document.body.style.cursor="pointer")}},k=()=>{f(null),document.body.style.cursor="default"},M=C=>{const{cx:R,cy:P,payload:D,index:T}=C,E=x===D.tradeId;return e.jsx("circle",{cx:R,cy:P,r:E?6:4,fill:o.colors.accent,stroke:"#ffffff",strokeWidth:E?3:2,style:{cursor:"pointer",filter:E?"drop-shadow(0 0 6px rgba(59, 130, 246, 0.6))":"none",transition:"all 0.2s ease"},onClick:()=>{D.originalTrade&&p(D.originalTrade)}},D?.tradeId??T)};return g.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{style:{color:o.colors.textSecondary},children:a==="fr"?"Pas assez de donnÃ©es pour afficher le graphique P&L":"Not enough data to display the P&L chart"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",style:{color:o.colors.text},children:r==="percentage"?a==="fr"?"P&L CumulÃ© (Pourcentage du Capital)":"Cumulative P&L (Percentage of Capital)":a==="fr"?"Ã‰volution du Capital (EUR)":"Capital Evolution (EUR)"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>i(!c),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${c?"shadow-sm":"opacity-50"}`,style:{backgroundColor:c?o.colors.accent:o.colors.surface,color:c?"#ffffff":o.colors.textSecondary,border:`1px solid ${c?o.colors.accent:o.colors.border}`},children:[c?e.jsx(ke,{size:16,className:"mr-2"}):e.jsx(Re,{size:16,className:"mr-2"}),"Points"]}),r==="percentage"&&e.jsxs("button",{onClick:()=>u(!d),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${d?"shadow-sm":"opacity-50"}`,style:{backgroundColor:d?o.colors.warning:o.colors.surface,color:d?"#ffffff":o.colors.textSecondary,border:`1px solid ${d?o.colors.warning:o.colors.border}`},children:[d?e.jsx(ke,{size:16,className:"mr-2"}):e.jsx(Re,{size:16,className:"mr-2"}),"Capital EUR"]})]})]}),e.jsx(Ms,{width:"100%",height:400,children:r==="percentage"?e.jsxs($s,{data:g,onClick:S,onMouseMove:w,onMouseLeave:k,children:[e.jsx(as,{strokeDasharray:"3 3",stroke:o.colors.border}),e.jsx(is,{dataKey:"date",stroke:o.colors.textMuted,fontSize:12}),e.jsx(vt,{yAxisId:"percentage",stroke:o.colors.textMuted,fontSize:12,domain:v,tickFormatter:C=>`${C.toFixed(1)}%`}),d&&e.jsx(vt,{yAxisId:"currency",orientation:"right",stroke:o.colors.textMuted,fontSize:12,domain:N,tickFormatter:C=>`${Math.round(C)} ${s.currency}`}),e.jsx(Yt,{content:e.jsx(Qt,{})}),e.jsx(Wt,{}),e.jsx(ks,{y:0,yAxisId:"percentage",stroke:o.colors.textMuted,strokeDasharray:"5 5"}),e.jsx(Xt,{yAxisId:"percentage",type:"monotone",dataKey:"cumulativePercentage",stroke:o.colors.accent,strokeWidth:2,dot:c?M:!1,name:a==="fr"?"P&L CumulÃ© %":"Cumulative P&L %"}),d&&e.jsx(Xt,{yAxisId:"currency",type:"monotone",dataKey:"capital",stroke:o.colors.warning,strokeWidth:2,strokeDasharray:"5 5",dot:c?C=>{const{key:R,...P}=C,D=P?.payload?.tradeId??P?.index;return e.jsx(M,{...P,fill:o.colors.warning},D)}:!1,name:a==="fr"?"Capital en EUR":"Capital in EUR"})]}):e.jsxs($s,{data:g,onClick:S,onMouseMove:w,onMouseLeave:k,children:[e.jsx(as,{strokeDasharray:"3 3",stroke:o.colors.border}),e.jsx(is,{dataKey:"date",stroke:o.colors.textMuted,fontSize:12}),e.jsx(vt,{stroke:o.colors.textMuted,fontSize:12,domain:N,tickFormatter:C=>`${Math.round(C)} ${s.currency}`}),e.jsx(Yt,{content:e.jsx(Qt,{})}),e.jsx(Wt,{}),Array.isArray(N)&&s.initialCapital>=N[0]&&s.initialCapital<=N[1]&&e.jsx(ks,{y:s.initialCapital,stroke:o.colors.textMuted,strokeDasharray:"5 5",label:{value:a==="fr"?"Capital Initial":"Initial Capital",position:"topLeft"}}),e.jsx(Xt,{type:"monotone",dataKey:"capital",stroke:o.colors.accent,strokeWidth:2,dot:c?M:!1,name:a==="fr"?"Capital Actuel":"Current Capital"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${g[g.length-1]?.cumulativePercentage>=0?"text-green-600":"text-red-600"}`,children:y(g[g.length-1]?.cumulativePercentage||0)}),e.jsx("div",{className:"text-sm",style:{color:o.colors.textMuted},children:a==="fr"?"P&L Total":"Total P&L"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:o.colors.text},children:h(g[g.length-1]?.capital||s.initialCapital)}),e.jsx("div",{className:"text-sm",style:{color:o.colors.textMuted},children:a==="fr"?"Capital Actuel":"Current Capital"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:o.colors.text},children:t.filter(C=>C.status==="closed").length}),e.jsx("div",{className:"text-sm",style:{color:o.colors.textMuted},children:a==="fr"?"Trades Total":"Total Trades"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--theme-accent)"},children:h(s.initialCapital)}),e.jsx("div",{className:"text-sm",style:{color:o.colors.textMuted},children:a==="fr"?"Capital Initial":"Initial Capital"})]})]}),m&&e.jsx(Ws,{trade:m,settings:s,onClose:()=>p(null),onEdit:C=>{l&&l(C),p(null)},onDelete:C=>{n&&n(C),p(null)}})]})},pn=oo((t,s)=>({isOpen:!1,selectedTradeIds:[],baselineId:null,activeTab:"summary",graphMode:"side-by-side",openModal:(r=[])=>{const l=r.length>0?r:[];t({isOpen:!0,selectedTradeIds:l,baselineId:l[0]||null,activeTab:"summary",graphMode:"side-by-side"})},closeModal:()=>{t({isOpen:!1,selectedTradeIds:[],baselineId:null,activeTab:"summary",graphMode:"side-by-side"})},addTrade:r=>{const{selectedTradeIds:l}=s();if(!l.includes(r)){const n=[...l,r];t({selectedTradeIds:n,baselineId:s().baselineId||r})}},removeTrade:r=>{const{selectedTradeIds:l,baselineId:n}=s(),o=l.filter(c=>c!==r),a=n===r?o[0]||null:n;t({selectedTradeIds:o,baselineId:a})},setBaseline:r=>{t({baselineId:r})},setActiveTab:r=>{t({activeTab:r})},setGraphMode:r=>{t({graphMode:r})},clearAll:()=>{t({selectedTradeIds:[],baselineId:null,activeTab:"summary",graphMode:"side-by-side"})}})),ap=(t,s)=>{const r=s.find(n=>n.id===t)||null;return{trades:s.map(n=>{const o=n.id===t,a=r?{pnl:(n.pnl||0)-(r.pnl||0),pnlPercentage:(n.pnlPercentage||0)-(r.pnlPercentage||0),ticks:(n.ticksGained||0)-(r.ticksGained||0),duration:(n.duration||0)-(r.duration||0),riskReward:(n.riskReward||0)-(r.riskReward||0),fees:(n.fees?.total||0)-(r.fees?.total||0)}:{pnl:0,pnlPercentage:0,ticks:0,duration:0,riskReward:0,fees:0};return{trade:n,isBaseline:o,diffs:a}}),baseline:r}},ip=t=>{if(t.length===0)return{};const s={pnl:t.map(r=>r.pnl||0),pnlPercentage:t.map(r=>r.pnlPercentage||0),ticks:t.map(r=>r.ticksGained||0),duration:t.map(r=>r.duration||0),riskReward:t.map(r=>r.riskReward||0),fees:t.map(r=>r.fees?.total||0)};return{pnl:{best:Math.max(...s.pnl),worst:Math.min(...s.pnl)},pnlPercentage:{best:Math.max(...s.pnlPercentage),worst:Math.min(...s.pnlPercentage)},ticks:{best:Math.max(...s.ticks),worst:Math.min(...s.ticks)},duration:{best:Math.min(...s.duration),worst:Math.max(...s.duration)},riskReward:{best:Math.max(...s.riskReward),worst:Math.min(...s.riskReward)},fees:{best:Math.min(...s.fees),worst:Math.max(...s.fees)}}},cp=(t,s)=>{const r=t>=0?"+":"";switch(s){case"currency":return`${r}${t.toFixed(0)}â‚¬`;case"percentage":return`${r}${t.toFixed(2)}%`;case"duration":const l=Math.floor(Math.abs(t)/3600),n=Math.floor(Math.abs(t)%3600/60),o=Math.floor(Math.abs(t)%60),a=l>0?`${l}h ${n}m`:n>0?`${n}m ${o}s`:`${o}s`;return`${r}${a}`;case"number":default:return`${r}${t.toFixed(2)}`}},dp=({theme:t,language:s,onToggleTradeSelector:r,onExportCSV:l,onSave:n,onCloseAll:o})=>e.jsxs("div",{className:"flex items-center space-x-2 p-6 border-b",style:{borderColor:t.colors.border},children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:t.colors.text},children:s==="fr"?"Comparaison de Trades":"Trade Comparison"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:r,className:"p-2 rounded-lg transition-colors",style:{color:t.colors.text,backgroundColor:t.colors.surface,border:`1px solid ${t.colors.border}`},onMouseEnter:a=>{a.currentTarget.style.backgroundColor=t.colors.accent,a.currentTarget.style.color=t.colors.card},onMouseLeave:a=>{a.currentTarget.style.backgroundColor=t.colors.surface,a.currentTarget.style.color=t.colors.text},title:s==="fr"?"Ajouter/Retirer des trades":"Add/Remove trades",children:e.jsx(Ye,{size:20})}),e.jsx("button",{onClick:l,className:"p-2 rounded-lg transition-colors",style:{color:t.colors.text,backgroundColor:t.colors.surface,border:`1px solid ${t.colors.border}`},onMouseEnter:a=>{a.currentTarget.style.backgroundColor=t.colors.accent,a.currentTarget.style.color=t.colors.card},onMouseLeave:a=>{a.currentTarget.style.backgroundColor=t.colors.surface,a.currentTarget.style.color=t.colors.text},title:s==="fr"?"Exporter CSV":"Export CSV",children:e.jsx(cr,{size:20})}),e.jsx("button",{onClick:n,className:"p-2 rounded-lg transition-colors",style:{color:t.colors.text,backgroundColor:t.colors.surface,border:`1px solid ${t.colors.border}`},onMouseEnter:a=>{a.currentTarget.style.backgroundColor=t.colors.accent,a.currentTarget.style.color=t.colors.card},onMouseLeave:a=>{a.currentTarget.style.backgroundColor=t.colors.surface,a.currentTarget.style.color=t.colors.text},title:s==="fr"?"Sauvegarder":"Save",children:e.jsx(Dt,{size:20})}),e.jsx("button",{onClick:o,className:"p-2 rounded-lg transition-colors",style:{color:t.colors.text,backgroundColor:t.colors.surface,border:`1px solid ${t.colors.border}`},onMouseEnter:a=>{a.currentTarget.style.backgroundColor=t.colors.danger,a.currentTarget.style.color=t.colors.card},onMouseLeave:a=>{a.currentTarget.style.backgroundColor=t.colors.surface,a.currentTarget.style.color=t.colors.text},children:e.jsx(be,{size:20})})]})]}),up=({activeTab:t,setActiveTab:s,theme:r,language:l})=>{const n=[{id:"metrics",label:l==="fr"?"MÃ©triques":"Metrics",icon:Ni},{id:"graph",label:l==="fr"?"Graphique":"Graph",icon:He}];return e.jsx("div",{className:"flex border-b",style:{borderColor:r.colors.border},children:n.map(({id:o,label:a,icon:c})=>e.jsxs("button",{onClick:()=>s(o),className:"flex items-center space-x-2 px-6 py-3 text-sm font-medium transition-colors",style:{borderBottomColor:t===o?r.colors.accent:"transparent",color:t===o?r.colors.accent:r.colors.textMuted,backgroundColor:"transparent"},onMouseEnter:i=>{t!==o&&(i.currentTarget.style.backgroundColor=r.colors.surface)},onMouseLeave:i=>{t!==o&&(i.currentTarget.style.backgroundColor="transparent")},children:[e.jsx(c,{size:16}),e.jsx("span",{children:a})]},o))})},mp=({trades:t,selectedTradeIds:s,onToggle:r,formatDate:l,theme:n})=>e.jsx("div",{className:"p-4 border-b",style:{borderColor:n.colors.border},children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 max-h-32 overflow-y-auto",children:t.map(o=>{const a=s.includes(o.id);return e.jsxs("button",{onClick:()=>r(o.id,a),className:"p-2 rounded text-sm flex items-center space-x-2 transition-colors",style:{backgroundColor:a?n.colors.accent:n.colors.surface,color:a?n.colors.card:n.colors.text,border:`1px solid ${a?n.colors.accent:n.colors.border}`},onMouseEnter:c=>{a||(c.currentTarget.style.backgroundColor=n.colors.accent,c.currentTarget.style.color=n.colors.card)},onMouseLeave:c=>{a||(c.currentTarget.style.backgroundColor=n.colors.surface,c.currentTarget.style.color=n.colors.text)},children:[a?e.jsx(kl,{size:14}):e.jsx(Ye,{size:14}),e.jsxs("span",{children:[o.symbol," - ",l(o.date)]})]},o.id)})})}),xp=({items:t,theme:s,language:r,settings:l,onSelectIndex:n,focusedIndex:o,setBaseline:a,formatDate:c})=>{const{formatCurrency:i,formatPercentage:d,formatDuration:u}=Ts();return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(({trade:m,isBaseline:p},x)=>e.jsxs("div",{className:`p-4 rounded-lg border-2 transition-all cursor-pointer ${o===x?"ring-2 ring-blue-500":""}`,style:{borderColor:p?s.colors.accent:s.colors.border,backgroundColor:s.colors.surface},onClick:()=>n(x),children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",checked:p,onChange:()=>a(m.id),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",style:{color:s.colors.text},children:p?"Baseline":`Trade ${x+1}`})]}),e.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium ${(m.pnl||0)>=0?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:(m.pnl||0)>=0?"WIN":"LOSS"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"Date:"}),e.jsx("span",{className:"text-sm font-medium",style:{color:s.colors.text},children:c(m.date)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"Symbole:"}),e.jsx("span",{className:"text-sm font-medium",style:{color:s.colors.text},children:m.symbol})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"Direction:"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[m.side==="long"?e.jsx(Ee,{size:14,style:{color:s.colors.success}}):e.jsx(Ot,{size:14,style:{color:s.colors.danger}}),e.jsx("span",{className:"text-sm font-medium",style:{color:s.colors.text},children:m.side==="long"?"Long":"Short"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"StratÃ©gie:"}),e.jsx("span",{className:"text-sm font-medium",style:{color:s.colors.text},children:m.strategy})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"P&L â‚¬:"}),e.jsx("span",{className:"text-sm font-medium",style:{color:(m.pnl||0)>=0?s.colors.success:s.colors.danger},children:i(m.pnl||0,l.currency)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"P&L %:"}),e.jsx("span",{className:"text-sm font-medium",style:{color:(m.pnlPercentage||0)>=0?s.colors.success:s.colors.danger},children:d(m.pnlPercentage||0)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"Ticks:"}),e.jsx("span",{className:"text-sm font-medium",style:{color:(m.ticksGained||0)>=0?s.colors.success:s.colors.danger},children:m.ticksGained?(m.ticksGained>0?"+":"")+m.ticksGained+" ticks":0})]}),m.duration!==void 0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"DurÃ©e:"}),e.jsx("span",{className:"text-sm font-medium",style:{color:s.colors.text},children:u(m.duration||0)})]}),m.riskReward!==void 0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"R:R:"}),e.jsxs("span",{className:"text-sm font-medium",style:{color:s.colors.text},children:["1:",m.riskReward.toFixed(1)]})]}),(m.fees?.total||m.commission)&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.colors.textMuted},children:"Frais:"}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--theme-warning)"},children:i(m.fees?.total||m.commission||0,l.currency)})]})]})]},m.id))})},fp=({metrics:t,bestWorstValues:s,theme:r,language:l,settings:n})=>{const{formatCurrency:o,formatPercentage:a,formatDuration:c}=Ts(),i=[{key:"pnl",label:"P&L â‚¬",type:"currency"},{key:"pnlPercentage",label:"P&L %",type:"percentage"},{key:"ticksGained",label:"Ticks",type:"number"},{key:"duration",label:"DurÃ©e",type:"duration"},{key:"riskReward",label:"R:R",type:"number"},{key:"fees",label:"Frais",type:"currency"}];return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottomColor:r.colors.border},children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium",style:{color:r.colors.textMuted},children:l==="fr"?"MÃ©trique":"Metric"}),t.trades.map(({trade:d,isBaseline:u},m)=>e.jsx("th",{className:"text-center py-3 px-4 font-medium",style:{color:r.colors.textMuted},children:u?"Baseline":`Trade ${m+1}`},d.id)),e.jsx("th",{className:"text-center py-3 px-4 font-medium",style:{color:r.colors.textMuted},children:"Diff vs Baseline"})]})}),e.jsx("tbody",{children:i.map(({key:d,label:u,type:m})=>e.jsxs("tr",{style:{borderBottomColor:r.colors.border},children:[e.jsx("td",{className:"py-3 px-4 font-medium",style:{color:r.colors.text},children:u}),t.trades.map(({trade:p})=>{const x=d==="fees"?p.fees?.total||0:p[d],f=s[d],g=f?.best===x,h=f?.worst===x;return e.jsx("td",{className:"text-center py-3 px-4",children:e.jsx("span",{className:`font-medium ${g?"text-green-600 dark:text-green-400":h?"text-red-600 dark:text-red-400":""}`,style:{color:g?r.colors.success:h?r.colors.danger:r.colors.text},children:m==="currency"?o(x,n.currency):m==="percentage"?a(x):m==="duration"?c(x):x?.toFixed(2)||"-"})},p.id)}),e.jsx("td",{className:"text-center py-3 px-4",children:t.trades.map(({diffs:p,isBaseline:x})=>x?null:e.jsx("span",{className:"text-sm",style:{color:p[d]>=0?r.colors.success:r.colors.danger},children:cp(p[d],m)},String(p[d])))})]},String(d)))})]})})},pp=({trade:t,width:s=300,height:r=200,showNavigation:l=!0,onClick:n})=>{const{currentTheme:o}=ee(),{currentLanguage:a}=X(),[c,i]=b.useState(0),d=b.useMemo(()=>!t.screenshots||t.screenshots.length===0?[]:t.screenshots.map(f=>typeof f=="string"?{url:f,caption:""}:f),[t.screenshots]),u=()=>{i(f=>(f-1+d.length)%d.length)},m=()=>{i(f=>(f+1)%d.length)};if(O.useEffect(()=>{const f=g=>{d.length<=1||(g.key==="ArrowLeft"?(g.preventDefault(),u()):g.key==="ArrowRight"&&(g.preventDefault(),m()))};return document.addEventListener("keydown",f),()=>document.removeEventListener("keydown",f)},[d.length]),d.length===0)return e.jsxs("div",{className:"flex flex-col items-center justify-center rounded border-2 border-dashed",style:{width:s,height:r,borderColor:o.colors.border,backgroundColor:o.colors.surface},children:[e.jsx(vl,{size:32,style:{color:o.colors.textMuted},className:"mb-2"}),e.jsx("span",{className:"text-sm text-center px-4",style:{color:o.colors.textMuted},children:a==="fr"?"Aucun screenshot disponible":"No screenshot available"})]});const p=d[c],x=d.length>1;return e.jsxs("div",{className:"relative rounded border overflow-hidden",style:{width:s,height:r,borderColor:o.colors.border,backgroundColor:o.colors.surface},children:[e.jsx("img",{src:p.url,alt:p.caption||`Screenshot ${c+1}`,className:"w-full h-full object-contain cursor-pointer hover:opacity-90 transition-opacity",style:{backgroundColor:o.colors.surface},onClick:n}),l&&x&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:u,className:"absolute left-2 top-1/2 transform -translate-y-1/2 p-1 rounded-full transition-all hover:bg-black hover:bg-opacity-20",style:{backgroundColor:o.colors.surface+"80"},title:a==="fr"?"PrÃ©cÃ©dent":"Previous",children:e.jsx(cs,{size:20,style:{color:o.colors.text}})}),e.jsx("button",{onClick:m,className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1 rounded-full transition-all hover:bg-black hover:bg-opacity-20",style:{backgroundColor:o.colors.surface+"80"},title:a==="fr"?"Suivant":"Next",children:e.jsx(Os,{size:20,style:{color:o.colors.text}})}),e.jsxs("div",{className:"absolute bottom-2 left-1/2 transform -translate-x-1/2 px-2 py-1 rounded text-xs font-medium",style:{backgroundColor:o.colors.surface+"E6",color:o.colors.text},children:[c+1," / ",d.length]})]}),p.caption&&e.jsx("div",{className:"absolute top-2 left-2 right-2 px-2 py-1 rounded text-xs text-center",style:{backgroundColor:o.colors.surface+"E6",color:o.colors.text},children:p.caption})]})},hp=({trades:t,baselineId:s,graphMode:r,setGraphMode:l,theme:n,language:o,settings:a,onScreenshotClick:c,formatDate:i,setBaseline:d})=>{const{formatCurrency:u,formatPercentage:m,formatDuration:p}=Ts();return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",style:{color:n.colors.text},children:o==="fr"?"Graphiques de Performance":"Performance Charts"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>l("side-by-side"),className:"p-2 rounded transition-colors",style:{backgroundColor:r==="side-by-side"?n.colors.accent:n.colors.surface,color:r==="side-by-side"?n.colors.card:n.colors.text,border:`1px solid ${n.colors.border}`},onMouseEnter:x=>{r!=="side-by-side"&&(x.currentTarget.style.backgroundColor=n.colors.accent,x.currentTarget.style.color=n.colors.card)},onMouseLeave:x=>{r!=="side-by-side"&&(x.currentTarget.style.backgroundColor=n.colors.surface,x.currentTarget.style.color=n.colors.text)},title:o==="fr"?"CÃ´te Ã  cÃ´te":"Side by side",children:e.jsx(ls,{size:16})}),e.jsx("button",{onClick:()=>l("stack"),className:"p-2 rounded transition-colors",style:{backgroundColor:r==="stack"?n.colors.accent:n.colors.surface,color:r==="stack"?n.colors.card:n.colors.text,border:`1px solid ${n.colors.border}`},onMouseEnter:x=>{r!=="stack"&&(x.currentTarget.style.backgroundColor=n.colors.accent,x.currentTarget.style.color=n.colors.card)},onMouseLeave:x=>{r!=="stack"&&(x.currentTarget.style.backgroundColor=n.colors.surface,x.currentTarget.style.color=n.colors.text)},title:o==="fr"?"EmpilÃ©s":"Stacked",children:e.jsx(Tt,{size:16})})]})]}),e.jsx("div",{className:`grid gap-6 ${r==="side-by-side"?"grid-cols-1 lg:grid-cols-2":"grid-cols-1"}`,children:t.map(x=>{const f=x.id===s;return e.jsxs("div",{className:"p-6 rounded-lg border",style:{borderColor:n.colors.border},children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h4",{className:"font-medium",style:{color:n.colors.text},children:[x.symbol," - ",i(x.date)]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded font-medium ${(x.pnl||0)>=0?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:(x.pnl||0)>=0?"WIN":"LOSS"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"baseline",checked:f,onChange:()=>d(x.id),className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:"Baseline"})]})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(pp,{trade:x,width:450,height:280,showNavigation:!0,onClick:()=>c(x)})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:"Date:"}),e.jsx("span",{className:"text-xs font-medium",style:{color:n.colors.text},children:i(x.date)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"Symbole:":"Symbol:"}),e.jsx("span",{className:"text-xs font-medium",style:{color:n.colors.text},children:x.symbol})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:"Direction:"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[x.side==="long"?e.jsx(Ee,{size:12,style:{color:n.colors.success}}):e.jsx(Ot,{size:12,style:{color:n.colors.danger}}),e.jsx("span",{className:"text-xs font-medium",style:{color:n.colors.text},children:x.side==="long"?"Long":"Short"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"StratÃ©gie:":"Strategy:"}),e.jsx("span",{className:"text-xs font-medium",style:{color:n.colors.text},children:x.strategy||"-"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:"P&L â‚¬:"}),e.jsx("span",{className:"text-xs font-medium",style:{color:(x.pnl||0)>=0?n.colors.success:n.colors.danger},children:u(x.pnl||0,a.currency)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:"P&L %:"}),e.jsx("span",{className:"text-xs font-medium",style:{color:(x.pnlPercentage||0)>=0?n.colors.success:n.colors.danger},children:m(x.pnlPercentage||0)})]}),x.ticksGained!==void 0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:"Ticks:"}),e.jsxs("span",{className:"text-xs font-medium",style:{color:(x.ticksGained||0)>=0?n.colors.success:n.colors.danger},children:[x.ticksGained>0?"+":"",x.ticksGained," ticks"]})]}),x.duration!==void 0&&x.duration>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"DurÃ©e:":"Duration:"}),e.jsx("span",{className:"text-xs font-medium",style:{color:n.colors.text},children:p(x.duration||0)})]}),x.riskReward!==void 0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:"R:R:"}),e.jsx("span",{className:"text-xs font-medium",style:{color:n.colors.text},children:x.riskReward.toFixed(2)})]}),(x.fees?.total||x.commission)&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs",style:{color:n.colors.textMuted},children:o==="fr"?"Frais:":"Fees:"}),e.jsx("span",{className:"text-xs font-medium",style:{color:"var(--theme-warning)"},children:u(x.fees?.total||x.commission||0,a.currency)})]})]})})})]})]},x.id)})})]})},gp=({state:t,setState:s})=>{if(!t)return null;const{trade:r,index:l}=t,n=r.screenshots?.length||0,o=()=>{const a=r.screenshots[l];return typeof a=="string"?a:a.url};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[10001] p-4",onClick:()=>s(null),children:e.jsxs("div",{className:"relative max-w-[95vw] max-h-[95vh]",children:[e.jsx("button",{onClick:()=>s(null),className:"absolute top-4 right-4 z-10 p-2 rounded-full bg-black bg-opacity-50 hover:bg-opacity-70 transition-all",children:e.jsx(be,{size:24,color:"white"})}),n>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),s(c=>c?{...c,index:(c.index-1+n)%n}:null)},className:"absolute left-4 top-1/2 transform -translate-y-1/2 p-3 rounded-full bg-black bg-opacity-50 hover:bg-opacity-70 transition-all",children:e.jsx(cs,{size:24,color:"white"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),s(c=>c?{...c,index:(c.index+1)%n}:null)},className:"absolute right-4 top-1/2 transform -translate-y-1/2 p-3 rounded-full bg-black bg-opacity-50 hover:bg-opacity-70 transition-all",children:e.jsx(Os,{size:24,color:"white"})}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-full bg-black bg-opacity-50 text-white text-sm font-medium",children:[l+1," / ",n]})]}),e.jsx("img",{src:o(),alt:`Screenshot ${l+1}`,className:"max-w-full max-h-full object-contain",onClick:a=>a.stopPropagation()})]})})},Ia=O.createContext(null),yp=()=>{const t=O.useContext(Ia);if(!t)throw new Error("useToast must be used within ToastProvider");return t},bp=({children:t})=>{const[s,r]=O.useState([]),l=O.useRef(1),n=a=>r(c=>c.filter(i=>i.id!==a)),o=(a,c="info",i=2500)=>{const d=l.current++;r(u=>[...u,{id:d,kind:c,message:a,duration:i}]),i>0&&setTimeout(()=>n(d),i)};return e.jsxs(Ia.Provider,{value:{show:o},children:[t,e.jsx("div",{className:"fixed z-[100000] bottom-4 right-4 space-y-2",children:s.map(a=>e.jsx("div",{className:`px-4 py-2 rounded shadow text-white ${a.kind==="success"?"bg-green-600":a.kind==="error"?"bg-red-600":a.kind==="warning"?"bg-yellow-600":"bg-gray-800"}`,role:"status","aria-live":"polite",children:a.message},a.id))})]})},vp=({trades:t,settings:s,onClose:r,initialTradeIds:l=[]})=>{const{currentTheme:n}=ee(),{currentLanguage:o}=X();Ts();const{isOpen:a,selectedTradeIds:c,baselineId:i,activeTab:d,graphMode:u,openModal:m,closeModal:p,addTrade:x,removeTrade:f,setBaseline:g,setActiveTab:h,setGraphMode:y}=pn(),[j,v]=b.useState(0),[N,S]=b.useState(!1),[w,k]=b.useState(null),M=L=>{L.screenshots&&L.screenshots.length>0&&k({trade:L,index:0})};b.useEffect(()=>{l.length>0&&m(l)},[l,m]),b.useEffect(()=>{const L=U=>{a&&((U.ctrlKey||U.metaKey)&&U.key==="k"&&(U.preventDefault(),a||m()),U.key==="Escape"&&(p(),r()),U.key==="ArrowLeft"&&(U.preventDefault(),v(_=>Math.max(0,_-1))),U.key==="ArrowRight"&&(U.preventDefault(),v(_=>Math.min(c.length-1,_+1))))};return document.addEventListener("keydown",L),()=>document.removeEventListener("keydown",L)},[a,c.length,m,p,r]);const C=b.useMemo(()=>t.filter(L=>c.includes(L.id)),[t,c]),R=b.useMemo(()=>ap(i,C),[i,C]),P=b.useMemo(()=>ip(C),[C]),D=L=>{const U=new Date(L);return lt(U,"dd/MM HH:mm",{locale:o==="fr"?at:xt})},T=b.useCallback(()=>{const L=["Date","Symbol","Side","Strategy","P&L â‚¬","P&L %","Ticks","Duration","R:R","Fees","Market","Trend"],U=C.map(F=>[D(F.date),F.symbol,F.side,F.strategy,F.pnl||0,F.pnlPercentage||0,F.ticksGained||0,F.duration||0,F.riskReward||0,F.fees?.total||0,F.market,F.trend]),_=[L,...U].map(F=>F.map(q=>`"${q}"`).join(",")).join(`
`),B=new Blob([_],{type:"text/csv"}),z=URL.createObjectURL(B),A=document.createElement("a");A.href=z,A.download=`trades-comparison-${new Date().toISOString().split("T")[0]}.csv`,A.click(),URL.revokeObjectURL(z)},[C,o]),E=b.useCallback(()=>{const L={tradeIds:c,baselineId:i,timestamp:new Date().toISOString()},U=JSON.parse(localStorage.getItem("savedComparisons")||"[]");U.push(L),localStorage.setItem("savedComparisons",JSON.stringify(U));try{const{show:_}=yp();_(o==="fr"?"Comparaison sauvegardÃ©e":"Comparison saved","success")}catch{}},[c,i]);return a?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[10000] p-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-[1600px] max-h-[95vh] overflow-hidden",style:{backgroundColor:n.colors.card},children:[e.jsx(dp,{theme:n,language:o,onToggleTradeSelector:()=>S(!N),onExportCSV:T,onSave:E,onCloseAll:()=>{p(),r()}}),N&&e.jsx(mp,{trades:t,selectedTradeIds:c,onToggle:(L,U)=>U?f(L):x(L),formatDate:D,theme:n}),e.jsx(up,{activeTab:d,setActiveTab:h,theme:n,language:o}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[d==="summary"&&e.jsx(xp,{items:R.trades.map(({trade:L,isBaseline:U})=>({trade:L,isBaseline:U})),theme:n,language:o,settings:s,onSelectIndex:L=>v(L),focusedIndex:j,setBaseline:g,formatDate:D}),d==="metrics"&&e.jsx(fp,{metrics:R,bestWorstValues:P,theme:n,language:o,settings:s}),d==="graph"&&e.jsx(hp,{trades:C,baselineId:i,graphMode:u,setGraphMode:y,theme:n,language:o,settings:s,onScreenshotClick:M,formatDate:D,setBaseline:g})]})]}),e.jsx(gp,{state:w,setState:k})]}):null},jp=({isOpen:t,onClose:s,trade:r,cumulativeData:l,isPinMode:n,selectedTrades:o,onPinModeChange:a})=>{const{currentTheme:c}=ee(),{currentLanguage:i}=X(),{openModal:d}=pn();if(!t||!r&&!n)return null;const u=r;if(!u)return null;const m=j=>{const v=j!==void 0?j:0;return new Intl.NumberFormat(i==="fr"?"fr-FR":"en-US",{style:"currency",currency:i==="fr"?"EUR":"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(v)},p=j=>{const v=j!==void 0?j:0;return`${v>=0?"+":""}${v.toFixed(2)}%`},x=j=>{if(!j||j===0)return"-";const v=Math.floor(j/3600),N=Math.floor(j%3600/60);return v>0?`${v}h ${N}m`:N>0?`${N}m`:`${j}s`},f=j=>{const v=new Date(j);return new Intl.DateTimeFormat(i==="fr"?"fr-FR":"en-US",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(v)},g={backgroundColor:c.colors.card,border:`1px solid ${c.colors.border}`,color:c.colors.text,boxShadow:c.id==="ultra-dark"?"0 0 20px rgba(0,255,136,0.3), 0 8px 32px rgba(0,0,0,0.8)":c.isDark?"0 8px 32px rgba(0,0,0,0.6)":"0 8px 32px rgba(0,0,0,0.15)"},h={borderBottom:`1px solid ${c.colors.border}20`,padding:"8px 0"},y=({label:j,value:v,valueColor:N,icon:S})=>e.jsxs("div",{className:"flex items-center justify-between py-0.5",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[S&&e.jsx("span",{className:"text-sm",children:S}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[j,":"]})]}),e.jsx("span",{className:"text-sm font-semibold",style:{color:N||c.colors.text},children:v})]});return e.jsxs("div",{className:"fixed left-0 top-0 h-full w-72 z-[9999] transform transition-transform duration-300 ease-in-out",style:{transform:t?"translateX(0)":"translateX(-100%)",...g},children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b",style:{borderColor:c.colors.border},children:[e.jsx("h3",{className:"text-lg font-bold",style:{color:c.colors.text},children:i==="fr"?"DÃ©tails du Trade":"Trade Details"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{a(!n)},className:"p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",title:n?i==="fr"?"DÃ©sÃ©pingler":"Unpin":i==="fr"?"Ã‰pingler":"Pin",children:n?e.jsx(pi,{size:16}):e.jsx(hi,{size:16})}),e.jsx("button",{onClick:s,className:"p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",title:i==="fr"?"Fermer":"Close",children:e.jsx(be,{size:16})})]})]}),e.jsxs("div",{className:"p-3 space-y-3 overflow-y-auto",style:{height:"calc(100vh - 70px)"},children:[e.jsxs("div",{style:h,children:[e.jsx("h4",{className:"text-sm font-semibold mb-2 text-blue-500 dark:text-blue-400",children:i==="fr"?"Informations de Base":"Basic Information"}),e.jsx(y,{label:"Date",value:f(u.date),icon:e.jsx($e,{size:14})}),e.jsx(y,{label:i==="fr"?"Symbole":"Symbol",value:u.symbol}),e.jsx(y,{label:"Direction",value:u.side==="long"?"ðŸ“ˆ Long":"ðŸ“‰ Short",valueColor:u.side==="long"?"#4caf50":"#f44336",icon:u.side==="long"?e.jsx(Ee,{size:14}):e.jsx(Ot,{size:14})}),e.jsx(y,{label:i==="fr"?"StratÃ©gie":"Strategy",value:u.strategy,icon:e.jsx(Me,{size:14})}),u.timeframe&&e.jsx(y,{label:"Timeframe",value:u.timeframe})]}),e.jsxs("div",{style:h,children:[e.jsx("h4",{className:"text-sm font-semibold mb-2 text-green-500 dark:text-green-400",children:i==="fr"?"RÃ©sultats du Trade":"Trade Results"}),u.ticksGained!==void 0&&u.ticksGained!==0&&e.jsx(y,{label:"Ticks",value:`${u.ticksGained>0?"+":""}${u.ticksGained}`,valueColor:u.ticksGained>0?"#4caf50":"#f44336"}),e.jsx(y,{label:"P&L %",value:p(u.pnlPercentage),valueColor:(u.pnlPercentage??0)>=0?"#4caf50":"#f44336",icon:e.jsx(Ke,{size:14})}),e.jsx(y,{label:"P&L â‚¬",value:m(u.pnl),valueColor:(u.pnl??0)>=0?"#4caf50":"#f44336"}),e.jsx(y,{label:i==="fr"?"DurÃ©e":"Duration",value:x(u.duration),icon:e.jsx($e,{size:14})}),u.fees&&u.fees.total&&u.fees.total>0&&e.jsx(y,{label:i==="fr"?"Frais":"Fees",value:m(u.fees.total),valueColor:"#ff9800"})]}),l&&e.jsxs("div",{style:h,children:[e.jsx("h4",{className:"text-sm font-semibold mb-2 text-purple-500 dark:text-purple-400",children:i==="fr"?"Performance Globale":"Overall Performance"}),e.jsx(y,{label:i==="fr"?"P&L CumulÃ©":"Cumulative P&L",value:p(l.cumulativePercentage),valueColor:(l.cumulativePercentage??0)>=0?"#4caf50":"#f44336"}),e.jsx(y,{label:i==="fr"?"En EUR":"In EUR",value:m(l.cumulativePnL),valueColor:(l.cumulativePnL??0)>=0?"#4caf50":"#f44336"}),e.jsx(y,{label:i==="fr"?"Capital Actuel":"Current Capital",value:m(l.capital)}),l.peak&&e.jsx(y,{label:i==="fr"?"Peak Historique":"Historical Peak",value:m(l.peak),valueColor:"#4caf50"}),l.drawdown!==void 0&&e.jsx(y,{label:"Drawdown",value:p(l.drawdown),valueColor:"#f44336"})]}),e.jsxs("div",{style:h,children:[e.jsx("h4",{className:"text-sm font-semibold mb-2 text-orange-500 dark:text-orange-400",children:i==="fr"?"Informations SupplÃ©mentaires":"Additional Information"}),e.jsx(y,{label:i==="fr"?"MarchÃ©":"Market",value:u.market}),e.jsx(y,{label:i==="fr"?"Tendance":"Trend",value:u.trend,valueColor:u.trend==="bullish"?"#4caf50":u.trend==="bearish"?"#f44336":"#ff9800"}),u.setup&&e.jsx(y,{label:"Setup",value:u.setup}),u.riskReward&&e.jsx(y,{label:"R:R",value:`1:${u.riskReward.toFixed(1)}`}),u.tags&&u.tags.length>0&&e.jsxs("div",{className:"py-1",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Tags:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:u.tags.map((j,v)=>e.jsx("span",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:c.colors.accent+"20",color:c.colors.accent},children:j},v))})]})]}),u.notes&&e.jsxs("div",{style:h,children:[e.jsx("h4",{className:"text-sm font-semibold mb-2 text-gray-500 dark:text-gray-400",children:"Notes"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 leading-relaxed",children:u.notes})]})]})]})},Np=({trades:t,settings:s,onEditTrade:r,onDeleteTrade:l})=>{const{currentTheme:n}=ee(),{currentLanguage:o}=X(),[a,c]=b.useState(!0),[i,d]=b.useState(!0),[u,m]=b.useState(!0),[p,x]=b.useState(null),[f,g]=b.useState(null),[h,y]=b.useState(!1),[j,v]=b.useState(null),[N,S]=b.useState(!1),[w,k]=b.useState([]),[M,C]=b.useState(!1),[R,P]=b.useState(null),{openModal:D}=pn(),T=O.useMemo(()=>{const A=t.filter(I=>I.status==="closed"&&I.ticksGained!==void 0&&I.ticksGained!==0&&I.tickValue!==void 0);if(A.length===0)return[];const F=[...A].sort((I,$)=>new Date(I.date+" "+(I.time||"00:00")).getTime()-new Date($.date+" "+($.time||"00:00")).getTime());let q=0,W=0;return[{tradeNumber:0,cumulativeTicks:0,cumulativeValue:0,date:o==="fr"?"DÃ©but":"Start",tradeTicks:0,tradeValue:0,symbol:"",strategy:"",side:"",timeframe:"",duration:0,tickValue:0,fees:0,pnlPercentage:0},...F.map((I,$)=>{const V=I.ticksGained||0,K=I.tickValue||0,ne=V*K;return q+=V,W+=ne,{tradeNumber:$+1,cumulativeTicks:q,cumulativeValue:W,date:I.date&&!isNaN(new Date(I.date).getTime())?lt(new Date(I.date),"dd/MM",{locale:o==="fr"?at:xt}):"N/A",tradeTicks:V,tradeValue:ne,symbol:I.symbol,strategy:I.strategy,side:I.side,timeframe:I.timeframe||"",duration:I.duration||0,tickValue:K,fees:I.fees?.total||I.commission||0,pnlPercentage:I.pnlPercentage||0,tradeId:I.id,originalTrade:I}})]},[t,o]),E=A=>{if(A&&A.activePayload&&A.activePayload.length>0){const F=A.activePayload[0].payload;if(F.originalTrade)if(N){const q=F.originalTrade.id,W=w.some(I=>I.id===q);k(W?I=>I.filter($=>$.id!==q):I=>[...I,F.originalTrade])}else x(F.originalTrade)}},L=()=>{document.body.style.cursor="pointer"},U=()=>{g(null),P(null),document.body.style.cursor="default"},_=A=>{if(A&&A.activeCoordinate&&P(A.activeCoordinate.x),A&&A.activePayload&&A.activePayload.length>0){const F=A.activePayload[0].payload;F.tradeId&&F.originalTrade&&(g(F.tradeId),v(F.originalTrade),y(!0))}},B=A=>{const{cx:F,cy:q,payload:W,fill:I,index:$}=A,V=f===W.tradeId,K=w.some(le=>le.id===W.tradeId),ne=R!==null&&Math.abs(F-R)<8;if(K)return e.jsxs("g",{children:[e.jsx("line",{x1:F,y1:q-100,x2:F,y2:q+100,stroke:"#d1d5db",strokeWidth:1,opacity:.6,strokeDasharray:"2,2",style:{pointerEvents:"none"}}),e.jsx("circle",{cx:F,cy:q,r:6,fill:"#eab308",stroke:"#eab308",strokeWidth:3,style:{cursor:"pointer",filter:"drop-shadow(0 0 8px rgba(234, 179, 8, 0.4))",transition:"all 0.2s ease"},onClick:()=>{W.originalTrade&&x(W.originalTrade)}},W?.tradeId??$)]});const ue=V||ne;return e.jsx("circle",{cx:F,cy:q,r:ue?6:4,fill:I||n.colors.accent,stroke:"#ffffff",strokeWidth:ue?3:2,style:{cursor:"pointer",filter:ue?"drop-shadow(0 0 6px rgba(59, 130, 246, 0.6))":"none",transition:"all 0.15s ease"},onClick:()=>{W.originalTrade&&x(W.originalTrade)}},W?.tradeId??$)};if(T.length===0)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Me,{size:64,className:"mx-auto mb-4",style:{color:n.colors.textMuted}}),e.jsx("h3",{className:"text-xl font-bold mb-2",style:{color:n.colors.text},children:o==="fr"?"Aucune donnÃ©e de ticks":"No tick data"}),e.jsx("p",{style:{color:n.colors.textSecondary},children:o==="fr"?"Ajoutez des informations de ticks Ã  vos trades pour voir ce graphique":"Add tick information to your trades to see this chart"}),e.jsx("p",{className:"text-sm mt-2",style:{color:n.colors.textMuted},children:o==="fr"?"Ce graphique est spÃ©cialement conÃ§u pour le scalping":"This chart is specially designed for scalping"})]});const z=O.useMemo(()=>{if(!j)return;const F=[...t.filter(V=>V.status==="closed"&&V.ticksGained!==void 0&&V.ticksGained!==0&&V.tickValue!==void 0)].sort((V,K)=>new Date(V.date+" "+(V.time||"00:00")).getTime()-new Date(K.date+" "+(K.time||"00:00")).getTime());let q=0,W=0,I=1e4;for(const V of F){const K=V.ticksGained||0,ne=V.tickValue||0,ue=K*ne;q+=ue,I+=ue,I>W&&(W=I)}const $=W>0?(I-W)/W*100:0;return{cumulativePercentage:q/1e4*100,cumulativePnL:q,capital:I,peak:W,drawdown:$}},[j,t]);return e.jsxs("div",{children:[e.jsx(jp,{isOpen:h||N,onClose:()=>{y(!1),S(!1)},trade:j,cumulativeData:z,isPinMode:N,selectedTrades:w,onPinModeChange:A=>{S(A),A?(y(!0),k([]),C(!1)):(k([]),C(!1))}}),N&&w.length===0&&e.jsx("div",{className:"mb-4 p-3 rounded-lg border-2",style:{borderColor:n.colors.accent,backgroundColor:n.colors.accent+"20"},children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{style:{color:n.colors.accent},children:"ðŸ“Œ"}),e.jsx("span",{className:"text-sm font-medium",style:{color:n.colors.accent},children:o==="fr"?"Mode comparaison activÃ© ! Cliquez sur des trades pour les sÃ©lectionner.":"Comparison mode activated! Click on trades to select them."})]})}),N&&w.length>0&&e.jsx("div",{className:"mb-4 p-3 rounded-lg border-2",style:{borderColor:n.colors.success+"60",backgroundColor:n.colors.success+"10"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{style:{color:n.colors.success},children:"â„¹ï¸"}),e.jsx("span",{className:"text-sm font-medium",style:{color:n.colors.success},children:o==="fr"?`${w.length} trade(s) sÃ©lectionnÃ©(s) !`:`${w.length} trade(s) selected!`})]}),e.jsx("button",{onClick:()=>{const A=w.map(F=>F.id);D(A)},className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors hover:opacity-80",style:{backgroundColor:n.colors.accent,color:"#ffffff",border:`1px solid ${n.colors.accent}`},title:o==="fr"?"Comparer les trades sÃ©lectionnÃ©s":"Compare selected trades",children:o==="fr"?"Comparer":"Compare"})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium",style:{color:n.colors.text},children:[o==="fr"?"ðŸ“Š Graphique Cumulatif des Ticks (Scalping)":"ðŸ“Š Cumulative Ticks Chart (Scalping)",e.jsxs("span",{className:"text-sm ml-2",style:{color:n.colors.textMuted},children:["(",T.length-1," ",o==="fr"?"trades avec ticks":"trades with ticks",")"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>m(!u),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${u?"shadow-sm":"opacity-70"}`,style:{backgroundColor:u?n.colors.info+"40":n.colors.surface,color:u?n.colors.text:n.colors.textSecondary,border:`1px solid ${u?n.colors.info+"60":n.colors.border}`},children:[u?e.jsx(ke,{size:16,className:"mr-2"}):e.jsx(Re,{size:16,className:"mr-2"}),"Points"]}),e.jsxs("button",{onClick:()=>c(!a),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${a?"shadow-sm":"opacity-70"}`,style:{backgroundColor:a?n.colors.accent+"40":n.colors.surface,color:a?n.colors.text:n.colors.textSecondary,border:`1px solid ${a?n.colors.accent+"60":n.colors.border}`},children:[a?e.jsx(ke,{size:16,className:"mr-2"}):e.jsx(Re,{size:16,className:"mr-2"}),o==="fr"?"Ligne Ticks (Bleue)":"Ticks Line (Blue)"]}),e.jsxs("button",{onClick:()=>d(!i),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${i?"shadow-sm":"opacity-70"}`,style:{backgroundColor:i?n.colors.success+"40":n.colors.surface,color:i?n.colors.text:n.colors.textSecondary,border:`1px solid ${i?n.colors.success+"60":n.colors.border}`},children:[i?e.jsx(ke,{size:16,className:"mr-2"}):e.jsx(Re,{size:16,className:"mr-2"}),o==="fr"?"Ligne Valeur (Verte)":"Value Line (Green)"]})]})]}),e.jsx("div",{style:{position:"relative"},children:e.jsxs(Ms,{width:"100%",height:400,children:[e.jsxs($s,{data:T,onClick:E,onMouseMove:_,onMouseEnter:L,onMouseLeave:U,children:[e.jsx(as,{strokeDasharray:"3 3",stroke:n.colors.border}),e.jsx(is,{dataKey:"tradeNumber",stroke:n.colors.textMuted,fontSize:12,label:{value:o==="fr"?"NumÃ©ro de Trade":"Trade Number",position:"insideBottom",offset:-5}}),a&&e.jsx(vt,{yAxisId:"ticks",stroke:n.colors.textMuted,fontSize:12,label:{value:o==="fr"?"Ticks CumulÃ©s":"Cumulative Ticks",angle:-90,position:"insideLeft"}}),i&&e.jsx(vt,{yAxisId:"value",orientation:"right",stroke:n.colors.textMuted,fontSize:12,tickFormatter:A=>`${Math.round(A)} ${s.currency}`,label:{value:o==="fr"?`Valeur (${s.currency})`:`Value (${s.currency})`,angle:90,position:"insideRight"}}),e.jsx(Wt,{}),(a||i)&&e.jsx(ks,{y:0,yAxisId:a?"ticks":"value",stroke:n.colors.textMuted,strokeDasharray:"5 5"}),a&&e.jsx(Xt,{yAxisId:"ticks",type:"stepAfter",dataKey:"cumulativeTicks",stroke:n.colors.accent,strokeWidth:3,dot:u?B:!1,name:o==="fr"?"Ticks CumulÃ©s":"Cumulative Ticks",onMouseEnter:L,onMouseLeave:U}),i&&e.jsx(Xt,{yAxisId:"value",type:"stepAfter",dataKey:"cumulativeValue",stroke:n.colors.success,strokeWidth:2,strokeDasharray:"5 5",dot:u?A=>e.jsx(B,{...A,fill:n.colors.success,r:3}):!1,name:o==="fr"?`Valeur CumulÃ©e (${s.currency})`:`Cumulative Value (${s.currency})`,onMouseEnter:L,onMouseLeave:U})]}),R!==null&&e.jsx("div",{style:{position:"absolute",left:R,top:0,width:1,height:"100%",backgroundColor:n.colors.textMuted,opacity:.5,pointerEvents:"none",zIndex:1e3}})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${T[T.length-1]?.cumulativeTicks>=0?"text-green-600":"text-red-600"}`,children:T[T.length-1]?.cumulativeTicks||0}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Ticks Totaux":"Total Ticks"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:new Intl.NumberFormat(o==="fr"?"fr-FR":"en-US",{style:"currency",currency:s.currency,minimumFractionDigits:0,maximumFractionDigits:0}).format(T[T.length-1]?.cumulativeValue||0)}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Valeur Totale":"Total Value"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:n.colors.text},children:T.length-1}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Trades avec Ticks":"Trades with Ticks"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--theme-accent)"},children:((T[T.length-1]?.cumulativeTicks||0)/Math.max(T.length-1,1)).toFixed(1)}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:"Ticks/Trade"})]})]}),p&&!N&&e.jsx(Ws,{trade:p,settings:s,onClose:()=>x(null),onEdit:A=>{r&&r(A),x(null)},onDelete:A=>{l&&l(A),x(null)}}),e.jsx(vp,{trades:t,settings:s,onClose:()=>{}})]})},kp=({trades:t,settings:s,onEditTrade:r,onDeleteTrade:l})=>{const{currentTheme:n}=ee(),{currentLanguage:o}=X(),[a,c]=b.useState(!0),[i,d]=b.useState(!0),[u,m]=b.useState(null),[p,x]=b.useState(null),f=O.useMemo(()=>{const N=t.filter(M=>M.status==="closed");if(N.length===0)return[];const S=[...N].sort((M,C)=>new Date(M.date+" "+(M.time||"00:00")).getTime()-new Date(C.date+" "+(C.time||"00:00")).getTime());let w=s.initialCapital,k=s.initialCapital;return[{date:o==="fr"?"DÃ©but":"Start",capital:s.initialCapital,drawdown:0,peak:s.initialCapital,tradeNumber:0,tradePnL:0,tradePercentage:0,symbol:"",strategy:"",side:"",timeframe:"",duration:0,ticksGained:void 0,fees:0},...S.map((M,C)=>{const R=M.pnl||0;w+=R,w>k&&(k=w);const P=(k-w)/k*100;return{date:M.date&&!isNaN(new Date(M.date).getTime())?lt(new Date(M.date),"dd/MM/yyyy",{locale:o==="fr"?at:xt}):"N/A",capital:w,drawdown:-Math.abs(P),peak:k,tradeNumber:C+1,tradePnL:R,tradePercentage:M.pnlPercentage||0,symbol:M.symbol,strategy:M.strategy,side:M.side,timeframe:M.timeframe||"",duration:M.duration||0,ticksGained:M.ticksGained,fees:M.fees?.total||M.commission||0,tradeId:M.id,originalTrade:M}})]},[t,s.initialCapital,o]),g=O.useMemo(()=>{if(f.length===0)return{capitalDomain:"dataMin",drawdownDomain:"dataMin"};const N=f.map(U=>U.capital),S=f.map(U=>U.peak),w=f.map(U=>U.drawdown),k=Math.min(...N),M=Math.max(...N),C=Math.max(...S),R=Math.min(...w),P=M-k,D=Math.max(P*.15,500),T=[Math.max(0,k-D),C+D],E=Math.abs(R)*.1,L=[R-E,1];return{capitalDomain:T,drawdownDomain:L}},[f]),h=N=>{if(N&&N.activePayload&&N.activePayload.length>0){const S=N.activePayload[0].payload;S.originalTrade&&m(S.originalTrade)}},y=N=>{if(N&&N.activePayload&&N.activePayload.length>0){const S=N.activePayload[0].payload;S.tradeId&&(x(S.tradeId),document.body.style.cursor="pointer")}},j=()=>{x(null),document.body.style.cursor="default"},v=N=>{const{cx:S,cy:w,payload:k,fill:M,index:C}=N,R=p===k.tradeId;return e.jsx("circle",{cx:S,cy:w,r:R?6:4,fill:M||n.colors.accent,stroke:"#ffffff",strokeWidth:R?3:2,style:{cursor:"pointer",filter:R?"drop-shadow(0 0 6px rgba(59, 130, 246, 0.6))":"none",transition:"all 0.2s ease"},onClick:()=>{k.originalTrade&&m(k.originalTrade)}},k?.tradeId??C)};return f.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{style:{color:n.colors.textSecondary},children:o==="fr"?"Pas assez de donnÃ©es pour afficher la courbe d'Ã©quitÃ©":"Not enough data to display the equity curve"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",style:{color:n.colors.text},children:o==="fr"?"Courbe d'Ã‰quitÃ© et Drawdown":"Equity Curve and Drawdown"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>c(!a),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${a?"shadow-sm":"opacity-70"}`,style:{backgroundColor:a?n.colors.accent+"40":n.colors.surface,color:a?n.colors.text:n.colors.textSecondary,border:`1px solid ${a?n.colors.accent+"60":n.colors.border}`},children:[a?e.jsx(ke,{size:16,className:"mr-2"}):e.jsx(Re,{size:16,className:"mr-2"}),"Points"]}),e.jsxs("button",{onClick:()=>d(!i),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${i?"shadow-sm":"opacity-70"}`,style:{backgroundColor:i?n.colors.success+"40":n.colors.surface,color:i?n.colors.text:n.colors.textSecondary,border:`1px solid ${i?n.colors.success+"60":n.colors.border}`},children:[i?e.jsx(ke,{size:16,className:"mr-2"}):e.jsx(Re,{size:16,className:"mr-2"}),o==="fr"?"Peaks Historiques":"Historical Peaks"]})]})]}),e.jsx(Ms,{width:"100%",height:400,children:e.jsxs($s,{data:f,onClick:h,onMouseMove:y,onMouseLeave:j,children:[e.jsx(as,{strokeDasharray:"3 3",stroke:n.colors.border}),e.jsx(is,{dataKey:"date",stroke:n.colors.textMuted,fontSize:12}),e.jsx(vt,{yAxisId:"capital",stroke:n.colors.textMuted,fontSize:12,domain:g.capitalDomain,tickFormatter:N=>`${Math.round(N)} ${s.currency}`}),e.jsx(vt,{yAxisId:"drawdown",orientation:"right",stroke:n.colors.textMuted,fontSize:12,domain:g.drawdownDomain,tickFormatter:N=>`${N.toFixed(1)}%`}),e.jsx(Yt,{content:e.jsx(Qt,{})}),e.jsx(Wt,{}),e.jsx(Xt,{yAxisId:"capital",type:"monotone",dataKey:"capital",stroke:n.colors.accent,strokeWidth:3,dot:a?v:!1,name:"Capital"}),i&&e.jsx(Xt,{yAxisId:"capital",type:"monotone",dataKey:"peak",stroke:n.colors.success,strokeWidth:4,strokeDasharray:"8 4",dot:a?N=>{const{key:S,...w}=N,k=w?.payload?.tradeId??w?.index;return e.jsx(v,{...w,fill:n.colors.success,r:5},k)}:!1,name:o==="fr"?"Peak Historique":"Historical Peak",opacity:.9}),e.jsx(il,{yAxisId:"drawdown",type:"monotone",dataKey:"drawdown",stroke:n.colors.danger,fill:n.colors.danger,fillOpacity:.3,name:"Drawdown %"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:n.colors.accent},children:new Intl.NumberFormat(o==="fr"?"fr-FR":"en-US",{style:"currency",currency:s.currency,minimumFractionDigits:0,maximumFractionDigits:0}).format(f[f.length-1]?.capital||s.initialCapital)}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Capital Actuel":"Current Capital"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:new Intl.NumberFormat(o==="fr"?"fr-FR":"en-US",{style:"currency",currency:s.currency,minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.max(...f.map(N=>N.peak)))}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Peak Maximum":"Maximum Peak"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:[Math.min(...f.map(N=>N.drawdown)).toFixed(2),"%"]}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Drawdown Max":"Max Drawdown"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:n.colors.info},children:f.length-1}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Trades Total":"Total Trades"})]})]}),u&&e.jsx(Ws,{trade:u,settings:s,onClose:()=>m(null),onEdit:N=>{r&&r(N),m(null)},onDelete:N=>{l&&l(N),m(null)}})]})},wp=({trades:t,settings:s,onEditTrade:r,onDeleteTrade:l})=>{const{currentTheme:n}=ee(),{currentLanguage:o}=X(),[a,c]=b.useState("daily"),[i,d]=b.useState([]),[u,m]=b.useState(!1),[p,x]=b.useState(null),f=O.useMemo(()=>{const h=t.filter(j=>j.status==="closed");if(h.length===0)return[];const y=new Map;return h.forEach(j=>{const v=new Date(j.date);let N;switch(a){case"weekly":N=lt(yn(v,{weekStartsOn:1}),"dd/MM/yyyy",{locale:o==="fr"?at:xt});break;case"monthly":N=lt(gn(v),"MMM yyyy",{locale:o==="fr"?at:xt});break;case"yearly":N=lt(v,"yyyy",{locale:o==="fr"?at:xt});break;default:N=lt(v,"dd/MM/yyyy",{locale:o==="fr"?at:xt})}const S=y.get(N)||{pnl:0,percentage:0,trades:0};S.pnl+=j.pnl||0,S.percentage+=j.pnlPercentage||0,S.trades+=1,y.set(N,S)}),Array.from(y.entries()).map(([j,v])=>({date:j,pnl:v.pnl,percentage:v.percentage,trades:v.trades,fill:v.percentage>=0?n.colors.success:n.colors.danger,periodTrades:h.filter(N=>{const S=new Date(N.date);let w;switch(a){case"weekly":w=lt(yn(S,{weekStartsOn:1}),"dd/MM/yyyy",{locale:o==="fr"?at:xt});break;case"monthly":w=lt(gn(S),"MMM yyyy",{locale:o==="fr"?at:xt});break;case"yearly":w=lt(S,"yyyy",{locale:o==="fr"?at:xt});break;default:w=lt(S,"dd/MM/yyyy",{locale:o==="fr"?at:xt})}return w===j})})).sort((j,v)=>new Date(j.date).getTime()-new Date(v.date).getTime())},[t,a,n.colors,o]),g=h=>{if(h&&h.activePayload&&h.activePayload.length>0){const y=h.activePayload[0].payload;y.periodTrades&&y.periodTrades.length>0&&(d(y.periodTrades),m(!0))}};return f.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{style:{color:n.colors.textSecondary},children:o==="fr"?"Pas assez de donnÃ©es pour afficher le P&L pÃ©riodique":"Not enough data to display periodic P&L"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",style:{color:n.colors.text},children:a==="daily"?o==="fr"?"P&L Journalier":"Daily P&L":a==="weekly"?o==="fr"?"P&L Hebdomadaire":"Weekly P&L":a==="monthly"?o==="fr"?"P&L Mensuel":"Monthly P&L":o==="fr"?"P&L Annuel":"Yearly P&L"}),e.jsx("div",{className:"flex space-x-1 p-1 rounded-lg",style:{backgroundColor:n.colors.surface},children:[{key:"daily",label:o==="fr"?"Journalier":"Daily"},{key:"weekly",label:o==="fr"?"Hebdomadaire":"Weekly"},{key:"monthly",label:o==="fr"?"Mensuel":"Monthly"},{key:"yearly",label:o==="fr"?"Annuel":"Yearly"}].map(({key:h,label:y})=>e.jsxs("button",{onClick:()=>c(h),className:`flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ${a===h?"shadow-sm":""}`,style:{backgroundColor:a===h?n.colors.card:"transparent",color:a===h?n.colors.accent:n.colors.textSecondary},children:[e.jsx(bt,{size:16,className:"mr-2"}),y]},h))})]}),e.jsx(Ms,{width:"100%",height:400,children:e.jsxs(cl,{data:f,onClick:g,children:[e.jsx(as,{strokeDasharray:"3 3",stroke:n.colors.border}),e.jsx(is,{dataKey:"date",stroke:n.colors.textMuted,fontSize:12}),e.jsx(vt,{stroke:n.colors.textMuted,fontSize:12,tickFormatter:h=>`${h.toFixed(1)}%`}),e.jsx(Yt,{content:e.jsx(Qt,{})}),e.jsx(Wt,{}),e.jsx(ks,{y:0,stroke:n.colors.textMuted,strokeDasharray:"5 5"}),e.jsx(Wr,{dataKey:"percentage",name:"P&L %",radius:[4,4,0,0],children:f.map((h,y)=>e.jsx(_o,{fill:h.percentage>=0?n.colors.success:n.colors.danger,style:{cursor:"pointer",filter:"none",transition:"all 0.2s ease"}},`cell-${y}`))})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${f.filter(h=>h.percentage>0).length>=f.length/2?"text-green-600":"text-red-600"}`,children:f.filter(h=>h.percentage>0).length}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"PÃ©riodes Positives":"Positive Periods"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:f.filter(h=>h.percentage<0).length}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"PÃ©riodes NÃ©gatives":"Negative Periods"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:`${Math.max(...f.map(h=>h.percentage))>=0?"+":""}${Math.max(...f.map(h=>h.percentage)).toFixed(2)}%`}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Meilleure PÃ©riode":"Best Period"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:`${Math.min(...f.map(h=>h.percentage))>=0?"+":""}${Math.min(...f.map(h=>h.percentage)).toFixed(2)}%`}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Pire PÃ©riode":"Worst Period"})]})]}),u&&i.length>0&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col",style:{backgroundColor:n.colors.card,color:n.colors.text},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",style:{borderColor:n.colors.border},children:[e.jsxs("h2",{className:"text-xl font-semibold",style:{color:n.colors.text},children:[o==="fr"?"Trades de la PÃ©riode":"Period Trades"," (",i.length,")"]}),e.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:e.jsx(be,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"space-y-3",children:i.map(h=>e.jsx("div",{className:"p-4 rounded-lg border cursor-pointer hover:shadow-md transition-all",style:{backgroundColor:n.colors.surface,borderColor:n.colors.border},onClick:()=>{x(h),m(!1)},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"font-medium",style:{color:n.colors.text},children:h.symbol}),e.jsx("div",{className:"px-2 py-1 rounded text-xs",style:{backgroundColor:`${h.side==="long"?n.colors.success:n.colors.danger}20`,color:h.side==="long"?n.colors.success:n.colors.danger,border:`1px solid ${(h.side==="long"?n.colors.success:n.colors.danger)+"40"}`},children:h.side==="long"?"Long":"Short"}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textSecondary},children:h.strategy})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`font-bold ${(h.pnlPercentage||0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[(h.pnlPercentage||0)>=0?"+":"",(h.pnlPercentage||0).toFixed(2),"%"]}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textSecondary},children:new Date(h.date).toLocaleDateString(o==="fr"?"fr-FR":"en-US")})]})]})},h.id))})}),e.jsx("div",{className:"flex justify-end p-6 border-t",style:{borderColor:n.colors.border},children:e.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:n.colors.surface,color:n.colors.text,border:`1px solid ${n.colors.border}`},children:o==="fr"?"Fermer":"Close"})})]})}),p&&!u&&e.jsx(Ws,{trade:p,settings:s,onClose:()=>x(null),onEdit:h=>{r&&r(h),x(null)},onDelete:h=>{l&&l(h),x(null)}})]})},Sp=({trades:t,settings:s,onEditTrade:r,onDeleteTrade:l})=>{const{currentTheme:n}=ee(),{currentLanguage:o}=X(),[a,c]=b.useState(!0),[i,d]=b.useState("line"),[u,m]=b.useState(null),[p,x]=b.useState(null),f=O.useMemo(()=>{const S=t.filter(C=>C.status==="closed");if(S.length<10)return[];const w=[...S].sort((C,R)=>new Date(C.date+" "+(C.time||"00:00")).getTime()-new Date(R.date+" "+(R.time||"00:00")).getTime()),k=Math.min(20,Math.floor(w.length/5)),M=[];for(let C=k-1;C<w.length;C++){const R=w.slice(C-k+1,C+1),P=R.filter(K=>(K.pnl||0)>0).length,D=R.filter(K=>(K.pnl||0)<0).length,T=P/R.length*100,E=R.reduce((K,ne)=>K+(ne.pnl||0),0),L=R.reduce((K,ne)=>K+(ne.pnlPercentage||0),0),U=E/R.length,_=L/R.length,B=w[C],z=new Map;R.forEach(K=>{z.set(K.strategy,(z.get(K.strategy)||0)+1)});const A=Array.from(z.entries()).sort((K,ne)=>ne[1]-K[1])[0],F=new Map;R.forEach(K=>{F.set(K.symbol,(F.get(K.symbol)||0)+1)});const q=Array.from(F.entries()).sort((K,ne)=>ne[1]-K[1]).slice(0,3),W=R.filter(K=>K.duration&&K.duration>0),I=W.length>0?W.reduce((K,ne)=>K+(ne.duration||0),0)/W.length:0,$=R.filter(K=>K.ticksGained!==void 0&&K.ticksGained!==0),V=$.length>0?$.reduce((K,ne)=>K+(ne.ticksGained||0),0)/$.length:0;M.push({date:lt(new Date(w[C].date),"dd/MM",{locale:o==="fr"?at:xt}),winRate:T,trades:R.length,wins:P,losses:D,windowPnL:E,windowPnLPercentage:L,avgPnLPerTrade:U,avgPercentagePerTrade:_,currentTrade:{symbol:B.symbol,side:B.side,strategy:B.strategy,pnl:B.pnl||0,pnlPercentage:B.pnlPercentage||0,timeframe:B.timeframe||"",duration:B.duration||0,ticksGained:B.ticksGained},strategiesCount:z.size,topStrategy:A?A[0]:"",symbolsCount:F.size,topSymbols:q.map(([K])=>K),avgDuration:I,avgTicks:V,tradeNumber:C+1})}return M},[t,o]),g=S=>{if(S&&S.activePayload&&S.activePayload.length>0){const w=S.activePayload[0].payload;if(w.currentTrade){const k=t.find(M=>M.symbol===w.currentTrade.symbol&&M.date===w.currentTrade.date&&M.time===w.currentTrade.time);k&&m(k)}}},h=S=>{if(S&&S.activePayload&&S.activePayload.length>0){const w=S.activePayload[0].payload;w.currentTrade&&(x(w.currentTrade.symbol+w.currentTrade.date),document.body.style.cursor="pointer")}},y=()=>{x(null),document.body.style.cursor="default"},j=S=>{const{cx:w,cy:k,payload:M}=S,C=p===M.currentTrade?.symbol+M.currentTrade?.date;return e.jsx("circle",{cx:w,cy:k,r:C?6:4,fill:n.colors.success,stroke:"#ffffff",strokeWidth:C?3:2,style:{cursor:"pointer",filter:C?"drop-shadow(0 0 6px rgba(34, 197, 94, 0.6))":"none",transition:"all 0.2s ease"},onClick:()=>{if(M.currentTrade){const R=t.find(P=>P.symbol===M.currentTrade.symbol&&P.date===M.currentTrade.date&&P.time===M.currentTrade.time);R&&m(R)}}})},v=O.useMemo(()=>{const S=t.filter(M=>M.status==="closed");if(S.length===0)return[];const w=new Map;for(let M=1;M<=5;M++)w.set(M,{trades:0,wins:0,pnl:0,pnlPercentage:0});S.forEach(M=>{const R=new Date(M.date).getDay()||7;if(R>=1&&R<=5){const P=w.get(R)||{trades:0,wins:0,pnl:0,pnlPercentage:0};P.trades+=1,(M.pnl||0)>0&&(P.wins+=1),P.pnl+=M.pnl||0,P.pnlPercentage+=M.pnlPercentage||0,w.set(R,P)}});const k={fr:["Lundi","Mardi","Mercredi","Jeudi","Vendredi"],en:["Monday","Tuesday","Wednesday","Thursday","Friday"]};return Array.from(w.entries()).map(([M,C])=>{const R=C.trades>0?C.wins/C.trades*100:0;return{day:k[o==="fr"?"fr":"en"][M-1],dayNumber:M,trades:C.trades,wins:C.wins,losses:C.trades-C.wins,winRate:R,pnl:C.pnl,pnlPercentage:C.pnlPercentage,avgPnL:C.trades>0?C.pnl/C.trades:0,avgPnLPercentage:C.trades>0?C.pnlPercentage/C.trades:0,fill:R>=50?n.colors.success:n.colors.danger}}).sort((M,C)=>M.dayNumber-C.dayNumber)},[t,o,n.colors]),N=O.useMemo(()=>{const S=t.filter(C=>C.status==="closed");if(S.length===0)return[];const w=S.length,k=[{id:"asia",name:o==="fr"?"Session Asie":"Asia Session",startHour:0,endHour:8,color:"#8b5cf6"},{id:"eu",name:o==="fr"?"Session EU":"EU Session",startHour:8,endHour:14,color:"#3b82f6"},{id:"us",name:o==="fr"?"Session US":"US Session",startHour:14,endHour:21,color:"#10b981"},{id:"overlap",name:o==="fr"?"Overlap EU-US":"EU-US Overlap",startHour:14,endHour:16,color:"#f59e0b"},{id:"close",name:o==="fr"?"ClÃ´ture US":"US Close",startHour:21,endHour:23,color:"#ef4444"}],M=new Map;return k.forEach(C=>{M.set(C.id,{trades:0,wins:0,pnl:0,pnlPercentage:0})}),S.forEach(C=>{if(!C.time)return;const R=parseInt(C.time.split(":")[0]);let P="";for(const T of k)if(R>=T.startHour&&R<T.endHour){P=T.id;break}if(!P)return;const D=M.get(P)||{trades:0,wins:0,pnl:0,pnlPercentage:0};D.trades+=1,(C.pnl||0)>0&&(D.wins+=1),D.pnl+=C.pnl||0,D.pnlPercentage+=C.pnlPercentage||0,M.set(P,D)}),Array.from(M.entries()).filter(([C,R])=>R.trades>0).map(([C,R])=>{const P=k.find(T=>T.id===C),D=R.trades>0?R.wins/R.trades*100:0;return{session:P.name,sessionId:C,trades:R.trades,wins:R.wins,losses:R.trades-R.wins,winRate:D,pnl:R.pnl,pnlPercentage:R.pnlPercentage,avgPnL:R.trades>0?R.pnl/R.trades:0,avgPnLPercentage:R.trades>0?R.pnlPercentage/R.trades:0,fill:P.color,color:P.color,value:R.trades,name:P.name,totalClosedTradesCount:w}}).sort((C,R)=>{const P={asia:0,eu:1,overlap:2,us:3,close:4};return P[C.sessionId]-P[R.sessionId]})},[t,o,n.colors]);return f.length===0&&v.length===0&&N.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{style:{color:n.colors.textSecondary},children:o==="fr"?"Pas assez de donnÃ©es pour afficher le taux de rÃ©ussite (minimum 10 trades)":"Not enough data to display the win rate (minimum 10 trades)"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",style:{color:n.colors.text},children:i==="line"?o==="fr"?"Taux de RÃ©ussite Mobile (20 derniers trades)":"Moving Win Rate (last 20 trades)":i==="weekday"?o==="fr"?"Taux de RÃ©ussite par Jour":"Win Rate by Day":o==="fr"?"Taux de RÃ©ussite par Session":"Win Rate by Session"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex space-x-1 p-1 rounded-lg",style:{backgroundColor:n.colors.surface},children:[e.jsxs("button",{onClick:()=>d("line"),className:`flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ${i==="line"?"shadow-sm":""}`,style:{backgroundColor:i==="line"?n.colors.card:"transparent",color:i==="line"?n.colors.accent:n.colors.textSecondary},children:[e.jsx(ke,{size:16,className:"mr-2"}),o==="fr"?"Ã‰volution":"Evolution"]}),e.jsxs("button",{onClick:()=>d("weekday"),className:`flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ${i==="weekday"?"shadow-sm":""}`,style:{backgroundColor:i==="weekday"?n.colors.card:"transparent",color:i==="weekday"?n.colors.accent:n.colors.textSecondary},children:[e.jsx(He,{size:16,className:"mr-2"}),o==="fr"?"Jours":"Days"]}),e.jsxs("button",{onClick:()=>d("session"),className:`flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ${i==="session"?"shadow-sm":""}`,style:{backgroundColor:i==="session"?n.colors.card:"transparent",color:i==="session"?n.colors.accent:n.colors.textSecondary},children:[e.jsx($e,{size:16,className:"mr-2"}),"Sessions"]})]}),i==="line"&&e.jsxs("button",{onClick:()=>c(!a),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${a?"shadow-sm":"opacity-50"}`,style:{backgroundColor:a?n.colors.success:n.colors.surface,color:a?"#ffffff":n.colors.textSecondary,border:`1px solid ${a?n.colors.success:n.colors.border}`},children:[a?e.jsx(ke,{size:16,className:"mr-2"}):e.jsx(Re,{size:16,className:"mr-2"}),"Points"]})]})]}),e.jsxs(Ms,{width:"100%",height:400,children:[i==="line"&&f.length>0&&e.jsxs(Ja,{data:f,onClick:g,onMouseMove:h,onMouseLeave:y,children:[e.jsx(as,{strokeDasharray:"3 3",stroke:n.colors.border}),e.jsx(is,{dataKey:"date",stroke:n.colors.textMuted,fontSize:12}),e.jsx(vt,{stroke:n.colors.textMuted,fontSize:12,domain:[0,100],tickFormatter:S=>`${S}%`}),e.jsx(Yt,{content:e.jsx(Qt,{})}),e.jsx(Wt,{}),e.jsx(ks,{y:50,stroke:n.colors.textMuted,strokeDasharray:"5 5"}),e.jsx(Xt,{type:"monotone",dataKey:"winRate",stroke:n.colors.success,strokeWidth:3,dot:a?j:!1,name:o==="fr"?"Taux de RÃ©ussite %":"Win Rate %"})]}),i==="weekday"&&v.length>0&&e.jsxs(cl,{data:v,children:[e.jsx(as,{strokeDasharray:"3 3",stroke:n.colors.border}),e.jsx(is,{dataKey:"day",stroke:n.colors.textMuted,fontSize:12}),e.jsx(vt,{stroke:n.colors.textMuted,fontSize:12,domain:[0,100],tickFormatter:S=>`${S}%`}),e.jsx(Yt,{content:e.jsx(Qt,{})}),e.jsx(Wt,{}),e.jsx(ks,{y:50,stroke:n.colors.textMuted,strokeDasharray:"5 5"}),e.jsx(Wr,{dataKey:"winRate",name:o==="fr"?"Taux de RÃ©ussite %":"Win Rate %",radius:[4,4,0,0]})]}),i==="session"&&N.length>0&&e.jsxs(dl,{children:[e.jsx(ul,{data:N,cx:"50%",cy:"50%",labelLine:!0,outerRadius:120,fill:"#8884d8",dataKey:"trades",nameKey:"session",label:({name:S,percent:w})=>`${S}: ${(w*100).toFixed(0)}%`,children:N.map((S,w)=>e.jsx(_o,{fill:S.color},`cell-${w}`))}),e.jsx(Yt,{content:e.jsx(Qt,{})}),e.jsx(Wt,{})]})]}),i==="line"&&f.length>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-2xl font-bold ${f[f.length-1]?.winRate>=50?"text-green-600":"text-red-600"}`,children:[f[f.length-1]?.winRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Taux Actuel":"Current Rate"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[Math.max(...f.map(S=>S.winRate)).toFixed(1),"%"]}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Pic Maximum":"Maximum Peak"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:[Math.min(...f.map(S=>S.winRate)).toFixed(1),"%"]}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Plus Bas":"Lowest"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold",style:{color:n.colors.accent},children:[(f.reduce((S,w)=>S+w.winRate,0)/f.length).toFixed(1),"%"]}),e.jsx("div",{className:"text-sm",style:{color:n.colors.textMuted},children:o==="fr"?"Moyenne":"Average"})]})]}),i==="weekday"&&v.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mt-6",children:v.map(S=>e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-2xl font-bold ${S.winRate>=50?"text-green-600":"text-red-600"}`,children:[S.winRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm font-medium",style:{color:n.colors.text},children:S.day}),e.jsxs("div",{className:"text-xs",style:{color:n.colors.textMuted},children:[S.trades," ","trades"]})]},S.day))}),i==="session"&&N.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6",children:N.map(S=>e.jsxs("div",{className:"p-4 rounded-lg border",style:{borderColor:n.colors.border},children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"font-medium flex items-center",style:{color:n.colors.text},children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:S.color}}),S.session]}),e.jsxs("div",{className:`text-lg font-bold ${S.winRate>=50?"text-green-600":"text-red-600"}`,children:[S.winRate.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{style:{color:n.colors.textSecondary},children:[S.trades," ","trades"]}),e.jsxs("span",{style:{color:n.colors.textSecondary},children:[S.wins," ",o==="fr"?"gagnants":"wins"," / ",S.losses," ",o==="fr"?"perdants":"losses"]})]}),e.jsx("div",{className:"mt-2 text-sm",children:e.jsxs("span",{style:{color:n.colors.textSecondary},children:["P&L: ",S.pnlPercentage>=0?"+":"",S.pnlPercentage.toFixed(2),"%"]})})]},S.sessionId))}),u&&e.jsx(Ws,{trade:u,settings:s,onClose:()=>m(null),onEdit:S=>{r&&r(S),m(null)},onDelete:S=>{l&&l(S),m(null)}})]})},Cp=({trades:t,settings:s})=>{const{currentTheme:r}=ee(),{currentLanguage:l}=X(),[n,o]=b.useState("histogram"),a=O.useMemo(()=>{const i=t.filter(m=>m.status==="closed");return i.length===0?[]:[{min:-1/0,max:-10,label:"< -10%",shortLabel:"<-10%",color:"#7f1d1d",severity:"critical"},{min:-10,max:-5,label:l==="fr"?"-10% Ã  -5%":"-10% to -5%",shortLabel:"-10/-5%",color:"#dc2626",severity:"high"},{min:-5,max:-2,label:l==="fr"?"-5% Ã  -2%":"-5% to -2%",shortLabel:"-5/-2%",color:"#ef4444",severity:"medium"},{min:-2,max:-1,label:l==="fr"?"-2% Ã  -1%":"-2% to -1%",shortLabel:"-2/-1%",color:"#f87171",severity:"low"},{min:-1,max:0,label:l==="fr"?"-1% Ã  0%":"-1% to 0%",shortLabel:"-1/0%",color:"#fca5a5",severity:"minimal"},{min:0,max:1,label:l==="fr"?"0% Ã  1%":"0% to 1%",shortLabel:"0/1%",color:"#bbf7d0",severity:"minimal"},{min:1,max:2,label:l==="fr"?"1% Ã  2%":"1% to 2%",shortLabel:"1/2%",color:"#86efac",severity:"low"},{min:2,max:5,label:l==="fr"?"2% Ã  5%":"2% to 5%",shortLabel:"2/5%",color:"#4ade80",severity:"medium"},{min:5,max:10,label:l==="fr"?"5% Ã  10%":"5% to 10%",shortLabel:"5/10%",color:"#22c55e",severity:"high"},{min:10,max:1/0,label:"> 10%",shortLabel:">10%",color:"#15803d",severity:"critical"}].map((m,p)=>{const x=i.filter(w=>{const k=w.pnlPercentage||0;return k>m.min&&k<=m.max}),f=x.length,g=f/i.length*100,h=x.reduce((w,k)=>w+(k.pnl||0),0),y=x.reduce((w,k)=>w+(k.pnlPercentage||0),0),j=x.length>0?x.reduce((w,k)=>w+(k.duration||0),0)/x.length:0,v=x.filter(w=>w.ticksGained!==void 0).length>0?x.filter(w=>w.ticksGained!==void 0).reduce((w,k)=>w+(k.ticksGained||0),0)/x.filter(w=>w.ticksGained!==void 0).length:0,N=new Set(x.map(w=>w.strategy)),S=new Set(x.map(w=>w.symbol));return{range:m.label,shortLabel:m.shortLabel,count:f,percentage:g,color:m.color,severity:m.severity,totalPnL:h,totalPnLPercentage:y,avgPnL:f>0?h/f:0,avgPnLPercentage:f>0?y/f:0,avgDuration:j,avgTicks:v,strategiesCount:N.size,symbolsCount:S.size,fill:m.color,index:p,density:g,portfolioImpact:y/100*s.initialCapital,name:m.shortLabel,value:f}}).filter(m=>m.count>0)},[t,s.initialCapital,l]);if(a.length===0)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx(He,{size:48,className:"mx-auto mb-4",style:{color:r.colors.textMuted}}),e.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:r.colors.text},children:l==="fr"?"Aucune donnÃ©e de distribution":"No distribution data"}),e.jsx("p",{style:{color:r.colors.textSecondary},children:l==="fr"?"Ajoutez des trades pour voir la distribution des performances":"Add trades to see performance distribution"})]});const c=({name:i,percent:d})=>`${i}: ${(d*100).toFixed(0)}%`;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium",style:{color:r.colors.text},children:[l==="fr"?"ðŸ“Š Distribution des Performances":"ðŸ“Š Performance Distribution",e.jsxs("span",{className:"text-sm ml-2",style:{color:r.colors.textMuted},children:["(",a.length," ",l==="fr"?"tranches actives":"active ranges",")"]})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("div",{className:"flex space-x-1 p-1 rounded-lg",style:{backgroundColor:r.colors.surface},children:[e.jsxs("button",{onClick:()=>o("histogram"),className:`flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ${n==="histogram"?"shadow-sm":""}`,style:{backgroundColor:n==="histogram"?r.colors.card:"transparent",color:n==="histogram"?r.colors.accent:r.colors.textSecondary},children:[e.jsx(Me,{size:16,className:"mr-2"}),l==="fr"?"Histogramme":"Histogram"]}),e.jsxs("button",{onClick:()=>o("pie"),className:`flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ${n==="pie"?"shadow-sm":""}`,style:{backgroundColor:n==="pie"?r.colors.card:"transparent",color:n==="pie"?r.colors.accent:r.colors.textSecondary},children:[e.jsx(Sl,{size:16,className:"mr-2"}),l==="fr"?"Camembert":"Pie"]})]})})]}),e.jsx(Ms,{width:"100%",height:400,children:n==="pie"?e.jsxs(dl,{children:[e.jsx(ul,{data:a,cx:"50%",cy:"50%",labelLine:!1,label:c,outerRadius:120,fill:"#8884d8",dataKey:"value",children:a.map((i,d)=>e.jsx(_o,{fill:i.color},`cell-${d}`))}),e.jsx(Yt,{content:e.jsx(Qt,{})}),e.jsx(Wt,{})]}):e.jsxs($s,{data:a,children:[e.jsx(as,{strokeDasharray:"3 3",stroke:r.colors.border}),e.jsx(is,{dataKey:"shortLabel",stroke:r.colors.textMuted,fontSize:12,angle:-45,textAnchor:"end",height:60}),e.jsx(vt,{yAxisId:"density",stroke:r.colors.textMuted,fontSize:12,tickFormatter:i=>`${i}%`}),e.jsx(vt,{yAxisId:"count",orientation:"right",stroke:r.colors.textMuted,fontSize:12}),e.jsx(Yt,{content:e.jsx(Qt,{})}),e.jsx(Wt,{}),e.jsx(Wr,{yAxisId:"density",dataKey:"density",name:l==="fr"?"DensitÃ© %":"Density %",radius:[2,2,0,0],opacity:.7}),e.jsx(il,{yAxisId:"count",type:"monotone",dataKey:"count",stroke:r.colors.warning,fill:r.colors.warning,fillOpacity:.3,name:l==="fr"?"Nombre de Trades":"Number of Trades"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:a.filter(i=>i.totalPnLPercentage>0).length}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"Tranches Positives":"Positive Ranges"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:a.filter(i=>i.totalPnLPercentage<0).length}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"Tranches NÃ©gatives":"Negative Ranges"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:r.colors.accent},children:a.reduce((i,d)=>i+d.count,0)}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:"Total Trades"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:r.colors.info},children:a.length}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"Tranches Actives":"Active Ranges"})]})]})]})},Pp=({trades:t,settings:s})=>{const{currentTheme:r}=ee(),{currentLanguage:l}=X(),[n,o]=b.useState(!0),[a,c]=b.useState(!0),i=O.useMemo(()=>{const d=t.filter(y=>y.status==="closed");if(d.length===0)return[];const u=new Map;d.forEach(y=>{const j=y.strategy,v=u.get(j)||{trades:0,wins:0,totalPnL:0,totalPercentage:0,avgDuration:0,totalTicks:0,tradesWithTicks:0,totalFees:0,winningTrades:[],losingTrades:[]};v.trades+=1;const N=y.pnl||0;N>0?(v.wins+=1,v.winningTrades.push(y)):N<0&&v.losingTrades.push(y),v.totalPnL+=N,v.totalPercentage+=y.pnlPercentage||0,v.avgDuration+=y.duration||0,v.totalFees+=y.fees?.total||y.commission||0,y.ticksGained!==void 0&&y.ticksGained!==0&&(v.totalTicks+=y.ticksGained,v.tradesWithTicks+=1),u.set(j,v)});const m=new Map,p=new Map;d.forEach(y=>{m.set(y.strategy,(m.get(y.strategy)||0)+1),p.set(y.symbol,(p.get(y.symbol)||0)+1)});let x="",f=0;m.forEach((y,j)=>{y>f&&(f=y,x=j)});const g=Array.from(p.entries()).sort((y,j)=>j[1]-y[1]).slice(0,3).map(y=>y[0]);d.reduce((y,j)=>y+(j.pnl||0),0);const h=d.reduce((y,j)=>y+(j.pnlPercentage||0),0);return d.length>0&&h/d.length,Array.from(u.entries()).map(([y,j])=>{const v=j.wins/j.trades*100,N=j.winningTrades.length>0?j.winningTrades.reduce((T,E)=>T+(E.pnl||0),0)/j.winningTrades.length:0,S=j.losingTrades.length>0?j.losingTrades.reduce((T,E)=>T+(E.pnl||0),0)/j.losingTrades.length:0,w=Math.abs(S)>0?N/Math.abs(S):N>0?1/0:0,k=d.filter(T=>T.strategy===y),M=k.reduce((T,E)=>T+(E.pnl||0),0),C=k.reduce((T,E)=>T+(E.pnlPercentage||0),0),R=k.length>0?C/k.length:0,P=new Map;k.forEach(T=>{P.set(T.symbol,(P.get(T.symbol)||0)+1)});const D=Array.from(P.entries()).sort((T,E)=>E[1]-T[1]).slice(0,3).map(T=>T[0]);return{strategy:y.length>15?y.substring(0,15)+"...":y,fullStrategy:y,trades:j.trades,winRate:v,totalPnL:j.totalPnL,totalPercentage:j.totalPercentage,avgPnL:j.totalPnL/j.trades,avgPercentage:j.totalPercentage/j.trades,avgDuration:j.avgDuration/j.trades,avgTicks:j.tradesWithTicks>0?j.totalTicks/j.tradesWithTicks:0,totalFees:j.totalFees,avgFees:j.totalFees/j.trades,profitFactor:w,avgWin:N,avgLoss:S,fill:j.totalPercentage>=0?r.colors.success:r.colors.danger,strategiesCount:m.size,symbolsCount:p.size,topStrategy:x,topSymbols:g,wins:j.wins,losses:j.trades-j.wins,totalPnLPercentage:C,windowTotalPnL:M,avgPercentagePerTrade:R,strategyTopSymbols:D,strategySymbolsCount:P.size,windowPnL:M,windowPnLPercentage:C}}).sort((y,j)=>j.totalPercentage-y.totalPercentage)},[t,r.colors]);return i.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(He,{size:48,className:"mx-auto mb-4",style:{color:r.colors.textMuted}}),e.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:r.colors.text},children:l==="fr"?"Aucune donnÃ©e de stratÃ©gie":"No strategy data"}),e.jsx("p",{style:{color:r.colors.textSecondary},children:l==="fr"?"Ajoutez des trades avec des stratÃ©gies pour voir ce graphique":"Add trades with strategies to see this chart"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium",style:{color:r.colors.text},children:[l==="fr"?"ðŸ“Š Performance par StratÃ©gie":"ðŸ“Š Performance by Strategy",e.jsxs("span",{className:"text-sm ml-2",style:{color:r.colors.textMuted},children:["(",i.length," ",l==="fr"?"stratÃ©gies":"strategies",")"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>o(!n),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${n?"shadow-sm":"opacity-70"}`,style:{backgroundColor:n?r.colors.warning+"40":r.colors.surface,color:n?r.colors.text:r.colors.textSecondary,border:`1px solid ${n?r.colors.warning+"60":r.colors.border}`},children:[n?e.jsx(ke,{size:16,className:"mr-2"}):e.jsx(Re,{size:16,className:"mr-2"}),"Win Rate"]}),e.jsxs("button",{onClick:()=>c(!a),className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all ${a?"shadow-sm":"opacity-70"}`,style:{backgroundColor:a?r.colors.info+"40":r.colors.surface,color:a?r.colors.text:r.colors.textSecondary,border:`1px solid ${a?r.colors.info+"60":r.colors.border}`},children:[a?e.jsx(ke,{size:16,className:"mr-2"}):e.jsx(Re,{size:16,className:"mr-2"}),l==="fr"?"Nb Trades":"# Trades"]})]})]}),e.jsx(Ms,{width:"100%",height:400,children:e.jsxs($s,{data:i,children:[e.jsx(as,{strokeDasharray:"3 3",stroke:r.colors.border}),e.jsx(is,{dataKey:"strategy",stroke:r.colors.textMuted,fontSize:12,angle:-45,textAnchor:"end",height:80}),e.jsx(vt,{yAxisId:"pnl",stroke:r.colors.textMuted,fontSize:12,tickFormatter:d=>`${d.toFixed(1)}%`}),n&&e.jsx(vt,{yAxisId:"winrate",orientation:"right",stroke:r.colors.textMuted,fontSize:12,domain:[0,100],tickFormatter:d=>`${d}%`}),a&&!n&&e.jsx(vt,{yAxisId:"trades",orientation:"right",stroke:r.colors.textMuted,fontSize:12,tickFormatter:d=>`${d}`}),e.jsx(Yt,{content:e.jsx(Qt,{})}),e.jsx(Wt,{}),e.jsx(ks,{yAxisId:"pnl",y:0,stroke:r.colors.textMuted,strokeDasharray:"5 5"}),e.jsx(Wr,{yAxisId:"pnl",dataKey:"totalPercentage",name:l==="fr"?"P&L Total %":"Total P&L %",radius:[4,4,0,0],stroke:r.colors.border,strokeWidth:1}),n&&e.jsx(Xt,{yAxisId:"winrate",type:"monotone",dataKey:"winRate",stroke:r.colors.warning,strokeWidth:3,dot:{fill:r.colors.warning,strokeWidth:2,r:5},name:"Win Rate %"}),a&&!n&&e.jsx(Xt,{yAxisId:"trades",type:"monotone",dataKey:"trades",stroke:r.colors.info,strokeWidth:2,strokeDasharray:"5 5",dot:{fill:r.colors.info,strokeWidth:2,r:4},name:l==="fr"?"Nombre de Trades":"Number of Trades"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:r.colors.accent},children:i.length}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"StratÃ©gies UtilisÃ©es":"Strategies Used"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:i.filter(d=>d.totalPercentage>0).length}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"StratÃ©gies Profitables":"Profitable Strategies"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:`${Math.max(...i.map(d=>d.totalPercentage))>=0?"+":""}${Math.max(...i.map(d=>d.totalPercentage)).toFixed(2)}%`}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"Meilleure Performance":"Best Performance"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold",style:{color:r.colors.info},children:[(i.reduce((d,u)=>d+u.winRate,0)/i.length).toFixed(1),"%"]}),e.jsx("div",{className:"text-sm",style:{color:r.colors.textMuted},children:l==="fr"?"Win Rate Moyen":"Average Win Rate"})]})]})]})},Mp=({trades:t,settings:s,onEditTrade:r,onDeleteTrade:l})=>{const{currentTheme:n}=ee(),{currentLanguage:o}=X(),[a,c]=b.useState("pnl"),[i,d]=b.useState("percentage"),u=t.filter(x=>x.status==="closed"),m=s.statsDisplay?.showTicksCumulativeChart!==!1,p=[{key:"pnl",label:o==="fr"?"P&L CumulÃ©":"Cumulative P&L",icon:Ee},{key:"equity",label:o==="fr"?"Courbe d'Ã‰quitÃ©":"Equity Curve",icon:Tt},{key:"periodic",label:o==="fr"?"P&L PÃ©riodique":"Periodic P&L",icon:He},{key:"winrate",label:o==="fr"?"Taux de RÃ©ussite":"Win Rate",icon:Me},{key:"distribution",label:"Distribution",icon:Sl},{key:"performance",label:"Performance",icon:dr},...m?[{key:"ticks",label:o==="fr"?"Ticks CumulÃ©s":"Cumulative Ticks",icon:Me}]:[]];return u.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(He,{size:64,className:"mx-auto mb-4",style:{color:n.colors.textMuted}}),e.jsx("h3",{className:"text-xl font-bold mb-2",style:{color:n.colors.text},children:o==="fr"?"Pas assez de donnÃ©es":"Not enough data"}),e.jsx("p",{style:{color:n.colors.textSecondary},children:o==="fr"?"Ajoutez plus de trades fermÃ©s pour voir les graphiques":"Add more closed trades to see charts"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:p.map(({key:x,label:f,icon:g})=>e.jsxs("button",{onClick:()=>c(x),className:`flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-colors ${a===x?"shadow-sm":""}`,style:{backgroundColor:a===x?n.colors.card:n.colors.surface,color:a===x?n.colors.accent:n.colors.textSecondary,border:`1px solid ${n.colors.border}`},children:[e.jsx(g,{size:16,className:"mr-2"}),f]},x))}),a==="pnl"&&e.jsxs("div",{className:"flex justify-end space-x-1 p-1 rounded-lg",style:{backgroundColor:n.colors.surface},children:[e.jsxs("button",{onClick:()=>d("currency"),className:`flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ${i==="currency"?"shadow-sm":""}`,style:{backgroundColor:i==="currency"?n.colors.card:"transparent",color:i==="currency"?n.colors.accent:n.colors.textSecondary},children:[e.jsx(rr,{size:16,className:"mr-2"}),"Capital (EUR)"]}),e.jsxs("button",{onClick:()=>d("percentage"),className:`flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ${i==="percentage"?"shadow-sm":""}`,style:{backgroundColor:i==="percentage"?n.colors.card:"transparent",color:i==="percentage"?n.colors.accent:n.colors.textSecondary},children:[e.jsx(us,{size:16,className:"mr-2"}),o==="fr"?"Pourcentage":"Percentage"]})]}),e.jsxs("div",{className:"rounded-lg shadow-sm border p-6",style:{backgroundColor:n.colors.card,borderColor:n.colors.border},children:[a==="pnl"&&e.jsx(lp,{trades:t,settings:s,viewMode:i,onEditTrade:r,onDeleteTrade:l}),a==="equity"&&e.jsx(kp,{trades:t,settings:s,onEditTrade:r,onDeleteTrade:l}),a==="periodic"&&e.jsx(wp,{trades:t,settings:s,onEditTrade:r,onDeleteTrade:l}),a==="winrate"&&e.jsx(Sp,{trades:t,settings:s,onEditTrade:r,onDeleteTrade:l}),a==="distribution"&&e.jsx(Cp,{trades:t,settings:s}),a==="performance"&&e.jsx(Pp,{trades:t,settings:s}),a==="ticks"&&m&&e.jsx(Np,{trades:t,settings:s,onEditTrade:r,onDeleteTrade:l}),a==="ticks"&&!m&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Me,{size:64,className:"mx-auto mb-4",style:{color:n.colors.textMuted}}),e.jsx("h3",{className:"text-xl font-bold mb-2",style:{color:n.colors.text},children:o==="fr"?"Graphique des Ticks DÃ©sactivÃ©":"Ticks Chart Disabled"}),e.jsx("p",{style:{color:n.colors.textSecondary},children:o==="fr"?"Activez le graphique cumulatif des ticks dans les paramÃ¨tres du profil pour voir ce graphique.":"Enable the cumulative ticks chart in the profile settings to see this chart."})]})]})]})},Rp=({trades:t,settings:s,onEditTrade:r,onDeleteTrade:l})=>e.jsx(Mp,{trades:t,settings:s,onEditTrade:r,onDeleteTrade:n=>l(typeof n=="string"?n:n.id)}),Tp=({trades:t,settings:s,onEdit:r,onDelete:l})=>e.jsx("div",{className:"card rounded-lg shadow-sm p-6",children:e.jsx($a,{trades:t,onEdit:r,onDelete:n=>l(typeof n=="string"?n:n.id),settings:s})}),Dp=()=>{const[t,s]=xs("trading-journal-profiles",[]),[r,l]=xs("trading-journal-active-profile",null),n=t.find(u=>u.id===r)||null,o=u=>{const m={...u,id:Date.now().toString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return s(p=>[...p,m]),t.length===0&&l(m.id),m};return{profiles:t,activeProfile:n,createProfile:o,updateProfile:(u,m)=>{s(p=>p.map(x=>x.id===u?{...x,...m,updatedAt:new Date().toISOString()}:x))},deleteProfile:u=>{if(s(m=>m.filter(p=>p.id!==u)),r===u){const m=t.filter(p=>p.id!==u);l(m.length>0?m[0].id:null)}},setActiveProfile:u=>{l(u)},duplicateProfile:(u,m)=>{const p=t.find(j=>j.id===u);if(!p)return null;const{id:x,createdAt:f,updatedAt:g,...h}=p;return o({...h,name:m})}}},Ep=t=>{const{profiles:s,activeProfile:r,createProfile:l,updateProfile:n,deleteProfile:o,setActiveProfile:a}=Dp(),[c,i]=b.useState(!1),[d,u]=b.useState(null),m=b.useCallback(h=>{const y=l(h);a(y.id),i(!1),u(null)},[l,a]),p=b.useCallback(h=>{d&&(n(d.id,h),i(!1),u(null))},[d,n]),x=b.useCallback(h=>{t(y=>y.filter(j=>j.profileId!==h.id)),o(h.id)},[o,t]),f=b.useCallback(h=>{u(h||null),i(!0)},[]),g=b.useCallback(()=>{i(!1),u(null)},[]);return{profiles:s,activeProfile:r,createProfile:l,updateProfile:n,deleteProfile:o,setActiveProfile:a,showProfileModal:c,setShowProfileModal:i,editingProfile:d,setEditingProfile:u,handleCreateProfile:m,handleUpdateProfile:p,handleDeleteProfile:x,openProfileModal:f,closeProfileModal:g}},Fp=()=>{const t=typeof window<"u"&&window.electronAPI?.isElectron;return{isElectron:t,electronAPI:t?window.electronAPI:null}};function hs(t){if(typeof t!="string")return null;const s=t.trim().replace(/\s+/g," ");if(s===""||!Ap(s))return null;const r=s.replace(/[\s_'']/g,"").replace(",",".");if(!Lp(r))return null;const l=$p(r);return Ip(l)?{raw:s,normalized:r,decimalString:l}:null}function Ap(t){return/[\s_'']/.test(t)?/^\d{1,3}([\s_'']\d{3})*([,.]\d+)?$/.test(t):!0}function Lp(t){return/^-?(\d+\.?\d*|\.\d+)$/.test(t)}function $p(t){let s=t;return s.endsWith(".")&&(s=s+"0"),s.startsWith("-.")&&(s=s.replace("-.","-0.")),s.startsWith(".")&&!s.startsWith("-.")&&(s="0"+s),(s==="-0"||s==="-0.0")&&(s="0"),s}function Ip(t){return!(!/^[-]?\d+(\.\d+)?$/.test(t)||t.length>64)}function za(t,s,r){const l=hs(t);if(!l)throw new Error(`computeTicks: invalid entry price "${t}"`);const n=hs(s);if(!n)throw new Error(`computeTicks: invalid exit price "${s}"`);const o=hs(r);if(!o)throw new Error(`computeTicks: invalid tick size "${r}"`);const a=Ce(l.decimalString),c=Ce(n.decimalString),i=Ce(o.decimalString);if(i.isZero())throw new Error("computeTicks: tick size cannot be zero");const d=Yr(c,a);return vs(d,i)}function Oa(t,s,r,l,n){const o=hs(l);if(!o)throw new Error(`computePnL: invalid tick value "${l}"`);const a=hs(n);if(!a)throw new Error(`computePnL: invalid contracts "${n}"`);const c=Ce(o.decimalString),i=Ce(a.decimalString),d=za(t,s,r);return ft(ft(d,c),i)}function qa(t,s){const r=hs(t);if(!r)throw new Error(`computeFees: invalid fee per contract "${t}"`);const l=hs(s);if(!l)throw new Error(`computeFees: invalid contracts "${s}"`);const n=Ce(r.decimalString),o=Ce(l.decimalString);return ft(n,o)}function zp(t,s,r,l,n,o){const a=Oa(t,s,r,l,n),c=qa(o,n);return Yr(a,c)}function Op(t,s){const r=hs(s);if(!r)throw new Error(`computePnLPercentage: invalid capital "${s}"`);const l=Ce(r.decimalString);if(l.isZero())throw new Error("computePnLPercentage: capital cannot be zero");return ft(vs(t,l),Ce("100"))}function qp(t,s){const r=t.split(":"),l=s.split(":");if(r.length!==3||l.length!==3)throw new Error(`computeDuration: invalid time format. Expected HH:MM:SS, got entry="${t}", exit="${s}"`);const n=Rt(Rt(ft(Ce(r[0]),Ce("3600")),ft(Ce(r[1]),Ce("60"))),Ce(r[2])),o=Rt(Rt(ft(Ce(l[0]),Ce("3600")),ft(Ce(l[1]),Ce("60"))),Ce(l[2])),a=Yr(o,n);if(a.isNegative())throw new Error(`computeDuration: exit time "${s}" is before entry time "${t}"`);return a}const Up=Object.freeze(Object.defineProperty({__proto__:null,computeDuration:qp,computeFees:qa,computeNetPnL:zp,computePnL:Oa,computePnLPercentage:Op,computeTicks:za},Symbol.toStringTag,{value:"Module"})),_p=t=>{const s={...t};return Object.keys(s).forEach(r=>{const l=s[r];Array.isArray(l)&&l.length===0&&delete s[r]}),["pnlRange","durationRange","feesRange","contractsRange","lotsRange","ticksRange"].forEach(r=>{const l=s[r];l&&typeof l=="object"&&(l.min===void 0||l.min===null||l.min==="")&&(l.max===void 0||l.max===null||l.max==="")&&delete s[r]}),["dateRange","timeRange"].forEach(r=>{const l=s[r];l&&typeof l=="object"&&(l.start===void 0||l.start===null||l.start==="")&&(l.end===void 0||l.end===null||l.end==="")&&delete s[r]}),s.tradeResult&&typeof s.tradeResult=="object"&&!s.tradeResult.takeProfit&&!s.tradeResult.stopLoss&&!s.tradeResult.breakEven&&delete s.tradeResult,s},Xn=t=>{if(typeof t=="number")return t;if(t==null)return NaN;let s=String(t).trim();if(s==="")return NaN;s=s.replace(/,/g,"."),s.endsWith(".")&&(s+="0");const r=Number.parseFloat(s);return Number.isNaN(r)?NaN:r},Wp=(t,s)=>{const r=Xn(t),l=Xn(s),n=Number.isNaN(r)?-1/0:r,o=Number.isNaN(l)?1/0:l;return{min:n,max:o}},Vp={seconds:1,minutes:60,hours:3600,days:86400},Ua={seconds:{min:0,max:59},minutes:{min:0,max:59},hours:{min:0,max:23},days:{min:0,max:365}},Qn=(t,s)=>typeof t!="number"||Number.isNaN(t)?NaN:Math.floor(t*Vp[s]),Zn=(t,s)=>{if(t===void 0)return!0;const{min:r,max:l}=Ua[s];return t>=r&&t<=l},Bp=(t,s,r)=>{const l=[];return Zn(t,r)||l.push(`Valeur min invalide pour ${r}`),Zn(s,r)||l.push(`Valeur max invalide pour ${r}`),t!==void 0&&s!==void 0&&t>s&&l.push("La valeur min ne peut pas Ãªtre supÃ©rieure Ã  la valeur max"),{isValid:l.length===0,errors:l}},Hp=(t,s,r)=>{const l=t===void 0?void 0:Qn(t,r),n=s===void 0?void 0:Qn(s,r);return{minSeconds:l,maxSeconds:n}},Gp=t=>{const s=new Date(t);return["january","february","march","april","may","june","july","august","september","october","november","december"][s.getMonth()]},el=t=>{if(!t)return-1;const s=parseInt(t.split(":")[0]);return isNaN(s)?-1:s},Jp=t=>{const s=new Date(t);return["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][s.getDay()]},Kp=t=>t>=0&&t<8?"asia":t>=8&&t<14?"eu":t>=14&&t<16?"overlap":t>=16&&t<21?"us":t>=21&&t<24?"close":"asia";function Yp(t,s){return t.filter(r=>{if(s.dateRange?.start||s.dateRange?.end){console.log("ðŸ” Date filter active in useFilters:",{start:s.dateRange.start,end:s.dateRange.end,tradeDate:r.date});const l=new Date(r.date);if(l.setHours(0,0,0,0),s.dateRange.start){const n=new Date(s.dateRange.start);if(n.setHours(0,0,0,0),console.log("ðŸ“… Comparing dates:",{tradeDate:l.toISOString(),startDate:n.toISOString(),isBefore:l<n}),l<n)return!1}if(s.dateRange.end){const n=new Date(s.dateRange.end);if(n.setHours(23,59,59,999),l>n)return!1}}if((s.timeRange?.start||s.timeRange?.end)&&r.time){const l=r.time;if(s.timeRange.start&&s.timeRange.end){const n=s.timeRange.start,o=s.timeRange.end;if(n<=o){if(l<n||l>o)return!1}else if(l<n&&l>o)return!1}else if(s.timeRange.start){if(l<s.timeRange.start)return!1}else if(s.timeRange.end&&l>s.timeRange.end)return!1}if(s.weekdays&&s.weekdays.length>0){const l=Jp(r.date);if(!s.weekdays.includes(l))return!1}if(s.months&&s.months.length>0){const l=Gp(r.date);if(!s.months.includes(l))return!1}if(s.hours&&s.hours.length>0){const l=el(r.time);if(l===-1||!s.hours.includes(l))return!1}if(s.sessions&&s.sessions.length>0&&r.time){const l=el(r.time);if(l===-1)return!1;const n=Kp(l);if(!s.sessions.includes(n))return!1}if(s.pnlRange){let l;s.pnlUnit==="percent"?l=r.pnlPercentage||0:l=r.pnl||0;const n=s.pnlRange.min!==void 0?s.pnlRange.min:-1/0,o=s.pnlRange.max!==void 0?s.pnlRange.max:1/0;if(l<n||l>o)return!1}if(s.durationRange&&r.duration!==void 0){const l=s.durationUnit||"minutes",{minSeconds:n,maxSeconds:o}=Hp(s.durationRange.min,s.durationRange.max,l);if(n!==void 0&&r.duration<n||o!==void 0&&r.duration>o)return!1}if(s.ticksRange&&r.ticksGained!==void 0){const l=s.ticksRange.min!==void 0?s.ticksRange.min:-1/0,n=s.ticksRange.max!==void 0?s.ticksRange.max:1/0;if(r.ticksGained<l||r.ticksGained>n)return!1}if(s.feesRange){const l=Number(r.fees?.total??r.commission??0),{min:n,max:o}=Wp(s.feesRange.min,s.feesRange.max);if(l<n||l>o)return!1}if(s.lotsRange&&r.numberOfLots!==void 0){const l=s.lotsRange.min!==void 0?s.lotsRange.min:0,n=s.lotsRange.max!==void 0?s.lotsRange.max:1/0;if(r.numberOfLots<l||r.numberOfLots>n)return!1}if(s.tradeResult){const{takeProfit:l,stopLoss:n,breakEven:o}=s.tradeResult;if(l&&r.tradeResult!=="tp"||n&&r.tradeResult!=="sl"||o&&r.tradeResult!=="be")return!1}if(s.marketType&&s.marketType.length>0&&!s.marketType.includes(r.market)||s.trend&&s.trend.length>0&&!s.trend.includes(r.trend)||s.direction&&s.direction.length>0&&!s.direction.includes(r.side)||s.strategy&&s.strategy.length>0&&!s.strategy.includes(r.strategy)||s.status&&s.status.length>0&&!s.status.includes(r.status)||s.symbols&&s.symbols.length>0&&!s.symbols.includes(r.symbol)||s.tags&&s.tags.length>0&&!s.tags.some(n=>r.tags.some(o=>o.toLowerCase().includes(n.toLowerCase())))||s.timeframe&&s.timeframe.length>0&&(!r.timeframe||!s.timeframe.includes(r.timeframe)))return!1;if(s.ticksRange&&r.ticksGained!==void 0){const l=s.ticksRange.min!==void 0?s.ticksRange.min:-1/0,n=s.ticksRange.max!==void 0?s.ticksRange.max:1/0;if(r.ticksGained<l||r.ticksGained>n)return!1}if(s.tickEntry&&s.tickEntry.length>0){const l=r.tickEntry||r.tickEntry;if(!l||!s.tickEntry.includes(l))return!1}return!0})}const qo=sn,_r=Yp,Es=Hl,_a=Gl;new Proxy(Mn,{get(t,s){const r=Up[s],l=Mn[s];return typeof r=="function"&&typeof l!="function"?(...n)=>r(...n):typeof r=="function"&&typeof l=="function"?(...n)=>r(...n):l}});const Xp=({isOpen:t,onToggle:s,onOpenSettings:r,onOpenProfileSettings:l,onOpenImportExport:n})=>{const[o,a]=b.useState(!1),[c,i]=b.useState(!1),d=b.useRef(null),u=b.useRef(null),m=b.useRef(null),{currentTheme:p,themes:x,setTheme:f}=ee(),{currentLanguage:g,changeLanguage:h}=X(),y=()=>{d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{t||(a(!0),s())},200)},j=()=>{d.current&&(clearTimeout(d.current),d.current=null),o&&!t&&(a(!1),s())};b.useEffect(()=>()=>{d.current&&clearTimeout(d.current)},[]);const v=S=>g==="fr"?S==="light"?"Clair":S==="dark"?"Sombre":S==="ultra-dark"?"Ultra Sombre":"ThÃ¨me":S==="light"?"Light":S==="dark"?"Dark":S==="ultra-dark"?"Ultra Dark":"Theme",N=()=>{h(g==="fr"?"en":"fr")};return e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:m,onClick:s,onMouseEnter:y,onMouseLeave:j,className:`fixed left-0 top-1/2 transform -translate-y-1/2 z-50 p-2 rounded-r-lg transition-all duration-300 ease-in-out ${t?"theme-text shadow-lg":"theme-surface hover:theme-border theme-text-muted hover:theme-text"}`,style:{backgroundColor:t?"var(--theme-accent)":void 0,left:t?"280px":"0",transition:"left 0.3s ease-in-out"},children:t?e.jsx(cs,{size:20}):e.jsx(Os,{size:20})}),e.jsx("div",{ref:u,className:`fixed left-0 top-0 h-full theme-surface border-r theme-border shadow-lg transition-all duration-300 ease-in-out z-40 ${t?"w-72 translate-x-0":"w-0 -translate-x-full"}`,onMouseEnter:()=>{d.current&&(clearTimeout(d.current),d.current=null),a(!1)},onMouseLeave:()=>{o&&setTimeout(()=>{o&&(a(!1),s())},200)},children:e.jsx("div",{className:"h-full overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold theme-text mb-6",children:"ParamÃ¨tres Rapides"}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("h3",{className:"text-lg font-medium theme-text-secondary mb-3 flex items-center",children:[e.jsx(Ko,{size:18,className:"mr-2"}),"Profil"]}),e.jsxs("button",{onClick:N,className:"w-full flex items-center p-3 rounded-lg border theme-border hover:theme-surface transition-colors text-left",children:[e.jsx(Bo,{size:18,className:"mr-3 theme-text-muted"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:"Langue"}),e.jsx("div",{className:"text-sm theme-text-muted",children:g==="fr"?"FranÃ§ais":"English"})]})]}),e.jsxs("button",{onClick:l,className:"w-full flex items-center p-3 rounded-lg border theme-border hover:theme-surface transition-colors text-left",children:[e.jsx(ss,{size:18,className:"mr-3 theme-text-muted"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:"ParamÃ¨tres du Profil"}),e.jsx("div",{className:"text-sm theme-text-muted",children:"Capital, risque, devise"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>i(!c),className:"w-full flex items-center p-3 rounded-lg border theme-border hover:theme-surface transition-colors text-left",children:[e.jsx(Ho,{size:18,className:"mr-3 theme-text-muted"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium theme-text",children:"ThÃ¨me"}),e.jsx("div",{className:"text-sm theme-text-muted",children:v(p.id)})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full border theme-border",style:{backgroundColor:p.colors.bg}}),e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:p.colors.accent}})]})]}),c&&e.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 theme-surface border theme-border rounded-lg shadow-lg z-50",children:e.jsx("div",{className:"p-2 space-y-1",children:x.map(S=>e.jsxs("button",{onClick:()=>{f(S.id),i(!1)},className:`w-full flex items-center p-2 rounded text-left hover:theme-surface ${p.id===S.id?"shadow-md":"theme-text"}`,style:{backgroundColor:p.id===S.id?`${p.colors.accent}10`:void 0,color:p.id===S.id?p.colors.accent:void 0},children:[e.jsxs("div",{className:"flex space-x-2 mr-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full border theme-border",style:{backgroundColor:S.colors.bg}}),e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:S.colors.accent}})]}),e.jsx("span",{className:"text-sm",children:v(S.id)}),p.id===S.id&&e.jsx("div",{className:"ml-auto text-blue-600",children:"âœ“"})]},S.id))})})]})]}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("h3",{className:"text-lg font-medium theme-text-secondary mb-3 flex items-center",children:[e.jsx(sr,{size:18,className:"mr-2"}),"DonnÃ©es"]}),e.jsxs("button",{onClick:n,className:"w-full flex items-center p-3 rounded-lg border theme-border hover:theme-surface transition-colors text-left",children:[e.jsxs("div",{className:"mr-3 flex space-x-1",children:[e.jsx(cr,{size:16,className:"text-green-600"}),e.jsx(Rr,{size:16,className:"text-blue-600"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:"Import/Export"}),e.jsx("div",{className:"text-sm theme-text-muted",children:"CSV, JSON, PDF"})]})]}),e.jsxs("button",{onClick:()=>{window.location.hash="#/v3demo"},className:"w-full flex items-center p-3 rounded-lg border theme-border hover:theme-surface transition-colors text-left",title:"V3 Sandbox (POC)",children:[e.jsx("div",{className:"mr-3 flex space-x-1",children:e.jsx("span",{className:"inline-block w-2 h-2 rounded-full",style:{backgroundColor:p.colors.accent}})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:"V3 Sandbox (POC)"}),e.jsx("div",{className:"text-sm theme-text-muted",children:"Formulaire V3 dÃ©claratif (dÃ©mo)"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium theme-text-secondary mb-3 flex items-center",children:[e.jsx(Me,{size:18,className:"mr-2"}),"Plan de Trading"]}),e.jsxs("div",{className:"theme-text-muted text-center py-6 border border-dashed theme-border rounded-lg",children:[e.jsx(Me,{size:24,className:"mx-auto mb-2 theme-text-muted"}),e.jsx("p",{className:"text-sm",children:"Section Ã  venir..."}),e.jsx("p",{className:"text-xs mt-1",children:"On ajoutera le contenu progressivement"})]})]})]})})}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-20 z-30",onClick:s})]})},tl=[{type:"scalper",name:"Scalper",description:"Trading haute frÃ©quence, positions courtes, focus sur les ticks",icon:"âš¡",defaultSettings:{preferences:{timeframes:["5s","10s","15s","30s","45s","1m"],markets:["futures","forex"],tradingSessions:[],units:{price:"ticks",quantity:"contracts"},keyMetrics:["trades_per_day","avg_hold_time","tick_capture","win_rate"]},settings:{initialCapital:1e4,riskPerTrade:.5,currency:"EUR",maxDailyTrades:50},uiSettings:{defaultView:"overview",compactMode:!0,showAdvancedStats:!0,chartType:"candlestick"}}},{type:"daytrader",name:"Day Trader",description:"Trading intraday, analyse technique, fermeture en fin de journÃ©e",icon:"ðŸ“ˆ",defaultSettings:{preferences:{timeframes:["1m","5m","15m","30m","1h"],markets:["futures","stocks","indices"],tradingSessions:[],units:{price:"points",quantity:"contracts"},keyMetrics:["win_rate","profit_factor","avg_rr","daily_pnl"]},settings:{initialCapital:1e4,riskPerTrade:2,currency:"EUR",maxDailyTrades:10},uiSettings:{defaultView:"stats",compactMode:!1,showAdvancedStats:!0,chartType:"candlestick"}}},{type:"swingtrader",name:"Swing Trader",description:"Positions de plusieurs jours/semaines, analyse fondamentale",icon:"ðŸŒŠ",defaultSettings:{preferences:{timeframes:["4h","1d","1w"],markets:["stocks","crypto","commodities"],tradingSessions:[],units:{price:"points",quantity:"shares"},keyMetrics:["monthly_return","max_drawdown","sharpe_ratio","hold_time"]},settings:{initialCapital:1e4,riskPerTrade:3,currency:"EUR",maxDailyTrades:2},uiSettings:{defaultView:"charts",compactMode:!1,showAdvancedStats:!0,chartType:"candlestick"}}},{type:"custom",name:"PersonnalisÃ©",description:"Configuration entiÃ¨rement personnalisable",icon:"âš™ï¸",defaultSettings:{preferences:{timeframes:["1m","5m","15m","1h","1d"],markets:["futures","forex","stocks"],tradingSessions:[],units:{price:"points",quantity:"contracts"},keyMetrics:["win_rate","profit_factor","total_return"]},settings:{initialCapital:1e4,riskPerTrade:2,currency:"EUR"},uiSettings:{defaultView:"overview",compactMode:!1,showAdvancedStats:!1,chartType:"candlestick"}}}],Wa=({profile:t,onSubmit:s,onClose:r})=>{const{currentLanguage:l,t:n}=X(),[o,a]=b.useState({name:"",type:"custom",accountType:"demo",description:"",settings:{initialCapital:1e4,riskPerTrade:2,currency:"EUR"},preferences:{timeframes:["1m","5m","15m"],markets:["futures"],tradingSessions:[],units:{price:"points",quantity:"contracts"},keyMetrics:["win_rate","profit_factor","total_return"]},uiSettings:{defaultView:"stats",compactMode:!1,showAdvancedStats:!1,chartType:"candlestick"},isActive:!0,color:"#0ea5e9",id:"",createdAt:"",updatedAt:""}),[c,i]=b.useState("basic");b.useEffect(()=>{t&&a(t)},[t]);const d=x=>{const f=tl.find(g=>g.type===x);f&&a(g=>({...g,type:f.type,...f.defaultSettings,settings:{...g.settings,...f.defaultSettings.settings},preferences:{...g.preferences,...f.defaultSettings.preferences},uiSettings:{...g.uiSettings,...f.defaultSettings.uiSettings}}))},u=x=>{x.preventDefault();const{id:f,createdAt:g,updatedAt:h,...y}=o;s(y)},m=(x,f)=>{a(g=>{const h=x.split("."),y={...g};let j=y;for(let v=0;v<h.length-1;v++)j[h[v]]||(j[h[v]]={}),j=j[h[v]];return j[h[h.length-1]]=f,y})},p=["#0ea5e9","#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#84cc16","#f97316","#ec4899","#6366f1"];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"theme-surface rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b theme-border flex-shrink-0",children:[e.jsx("h2",{className:"text-2xl font-bold theme-text mb-6",children:l==="fr"?"CrÃ©er/Modifier un Profil":"Create/Edit Profile"}),e.jsx("button",{onClick:r,className:"theme-text-muted hover:theme-text transition-colors",children:e.jsx(be,{size:24})})]}),e.jsx("div",{className:"flex border-b theme-border flex-shrink-0",children:[{key:"basic",label:l==="fr"?"Informations":"Information"},{key:"trading",label:"Trading"},{key:"display",label:l==="fr"?"Affichage Stats":"Stats Display"},{key:"ui",label:"Interface"}].map(x=>e.jsx("button",{type:"button",onClick:()=>i(x.key),className:`px-6 py-3 text-sm font-medium transition-colors ${c===x.key?"border-b-2":"theme-text-muted hover:theme-text"}`,style:{color:c===x.key?"var(--theme-accent)":void 0,borderBottomColor:c===x.key?"var(--theme-accent)":void 0},children:x.label},x.key))}),e.jsxs("form",{onSubmit:u,className:"flex flex-col flex-1 min-h-0",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[c==="basic"&&e.jsxs("div",{className:"space-y-6",children:[!t&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text-muted mb-3",children:l==="fr"?"Choisir un Template":"Choose a Template"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:tl.map(x=>e.jsxs("button",{type:"button",onClick:()=>d(x.type),className:`p-4 border-2 rounded-lg text-center transition-colors ${o.type===x.type?"shadow-md":"theme-border hover:theme-border"}`,style:{borderColor:o.type===x.type?"var(--theme-accent)":void 0,backgroundColor:o.type===x.type?"var(--theme-accent)10":void 0},children:[e.jsx("div",{className:"text-2xl mb-2",children:x.icon}),e.jsx("div",{className:"font-medium theme-text text-sm",children:x.name}),e.jsx("div",{className:"text-xs theme-text-muted mt-1",children:x.description})]},x.type))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-1",children:l==="fr"?"Nom du Profil":"Profile Name"}),e.jsx("input",{type:"text",value:o.name,onChange:x=>m("name",x.target.value),className:"w-full px-3 py-2 border theme-border rounded-md focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},placeholder:l==="fr"?"Mon Profil Scalping":"My Scalping Profile",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-1",children:l==="fr"?"Type de Compte":"Account Type"}),e.jsxs("select",{value:o.accountType,onChange:x=>m("accountType",x.target.value),className:"w-full px-3 py-2 border theme-border rounded-md focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},children:[e.jsx("option",{value:"demo",children:l==="fr"?"Compte DÃ©mo":"Demo Account"}),e.jsx("option",{value:"live",children:l==="fr"?"Compte RÃ©el":"Live Account"}),e.jsx("option",{value:"backtest",children:"Backtest"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-1",children:l==="fr"?"Couleur du Profil":"Profile Color"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 rounded border theme-border",style:{backgroundColor:o.color}}),e.jsx("div",{className:"flex space-x-1",children:p.map(x=>e.jsx("button",{type:"button",onClick:()=>m("color",x),className:`w-6 h-6 rounded border-2 ${o.color===x?"theme-border":"border-transparent"}`,style:{backgroundColor:x}},x))})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("textarea",{value:o.description,onChange:x=>m("description",x.target.value),rows:3,className:"w-full px-3 py-2 border theme-border rounded-md focus:outline-none focus:ring-2 focus:ring-theme-accent focus:border-transparent theme-surface theme-text",placeholder:l==="fr"?"Description du profil...":"Profile description..."})]})]}),c==="trading"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium theme-text mb-4",children:l==="fr"?"ParamÃ¨tres Financiers de Base":"Basic Financial Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:l==="fr"?"Capital Initial":"Initial Capital"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",value:o.settings?.initialCapital,onChange:x=>m("settings.initialCapital",parseFloat(x.target.value)||0),className:"w-full px-3 py-2 pr-12 border theme-border rounded-md focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},placeholder:"10000",required:!0}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"theme-text-muted text-sm",children:o.settings?.currency})})]}),e.jsx("p",{className:"text-xs theme-text-muted mt-1",children:l==="fr"?"Montant de dÃ©part de votre compte de trading":"Starting amount of your trading account"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:l==="fr"?"Devise":"Currency"}),e.jsxs("select",{value:o.settings?.currency,onChange:x=>m("settings.currency",x.target.value),className:"w-full px-3 py-2 border theme-border rounded-md focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},children:[e.jsx("option",{value:"EUR",children:"Euro (â‚¬)"}),e.jsx("option",{value:"USD",children:"Dollar US ($)"}),e.jsx("option",{value:"GBP",children:"Livre Sterling (Â£)"}),e.jsx("option",{value:"CHF",children:"Franc Suisse (CHF)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:l==="fr"?"Risque par Trade (%)":"Risk per Trade (%)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.1",min:"0",max:"100",value:o.settings?.riskPerTrade,onChange:x=>m("settings.riskPerTrade",parseFloat(x.target.value)||0),className:"w-full px-3 py-2 pr-8 border theme-border rounded-md focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},placeholder:"2",required:!0}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"theme-text-muted text-sm",children:"%"})})]}),e.jsx("p",{className:"text-xs theme-text-muted mt-1",children:l==="fr"?"Pourcentage du capital que vous risquez par trade (recommandÃ©: 1-3%)":"Percentage of capital you risk per trade (recommended: 1-3%)"})]})]})]})}),c==="display"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium theme-text mb-4",children:l==="fr"?"Sections de Statistiques Ã  Afficher":"Statistics Sections to Display"}),e.jsx("p",{className:"text-sm theme-text-muted mb-6",children:l==="fr"?"Choisissez quelles sections de statistiques afficher dans l'interface":"Choose which statistics sections to display in the interface"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 theme-surface rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{style:{color:"var(--theme-info)"},children:"â±ï¸"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium theme-text",children:l==="fr"?"Statistiques de DurÃ©e":"Duration Statistics"}),e.jsx("p",{className:"text-xs theme-text-muted",children:l==="fr"?"DurÃ©e moyenne, plus court/long trade, etc.":"Average duration, shortest/longest trade, etc."})]})]}),e.jsx("button",{type:"button",onClick:()=>m("settings.statsDisplay.showDurationStats",!o.settings?.statsDisplay?.showDurationStats),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors",style:{backgroundColor:o.settings?.statsDisplay?.showDurationStats?"var(--theme-accent)":"var(--theme-surface)"},children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${o.settings?.statsDisplay?.showDurationStats?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 theme-surface rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-green-600 dark:text-green-400",children:"ðŸŽ¯"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium theme-text",children:l==="fr"?"Statistiques de Ticks":"Tick Statistics"}),e.jsx("p",{className:"text-xs theme-text-muted",children:l==="fr"?"Ticks capturÃ©s, efficacitÃ©, meilleure capture (scalping)":"Captured ticks, efficiency, best capture (scalping)"})]})]}),e.jsx("button",{type:"button",onClick:()=>m("settings.statsDisplay.showTicksStats",!o.settings?.statsDisplay?.showTicksStats),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors",style:{backgroundColor:o.settings?.statsDisplay?.showTicksStats?"var(--theme-accent)":"var(--theme-surface)"},children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${o.settings?.statsDisplay?.showTicksStats?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg border-2 border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-green-600 dark:text-green-400",children:"ðŸ“ˆ"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium theme-text",children:l==="fr"?"Graphique Cumulatif des Ticks":"Cumulative Tick Chart"}),e.jsx("p",{className:"text-xs theme-text-muted",children:l==="fr"?"Courbe en escalier des ticks cumulÃ©s (idÃ©al pour scalpers)":"Step chart of cumulative ticks (ideal for scalpers)"})]})]}),e.jsx("button",{type:"button",onClick:()=>m("settings.statsDisplay.showTicksCumulativeChart",!o.settings?.statsDisplay?.showTicksCumulativeChart),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${o.settings?.statsDisplay?.showTicksCumulativeChart?"bg-green-600":"bg-gray-200 dark:bg-gray-600"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${o.settings?.statsDisplay?.showTicksCumulativeChart?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 theme-surface rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-orange-600 dark:text-orange-400",children:"ðŸ’°"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium theme-text",children:l==="fr"?"Analyse des Frais":"Fee Analysis"}),e.jsx("p",{className:"text-xs theme-text-muted",children:l==="fr"?"Commissions, spreads, impact sur la rentabilitÃ©":"Commissions, spreads, impact on profitability"})]})]}),e.jsx("button",{type:"button",onClick:()=>m("settings.statsDisplay.showFeesStats",!o.settings?.statsDisplay?.showFeesStats),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors",style:{backgroundColor:o.settings?.statsDisplay?.showFeesStats?"var(--theme-accent)":"var(--theme-surface)"},children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${o.settings?.statsDisplay?.showFeesStats?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 theme-surface rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-purple-600 dark:text-purple-400",children:"ðŸ“Š"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium theme-text",children:l==="fr"?"Statistiques de Lots":"Lot Statistics"}),e.jsx("p",{className:"text-xs theme-text-muted",children:l==="fr"?"Taille moyenne des positions, lots max, etc.":"Average position size, max lots, etc."})]})]}),e.jsx("button",{type:"button",onClick:()=>m("settings.statsDisplay.showLotsStats",!o.settings?.statsDisplay?.showLotsStats),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors",style:{backgroundColor:o.settings?.statsDisplay?.showLotsStats?"var(--theme-accent)":"var(--theme-surface)"},children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${o.settings?.statsDisplay?.showLotsStats?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 theme-surface rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-indigo-600 dark:text-indigo-400",children:"ðŸ”¬"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium theme-text",children:l==="fr"?"MÃ©triques AvancÃ©es":"Advanced Metrics"}),e.jsx("p",{className:"text-xs theme-text-muted",children:l==="fr"?"Statistiques dÃ©taillÃ©es et mÃ©triques complexes":"Detailed statistics and complex metrics"})]})]}),e.jsx("button",{type:"button",onClick:()=>m("settings.statsDisplay.showAdvancedMetrics",!o.settings?.statsDisplay?.showAdvancedMetrics),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors",style:{backgroundColor:o.settings?.statsDisplay?.showAdvancedMetrics?"var(--theme-accent)":"var(--theme-surface)"},children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${o.settings?.statsDisplay?.showAdvancedMetrics?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 theme-surface rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"theme-text-muted",children:"ðŸ“±"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium theme-text",children:l==="fr"?"Vue Compacte":"Compact View"}),e.jsx("p",{className:"text-xs theme-text-muted",children:l==="fr"?"Interface plus dense avec moins d'espacement":"Denser interface with less spacing"})]})]}),e.jsx("button",{type:"button",onClick:()=>m("settings.statsDisplay.compactView",!o.settings?.statsDisplay?.compactView),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors",style:{backgroundColor:o.settings?.statsDisplay?.compactView?"var(--theme-accent)":"var(--theme-surface)"},children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${o.settings?.statsDisplay?.compactView?"translate-x-6":"translate-x-1"}`})})]})]})]})}),c==="ui"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l==="fr"?"Vue par DÃ©faut":"Default View"}),e.jsxs("select",{value:o.uiSettings?.defaultView,onChange:x=>m("uiSettings.defaultView",x.target.value),className:"w-full px-3 py-2 border theme-border rounded-md focus:outline-none focus:ring-2 focus:ring-theme-accent focus:border-transparent theme-surface theme-text",children:[e.jsx("option",{value:"overview",children:l==="fr"?"Vue d'Ensemble":"Overview"}),e.jsx("option",{value:"stats",children:l==="fr"?"Statistiques":"Statistics"}),e.jsx("option",{value:"trades",children:l==="fr"?"Liste des Trades":"Trades List"}),e.jsx("option",{value:"charts",children:l==="fr"?"Graphiques":"Charts"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:l==="fr"?"Onglet affichÃ© par dÃ©faut Ã  l'ouverture de l'application":"Default tab displayed when opening the application"})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 theme-text theme-surface rounded-md hover:theme-surface transition-colors",children:l==="fr"?"Annuler":"Cancel"}),e.jsxs("button",{type:"submit",className:"flex items-center space-x-2 px-4 py-2 theme-text rounded-md transition-colors",style:{backgroundColor:"var(--theme-accent)"},onMouseEnter:x=>{x.currentTarget.style.backgroundColor="var(--theme-accent-hover)"},onMouseLeave:x=>{x.currentTarget.style.backgroundColor="var(--theme-accent)"},children:[e.jsx(Dt,{size:16}),e.jsx("span",{children:t?l==="fr"?"Modifier":"Update":l==="fr"?"CrÃ©er":"Create"})]})]})]})]})})},Qp=({profiles:t,activeProfile:s,onProfileChange:r,onCreateProfile:l,onUpdateProfile:n,onDeleteProfile:o,onClose:a,defaultTab:c="profiles"})=>{const[i,d]=b.useState(c),[u,m]=b.useState(!1),[p,x]=b.useState(null),{currentTheme:f,themes:g,setTheme:h}=ee(),{currentLanguage:y,changeLanguage:j}=X(),v=()=>{x(null),m(!0)},N=k=>{x(k),m(!0)},S=k=>{p?n(k):l(k),m(!1),x(null)},w=k=>y==="fr"?k==="light"?"Clair":k==="dark"?"Sombre":k==="ultra-dark"?"Ultra Sombre":"ThÃ¨me":k==="light"?"Light":k==="dark"?"Dark":k==="ultra-dark"?"Ultra Dark":"Theme";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-6xl h-[90vh] theme-surface rounded-xl shadow-2xl overflow-hidden",style:{backgroundColor:f.colors.surface},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b theme-border",children:[e.jsx("h1",{className:"text-2xl font-bold theme-text",children:y==="fr"?"ParamÃ¨tres & Profils":"Settings & Profiles"}),e.jsx("button",{onClick:a,className:"p-2 rounded-lg hover:theme-surface transition-colors",children:e.jsx(be,{size:24,className:"theme-text"})})]}),e.jsxs("div",{className:"flex space-x-1 p-6 pb-0",children:[e.jsxs("button",{onClick:()=>d("profiles"),className:`flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i==="profiles"?"theme-text shadow-sm":"theme-text-muted hover:theme-text"}`,style:{backgroundColor:i==="profiles"?f.colors.accent:"transparent"},children:[e.jsx(Ko,{size:16,className:"mr-2"}),y==="fr"?"Profils":"Profiles"]}),e.jsxs("button",{onClick:()=>d("preferences"),className:`flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i==="preferences"?"theme-text shadow-sm":"theme-text-muted hover:theme-text"}`,style:{backgroundColor:i==="preferences"?f.colors.accent:"transparent"},children:[e.jsx(ke,{size:16,className:"mr-2"}),y==="fr"?"PrÃ©fÃ©rences":"Preferences"]}),e.jsxs("button",{onClick:()=>d("advanced"),className:`flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i==="advanced"?"theme-text shadow-sm":"theme-text-muted hover:theme-text"}`,style:{backgroundColor:i==="advanced"?f.colors.accent:"transparent"},children:[e.jsx(ss,{size:16,className:"mr-2"}),y==="fr"?"AvancÃ©":"Advanced"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[i==="profiles"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"card rounded-lg shadow-sm p-6 border-2 border-dashed transition-colors cursor-pointer",style:{borderColor:"var(--theme-border)"},onClick:v,onMouseEnter:k=>{k.currentTarget.style.borderColor="var(--theme-accent)"},onMouseLeave:k=>{k.currentTarget.style.borderColor="var(--theme-border)"},children:e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx(Ye,{size:24,style:{color:"var(--theme-accent)"}}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium theme-text",children:y==="fr"?"CrÃ©er un nouveau profil":"Create a new profile"}),e.jsx("p",{className:"text-sm theme-text-muted",children:y==="fr"?"Commencer avec un nouveau profil de trading":"Start with a new trading profile"})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(k=>e.jsxs("div",{className:"card rounded-lg shadow-sm p-4 border-2 transition-all cursor-pointer hover:shadow-md",style:{borderColor:s?.id===k.id?f.colors.accent:"var(--theme-border)",backgroundColor:s?.id===k.id?`${f.colors.accent}10`:"transparent"},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:k.color}}),e.jsx("span",{className:"font-medium theme-text",children:k.name}),k.accountType==="demo"&&e.jsx("span",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:`${f.colors.accent}20`,color:f.colors.accent},children:y==="fr"?"DÃ©mo":"Demo"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:M=>{M.stopPropagation(),N(k)},className:"p-1 theme-text-muted transition-colors",style:{color:"var(--theme-text-muted)"},onMouseEnter:M=>{M.currentTarget.style.color="var(--theme-accent)"},onMouseLeave:M=>{M.currentTarget.style.color="var(--theme-text-muted)"},children:e.jsx(fi,{size:16})}),e.jsx("button",{onClick:M=>{M.stopPropagation(),window.confirm(y==="fr"?"Supprimer ce profil ?":"Delete this profile?")&&o(k)},className:"p-1 theme-text-muted transition-colors",style:{color:"var(--theme-text-muted)"},onMouseEnter:M=>{M.currentTarget.style.color="var(--theme-danger)"},onMouseLeave:M=>{M.currentTarget.style.color="var(--theme-text-muted)"},children:e.jsx(es,{size:16})})]})]}),e.jsx("p",{className:"text-sm theme-text-muted mb-3 line-clamp-2",children:k.description||(y==="fr"?"Aucune description":"No description")}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm theme-text-muted",children:["Capital:"," ",k.settings.initialCapital.toLocaleString()," ",k.settings.currency]}),s?.id===k.id?e.jsxs("div",{className:"flex items-center space-x-1",style:{color:f.colors.accent},children:[e.jsx(_t,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:y==="fr"?"Actif":"Active"})]}):e.jsx("button",{onClick:M=>{M.stopPropagation(),r(k)},className:"px-3 py-1 text-sm theme-text rounded-md transition-colors",style:{backgroundColor:f.colors.accent,color:f.colors.text},onMouseEnter:M=>{M.currentTarget.style.backgroundColor=f.colors.accentHover},onMouseLeave:M=>{M.currentTarget.style.backgroundColor=f.colors.accent},children:y==="fr"?"Activer":"Activate"})]})]},k.id))})]}),i==="preferences"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card rounded-lg shadow-sm p-6",children:[e.jsxs("h3",{className:"text-lg font-medium theme-text mb-4 flex items-center",children:[e.jsx(Ho,{size:20,className:"mr-2"}),y==="fr"?"ThÃ¨me":"Theme"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:g.map(k=>e.jsx("button",{onClick:()=>h(k.id),className:`p-4 rounded-lg border-2 transition-all ${f.id===k.id?"shadow-md":"theme-border hover:theme-border-hover"}`,style:{borderColor:f.id===k.id?f.colors.accent:"var(--theme-border)",backgroundColor:f.id===k.id?`${f.colors.accent}10`:"transparent"},children:e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300",style:{backgroundColor:k.colors.bg}}),e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:k.colors.accent}})]}),e.jsx("span",{className:"font-medium theme-text",children:w(k.id)}),f.id===k.id&&e.jsx(_t,{size:16,className:"ml-auto",style:{color:f.colors.accent}})]})},k.id))})]}),e.jsxs("div",{className:"card rounded-lg shadow-sm p-6",children:[e.jsxs("h3",{className:"text-lg font-medium theme-text mb-4 flex items-center",children:[e.jsx(Bo,{size:20,className:"mr-2"}),y==="fr"?"Langue":"Language"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("button",{onClick:()=>j("fr"),className:`p-4 rounded-lg border-2 transition-all ${y==="fr"?"shadow-md":"theme-border hover:theme-border-hover"}`,style:{borderColor:y==="fr"?f.colors.accent:"var(--theme-border)",backgroundColor:y==="fr"?`${f.colors.accent}10`:"transparent"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ‡«ðŸ‡·"}),e.jsx("span",{className:"font-medium theme-text",children:"FranÃ§ais"}),y==="fr"&&e.jsx(_t,{size:16,className:"mx-auto mt-2",style:{color:f.colors.accent}})]})}),e.jsx("button",{onClick:()=>j("en"),className:`p-4 rounded-lg border-2 transition-all ${y==="en"?"shadow-md":"theme-border hover:theme-border-hover"}`,style:{borderColor:y==="en"?f.colors.accent:"var(--theme-border)",backgroundColor:y==="en"?`${f.colors.accent}10`:"transparent"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ‡¬ðŸ‡§"}),e.jsx("span",{className:"font-medium theme-text",children:"English"}),y==="en"&&e.jsx(_t,{size:16,className:"mx-auto mt-2",style:{color:f.colors.accent}})]})})]})]})]}),i==="advanced"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card rounded-lg shadow-sm p-6",children:[e.jsxs("h3",{className:"text-lg font-medium theme-text mb-4 flex items-center",children:[e.jsx(Me,{size:20,className:"mr-2"}),y==="fr"?"ParamÃ¨tres AvancÃ©s":"Advanced Settings"]}),e.jsx("p",{className:"text-sm theme-text-muted",children:y==="fr"?"Cette section sera dÃ©veloppÃ©e dans les futures versions avec des options avancÃ©es de configuration.":"This section will be developed in future versions with advanced configuration options."})]})})]}),u&&e.jsx(Wa,{profile:p||void 0,onSubmit:S,onClose:()=>{m(!1),x(null)}})]})})},Va=({settings:t,onSettingsChange:s,onClose:r})=>{const{currentTheme:l}=ee(),{currentLanguage:n}=X(),[o,a]=b.useState({showDurationStats:t.statsDisplay?.showDurationStats??!0,showTicksStats:t.statsDisplay?.showTicksStats??!0,showTicksCumulativeChart:t.statsDisplay?.showTicksCumulativeChart??!0,showFeesStats:t.statsDisplay?.showFeesStats??!0,showLotsStats:t.statsDisplay?.showLotsStats??!0,showAdvancedMetrics:t.statsDisplay?.showAdvancedMetrics??!1,compactView:t.statsDisplay?.compactView??!1}),c=d=>{a(u=>({...u,[d]:!u[d]}))},i=()=>{const d={...t,statsDisplay:o};s(d),r()};return o.showDurationStats,o.showTicksStats,o.showTicksCumulativeChart,o.showFeesStats,o.showLotsStats,o.showAdvancedMetrics,o.compactView,e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-2xl max-h-[85vh] bg-white dark:bg-gray-800 rounded-xl shadow-2xl overflow-hidden",style:{backgroundColor:l.colors.surface},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h1",{className:"text-xl font-bold theme-text",children:n==="fr"?"Affichage des Statistiques":"Statistics Display"}),e.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx(be,{size:20,className:"theme-text"})})]}),e.jsxs("div",{className:"p-4 space-y-3 max-h-[60vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx($e,{size:20,className:"text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:n==="fr"?"Statistiques de DurÃ©e":"Duration Statistics"}),e.jsx("div",{className:"text-sm theme-text-muted",children:n==="fr"?"DurÃ©e moyenne, plus court/long trade, etc.":"Average duration, shortest/longest trade, etc."})]})]}),e.jsx("button",{onClick:()=>c("showDurationStats"),className:`w-12 h-6 rounded-full transition-colors ${o.showDurationStats?"bg-blue-600":"theme-surface"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full transition-transform ${o.showDurationStats?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Me,{size:20,className:"text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:n==="fr"?"Statistiques de Ticks":"Ticks Statistics"}),e.jsx("div",{className:"text-sm theme-text-muted",children:n==="fr"?"Ticks capturÃ©s, efficacitÃ©, meilleure capture (scalping)":"Ticks captured, efficiency, better capture (scalping)"})]})]}),e.jsx("button",{onClick:()=>c("showTicksStats"),className:`w-12 h-6 rounded-full transition-colors ${o.showTicksStats?"bg-blue-600":"theme-surface"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full transition-transform ${o.showTicksStats?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-600 bg-green-50 dark:bg-green-900/20",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ee,{size:20,className:"text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:n==="fr"?"Graphique Cumulatif des Ticks":"Cumulative Ticks Chart"}),e.jsx("div",{className:"text-sm theme-text-muted",children:n==="fr"?"Courbe en escalier des ticks cumulÃ©s (idÃ©al pour scalpers)":"Cumulative ticks step curve (ideal for scalpers)"})]})]}),e.jsx("button",{onClick:()=>c("showTicksCumulativeChart"),className:`w-12 h-6 rounded-full transition-colors ${o.showTicksCumulativeChart?"bg-blue-600":"theme-surface"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full transition-transform ${o.showTicksCumulativeChart?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ke,{size:20,className:"text-yellow-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:n==="fr"?"Analyse des Frais":"Fees Analysis"}),e.jsx("div",{className:"text-sm theme-text-muted",children:n==="fr"?"Commissions, spreads, impact sur la rentabilitÃ©":"Commissions, spreads, impact on profitability"})]})]}),e.jsx("button",{onClick:()=>c("showFeesStats"),className:`w-12 h-6 rounded-full transition-colors ${o.showFeesStats?"bg-blue-600":"theme-surface"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full transition-transform ${o.showFeesStats?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(He,{size:20,className:"text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:n==="fr"?"Statistiques de Lots":"Lots Statistics"}),e.jsx("div",{className:"text-sm theme-text-muted",children:n==="fr"?"Taille moyenne des positions, lots max, etc.":"Average position size, max lots, etc."})]})]}),e.jsx("button",{onClick:()=>c("showLotsStats"),className:`w-12 h-6 rounded-full transition-colors ${o.showLotsStats?"bg-blue-600":"theme-surface"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full transition-transform ${o.showLotsStats?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Nn,{size:20,className:"text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium theme-text",children:n==="fr"?"MÃ©triques AvancÃ©es":"Advanced Metrics"}),e.jsx("div",{className:"text-sm theme-text-muted",children:n==="fr"?"Statistiques dÃ©taillÃ©es et mÃ©triques complexes":"Detailed statistics and complex metrics"})]})]}),e.jsx("button",{onClick:()=>c("showAdvancedMetrics"),className:`w-12 h-6 rounded-full transition-colors ${o.showAdvancedMetrics?"bg-blue-600":"theme-surface"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full transition-transform ${o.showAdvancedMetrics?"translate-x-6":"translate-x-1"}`})})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 p-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:n==="fr"?"Annuler":"Cancel"}),e.jsxs("button",{onClick:i,className:"px-4 py-2 bg-blue-600 theme-text rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[e.jsx(Dt,{size:16}),e.jsx("span",{children:n==="fr"?"Modifier":"Save"})]})]})]})})},Ae=t=>Array.isArray(t)&&t.length>0,Ns=t=>t!=null&&t!=="",pt=t=>!!(t&&(Ns(t.min)||Ns(t.max))),zs=t=>!!(t&&(Ns(t.start)||Ns(t.end))),Zp=t=>{const s=[];return zs(t.dateRange)&&s.push({section:"time",key:"dateRange"}),zs(t.timeRange)&&s.push({section:"time",key:"timeRange"}),Ae(t.sessions)&&s.push({section:"time",key:"sessions"}),Ae(t.months)&&s.push({section:"time",key:"months"}),Ae(t.weekdays)&&s.push({section:"time",key:"weekdays"}),Ae(t.hours)&&s.push({section:"time",key:"hours"}),pt(t.pnlRange)&&s.push({section:"performance",key:"pnlRange"}),pt(t.durationRange)&&s.push({section:"performance",key:"durationRange"}),t.tradeResult&&(t.tradeResult.takeProfit||t.tradeResult.stopLoss||t.tradeResult.breakEven)&&s.push({section:"performance",key:"tradeResult"}),pt(t.feesRange)&&s.push({section:"performance",key:"feesRange"}),Ae(t.marketType)&&s.push({section:"market",key:"marketType"}),Ae(t.symbols)&&s.push({section:"market",key:"symbols"}),Ae(t.strategy)&&s.push({section:"market",key:"strategy"}),Ae(t.trend)&&s.push({section:"market",key:"trend"}),Ae(t.direction)&&s.push({section:"market",key:"direction"}),Ae(t.status)&&s.push({section:"market",key:"status"}),Ae(t.timeframe)&&s.push({section:"market",key:"timeframe"}),Ae(t.tickEntry)&&s.push({section:"market",key:"tickEntry"}),pt(t.contractsRange)&&s.push({section:"exposure",key:"contractsRange"}),pt(t.lotsRange)&&s.push({section:"exposure",key:"lotsRange"}),Ae(t.tags)&&s.push({section:"tags",key:"tags"}),s},eh=t=>{const s=[];if(zs(t.dateRange)&&s.push({id:"dateRange",labelKey:"dateRange",value:`${String(t.dateRange.start)} â†’ ${String(t.dateRange.end)}`}),zs(t.timeRange)&&s.push({id:"timeRange",labelKey:"timeRange",value:`${String(t.timeRange.start)} â†’ ${String(t.timeRange.end)}`}),Ae(t.months)&&s.push({id:"months",labelKey:"months",value:t.months.join(", ")}),Ae(t.weekdays)&&s.push({id:"weekdays",labelKey:"weekdays",value:t.weekdays.join(", ")}),Ae(t.hours)&&s.push({id:"hours",labelKey:"hours",value:t.hours.join(", ")}),Ae(t.sessions)&&s.push({id:"sessions",labelKey:"sessions",value:t.sessions.join(", ")}),pt(t.pnlRange)&&s.push({id:"pnlRange",labelKey:"pnl",value:`${String(t.pnlRange.min??"")} â€“ ${String(t.pnlRange.max??"")}`}),pt(t.durationRange)&&s.push({id:"durationRange",labelKey:"duration",value:`${String(t.durationRange.min??"")} â€“ ${String(t.durationRange.max??"")}`}),t.tradeResult&&(t.tradeResult.takeProfit||t.tradeResult.stopLoss||t.tradeResult.breakEven)){const r=[];t.tradeResult.takeProfit&&r.push("TP"),t.tradeResult.stopLoss&&r.push("SL"),t.tradeResult.breakEven&&r.push("BE"),s.push({id:"tradeResult",labelKey:"tradeResult",value:r.join(", ")})}return pt(t.feesRange)&&s.push({id:"feesRange",labelKey:"fees",value:`${String(t.feesRange.min??"")} â€“ ${String(t.feesRange.max??"")}`}),Ae(t.marketType)&&s.push({id:"marketType",labelKey:"marketType",value:t.marketType.join(", ")}),Ae(t.symbols)&&s.push({id:"symbols",labelKey:"symbols",value:t.symbols.join(", ")}),Ae(t.strategy)&&s.push({id:"strategy",labelKey:"strategy",value:t.strategy.join(", ")}),Ae(t.trend)&&s.push({id:"trend",labelKey:"trend",value:t.trend.join(", ")}),Ae(t.direction)&&s.push({id:"direction",labelKey:"direction",value:t.direction.join(", ")}),Ae(t.status)&&s.push({id:"status",labelKey:"status",value:t.status.join(", ")}),Ae(t.timeframe)&&s.push({id:"timeframe",labelKey:"timeframe",value:t.timeframe.join(", ")}),Ae(t.tickEntry)&&s.push({id:"tickEntry",labelKey:"tickEntry",value:t.tickEntry.join(", ")}),pt(t.contractsRange)&&s.push({id:"contractsRange",labelKey:"contracts",value:`${String(t.contractsRange.min??"")} â€“ ${String(t.contractsRange.max??"")}`}),pt(t.lotsRange)&&s.push({id:"lotsRange",labelKey:"lots",value:`${String(t.lotsRange.min??"")} â€“ ${String(t.lotsRange.max??"")}`}),Ae(t.tags)&&s.push({id:"tags",labelKey:"tags",value:t.tags.join(", ")}),s},th=t=>{const r={...{time:0,performance:0,exposure:0,market:0,tags:0}};return zs(t.dateRange)&&r.time++,zs(t.timeRange)&&r.time++,Ae(t.sessions)&&r.time++,Ae(t.months)&&r.time++,Ae(t.weekdays)&&r.time++,Ae(t.hours)&&r.time++,pt(t.pnlRange)&&r.performance++,pt(t.durationRange)&&r.performance++,t.tradeResult&&(t.tradeResult.takeProfit||t.tradeResult.stopLoss||t.tradeResult.breakEven)&&r.performance++,pt(t.feesRange)&&r.performance++,Ns(t.market)&&(typeof t.market!="string"||t.market!=="all")&&r.market++,Ns(t.symbol)&&r.market++,Ae(t.strategy)&&r.market++,Ae(t.trend)&&r.market++,Ns(t.side)&&r.market++,Ae(t.status)&&r.market++,pt(t.contractsRange)&&r.exposure++,pt(t.lotsRange)&&r.exposure++,pt(t.ticksRange)&&r.exposure++,Ae(t.tags)&&r.tags++,r},Ba=({isOpen:t,onClose:s,activeFilters:r,onNavigateToFilter:l,onResetFilter:n})=>{const{currentLanguage:o}=X(),{currentTheme:a}=ee();if(!t)return null;const c={time:{light:"text-[#3b82f6]",dark:"text-[#3b82f6]","ultra-dark":"text-[#3b82f6]"},performance:{light:"text-[#16a34a]",dark:"text-[#16a34a]","ultra-dark":"text-[#22c55e]"},exposition:{light:"text-[#ca8a04]",dark:"text-[#ca8a04]","ultra-dark":"text-[#eab308]"},market:{light:"text-[#ea580c]",dark:"text-[#ea580c]","ultra-dark":"text-[#f97316]"},tags:{light:"text-[#4f46e5]",dark:"text-[#4f46e5]","ultra-dark":"text-[#6366f1]"}},i=x=>{const f=a.id,g=c[x];return g&&g[f]||Object.values(g||{})[0]||"text-blue-600"},d={time:e.jsx($e,{size:20,className:i("time")}),performance:e.jsx(Ee,{size:20,className:i("performance")}),exposition:e.jsx(Tt,{size:20,className:i("exposition")}),market:e.jsx(He,{size:20,className:i("market")}),tags:e.jsx(ms,{size:20,className:i("tags")})},u={time:o==="fr"?"Temps":"Time",performance:"Performance",exposition:o==="fr"?"Exposition":"Exposure",market:o==="fr"?"MarchÃ©":"Market",tags:"Tags"},m=r.reduce((x,f)=>(x[f.category]||(x[f.category]=[]),x[f.category].push(f),x),{}),p=x=>{l(x.category,x.section),s()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50",onClick:s}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:x=>x.stopPropagation(),children:e.jsxs("div",{className:"w-full max-w-2xl max-h-[80vh] overflow-y-auto rounded-lg shadow-2xl",style:{backgroundColor:a.colors.surface,border:`1px solid ${a.colors.border}`},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b theme-border",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:`${a.colors.accent}20`},children:e.jsx(ds,{size:24,style:{color:a.colors.accent}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold theme-text",children:o==="fr"?"Filtres Actifs":"Active Filters"}),e.jsx("p",{className:"text-sm theme-text-muted",children:o==="fr"?`${r.length} filtre(s) actif(s) - Cliquez pour naviguer`:`${r.length} active filter(s) - Click to navigate`})]})]}),e.jsx("button",{onClick:s,className:"p-2 rounded-lg hover:theme-surface transition-colors",children:e.jsx(be,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[Object.entries(m).map(([x,f])=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 pb-2 border-b theme-border",children:[d[x],e.jsx("h3",{className:"text-lg font-semibold theme-text",children:u[x]}),e.jsxs("span",{className:"text-sm theme-text-muted",children:["(",f.length,")"]})]}),e.jsx("div",{className:"space-y-2 pl-8",children:f.map((g,h)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>p(g),className:"flex-1 text-left p-3 rounded-lg hover:theme-surface transition-colors border theme-border group",style:{borderColor:"var(--theme-border)"},onMouseEnter:y=>{y.currentTarget.style.borderColor="var(--theme-accent)"},onMouseLeave:y=>{y.currentTarget.style.borderColor="var(--theme-border)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium theme-text transition-colors",style:{color:"var(--theme-text)"},onMouseEnter:y=>{y.currentTarget.style.color="var(--theme-accent)"},onMouseLeave:y=>{y.currentTarget.style.color="var(--theme-text)"},children:g.description}),e.jsx("div",{className:"text-sm theme-text-muted mt-1",children:g.value})]}),e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity",style:{color:"var(--theme-accent)"},children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})}),e.jsx("button",{onClick:y=>{y.stopPropagation(),n(g.category,g.section)},className:"p-2 rounded-lg transition-colors border group",style:{borderColor:"var(--theme-danger)",backgroundColor:"transparent"},onMouseEnter:y=>{y.currentTarget.style.backgroundColor=`${a.colors.danger}20`,y.currentTarget.style.borderColor=a.colors.danger},onMouseLeave:y=>{y.currentTarget.style.backgroundColor="transparent",y.currentTarget.style.borderColor="var(--theme-danger)"},title:o==="fr"?"RÃ©initialiser ce filtre":"Reset this filter",children:e.jsx("svg",{className:"w-4 h-4 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{color:"var(--theme-danger)"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},`${g.category}-${g.section}-${h}`))})]},x)),r.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"theme-text-muted mb-2",children:e.jsx(ds,{size:48,className:"mx-auto"})}),e.jsx("p",{className:"theme-text-muted",children:o==="fr"?"Aucun filtre actif":"No active filters"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t theme-border",children:[e.jsx("div",{className:"text-sm theme-text-muted",children:o==="fr"?"Cliquez sur un filtre pour naviguer vers sa section":"Click on a filter to navigate to its section"}),e.jsx("button",{onClick:s,className:"px-4 py-2 theme-surface theme-text rounded-lg hover:theme-surface transition-colors",children:o==="fr"?"Fermer":"Close"})]})]})})]})},sh={dateRange:"dateRange",timeRange:"hoursTimeRange",sessions:"sessions",months:"months",weekdays:"weekdays",hours:"hours",symbol:"marketType",strategy:"strategies",trend:"trend",side:"direction",status:"status",market:"marketType",pnlRange:"pnl",durationRange:"duration",tradeResult:"tradeResult",feesRange:"fees",contractsRange:"contracts",lotsRange:"lots",ticksRange:"ticks",tags:"tags"};function rh(t){const[s,r]=b.useState(!1),[l,n]=b.useState(!1),[o,a]=b.useState(!1),c=b.useRef({isCollapsed:!1,isPinned:!1,isHovering:!1}),i=b.useRef(!1);b.useEffect(()=>{c.current={isCollapsed:s,isPinned:o,isHovering:l}},[s,o,l]),b.useEffect(()=>{if(t&&!i.current&&(r(!1),n(!1),a(!1)),i.current){const m=setTimeout(()=>{i.current=!1},100);return()=>clearTimeout(m)}},[t]);const d=b.useCallback(()=>{i.current=!0,r(m=>!m)},[]),u=b.useCallback(()=>{r(!1),n(!0),a(!1),setTimeout(()=>{r(!0),n(!1)},2e3)},[]);return{isCollapsed:s,isHovering:l,isPinned:o,setIsCollapsed:r,setIsHovering:n,setIsPinned:a,isTogglingRef:i,toggleOpen:d,forcePreviewThenCollapse:u}}const oh=()=>{const[t,s]=b.useState({dateRange:!0,timeRange:!0,weekdays:!0,months:!0,hours:!0,hoursMain:!0,hoursTimeRange:!0,sessions:!0,contracts:!0,marketType:!0,symbols:!0,strategies:!0,trendDirection:!0,status:!0,timeframeTick:!0,pnl:!0,duration:!0,tradeResult:!0,fees:!0,lots:!0,ticks:!0,tags:!0}),r=b.useCallback(d=>{s(u=>({...u,[d]:!u[d]}))},[]),l=b.useCallback(()=>{const d=["dateRange","timeRange","weekdays","months","hours","hoursMain","hoursTimeRange","sessions"];s(u=>{const m=d.every(x=>u[x]),p={...u};return d.forEach(x=>{p[x]=!m}),p})},[]),n=b.useCallback(()=>{const d=["marketType","symbols","strategies","trendDirection","status","timeframeTick"];s(u=>{const m=d.every(x=>u[x]),p={...u};return d.forEach(x=>{p[x]=!m}),p})},[]),o=b.useCallback(()=>{const d=["pnl","duration","tradeResult","fees"];s(u=>{const m=d.every(x=>u[x]),p={...u};return d.forEach(x=>{p[x]=!m}),p})},[]),a=b.useCallback(()=>{const d=["contracts","lots","ticks"];s(u=>{const m=d.every(x=>u[x]),p={...u};return d.forEach(x=>{p[x]=!m}),p})},[]),c=b.useCallback(()=>{const d=["tags"];s(u=>{const m=d.every(x=>u[x]),p={...u};return d.forEach(x=>{p[x]=!m}),p})},[]),i=b.useCallback((d,u)=>{s(m=>{const p={...m};return Object.keys(p).forEach(x=>{p[x]=!0}),p[d]=!1,u&&(p[u]=!1),p})},[]);return{collapsedSections:t,toggleSection:r,toggleAllTimeSections:l,toggleAllMarketSections:n,toggleAllPerformanceSections:o,toggleAllExpositionSections:a,toggleAllTagsSections:c,openExclusiveSection:i}},nh={time:{light:"text-[#2563eb]",dark:"text-[#2563eb]","ultra-dark":"text-[#3b82f6]"},performance:{light:"text-[#16a34a]",dark:"text-[#16a34a]","ultra-dark":"text-[#22c55e]"},exposition:{light:"text-[#ca8a04]",dark:"text-[#ca8a04]","ultra-dark":"text-[#eab308]"},market:{light:"text-[#ea580c]",dark:"text-[#ea580c]","ultra-dark":"text-[#f97316]"},tags:{light:"text-[#4f46e5]",dark:"text-[#4f46e5]","ultra-dark":"text-[#6366f1]"}},wo={time:{light:{base:"#1e40af",borderInactive:"#2563eb",borderHover:"#3b82f6"},dark:{base:"#1e40af",borderInactive:"#2563eb",borderHover:"#3b82f6"},"ultra-dark":{base:"#1e3a8a",borderInactive:"#1d4ed8",borderHover:"#3b82f6"}},market:{light:{base:"#9a3412",borderInactive:"#ea580c",borderHover:"#ea580c"},dark:{base:"#9a3412",borderInactive:"#ea580c",borderHover:"#ea580c"},"ultra-dark":{base:"#7c2d12",borderInactive:"#ea580c",borderHover:"#ea580c"}},performance:{light:{base:"#14532d",borderInactive:"#16a34a",borderHover:"#22c55e"},dark:{base:"#14532d",borderInactive:"#16a34a",borderHover:"#22c55e"},"ultra-dark":{base:"#14532d",borderInactive:"#16a34a",borderHover:"#22c55e"}},exposition:{light:{base:"#a16207",borderInactive:"#ca8a04",borderHover:"#eab308"},dark:{base:"#a16207",borderInactive:"#ca8a04",borderHover:"#eab308"},"ultra-dark":{base:"#7a5c00",borderInactive:"#ca8a04",borderHover:"#eab308"}},tags:{light:{base:"#4338ca",borderInactive:"#6366f1",borderHover:"#4f46e5"},dark:{base:"#4338ca",borderInactive:"#6366f1",borderHover:"#4f46e5"},"ultra-dark":{base:"#3730a3",borderInactive:"#6366f1",borderHover:"#4f46e5"}}},Sr=(t,s)=>{const r=t.replace("#",""),l=parseInt(r,16),n=l>>16&255,o=l>>8&255,a=l&255;return`rgba(${n}, ${o}, ${a}, ${s})`},lh=(t,s)=>{const r=nh[t];return r&&r[s]||Object.values(r||{})[0]||"text-blue-600"},ah=(t,s,r)=>{const l=wo[t]&&wo[t][s]||wo.time.light,n=r?Sr(l.base,.2):Sr(l.base,.1),o=r?Sr(l.base,.3):Sr(l.base,.15),a=r?l.borderHover:l.borderInactive,c=l.borderHover;return{"--card-bg":n,"--card-bg-hover":o,"--card-border":a,"--card-border-hover":c}},ih=({isCollapsed:t,isPinned:s,currentLanguage:r,currentTheme:l,filteredTradesCount:n,activeFilterCount:o,globalSearchTerm:a,showSearchSuggestions:c,searchSuggestions:i,onToggleCollapse:d,onClose:u,onOpenActiveFilters:m,onChangeSearch:p,onSearchFocus:x,onSearchBlur:f,onClickSuggestion:g,getSectionTextColor:h})=>e.jsxs("div",{className:"flex items-center justify-between p-4 border-b theme-border",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:`${l.colors.border}20`},children:e.jsx(ds,{size:24})}),!t&&e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h2",{className:"text-lg font-bold theme-text",children:r==="fr"?"Filtres":"Filters"}),s&&e.jsxs("div",{className:"px-2 py-1 rounded-full text-xs font-medium flex items-center space-x-1 border border-green-400",style:{border:"1px solid #4ade80"},children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),e.jsx("span",{children:r==="fr"?"Ã‰pinglÃ©":"Pinned"})]})]}),e.jsx("p",{className:"text-sm theme-text-muted",children:s?r==="fr"?"Mode filtres Ã©pinglÃ© (reste ouvert)":"Pinned filter mode (stays open)":r==="fr"?"Mode filtres actif":"Filter mode active"})]}),e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 theme-surface rounded-lg border theme-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-xs font-medium theme-text-secondary",children:[n.filtered,"/",n.total]}),e.jsx("span",{className:"text-xs theme-text-muted",children:r==="fr"?"trades filtrÃ©s":"filtered trades"})]}),e.jsxs("div",{className:"text-xs font-bold theme-text-secondary",children:[n.percentage,"%"]})]}),e.jsxs("button",{onClick:m,className:`flex items-center space-x-2 px-3 py-2 rounded-lg border transition-all duration-200 cursor-pointer group ${o>0?l.id==="ultra-dark"?"bg-indigo-900/20 border-indigo-800 hover:bg-indigo-900/30 hover:border-indigo-500 hover:shadow-md hover:ring-2 hover:ring-indigo-800":l.id==="dark"?"bg-blue-900/20 border-blue-800 hover:bg-blue-900/30 hover:border-blue-500 hover:shadow-md hover:ring-2 hover:ring-blue-800":"bg-blue-50 border-blue-200 hover:bg-blue-100 hover:border-blue-400 hover:shadow-md hover:ring-2 hover:ring-blue-200":l.id==="ultra-dark"?"theme-surface border theme-border hover:theme-surface hover:shadow-sm hover:border-indigo-600 hover:ring-1 hover:ring-indigo-800":l.id==="dark"?"theme-surface border theme-border hover:theme-surface hover:shadow-sm hover:border-blue-600 hover:ring-1 hover:ring-blue-800":"theme-surface border theme-border hover:theme-surface hover:shadow-sm hover:border-blue-300 hover:ring-1 hover:ring-blue-200"}`,children:[e.jsx(ke,{size:14,className:`transition-colors ${o>0?l.id==="ultra-dark"?"text-indigo-400 group-hover:text-indigo-300":l.id==="dark"?"text-blue-400 group-hover:text-blue-300":"text-blue-600 group-hover:text-blue-700":"theme-text-muted group-hover:theme-text-secondary"}`}),e.jsx("span",{className:`text-xs font-medium transition-colors ${o>0?l.id==="ultra-dark"?"text-indigo-300 group-hover:text-indigo-200":l.id==="dark"?"text-blue-300 group-hover:text-blue-200":"text-blue-700 group-hover:text-blue-800":"theme-text-secondary group-hover:theme-text"}`,children:o}),e.jsx("span",{className:`text-xs transition-colors ${o>0?l.id==="ultra-dark"?"text-indigo-400 group-hover:text-indigo-300":l.id==="dark"?"text-blue-400 group-hover:text-blue-300":"text-blue-600 group-hover:text-blue-700":"theme-text-muted group-hover:theme-text-secondary"}`,children:r==="fr"?"filtres actifs":"active filters"})]}),e.jsxs("div",{className:"relative flex-1 max-w-xs",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:r==="fr"?"Rechercher un filtre...":"Search filter...",value:a,onChange:y=>p(y.target.value),onFocus:x,onBlur:f,className:"w-full pl-8 pr-3 py-2 text-xs border rounded-lg focus:outline-none transition-all",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border,color:l.colors.text}}),e.jsx(jt,{size:14,className:"absolute left-2.5 top-1/2 transform -translate-y-1/2 theme-text-muted"})]}),c&&i.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 theme-surface border theme-border rounded-lg shadow-lg z-60 max-h-48 overflow-y-auto",style:{backgroundColor:l.colors.surface,borderColor:l.colors.border},children:i.map((y,j)=>e.jsxs("button",{onClick:()=>g(y),className:"w-full text-left px-3 py-2 text-xs hover:theme-surface transition-colors border-b theme-border last:border-b-0 flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-1",children:[y.type==="category"?e.jsx(ds,{size:12,className:"theme-text-muted"}):e.jsx(jt,{size:12,className:h("time")}),e.jsx("span",{className:"theme-text font-medium",children:y.title})]}),e.jsx("span",{className:"text-xs theme-text-muted",children:y.type==="category"?r==="fr"?"CatÃ©gorie":"Category":r==="fr"?"Filtre":"Filter"})]},`${y.category}-${y.section}-${j}`))})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:d,className:`p-2 rounded-lg transition-all duration-200 ${s?"border-2 border-green-400 hover:border-green-500":"border border-gray-300 hover:border-green-400 hover:bg-green-50 dark:border-gray-600 dark:hover:border-green-400 dark:hover:bg-green-900/20"}`,style:s?{border:"2px solid #4ade80"}:{border:"1px solid var(--theme-border)"},title:s?r==="fr"?"DÃ©sÃ©pingler (se ferme au hover)":"Unpin (closes on hover)":r==="fr"?"Ã‰pingler (reste ouvert)":"Pin (stays open)",children:s?e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),e.jsx(cs,{size:16})]}):e.jsx(cs,{size:20})}),e.jsx("button",{onClick:u,className:"p-2 rounded-lg hover:theme-surface transition-colors",title:r==="fr"?"Fermer":"Close",children:e.jsx(be,{size:20})})]})]}),ch=({categories:t,activeCategory:s,onSelect:r,cardBaseClasses:l,getCategoryCardVars:n})=>e.jsx("div",{className:"grid grid-cols-5 gap-2",children:t.map(o=>e.jsx("button",{onClick:()=>r(o.id),className:`p-3 text-center focus:outline-none focus:ring-0 focus-visible:outline-none focus-visible:ring-0 ${l}`,style:{...n(o.id,s===o.id),clipPath:"polygon(8px 0%, 100% 0%, calc(100% - 8px) 100%, 0% 100%)"},children:e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[o.icon,e.jsx("span",{className:"text-xs font-medium",children:o.label})]})},o.id))}),dh=t=>{const[s,r]=b.useState({});return b.useEffect(()=>{const n={};Array.from(new Set(t.map(a=>a.market))).forEach(a=>{n[a]=!0}),r(n)},[t]),{collapsedMarkets:s,toggleMarket:n=>{r(o=>({...o,[n]:!o[n]}))}}},uh=({currentLanguage:t,filteredTradesCount:s})=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm theme-text-muted",children:t==="fr"?"Filtres actifs":"Active filters"}),e.jsx("div",{className:"w-3 h-3 bg-green-800 rounded-full"})]}),e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-1.5 rounded-lg border-2 border-green-500/30 hover:border-green-500/50 transition-all duration-200 bg-transparent hover:bg-green-500/5",children:[e.jsx("span",{className:"text-xs font-semibold text-green-600 dark:text-green-400",children:s.filtered}),e.jsx("span",{className:"text-xs font-medium text-green-500 dark:text-green-400",children:"trades"})]})]}),mh=({currentTheme:t,currentLanguage:s,activeCategory:r,filters:l,filteredTradesCount:n,onFiltersChange:o})=>e.jsx("div",{className:"p-4 border-t theme-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{className:"flex items-center space-x-2 px-3 py-2 rounded-lg border transition-colors",style:{backgroundColor:t.colors.surface,color:t.colors.text,borderColor:t.colors.border},onClick:()=>{r==="market"?o({...l,symbol:[],strategy:[],side:[],status:[],trend:[],timeframe:[],tickEntry:[]}):r==="time"?o({...l,dateRange:{start:"",end:""},timeRange:{start:"",end:""},weekdays:[],months:[],hours:[],sessions:[]}):r==="performance"?o({...l,pnlRange:{min:void 0,max:void 0},pnlUnit:"euro",durationRange:{min:void 0,max:void 0},durationUnit:void 0,feesRange:{min:void 0,max:void 0},tradeResult:void 0}):r==="exposition"?o({...l,contractsRange:{min:void 0,max:void 0},lotsRange:{min:void 0,max:void 0},ticksRange:{min:void 0,max:void 0}}):r==="tags"&&o({...l,tags:[]})},title:s==="fr"?"RÃ©initialiser la catÃ©gorie":"Reset category",children:[e.jsx(be,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:r==="time"?s==="fr"?"Temps":"Time":r==="market"?s==="fr"?"MarchÃ©":"Market":r==="performance"?"Performance":r==="exposition"?s==="fr"?"Exposition":"Exposure":"Tags"})]}),e.jsxs("button",{className:"flex items-center space-x-2 px-3 py-2 rounded-lg border transition-colors",style:{backgroundColor:t.colors.surface,color:t.colors.text,borderColor:t.colors.border},onClick:()=>o({}),title:s==="fr"?"RÃ©initialiser tout":"Reset all",children:[e.jsx(be,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:s==="fr"?"Tout":"All"})]})]}),e.jsx(uh,{currentLanguage:s,filteredTradesCount:n})]})}),xh=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center h-full space-y-4",children:[e.jsx(ds,{size:24,className:"text-blue-600"}),e.jsx("div",{className:"w-2 h-2 bg-green-800 rounded-full"}),e.jsx(cs,{size:16,className:"theme-text-muted"})]}),fh=t=>{const s={"text-blue-600":{text:"text-blue-600",hover:"hover:text-blue-600",groupHover:"group-hover:text-blue-600"},"text-green-600":{text:"text-green-600",hover:"hover:text-green-600",groupHover:"group-hover:text-green-600"},"text-yellow-600":{text:"text-yellow-600",hover:"hover:text-yellow-600",groupHover:"group-hover:text-yellow-600"},"text-orange-600":{text:"text-orange-600",hover:"hover:text-orange-600",groupHover:"group-hover:text-orange-600"},"text-indigo-600":{text:"text-indigo-600",hover:"hover:text-indigo-600",groupHover:"group-hover:text-indigo-600"}};return t.includes("text-[#")?{text:t,hover:t,groupHover:t}:s[t]||{text:t,hover:`hover:${t}`,groupHover:`group-hover:text-${t.replace("text-","")}`}},rt=({title:t,icon:s,color:r,isCollapsed:l,onToggle:n,onReset:o,onToggleAll:a,areAllSubsectionsOpen:c,children:i})=>{const{currentLanguage:d}=X(),u=fh(r);return(()=>{if(r.includes("text-[#")){const p=r.match(/text-\[#([a-fA-F0-9]{6})\]/);if(p)return{color:`#${p[1]}`}}return{}})(),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:n,className:`flex items-center space-x-2 text-sm font-medium theme-text transition-colors ${r.includes("text-[#")?"":u.hover}`,onMouseEnter:p=>{if(r.includes("text-[#")){const x=r.match(/text-\[#([a-fA-F0-9]{6})\]/);x&&(p.currentTarget.style.color=`#${x[1]}`)}},onMouseLeave:p=>{r.includes("text-[#")&&(p.currentTarget.style.color="")},children:[l?e.jsx(Le,{size:16}):e.jsx(mt,{size:16}),s,e.jsx("span",{children:t})]}),a&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:"absolute top-0 left-0 white-chevron",children:e.jsx("button",{onClick:a,className:"p-1 rounded",title:d==="fr"?"DÃ©plier/Replier toutes les sous-catÃ©gories":"Expand/Collapse all sub-categories",children:c?e.jsx("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJtMTcgMTEtNS01LTUgNSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48cGF0aCBkPSJtMTcgMTgtNS01LTUgNSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",width:"14",height:"14",alt:"Chevrons Up"}):e.jsx("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJtNyAxMyA1IDUgNS01IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjxwYXRoIGQ9Im03IDYgNSA1IDUtNSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",width:"14",height:"14",alt:"Chevrons Down"})})}),e.jsx("div",{className:"colored-chevron opacity-0",children:e.jsx("button",{onClick:a,className:"p-1 rounded",title:d==="fr"?"DÃ©plier/Replier toutes les sous-catÃ©gories":"Expand/Collapse all sub-categories",children:c?e.jsx("img",{src:`data:image/svg+xml;base64,${btoa(`<svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="m17 11-5-5-5 5" stroke="${r==="text-blue-600"?"#2563eb":r==="text-green-600"?"#16a34a":r==="text-yellow-600"?"#ca8a04":r==="text-orange-600"?"#ea580c":r==="text-purple-600"?"#9333ea":"#2563eb"}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="m17 18-5-5-5 5" stroke="${r==="text-blue-600"?"#2563eb":r==="text-green-600"?"#16a34a":r==="text-yellow-600"?"#ca8a04":r==="text-orange-600"?"#ea580c":r==="text-purple-600"?"#9333ea":"#2563eb"}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`)}`,width:"14",height:"14",alt:"Chevrons Up"}):e.jsx("img",{src:`data:image/svg+xml;base64,${btoa(`<svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="m7 13 5 5 5-5" stroke="${r==="text-blue-600"?"#2563eb":r==="text-green-600"?"#16a34a":r==="text-yellow-600"?"#ca8a04":r==="text-orange-600"?"#ea580c":r==="text-purple-600"?"#9333ea":"#2563eb"}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="m7 6 5 5 5-5" stroke="${r==="text-blue-600"?"#2563eb":r==="text-green-600"?"#16a34a":r==="text-yellow-600"?"#ca8a04":r==="text-orange-600"?"#ea580c":r==="text-purple-600"?"#9333ea":"#2563eb"}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`)}`,width:"14",height:"14",alt:"Chevrons Down"})})}),e.jsx("style",{children:`
                .white-chevron {
                  z-index: 1;
                  transition: opacity 0.2s;
                }
                .colored-chevron {
                  z-index: 2;
                  transition: opacity 0.2s;
                }
                .relative:hover .white-chevron {
                  opacity: 0;
                }
                .relative:hover .colored-chevron {
                  opacity: 1;
                }
              `})]})]}),e.jsx("button",{onClick:o,className:`text-xs transition-colors ${r.includes("text-[#")?"":u.text}`,style:r.includes("text-[#")?{color:r.replace("text-[","").replace("]","")}:{},onMouseEnter:p=>{if(r.includes("text-[#")){const x=r.match(/text-\[#([a-fA-F0-9]{6})\]/);x&&(p.currentTarget.style.color=`#${x[1]}`,p.currentTarget.style.opacity="0.8")}},onMouseLeave:p=>{if(r.includes("text-[#")){const x=r.match(/text-\[#([a-fA-F0-9]{6})\]/);x&&(p.currentTarget.style.color=`#${x[1]}`,p.currentTarget.style.opacity="")}},children:d==="fr"?"RÃ©initialiser":"Reset"})]}),!l&&e.jsx("div",{className:"pl-6",children:i})]})},ph=({value:t,onChange:s,collapsedSections:r,toggleSection:l,onToggleAllTimeSections:n})=>{const{currentLanguage:o}=X(),{currentTheme:a}=ee(),c={time:{light:"text-[#2563eb]",dark:"text-[#2563eb]","ultra-dark":"text-[#3b82f6]"},performance:{light:"text-[#16a34a]",dark:"text-[#16a34a]","ultra-dark":"text-[#22c55e]"}},i=p=>{const x=a.id,f=c[p];return f&&f[x]||Object.values(f||{})[0]||"text-blue-600"},d=[{id:"january",label:{fr:"Janvier",en:"January"}},{id:"february",label:{fr:"FÃ©vrier",en:"February"}},{id:"march",label:{fr:"Mars",en:"March"}},{id:"april",label:{fr:"Avril",en:"April"}},{id:"may",label:{fr:"Mai",en:"May"}},{id:"june",label:{fr:"Juin",en:"June"}},{id:"july",label:{fr:"Juillet",en:"July"}},{id:"august",label:{fr:"AoÃ»t",en:"August"}},{id:"september",label:{fr:"Septembre",en:"September"}},{id:"october",label:{fr:"Octobre",en:"October"}},{id:"november",label:{fr:"Novembre",en:"November"}},{id:"december",label:{fr:"DÃ©cembre",en:"December"}}],u=[{id:"monday",label:{fr:"Lun",en:"Mon"}},{id:"tuesday",label:{fr:"Mar",en:"Tue"}},{id:"wednesday",label:{fr:"Mer",en:"Wed"}},{id:"thursday",label:{fr:"Jeu",en:"Thu"}},{id:"friday",label:{fr:"Ven",en:"Fri"}},{id:"saturday",label:{fr:"Sam",en:"Sat"}},{id:"sunday",label:{fr:"Dim",en:"Sun"}}],m=[{id:"asia",label:{fr:"Session Asie",en:"Asia Session"},color:"bg-purple-800/5",timeRange:{fr:"0h-8h UTC",en:"0h-8h UTC"}},{id:"eu",label:{fr:"Session EU",en:"EU Session"},color:"bg-blue-800/5",timeRange:{fr:"8h-14h UTC",en:"8h-14h UTC"}},{id:"overlap",label:{fr:"Overlap EU-US",en:"EU-US Overlap"},color:"bg-orange-700/5",timeRange:{fr:"14h-16h UTC",en:"14h-16h UTC"}},{id:"us",label:{fr:"Session US",en:"US Session"},color:"bg-green-800/5",timeRange:{fr:"14h-21h UTC",en:"21h-24h UTC"}},{id:"close",label:{fr:"ClÃ´ture US",en:"US Close"},color:"bg-red-700/5",timeRange:{fr:"21h-24h UTC",en:"21h-24h UTC"}}];return e.jsxs("div",{className:"space-y-6",style:{maxHeight:"calc(100vh - 350px)",overflowY:"auto"},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h3",{className:"text-lg font-semibold theme-text flex items-center",children:[e.jsx(bt,{size:20,className:`mr-2 ${i("time")}`}),o==="fr"?"Filtres Temporels":"Time Filters"]}),e.jsx("button",{onClick:n,className:"p-1.5 rounded-lg hover:theme-surface transition-colors group",title:o==="fr"?"DÃ©plier/Replier toutes les sous-catÃ©gories":"Expand/Collapse all sub-categories",children:(()=>{const x=["dateRange","timeRange","weekdays","months","hours","hoursMain","hoursTimeRange","sessions"].every(h=>!r[h]),f=i("time"),g=f==="text-blue-600"?"#2563eb":f==="text-green-600"?"#16a34a":f==="text-yellow-600"?"#ca8a04":f==="text-orange-600"?"#ea580c":f==="text-purple-600"?"#9333ea":"#2563eb";return x?e.jsx(ir,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:h=>{h.currentTarget.style.color=g},onMouseOut:h=>{h.currentTarget.style.color="white"}}):e.jsx(ar,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:h=>{h.currentTarget.style.color=g},onMouseOut:h=>{h.currentTarget.style.color="white"}})})()})]}),e.jsx("p",{className:"text-sm theme-text-muted mb-4",children:o==="fr"?"Filtres par date, heure, jour de la semaine et mois":"Filters by date, time, weekday and month"}),e.jsxs(rt,{title:o==="fr"?"Plages de Dates":"Date Ranges",icon:e.jsx(bt,{size:16,className:`${i("time")}`}),color:i("time"),isCollapsed:r.dateRange,onToggle:()=>l("dateRange"),onReset:()=>s({dateRange:{start:"",end:""}}),children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-medium theme-text-muted mb-2",children:o==="fr"?"Presets rapides":"Quick presets"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"7d",label:"7j",days:7},{key:"30d",label:"30j",days:30},{key:"3m",label:"3m",days:90},{key:"6m",label:"6m",days:180},{key:"1a",label:"1a",days:365}].map(p=>{const x=(()=>{if(!t.dateRange?.start||!t.dateRange?.end)return!1;const f=new Date,g=new Date;g.setDate(f.getDate()-p.days);const h=new Date(t.dateRange.start),y=new Date(t.dateRange.end);return h.toDateString()===g.toDateString()&&y.toDateString()===f.toDateString()})();return e.jsx("button",{onClick:()=>{const f=new Date,g=new Date;g.setDate(f.getDate()-p.days),s({dateRange:{start:g.toISOString().split("T")[0],end:f.toISOString().split("T")[0]}})},className:`px-3 py-2 text-xs font-medium rounded-lg transition-all ${x?"bg-blue-800 theme-text shadow-md":"hover:theme-surface theme-text border theme-border"}`,children:p.label},p.key)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium theme-text-muted mb-2",children:o==="fr"?"DÃ©but":"Start"}),e.jsx(gs,{id:"date-start-input",value:t.dateRange?.start||"",onChange:p=>{console.log("ðŸ—“ï¸ TimeSection onChange received:",p),s({dateRange:{start:p,end:t.dateRange?.end||""}})},placeholder:o==="fr"?"jj/mm/aaaa":"mm/dd/yyyy",size:"compact",className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text,fontSize:"14px",paddingLeft:"12px",paddingRight:"80px"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium theme-text-muted mb-2",children:o==="fr"?"Fin":"End"}),e.jsx(gs,{id:"date-end-input",value:t.dateRange?.end||"",onChange:p=>s({dateRange:{start:t.dateRange?.start||"",end:p}}),placeholder:o==="fr"?"jj/mm/aaaa":"mm/dd/yyyy",size:"compact",className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text,fontSize:"14px",paddingLeft:"12px",paddingRight:"80px"}})]})]})]}),e.jsx(rt,{title:o==="fr"?"Mois":"Months",icon:e.jsx(bt,{size:16,className:`${i("time")}`}),color:i("time"),isCollapsed:r.months,onToggle:()=>l("months"),onReset:()=>s({months:[]}),children:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[0,1,2].map(p=>e.jsx("div",{className:"flex flex-col gap-2",children:[0,1,2,3].map(x=>{const f=p*4+x,g=d[f];return e.jsx("button",{onClick:()=>{const h=t.months||[],y=h.includes(g.id)?h.filter(j=>j!==g.id):[...h,g.id];s({months:y})},className:`p-2 text-xs font-medium rounded-lg transition-all ${(t.months||[]).includes(g.id)?"bg-blue-800 theme-text shadow-md":"hover:theme-surface theme-text"}`,children:g.label[o]},g.id)})},p))})}),e.jsx(rt,{title:o==="fr"?"Jours de la Semaine":"Weekdays",icon:e.jsx(bt,{size:16,className:`${i("time")}`}),color:i("time"),isCollapsed:r.weekdays,onToggle:()=>l("weekdays"),onReset:()=>s({weekdays:[]}),children:e.jsx("div",{className:"grid grid-cols-7 gap-2",children:u.map(p=>e.jsx("button",{onClick:()=>{const x=t.weekdays||[],f=x.includes(p.id)?x.filter(g=>g!==p.id):[...x,p.id];s({weekdays:f})},className:`p-2 text-xs font-medium rounded-lg transition-all ${(t.weekdays||[]).includes(p.id)?"bg-blue-800 theme-text shadow-md":"hover:theme-surface theme-text"}`,children:p.label[o]},p.id))})}),e.jsxs(rt,{title:o==="fr"?"Heures":"Hours",icon:e.jsx($e,{size:16,className:`${i("time")}`}),color:i("time"),isCollapsed:r.hoursMain,onToggle:()=>l("hoursMain"),onReset:()=>{s({timeRange:{start:"",end:""},hours:[]})},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>l("hoursTimeRange"),className:"flex items-center space-x-2 text-sm font-medium theme-text hover:text-green-600 transition-colors",children:[r.hoursTimeRange?e.jsx(Le,{size:16,className:"text-green-500"}):e.jsx(mt,{size:16,className:"text-green-500"}),e.jsx($e,{size:16,className:`${i("performance")}`}),e.jsx("span",{children:o==="fr"?"Plage Horaire":"Time Range"})]}),e.jsx("button",{onClick:()=>s({timeRange:{start:"",end:""}}),className:"text-xs text-green-500 hover:text-green-600 transition-colors",children:o==="fr"?"RÃ©initialiser":"Reset"})]}),!r.hoursTimeRange&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 pl-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium theme-text-muted mb-2",children:o==="fr"?"DÃ©but":"Start"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"time-start-input",type:"time",value:t.timeRange?.start||"",onChange:p=>s({timeRange:{start:p.target.value,end:t.timeRange?.end||""}}),className:"w-full pr-12 pl-4 py-3 text-base border rounded-lg focus:outline-none transition-all cursor-pointer theme-border ring-performance",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text}}),e.jsxs("button",{type:"button",onClick:()=>{const p=document.getElementById("time-start-input");p&&p.showPicker()},className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center space-x-1 p-1 rounded-md hover:theme-surface transition-colors cursor-pointer",children:[e.jsx($e,{size:18,className:`${i("performance")}`}),e.jsx(Le,{size:14,className:"text-green-400"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium theme-text-muted mb-2",children:o==="fr"?"Fin":"End"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"time-end-input",type:"time",value:t.timeRange?.end||"",onChange:p=>s({timeRange:{start:t.timeRange?.start||"",end:p.target.value}}),className:"w-full pr-12 pl-4 py-3 text-base border rounded-lg focus:outline-none transition-all cursor-pointer theme-border ring-performance",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text}}),e.jsxs("button",{type:"button",onClick:()=>{const p=document.getElementById("time-end-input");p&&p.showPicker()},className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center space-x-1 p-1 rounded-md hover:theme-surface transition-colors cursor-pointer",children:[e.jsx($e,{size:18,className:`${i("performance")}`}),e.jsx(Le,{size:14,className:"text-green-400"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>l("hoursMain"),className:"flex items-center space-x-2 text-sm font-medium theme-text hover:text-orange-600 transition-colors",children:[r.hoursMain?e.jsx(Le,{size:16,className:"text-orange-500"}):e.jsx(mt,{size:16,className:"text-orange-500"}),e.jsx($e,{size:16,className:"text-orange-500"}),e.jsx("span",{children:o==="fr"?"Heures (Alternative Rapide)":"Hours (Quick Alternative)"})]}),e.jsx("button",{onClick:()=>s({hours:[]}),className:"text-xs text-orange-500 hover:text-orange-600 transition-colors",children:o==="fr"?"RÃ©initialiser":"Reset"})]}),!r.hoursMain&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-medium theme-text-muted mb-2 flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full mr-2"}),o==="fr"?"Matin":"Morning"]}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:Array.from({length:12},(p,x)=>e.jsxs("button",{onClick:()=>{const f=t.hours||[],g=f.includes(x)?f.filter(h=>h!==x):[...f,x];s({hours:g})},className:`p-2 text-xs font-medium rounded-lg transition-all ${(t.hours||[]).includes(x)?"bg-blue-800 theme-text shadow-md":"hover:theme-surface theme-text border theme-border"}`,children:[x,":00"]},x))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-medium theme-text-muted mb-2 flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-400 rounded-full mr-2"}),o==="fr"?"AprÃ¨s-midi":"Afternoon"]}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:Array.from({length:12},(p,x)=>{const f=x+12;return e.jsxs("button",{onClick:()=>{const g=t.hours||[],h=g.includes(f)?g.filter(y=>y!==f):[...g,f];s({hours:h})},className:`p-2 text-xs font-medium rounded-lg transition-all ${(t.hours||[]).includes(f)?"bg-orange-700/70 theme-text shadow-md":"hover:theme-surface theme-text border theme-border"}`,children:[f,":00"]},f)})})]})]})})]})]}),e.jsx(rt,{title:o==="fr"?"Sessions de Trading":"Trading Sessions",icon:e.jsx($e,{size:16,className:`${i("time")}`}),color:i("time"),isCollapsed:r.sessions,onToggle:()=>l("sessions"),onReset:()=>s({sessions:[]}),children:e.jsx("div",{className:"grid grid-cols-5 gap-2",children:m.map(p=>e.jsx("button",{onClick:()=>{const x=t.sessions||[],f=x.includes(p.id)?x.filter(g=>g!==p.id):[...x,p.id];s({sessions:f})},className:`p-3 rounded-lg transition-all duration-200 text-center transform hover:scale-105 ${(t.sessions||[]).includes(p.id)?`${p.color} theme-text shadow-lg`:"hover:theme-surface theme-text"}`,style:(()=>{if((t.sessions||[]).includes(p.id))switch(p.id){case"asia":return{borderTop:"2px solid #9333ea",borderBottom:"2px solid #9333ea"};case"eu":return{borderTop:"2px solid #2563eb",borderBottom:"2px solid #2563eb"};case"overlap":return{borderTop:"2px solid #ea580c",borderBottom:"2px solid #ea580c"};case"us":return{borderTop:"2px solid #16a34a",borderBottom:"2px solid #16a34a"};case"close":return{borderTop:"2px solid #dc2626",borderBottom:"2px solid #dc2626"};default:return{}}return{}})(),children:e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${(t.sessions||[]).includes(p.id)?"theme-surface":p.color}`}),e.jsx("div",{className:"text-xs font-medium",children:p.label[o]}),e.jsx("div",{className:"text-[10px] theme-text-muted",children:p.timeRange[o]})]})},p.id))})})]})},hh=O.memo(ph),So=({minValue:t,maxValue:s,onMinChange:r,onMaxChange:l,minPlaceholder:n,maxPlaceholder:o,minLabel:a,maxLabel:c,step:i="0.01"})=>{const{currentTheme:d}=ee(),u=m=>{if(m==null)return;const p=String(m);if(p==="")return;let x=p.replace(",",".");x.endsWith(".")&&(x+="0");const f=parseFloat(x);return Number.isNaN(f)?void 0:f};return e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 theme-text-muted",children:a}),e.jsx("input",{type:"number",step:i,placeholder:n,value:t!==void 0?t:"",onChange:m=>r(u(m.target.value)),className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none transition-all ring-performance",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.text}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 theme-text-muted",children:c}),e.jsx("input",{type:"number",step:i,placeholder:o,value:s!==void 0?s:"",onChange:m=>l(u(m.target.value)),className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none transition-all ring-performance",style:{backgroundColor:d.colors.surface,borderColor:d.colors.border,color:d.colors.text}})]})]})},gh=({value:t,onChange:s,collapsedSections:r,toggleSection:l,onToggleAllPerformanceSections:n})=>{const{currentLanguage:o}=X(),{currentTheme:a}=ee(),c={performance:{light:"text-[#16a34a]",dark:"text-[#16a34a]","ultra-dark":"text-[#22c55e]"}},i=u=>{const m=a.id,p=c[u];return p&&p[m]||Object.values(p||{})[0]||"text-green-600"},d=[{id:"seconds",label:{fr:"Secondes",en:"Seconds"}},{id:"minutes",label:{fr:"Minutes",en:"Minutes"}},{id:"hours",label:{fr:"Heures",en:"Hours"}},{id:"days",label:{fr:"Jours",en:"Days"}}];return e.jsxs("div",{className:"space-y-6",style:{maxHeight:"calc(100vh - 350px)",overflowY:"auto"},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h3",{className:"text-lg font-semibold theme-text flex items-center",children:[e.jsx(Ee,{size:20,className:`mr-2 ${i("performance")}`}),o==="fr"?"Filtres de Performance":"Performance Filters"]}),e.jsx("button",{onClick:n,className:"p-1.5 rounded-lg hover:theme-surface transition-colors group",title:o==="fr"?"DÃ©plier/Replier toutes les sous-catÃ©gories":"Expand/Collapse all sub-categories",children:(()=>{const m=["pnl","duration","tradeResult","fees"].every(f=>!r[f]),p=i("performance"),x=p==="text-[#16a34a]"?"#16a34a":p==="text-[#22c55e]"?"#22c55e":"#16a34a";return m?e.jsx(ir,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:f=>{f.currentTarget.style.color=x},onMouseOut:f=>{f.currentTarget.style.color="white"}}):e.jsx(ar,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:f=>{f.currentTarget.style.color=x},onMouseOut:f=>{f.currentTarget.style.color="white"}})})()})]}),e.jsx("p",{className:"text-sm theme-text-muted mb-4",children:o==="fr"?"Filtres par P&L, durÃ©e, rÃ©sultat du trade et frais":"Filters by P&L, duration, trade result and fees"}),e.jsx(rt,{title:o==="fr"?"Gains & Pertes":"Profit & Loss",icon:e.jsx(Ee,{size:16,className:`${i("performance")}`}),color:i("performance"),isCollapsed:r.pnl,onToggle:()=>l("pnl"),onReset:()=>s({pnlRange:void 0}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("button",{onClick:()=>s({pnlUnit:"euro",pnlRange:void 0}),className:`px-3 py-1.5 text-xs font-medium rounded-lg transition-all ${(t.pnlUnit||"euro")==="euro"?"bg-green-800 theme-text shadow-md border border-green-700":"theme-surface theme-text-muted border theme-border hover:theme-surface"}`,children:"â‚¬ Euro"}),e.jsx("button",{onClick:()=>s({pnlUnit:"percent",pnlRange:void 0}),className:`px-3 py-1.5 text-xs font-medium rounded-lg transition-all ${(t.pnlUnit||"euro")==="percent"?"bg-green-800 theme-text shadow-md border border-green-700":"theme-surface theme-text-muted border theme-border hover:theme-surface"}`,children:"% Pourcentage"})]}),e.jsx(So,{minValue:t.pnlRange?.min,maxValue:t.pnlRange?.max,onMinChange:u=>s({pnlRange:{min:u,max:t.pnlRange?.max}}),onMaxChange:u=>s({pnlRange:{min:t.pnlRange?.min,max:u}}),minPlaceholder:o==="fr"?`Entrez la valeur min ${t.pnlUnit==="percent"?"%":"â‚¬"}...`:`Enter min value ${t.pnlUnit==="percent"?"%":"â‚¬"}...`,maxPlaceholder:o==="fr"?`Entrez la valeur max ${t.pnlUnit==="percent"?"%":"â‚¬"}...`:`Enter max value ${t.pnlUnit==="percent"?"%":"â‚¬"}...`,minLabel:"Min",maxLabel:"Max",step:"0.01"})]})}),e.jsx(rt,{title:o==="fr"?"RÃ©sultat du Trade":"Trade Result",icon:e.jsx(ui,{size:16,className:`${i("performance")}`}),color:i("performance"),isCollapsed:r.tradeResult,onToggle:()=>l("tradeResult"),onReset:()=>s({tradeResult:void 0}),children:e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium mb-2 theme-text-muted",children:o==="fr"?"Type de sortie":"Exit Type"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("button",{onClick:()=>s({tradeResult:{takeProfit:!t.tradeResult?.takeProfit,stopLoss:t.tradeResult?.stopLoss||!1,breakEven:t.tradeResult?.breakEven||!1}}),className:`p-2 text-xs font-medium rounded-lg transition-all ${t.tradeResult?.takeProfit?"bg-green-800 theme-text shadow-md":"hover:theme-surface theme-text border theme-border"}`,children:"TP"}),e.jsx("button",{onClick:()=>s({tradeResult:{takeProfit:t.tradeResult?.takeProfit||!1,stopLoss:!t.tradeResult?.stopLoss,breakEven:t.tradeResult?.breakEven||!1}}),className:`p-2 text-xs font-medium rounded-lg transition-all ${t.tradeResult?.stopLoss?"bg-red-700/70 theme-text shadow-md":"hover:theme-surface theme-text border theme-border"}`,children:"SL"}),e.jsx("button",{onClick:()=>s({tradeResult:{takeProfit:t.tradeResult?.takeProfit||!1,stopLoss:t.tradeResult?.stopLoss||!1,breakEven:!t.tradeResult?.breakEven}}),className:`p-2 text-xs font-medium rounded-lg transition-all ${t.tradeResult?.breakEven?"bg-yellow-500/65 theme-text shadow-md":"hover:theme-surface theme-text border theme-border"}`,children:"BE"})]})]})})}),e.jsx(rt,{title:o==="fr"?"Frais":"Fees",icon:e.jsx(Ke,{size:16,className:`${i("performance")}`}),color:i("performance"),isCollapsed:r.fees,onToggle:()=>l("fees"),onReset:()=>s({feesRange:void 0}),children:e.jsx("div",{className:"space-y-4",children:e.jsx(So,{minValue:t.feesRange?.min,maxValue:t.feesRange?.max,onMinChange:u=>s({feesRange:{min:u,max:t.feesRange?.max}}),onMaxChange:u=>s({feesRange:{min:t.feesRange?.min,max:u}}),minPlaceholder:o==="fr"?"Entrez les frais min...":"Enter min fees...",maxPlaceholder:o==="fr"?"Entrez les frais max...":"Enter max fees...",minLabel:"Min",maxLabel:"Max",step:"0.01"})})}),e.jsx(rt,{title:o==="fr"?"DurÃ©e des Trades":"Trade Duration",icon:e.jsx($e,{size:16,className:`${i("performance")}`}),color:i("performance"),isCollapsed:r.duration,onToggle:()=>l("duration"),onReset:()=>s({durationRange:void 0,durationUnit:void 0}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-2 theme-text-muted",children:o==="fr"?"UnitÃ© de temps":"Time Unit"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:d.map(u=>e.jsx("button",{onClick:()=>s({durationUnit:u.id,durationRange:void 0}),className:`px-3 py-1.5 text-xs font-medium rounded-lg transition-all ${t.durationUnit===u.id?"bg-green-800 theme-text shadow-md":"hover:theme-surface theme-text border theme-border"}`,children:u.label[o]},u.id))})]}),t.durationUnit&&(()=>{const u=t.durationUnit,m=Ua[u],{isValid:p,errors:x}=Bp(t.durationRange?.min,t.durationRange?.max,u);return e.jsxs("div",{className:"space-y-2",children:[e.jsx(So,{minValue:t.durationRange?.min,maxValue:t.durationRange?.max,onMinChange:f=>s({durationRange:{min:f,max:t.durationRange?.max}}),onMaxChange:f=>s({durationRange:{min:t.durationRange?.min,max:f}}),minPlaceholder:o==="fr"?`Min (${m.min}â€“${m.max})`:`Min (${m.min}â€“${m.max})`,maxPlaceholder:o==="fr"?`Max (${m.min}â€“${m.max})`:`Max (${m.min}â€“${m.max})`,minLabel:"Min",maxLabel:"Max",step:u==="seconds"?"1":"0.01"}),!p&&e.jsx("div",{className:"text-xs text-red-400",children:x.map((f,g)=>e.jsx("div",{children:f},g))})]})})()]})})]})},yh=O.memo(gh),bh=({value:t,onChange:s,collapsedSections:r,toggleSection:l,onToggleAllExpositionSections:n})=>{const{currentLanguage:o}=X(),{currentTheme:a}=ee(),c={exposition:{light:"text-[#ca8a04]",dark:"text-[#ca8a04]","ultra-dark":"text-[#eab308]"}},i=d=>{const u=a.id,m=c[d];return m&&m[u]||Object.values(m||{})[0]||"text-yellow-600"};return e.jsxs("div",{className:"space-y-6",style:{maxHeight:"calc(100vh - 350px)",overflowY:"auto"},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h3",{className:"text-lg font-semibold theme-text flex items-center",children:[e.jsx(Tt,{size:20,className:`mr-2 ${i("exposition")}`}),o==="fr"?"Filtres d'Exposition":"Exposure Filters"]}),e.jsx("button",{onClick:n,className:"p-1.5 rounded-lg hover:theme-surface transition-colors group",title:o==="fr"?"DÃ©plier/Replier toutes les sous-catÃ©gories":"Expand/Collapse all sub-categories",children:(()=>{const u=["contracts","lots","ticks"].every(x=>!r[x]),m=i("exposition"),p=m==="text-[#ca8a04]"?"#ca8a04":m==="text-[#eab308]"?"#eab308":"#ca8a04";return u?e.jsx(ir,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:x=>{x.currentTarget.style.color=p},onMouseOut:x=>{x.currentTarget.style.color="white"}}):e.jsx(ar,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:x=>{x.currentTarget.style.color=p},onMouseOut:x=>{x.currentTarget.style.color="white"}})})()})]}),e.jsx("p",{className:"text-sm theme-text-muted mb-4",children:o==="fr"?"Filtres par contrats, lots, ticks et valeur du tick":"Filters by contracts, lots, ticks and tick value"}),e.jsx(rt,{title:o==="fr"?"Contrats EngagÃ©s":"Contracts Engaged",icon:e.jsx(Tt,{size:16,className:`${i("exposition")}`}),color:i("exposition"),isCollapsed:r.contracts,onToggle:()=>l("contracts"),onReset:()=>s({contractsRange:void 0}),children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 theme-text-muted",children:"Min"}),e.jsx("input",{type:"number",step:"1",placeholder:"Entrez la valeur min...",value:t.contractsRange?.min!==void 0&&t.contractsRange?.min!==null?t.contractsRange.min:"",onChange:d=>s({contractsRange:{min:d.target.value?parseInt(d.target.value):void 0,max:t.contractsRange?.max??void 0}}),className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none transition-all theme-border ring-exposition",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 theme-text-muted",children:"Max"}),e.jsx("input",{type:"number",step:"1",placeholder:"Entrez la valeur max...",value:t.contractsRange?.max!==void 0&&t.contractsRange?.max!==null?t.contractsRange.max:"",onChange:d=>s({contractsRange:{min:t.contractsRange?.min??void 0,max:d.target.value?parseInt(d.target.value):void 0}}),className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none transition-all theme-border ring-exposition",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text}})]})]})}),e.jsx(rt,{title:"Lots",icon:e.jsx(Tt,{size:16,className:`${i("exposition")}`}),color:i("exposition"),isCollapsed:r.lots,onToggle:()=>l("lots"),onReset:()=>s({lotsRange:void 0}),children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 theme-text-muted",children:"Min"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Entrez la valeur min...",value:t.lotsRange?.min!==void 0&&t.lotsRange?.min!==null?t.lotsRange.min:"",onChange:d=>s({lotsRange:{min:d.target.value?parseFloat(d.target.value):void 0,max:t.lotsRange?.max??void 0}}),className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none transition-all theme-border ring-exposition",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 theme-text-muted",children:"Max"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Entrez la valeur max...",value:t.lotsRange?.max!==void 0&&t.lotsRange?.max!==null?t.lotsRange.max:"",onChange:d=>s({lotsRange:{min:t.lotsRange?.min??void 0,max:d.target.value?parseFloat(d.target.value):void 0}}),className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none transition-all theme-border ring-exposition",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text}})]})]})}),e.jsx(rt,{title:"Ticks",icon:e.jsx(Tt,{size:16,className:`${i("exposition")}`}),color:i("exposition"),isCollapsed:r.ticks,onToggle:()=>l("ticks"),onReset:()=>s({ticksRange:void 0}),children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 theme-text-muted",children:"Min"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Entrez la valeur min...",value:t.ticksRange?.min!==void 0&&t.ticksRange?.min!==null?t.ticksRange.min:"",onChange:d=>s({ticksRange:{min:d.target.value?parseFloat(d.target.value):void 0,max:t.ticksRange?.max??void 0}}),className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none transition-all theme-border ring-exposition",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 theme-text-muted",children:"Max"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Entrez la valeur max...",value:t.ticksRange?.max!==void 0&&t.ticksRange?.max!==null?t.ticksRange.max:"",onChange:d=>s({ticksRange:{min:t.ticksRange?.min??void 0,max:d.target.value?parseFloat(d.target.value):void 0}}),className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none transition-all theme-border ring-exposition",style:{backgroundColor:a.colors.surface,borderColor:a.colors.border,color:a.colors.text}})]})]})})]})},vh=O.memo(bh),jh=[{id:"bullish",label:{fr:"HaussiÃ¨re",en:"Bullish"},color:"bg-green-800"},{id:"bearish",label:{fr:"BaissiÃ¨re",en:"Bearish"},color:"bg-red-700/70"},{id:"sideways",label:{fr:"LatÃ©rale",en:"Sideways"},color:"bg-yellow-600"}],Nh=[{id:"long",label:{fr:"Long",en:"Long"},color:"bg-green-800"},{id:"short",label:{fr:"Short",en:"Short"},color:"bg-red-700/70"}],kh=[{id:"open",label:{fr:"Ouvert",en:"Open"},color:"bg-green-800"},{id:"closed",label:{fr:"FermÃ©",en:"Closed"},color:"bg-red-700/70"}],wh=[{id:"10ticks",label:{fr:"10ticks",en:"10ticks"},color:"bg-purple-600"},{id:"25ticks",label:{fr:"25ticks",en:"25ticks"},color:"bg-purple-600"},{id:"50ticks",label:{fr:"50ticks",en:"50ticks"},color:"bg-blue-600"},{id:"100ticks",label:{fr:"100ticks",en:"100ticks"},color:"bg-blue-600"},{id:"200ticks",label:{fr:"200ticks",en:"200ticks"},color:"bg-green-600"},{id:"500ticks",label:{fr:"500ticks",en:"500ticks"},color:"bg-green-600"},{id:"1000ticks",label:{fr:"1000ticks",en:"1000ticks"},color:"bg-orange-600"},{id:"2000ticks",label:{fr:"2000ticks",en:"2000ticks"},color:"bg-orange-600"}],sl={forex:"bg-blue-800",futures:"bg-green-800",stocks:"bg-purple-800",crypto:"bg-pink-700",indices:"bg-indigo-700",commodities:"bg-orange-700/70"},Sh={forex:{fr:"Forex",en:"Forex"},futures:{fr:"Futures",en:"Futures"},stocks:{fr:"Actions",en:"Stocks"},crypto:{fr:"Crypto",en:"Crypto"},indices:{fr:"Indices",en:"Indices"},commodities:{fr:"MatiÃ¨res PremiÃ¨res",en:"Commodities"}},Ch=({value:t,onChange:s,availableTrades:r,availableStrategies:l,availableTimeframes:n,availableTickEntries:o,collapsedSections:a,collapsedMarkets:c,toggleSection:i,toggleMarket:d,onToggleAllMarketSections:u})=>{const{currentLanguage:m}=X(),{currentTheme:p}=ee(),x=()=>p.id==="ultra-dark"?"text-[#f97316]":"text-[#ea580c]",f=b.useMemo(()=>{const g={};return r.forEach(h=>{const y=h.market;g[y]=g[y]||[],h.symbol&&!g[y].includes(h.symbol)&&g[y].push(h.symbol)}),Object.keys(g).forEach(h=>{g[h]=g[h].sort((y,j)=>y.localeCompare(j))}),g},[r]);return e.jsxs("div",{className:"space-y-6",style:{maxHeight:"calc(100vh - 350px)",overflowY:"auto"},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h3",{className:"text-lg font-semibold theme-text flex items-center",children:[e.jsx(He,{size:20,className:`mr-2 ${x()}`}),m==="fr"?"Filtres de MarchÃ© & Trading":"Market & Trading Filters"]}),e.jsx("button",{onClick:u,className:"p-1.5 rounded-lg hover:theme-surface transition-colors group",title:m==="fr"?"DÃ©plier/Replier toutes les sous-catÃ©gories":"Expand/Collapse all sub-categories",children:(()=>{const h=["marketType","symbols","strategies","direction","status","trend"].every(v=>!a[v]),j=x()==="text-[#ea580c]"?"#ea580c":"#f97316";return h?e.jsx(ir,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:v=>{v.currentTarget.style.color=j},onMouseOut:v=>{v.currentTarget.style.color="white"}}):e.jsx(ar,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:v=>{v.currentTarget.style.color=j},onMouseOut:v=>{v.currentTarget.style.color="white"}})})()})]}),e.jsx("p",{className:"text-sm theme-text-muted mb-4",children:m==="fr"?"Filtres par type de marchÃ©, symboles, stratÃ©gies, tendance, direction, statut et timeframe":"Filters by market type, symbols, strategies, trend, direction, status and timeframe"}),e.jsx(rt,{title:m==="fr"?"Types de MarchÃ© & Symboles":"Market Types & Symbols",icon:e.jsx(He,{size:16,className:`${x()}`}),color:x(),isCollapsed:a.marketType,onToggle:()=>i("marketType"),onReset:()=>s({symbols:[]}),children:e.jsx("div",{className:"space-y-4",children:["forex","indices","futures","crypto","stocks","commodities"].map(g=>{const h=f[g]||[];return h.length===0?null:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("button",{onClick:()=>d(g),className:"flex items-center space-x-2 hover:opacity-80 transition-opacity",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${sl[g]}`}),e.jsx("h4",{className:"text-sm font-medium theme-text capitalize",children:Sh[g]?.[m]||g.charAt(0).toUpperCase()+g.slice(1)}),e.jsxs("span",{className:"text-xs theme-text-muted",children:["(",h.length,")"]}),c[g]?e.jsx(Le,{size:14}):e.jsx(mt,{size:14})]})}),!c[g]&&e.jsx("div",{className:"grid grid-cols-3 gap-2 pl-4",children:h.map(y=>e.jsx("button",{onClick:()=>{const j=Array.isArray(t.symbols)||t.symbols?t.symbols:[],v=j.includes(y)?j.filter(N=>N!==y):[...j,y];s({symbols:v})},className:`p-2 text-xs font-medium rounded-lg transition-all ${Array.isArray(t.symbols)&&t.symbols.includes(y)?`${sl[g]} theme-text shadow-md`:"hover:theme-surface theme-text"}`,children:y},y))})]},g)})})}),e.jsx(rt,{title:m==="fr"?"StratÃ©gies":"Strategies",icon:e.jsx(Ee,{size:16,className:`${x()}`}),color:x(),isCollapsed:a.strategies,onToggle:()=>i("strategies"),onReset:()=>s({strategy:[]}),children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:l.map(g=>e.jsx("button",{onClick:()=>{const h=Array.isArray(t.strategy)||t.strategy?t.strategy:[],y=h.includes(g)?h.filter(j=>j!==g):[...h,g];s({strategy:y})},className:`p-2 text-xs font-medium rounded-lg transition-all ${Array.isArray(t.strategy)&&t.strategy.includes(g)?"bg-orange-700/70 theme-text shadow-md":"hover:theme-surface theme-text"}`,children:g},g))})}),e.jsx(rt,{title:m==="fr"?"Tendance & Direction":"Trend & Direction",icon:e.jsx(Ee,{size:16,className:`${x()}`}),color:x(),isCollapsed:a.trendDirection,onToggle:()=>i("trendDirection"),onReset:()=>s({trend:[],direction:[]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-medium theme-text flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),m==="fr"?"Tendance":"Trend"]}),e.jsx("button",{onClick:()=>s({trend:[]}),className:"text-xs text-green-500 hover:text-green-600 transition-colors",children:m==="fr"?"RÃ©initialiser":"Reset"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 pl-4",children:jh.map(g=>e.jsx("button",{onClick:()=>{const h=t.trend||[],y=h.includes(g.id)?h.filter(j=>j!==g.id):[...h,g.id];s({trend:y})},className:`p-2 text-xs font-medium rounded-lg transition-all ${(t.trend||[]).includes(g.id)?`${g.color} theme-text shadow-md`:"hover:theme-surface theme-text"}`,children:g.label[m]},g.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-medium theme-text flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-2"}),"Direction"]}),e.jsx("button",{onClick:()=>s({direction:[]}),className:"text-xs text-blue-500 hover:text-blue-600 transition-colors",children:m==="fr"?"RÃ©initialiser":"Reset"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 pl-4",children:Nh.map(g=>e.jsx("button",{onClick:()=>{const h=Array.isArray(t.direction)||t.direction?t.direction:[],y=h.includes(g.id)?h.filter(j=>j!==g.id):[...h,g.id];s({direction:y})},className:`p-2 text-xs font-medium rounded-lg transition-all ${Array.isArray(t.direction)&&t.direction.includes(g.id)?`${g.color} theme-text shadow-md`:"hover:theme-surface theme-text"}`,children:g.label[m]},g.id))})]})]})}),e.jsx(rt,{title:"Timeframe/Tick",icon:e.jsx(Ee,{size:16,className:`${x()}`}),color:x(),isCollapsed:a.timeframeTick,onToggle:()=>i("timeframeTick"),onReset:()=>s({timeframe:[],tickEntry:[]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>i("timeframe"),className:"flex items-center space-x-2 text-sm font-medium theme-text hover:text-purple-600 transition-colors",children:[a.timeframe?e.jsx(Le,{size:16,className:"text-purple-500"}):e.jsx(mt,{size:16,className:"text-purple-500"}),e.jsx(Ee,{size:16,className:"text-purple-500"}),e.jsx("span",{children:"Timeframe"})]}),e.jsx("button",{onClick:()=>s({timeframe:[]}),className:"text-xs text-purple-500 hover:text-purple-600 transition-colors",children:m==="fr"?"RÃ©initialiser":"Reset"})]}),!a.timeframe&&e.jsx("div",{className:"grid grid-cols-4 gap-2 pl-6",children:n.length>0?n.map(g=>{const h=y=>y.includes("s")?"bg-purple-600":y.includes("m")?"bg-blue-600":y.includes("h")?"bg-green-600":y.includes("d")?"bg-orange-600":y.includes("w")||y.includes("M")?"bg-red-600":"bg-gray-600";return e.jsx("button",{onClick:()=>{const y=Array.isArray(t.timeframe)||t.timeframe?t.timeframe:[],j=y.includes(g)?y.filter(v=>v!==g):[...y,g];s({timeframe:j})},className:`p-2 text-xs font-medium rounded-lg transition-all ${Array.isArray(t.timeframe)&&t.timeframe.includes(g)?`${h(g)} theme-text shadow-md`:"hover:theme-surface theme-text"}`,children:g},g)}):e.jsx("div",{className:"col-span-4 text-center text-sm theme-text-muted py-4",children:m==="fr"?"Aucun timeframe trouvÃ© dans vos trades":"No timeframes found in your trades"})}),o&&o.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>i("tickEntry"),className:"flex items-center space-x-2 text-sm font-medium theme-text hover:text-cyan-600 transition-colors",children:[a.tickEntry?e.jsx(Le,{size:16,className:"text-cyan-500"}):e.jsx(mt,{size:16,className:"text-cyan-500"}),e.jsx(Ee,{size:16,className:"text-cyan-500"}),e.jsx("span",{children:m==="fr"?"Ticks d'EntrÃ©e":"Entry Ticks"})]}),e.jsx("button",{onClick:()=>s({tickEntry:[]}),className:"text-xs text-cyan-500 hover:text-cyan-600 transition-colors",children:m==="fr"?"RÃ©initialiser":"Reset"})]}),!a.tickEntry&&e.jsx("div",{className:"grid grid-cols-4 gap-2 pl-6",children:wh.map(g=>e.jsx("button",{onClick:()=>{const h=Array.isArray(t.tickEntry)||t.tickEntry?t.tickEntry:[],y=h.includes(g.id)?h.filter(j=>j!==g.id):[...h,g.id];s({tickEntry:y})},className:`p-2 text-xs font-medium rounded-lg transition-all ${Array.isArray(t.tickEntry)&&t.tickEntry.includes(g.id)?`${g.color} theme-text shadow-md`:"hover:theme-surface theme-text"}`,children:g.label[m]},g.id))})]})]})}),e.jsx(rt,{title:m==="fr"?"Statut":"Status",icon:e.jsx(Rs,{size:16,className:`${x()}`}),color:x(),isCollapsed:a.status,onToggle:()=>i("status"),onReset:()=>s({status:[]}),children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:kh.map(g=>e.jsx("button",{onClick:()=>{const h=Array.isArray(t.status)||t.status?t.status:[],y=h.includes(g.id)?h.filter(j=>j!==g.id):[...h,g.id];s({status:y})},className:`p-2 text-xs font-medium rounded-lg transition-all ${Array.isArray(t.status)&&t.status.includes(g.id)?`${g.color} theme-text shadow-md`:"hover:theme-surface theme-text"}`,children:g.label[m]},g.id))})})]})},Ph=O.memo(Ch),Mh=({value:t,onChange:s,availableTags:r,popularTags:l,collapsedSections:n,toggleSection:o,onToggleAllTagsSections:a})=>{const{currentLanguage:c}=X(),{currentTheme:i}=ee(),d=()=>"text-[#4f46e5]",u=O.useMemo(()=>{const m=(t.tagSearch||"").trim();if(!m)return r;const p=m.toLowerCase();return r.length>200?r.filter(x=>x.toLowerCase().includes(p)):r.filter(x=>x.includes(m))},[r,t.tagSearch]);return e.jsxs("div",{className:"space-y-4",style:{maxHeight:"calc(100vh - 350px)",overflowY:"auto"},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h3",{className:"text-lg font-semibold theme-text flex items-center",children:[e.jsx(ms,{size:20,className:`mr-2 ${d()}`}),c==="fr"?"Filtrage par Tags":"Filter by Tags"]}),e.jsx("button",{onClick:a,className:"p-1.5 rounded-lg hover:theme-surface transition-colors group",title:c==="fr"?"DÃ©plier/Replier toutes les sous-catÃ©gories":"Expand/Collapse all sub-categories",children:(()=>{const p=["tags","tagSearch"].every(f=>!n[f]),x="#9333ea";return p?e.jsx(ir,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:f=>{f.currentTarget.style.color=x},onMouseOut:f=>{f.currentTarget.style.color="white"}}):e.jsx(ar,{size:18,className:"text-white transition-colors",style:{color:"white"},onMouseOver:f=>{f.currentTarget.style.color=x},onMouseOut:f=>{f.currentTarget.style.color="white"}})})()})]}),e.jsx("p",{className:"text-sm theme-text-muted",children:c==="fr"?"SÃ©lectionnez les tags pour filtrer vos trades":"Select tags to filter your trades"}),e.jsx(rt,{title:"Tags",icon:e.jsx(ms,{size:16,className:`${d()}`}),color:d(),isCollapsed:n.tags,onToggle:()=>o("tags"),onReset:()=>s({tags:void 0}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-2 theme-text-muted",children:c==="fr"?"Rechercher un tag":"Search for a tag"}),e.jsx("input",{type:"text",placeholder:c==="fr"?"Tapez pour rechercher...":"Type to search...",value:t.tagSearch||"",onChange:m=>s({tagSearch:m.target.value}),className:"w-full px-3 py-2 text-sm border rounded-lg focus:outline-none transition-all theme-border ring-tags",style:{backgroundColor:i.colors.surface,borderColor:i.colors.border,color:i.colors.text}})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:u.map(m=>e.jsx("button",{onClick:()=>{const p=t.tags||[],x=p.includes(m)?p.filter(f=>f!==m):[...p,m];s({tags:x.length>0?x:void 0})},className:`p-2 text-xs font-medium rounded-lg transition-all ${(t.tags||[]).includes(m)?"bg-indigo-700/70 theme-text shadow-md":"hover:theme-surface theme-text"}`,children:m},m))}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium theme-text-muted mb-2",children:c==="fr"?"Tags populaires":"Popular tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.map(m=>e.jsx("button",{onClick:()=>{const p=t.tags||[],x=p.includes(m)?p.filter(f=>f!==m):[...p,m];s({tags:x.length>0?x:void 0})},className:`px-3 py-1.5 text-xs font-medium rounded-lg transition-all ${(t.tags||[]).includes(m)?"bg-indigo-700/70 theme-text shadow-md":"hover:theme-surface theme-text border theme-border"}`,children:m},m))})]})]})})]})},Rh=O.memo(Mh),Th=({activeCategory:t,filters:s,onFiltersChange:r,collapsedSections:l,toggleSection:n,availableTrades:o,availableStrategies:a,availableTimeframes:c,availableTickEntries:i,symbolsByMarket:d,toggleAll:u,collapsedMarkets:m,toggleMarket:p,availableTags:x,popularTags:f})=>{const g=h=>{const y={...s,...h};r(y)};return e.jsxs("div",{className:"flex-1 p-4",children:[t==="time"&&e.jsx(hh,{value:{dateRange:s.dateRange,months:s.months,weekdays:s.weekdays,hours:s.hours,timeRange:s.timeRange,sessions:s.sessions},onChange:g,collapsedSections:l,toggleSection:n,onToggleAllTimeSections:u.time}),t==="performance"&&e.jsx(yh,{value:{pnlRange:s.pnlRange,pnlUnit:s.pnlUnit,durationRange:s.durationRange,durationUnit:s.durationUnit,tradeResult:s.tradeResult,feesRange:s.feesRange},onChange:h=>r({...s,...h}),collapsedSections:l,toggleSection:n,onToggleAllPerformanceSections:u.performance}),t==="exposition"&&e.jsx(vh,{value:{contractsRange:s.contractsRange,lotsRange:s.lotsRange,ticksRange:s.ticksRange},onChange:h=>r({...s,...h}),collapsedSections:l,toggleSection:n,onToggleAllExpositionSections:u.exposition}),t==="market"&&e.jsx(Ph,{value:{symbols:Array.isArray(s.symbol)?s.symbol:s.symbol?[s.symbol]:[],strategy:Array.isArray(s.strategy)?s.strategy:s.strategy?[s.strategy]:[],direction:Array.isArray(s.side)?s.side:s.side?[s.side]:[],status:Array.isArray(s.status)?s.status:s.status?[s.status]:[],trend:s.trend,timeframe:Array.isArray(s.timeframe)?s.timeframe:s.timeframe?[s.timeframe]:[],tickEntry:Array.isArray(s.tickEntry)?s.tickEntry:s.tickEntry?[s.tickEntry]:[]},onChange:h=>{const y={};h.symbols!==void 0&&(y.symbol=h.symbols),h.strategy!==void 0&&(y.strategy=h.strategy),h.direction!==void 0&&(y.side=h.direction),h.status!==void 0&&(y.status=h.status),h.trend!==void 0&&(y.trend=h.trend),h.timeframe!==void 0&&(y.timeframe=h.timeframe),h.tickEntry!==void 0&&(y.tickEntry=h.tickEntry),r(_p({...s,...y}))},availableTrades:o,availableStrategies:a,availableTimeframes:c,availableTickEntries:i,collapsedSections:l,collapsedMarkets:m,toggleSection:n,toggleMarket:p,onToggleAllMarketSections:u.market}),t==="tags"&&e.jsx(Rh,{value:{tags:s.tags,tagSearch:void 0},onChange:h=>r({...s,...h}),availableTags:x,popularTags:f,collapsedSections:l,toggleSection:n,onToggleAllTagsSections:u.tags})]})},Dh=({isOpen:t,onToggle:s,filters:r,onFiltersChange:l,availableStrategies:n,availableTags:o,availableTimeframes:a,availableTickEntries:c,availableTrades:i,navigationRequest:d,onNavigationComplete:u})=>{const{currentTheme:m}=ee(),{currentLanguage:p,t:x}=X(),f=Y=>{const te=m.id;return lh(Y,te)},g=(Y,te)=>{const G=m.id;return ah(Y,G,te)},h="theme-text border transition-all bg-[var(--card-bg)] hover:bg-[var(--card-bg-hover)] border-[var(--card-border)] hover:border-[var(--card-border-hover)]",{isCollapsed:y,isHovering:j,isPinned:v,setIsCollapsed:N,setIsHovering:S,setIsPinned:w,isTogglingRef:k}=rh(t),[M,C]=b.useState("time"),[R,P]=b.useState(!1),{collapsedSections:D,toggleSection:T,toggleAllTimeSections:E,toggleAllMarketSections:L,toggleAllPerformanceSections:U,toggleAllExpositionSections:_,toggleAllTagsSections:B}=oh(),z=b.useCallback(Y=>{K(!1),$(""),C(Y.category),Y.type==="filter"&&Y.section!=="general"&&{dateRange:"dateRange",timeRange:"hoursTimeRange",sessions:"sessions",months:"months",weekdays:"weekdays",hours:"hours",hoursTimeRange:"hoursTimeRange",symbols:"symbols",strategies:"strategies",trendDirection:"trendDirection",status:"status",timeframeTick:"timeframeTick",timeframe:"timeframeTick",tickEntry:"timeframeTick",marketType:"marketType",pnl:"pnl",duration:"duration",tradeResult:"tradeResult",fees:"fees",contracts:"contracts",lots:"lots",ticks:"ticks",tags:"tags"}[Y.section]},[D]),{collapsedMarkets:A,toggleMarket:F}=dh(i);b.useEffect(()=>{d&&t&&!k.current&&(N(!1),S(!0),w(!1),C(d.category),sh[d.section]||d.section,setTimeout(()=>{N(!0),S(!1)},2e3))},[d,t]);const[q,W]=b.useState(""),[I,$]=b.useState(""),[V,K]=b.useState(!1);b.useMemo(()=>q?o.filter(Y=>Y.toLowerCase().includes(q.toLowerCase())):o,[o,q]);const ne=b.useMemo(()=>{const Y={};return i.forEach(te=>{te.tags.forEach(G=>{Y[G]=(Y[G]||0)+1})}),Object.entries(Y).sort(([,te],[,G])=>G-te).slice(0,10).map(([te])=>te)},[i]),ue=b.useMemo(()=>{if(!I||I.length<2)return[];const Y=[],te=I.toLowerCase(),G=[{title:"Filtres Temporels",category:"time",section:"general"},{title:"Filtres de Performance",category:"performance",section:"general"},{title:"Filtres de MarchÃ© & Trading",category:"market",section:"general"},{title:"Filtres d'Exposition",category:"exposition",section:"general"},{title:"Filtrage par Tags",category:"tags",section:"general"}],he=[{title:"Plages de Dates",category:"time",section:"dateRange"},{title:"Mois",category:"time",section:"months"},{title:"Jours de la Semaine",category:"time",section:"weekdays"},{title:"Heures",category:"time",section:"hours"},{title:"Plage Horaire",category:"time",section:"hoursTimeRange"},{title:"Sessions de Trading",category:"time",section:"sessions"},{title:"Gains & Pertes",category:"performance",section:"pnl"},{title:"P&L",category:"performance",section:"pnl"},{title:"DurÃ©e des Trades",category:"performance",section:"duration"},{title:"RÃ©sultat du Trade",category:"performance",section:"tradeResult"},{title:"Frais",category:"performance",section:"fees"},{title:"Types de MarchÃ©",category:"market",section:"marketType"},{title:"Symboles",category:"market",section:"symbols"},{title:"StratÃ©gies",category:"market",section:"strategies"},{title:"Tendance & Direction",category:"market",section:"trendDirection"},{title:"Tendance",category:"market",section:"trendDirection"},{title:"Direction",category:"market",section:"trendDirection"},{title:"Statut",category:"market",section:"status"},{title:"Timeframe/Tick",category:"market",section:"timeframeTick"},{title:"Timeframe",category:"market",section:"timeframeTick"},{title:"Ticks d'EntrÃ©e",category:"market",section:"timeframeTick"},{title:"Entry Ticks",category:"market",section:"timeframeTick"},{title:"Contrats EngagÃ©s",category:"exposition",section:"contracts"},{title:"Lots",category:"exposition",section:"lots"},{title:"Ticks",category:"exposition",section:"ticks"},{title:"Tags",category:"tags",section:"tags"}];return G.forEach(we=>{we.title.toLowerCase().includes(te)&&Y.push({...we,type:"category"})}),he.forEach(we=>{we.title.toLowerCase().includes(te)&&Y.push({...we,type:"filter"})}),Y.slice(0,6)},[I]),le=b.useMemo(()=>{const Y=_r(i,r);return{filtered:Y.length,total:i.length,percentage:i.length>0?Math.round(Y.length/i.length*100):0}},[i,r]);b.useMemo(()=>th(r),[r]),b.useMemo(()=>eh(r),[r]),b.useMemo(()=>Zp(r),[r]);const je=b.useMemo(()=>{const Y={};return i.forEach(te=>{const G=te.market;Y[G]||(Y[G]=[]),Y[G].includes(te.symbol)||Y[G].push(te.symbol)}),Y},[i]),ye=b.useCallback(()=>{y&&!v&&!k.current&&(S(!0),N(!1))},[y,v]),ve=b.useCallback(()=>{j&&!v&&(S(!1),N(!0))},[j,v]),se=b.useCallback(()=>{k.current=!0,v?(w(!1),S(!1),N(!0)):(w(!0),S(!0)),setTimeout(()=>{k.current=!1},100)},[v,j]);return t?e.jsxs(e.Fragment,{children:[!y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>{v||N(!0)}}),e.jsxs("div",{className:`fixed right-0 top-0 h-full theme-surface border-l theme-border shadow-2xl transition-all duration-300 ease-in-out z-50 ${y?"w-16":"w-1/2"}`,style:{backgroundColor:m.colors.surface},onMouseEnter:ye,onMouseLeave:ve,children:[e.jsx(ih,{isCollapsed:y,isPinned:v,currentLanguage:p,currentTheme:m,filteredTradesCount:le,activeFilterCount:Es(r),globalSearchTerm:I,showSearchSuggestions:V,searchSuggestions:ue,onToggleCollapse:se,onClose:s,onOpenActiveFilters:()=>P(!0),onChangeSearch:Y=>{$(Y),K(Y.length>=2)},onSearchFocus:()=>K(I.length>=2),onSearchBlur:()=>{setTimeout(()=>K(!1),200)},onClickSuggestion:z,getSectionTextColor:Y=>f(Y)}),!y&&e.jsx("div",{className:"p-4 border-b theme-border",children:e.jsx(ch,{categories:[{id:"time",label:p==="fr"?"Temps":"Time",icon:e.jsx(bt,{size:20})},{id:"market",label:p==="fr"?"MarchÃ©":"Market",icon:e.jsx(He,{size:20})},{id:"performance",label:"Performance",icon:e.jsx(Ee,{size:20})},{id:"exposition",label:p==="fr"?"Exposition":"Exposure",icon:e.jsx(Tt,{size:20})},{id:"tags",label:"Tags",icon:e.jsx(ms,{size:20})}],activeCategory:M,onSelect:Y=>C(Y),cardBaseClasses:h,getCategoryCardVars:g})}),!y&&e.jsx("div",{className:"flex-1 p-4",children:e.jsx(Th,{activeCategory:M,filters:r,onFiltersChange:l,collapsedSections:D,toggleSection:T,availableTrades:i,availableStrategies:n,availableTimeframes:a,availableTickEntries:c,symbolsByMarket:je,toggleAll:{time:E,performance:U,exposition:_,market:L,tags:B},collapsedMarkets:A,toggleMarket:F,availableTags:o,popularTags:ne})}),!y&&e.jsx("div",{className:"p-4 border-t theme-border",children:e.jsx(mh,{currentTheme:m,currentLanguage:p,activeCategory:M,filters:r,filteredTradesCount:le,onFiltersChange:l})}),y&&e.jsx(xh,{}),e.jsx(Ba,{isOpen:R,onClose:()=>P(!1),activeFilters:_a(r,x),onNavigateToFilter:(Y,te)=>{P(!1),C(Y)},onResetFilter:(Y,te)=>{const G={...r};delete G[te],l(G)}})]})]}):null},Eh=({isOpen:t,onToggle:s,filters:r,onFiltersChange:l,availableStrategies:n,availableTags:o,availableTimeframes:a,availableTickEntries:c,availableTrades:i,navigationRequest:d,onNavigationComplete:u})=>e.jsx(e.Fragment,{children:e.jsx(Dh,{isOpen:t,onToggle:s,filters:r,onFiltersChange:l,availableStrategies:n,availableTags:o,availableTimeframes:a,availableTickEntries:c,availableTrades:i,navigationRequest:d,onNavigationComplete:u})}),Fh=({mode:t,onChange:s})=>{const{currentTheme:r}=ee(),{currentLanguage:l}=X(),n=[{id:"normal",label:"Normal"},{id:"quick",label:l==="fr"?"Rapide":"Quick"}];return e.jsx("div",{className:"flex items-center space-x-2",children:n.map(o=>e.jsx("button",{type:"button",onClick:()=>s(o.id),className:`px-3 py-2 rounded-md border text-sm font-medium transition-colors ${t===o.id?"shadow-sm":"hover:shadow-sm"}`,style:{backgroundColor:t===o.id?r.colors.accent:r.colors.surface,color:t===o.id?"#ffffff":r.colors.text,borderColor:r.colors.border},children:o.label},o.id))})},Ha=["date","market","symbol","side","quantity","pnl"],rl=["date","market","symbol","side","quantity","pnl","timeframe","notes","tags"],Uo=["date","market","symbol","side","quantity","pnl","time","timeframe","strategy","setup","trend","notes","tags","screenshots","entryDate","entryTime","entryPrice","exitDate","exitTime","exitPrice","stopPrice","takeProfitPrice","riskReward","tradeResult","fees_commission","fees_spread","fees_swap","fees_exchange","fees_regulatory","fees_other","tickSize","tickValue","marginPerContract","leverage","marginRate","marginUsedOverride","emotion","emotionIntensity","planRespected"];function Ah(t){return`custom-form:${t}`}function Lh(t){const s=b.useMemo(()=>Ah(t),[t]),[r,l]=b.useState(()=>({preferredFormMode:"normal",visibleFields:rl,order:Uo,preferredPnlMode:"percentage"}));b.useEffect(()=>{try{if(!s)return;const d=localStorage.getItem(s);if(!d)return;const u=JSON.parse(d),m={preferredFormMode:u.preferredFormMode||"normal",visibleFields:ol(Array.isArray(u.visibleFields)?u.visibleFields:rl),order:nl(Array.isArray(u.order)?u.order:Uo),preferredPnlMode:u.preferredPnlMode==="absolute"?"absolute":"percentage"};l(m)}catch{}},[s]);const n=b.useCallback(d=>{try{if(!s)return;localStorage.setItem(s,JSON.stringify(d))}catch{}},[s]),o=b.useCallback(d=>{l(u=>{const m={...u,preferredFormMode:d};return n(m),m})},[n]),a=b.useCallback(d=>{l(u=>{const m={...u,preferredPnlMode:d};return n(m),m})},[n]),c=b.useCallback(d=>{l(u=>{const m={...u,visibleFields:ol(d)};return n(m),m})},[n]),i=b.useCallback(d=>{l(u=>{const m={...u,order:nl(d)};return n(m),m})},[n]);return{config:r,setPreferredFormMode:o,setPreferredPnlMode:a,setVisibleFields:c,setOrder:i,REQUIRED_FIELDS:Ha}}function ol(t){const s=new Set(t);return Ha.forEach(r=>s.add(r)),Array.from(s)}function nl(t){const s=[],r=new Set;return t.forEach(l=>{r.has(l)||(r.add(l),s.push(l))}),Uo.forEach(l=>{r.has(l)||(r.add(l),s.push(l))}),s}const $h=({isOpen:t,settings:s,onSettingsChange:r,onClose:l})=>{const[n,o]=b.useState({...s}),{config:a,setPreferredFormMode:c,setVisibleFields:i,REQUIRED_FIELDS:d}=Lh("GLOBAL"),[u,m]=b.useState(!1),[p,x]=b.useState(!0),{currentLanguage:f,changeLanguage:g,t:h}=X(),{currentTheme:y}=ee();b.useEffect(()=>{try{const S=localStorage.getItem("custom-form:allow-profile-overrides");S!==null&&x(JSON.parse(S))}catch{}},[]);const j=S=>{S.preventDefault(),r(n),l()},v=[{code:"EUR",name:"Euro (â‚¬)"},{code:"USD",name:f==="fr"?"Dollar US ($)":"US Dollar ($)"},{code:"GBP",name:f==="fr"?"Livre Sterling (Â£)":"British Pound (Â£)"},{code:"CHF",name:f==="fr"?"Franc Suisse (CHF)":"Swiss Franc (CHF)"},{code:"CAD",name:f==="fr"?"Dollar Canadien (CAD)":"Canadian Dollar (CAD)"},{code:"JPY",name:f==="fr"?"Yen Japonais (Â¥)":"Japanese Yen (Â¥)"}];if(!t)return null;const N={role:"dialog","aria-modal":!0,"aria-labelledby":"settings-modal-title"};return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",...N,children:[e.jsxs("div",{className:"theme-surface rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b theme-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ss,{size:20,className:"theme-text-muted"}),e.jsx("h2",{id:"settings-modal-title",className:"text-xl font-semibold theme-text",children:f==="fr"?"ParamÃ¨tres Rapides":"Quick Settings"})]}),e.jsx("button",{onClick:l,className:"theme-text-muted hover:theme-text transition-colors",children:e.jsx(be,{size:24})})]}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium theme-text mb-4 flex items-center",children:[e.jsx(Bo,{size:20,className:"mr-2 text-blue-500"}),f==="fr"?"Langue / Language":"Language / Langue"]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Ks.map(S=>e.jsxs("button",{type:"button",onClick:()=>g(S.code),className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${f===S.code?"theme-text shadow-md":"theme-surface theme-text hover:theme-surface"}`,style:{backgroundColor:f===S.code?"var(--theme-accent)":"var(--theme-surface)"},children:[e.jsx("span",{className:"text-lg",children:S.flag}),e.jsx("span",{children:S.name})]},S.code))})]}),e.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:`${y.colors.accent}10`,borderColor:y.colors.accent},children:[e.jsxs("h3",{className:"text-sm font-medium mb-2",style:{color:y.colors.accent},children:["â„¹ï¸ ",f==="fr"?"ParamÃ¨tres Rapides":"Quick Settings"]}),e.jsx("p",{className:"text-xs",style:{color:y.colors.textMuted},children:f==="fr"?"Pour des paramÃ¨tres avancÃ©s (affichage des stats, prÃ©fÃ©rences de trading, etc.), utilisez la configuration du profil.":"For advanced settings (stats display, trading preferences, etc.), use the profile configuration."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium theme-text mb-4",children:f==="fr"?"ParamÃ¨tres Financiers de Base":"Basic Financial Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:f==="fr"?"Capital Initial":"Initial Capital"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",value:n.initialCapital,onChange:S=>o(w=>({...w,initialCapital:parseFloat(S.target.value)||0})),className:"w-full px-3 py-2 pr-12 border theme-border rounded-md focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},placeholder:"10000",required:!0}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"theme-text-muted text-sm",children:n.currency})})]}),e.jsx("p",{className:"text-xs theme-text-muted mt-1",children:f==="fr"?"Montant de dÃ©part de votre compte de trading":"Starting amount of your trading account"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:f==="fr"?"Risque par Trade":"Risk per Trade"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.1",min:"0",max:"100",value:n.riskPerTrade,onChange:S=>o(w=>({...w,riskPerTrade:parseFloat(S.target.value)||0})),className:"w-full px-3 py-2 pr-8 border theme-border rounded-md focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},placeholder:"2",required:!0}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"theme-text-muted text-sm",children:"%"})})]}),e.jsx("p",{className:"text-xs theme-text-muted mt-1",children:f==="fr"?"Pourcentage du capital que vous risquez par trade (recommandÃ©: 1-3%)":"Percentage of capital you risk per trade (recommended: 1-3%)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium theme-text mb-2",children:f==="fr"?"Devise":"Currency"}),e.jsx("select",{value:n.currency,onChange:S=>o(w=>({...w,currency:S.target.value})),className:"w-full px-3 py-2 border theme-border rounded-md focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},children:v.map(S=>e.jsx("option",{value:S.code,children:S.name},S.code))}),e.jsx("p",{className:"text-xs theme-text-muted mt-1",children:f==="fr"?"Devise utilisÃ©e pour l'affichage des montants":"Currency used for displaying amounts"})]})]})]}),e.jsxs("div",{className:"theme-surface p-4 rounded-lg border theme-border",children:[e.jsx("h3",{className:"text-lg font-medium theme-text mb-4",children:"Interface"}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx("div",{className:"text-sm theme-text-muted",children:f==="fr"?"Formulaire de trade - Mode par dÃ©faut":"Trade form - Default mode"}),e.jsx(Fh,{mode:a.preferredFormMode||"normal",onChange:S=>c(S)})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:"text-sm theme-text-muted",children:f==="fr"?"Configuration du mode personnalisÃ©":"Custom mode configuration"}),e.jsx("button",{type:"button",onClick:()=>m(!0),className:"px-3 py-2 rounded-md border theme-border theme-text hover:theme-surface transition-colors text-sm",children:f==="fr"?"Configurer le mode personnalisÃ©":"Configure custom mode"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"allow-overrides",type:"checkbox",checked:p,onChange:S=>{const w=S.target.checked;x(w);try{localStorage.setItem("custom-form:allow-profile-overrides",JSON.stringify(w))}catch{}}}),e.jsx("label",{htmlFor:"allow-overrides",className:"text-sm theme-text",children:f==="fr"?"Autoriser les rÃ©glages par profil":"Allow per-profile overrides"})]})]}),e.jsxs("div",{className:"theme-surface p-4 rounded-lg border theme-border",children:[e.jsx("h3",{className:"text-sm font-medium theme-text mb-2",children:f==="fr"?"AperÃ§u des Calculs":"Calculation Preview"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"theme-text-muted",children:f==="fr"?"Capital initial:":"Initial capital:"}),e.jsxs("span",{className:"font-medium theme-text",children:[n.initialCapital.toLocaleString(f==="fr"?"fr-FR":"en-US")," ",n.currency]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"theme-text-muted",children:f==="fr"?"Risque par trade:":"Risk per trade:"}),e.jsxs("span",{className:"font-medium theme-text",children:[(n.initialCapital*n.riskPerTrade/100).toLocaleString(f==="fr"?"fr-FR":"en-US")," ",n.currency," (",n.riskPerTrade,"%)"]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 theme-text theme-surface rounded-md transition-colors",style:{color:"var(--theme-text)",backgroundColor:"var(--theme-surface)"},onMouseEnter:S=>{S.currentTarget.style.backgroundColor="var(--theme-border)"},onMouseLeave:S=>{S.currentTarget.style.backgroundColor="var(--theme-surface)"},children:f==="fr"?"Annuler":"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 theme-text rounded-md transition-colors",style:{backgroundColor:"var(--theme-accent)"},onMouseEnter:S=>{S.currentTarget.style.backgroundColor="var(--theme-accent-hover)"},onMouseLeave:S=>{S.currentTarget.style.backgroundColor="var(--theme-accent)"},children:f==="fr"?"Sauvegarder":"Save"})]})]})]}),e.jsx(va,{isOpen:u,onClose:()=>m(!1),currentHiddenFields:a.order.filter(S=>!a.visibleFields.includes(S)),isRequired:S=>d.includes(S),order:a.order,onApply:S=>{const k=a.order.filter(M=>!S.includes(M));i(k)},onReset:()=>{i(a.order)}})]})},Co={name:"Scalper Pro - DEMO",type:"scalper",accountType:"demo",description:"Profil de dÃ©monstration pour tester les fonctionnalitÃ©s de scalping",settings:{initialCapital:1e4,riskPerTrade:.5,currency:"EUR",maxDailyTrades:50,statsDisplay:{showDurationStats:!0,showTicksStats:!0,showFeesStats:!0,showLotsStats:!0,showAdvancedMetrics:!0,compactView:!1,showTicksCumulativeChart:!0}},preferences:{timeframes:["5s","10s","15s","30s","1m"],markets:["futures"],tradingSessions:[],units:{price:"ticks",quantity:"contracts"},keyMetrics:["trades_per_day","avg_hold_time","tick_capture","win_rate"]},uiSettings:{defaultView:"overview",compactMode:!0,showAdvancedStats:!0,chartType:"candlestick"},isActive:!0,color:"#ef4444"},Ih=(t,s=75)=>{const r=[],l=["ES","NQ","YM","RTY"],n=["Order Flow Scalping","Momentum Scalping","Range Scalping","News Scalping","Breakout Scalping"],o=["5s","10s","15s","30s","1m"],a=new Date;a.setDate(a.getDate()-30);const c={"Order Flow Scalping":{winRate:.75,avgTicks:8,variance:12},"Momentum Scalping":{winRate:.65,avgTicks:6,variance:15},"Range Scalping":{winRate:.55,avgTicks:4,variance:8},"News Scalping":{winRate:.45,avgTicks:12,variance:25},"Breakout Scalping":{winRate:.6,avgTicks:10,variance:18}};for(let i=0;i<s;i++){const d=new Date(a),u=Math.floor(Math.random()*30);d.setDate(d.getDate()+u),(d.getDay()===0||d.getDay()===6)&&d.setDate(d.getDate()+1);const m=8+Math.floor(Math.random()*9),p=Math.floor(Math.random()*60),x=Math.floor(Math.random()*60),f=`${m.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`,g=Math.floor(Math.random()*295)+5,h=n[Math.floor(Math.random()*n.length)],y=c[h];let j;Math.random()<y.winRate?(j=Math.floor(Math.random()*y.variance)+1,h==="Order Flow Scalping"&&(j+=Math.floor(Math.random()*5))):j=-(Math.floor(Math.random()*(y.variance/2))+1);const N=l[Math.floor(Math.random()*l.length)],w={ES:12.5,NQ:5,YM:5,RTY:5}[N],k=j*w,M=-2.5,C=-1.2,R=M+C,D=(k+R)/1e4*100,E={ES:4500,NQ:15e3,YM:35e3,RTY:2e3}[N]+(Math.random()-.5)*100,L=Math.random()>.5?"long":"short",U=L==="long"?E+j*.25:E-j*.25,_=Math.floor(Math.random()*60),B=`${m.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}:${_.toString().padStart(2,"0")}`,z=new Date(d.getTime()+g*1e3).toTimeString().split(" ")[0],A=["25ticks","50ticks","100ticks","200ticks"],F=A[Math.floor(Math.random()*A.length)],q=j>0?"tp":j<-5?"sl":"be",W={id:`demo-${i+1}`,date:d.toISOString().split("T")[0],time:f,symbol:N,side:L,entryPrice:Math.round(E*100)/100,exitPrice:Math.round(U*100)/100,quantity:1,quantityUnit:"contracts",numberOfLots:Math.floor(Math.random()*5)+1,pnlPercentage:Math.round(D*100)/100,pnl:Math.round(k*100)/100,ticksGained:j,tickValue:w,tickEntry:F,status:"closed",strategy:h,timeframe:o[Math.floor(Math.random()*o.length)],market:"futures",trend:Math.random()>.5?"bullish":"bearish",setup:"Scalping setup",notes:`Trade ${i+1} - ${j>0?"Gagnant":"Perdant"} (${j} ticks)`,tags:["demo","scalping",j>0?"winner":"loser"],riskReward:j>0?Math.abs(j)/5:void 0,tradeResult:q,fees:{commission:M,exchangeFees:C,spread:0,swapOvernight:0,regulatoryFees:0,otherFees:0,total:R},entryTime:B,exitTime:z,duration:g,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),profileId:t};r.push(W)}return r.sort((i,d)=>{const u=new Date(i.date+" "+i.time),m=new Date(d.date+" "+d.time);return u.getTime()-m.getTime()})},zh=(t,s=40)=>{const r=[],l=["AAPL","TSLA","MSFT","GOOGL","AMZN","NVDA","META","NFLX"],n=["Breakout Trading","Pullback Trading","Reversal Trading","Mean Reversion","Gap Trading"],o=["5m","15m","30m","1h"],a=new Date;a.setDate(a.getDate()-30);const c={"Breakout Trading":{winRate:.7,avgReturn:2.5,variance:3},"Pullback Trading":{winRate:.65,avgReturn:1.8,variance:2.5},"Reversal Trading":{winRate:.5,avgReturn:3.2,variance:4},"Mean Reversion":{winRate:.6,avgReturn:1.5,variance:2},"Gap Trading":{winRate:.55,avgReturn:2.8,variance:3.5}};for(let i=0;i<s;i++){const d=new Date(a),u=Math.floor(Math.random()*30);d.setDate(d.getDate()+u),(d.getDay()===0||d.getDay()===6)&&d.setDate(d.getDate()+1);const m=9+Math.floor(Math.random()*7),p=Math.floor(Math.random()*60),x=`${m.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`,f=Math.floor(Math.random()*18e3)+1800,g=n[Math.floor(Math.random()*n.length)],h=c[g];let y;Math.random()<h.winRate?(y=Math.random()*h.variance+.3,g==="Breakout Trading"&&(y+=Math.random()*1.5)):y=-(Math.random()*(h.variance/1.5)+.2);const v=1e4*y/100,N=l[Math.floor(Math.random()*l.length)],S=100+Math.random()*200,w=Math.random()>.5?"long":"short",k=y/100*S,M=w==="long"?S+k:S-k,C=-5,R=C,P=Math.floor(Math.random()*60),D=`${m.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}:${P.toString().padStart(2,"0")}`,T=new Date(d.getTime()+f*1e3).toTimeString().split(" ")[0],E=["100ticks","200ticks","500ticks","1000ticks"],L=E[Math.floor(Math.random()*E.length)],U=y>0?"tp":y<-2?"sl":"be",_={id:`demo-day-${i+1}`,date:d.toISOString().split("T")[0],time:x,symbol:N,side:w,entryPrice:Math.round(S*100)/100,exitPrice:Math.round(M*100)/100,quantity:Math.floor(Math.random()*500)+100,quantityUnit:"lots",numberOfLots:Math.floor(Math.random()*3)+1,pnlPercentage:Math.round(y*100)/100,pnl:Math.round(v*100)/100,tickEntry:L,status:"closed",strategy:g,timeframe:o[Math.floor(Math.random()*o.length)],market:"stocks",trend:Math.random()>.5?"bullish":"bearish",setup:"Day trading setup",notes:`Day trade ${i+1} - ${y>0?"Gagnant":"Perdant"}`,tags:["demo","daytrading",y>0?"winner":"loser"],riskReward:y>0?Math.abs(y)/1.5:void 0,tradeResult:U,fees:{commission:C,spread:0,swapOvernight:0,exchangeFees:0,regulatoryFees:0,otherFees:0,total:R},entryTime:D,exitTime:T,duration:f,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),profileId:t};r.push(_)}return r.sort((i,d)=>{const u=new Date(i.date+" "+i.time),m=new Date(d.date+" "+d.time);return u.getTime()-m.getTime()})},Oh=({isOpen:t,onClose:s,onLoadData:r,onClearData:l})=>{const{currentTheme:n}=ee(),{t:o,currentLanguage:a}=X(),[c,i]=b.useState(!1),[d,u]=b.useState(null),m=f=>{u(f),i(!0)},p=f=>{const g={...Co,id:`demo-${f}-${Date.now()}`,name:f==="scalper"?"Scalper Pro - DEMO":"Day Trader Pro - DEMO",type:f==="scalper"?"scalper":"daytrader",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),settings:{...Co.settings,statsDisplay:{...Co.settings.statsDisplay,showTicksCumulativeChart:f==="scalper"}}},h=f==="scalper"?Ih(g.id,75):zh(g.id,40);console.log("ðŸŽ¯ DemoDataButton calling onLoadData:",{tradesCount:h.length,profileName:g.name,profileId:g.id}),r(h,g),i(!1),u(null),s()},x=()=>{d&&p(d)};return t?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:[e.jsxs("div",{className:"card rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b theme-border",children:[e.jsx("h2",{className:"text-xl font-semibold theme-text",children:a==="fr"?"DonnÃ©es de DÃ©monstration":"Demo Data"}),e.jsx("button",{onClick:s,className:"theme-text-muted hover:theme-text transition-colors",children:"âœ•"})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex flex-col space-y-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("h3",{className:"text-lg font-medium mb-2",style:{color:n.colors.text},children:["ðŸš€ ",a==="fr"?"DonnÃ©es de DÃ©monstration":"Demo Data"]}),e.jsx("p",{className:"text-sm mb-4",style:{color:n.colors.textSecondary},children:a==="fr"?"Chargez des donnÃ©es rÃ©alistes pour tester toutes les fonctionnalitÃ©s":"Load realistic data to test all features"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>m("scalper"),className:"p-4 rounded-lg border-2 border-dashed transition-all hover:shadow-md",style:{borderColor:n.colors.border,backgroundColor:n.colors.card},onMouseEnter:f=>{f.currentTarget.style.borderColor=n.colors.accent,f.currentTarget.style.backgroundColor=n.colors.surface},onMouseLeave:f=>{f.currentTarget.style.borderColor=n.colors.border,f.currentTarget.style.backgroundColor=n.colors.card},children:[e.jsx("div",{className:"flex items-center justify-center mb-3",children:e.jsx("div",{className:"text-3xl",children:"âš¡"})}),e.jsx("h4",{className:"font-bold text-lg mb-2",style:{color:n.colors.text},children:"Scalper Pro"}),e.jsxs("div",{className:"text-sm space-y-1",style:{color:n.colors.textSecondary},children:[e.jsxs("p",{children:["â€¢ ",a==="fr"?"75 trades de scalping":"75 scalping trades"]}),e.jsxs("p",{children:["â€¢ ",a==="fr"?"DonnÃ©es de ticks rÃ©alistes":"Realistic tick data"]}),e.jsxs("p",{children:["â€¢ ",a==="fr"?"Graphique cumulatif des ticks":"Cumulative tick chart"]}),e.jsxs("p",{children:["â€¢ ",a==="fr"?"DurÃ©es courtes (5s-5min)":"Short durations (5s-5min)"]}),e.jsxs("p",{children:["â€¢ ",a==="fr"?"Futures ES, NQ, YM, RTY":"ES, NQ, YM, RTY futures"]})]})]}),e.jsxs("button",{onClick:()=>m("daytrader"),className:"p-4 rounded-lg border-2 border-dashed transition-all hover:shadow-md",style:{borderColor:n.colors.border,backgroundColor:n.colors.card},onMouseEnter:f=>{f.currentTarget.style.borderColor=n.colors.accent,f.currentTarget.style.backgroundColor=n.colors.surface},onMouseLeave:f=>{f.currentTarget.style.borderColor=n.colors.border,f.currentTarget.style.backgroundColor=n.colors.card},children:[e.jsx("div",{className:"flex items-center justify-center mb-3",children:e.jsx("div",{className:"text-3xl",children:"ðŸ“ˆ"})}),e.jsx("h4",{className:"font-bold text-lg mb-2",style:{color:n.colors.text},children:"Day Trader Pro"}),e.jsxs("div",{className:"text-sm space-y-1",style:{color:n.colors.textSecondary},children:[e.jsxs("p",{children:["â€¢ ",a==="fr"?"40 trades intraday":"40 intraday trades"]}),e.jsxs("p",{children:["â€¢ ",a==="fr"?"Actions US populaires":"Popular US stocks"]}),e.jsxs("p",{children:["â€¢ ",a==="fr"?"DurÃ©es moyennes (30min-5h)":"Medium durations (30min-5h)"]}),e.jsxs("p",{children:["â€¢ ",a==="fr"?"StratÃ©gies de day trading":"Day trading strategies"]}),e.jsx("p",{children:"â€¢ AAPL, TSLA, MSFT, etc."})]})]})]}),e.jsx("div",{className:"mt-4 p-3 rounded-lg",style:{backgroundColor:n.colors.warning+"20"},children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(Zt,{size:16,style:{color:n.colors.warning}}),e.jsx("span",{style:{color:n.colors.text},children:a==="fr"?"Le chargement remplacera toutes vos donnÃ©es existantes.":"Loading will replace all your existing data."})]})}),e.jsxs("button",{onClick:l,className:"flex items-center justify-center space-x-2 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:n.colors.danger+"20",color:n.colors.danger,border:`1px solid ${n.colors.danger}40`},onMouseEnter:f=>{f.currentTarget.style.backgroundColor=n.colors.danger+"30"},onMouseLeave:f=>{f.currentTarget.style.backgroundColor=n.colors.danger+"20"},children:[e.jsx(es,{size:16}),e.jsx("span",{children:a==="fr"?"Effacer toutes les donnÃ©es":"Clear all data"})]})]})})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]",children:e.jsxs("div",{className:"rounded-lg shadow-xl max-w-md w-full p-6",style:{backgroundColor:n.colors.card,border:`1px solid ${n.colors.border}`},children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(Zt,{size:24,style:{color:n.colors.warning}}),e.jsx("h3",{className:"text-lg font-bold",style:{color:n.colors.text},children:a==="fr"?"Confirmer le chargement":"Confirm loading"})]}),e.jsx("p",{className:"mb-6",style:{color:n.colors.textSecondary},children:a==="fr"?"Cette action va remplacer tous vos trades et profils existants par les donnÃ©es de dÃ©monstration. Cette action est irrÃ©versible.":"This action will replace all your existing trades and profiles with demo data. This action is irreversible."}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>i(!1),className:"flex-1 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:n.colors.surface,color:n.colors.text,border:`1px solid ${n.colors.border}`},children:a==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:x,className:"flex-1 px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:n.colors.warning,color:"#ffffff"},children:a==="fr"?"Confirmer":"Confirm"})]})]})})]}):null};let Po=null;const qh=async()=>{if(!Po)try{const t=await ns(()=>import("./pdf-DQpr2XkM.js").then(s=>s.j),[],import.meta.url);Po=t.default||t.jsPDF}catch(t){throw console.error("Erreur chargement jsPDF:",t),new Error("Impossible de charger jsPDF")}return Po},Uh=(t,s)=>{const r=t.filter(u=>u.date.startsWith(s)),l=r.filter(u=>u.pnl>0).reduce((u,m)=>u+m.pnl,0),n=r.filter(u=>u.pnl<0).reduce((u,m)=>u+m.pnl,0),o=r.reduce((u,m)=>{const p=m.fees?.total||0;return u+Math.abs(p)},0),a=l+n-o,c=r.length>0?r.filter(u=>u.pnl>0).length/r.length*100:0,i=new Map;r.forEach(u=>{const m=u.date.substring(0,7);i.has(m)||i.set(m,{gains:0,losses:0,fees:0,count:0});const p=i.get(m);u.pnl>0?p.gains+=u.pnl:p.losses+=u.pnl;const x=u.fees?.total||0;p.fees+=Math.abs(x),p.count++});const d=Array.from(i.entries()).map(([u,m])=>({month:new Date(u+"-01").toLocaleDateString("fr-FR",{month:"long",year:"numeric"}),gains:m.gains,losses:m.losses,fees:m.fees,net:m.gains+m.losses-m.fees,tradeCount:m.count})).sort((u,m)=>u.month.localeCompare(m.month));return{period:s,totalTrades:r.length,totalGains:l,totalLosses:n,totalFees:o,netResult:a,winRate:c,tradesByMonth:d}},_h=async(t,s,r="Compte de Trading",l="EUR",n="Trader",o="Utilisateur")=>{try{console.log("DÃ©but gÃ©nÃ©ration PDF fiscal...");const a=Uh(t,s);console.log("Stats calculÃ©es:",a);const c=await qh();console.log("jsPDF chargÃ©");const i=new c;console.log("PDF crÃ©Ã©");const d=i.internal.pageSize.getWidth(),u=20;let m=u;const p=[41,128,185],x=[39,174,96],f=[231,76,60],g=[44,62,80],h=(P,D,T,E={})=>{E.color?Array.isArray(E.color)?i.setTextColor(E.color[0],E.color[1],E.color[2]):i.setTextColor(E.color):i.setTextColor(g[0],g[1],g[2]),i.setFontSize(E.fontSize||12),i.text(P,D,T)},y=(P,D,T,E,L=g)=>{i.setDrawColor(L[0],L[1],L[2]),i.line(P,D,T,E)};i.setFillColor(p[0],p[1],p[2]),i.rect(0,0,d,50,"F"),h("RAPPORT FISCAL DE TRADING",u,30,{color:[255,255,255],fontSize:20}),h(`AnnÃ©e ${s}`,u,45,{color:[255,255,255],fontSize:14}),m=80,h("INFORMATIONS DU TRADER",u,m,{fontSize:16,color:p}),m+=25,h(`Nom : ${o}`,u,m,{fontSize:12}),m+=15,h(`PrÃ©nom : ${n}`,u,m,{fontSize:12}),m+=15,h(`Compte : ${r}`,u,m,{fontSize:12}),m+=15,h(`PÃ©riode : 01/01/${s} au 31/12/${s}`,u,m,{fontSize:12}),m+=15,h(`Devise : ${l}`,u,m,{fontSize:12}),m+=40,h("RÃ‰SUMÃ‰ EXÃ‰CUTIF",u,m,{fontSize:16,color:p}),m+=25,h(`Total des trades : ${a.totalTrades}`,u,m,{fontSize:12}),m+=15,h(`Gains totaux : ${a.totalGains.toFixed(2)} ${l}`,u,m,{fontSize:12,color:x}),m+=15,h(`Pertes totales : ${a.totalLosses.toFixed(2)} ${l}`,u,m,{fontSize:12,color:f}),m+=15,h(`Frais totaux : ${a.totalFees.toFixed(2)} ${l}`,u,m,{fontSize:12,color:[128,128,128]}),m+=15,h(`RÃ©sultat net imposable : ${a.netResult.toFixed(2)} ${l}`,u,m,{fontSize:14,color:a.netResult>=0?x:f}),m+=15,h(`Taux de rÃ©ussite : ${a.winRate.toFixed(1)}%`,u,m,{fontSize:12}),i.addPage(),m=u,h("DÃ‰TAIL PAR MOIS",u,m,{fontSize:16,color:p}),m+=20,h("Mois",u,m,{fontSize:10}),h("Trades",u+50,m,{fontSize:10}),h("Gains",u+80,m,{fontSize:10}),h("Pertes",u+120,m,{fontSize:10}),h("Frais",u+160,m,{fontSize:10}),h("Net",u+200,m,{fontSize:10}),y(u,m+5,d-u,m+5),m+=15,a.tradesByMonth.forEach(P=>{m>270&&(i.addPage(),m=u),h(P.month,u,m,{fontSize:9}),h(P.tradeCount.toString(),u+50,m,{fontSize:9}),h(`${P.gains.toFixed(2)}`,u+80,m,{fontSize:9,color:x}),h(`${P.losses.toFixed(2)}`,u+120,m,{fontSize:9,color:f}),h(`${P.fees.toFixed(2)}`,u+160,m,{fontSize:9,color:[128,128,128]}),h(`${P.net.toFixed(2)}`,u+200,m,{fontSize:9,color:P.net>=0?x:f}),m+=12}),m>200&&(i.addPage(),m=u),h("DÃ‰TAIL DES FRAIS",u,m,{fontSize:16,color:p}),m+=20,h("Type de frais",u,m,{fontSize:10}),h("Calcul",u+80,m,{fontSize:10}),h("Montant",u+150,m,{fontSize:10}),y(u,m+5,d-u,m+5),m+=15;const j=t.filter(P=>P.date.startsWith(s)),v=j.reduce((P,D)=>P+Math.abs(D.fees?.commission||0),0),N=j.reduce((P,D)=>P+Math.abs(D.fees?.spread||0),0),S=j.reduce((P,D)=>P+Math.abs(D.fees?.swapOvernight||0),0),w=j.reduce((P,D)=>P+Math.abs(D.fees?.exchangeFees||0),0),k=j.reduce((P,D)=>P+Math.abs(D.fees?.otherFees||0),0);v>0&&(h("Commissions",u,m,{fontSize:9}),h(`${j.length} trades`,u+80,m,{fontSize:9}),h(`${v.toFixed(2)} ${l}`,u+150,m,{fontSize:9,color:[128,128,128]}),m+=12),N>0&&(h("Spreads",u,m,{fontSize:9}),h(`${j.length} trades`,u+80,m,{fontSize:9}),h(`${N.toFixed(2)} ${l}`,u+150,m,{fontSize:9,color:[128,128,128]}),m+=12),S>0&&(h("Frais de financement",u,m,{fontSize:9}),h(`${j.length} trades`,u+80,m,{fontSize:9}),h(`${S.toFixed(2)} ${l}`,u+150,m,{fontSize:9,color:[128,128,128]}),m+=12),w>0&&(h("Frais d'Ã©change",u,m,{fontSize:9}),h(`${j.length} trades`,u+80,m,{fontSize:9}),h(`${w.toFixed(2)} ${l}`,u+150,m,{fontSize:9,color:[128,128,128]}),m+=12),k>0&&(h("Autres frais",u,m,{fontSize:9}),h(`${j.length} trades`,u+80,m,{fontSize:9}),h(`${k.toFixed(2)} ${l}`,u+150,m,{fontSize:9,color:[128,128,128]}),m+=12),y(u,m+3,d-u,m+3),m+=8,h("TOTAL FRAIS",u,m,{fontSize:10,color:p}),h(`${a.totalFees.toFixed(2)} ${l}`,u+150,m,{fontSize:10,color:[128,128,128]}),m+=25,m>200&&(i.addPage(),m=u),h("DÃ‰TAIL DES TRADES (TOUS)",u,m,{fontSize:16,color:p}),m+=20,h("Date",u,m,{fontSize:8}),h("Symbole",u+25,m,{fontSize:8}),h("Type",u+60,m,{fontSize:8}),h("P&L",u+85,m,{fontSize:8}),h("Frais",u+120,m,{fontSize:8}),y(u,m+3,d-u,m+3),m+=10,t.filter(P=>P.date.startsWith(s)).forEach(P=>{m>270&&(i.addPage(),m=u),h(P.date,u,m,{fontSize:7}),h(P.symbol,u+25,m,{fontSize:7}),h(P.side==="long"?"Achat":"Vente",u+60,m,{fontSize:7}),h(`${P.pnl.toFixed(2)} ${l}`,u+85,m,{fontSize:7,color:P.pnl>=0?x:f});const D=P.fees?.total||0,T=D!==0?`${Math.abs(D).toFixed(2)} ${l}`:"-";h(T,u+120,m,{fontSize:7,color:D!==0?[128,128,128]:[128,128,128]}),m+=8});const C=i.getNumberOfPages();for(let P=1;P<=C;P++)if(i.setPage(P),h(`Page ${P} sur ${C}`,d-40,i.internal.pageSize.getHeight()-10,{fontSize:8,color:[128,128,128]}),h(`GÃ©nÃ©rÃ© le ${new Date().toLocaleDateString("fr-FR")}`,u,i.internal.pageSize.getHeight()-10,{fontSize:8,color:[128,128,128]}),P===C){const D=i.internal.pageSize.getHeight()-30;h("NOTES IMPORTANTES :",u,D,{fontSize:8,color:[128,128,128]});const T=D+8;h("â€¢ Les frais sont calculÃ©s Ã  partir des donnÃ©es rÃ©elles des trades (commissions, spreads, etc.)",u,T,{fontSize:7,color:[128,128,128]});const E=T+6;h("â€¢ Conversion devise : Les montants sont exprimÃ©s en "+l+" (taux BCE ou broker)",u,E,{fontSize:7,color:[128,128,128]});const L=E+6;h("â€¢ Ce rapport est gÃ©nÃ©rÃ© Ã  titre de justificatif fiscal. Les montants sont Ã  dÃ©clarer",u,L,{fontSize:7,color:[128,128,128]});const U=L+6;h("  conformÃ©ment Ã  la rÃ©glementation fiscale en vigueur.",u,U,{fontSize:7,color:[128,128,128]})}console.log("TÃ©lÃ©chargement du PDF...");const R=`rapport_fiscal_${r.replace(/\s+/g,"_")}_${s}.pdf`;i.save(R),console.log("PDF tÃ©lÃ©chargÃ©:",R)}catch(a){throw console.error("Erreur lors de la gÃ©nÃ©ration du PDF fiscal:",a),console.error("Stack trace:",a instanceof Error?a.stack:"Pas de stack trace"),new Error(`Erreur lors de la gÃ©nÃ©ration du PDF: ${a instanceof Error?a.message:"Erreur inconnue"}`)}};async function Wh(t,s,r,l,n,o){await _h(t,s,r,l,n,o)}function Vh(t,s="fr"){const r=t.split(`
`).filter(f=>f.trim());if(r.length<2)return{success:!1,trades:[],errors:[s==="fr"?"Fichier CSV vide ou invalide":"Empty or invalid CSV file"],warnings:[],summary:{totalRows:0,validTrades:0,invalidTrades:0,skippedRows:0}};const l=r[0].split(",").map(f=>f.trim().toLowerCase()),n=[],o=[],a=[],c=f=>{for(const g of f){const h=l.findIndex(y=>y.includes(g.toLowerCase()));if(h!==-1)return h}return-1},i=c(["date","time","datetime"]),d=c(["symbol","instrument","pair","asset"]),u=c(["side","direction","type","action"]),m=c(["entry","open","price","entryprice"]),p=c(["exit","close","exitprice"]),x=c(["pnl","profit","gain","result"]);if(i===-1&&o.push(s==="fr"?'Colonne "Date" manquante':'Missing "Date" column'),d===-1&&o.push(s==="fr"?'Colonne "Symbol" manquante':'Missing "Symbol" column'),u===-1&&o.push(s==="fr"?'Colonne "Side/Direction" manquante':'Missing "Side/Direction" column'),m===-1&&o.push(s==="fr"?'Colonne "Entry Price" manquante':'Missing "Entry Price" column'),o.length>0)return{success:!1,trades:[],errors:o,warnings:a,summary:{totalRows:r.length-1,validTrades:0,invalidTrades:0,skippedRows:0}};for(let f=1;f<r.length;f++){const g=r[f].split(",").map(h=>h.trim().replace(/"/g,""));try{const h={id:`imported-${Date.now()}-${f}`,date:g[i]||new Date().toISOString().split("T")[0],symbol:g[d]||"UNKNOWN",side:g[u]?.toLowerCase().includes("buy")||g[u]?.toLowerCase().includes("long")?"long":"short",entryPrice:parseFloat(g[m])||0,exitPrice:p!==-1&&parseFloat(g[p])||void 0,pnl:x!==-1&&parseFloat(g[x])||0,quantity:1,status:"closed",strategy:"",notes:"",tags:["imported"],profileId:"temp-profile-id",isImported:!0};if(h.entryPrice<=0){a.push(`${s==="fr"?"Ligne":"Line"} ${f+1}: ${s==="fr"?"Prix d'entrÃ©e invalide":"Invalid entry price"}`);continue}n.push(h)}catch{a.push(`${s==="fr"?"Ligne":"Line"} ${f+1}: ${s==="fr"?"Erreur de parsing":"Parsing error"}`)}}return{success:n.length>0,trades:n,errors:o,warnings:a,summary:{totalRows:r.length-1,validTrades:n.length,invalidTrades:r.length-1-n.length,skippedRows:0}}}function Bh(t,s="UTF-8"){return new Promise((r,l)=>{const n=new FileReader;n.onload=o=>r(o.target?.result),n.onerror=()=>l(new Error("File read error")),n.readAsText(t,s)})}function Hh(t,s={}){const r=s.separator??",",l=["Date","Symbol","Side","Entry Price","Exit Price","P&L"],n=t.map(a=>[a.date,a.symbol,a.side,String(a.entryPrice??""),String(a.exitPrice??""),String(a.pnl??0)]),o=[l,...n].map(a=>a.join(r)).join(`
`);return s.includeHeaders===!1?n.map(a=>a.join(r)).join(`
`):o}function Gh(t,s){return[["Metric","Value"],["Total Trades",String(t.totalTrades)],["Win Rate",`${t.winRate.toFixed(2)}%`],["Total P&L",`${t.totalPnL.toFixed(2)} ${s.currency}`],["Profit Factor",t.profitFactor===1/0?"âˆž":t.profitFactor.toFixed(2)]].map(l=>l.join(",")).join(`
`)}const Jh=({currentTheme:t,currentLanguage:s,selectedBroker:r,setSelectedBroker:l,isImporting:n,fileInputRef:o,onFileSelect:a,importResult:c,showPreview:i,onTogglePreview:d,previewData:u,onConfirmImport:m})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4 theme-text",children:s==="fr"?"ðŸ“¥ Importer des Trades depuis un fichier CSV":"ðŸ“¥ Import Trades from CSV file"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 theme-text-muted",children:s==="fr"?"Format de fichier":"File format"}),e.jsxs("select",{value:r,onChange:p=>l(p.target.value),className:"w-full px-3 py-2 border theme-border rounded-md focus:outline-none focus:ring-2 focus:border-transparent theme-surface theme-text",style:{"--tw-ring-color":"var(--theme-accent)"},children:[e.jsx("option",{value:"auto",children:s==="fr"?"DÃ©tection automatique":"Auto-detect"}),e.jsx("option",{value:"mt4",children:"MetaTrader 4/5"}),e.jsx("option",{value:"tradingview",children:"TradingView"}),e.jsx("option",{value:"interactive_brokers",children:"Interactive Brokers"}),e.jsx("option",{value:"etoro",children:"eToro"})]})]}),e.jsxs("div",{className:"border-2 border-dashed theme-border rounded-lg p-8 text-center theme-surface transition-colors",children:[e.jsx(yl,{size:48,className:"mx-auto mb-4 text-gray-400 dark:text-gray-500"}),e.jsx("h4",{className:"text-lg font-medium mb-2 theme-text",children:s==="fr"?"SÃ©lectionner un fichier CSV":"Select a CSV file"}),e.jsx("p",{className:"mb-4 theme-text-muted",children:s==="fr"?"Glissez-dÃ©posez votre fichier ou cliquez pour parcourir":"Drag and drop your file or click to browse"}),e.jsx("button",{onClick:()=>o.current?.click(),disabled:n,className:"px-6 py-2 theme-text rounded-lg transition-colors disabled:opacity-50",style:{backgroundColor:"var(--theme-accent)"},onMouseEnter:p=>{p.currentTarget.style.backgroundColor="var(--theme-accent-hover)"},onMouseLeave:p=>{p.currentTarget.style.backgroundColor="var(--theme-accent)"},children:n?s==="fr"?"Import en cours...":"Importing...":s==="fr"?"Choisir un fichier":"Choose a file"}),e.jsx("input",{ref:o,type:"file",accept:".csv",onChange:a,className:"hidden"})]}),c&&e.jsx("div",{className:"mt-6",children:c.success?e.jsxs("div",{className:"p-4 border rounded-lg",style:{backgroundColor:`${t.colors.success}20`,borderColor:t.colors.success},children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(Vr,{size:20,style:{color:t.colors.success}}),e.jsx("h4",{className:"font-medium",style:{color:t.colors.success},children:s==="fr"?"Import rÃ©ussi !":"Import successful!"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.success},children:c.summary.validTrades}),e.jsx("div",{className:"text-sm theme-text-muted",children:s==="fr"?"Trades valides":"Valid trades"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.danger},children:c.summary.invalidTrades}),e.jsx("div",{className:"text-sm theme-text-muted",children:s==="fr"?"Trades invalides":"Invalid trades"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.warning},children:c.summary.skippedRows}),e.jsx("div",{className:"text-sm theme-text-muted",children:s==="fr"?"Lignes ignorÃ©es":"Skipped rows"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:t.colors.info},children:c.summary.totalRows}),e.jsx("div",{className:"text-sm theme-text-muted",children:s==="fr"?"Total lignes":"Total rows"})]})]}),u.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("button",{onClick:d,className:"flex items-center space-x-2 text-sm font-medium transition-colors",style:{color:"var(--theme-accent)"},onMouseEnter:p=>{p.currentTarget.style.color="var(--theme-accent-hover)"},onMouseLeave:p=>{p.currentTarget.style.color="var(--theme-accent)"},children:[i?e.jsx(Re,{size:16}):e.jsx(ke,{size:16}),e.jsxs("span",{children:[i?s==="fr"?"Masquer":"Hide":s==="fr"?"AperÃ§u":"Preview"," ",s==="fr"?" des donnÃ©es":" data"]})]}),i&&e.jsx("div",{className:"mt-3 overflow-x-auto theme-surface rounded border theme-border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"theme-surface",children:[e.jsx("th",{className:"px-3 py-2 text-left theme-text",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-left theme-text",children:s==="fr"?"Symbole":"Symbol"}),e.jsx("th",{className:"px-3 py-2 text-left theme-text",children:"Direction"}),e.jsx("th",{className:"px-3 py-2 text-left theme-text",children:"P&L"}),e.jsx("th",{className:"px-3 py-2 text-left theme-text",children:s==="fr"?"StratÃ©gie":"Strategy"})]})}),e.jsx("tbody",{children:u.map((p,x)=>e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-600",children:[e.jsx("td",{className:"px-3 py-2 theme-text",children:p.date}),e.jsx("td",{className:"px-3 py-2 theme-text",children:p.symbol}),e.jsx("td",{className:"px-3 py-2 theme-text",children:p.side}),e.jsx("td",{className:"px-3 py-2 theme-text",children:p.pnl?.toFixed?p.pnl.toFixed(2):p.pnl??"N/A"}),e.jsx("td",{className:"px-3 py-2 theme-text",children:p.strategy})]},x))})]})})]}),c.warnings.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"font-medium mb-2",style:{color:"var(--theme-warning)"},children:s==="fr"?"Avertissements :":"Warnings:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:c.warnings.map((p,x)=>e.jsx("li",{className:"text-sm",style:{color:"var(--theme-warning)"},children:p},x))})]}),e.jsx("button",{onClick:m,className:"w-full px-4 py-2 text-white rounded-lg transition-colors",style:{backgroundColor:"var(--theme-success)"},onMouseEnter:p=>{p.currentTarget.style.backgroundColor="var(--theme-success-hover)"},onMouseLeave:p=>{p.currentTarget.style.backgroundColor="var(--theme-success)"},children:s==="fr"?`Confirmer l'import de ${c.summary.validTrades} trades`:`Confirm import of ${c.summary.validTrades} trades`})]}):e.jsxs("div",{className:"p-4 border rounded-lg",style:{backgroundColor:`${t.colors.danger}20`,borderColor:t.colors.danger},children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(Zt,{size:20,style:{color:t.colors.danger}}),e.jsx("h4",{className:"font-medium",style:{color:t.colors.danger},children:s==="fr"?"Import Ã©chouÃ©":"Import failed"})]}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:c.errors.map((p,x)=>e.jsx("li",{className:"text-sm",style:{color:t.colors.danger},children:p},x))})]})})]})}),Kh=({currentLanguage:t,exportOptions:s,setExportOptions:r,tradesCount:l,onExportTrades:n,onExportStats:o,onExportComplete:a})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4 theme-text",children:t==="fr"?"ðŸ“¤ Exporter vos DonnÃ©es CSV":"ðŸ“¤ Export your CSV Data"}),e.jsxs("div",{className:"p-4 theme-surface border theme-border rounded-lg mb-6",children:[e.jsx("h4",{className:"font-medium mb-3 text-gray-900 dark:text-white",children:t==="fr"?"Options d'export CSV":"CSV Export Options"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:t==="fr"?"Format de date":"Date format"}),e.jsxs("select",{value:s.dateFormat,onChange:c=>r(i=>({...i,dateFormat:c.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"fr",children:t==="fr"?"FranÃ§ais (JJ/MM/AAAA)":"French (DD/MM/YYYY)"}),e.jsx("option",{value:"us",children:t==="fr"?"US (MM/JJ/AAAA)":"US (MM/DD/YYYY)"}),e.jsx("option",{value:"iso",children:"ISO (YYYY-MM-DD)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:t==="fr"?"SÃ©parateur":"Separator"}),e.jsxs("select",{value:s.separator,onChange:c=>r(i=>({...i,separator:c.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[e.jsx("option",{value:",",children:t==="fr"?"Virgule (,)":"Comma (,)"}),e.jsx("option",{value:";",children:t==="fr"?"Point-virgule (;)":"Semicolon (;)"}),e.jsx("option",{value:"\\t",children:t==="fr"?"Tabulation":"Tab"})]})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:s.includeHeaders,onChange:c=>r(i=>({...i,includeHeaders:c.target.checked})),className:"rounded theme-border focus:ring-2",style:{color:"var(--theme-accent)","--tw-ring-color":"var(--theme-accent)"}}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:t==="fr"?"Inclure les en-tÃªtes":"Include headers"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:s.includeCalculatedFields,onChange:c=>r(i=>({...i,includeCalculatedFields:c.target.checked})),className:"rounded theme-border focus:ring-2",style:{color:"var(--theme-accent)","--tw-ring-color":"var(--theme-accent)"}}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:t==="fr"?"Inclure les champs calculÃ©s":"Include calculated fields"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("button",{onClick:n,disabled:l===0,className:"flex items-center justify-center space-x-2 p-4 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(yl,{size:24,className:"text-gray-600 dark:text-gray-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t==="fr"?"Trades CSV":"CSV Trades"}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[l," ","trades"]})]})]}),e.jsxs("button",{onClick:o,disabled:l===0,className:"flex items-center justify-center space-x-2 p-4 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ss,{size:24,className:"text-gray-600 dark:text-gray-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t==="fr"?"Statistiques CSV":"CSV Statistics"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:t==="fr"?"MÃ©triques complÃ¨tes":"Complete metrics"})]})]}),e.jsxs("button",{onClick:a,disabled:l===0,className:"flex items-center justify-center space-x-2 p-4 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(sr,{size:24,className:"text-gray-600 dark:text-gray-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t==="fr"?"Backup JSON":"JSON Backup"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:t==="fr"?"Sauvegarde complÃ¨te":"Complete backup"})]})]})]})]})}),Yh=({currentLanguage:t,isGeneratingPDF:s,tradesCount:r,pdfOptions:l,setPdfOptions:n,onGeneratePDF:o})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4 theme-text",children:t==="fr"?"ðŸ“„ GÃ©nÃ©rer un Rapport PDF Professionnel":"ðŸ“„ Generate a Professional PDF Report"}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-800 rounded-lg",children:e.jsx(To,{size:24,className:"text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 dark:text-blue-100",children:t==="fr"?"Rapport Fiscal":"Fiscal Report"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:t==="fr"?"GÃ©nÃ¨re un rapport PDF optimisÃ© pour vos dÃ©clarations fiscales":"Generate a PDF report optimized for your tax declarations"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("div",{className:"font-medium mb-2",children:t==="fr"?"Contenu inclus :":"Content included:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{children:["âœ“ ",t==="fr"?"RÃ©sumÃ© fiscal complet":"Complete fiscal summary"]}),e.jsxs("li",{children:["âœ“ ",t==="fr"?"Gains et pertes par mois":"Gains and losses by month"]}),e.jsxs("li",{children:["âœ“ ",t==="fr"?"Liste dÃ©taillÃ©e des trades":"Detailed trades list"]}),e.jsxs("li",{children:["âœ“ ",t==="fr"?"Statistiques de performance":"Performance statistics"]})]})]}),e.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("div",{className:"font-medium mb-2",children:t==="fr"?"Format :":"Format:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{children:["â€¢ ",t==="fr"?"PDF professionnel":"Professional PDF"]}),e.jsxs("li",{children:["â€¢ ",t==="fr"?"PrÃªt pour impression":"Print ready"]}),e.jsxs("li",{children:["â€¢ ",t==="fr"?"Compatible dÃ©clarations":"Tax declaration compatible"]}),e.jsxs("li",{children:["â€¢ ",t==="fr"?"AnnÃ©e courante":"Current year"]})]})]})]}),e.jsx("button",{onClick:o,disabled:r===0||s,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:t==="fr"?"GÃ©nÃ©ration en cours...":"Generating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(To,{size:20}),e.jsx("span",{children:t==="fr"?"GÃ©nÃ©rer le Rapport Fiscal":"Generate Fiscal Report"})]})})]})}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3 text-gray-900 dark:text-white",children:t==="fr"?"Options du rapport PDF":"PDF Report Options"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:l.includeCharts,onChange:a=>n(c=>({...c,includeCharts:a.target.checked})),className:"rounded theme-border focus:ring-2",style:{color:"var(--theme-accent)","--tw-ring-color":"var(--theme-accent)"}}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:t==="fr"?"Inclure les graphiques de performance":"Include performance charts"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:l.includeDetailedStats,onChange:a=>n(c=>({...c,includeDetailedStats:a.target.checked})),className:"rounded theme-border focus:ring-2",style:{color:"var(--theme-accent)","--tw-ring-color":"var(--theme-accent)"}}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:t==="fr"?"Inclure les statistiques dÃ©taillÃ©es":"Include detailed statistics"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:l.includeTradesList,onChange:a=>n(c=>({...c,includeTradesList:a.target.checked})),className:"rounded theme-border focus:ring-2",style:{color:"var(--theme-accent)","--tw-ring-color":"var(--theme-accent)"}}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:t==="fr"?"Inclure la liste des trades":"Include trades list"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:l.includeFiscalSummary,onChange:a=>n(c=>({...c,includeFiscalSummary:a.target.checked})),className:"rounded theme-border focus:ring-2",style:{color:"var(--theme-accent)","--tw-ring-color":"var(--theme-accent)"}}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:t==="fr"?"Inclure le rÃ©sumÃ© fiscal":"Include fiscal summary"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:l.language==="en",onChange:a=>n(c=>({...c,language:a.target.checked?"en":"fr"})),className:"rounded theme-border focus:ring-2",style:{color:"var(--theme-accent)","--tw-ring-color":"var(--theme-accent)"}}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:t==="fr"?"GÃ©nÃ©rer en anglais":"Generate in English"})]})]})]}),s&&e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-600 dark:border-blue-600 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-blue-800 dark:text-blue-200",children:t==="fr"?"GÃ©nÃ©ration du rapport PDF en cours...":"Generating PDF report..."})]})}),r===0&&e.jsx("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--theme-warning)10",borderColor:"var(--theme-warning)30",border:"1px solid var(--theme-warning)30"},children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Zt,{size:20,style:{color:"var(--theme-warning)"}}),e.jsx("span",{style:{color:"var(--theme-warning)"},children:t==="fr"?"Aucun trade disponible pour gÃ©nÃ©rer un rapport":"No trades available to generate a report"})]})})]})}),Xh=({isOpen:t,onClose:s,trades:r,settings:l,onImportTrades:n})=>{const{currentTheme:o}=ee(),{currentLanguage:a}=X(),[c,i]=b.useState("import"),[d,u]=b.useState(null),[m,p]=b.useState(!1),[x,f]=b.useState(!1),[g,h]=b.useState("auto"),[y,j]=b.useState(!1),[v,N]=b.useState([]),S=b.useRef(null),[w,k]=b.useState({includeHeaders:!0,dateFormat:"fr",separator:",",encoding:"utf-8-bom",includeCalculatedFields:!0}),[M,C]=b.useState({includeCharts:!0,includeTradesList:!0,includeDetailedStats:!0,includeFiscalSummary:!0,template:"professional",language:a});if(!t)return null;const R=async _=>{const B=_.target.files?.[0];if(B){p(!0),u(null);try{const z=await Bh(B),A=Vh(z,a);u(A),A.success&&A.trades.length>0&&N(A.trades.slice(0,5))}catch(z){u({success:!1,trades:[],errors:[`${a==="fr"?"Erreur":"Error"}: ${z instanceof Error?z.message:a==="fr"?"Erreur inconnue":"Unknown error"}`],warnings:[],summary:{totalRows:0,validTrades:0,invalidTrades:0,skippedRows:0}})}finally{p(!1)}}},P=()=>{d?.trades&&(n(d.trades),u(null),s())},D=()=>{const _=Hh(r,{separator:w.separator,includeHeaders:w.includeHeaders}),B=new Blob([_],{type:"text/csv"}),z=URL.createObjectURL(B),A=document.createElement("a");A.href=z,A.download=`trades_${new Date().toISOString().split("T")[0]}.csv`,A.click(),URL.revokeObjectURL(z)},T=()=>{const _=qo(r,l),B=Gh(_,l),z=new Blob([B],{type:"text/csv"}),A=URL.createObjectURL(z),F=document.createElement("a");F.href=A,F.download=`stats_${new Date().toISOString().split("T")[0]}.csv`,F.click(),URL.revokeObjectURL(A)},E=()=>{const _={trades:r,stats:qo(r,l),exportDate:new Date().toISOString(),version:"2.0.0"},B=JSON.stringify(_,null,2),z=new Blob([B],{type:"application/json"}),A=URL.createObjectURL(z),F=document.createElement("a");F.href=A,F.download=`backup_${new Date().toISOString().split("T")[0]}.json`,F.click(),URL.revokeObjectURL(A)},L=async()=>{f(!0);try{const _=r.map(z=>({date:z.date,symbol:z.symbol,side:z.side,entryPrice:z.entryPrice,exitPrice:z.exitPrice,pnl:z.pnl||0,quantity:z.quantity||1,fees:z.fees})),B=new Date().getFullYear().toString();await Wh(_,B,"Compte de Trading",l.currency,"Trader","Utilisateur")}catch(_){console.error("Erreur gÃ©nÃ©ration PDF fiscal:",_),alert(a==="fr"?"Erreur lors de la gÃ©nÃ©ration du PDF":"Error generating PDF")}finally{f(!1)}},U={role:"dialog","aria-modal":!0,"aria-labelledby":"import-export-modal-title"};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",...U,children:e.jsxs("div",{className:"theme-surface rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] flex flex-col border theme-border",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b theme-border theme-surface",children:[e.jsx("h2",{id:"import-export-modal-title",className:"text-xl font-semibold theme-text",children:a==="fr"?"Import / Export des DonnÃ©es":"Data Import / Export"}),e.jsx("button",{onClick:s,className:"theme-text-muted hover:theme-text transition-colors",children:e.jsx(be,{size:24})})]}),e.jsx("div",{className:"flex border-b theme-border theme-surface",children:[{key:"import",icon:Rr,label:a==="fr"?"Import CSV":"CSV Import"},{key:"export",icon:cr,label:a==="fr"?"Export CSV":"CSV Export"},{key:"pdf",icon:To,label:a==="fr"?"Rapport PDF":"PDF Report"}].map(({key:_,icon:B,label:z})=>e.jsxs("button",{onClick:()=>i(_),className:`flex items-center px-6 py-3 text-sm font-medium transition-colors border-b-2 ${c===_?"theme-text border-b-2":"theme-text-muted border-transparent hover:theme-text"}`,style:{color:c===_?"var(--theme-accent)":void 0,borderBottomColor:c===_?"var(--theme-accent)":void 0},children:[e.jsx(B,{size:16,className:"mr-2"}),z]},_))}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 theme-surface",children:[c==="import"&&e.jsx(Jh,{currentTheme:o,currentLanguage:a,selectedBroker:g,setSelectedBroker:h,isImporting:m,fileInputRef:S,onFileSelect:R,importResult:d,showPreview:y,onTogglePreview:()=>j(!y),previewData:v,onConfirmImport:P}),c==="export"&&e.jsx(Kh,{currentLanguage:a,exportOptions:w,setExportOptions:k,tradesCount:r.length,onExportTrades:D,onExportStats:T,onExportComplete:E}),c==="pdf"&&e.jsx(Yh,{currentLanguage:a,isGeneratingPDF:x,tradesCount:r.length,pdfOptions:M,setPdfOptions:C,onGeneratePDF:L})]}),e.jsx("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:a==="fr"?"Fermer":"Close"})})]})})},Qh=({showSettings:t,showProfileModal:s,showDemoData:r,showImportExport:l,showStatsDisplaySettings:n,isActiveFiltersModalOpen:o,onCloseSettings:a,onCloseProfileModal:c,onCloseDemoData:i,onCloseImportExport:d,onCloseStatsDisplaySettings:u,setIsActiveFiltersModalOpen:m,currentSettings:p,activeProfile:x,updateProfile:f,editingProfile:g,handleUpdateProfile:h,handleCreateProfile:y,closeProfileModal:j,profileTrades:v,handleImportTrades:N,onLoadDemoData:S,onClearData:w,activeFilters:k,onNavigateToFilter:M,onResetFilter:C})=>e.jsxs(e.Fragment,{children:[t&&e.jsx($h,{isOpen:t,onClose:a,settings:p,onSettingsChange:R=>{x&&f(x.id,{...x,settings:R})}}),s&&e.jsx(Wa,{profile:g||void 0,onSubmit:g?h:y,onClose:j}),r&&e.jsx(Oh,{isOpen:r,onClose:i,onLoadData:S,onClearData:w}),l&&e.jsx(Xh,{isOpen:l,onClose:d,trades:v,onImportTrades:N,settings:p}),n&&e.jsx(Va,{onClose:u,settings:p,onSettingsChange:R=>{x&&f(x.id,{...x,settings:R})}}),e.jsx(Ba,{isOpen:o,onClose:()=>m(!1),activeFilters:k,onNavigateToFilter:M,onResetFilter:C})]}),ll=({children:t})=>{const[s,r]=b.useState(!1),[l,n]=b.useState(null),[o,a]=b.useState(null);return b.useEffect(()=>{const c=d=>{if(d.message&&(d.message.includes("CORS")||d.message.includes("SameSite")||d.message.includes("ahoy_")||d.message.includes("sentry-cdn")||d.message.includes("onMessage"))){console.warn("ðŸŸ¡ Non-critical error filtered:",d.message);return}console.error("ðŸ”´ CRITICAL ERROR DETECTED:",d.error),r(!0),n(d.error),a({stack:d.error?.stack})},i=d=>{if(d.reason&&typeof d.reason=="string"&&(d.reason.includes("CORS")||d.reason.includes("onMessage")||d.reason.includes("sentry-cdn"))){console.warn("ðŸŸ¡ Non-critical promise rejection filtered:",d.reason);return}console.error("ðŸ”´ CRITICAL PROMISE REJECTION:",d.reason),r(!0),n(new Error(d.reason))};return window.addEventListener("error",c),window.addEventListener("unhandledrejection",i),()=>{window.removeEventListener("error",c),window.removeEventListener("unhandledrejection",i)}},[]),s?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f8f9fa",color:"#212529",padding:"20px"},children:e.jsxs("div",{style:{maxWidth:"600px",backgroundColor:"white",padding:"30px",borderRadius:"10px",boxShadow:"0 10px 25px rgba(0,0,0,0.1)",border:"1px solid #dee2e6"},children:[e.jsx("h1",{style:{fontSize:"24px",marginBottom:"20px",color:"#dc3545"},children:"ðŸ”´ Application Error Detected"}),e.jsx("p",{style:{marginBottom:"15px"},children:"A critical error has been detected. Here are the technical details:"}),e.jsxs("div",{style:{backgroundColor:"#f3f4f6",padding:"15px",borderRadius:"5px",marginBottom:"20px",fontFamily:"monospace",fontSize:"14px",overflow:"auto",maxHeight:"300px"},children:[e.jsx("strong",{children:"Error:"})," ",l?.message||"Unknown error",e.jsx("br",{}),e.jsx("strong",{children:"Stack :"}),e.jsx("br",{}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",margin:"10px 0"},children:l?.stack||o?.stack||"No stack trace available"})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>window.location.reload(),style:{backgroundColor:"#3b82f6",color:"white",padding:"10px 20px",border:"none",borderRadius:"5px",cursor:"pointer"},children:"ðŸ”„ Reload Application"}),e.jsx("button",{onClick:()=>{r(!1),n(null),a(null)},style:{backgroundColor:"#10b981",color:"white",padding:"10px 20px",border:"none",borderRadius:"5px",cursor:"pointer"},children:"âœ… Try Again"})]})]})}):e.jsx(e.Fragment,{children:t})},Zh=({initialFilters:t,trades:s})=>{const[r,l]=b.useState(t||{}),[n,o]=b.useState(!1),[a,c]=b.useState(null),[i,d]=b.useState(!1),u=b.useMemo(()=>{try{return _r(s,r)}catch(f){return console.error("ðŸ”´ Error applying filters:",f),s}},[s,r]),m=b.useCallback((f,g)=>{d(!1),c({category:f,section:g}),o(!0)},[]),p=b.useCallback((f,g)=>{const y={dateRange:"dateRange",timeRange:"timeRange",sessions:"sessions",months:"months",weekdays:"weekdays",hours:"hours",symbol:"symbol",strategy:"strategy",trend:"trend",side:"side",status:"status",market:"market",pnlRange:"pnlRange",durationRange:"durationRange",tradeResult:"tradeResult",feesRange:"feesRange",contractsRange:"contractsRange",lotsRange:"lotsRange",ticksRange:"ticksRange",tags:"tags"}[g];y&&l(j=>{const v={...j};return delete v[y],v})},[]),x=b.useMemo(()=>_a(r),[r]);return{filters:r,setFilters:l,filtersMode:n,setFiltersMode:o,filterNavigation:a,setFilterNavigation:c,isActiveFiltersModalOpen:i,setIsActiveFiltersModalOpen:d,handleNavigateToFilter:m,handleResetFilter:p,filteredTrades:u,activeFiltersList:x}},eg=({trades:t,setTrades:s,activeProfile:r,setActiveProfile:l,createProfile:n,t:o})=>{const[a,c]=b.useState(!1),[i,d]=b.useState(!1),[u,m]=b.useState(null),p=b.useCallback(v=>{if(!r){alert(o.selectProfileFirst);return}const N={...v,id:Date.now().toString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),...v,profileId:r.id};s(S=>[N,...S]),c(!1)},[r,s,o]),x=b.useCallback(v=>{if(!u||!r)return;const N={...v,id:u.id,createdAt:u.createdAt,updatedAt:new Date().toISOString(),...v,profileId:r.id};s(S=>S.map(w=>w.id===u.id?N:w)),m(null),c(!1)},[u,r,s]),f=b.useCallback(v=>{window.confirm(o.confirmDelete)&&s(N=>N.filter(S=>S.id!==v))},[s,o]),g=b.useCallback(v=>{if(!r){alert(o.selectProfileFirst);return}const N=v.map(S=>({...S,profileId:r.id}));s(S=>[...S,...N]),alert(o.importSuccess.replace("{count}",v.length.toString()))},[r,s,o]),h=b.useCallback(()=>{window.confirm(o.confirmClearData)&&s(()=>[])},[s,o]),y=b.useCallback(v=>{m(v),c(!0)},[]),j=b.useCallback(()=>{c(!1),m(null)},[]);return{showForm:a,setShowForm:c,showFormV2:i,setShowFormV2:d,editingTrade:u,setEditingTrade:m,handleAddTrade:p,handleEditTrade:x,handleDeleteTrade:f,handleImportTrades:g,handleClearAllData:h,openEditForm:y,closeForm:j}},tg=({setFilters:t,setFiltersMode:s,setFilterNavigation:r})=>{b.useEffect(()=>{const l=n=>{try{const o=n?.detail?.strategy;if(!o)return;t(a=>({...a,strategy:[o]})),setTimeout(()=>{s(!0),r({category:"market",section:"strategies"})},100)}catch(o){console.error("Failed to handle open-filters-for-strategy event",o)}};return window.addEventListener("open-filters-for-strategy",l),()=>window.removeEventListener("open-filters-for-strategy",l)},[t,s,r])},sg=t=>({totalTrades:0,winningTrades:0,losingTrades:0,winRate:0,totalPnL:0,totalPnLPercentage:0,averageWin:0,averageLoss:0,averageWinPercentage:0,averageLossPercentage:0,profitFactor:0,largestWin:0,largestLoss:0,largestWinPercentage:0,largestLossPercentage:0,averageRiskReward:0,currentCapital:t.initialCapital,initialCapital:t.initialCapital,totalReturn:0,averageDuration:0,shortestTrade:0,longestTrade:0,averageWinDuration:0,averageLossDuration:0,totalTicks:0,averageTicksPerTrade:0,averageWinTicks:0,averageLossTicks:0,bestTickCapture:0,worstTickCapture:0,tickEfficiency:0,totalFees:0,averageFeesPerTrade:0,feesAsPercentageOfPnL:0,totalCommissions:0,totalSpreads:0,totalSwapFees:0,feesImpactOnProfitability:0,totalLots:0,averageLotsPerTrade:0,maxLotsInSingleTrade:0,averageLotsWinningTrades:0,averageLotsLosingTrades:0,maxDrawdown:0,maxDrawdownPercentage:0,tradesPerDay:0,sharpeRatio:0,monthlyReturn:0,consistencyScore:0,calmarRatio:0,recoveryFactor:0,expectancy:0,expectancyPercentage:0,averageTradesPerMonth:0,bestMonth:0,worstMonth:0,consecutiveWins:0,consecutiveLosses:0,maxConsecutiveWins:0,maxConsecutiveLosses:0,tpCount:0,slCount:0,beCount:0,tpWinRate:0,slWinRate:0,beWinRate:0}),rg=({activeProfile:t,currentSettings:s,isElectron:r,filters:l,filtersMode:n,onToggleFilters:o,onResetFilters:a,onOpenActiveFiltersModal:c,profileTrades:i,onOpenForm:d,onOpenFormV2:u,onOpenFormV3:m,onOpenDemoData:p})=>{const{currentTheme:x}=ee(),{t:f,currentLanguage:g}=X();return e.jsx("header",{className:"shadow-sm border-b theme-border",style:{backgroundColor:x.colors.surface},children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsx("div",{className:"flex items-center space-x-6",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold theme-text",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx("span",{children:f.appTitle})}),r&&e.jsxs("span",{className:"text-sm ml-2 theme-text-muted",children:["(",f.desktop,")"]})]}),t&&e.jsxs("p",{className:"mt-1 theme-text-muted",children:[t.name," â€¢ ",f.capital,": ",s.initialCapital.toLocaleString(g==="en"?"en-US":"fr-FR")," ",s.currency]})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:p,className:"flex items-center space-x-2 p-2 transition-colors rounded-lg theme-text-muted hover:theme-surface",title:f.loadDemoData,children:[e.jsx(sr,{size:20}),e.jsx("span",{className:"hidden sm:inline text-sm",children:f.demo})]}),e.jsx("div",{className:"relative flex items-center",children:(()=>{const h=()=>{try{const k=localStorage.getItem("addTradePreferredForm");if(k==="v1"||k==="v2"||k==="v3")return k}catch{}return"v3"},[y,j]=O.useState(!1),[v,N]=O.useState(h),S=()=>{t&&(v==="v3"?m():v==="v2"?u():d())},w=k=>{N(k);try{localStorage.setItem("addTradePreferredForm",k)}catch{}j(!1),t&&(k==="v3"?m():k==="v2"?u():d())};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:S,disabled:!t,className:"inline-flex items-center px-4 py-2 rounded-l-lg transition-all duration-200 shadow-sm disabled:opacity-50 disabled:cursor-not-allowed border btn-secondary",title:g==="fr"?"Ajouter un trade":"Add trade",children:[e.jsx(Ye,{size:20,className:"mr-2"}),f.newTrade]}),e.jsx("button",{onClick:()=>j(k=>!k),disabled:!t,className:"px-2 py-2 rounded-r-lg transition-all duration-200 shadow-sm disabled:opacity-50 disabled:cursor-not-allowed border",style:{backgroundColor:x.colors.surface,color:x.colors.text,borderColor:x.colors.border},"aria-haspopup":"menu","aria-expanded":y,title:g==="fr"?"Choisir le mode":"Choose mode",children:e.jsx(Le,{size:16})}),y&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-44 rounded-md shadow-lg border z-20",style:{backgroundColor:x.colors.card,borderColor:x.colors.border},role:"menu",children:[e.jsx("button",{onClick:()=>w("v1"),className:"w-full text-left px-3 py-2 text-sm hover:opacity-90",style:{color:x.colors.text},role:"menuitem",children:g==="fr"?"Form v1 (classique)":"Form v1 (classic)"}),e.jsx("button",{onClick:()=>w("v2"),className:"w-full text-left px-3 py-2 text-sm hover:opacity-90",style:{color:x.colors.text},role:"menuitem",children:g==="fr"?"Form v2 (wizard impÃ©ratif)":"Form v2 (imperative wizard)"}),e.jsx("button",{onClick:()=>w("v3"),className:"w-full text-left px-3 py-2 text-sm hover:opacity-90",style:{color:x.colors.text},role:"menuitem",children:g==="fr"?"Form v3 (wizard dÃ©claratif)":"Form v3 (declarative wizard)"})]})]})})()}),e.jsxs("button",{onClick:()=>{n&&a(),o()},className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-all duration-200 shadow-sm border ${n?"text-white":"btn-secondary hover:theme-surface"}`,style:{backgroundColor:n?"var(--theme-accent)":void 0,borderColor:n?"var(--theme-accent)":void 0},onMouseEnter:h=>{n&&(h.currentTarget.style.backgroundColor="var(--theme-accent-hover)")},onMouseLeave:h=>{n&&(h.currentTarget.style.backgroundColor="var(--theme-accent)")},title:n?g==="fr"?"DÃ©sactiver les filtres":"Disable filters":g==="fr"?"Activer les filtres":"Enable filters",children:[e.jsx(ds,{size:20,className:"mr-2"}),e.jsx("span",{className:"text-sm font-medium",children:g==="fr"?"Filtres":"Filters"}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full ml-1"}),e.jsx(cs,{size:16,className:"ml-1"})]})]}),t&&!n&&e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 theme-surface rounded-lg border theme-border",children:[e.jsx("span",{className:"text-xs font-medium theme-text-secondary",children:i.length}),e.jsx("span",{className:"text-xs theme-text-muted",children:"trades"})]}),t&&n&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 theme-surface rounded-lg border theme-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs font-medium theme-text-secondary",children:`${_r(i,l).length}/${i.length}`}),e.jsx("span",{className:"text-xs theme-text-muted",children:g==="fr"?"trades filtrÃ©s":"filtered trades"})]}),e.jsxs("div",{className:"text-xs font-bold theme-text-secondary",children:[(()=>{const h=_r(i,l);return i.length>0?Math.round(h.length/i.length*100):0})(),"%"]})]}),e.jsxs("button",{onClick:c,className:`flex items-center space-x-2 px-3 py-2 rounded-lg border transition-all duration-200 cursor-pointer group ${Es(l)>0?x.id==="ultra-dark"?"bg-indigo-900/20 border-indigo-800 hover:bg-indigo-900/30 hover:border-indigo-500 hover:shadow-md hover:ring-2 hover:ring-indigo-800":x.id==="dark"?"bg-blue-900/20 border-blue-800 hover:bg-blue-900/30 hover:border-blue-500 hover:shadow-md hover:ring-2 hover:ring-blue-800":"bg-blue-50 border-blue-200 hover:bg-blue-100 hover:border-blue-400 hover:shadow-md hover:ring-2 hover:ring-blue-200":x.id==="ultra-dark"?"theme-surface border theme-border hover:theme-surface hover:shadow-sm hover:border-indigo-600 hover:ring-1 hover:ring-indigo-800":x.id==="dark"?"theme-surface border theme-border hover:theme-surface hover:shadow-sm hover:border-blue-600 hover:ring-1 hover:ring-blue-800":"theme-surface border theme-border hover:theme-surface hover:shadow-sm hover:border-blue-300 hover:ring-1 hover:ring-blue-200"}`,title:g==="fr"?"Cliquer pour voir les filtres actifs et ouvrir les filtres":"Click to see active filters and open filters",children:[e.jsx(ke,{size:14,className:`transition-colors ${Es(l)>0?x.id==="ultra-dark"?"text-indigo-400 group-hover:text-indigo-300":x.id==="dark"?"text-blue-400 group-hover:text-blue-300":"text-blue-600 group-hover:text-blue-700":"theme-text-muted group-hover:theme-text-secondary"}`}),e.jsx("span",{className:`text-xs font-medium transition-colors ${Es(l)>0?x.id==="ultra-dark"?"text-indigo-300 group-hover:text-indigo-200":x.id==="dark"?"text-blue-300 group-hover:text-blue-200":"text-blue-700 group-hover:text-blue-800":"theme-text-secondary group-hover:theme-text"}`,children:Es(l)}),e.jsx("span",{className:`text-xs transition-colors ${Es(l)>0?x.id==="ultra-dark"?"text-indigo-400 group-hover:text-indigo-300":x.id==="dark"?"text-blue-400 group-hover:text-blue-300":"text-blue-600 group-hover:text-blue-700":"theme-text-muted group-hover:theme-text-secondary"}`,children:g==="fr"?"filtres actifs":"active filters"})]})]})]})]})})})};function Mo(t,s){return t??s}function nt(t){if(t==null||t==="")return;const s=typeof t=="number"?t:Number(t);return Number.isFinite(s)?s:void 0}function og(t,s){const r=new Date().toISOString(),l=`t_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,n=nt(t.entryPrice)??0,o=nt(t.exitPrice),a=nt(t.quantity)??0,c=nt(t.tickSize),i=nt(t.tickValue),d=nt(t.ticksGained),u=ja(t,{equity:t.equity});return{id:l,date:Mo(t.date,t.entryDate||r.slice(0,10)),time:Mo(t.time,t.entryTime||"00:00:00"),entryDate:t.entryDate,exitDate:t.exitDate,entryTime:t.entryTime,exitTime:t.exitTime,symbol:String(Mo(t.symbol,"")),side:t.side==="short"?"short":"long",market:t.market||"futures",status:t.status==="open"?"open":"closed",entryPrice:n,exitPrice:o,quantity:a,quantityUnit:"contracts",tickSize:c,tickValue:i,ticksGained:d,pnl:u.pnlNet?Number(u.pnlNet.toString()):void 0,pnlPercentage:u.pnlPct?Number(u.pnlPct.toString()):void 0,riskReward:nt(t.riskReward),riskRewardRatio:nt(t.riskReward),strategy:String(t.strategy||""),timeframe:t.timeframe,trend:t.trend==="bearish"||t.trend==="sideways"?t.trend:"bullish",setup:String(t.setup||""),notes:t.notesAndPsycho||t.notes||"",tags:Array.isArray(t.tags)?t.tags:[],fees:{commission:nt(t.fees?.commission??t.fees_commission),spread:nt(t.fees?.spread??t.fees_spread_slippage),swapOvernight:nt(t.fees?.swapOvernight??t.fees_swap_overnight),exchangeFees:nt(t.fees?.exchangeFees),regulatoryFees:nt(t.fees?.regulatoryFees),otherFees:nt(t.fees?.other??t.fees_other),total:u.totalFees?Number(u.totalFees.toString()):void 0,spread_slippage:nt(t.fees?.spread_slippage??t.fees_spread_slippage),swap_overnight:nt(t.fees?.swap_overnight??t.fees_swap_overnight),other:nt(t.fees?.other??t.fees_other)},tradeResult:t.tradeResult||"",createdAt:r,updatedAt:r,profileId:s}}function ng(t,s){try{const r=og(t,s);return px(r),{ok:!0,trade:r}}catch(r){return{ok:!1,error:r instanceof Error?r.message:"Unknown error"}}}const lg=({onSelect:t})=>{const{currentTheme:s}=ee(),r=({label:l,mode:n})=>e.jsx("button",{onClick:()=>t?.(n),className:"px-3 py-2 rounded-lg border text-sm hover:shadow-md transition-shadow",style:{backgroundColor:s.colors.surface,color:s.colors.text,borderColor:s.colors.border},children:l});return e.jsxs("div",{className:"rounded-xl border p-3 flex flex-col gap-2",style:{backgroundColor:s.colors.card,borderColor:s.colors.border},children:[e.jsx("div",{className:"text-xs font-semibold opacity-80",style:{color:s.colors.text},children:"Modes de saisie (WIP)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(r,{mode:"split",label:"Split Flow"}),e.jsx(r,{mode:"deck",label:"Deck Mode"}),e.jsx(r,{mode:"capsule",label:"Quick Capsule"}),e.jsx(r,{mode:"wizard",label:"Wizard (V2+)"})]})]})},ag=t=>{O.useEffect(()=>{if(t.isOpen)return document.body.setAttribute("data-v3-futures","1"),()=>{document.body.removeAttribute("data-v3-futures")}},[t.isOpen]);const[s,r]=O.useState(null);return O.useEffect(()=>{if(!t.isOpen){r(null);return}let l=!1;const n=()=>{if(!l){try{const a=Array.from(document.querySelectorAll("label")).find(c=>/Personnalisation des champs|Field customization/i.test(c.textContent||""));if(a&&a.parentElement){const c=a.parentElement;let i=c.querySelector("#v3-mode-selector-slot");i||(i=document.createElement("div"),i.id="v3-mode-selector-slot",i.style.marginTop="8px",c.appendChild(i)),r(i);return}}catch{}setTimeout(n,100)}};return n(),()=>{l=!0}},[t.isOpen]),e.jsxs(e.Fragment,{children:[t.isOpen&&e.jsx("style",{children:`
          /* Ã‰largir et sÃ©curiser la hauteur du modal paramÃ¨tres quand ouvert depuis V3 */
          body[data-v3-futures="1"] [class*="max-w-7xl"] { max-width: min(95vw, 1600px) !important; width: 95vw !important; }
          body[data-v3-futures="1"] [class*="h-\\[95vh\\]"] { max-height: 92vh !important; height: auto !important; }
          body[data-v3-futures="1"] [class*="overflow-y-auto"] { overflow-y: auto !important; }
          /* Ajouter un lÃ©ger padding pour Ã©viter la coupe au bord droit sur Ã©crans Ã©troits */
          body[data-v3-futures="1"] .fixed.inset-0 { padding-left: 1.25rem !important; padding-right: 1.25rem !important; }
        `}),e.jsx(ba,{...t}),s&&St.createPortal(e.jsx(lg,{onSelect:()=>{}}),s)]})},al=({onClose:t,isFullscreen:s,setIsFullscreen:r,profileId:l})=>{const{currentTheme:n}=ee(),{currentLanguage:o}=X(),{formData:a,setSettings:c,updateFields:i,settings:d}=fs(),{presets:u,addPreset:m,deletePreset:p,toggleFavorite:x,updatePreset:f,getPreset:g,reorderPresets:h}=Pl(),{mode:y,setMode:j}=Fs(),[v,N]=O.useState(!1),[S,w]=O.useState(null),[k,M]=O.useState(!1),[C,R]=O.useState(!1),[P,D]=O.useState(!1),[T,E]=O.useState(!1),L=O.useMemo(()=>["instrument-context","position-entry","position-exit","risk-reward","notes-screenshots"].filter(W=>!!ht.sections.find(I=>I.id===W)),[]),U=L.length,[_,B]=O.useState(0),z=O.useRef(null);O.useEffect(()=>{const W=()=>{const I=L.reduce(($,V)=>$+(Ps(a,[V]).length===0?1:0),0);B(I)};return z.current&&window.clearTimeout(z.current),z.current=window.setTimeout(W,120),()=>{z.current&&window.clearTimeout(z.current)}},[a,L]),O.useEffect(()=>{try{const W=Object.keys(a||{}).length>0,I=!d||String(d.equity??"")==="10000";M(W||!I)}catch{M(!1)}},[a,d]);const A=()=>{i({}),c({equity:1e4}),w(null),M(!1)},F=()=>{if(k){R(!0);return}t()},q=()=>{if(rf(a).length>0){w(o==="fr"?"Certains champs requis sont manquants.":"Some required fields are missing.");return}N(!0);const I=ng(a,l);N(!1),I.ok?(w(o==="fr"?"Trade ajoutÃ© avec succÃ¨s.":"Trade added successfully."),A(),setTimeout(()=>{w(null),t()},600)):w((o==="fr"?"Erreur: ":"Error: ")+I.error)};return O.useEffect(()=>{const W=I=>{const $=navigator.platform.toUpperCase().includes("MAC");if($&&I.metaKey&&I.key.toLowerCase()==="s"||!$&&I.ctrlKey&&I.key.toLowerCase()==="s"){I.preventDefault(),v||q();return}I.key==="Escape"&&(I.preventDefault(),k?R(!0):t())};return window.addEventListener("keydown",W),()=>window.removeEventListener("keydown",W)},[v,k,a,d]),e.jsxs("div",{className:"w-full shadow-xl border border-border/50 bg-background/95 flex flex-col overflow-y-auto",style:{backgroundColor:n.colors.card,color:n.colors.text,border:`1px solid ${n.colors.border}`,height:s?"100vh":"clamp(700px, 92vh, 960px)",width:s?"100vw":void 0,borderRadius:s?0:16},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",style:{borderColor:n.colors.border,backgroundColor:n.colors.surface},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>E(!0),className:"p-2 rounded-md hover:shadow-sm",style:{border:`1px solid ${n.colors.border}`,backgroundColor:n.colors.surface,color:n.colors.accent},title:o==="fr"?"ParamÃ¨tres du formulaire":"Form settings",children:e.jsx(Jo,{size:16})}),e.jsx("h3",{className:"text-lg font-semibold flex-shrink-0",style:{color:n.colors.text},children:o==="fr"?"Formulaire d'ajout V3 (Test)":"V3 Add Form (Test)"}),e.jsx("div",{className:"ml-4 mr-12",children:e.jsx(ga,{formData:a,presets:u,onLoadPreset:W=>{if(k&&!confirm(o==="fr"?"Ã‰craser les modifications en cours ?":"Override current changes?"))return;const I=g(W);I?.formData&&i(I.formData)},onSavePreset:(W,I,$)=>m(W,I,!!$),onDeletePreset:p,onToggleFavorite:x,onManagePresets:()=>D(!0),onReorderPresets:h})}),e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx("label",{style:{color:n.colors.textMuted},children:"Mode:"}),e.jsxs("select",{value:y,onChange:W=>j(W.target.value),className:"px-2 py-1 rounded border",style:{backgroundColor:n.colors.surface,color:n.colors.text,borderColor:n.colors.border},children:[e.jsx("option",{value:"add",children:o==="fr"?"Cartes":"Cards"}),e.jsx("option",{value:"deck",children:"Deck"}),e.jsx("option",{value:"wizard",children:o==="fr"?"Assistant":"Wizard"}),e.jsx("option",{value:"form",children:o==="fr"?"Formulaire":"Form"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"px-2 py-1 rounded border text-[11px] font-medium",style:{backgroundColor:n.colors.surface,color:n.colors.text,borderColor:n.colors.border},title:o==="fr"?"Progression":"Progress",children:[_,"/",U]}),e.jsx("button",{onClick:()=>r(W=>!W),className:"px-3 py-1 rounded border text-sm",style:{backgroundColor:n.colors.card,borderColor:n.colors.border,color:n.colors.text},title:o==="fr"?s?"Quitter plein Ã©cran":"Plein Ã©cran":s?"Exit fullscreen":"Fullscreen",children:s?o==="fr"?"RÃ©duire":"Exit FS":o==="fr"?"Plein Ã©cran":"Fullscreen"}),e.jsx("button",{onClick:F,className:"px-3 py-1 rounded border text-sm",style:{backgroundColor:n.colors.card,borderColor:n.colors.border,color:n.colors.text},children:o==="fr"?"Fermer":"Close"})]})]}),e.jsxs("div",{className:"flex-1 p-6 space-y-6",children:[y==="add"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:n.colors.border,backgroundColor:n.colors.card},children:e.jsx(Xe,{sectionId:"instrument-context"})}),e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:n.colors.border,backgroundColor:n.colors.card},children:e.jsx(Xe,{sectionId:"position-entry"})}),e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:n.colors.border,backgroundColor:n.colors.card},children:e.jsx(Xe,{sectionId:"position-exit"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:n.colors.border,backgroundColor:n.colors.card},children:e.jsx(Xe,{sectionId:"risk-reward"})}),e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:n.colors.border,backgroundColor:n.colors.card},children:e.jsx(Xe,{sectionId:"notes-screenshots"})})]})]}),y==="deck"&&e.jsx(Ea,{}),y==="wizard"&&e.jsx(Aa,{isFullscreen:s}),y==="form"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:n.colors.border,backgroundColor:n.colors.card},children:e.jsx(Xe,{sectionId:"instrument-context"})}),e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:n.colors.border,backgroundColor:n.colors.card},children:e.jsx(Xe,{sectionId:"position-entry"})}),e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:n.colors.border,backgroundColor:n.colors.card},children:e.jsx(Xe,{sectionId:"position-exit"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:n.colors.border,backgroundColor:n.colors.card},children:e.jsx(Xe,{sectionId:"risk-reward"})}),e.jsx("div",{className:"rounded-lg border p-4",style:{borderColor:n.colors.border,backgroundColor:n.colors.card},children:e.jsx(Xe,{sectionId:"notes-screenshots"})})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-background/80 backdrop-blur-md p-4 border-t flex items-center justify-between",style:{borderColor:n.colors.border,backgroundColor:n.colors.surface},children:[e.jsx("div",{className:"text-xs",style:{color:n.colors.textMuted},children:S}),e.jsxs("div",{className:"flex items-center gap-3 ml-auto",children:[e.jsx("button",{onClick:()=>{k?R(!0):(A(),t())},className:"px-4 py-2 rounded border text-sm hover:shadow-md transition-shadow",style:{backgroundColor:"transparent",color:n.colors.text,borderColor:n.colors.border},children:o==="fr"?"Annuler":"Cancel"}),e.jsx("button",{disabled:v||!1,onClick:q,className:"px-4 py-2 rounded border text-sm hover:shadow-md transition-shadow",style:{backgroundColor:n.colors.accent,color:"#fff",borderColor:"transparent",opacity:v?.7:1},children:o==="fr"?"Enregistrer":"Save"})]})]}),C&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsxs("div",{className:"w-full max-w-md rounded-lg shadow-lg p-4",style:{backgroundColor:n.colors.card,color:n.colors.text,border:`1px solid ${n.colors.border}`},children:[e.jsx("h4",{className:"text-base font-semibold mb-2",children:o==="fr"?"Confirmer la sortie":"Confirm exit"}),e.jsx("p",{className:"text-sm mb-4",style:{color:n.colors.textMuted},children:o==="fr"?"Des modifications non sauvegardÃ©es seront perdues. Annuler ou quitter ?":"Unsaved changes will be lost. Cancel or leave?"}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>R(!1),className:"px-3 py-1.5 rounded border text-sm",style:{backgroundColor:"transparent",color:n.colors.text,borderColor:n.colors.border},children:o==="fr"?"Annuler":"Cancel"}),e.jsx("button",{onClick:()=>{A(),R(!1),t()},className:"px-3 py-1.5 rounded border text-sm",style:{backgroundColor:n.colors.accent,color:"#fff",borderColor:"transparent"},children:o==="fr"?"Quitter":"Leave"})]})]})}),P&&e.jsx(ya,{presets:u,onClose:()=>D(!1),onDeletePreset:p,onToggleFavorite:x,onUpdatePreset:f,onLoadPreset:W=>{if(k&&!confirm(o==="fr"?"Ã‰craser les modifications en cours ?":"Override current changes?"))return;const I=g(W);I?.formData&&i(I.formData)},onReorderPresets:h}),T&&e.jsx(ag,{isOpen:T,onClose:()=>E(!1),activeProfileId:null,onOpenEditMode:void 0})]})},ig=({isOpen:t,onClose:s,provideContext:r=!0,profileId:l})=>{const[n,o]=O.useState(!1),[a,c]=O.useState(!0);return O.useEffect(()=>{o(!!t)},[t]),t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{backgroundColor:a?"transparent":"rgba(0,0,0,0.7)"},children:e.jsx("div",{className:`transform transition-transform transition-opacity duration-200 ease-out ${n?"opacity-100 scale-100":"opacity-0 scale-95"}`,style:{width:a?"100vw":"clamp(320px, 90vw, 1500px)",height:a?"100vh":void 0},children:r?e.jsx(Na,{children:e.jsx(al,{onClose:s,isFullscreen:a,setIsFullscreen:c,profileId:l})}):e.jsx(al,{onClose:s,isFullscreen:a,setIsFullscreen:c,profileId:l})})}):null};function cg(){const[t,s]=b.useState(!1),[r,l]=b.useState(null),[n,o]=xs("trading-journal-trades",[]),[a,c]=b.useState(!1),[i,d]=b.useState(!1),[u,m]=b.useState(null),[p,x]=b.useState(!1),[f,g]=b.useState(!1),[h,y]=b.useState(!1),[j,v]=b.useState(!1),[N,S]=b.useState(!1),[w,k]=b.useState(!1),[M,C]=b.useState("profiles"),[R,P]=b.useState(!1),[D,T]=b.useState("overview"),[E,L]=b.useState(0),[U,_]=b.useState(!1),[B,z]=b.useState(typeof window<"u"?window.location.hash:""),{currentTheme:A}=ee(),{t:F,currentLanguage:q}=X(),{isElectron:W}=Fp();if(b.useEffect(()=>{const ce=()=>z(typeof window<"u"?window.location.hash:"");return window.addEventListener("hashchange",ce),()=>window.removeEventListener("hashchange",ce)},[]),B==="#/v3demo")return e.jsx(ll,{children:e.jsx("div",{className:"min-h-screen transition-colors theme-bg",children:e.jsx(Yn,{})})});const{profiles:I,activeProfile:$,createProfile:V,updateProfile:K,setActiveProfile:ne,handleDeleteProfile:ue,showProfileModal:le,editingProfile:je,handleCreateProfile:ye,handleUpdateProfile:ve,closeProfileModal:se}=Ep(o),Y=$?.settings||{initialCapital:1e4,riskPerTrade:2,currency:q==="en"?"USD":"EUR"},te=b.useMemo(()=>{try{return $?n.filter(ce=>ce.profileId===$.id):[]}catch(ce){return console.error("ðŸ”´ Error filtering profile trades:",ce),[]}},[n,$]),{handleAddTrade:G,handleEditTrade:he,handleDeleteTrade:we,handleImportTrades:Ie,handleClearAllData:Te,openEditForm:ze,closeForm:re}=eg({trades:n,setTrades:o,activeProfile:$,setActiveProfile:ne,createProfile:V,t:F}),{filters:H,setFilters:Q,filtersMode:fe,setFiltersMode:Z,filterNavigation:oe,setFilterNavigation:me,isActiveFiltersModalOpen:ge,setIsActiveFiltersModalOpen:Pe,handleNavigateToFilter:Oe,handleResetFilter:ct,filteredTrades:tt,activeFiltersList:Ct}=Zh({initialFilters:{},trades:te});tg({setFilters:ce=>Q(pe=>ce(pe)),setFiltersMode:Z,setFilterNavigation:me});const qt=b.useMemo(()=>{try{return qo(tt,Y)}catch(ce){return console.error("ðŸ”´ Error calculating stats:",ce),sg(Y)}},[tt,Y]),Ht=b.useMemo(()=>Array.from(new Set(te.map(ce=>ce.strategy).filter(Boolean))),[te]),Pt=b.useMemo(()=>Array.from(new Set(te.flatMap(ce=>ce.tags))),[te]),Gt=b.useMemo(()=>{const ce=te.map(pe=>pe.timeframe).filter(pe=>typeof pe=="string"&&pe.length>0);return Array.from(new Set(ce))},[te]),rs=b.useMemo(()=>{const ce=te.map(pe=>pe.tickEntry).filter(pe=>typeof pe=="string"&&pe.length>0);return Array.from(new Set(ce))},[te]),Ut=b.useMemo(()=>Array.from(new Set(te.map(ce=>ce.symbol))),[te]),Ve=ce=>{try{T(ce)}catch(pe){console.error("ðŸ”´ Error changing tab:",pe)}},de=b.useCallback((ce,pe)=>{if(console.log("ðŸš€ handleLoadDemoData called:",{tradesCount:ce.length,profile:pe?.name,hasProfile:!!pe}),!pe){console.log("âŒ No profile provided");return}try{console.log("ðŸ“ Creating profile...");const De=V(pe);console.log("âœ… Profile created:",De.id),console.log("ðŸ”„ Activating profile..."),ne(De.id),console.log("âœ… Profile activated"),console.log("ðŸ’¾ Loading trades with profileId...");const _e=ce.map(Be=>({...Be,profileId:De.id}));o(()=>_e),console.log("âœ… Trades loaded:",_e.length),console.log("ðŸšª Closing modal..."),y(!1),console.log("âœ… Modal closed")}catch(De){console.error("âŒ Error in handleLoadDemoData:",De)}},[V,ne,o]);return e.jsx(ll,{children:e.jsxs("div",{className:"min-h-screen transition-colors theme-bg",children:[e.jsx(rg,{activeProfile:$,currentSettings:Y,isElectron:!!W,filters:H,filtersMode:fe,onToggleFilters:()=>Z(!fe),onResetFilters:()=>Q({}),onOpenActiveFiltersModal:()=>Pe(!0),profileTrades:te,onOpenForm:()=>c(!0),onOpenFormV2:()=>d(!0),onOpenFormV3:()=>x(!0),onOpenDemoData:()=>y(!0)}),e.jsx("main",{className:`transition-all duration-300 ease-in-out ${U&&!a&&!i&&!p?"ml-72":"ml-0"} ${a||i||p?"pointer-events-none":""} px-4 sm:px-6 lg:px-8 py-8`,children:e.jsx("div",{className:`${U&&!a&&!i&&!p?"":"max-w-7xl mx-auto"}`,children:$?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex space-x-1 p-1 rounded-lg theme-surface",children:[e.jsxs("button",{onClick:()=>Ve("overview"),className:`flex items-center px-4 py-2 rounded-md text-sm font-medium transition-colors ${D==="overview"?"shadow-sm btn-primary":"theme-text-muted hover:theme-text"}`,style:{backgroundColor:D==="overview"?A.colors.accent:"transparent",color:D==="overview"?"#ffffff":A.colors.textSecondary},children:[e.jsx(ke,{size:16,className:"mr-2"}),F.overview]}),e.jsxs("button",{onClick:()=>Ve("stats"),className:`flex items-center px-4 py-2 rounded-md text-sm font-medium transition-colors ${D==="stats"?"shadow-sm btn-primary":"theme-text-muted hover:theme-text"}`,style:{backgroundColor:D==="stats"?A.colors.accent:"transparent",color:D==="stats"?"#ffffff":A.colors.textSecondary},children:[e.jsx(He,{size:16,className:"mr-2"}),F.statistics]}),e.jsxs("button",{onClick:()=>Ve("charts"),className:`flex items-center px-4 py-2 rounded-md text-sm font-medium transition-colors ${D==="charts"?"shadow-sm btn-primary":"theme-text-muted hover:theme-text"}`,style:{backgroundColor:D==="charts"?A.colors.accent:"transparent",color:D==="charts"?"#ffffff":A.colors.textSecondary},children:[e.jsx(Ee,{size:16,className:"mr-2"}),F.charts]}),e.jsxs("button",{onClick:()=>Ve("trades"),className:`flex items-center px-4 py-2 rounded-md text-sm font-medium transition-colors ${D==="trades"?"shadow-sm btn-primary":"theme-text-muted hover:theme-text"}`,style:{backgroundColor:D==="trades"?A.colors.accent:"transparent",color:D==="trades"?"#ffffff":A.colors.textSecondary},children:[e.jsx(Br,{size:16,className:"mr-2"}),F.tradesList]})]}),D==="stats"&&e.jsx("button",{onClick:()=>P(!0),className:"p-2 rounded-lg hover:theme-surface transition-colors theme-text-muted hover:theme-text",title:q==="fr"?"PrÃ©fÃ©rences d'affichage":"Display preferences",children:e.jsx(ss,{size:20})})]}),e.jsxs("div",{className:"tab-content",children:[B==="#/v3demo"?e.jsx(Yn,{}):D==="overview"&&e.jsx(ox,{trades:tt,settings:Y}),D==="stats"&&e.jsx(np,{stats:qt,settings:Y,recentTrades:tt,onEdit:ze,onDelete:we,onOpenPreferences:()=>P(!0),title:F.recentTrades}),D==="charts"&&e.jsx(Rp,{trades:tt,settings:Y,onEditTrade:ze,onDeleteTrade:we}),D==="trades"&&e.jsx(Tp,{trades:tt,settings:Y,onEdit:ze,onDelete:we})]}),te.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-xl mb-4 theme-text-muted",children:F.noTrades}),e.jsx("p",{className:"mb-8 theme-text-muted",children:F.startRecordingTrades}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>c(!0),className:"inline-flex items-center px-6 py-3 rounded-lg transition-colors btn-primary",children:[e.jsx(Ye,{size:20,className:"mr-2"}),F.addFirstTrade]}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"text-sm theme-text-muted",children:F.or})}),e.jsxs("button",{onClick:()=>y(!0),className:"inline-flex items-center px-6 py-3 rounded-lg transition-colors border btn-secondary",children:[e.jsx(sr,{size:20,className:"mr-2"}),F.loadDemoData]})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ko,{size:64,className:"mx-auto mb-4 theme-text-muted"}),e.jsx("h2",{className:"text-2xl font-bold mb-2 theme-text",children:F.noProfileSelected}),e.jsx("p",{className:"mb-8 theme-text-muted",children:F.createSelectProfile}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>k(!0),className:"inline-flex items-center px-6 py-3 rounded-lg transition-colors btn-primary",children:[e.jsx(Ye,{size:20,className:"mr-2"}),F.createFirstProfile]}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"text-sm theme-text-muted",children:F.or})}),e.jsxs("button",{onClick:()=>y(!0),className:"inline-flex items-center px-6 py-3 rounded-lg transition-colors border btn-secondary",children:[e.jsx(sr,{size:20,className:"mr-2"}),F.testWithDemoData]})]})]})})}),e.jsx(ig,{isOpen:p,onClose:()=>x(!1),profileId:$?.id}),a&&e.jsx(Ki,{trade:u||void 0,onSubmit:u?he:G,onClose:re,settings:Y,existingSymbols:Ut,existingTrades:n}),i&&e.jsx(Ym,{trade:u||void 0,onSubmit:u?he:G,onClose:()=>{d(!1),m(null)},settings:{...Y,currentCapital:qt.currentCapital},existingSymbols:Ut,existingTrades:n,activeProfileId:$?.id||null,onOpenGlobalSettings:()=>g(!0)}),e.jsx(Qh,{showSettings:f,showProfileModal:le,showDemoData:h,showImportExport:N,showStatsDisplaySettings:R,isActiveFiltersModalOpen:ge,onCloseSettings:()=>g(!1),onCloseProfileModal:se,onCloseDemoData:()=>y(!1),onCloseImportExport:()=>S(!1),onCloseStatsDisplaySettings:()=>P(!1),setIsActiveFiltersModalOpen:Pe,currentSettings:Y,activeProfile:$,updateProfile:K,editingProfile:je,handleUpdateProfile:ve,handleCreateProfile:ye,closeProfileModal:se,profileTrades:te,handleImportTrades:Ie,onLoadDemoData:de,onClearData:Te,activeFilters:Ct,onNavigateToFilter:Oe,onResetFilter:ct}),!a&&!i&&!p&&e.jsx(Xp,{isOpen:U,onToggle:()=>_(!U),onOpenSettings:()=>g(!0),onOpenProfileSettings:()=>k(!0),onOpenImportExport:()=>S(!0)}),w&&e.jsx(Qp,{profiles:I,activeProfile:$,onProfileChange:ce=>ne(ce.id),onCreateProfile:ye,onUpdateProfile:ve,onDeleteProfile:ue,onClose:()=>k(!1),defaultTab:M}),R&&e.jsx(Va,{onClose:()=>P(!1),settings:Y,onSettingsChange:ce=>{$&&K($.id,{...$,settings:ce})}}),e.jsx(Eh,{isOpen:fe,onToggle:()=>Z(!fe),filters:H,onFiltersChange:Q,availableStrategies:Ht,availableTags:Pt,availableTimeframes:Gt,availableTickEntries:rs,availableTrades:te,navigationRequest:oe,onNavigationComplete:()=>me(null)})]},E)})}const Cr={suppressPatterns:[/CORS/i,/SameSite/i,/cross-origin/i,/sentry-cdn/i,/ahoy_/i,/ResizeObserver loop limit exceeded/i],dedupeWindowMs:1e3,enabled:!0};function dg(t={}){const s={...Cr,...t,suppressPatterns:[...Cr.suppressPatterns,...t.suppressPatterns??[]],dedupeWindowMs:t.dedupeWindowMs??Cr.dedupeWindowMs,enabled:t.enabled??Cr.enabled};if(!s.enabled)return;const r={log:console.log.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),debug:console.debug?console.debug.bind(console):console.log.bind(console),trace:console.trace?console.trace.bind(console):console.log.bind(console)};let l=null,n=0;const o=c=>{try{const i=c.map(d=>{if(d instanceof Error)return`${d.name}: ${d.message}`;if(typeof d=="string")return d;try{return JSON.stringify(d)}catch{return String(d)}}).join(" ");return s.suppressPatterns.some(d=>typeof d=="string"?i.includes(d):d.test(i))}catch{return!1}},a=c=>{const i=Date.now(),d=c.map(u=>{if(u instanceof Error)return`${u.name}:${u.message}`;if(typeof u=="string")return u;try{return JSON.stringify(u)}catch{return String(u)}}).join("|");return d===l&&i-n<s.dedupeWindowMs?!0:(l=d,n=i,!1)};["log","warn","error","debug","trace"].forEach(c=>{console[c]=((...i)=>{o(i)||a(i)||r[c](...i)})})}const ug=!1;dg({suppressPatterns:[/\[DECIMAL_COMPARE_DIFF\]/i,/\[CALC_MODE\]/i,/Validation Ã©tape/i,/CustomDatePicker onChange triggered/i,/onBlur triggered, currentValue/i,/Trying to validate date/i,/Valid date found, triggering onChange/i,/onChange triggered, value:/i,/Date filter active in useFilters/i,/Comparing dates:/i,/DemoDataButton calling onLoadData/i],dedupeWindowMs:1200});typeof document<"u"&&(document.cookie="ahoy_visitor=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=None; Secure",document.cookie="ahoy_visit=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=None; Secure");const mg=t=>{if(console.error("ðŸ”´ GLOBAL ERROR CAPTURED:",{message:t.message||t.error?.message,filename:t.filename,lineno:t.lineno,colno:t.colno,stack:t.error?.stack,type:"javascript-error"}),t.message&&(t.message.includes("CORS")||t.message.includes("SameSite")||t.message.includes("cross-origin")||t.message.includes("ahoy_")))return console.warn("ðŸŸ¡ Non-critical error suppressed:",t.message),t.preventDefault(),!1};window.addEventListener("error",t=>{mg(t)});window.addEventListener("unhandledrejection",t=>{if(console.error("ðŸ”´ UNHANDLED PROMISE REJECTION:",{reason:t.reason,promise:t.promise,type:"promise-rejection"}),t.reason&&typeof t.reason=="string"&&(t.reason.includes("CORS")||t.reason.includes("onMessage")||t.reason.includes("sentry-cdn")||t.reason.includes("cross-origin")))return console.warn("ðŸŸ¡ Non-critical promise rejection suppressed:",t.reason),t.preventDefault(),!1});const Ro=document.getElementById("root");if(Ro)try{const t=e.jsx(si,{children:e.jsx(ri,{children:e.jsx(bp,{children:e.jsx(cg,{})})})});ti.createRoot(Ro).render(ug?t:e.jsx(O.StrictMode,{children:t}))}catch(t){console.error("ðŸ”´ REACT APPLICATION RENDER FAILED:",t);const s=document.createElement("div");s.style.color="red",s.style.padding="20px",s.style.fontFamily="Arial",s.style.background="white",s.style.minHeight="100vh",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center";const r=document.createElement("pre");r.textContent=t instanceof Error?t.message:"Unknown error",s.textContent="React Render Error: Failed to render application. Check console for details.",s.appendChild(r),Ro.appendChild(s)}else{console.error('ðŸ”´ ROOT ELEMENT NOT FOUND! Check that index.html has a div with id="root"');const t=document.createElement("div");t.style.color="red",t.style.padding="20px",t.style.fontFamily="Arial",t.style.background="white",t.style.minHeight="100vh",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.innerText="Application Error: root element not found. Please check your HTML file.",document.body.appendChild(t)}export{zc as F,Oc as L,od as N,X as a,fs as b,ee as u};
